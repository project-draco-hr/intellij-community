{
  String patchedContent=content;
  if (!(myTemplate instanceof LocalArchivedTemplate) || ((LocalArchivedTemplate)myTemplate).isEncoded()) {
    for (    WizardInputField field : myAdditionalFields) {
      if (!field.acceptFile(file)) {
        return null;
      }
    }
    Properties properties=FileTemplateManager.getDefaultInstance().getDefaultProperties();
    for (    WizardInputField field : myAdditionalFields) {
      properties.putAll(field.getValues());
    }
    if (projectName != null) {
      properties.put(ProjectTemplateParameterFactory.IJ_PROJECT_NAME,projectName);
    }
    String merged=FileTemplateUtil.mergeTemplate(properties,content,true,exceptionConsumer);
    patchedContent=merged.replace("\\$","$").replace("\\#","#");
  }
  return StringUtilRt.convertLineSeparators(patchedContent,SystemInfo.isWindows ? "\r\n" : "\n").getBytes(CharsetToolkit.UTF8_CHARSET);
}
