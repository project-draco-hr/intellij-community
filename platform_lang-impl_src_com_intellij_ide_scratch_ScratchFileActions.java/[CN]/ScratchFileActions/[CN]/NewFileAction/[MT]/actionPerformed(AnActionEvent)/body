{
  final Project project=e.getProject();
  if (project == null)   return;
  PsiFile file=e.getData(CommonDataKeys.PSI_FILE);
  Editor editor=e.getData(CommonDataKeys.EDITOR);
  final String text=StringUtil.notNullize(getSelectionText(editor));
  Language language=text.isEmpty() ? null : getLanguageFromCaret(project,editor,file);
  Consumer<Language> consumer=new Consumer<Language>(){
    @Override public void consume(    Language language){
      doCreateNewScratch(project,false,language,text);
    }
  }
;
  if (language != null) {
    consumer.consume(language);
  }
 else {
    LRUPopupBuilder.forFileLanguages(project,null,consumer).showCenteredInCurrentWindow(project);
  }
}
