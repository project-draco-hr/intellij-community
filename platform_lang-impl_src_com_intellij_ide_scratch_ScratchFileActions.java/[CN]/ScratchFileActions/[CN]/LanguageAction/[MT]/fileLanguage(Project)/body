{
  return new Function<VirtualFile,Language>(){
    ScratchFileService fileService=ScratchFileService.getInstance();
    @Override public Language fun(    VirtualFile file){
      Language lang=fileService.getScratchesMapping().getMapping(file);
      return lang != null ? lang : LanguageUtil.getLanguageForPsi(project,file);
    }
  }
;
}
