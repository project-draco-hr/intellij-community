{
  return new Function<VirtualFile,Language>(){
    ScratchFileService fileService=ScratchFileService.getInstance();
    @Override public Language fun(    VirtualFile file){
      Language lang=fileService.getScratchesMapping().getMapping(file);
      if (lang == null) {
        lang=LanguageSubstitutors.INSTANCE.substituteLanguage(((LanguageFileType)file.getFileType()).getLanguage(),file,project);
      }
      return lang;
    }
  }
;
}
