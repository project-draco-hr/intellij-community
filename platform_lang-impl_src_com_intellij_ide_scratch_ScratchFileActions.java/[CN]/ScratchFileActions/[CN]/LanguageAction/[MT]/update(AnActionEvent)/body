{
  Project project=e.getProject();
  JBIterable<VirtualFile> files=JBIterable.of(e.getData(CommonDataKeys.VIRTUAL_FILE_ARRAY));
  if (project == null || files.isEmpty()) {
    e.getPresentation().setEnabledAndVisible(false);
    return;
  }
  Condition<VirtualFile> isScratch=fileFilter(project);
  if (!files.filter(not(isScratch)).isEmpty()) {
    e.getPresentation().setEnabledAndVisible(false);
    return;
  }
  Set<Language> langs=files.filter(isScratch).transform(fileLanguage(project)).filter(notNull()).addAllTo(ContainerUtil.<Language>newLinkedHashSet());
  String langName=langs.size() == 1 ? langs.iterator().next().getDisplayName() : langs.size() + " different";
  e.getPresentation().setText(String.format("Change %s (%s)...",getLanguageTerm(),langName));
  e.getPresentation().setEnabledAndVisible(true);
}
