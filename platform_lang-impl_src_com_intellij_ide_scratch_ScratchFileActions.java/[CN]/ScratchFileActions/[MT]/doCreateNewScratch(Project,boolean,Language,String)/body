{
  FeatureUsageTracker.getInstance().triggerFeatureUsed("scratch");
  LanguageFileType fileType=language.getAssociatedFileType();
  String ext=buffer || fileType == null ? "" : fileType.getDefaultExtension();
  String fileName=buffer ? "buffer" + nextBufferIndex() : "scratch";
  ScratchFileService.Option option=buffer ? ScratchFileService.Option.create_if_missing : ScratchFileService.Option.create_new_always;
  VirtualFile f=ScratchRootType.getInstance().createScratchFile(project,PathUtil.makeFileName(fileName,ext),language,text,option);
  if (f != null) {
    FileEditorManager.getInstance(project).openFile(f,true);
  }
}
