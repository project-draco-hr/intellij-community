{
  myInternalName=name;
  String parentName=myParent instanceof PsiClassStub ? ((PsiClassStub)myParent).getQualifiedName() : myParent instanceof PsiJavaFileStub ? ((PsiJavaFileStub)myParent).getPackageName() : null;
  String fqn=getFqn(name,myShortName,parentName);
  String shortName=myShortName != null && name.endsWith(myShortName) ? myShortName : PsiNameHelper.getShortClassName(fqn);
  int flags=myAccess | access;
  boolean isDeprecated=(flags & Opcodes.ACC_DEPRECATED) != 0;
  boolean isInterface=(flags & Opcodes.ACC_INTERFACE) != 0;
  boolean isEnum=(flags & Opcodes.ACC_ENUM) != 0;
  boolean isAnnotationType=(flags & Opcodes.ACC_ANNOTATION) != 0;
  byte stubFlags=PsiClassStubImpl.packFlags(isDeprecated,isInterface,isEnum,false,false,isAnnotationType,false,false);
  myResult=new PsiClassStubImpl(JavaStubElementTypes.CLASS,myParent,fqn,shortName,null,stubFlags);
  LanguageLevel languageLevel=ClsParsingUtil.getLanguageLevelByVersion(version);
  if (languageLevel == null)   languageLevel=LanguageLevel.HIGHEST;
  ((PsiClassStubImpl)myResult).setLanguageLevel(languageLevel);
  myModList=new PsiModifierListStubImpl(myResult,packClassFlags(flags));
  CharacterIterator signatureIterator=signature != null ? new StringCharacterIterator(signature) : null;
  if (signatureIterator != null) {
    try {
      SignatureParsing.parseTypeParametersDeclaration(signatureIterator,myResult);
    }
 catch (    ClsFormatException e) {
      signatureIterator=null;
    }
  }
 else {
    new PsiTypeParameterListStubImpl(myResult);
  }
  String convertedSuper;
  List<String> convertedInterfaces=new ArrayList<String>();
  if (signatureIterator == null) {
    convertedSuper=parseClassDescription(superName,interfaces,convertedInterfaces);
  }
 else {
    try {
      convertedSuper=parseClassSignature(signatureIterator,convertedInterfaces);
    }
 catch (    ClsFormatException e) {
      new PsiTypeParameterListStubImpl(myResult);
      convertedSuper=parseClassDescription(superName,interfaces,convertedInterfaces);
    }
  }
  if (isInterface) {
    if (isAnnotationType) {
      convertedInterfaces.remove(JAVA_LANG_ANNOTATION_ANNOTATION);
    }
    newReferenceList(JavaStubElementTypes.EXTENDS_LIST,myResult,ArrayUtil.toStringArray(convertedInterfaces));
    newReferenceList(JavaStubElementTypes.IMPLEMENTS_LIST,myResult,ArrayUtil.EMPTY_STRING_ARRAY);
  }
 else {
    if (convertedSuper == null || "java/lang/Object".equals(superName) || isEnum && "java/lang/Enum".equals(superName)) {
      newReferenceList(JavaStubElementTypes.EXTENDS_LIST,myResult,ArrayUtil.EMPTY_STRING_ARRAY);
    }
 else {
      newReferenceList(JavaStubElementTypes.EXTENDS_LIST,myResult,new String[]{convertedSuper});
    }
    newReferenceList(JavaStubElementTypes.IMPLEMENTS_LIST,myResult,ArrayUtil.toStringArray(convertedInterfaces));
  }
}
