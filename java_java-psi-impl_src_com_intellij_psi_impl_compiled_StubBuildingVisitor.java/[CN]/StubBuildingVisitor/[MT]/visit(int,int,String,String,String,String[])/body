{
  String fqn, shortName;
  if (myShortName != null && name.endsWith(myShortName)) {
    shortName=myShortName;
    fqn=name.length() == shortName.length() ? shortName : getClassName(name.substring(0,name.length() - shortName.length() - 1)) + "." + shortName;
  }
 else {
    fqn=getClassName(name);
    shortName=PsiNameHelper.getShortClassName(fqn);
  }
  int flags=myAccess == 0 ? access : myAccess;
  boolean isDeprecated=(flags & Opcodes.ACC_DEPRECATED) != 0;
  boolean isInterface=(flags & Opcodes.ACC_INTERFACE) != 0;
  boolean isEnum=(flags & Opcodes.ACC_ENUM) != 0;
  boolean isAnnotationType=(flags & Opcodes.ACC_ANNOTATION) != 0;
  byte stubFlags=PsiClassStubImpl.packFlags(isDeprecated,isInterface,isEnum,false,false,isAnnotationType,false,false);
  myResult=new PsiClassStubImpl(JavaStubElementTypes.CLASS,myParent,fqn,shortName,null,stubFlags);
  LanguageLevel languageLevel=convertFromVersion(version);
  ((PsiClassStubImpl)myResult).setLanguageLevel(languageLevel);
  myModList=new PsiModifierListStubImpl(myResult,packClassFlags(flags));
  CharacterIterator signatureIterator=signature != null ? new StringCharacterIterator(signature) : null;
  if (signatureIterator != null) {
    try {
      SignatureParsing.parseTypeParametersDeclaration(signatureIterator,myResult);
    }
 catch (    ClsFormatException e) {
      signatureIterator=null;
    }
  }
 else {
    new PsiTypeParameterListStubImpl(myResult);
  }
  String convertedSuper;
  List<String> convertedInterfaces=new ArrayList<String>();
  if (signatureIterator == null) {
    convertedSuper=parseClassDescription(superName,interfaces,convertedInterfaces);
  }
 else {
    try {
      convertedSuper=parseClassSignature(signatureIterator,convertedInterfaces);
    }
 catch (    ClsFormatException e) {
      new PsiTypeParameterListStubImpl(myResult);
      convertedSuper=parseClassDescription(superName,interfaces,convertedInterfaces);
    }
  }
  if (isInterface) {
    if (isAnnotationType) {
      convertedInterfaces.remove(JAVA_LANG_ANNOTATION_ANNOTATION);
    }
    newReferenceList(JavaStubElementTypes.EXTENDS_LIST,myResult,ArrayUtil.toStringArray(convertedInterfaces));
    newReferenceList(JavaStubElementTypes.IMPLEMENTS_LIST,myResult);
  }
 else {
    if (convertedSuper == null || JAVA_LANG_OBJECT.equals(convertedSuper) || isEnum && (JAVA_LANG_ENUM.equals(convertedSuper) || (JAVA_LANG_ENUM + "<" + fqn+ ">").equals(convertedSuper))) {
      newReferenceList(JavaStubElementTypes.EXTENDS_LIST,myResult);
    }
 else {
      newReferenceList(JavaStubElementTypes.EXTENDS_LIST,myResult,convertedSuper);
    }
    newReferenceList(JavaStubElementTypes.IMPLEMENTS_LIST,myResult,ArrayUtil.toStringArray(convertedInterfaces));
  }
}
