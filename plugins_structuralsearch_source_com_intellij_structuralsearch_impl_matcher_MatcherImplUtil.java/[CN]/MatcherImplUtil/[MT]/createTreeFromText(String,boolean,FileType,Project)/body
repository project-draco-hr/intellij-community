{
  PsiElementFactory elementFactory=PsiManager.getInstance(project).getElementFactory();
  if (fileType == StdFileTypes.XML || fileType == StdFileTypes.HTML) {
    return ((XmlFile)elementFactory.createFileFromText("dummy." + fileType.getDefaultExtension(),"<QQQ>\n" + text + "\n</QQQ>")).getDocument().getRootTag().getSubTags();
  }
 else {
    PsiElement element=(file) ? (PsiElement)elementFactory.createFileFromText("__$$__.java",text) : elementFactory.createStatementFromText("{\n" + text + "\n}",null);
    PsiElement[] result;
    if (!file) {
      result=((PsiBlockStatement)element).getCodeBlock().getChildren();
      if (result.length > 4) {
        PsiElement[] newresult=new PsiElement[result.length - 4];
        System.arraycopy(result,2,newresult,0,result.length - 4);
        result=newresult;
      }
 else {
        result=PsiElement.EMPTY_ARRAY;
      }
    }
 else {
      result=element.getChildren();
    }
    return result;
  }
}
