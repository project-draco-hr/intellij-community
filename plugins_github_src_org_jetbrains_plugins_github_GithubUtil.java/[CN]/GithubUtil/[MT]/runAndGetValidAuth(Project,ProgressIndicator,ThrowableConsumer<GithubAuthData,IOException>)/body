{
  GithubAuthData auth=GithubSettings.getInstance().getAuthData();
  try {
    if (auth.getAuthType() == GithubAuthData.AuthType.ANONYMOUS) {
      throw new GithubAuthenticationException("Bad authentication type");
    }
    task.consume(auth);
    return auth;
  }
 catch (  GithubAuthenticationException e) {
    auth=getValidAuthData(project,indicator);
    if (auth == null) {
      throw new GithubAuthenticationCanceledException("Can't get valid credentials");
    }
    task.consume(auth);
    return auth;
  }
catch (  IOException e) {
    GithubSslSupport sslSupport=GithubSslSupport.getInstance();
    if (GithubSslSupport.isCertificateException(e)) {
      if (sslSupport.askIfShouldProceed(auth.getHost())) {
        return runAndGetValidAuth(project,indicator,task);
      }
    }
    throw e;
  }
}
