{
  CommandProcessor.getInstance().executeCommand(myElements[0].getProject(),new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          for (          PsiNamedElement oldElement : myElements) {
            PyClassRefactoringUtil.rememberNamedReferences(oldElement);
            final PsiNamedElement newElement=(PsiNamedElement)(myDestination.add(oldElement));
            for (            UsageInfo usage : usages) {
              final PsiElement oldExpr=usage.getElement();
              if (oldExpr instanceof PyQualifiedExpression) {
                final PyQualifiedExpression qexpr=(PyQualifiedExpression)oldExpr;
                if (qexpr.getQualifier() != null) {
                  final PsiElement newExpr=qexpr.getParent().addBefore(new PyReferenceExpressionImpl(qexpr.getNameElement()),qexpr);
                  qexpr.delete();
                  PyClassRefactoringUtil.insertImport(newExpr,newElement,null);
                }
              }
              PyImportStatementBase importStatement=getUsageImportStatement(usage);
              if (importStatement != null) {
                PyClassRefactoringUtil.updateImportOfElement(importStatement,newElement);
              }
              if (usage.getFile() == oldElement.getContainingFile()) {
                PyClassRefactoringUtil.insertImport(oldElement,newElement,null);
              }
            }
            PyClassRefactoringUtil.restoreNamedReferences(newElement);
            oldElement.delete();
          }
        }
      }
);
    }
  }
,REFACTORING_NAME,null);
}
