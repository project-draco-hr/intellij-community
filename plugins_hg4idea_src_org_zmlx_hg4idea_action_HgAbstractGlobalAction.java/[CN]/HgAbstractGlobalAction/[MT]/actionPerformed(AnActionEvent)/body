{
  final DataContext dataContext=event.getDataContext();
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    return;
  }
  VirtualFile[] files=event.getData(CommonDataKeys.VIRTUAL_FILE_ARRAY);
  final HgRepositoryManager repositoryManager=HgUtil.getRepositoryManager(project);
  List<HgRepository> repositories=repositoryManager.getRepositories();
  if (!repositories.isEmpty()) {
    List<HgRepository> selectedRepositories=files != null ? HgActionUtil.collectRepositoriesFromFiles(repositoryManager,Arrays.asList(files)) : ContainerUtil.<HgRepository>emptyList();
    execute(project,repositories,selectedRepositories.isEmpty() ? Collections.singletonList(HgUtil.getCurrentRepository(project)) : selectedRepositories);
  }
}
