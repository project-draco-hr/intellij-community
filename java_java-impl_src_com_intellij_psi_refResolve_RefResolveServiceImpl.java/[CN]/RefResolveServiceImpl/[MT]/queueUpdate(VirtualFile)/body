{
synchronized (filesToResolve) {
    if (!(file instanceof VirtualFileWithId))     return false;
    int fileId=getAbsId(file);
    countAndMarkUnresolved(file,new THashSet<VirtualFile>(),true);
    boolean alreadyAdded=fileIsInQueue.set(fileId);
    if (!alreadyAdded) {
      filesToResolve.add(file);
    }
    upToDate=false;
    wakeUpUnderLock();
    return !alreadyAdded;
  }
}
