{
  if (file.isDirectory()) {
    VfsUtilCore.visitChildrenRecursively(file,new VirtualFileVisitor(){
      @Override public boolean visitFile(      @NotNull VirtualFile file){
        return doCountAndMarkUnresolved(file,result);
      }
      @Nullable @Override public Iterable<VirtualFile> getChildrenIterable(      @NotNull VirtualFile file){
        return inDbOnly ? ((NewVirtualFile)file).iterInDbChildren() : null;
      }
    }
);
  }
 else {
    doCountAndMarkUnresolved(file,result);
  }
}
