{
  Application app=ApplicationManager.getApplication();
  final X509Certificate endPoint=chain[0];
  String threadClassName=StringUtil.notNullize(Thread.currentThread().getClass().getCanonicalName());
  if (threadClassName.equals("sun.awt.image.ImageFetcher")) {
    LOG.debug("Image Fetcher thread is detected. Certificate check will be skipped.");
    return true;
  }
  if (app.isUnitTestMode() || app.isHeadlessEnvironment()) {
    myCustomManager.addCertificate(endPoint);
    return true;
  }
  boolean accepted=CertificateManager.showAcceptDialog(new Callable<DialogWrapper>(){
    @Override public DialogWrapper call() throws Exception {
      return CertificateWarningDialog.createUntrustedCertificateWarning(endPoint);
    }
  }
);
  if (accepted) {
    LOG.info("Certificate was accepted");
    myCustomManager.addCertificate(endPoint);
  }
  return accepted;
}
