{
  RepositoryManager repositoryManager=IcsManager.OBJECT$.getInstance().getRepositoryManager();
  String url=StringUtil.nullize(urlTextField.getText());
  if (url != null) {
    boolean isFile;
    if (url.startsWith(StandardFileSystems.FILE_PROTOCOL_PREFIX)) {
      url=url.substring(StandardFileSystems.FILE_PROTOCOL_PREFIX.length());
      isFile=true;
    }
 else {
      isFile=!url.startsWith("git@") && !URLUtil.containsScheme(url);
    }
    if (isFile && !checkFileRepo(url,repositoryManager)) {
      return false;
    }
  }
  try {
    repositoryManager.setUpstream(url,null);
    return true;
  }
 catch (  Exception e) {
    Messages.showErrorDialog(getContentPane(),IcsBundle.message("set.upstream.failed.message",e.getMessage()),IcsBundle.message("set.upstream.failed.title"));
    return false;
  }
}
