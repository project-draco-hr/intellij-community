{
  final String moduleName=project.getName();
  final String moduleGroup=project.getGroup().toString();
  final String moduleVersion=project.getVersion().toString();
  final File buildDir=project.getBuildDir();
  final ModuleExtendedModelImpl moduleVersionModel=new ModuleExtendedModelImpl(moduleName,moduleGroup,moduleVersion,buildDir);
  final List<File> artifacts=new ArrayList<File>();
  for (  Task task : project.getTasks()) {
    if (task instanceof Jar) {
      Jar jar=(Jar)task;
      artifacts.add(jar.getArchivePath());
    }
  }
  moduleVersionModel.setArtifacts(artifacts);
  final Set<String> sourceDirectories=new HashSet<String>();
  final Set<String> testDirectories=new HashSet<String>();
  final Set<String> resourceDirectories=new HashSet<String>();
  final Set<String> testResourceDirectories=new HashSet<String>();
  final List<File> testClassesDirs=new ArrayList<File>();
  for (  Task task : project.getTasks()) {
    if (task instanceof Test) {
      Test test=(Test)task;
      testClassesDirs.add(test.getTestClassesDir());
      if (test.hasProperty(TEST_SRC_DIRS_PROPERTY)) {
        Object testSrcDirs=test.property(TEST_SRC_DIRS_PROPERTY);
        if (testSrcDirs instanceof Iterable) {
          for (          Object dir : Iterable.class.cast(testSrcDirs)) {
            addFilePath(testDirectories,dir);
          }
        }
      }
    }
  }
  IdeaCompilerOutputImpl compilerOutput=new IdeaCompilerOutputImpl();
  if (project.hasProperty(SOURCE_SETS_PROPERTY)) {
    Object sourceSets=project.property(SOURCE_SETS_PROPERTY);
    if (sourceSets instanceof SourceSetContainer) {
      SourceSetContainer sourceSetContainer=(SourceSetContainer)sourceSets;
      for (      SourceSet sourceSet : sourceSetContainer) {
        SourceSetOutput output=sourceSet.getOutput();
        if (SourceSet.TEST_SOURCE_SET_NAME.equals(sourceSet.getName())) {
          compilerOutput.setTestClassesDir(output.getClassesDir());
          compilerOutput.setTestResourcesDir(output.getResourcesDir());
        }
        if (SourceSet.MAIN_SOURCE_SET_NAME.equals(sourceSet.getName())) {
          compilerOutput.setMainClassesDir(output.getClassesDir());
          compilerOutput.setMainResourcesDir(output.getResourcesDir());
        }
        for (        File javaSrcDir : sourceSet.getAllJava().getSrcDirs()) {
          boolean isTestDir=isTestDir(sourceSet,testClassesDirs);
          addFilePath(isTestDir ? testDirectories : sourceDirectories,javaSrcDir);
        }
        for (        File resourcesSrcDir : sourceSet.getResources().getSrcDirs()) {
          boolean isTestDir=isTestDir(sourceSet,testClassesDirs);
          addFilePath(isTestDir ? testResourceDirectories : resourceDirectories,resourcesSrcDir);
        }
      }
    }
  }
  File projectDir=project.getProjectDir();
  IdeaContentRootImpl contentRoot=new IdeaContentRootImpl(projectDir);
  final Set<String> ideaSourceDirectories=new HashSet<String>();
  final Set<String> ideaTestDirectories=new HashSet<String>();
  final Set<String> ideaGeneratedDirectories=new HashSet<String>();
  final Set<File> excludeDirectories=new HashSet<File>();
  enrichDataFromIdeaPlugin(project,excludeDirectories,ideaSourceDirectories,ideaTestDirectories,ideaGeneratedDirectories);
  if (ideaSourceDirectories.isEmpty()) {
    sourceDirectories.clear();
    resourceDirectories.clear();
  }
  if (ideaTestDirectories.isEmpty()) {
    testDirectories.clear();
    testResourceDirectories.clear();
  }
  ideaSourceDirectories.removeAll(resourceDirectories);
  sourceDirectories.removeAll(ideaTestDirectories);
  sourceDirectories.addAll(ideaSourceDirectories);
  ideaTestDirectories.removeAll(testResourceDirectories);
  testDirectories.addAll(ideaTestDirectories);
  resourceDirectories.removeAll(sourceDirectories);
  testDirectories.removeAll(sourceDirectories);
  testResourceDirectories.removeAll(testDirectories);
  for (  String javaDir : sourceDirectories) {
    contentRoot.addSourceDirectory(new IdeaSourceDirectoryImpl(new File(javaDir),ideaGeneratedDirectories.contains(javaDir)));
  }
  for (  String testDir : testDirectories) {
    contentRoot.addTestDirectory(new IdeaSourceDirectoryImpl(new File(testDir),ideaGeneratedDirectories.contains(testDir)));
  }
  for (  String resourceDir : resourceDirectories) {
    contentRoot.addResourceDirectory(new IdeaSourceDirectoryImpl(new File(resourceDir)));
  }
  for (  String testResourceDir : testResourceDirectories) {
    contentRoot.addTestResourceDirectory(new IdeaSourceDirectoryImpl(new File(testResourceDir)));
  }
  for (  File excludeDir : excludeDirectories) {
    contentRoot.addExcludeDirectory(excludeDir);
  }
  moduleVersionModel.setContentRoots(Collections.<ExtIdeaContentRoot>singleton(contentRoot));
  moduleVersionModel.setCompilerOutput(compilerOutput);
  ConfigurationContainer configurations=project.getConfigurations();
  SortedMap<String,Configuration> configurationsByName=configurations.getAsMap();
  Map<String,Set<File>> artifactsByConfiguration=new HashMap<String,Set<File>>();
  for (  Map.Entry<String,Configuration> configurationEntry : configurationsByName.entrySet()) {
    Set<File> files=configurationEntry.getValue().getAllArtifacts().getFiles().getFiles();
    artifactsByConfiguration.put(configurationEntry.getKey(),files);
  }
  moduleVersionModel.setArtifactsByConfiguration(artifactsByConfiguration);
  return moduleVersionModel;
}
