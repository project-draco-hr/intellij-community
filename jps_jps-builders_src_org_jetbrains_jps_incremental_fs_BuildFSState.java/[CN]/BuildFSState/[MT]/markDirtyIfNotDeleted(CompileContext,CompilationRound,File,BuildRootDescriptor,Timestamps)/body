{
  final boolean marked=getDelta(rd.getTarget()).markRecompileIfNotDeleted(rd,file);
  if (marked && tsStorage != null) {
    tsStorage.removeStamp(file,rd.getTarget());
  }
  if (marked) {
    final FilesDelta roundDelta=getRoundDelta(round == CompilationRound.NEXT ? NEXT_ROUND_DELTA_KEY : CURRENT_ROUND_DELTA_KEY,context);
    if (roundDelta != null) {
      if (isInCurrentContextTargets(context,rd)) {
        roundDelta.markRecompile(rd,file);
      }
    }
  }
  return marked;
}
