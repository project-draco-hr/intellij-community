{
  final FilesDelta roundDelta=getRoundDelta(round == CompilationRound.NEXT ? NEXT_ROUND_DELTA_KEY : CURRENT_ROUND_DELTA_KEY,context);
  if (roundDelta != null && isInCurrentContextTargets(context,rd)) {
    roundDelta.markRecompile(rd,file);
  }
  final boolean marked=getDelta(rd.getTarget()).markRecompile(rd,file);
  if (marked) {
    if (LOG.isDebugEnabled()) {
      LOG.debug(rd.getTarget() + ": MARKED DIRTY: " + file.getPath());
    }
    if (saveEventStamp) {
      myRegistrationStamps.put(file,System.currentTimeMillis());
    }
    if (tsStorage != null) {
      tsStorage.removeStamp(file,rd.getTarget());
    }
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug(rd.getTarget() + ": NOT MARKED DIRTY: " + file.getPath());
    }
  }
  return marked;
}
