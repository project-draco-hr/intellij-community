{
  if (!(file instanceof PyFile))   return false;
  int caretOffset=editor.getCaretModel().getOffset();
  Document document=editor.getDocument();
  int lineNumber=document.getLineNumber(caretOffset);
  int startOffset=document.getLineStartOffset(lineNumber);
  int endOffset=document.getLineEndOffset(lineNumber);
  List<PsiElement> elements=CollectHighlightsUtil.getElementsInRange(file,startOffset,endOffset);
  for (  PsiElement element : elements) {
    if (element instanceof PyReferenceExpression && SyntaxMatchers.IN_IMPORT.search(element) == null) {
      final PyReferenceExpression refExpr=(PyReferenceExpression)element;
      if (refExpr.getQualifier() == null) {
        final PsiPolyVariantReference reference=refExpr.getReference();
        if (reference.resolve() == null) {
          ImportFromExistingFix fix=proposeImportFix(refExpr,reference,refExpr.getText());
          if (fix != null && fix.getCandidatesCount() == 1) {
            fix.invoke(file.getProject(),editor,file);
          }
 else {
            new AddImportAction(reference).execute();
          }
          return true;
        }
      }
    }
  }
  return false;
}
