{
  InspectionProfileManager profileManager=InspectionProfileManager.getInstance();
  InspectionProfileImpl localProfile=createProfile();
  profileManager.updateProfile(localProfile);
  ProjectInspectionProfileManagerImpl projectProfileManager=ProjectInspectionProfileManagerImpl.getInstanceImpl(getProject());
  try {
    profileManager.updateProfile(localProfile);
    InspectionProfileImpl profile=new InspectionProfileImpl(PROFILE,InspectionToolRegistrar.getInstance(),projectProfileManager,InspectionProfileImpl.getDefaultProfile(),null);
    projectProfileManager.updateProfile(profile);
    projectProfileManager.setProjectProfile(profile.getName());
    assertTrue(projectProfileManager.getCurrentProfile() == profile);
  }
  finally {
    projectProfileManager.deleteProfile(PROFILE);
  }
}
