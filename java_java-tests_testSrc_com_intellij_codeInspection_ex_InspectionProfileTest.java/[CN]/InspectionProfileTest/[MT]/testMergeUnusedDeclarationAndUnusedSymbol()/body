{
  final Element element=JdomKt.loadElement("<profile version=\"1.0\">\n" + "  <option name=\"myName\" value=\"" + PROFILE + "\" />\n"+ "</profile>");
  InspectionProfileImpl profile=createProfile(new InspectionProfileImpl("foo"));
  profile.readExternal(element);
  ModifiableModel model=profile.getModifiableModel();
  model.commit();
  assertElementsEqual(element,serializeProfile(profile));
  final Element unusedProfile=JdomKt.loadElement("<profile version=\"1.0\">\n" + "  <option name=\"myName\" value=\"" + PROFILE + "\" />\n"+ "  <inspection_tool class=\"UNUSED_SYMBOL\" enabled=\"true\" level=\"WARNING\" enabled_by_default=\"false\">\n"+ "      <option name=\"LOCAL_VARIABLE\" value=\"true\" />\n"+ "      <option name=\"FIELD\" value=\"true\" />\n"+ "      <option name=\"METHOD\" value=\"true\" />\n"+ "      <option name=\"CLASS\" value=\"true\" />\n"+ "      <option name=\"PARAMETER\" value=\"true\" />\n"+ "      <option name=\"REPORT_PARAMETER_FOR_PUBLIC_METHODS\" value=\"false\" />\n"+ "  </inspection_tool>\n"+ "  <inspection_tool class=\"UnusedDeclaration\" enabled=\"true\" level=\"WARNING\" enabled_by_default=\"false\">\n"+ "      <option name=\"ADD_MAINS_TO_ENTRIES\" value=\"true\" />\n"+ "      <option name=\"ADD_APPLET_TO_ENTRIES\" value=\"true\" />\n"+ "      <option name=\"ADD_SERVLET_TO_ENTRIES\" value=\"true\" />\n"+ "      <option name=\"ADD_NONJAVA_TO_ENTRIES\" value=\"false\" />\n"+ "   </inspection_tool>\n"+ "</profile>");
  profile.readExternal(unusedProfile);
  model=profile.getModifiableModel();
  model.commit();
  assertEquals("<profile version=\"1.0\">\n" + "  <option name=\"myName\" value=\"ToConvert\" />\n" + "  <inspection_tool class=\"UNUSED_SYMBOL\" enabled=\"true\" level=\"WARNING\" enabled_by_default=\"false\">\n"+ "    <option name=\"LOCAL_VARIABLE\" value=\"true\" />\n"+ "    <option name=\"FIELD\" value=\"true\" />\n"+ "    <option name=\"METHOD\" value=\"true\" />\n"+ "    <option name=\"CLASS\" value=\"true\" />\n"+ "    <option name=\"PARAMETER\" value=\"true\" />\n"+ "    <option name=\"REPORT_PARAMETER_FOR_PUBLIC_METHODS\" value=\"false\" />\n"+ "  </inspection_tool>\n"+ "  <inspection_tool class=\"UnusedDeclaration\" enabled=\"true\" level=\"WARNING\" enabled_by_default=\"false\">\n"+ "    <option name=\"ADD_MAINS_TO_ENTRIES\" value=\"true\" />\n"+ "    <option name=\"ADD_APPLET_TO_ENTRIES\" value=\"true\" />\n"+ "    <option name=\"ADD_SERVLET_TO_ENTRIES\" value=\"true\" />\n"+ "    <option name=\"ADD_NONJAVA_TO_ENTRIES\" value=\"false\" />\n"+ "  </inspection_tool>\n"+ "</profile>",serialize(profile));
  profile=createProfile(new InspectionProfileImpl("foo"));
  profile.readExternal(unusedProfile);
  model=profile.getModifiableModel();
  InspectionToolWrapper toolWrapper=((InspectionProfileImpl)model).getInspectionTool("unused",getProject());
  UnusedDeclarationInspectionBase tool=(UnusedDeclarationInspectionBase)toolWrapper.getTool();
  tool.ADD_NONJAVA_TO_ENTRIES=true;
  UnusedSymbolLocalInspectionBase inspectionTool=tool.getSharedLocalInspectionTool();
  inspectionTool.setParameterVisibility(PsiModifier.PUBLIC);
  model.commit();
  String mergedText="<profile version=\"1.0\">\n" + "  <option name=\"myName\" value=\"ToConvert\" />\n" + "  <inspection_tool class=\"UNUSED_SYMBOL\" enabled=\"true\" level=\"WARNING\" enabled_by_default=\"false\">\n"+ "    <option name=\"LOCAL_VARIABLE\" value=\"true\" />\n"+ "    <option name=\"FIELD\" value=\"true\" />\n"+ "    <option name=\"METHOD\" value=\"true\" />\n"+ "    <option name=\"CLASS\" value=\"true\" />\n"+ "    <option name=\"PARAMETER\" value=\"true\" />\n"+ "    <option name=\"REPORT_PARAMETER_FOR_PUBLIC_METHODS\" value=\"false\" />\n"+ "  </inspection_tool>\n"+ "  <inspection_tool class=\"UnusedDeclaration\" enabled=\"true\" level=\"WARNING\" enabled_by_default=\"false\">\n"+ "    <option name=\"ADD_MAINS_TO_ENTRIES\" value=\"true\" />\n"+ "    <option name=\"ADD_APPLET_TO_ENTRIES\" value=\"true\" />\n"+ "    <option name=\"ADD_SERVLET_TO_ENTRIES\" value=\"true\" />\n"+ "    <option name=\"ADD_NONJAVA_TO_ENTRIES\" value=\"false\" />\n"+ "  </inspection_tool>\n"+ "  <inspection_tool class=\"unusedMerged\" />\n"+ "</profile>";
  assertEquals(mergedText,serialize(profile));
  Element toImportElement=serializeProfile(profile);
  final InspectionProfileImpl importedProfile=InspectionToolsConfigurable.importInspectionProfile(toImportElement,InspectionProfileManager.getInstance(),getProject(),null);
  Element mergedElement=JDOMUtil.loadDocument(mergedText).getRootElement();
  profile=createProfile(new InspectionProfileImpl("foo"));
  profile.readExternal(mergedElement);
  model=profile.getModifiableModel();
  model.commit();
  assertElementsEqual(mergedElement,serializeProfile(profile));
  assertElementsEqual(mergedElement,serializeProfile(importedProfile));
}
