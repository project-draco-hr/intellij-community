{
  DomInvocationHandler handler=myManager.getDomHandler(element);
  if (handler == null || handler.getAnnotation(Stubbed.class) == null && !handler.getChildDescription().isStubbed())   return;
  AbstractDomChildrenDescription description=handler.getChildDescription();
  String nsKey=description instanceof DomChildrenDescription ? ((DomChildrenDescription)description).getXmlName().getNamespaceKey() : "";
  if (element instanceof XmlTag) {
    XmlTag tag=(XmlTag)element;
    ElementStub stub=new ElementStub(parent,StringRef.fromString(tag.getName()),StringRef.fromNullableString(nsKey),index,description instanceof CustomDomChildrenDescription);
    if (handler.getAnnotation(StubbedOccurrence.class) != null) {
      final Type type=description.getType();
      stub.setElementClass((Class)type);
    }
    for (    XmlAttribute attribute : tag.getAttributes()) {
      visitXmlElement(attribute,stub,0);
    }
    Map<String,Integer> indices=new HashMap<String,Integer>();
    for (    final XmlTag subTag : tag.getSubTags()) {
      String name=subTag.getName();
      Integer i=indices.get(name);
      i=i == null ? 0 : i + 1;
      visitXmlElement(subTag,stub,i);
      indices.put(name,i);
    }
  }
 else   if (element instanceof XmlAttribute) {
    new AttributeStub(parent,StringRef.fromString(((XmlAttribute)element).getLocalName()),StringRef.fromNullableString(nsKey),((XmlAttribute)element).getValue());
  }
}
