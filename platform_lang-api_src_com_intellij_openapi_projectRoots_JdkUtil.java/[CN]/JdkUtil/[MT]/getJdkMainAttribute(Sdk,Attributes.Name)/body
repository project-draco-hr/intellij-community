{
  VirtualFile homeDirectory=jdk.getHomeDirectory();
  VirtualFile rtJar=null;
  if (homeDirectory != null) {
    rtJar=homeDirectory.findFileByRelativePath("jre/lib/rt.jar");
    if (rtJar == null)     rtJar=homeDirectory.findFileByRelativePath("lib/rt.jar");
    if (rtJar == null)     rtJar=homeDirectory.findFileByRelativePath("jre/lib/vm.jar");
    if (rtJar == null)     rtJar=homeDirectory.findFileByRelativePath("../Classes/classes.jar");
  }
  if (rtJar == null) {
    if (attribute == Attributes.Name.IMPLEMENTATION_VERSION) {
      String versionString=jdk.getVersionString();
      if (versionString != null) {
        final int start=versionString.indexOf("\"");
        final int end=versionString.lastIndexOf("\"");
        versionString=start >= 0 && (end > start) ? versionString.substring(start + 1,end) : null;
      }
      return versionString;
    }
 else {
      return null;
    }
  }
  VirtualFile jarRoot=JarFileSystem.getInstance().getJarRootForLocalFile(rtJar);
  return jarRoot != null ? getJarMainAttribute(jarRoot,attribute) : null;
}
