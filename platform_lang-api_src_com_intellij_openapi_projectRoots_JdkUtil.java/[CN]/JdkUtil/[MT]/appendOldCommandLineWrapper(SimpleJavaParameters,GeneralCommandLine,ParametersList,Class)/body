{
  File classpathFile=null;
  File vmParamsFile=null;
  if (javaParameters.isDynamicVMOptions() && useDynamicVMOptions()) {
    try {
      vmParamsFile=FileUtil.createTempFile("vm_params",null);
      final PrintWriter writer=new PrintWriter(vmParamsFile);
      try {
        for (        String param : vmParametersList.getList()) {
          if (param.startsWith("-D")) {
            writer.println(param);
          }
        }
      }
  finally {
        writer.close();
      }
    }
 catch (    IOException e) {
      LOG.error(e);
    }
    final List<String> list=vmParametersList.getList();
    for (    String param : list) {
      if (!param.trim().startsWith("-D")) {
        commandLine.addParameter(param);
      }
    }
  }
 else {
    commandLine.addParameters(vmParametersList.getList());
  }
  try {
    classpathFile=FileUtil.createTempFile("classpath",null);
    final PrintWriter writer=new PrintWriter(classpathFile);
    try {
      for (      String path : javaParameters.getClassPath().getPathList()) {
        writer.println(path);
      }
    }
  finally {
      writer.close();
    }
    String classpath=PathUtil.getJarPathForClass(commandLineWrapper);
    final String utilRtPath=PathUtil.getJarPathForClass(StringUtilRt.class);
    if (!classpath.equals(utilRtPath)) {
      classpath+=File.pathSeparator + utilRtPath;
    }
    final Class<UrlClassLoader> ourUrlClassLoader=UrlClassLoader.class;
    if (ourUrlClassLoader.getName().equals(vmParametersList.getPropertyValue("java.system.class.loader"))) {
      classpath+=File.pathSeparator + PathUtil.getJarPathForClass(ourUrlClassLoader);
      classpath+=File.pathSeparator + PathUtil.getJarPathForClass(THashMap.class);
    }
    commandLine.addParameter("-classpath");
    commandLine.addParameter(classpath);
  }
 catch (  IOException e) {
    LOG.error(e);
  }
  appendEncoding(javaParameters,commandLine,vmParametersList);
  if (classpathFile != null) {
    commandLine.addParameter(commandLineWrapper.getName());
    commandLine.addParameter(classpathFile.getAbsolutePath());
  }
  if (vmParamsFile != null) {
    commandLine.addParameter("@vm_params");
    commandLine.addParameter(vmParamsFile.getAbsolutePath());
  }
}
