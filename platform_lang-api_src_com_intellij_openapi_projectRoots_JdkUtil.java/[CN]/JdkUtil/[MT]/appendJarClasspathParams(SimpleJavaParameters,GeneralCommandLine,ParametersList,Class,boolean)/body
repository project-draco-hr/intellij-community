{
  try {
    final Manifest manifest=new Manifest();
    manifest.getMainAttributes().putValue("Created-By",ApplicationNamesInfo.getInstance().getFullProductName());
    final boolean writeDynamicVMOptions=javaParameters.isDynamicVMOptions() && useDynamicVMOptions();
    if (writeDynamicVMOptions) {
      List<String> dParams=new ArrayList<>();
      for (      String param : vmParametersList.getList()) {
        if (param.startsWith("-D")) {
          dParams.add(param);
        }
      }
      manifest.getMainAttributes().putValue("VM-Options",ParametersListUtil.join(dParams));
      final List<String> restParams=new ArrayList<>(vmParametersList.getList());
      restParams.removeAll(dParams);
      commandLine.addParameters(restParams);
    }
 else {
      commandLine.addParameters(vmParametersList.getList());
    }
    if (storeProgramParametersInJar) {
      manifest.getMainAttributes().putValue("Program-Parameters",ParametersListUtil.join(javaParameters.getProgramParametersList().getList()));
    }
    final boolean notEscape=vmParametersList.hasParameter(PROPERTY_DO_NOT_ESCAPE_CLASSPATH_URL);
    final List<String> classPathList=javaParameters.getClassPath().getPathList();
    final File classpathJarFile=CommandLineWrapperUtil.createClasspathJarFile(manifest,classPathList,notEscape);
    getFilesToDeleteUserData(commandLine).add(classpathJarFile);
    final String jarFile=classpathJarFile.getAbsolutePath();
    commandLine.addParameter("-classpath");
    if (writeDynamicVMOptions || storeProgramParametersInJar) {
      commandLine.addParameter(PathUtil.getJarPathForClass(commandLineWrapper) + File.pathSeparator + jarFile);
      appendEncoding(javaParameters,commandLine,vmParametersList);
      commandLine.addParameter(commandLineWrapper.getName());
      commandLine.addParameter(jarFile);
    }
 else {
      commandLine.addParameters(jarFile);
      appendEncoding(javaParameters,commandLine,vmParametersList);
    }
  }
 catch (  IOException e) {
    LOG.info(e);
    throwUnableToCreateTempFile();
  }
}
