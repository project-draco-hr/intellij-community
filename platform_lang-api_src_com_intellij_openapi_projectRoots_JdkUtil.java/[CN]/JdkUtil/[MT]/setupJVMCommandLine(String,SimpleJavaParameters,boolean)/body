{
  final GeneralCommandLine commandLine=new GeneralCommandLine(exePath);
  final ParametersList vmParametersList=javaParameters.getVMParametersList();
  commandLine.withEnvironment(javaParameters.getEnv());
  commandLine.withParentEnvironmentType(javaParameters.isPassParentEnvs() ? ParentEnvironmentType.CONSOLE : ParentEnvironmentType.NONE);
  final Class commandLineWrapper;
  boolean passProgramParametersViaClassPathJar=false;
  if ((commandLineWrapper=getCommandLineWrapperClass()) != null) {
    if (forceDynamicClasspath && !vmParametersList.hasParameter("-classpath") && !vmParametersList.hasParameter("-cp")) {
      if (isClassPathJarEnabled(javaParameters,PathUtil.getJarPathForClass(ClassPath.class))) {
        passProgramParametersViaClassPathJar=javaParameters.isPassProgramParametersViaClasspathJar();
        appendJarClasspathParams(javaParameters,commandLine,vmParametersList,commandLineWrapper,passProgramParametersViaClassPathJar);
      }
 else {
        appendOldCommandLineWrapper(javaParameters,commandLine,vmParametersList,commandLineWrapper);
      }
    }
 else {
      appendParamsEncodingClasspath(javaParameters,commandLine,vmParametersList);
    }
  }
 else {
    appendParamsEncodingClasspath(javaParameters,commandLine,vmParametersList);
  }
  final String mainClass=javaParameters.getMainClass();
  final String jarPath=javaParameters.getJarPath();
  if (mainClass != null) {
    commandLine.addParameter(mainClass);
  }
 else   if (jarPath != null) {
    commandLine.addParameter("-jar");
    commandLine.addParameter(jarPath);
  }
  if (!passProgramParametersViaClassPathJar) {
    commandLine.addParameters(javaParameters.getProgramParametersList().getList());
  }
  commandLine.withWorkDirectory(javaParameters.getWorkingDirectory());
  return commandLine;
}
