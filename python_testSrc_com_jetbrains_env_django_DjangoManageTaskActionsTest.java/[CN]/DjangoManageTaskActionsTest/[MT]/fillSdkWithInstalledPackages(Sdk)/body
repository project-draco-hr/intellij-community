{
  final List<PyPackage> packages=((PyPackageManagerImpl)PyPackageManager.getInstance(sdk)).getPackages();
  final Set<String> packagePaths=new HashSet<String>();
  for (  final PyPackage aPackage : packages) {
    final String location=aPackage.getLocation();
    if (location != null) {
      packagePaths.add(location);
    }
  }
  final SdkModificator modificator=sdk.getSdkModificator();
  final LocalFileSystem fileSystem=LocalFileSystem.getInstance();
  for (  final String path : packagePaths) {
    final VirtualFile virtualFile=fileSystem.findFileByPath(path);
    if (virtualFile == null) {
      throw new IllegalStateException("Failed to read file " + path);
    }
    modificator.addRoot(virtualFile,OrderRootType.CLASSES);
  }
  modificator.commitChanges();
}
