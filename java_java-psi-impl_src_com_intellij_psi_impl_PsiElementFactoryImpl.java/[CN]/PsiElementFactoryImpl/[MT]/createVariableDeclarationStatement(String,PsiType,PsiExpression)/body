{
  if (!isIdentifier(name)) {
    throw new IncorrectOperationException("\"" + name + "\" is not an identifier.");
  }
  if (PsiType.NULL.equals(type)) {
    throw new IncorrectOperationException("Cannot create variable with type \"null\".");
  }
  String text="X " + name + (initializer != null ? " = x" : "")+ ";";
  PsiDeclarationStatement statement=(PsiDeclarationStatement)createStatementFromText(text,null);
  PsiVariable variable=(PsiVariable)statement.getDeclaredElements()[0];
  replace(variable.getTypeElement(),createTypeElement(type),text);
  boolean generateFinalLocals=JavaCodeStyleSettingsFacade.getInstance(myManager.getProject()).isGenerateFinalLocals();
  PsiUtil.setModifierProperty(variable,PsiModifier.FINAL,generateFinalLocals);
  if (initializer != null) {
    replace(variable.getInitializer(),initializer,text);
  }
  GeneratedMarkerVisitor.markGenerated(statement);
  return statement;
}
