{
  if (blockOutputStream.size() == 0) {
    return;
  }
  writeInt(nextSequenceNumber++);
  byte[] buffer=blockOutputStream.toByteArray();
  md.update(buffer);
  outputStream.write(md.digest());
  writeInt(buffer.length);
  outputStream.write(buffer);
  outputStream.flush();
  blockOutputStream.reset();
}
