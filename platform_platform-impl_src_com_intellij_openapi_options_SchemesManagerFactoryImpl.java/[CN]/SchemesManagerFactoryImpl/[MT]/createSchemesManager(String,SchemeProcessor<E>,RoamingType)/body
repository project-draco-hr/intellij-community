{
  final Application application=ApplicationManager.getApplication();
  if (!(application instanceof ApplicationImpl)) {
    return null;
  }
  IApplicationStore applicationStore=((ApplicationImpl)application).getStateStore();
  String baseDirPath=applicationStore.getStateStorageManager().expandMacros(fileSpec);
  StreamProvider provider=applicationStore.getStateStorageManager().getStreamProvider();
  SchemesManagerImpl<T,E> manager=new SchemesManagerImpl<T,E>(fileSpec,processor,roamingType,provider,new File(baseDirPath));
  myRegisteredManagers.add(manager);
  return manager;
}
