{
  PatchFileCreator.create(myOlderDir,myNewerDir,myFile,Collections.<String>emptyList(),Collections.<String>emptyList(),Collections.<String>emptyList(),TEST_UI);
  new File(myOlderDir,"bin/idea.bat").delete();
  PatchFileCreator.PreparationResult preparationResult=PatchFileCreator.prepareAndValidate(myFile,myOlderDir,TEST_UI);
  preparationResult.patch.getActions().add(new MyFailOnApplyPatchAction());
  assertNothingHasChanged(preparationResult,new HashMap<String,ValidationResult.Option>());
}
