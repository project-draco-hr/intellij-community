{
  Map<String,Long> original=Digester.digestFiles(myOlderDir,Collections.<String>emptyList(),TEST_UI);
  File backup=getTempFile("backup");
  for (  ValidationResult each : preparationResult.validationResults) {
    assertTrue(each.toString(),each.kind != ValidationResult.Kind.ERROR);
  }
  List<PatchAction> appliedActions=PatchFileCreator.apply(preparationResult,new HashMap<String,ValidationResult.Option>(),backup,TEST_UI).appliedActions;
  assertAppliedCorrectly();
  assertFalse(original.equals(Digester.digestFiles(myOlderDir,Collections.<String>emptyList(),TEST_UI)));
  PatchFileCreator.revert(preparationResult,appliedActions,backup,TEST_UI);
  assertEquals(original,Digester.digestFiles(myOlderDir,Collections.<String>emptyList(),TEST_UI));
}
