{
  if (!UtilsTest.mIsWindows)   return;
  PatchFileCreator.create(myOlderDir,myNewerDir,myFile,Collections.<String>emptyList(),Collections.<String>emptyList(),Collections.<String>emptyList(),TEST_UI);
  RandomAccessFile raf=new RandomAccessFile(new File(myOlderDir,"bin/idea.bat"),"rw");
  int b=raf.read();
  raf.seek(0);
  raf.write(b);
  try {
    PatchFileCreator.PreparationResult preparationResult=PatchFileCreator.prepareAndValidate(myFile,myOlderDir,TEST_UI);
    Map<String,Long> original=Digester.digestFiles(myOlderDir,Collections.<String>emptyList(),TEST_UI);
    File backup=getTempFile("backup");
    PatchFileCreator.apply(preparationResult,new HashMap<String,ValidationResult.Option>(),backup,TEST_UI);
    assertEquals(original,Digester.digestFiles(myOlderDir,Collections.<String>emptyList(),TEST_UI));
  }
  finally {
    raf.close();
  }
}
