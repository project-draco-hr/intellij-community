{
  if (!UtilsTest.mIsWindows)   return;
  Patch patch=PatchFileCreator.create(myPatchSpec,myFile,TEST_UI);
  RandomAccessFile raf=new RandomAccessFile(new File(myOlderDir,"bin/idea.bat"),"rw");
  try {
    int b=raf.read();
    raf.seek(0);
    raf.write(b);
    PatchFileCreator.PreparationResult preparationResult=PatchFileCreator.prepareAndValidate(myFile,myOlderDir,TEST_UI);
    Map<String,Long> original=patch.digestFiles(myOlderDir,Collections.<String>emptyList(),false,TEST_UI);
    File backup=getTempFile("backup");
    PatchFileCreator.apply(preparationResult,new HashMap<String,ValidationResult.Option>(),backup,TEST_UI);
    assertEquals(original,patch.digestFiles(myOlderDir,Collections.<String>emptyList(),false,TEST_UI));
  }
  finally {
    raf.close();
  }
}
