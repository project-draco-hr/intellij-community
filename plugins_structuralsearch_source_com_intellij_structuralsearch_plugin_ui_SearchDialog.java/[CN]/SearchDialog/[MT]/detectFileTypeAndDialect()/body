{
  final PsiFile file=searchContext.getFile();
  if (file != null) {
    PsiElement context=null;
    if (searchContext.getEditor() != null) {
      context=file.findElementAt(searchContext.getEditor().getCaretModel().getOffset());
      if (context != null) {
        context=context.getParent();
      }
    }
    if (context == null) {
      context=file;
    }
    FileType detectedFileType=null;
    StructuralSearchProfile profile=StructuralSearchUtil.getProfileByPsiElement(context);
    if (profile != null) {
      FileType fileType=profile.detectFileType(context);
      if (fileType != null) {
        detectedFileType=fileType;
      }
    }
    if (detectedFileType == null) {
      for (      FileType fileType : StructuralSearchUtil.getSuitableFileTypes()) {
        if (fileType instanceof LanguageFileType && ((LanguageFileType)fileType).getLanguage().equals(context.getLanguage())) {
          detectedFileType=fileType;
          break;
        }
      }
    }
    ourFtSearchVariant=detectedFileType != null ? detectedFileType : StructuralSearchUtil.getDefaultFileType();
  }
}
