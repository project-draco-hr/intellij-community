{
  final Project project=e.getProject();
  Module module=LangDataKeys.MODULE.getData(e.getDataContext());
  if (project == null || module == null) {
    return;
  }
  final PsiFile file=CommonDataKeys.PSI_FILE.getData(e.getDataContext());
  if (file == null) {
    return;
  }
  Course course=StudyTaskManager.getInstance(project).getCourse();
  if (course == null) {
    return;
  }
  VirtualFile virtualFile=file.getVirtualFile();
  TaskFile taskFile=StudyUtils.getTaskFile(project,virtualFile);
  if (taskFile == null) {
    return;
  }
  final PsiDirectory taskDir=file.getContainingDirectory();
  if (taskDir == null) {
    return;
  }
  PsiDirectory lessonDir=taskDir.getParentDirectory();
  if (lessonDir == null) {
    return;
  }
  if (taskFile.getAnswerPlaceholders().isEmpty()) {
    Messages.showInfoMessage("Preview is available for task files with answer placeholders only","No Preview for This File");
    return;
  }
  VirtualFile generatedFilesFolder=CCUtils.getGeneratedFilesFolder(project,module);
  if (generatedFilesFolder == null) {
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      Pair<VirtualFile,TaskFile> pair=EduUtils.createStudentFile(this,project,virtualFile,generatedFilesFolder,null);
      if (pair != null) {
        showPreviewDialog(project,pair.getFirst(),pair.getSecond());
      }
    }
  }
);
}
