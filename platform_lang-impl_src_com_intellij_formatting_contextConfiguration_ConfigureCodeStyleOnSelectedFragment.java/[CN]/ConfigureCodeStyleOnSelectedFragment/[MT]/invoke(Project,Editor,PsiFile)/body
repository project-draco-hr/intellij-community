{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      SelectionModel model=editor.getSelectionModel();
      CodeStyleManager.getInstance(project).reformatRange(file,model.getSelectionStart(),model.getSelectionEnd());
    }
  }
);
  CodeStyleSettingsToShow settingsToShow=calculateAffectingSettings(editor,file);
  CodeStyleSettings settings=CodeStyleSettingsManager.getSettings(project);
  new FragmentCodeStyleSettingsDialog(project,editor,file,settings,settingsToShow).show();
}
