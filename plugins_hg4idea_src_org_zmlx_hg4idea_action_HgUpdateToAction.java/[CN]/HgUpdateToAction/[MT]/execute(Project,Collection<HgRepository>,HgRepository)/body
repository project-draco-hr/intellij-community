{
  final HgUpdateToDialog dialog=new HgUpdateToDialog(project,repositories,selectedRepo);
  if (dialog.showAndGet()) {
    FileDocumentManager.getInstance().saveAllDocuments();
    final String updateToValue=StringUtil.escapeBackSlashes(dialog.getTargetValue());
    final boolean clean=dialog.isRemoveLocalChanges();
    final VirtualFile root=dialog.getRepository().getRoot();
    new Task.Backgroundable(project,HgVcsMessages.message("hg4idea.progress.updatingTo",updateToValue)){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        updateTo(project,root,updateToValue,clean);
      }
    }
.queue();
  }
}
