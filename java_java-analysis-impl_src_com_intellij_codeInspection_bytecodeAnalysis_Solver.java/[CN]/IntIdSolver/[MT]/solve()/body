{
  while (!moving.empty()) {
    int id=moving.pop();
    Value value=solved.get(id);
    int[] dIds=dependencies.get(id);
    for (    int dId : dIds) {
      IntIdPending pend=pending.remove(dId);
      if (pend != null) {
        IntIdResult pend1=substitute(pend,id,value);
        if (pend1 instanceof IntIdFinal) {
          IntIdFinal fi=(IntIdFinal)pend1;
          solved.put(dId,fi.value);
          moving.push(dId);
        }
 else {
          pending.put(dId,(IntIdPending)pend1);
        }
      }
    }
  }
  pending.clear();
  return solved;
}
