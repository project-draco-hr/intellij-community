{
  String name=getName();
  final PyClassStub stub=getStub();
  PsiElement ancestor=stub != null ? stub.getParentStub().getPsi() : getParent();
  while (!(ancestor instanceof PsiFile)) {
    if (ancestor == null)     return name;
    if (ancestor instanceof PyClass) {
      name=((PyClass)ancestor).getName() + "." + name;
    }
    ancestor=stub != null ? ((StubBasedPsiElement)ancestor).getStub().getParentStub().getPsi() : ancestor.getParent();
  }
  PsiFile psiFile=((PsiFile)ancestor).getOriginalFile();
  final PyFile builtins=PyBuiltinCache.getInstance(this).getBuiltinsFile();
  if (!psiFile.equals(builtins)) {
    VirtualFile vFile=psiFile.getVirtualFile();
    if (vFile != null) {
      final String packageName=QualifiedNameFinder.findShortestImportableName(this,vFile);
      return packageName + "." + name;
    }
  }
  return name;
}
