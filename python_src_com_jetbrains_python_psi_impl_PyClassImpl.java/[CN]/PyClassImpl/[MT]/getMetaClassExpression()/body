{
  final LanguageLevel level=LanguageLevel.forElement(this);
  if (level.isAtLeast(LanguageLevel.PYTHON30)) {
    for (    PyExpression expression : getSuperClassExpressions()) {
      if (expression instanceof PyKeywordArgument) {
        final PyKeywordArgument argument=(PyKeywordArgument)expression;
        if (PyNames.METACLASS.equals(argument.getKeyword())) {
          return argument.getValueExpression();
        }
      }
    }
  }
 else {
    final PyTargetExpression attribute=findClassAttribute(PyNames.DUNDER_METACLASS,false);
    if (attribute != null) {
      return attribute;
    }
    final PsiFile file=getContainingFile();
    if (file instanceof PyFile) {
      final PyFile pyFile=(PyFile)file;
      final PsiElement element=pyFile.getElementNamed(PyNames.DUNDER_METACLASS);
      if (element instanceof PyExpression) {
        return (PyExpression)element;
      }
    }
  }
  return null;
}
