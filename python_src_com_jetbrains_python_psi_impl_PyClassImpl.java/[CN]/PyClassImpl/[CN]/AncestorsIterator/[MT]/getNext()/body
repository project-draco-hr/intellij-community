{
  iterations:   while (true) {
    if (prefetch != null) {
      PyClassRef ret=prefetch;
      prefetch=null;
      return ret;
    }
    if (percolator.hasNext()) {
      PyClassRef it=percolator.next();
      if (seen.contains(it)) {
        continue iterations;
      }
      pending.add(it);
      seen.add(it);
      return it;
    }
 else {
      while (pending.size() > 0) {
        PyClassRef it=pending.get(0);
        pending.remove(0);
        PyClass pyClass=it.getPyClass();
        if (pyClass != null) {
          percolator=new AncestorsIterator((PyClassImpl)pyClass,new HashSet<PyClassRef>(seen));
          continue iterations;
        }
      }
      return null;
    }
  }
}
