{
  int startOffset=editor.getCaretModel().getOffset();
  if (editor.getSelectionModel().hasSelection()) {
    startOffset=editor.getSelectionModel().getSelectionStart();
  }
  file=insertDummyIdentifier(editor,file);
  ArrayList<TemplateImpl> list=new ArrayList<TemplateImpl>();
  for (  TemplateImpl template : TemplateSettings.getInstance().getTemplates()) {
    if (!template.isDeactivated() && (!selectionOnly || template.isSelectionTemplate()) && TemplateManagerImpl.isApplicable(file,startOffset,template)) {
      list.add(template);
    }
  }
  return list;
}
