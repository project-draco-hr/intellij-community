{
  final SearchScope searchScope=singleRequest.searchScope;
  final boolean ignoreInjectedPsi=searchScope instanceof LocalSearchScope && ((LocalSearchScope)searchScope).isIgnoreInjectedPsi();
  final RequestResultProcessor wrapped=singleRequest.processor;
  return new TextOccurenceProcessor(){
    @Override public boolean execute(    @NotNull PsiElement element,    int offsetInElement){
      if (ignoreInjectedPsi && element instanceof PsiLanguageInjectionHost)       return true;
      try {
        return wrapped.processTextOccurrence(element,offsetInElement,consumer);
      }
 catch (      ProcessCanceledException e) {
        throw e;
      }
catch (      Exception e) {
        LOG.error(e);
        return true;
      }
catch (      Error e) {
        LOG.error(e);
        return true;
      }
    }
    @Override public String toString(){
      return consumer.toString();
    }
  }
;
}
