{
  ReferenceQueue<Object> q=new ReferenceQueue<Object>();
  SoftReference<Object> ref=new SoftReference<Object>(new Object(),q);
  ArrayList<SoftReference<?>> list=ContainerUtil.newArrayListWithCapacity(100 + useReference(ref));
  System.gc();
  final long freeMemory=Runtime.getRuntime().freeMemory();
  for (int i=0; i < 100; i++) {
    if (q.poll() != null) {
      break;
    }
    int bytes=Math.min((int)(freeMemory * 0.45),Integer.MAX_VALUE / 2);
    list.add(new SoftReference<byte[]>(new byte[bytes]));
  }
  list.ensureCapacity(list.size() + useReference(ref));
  for (  SoftReference createdReference : list)   createdReference.clear();
}
