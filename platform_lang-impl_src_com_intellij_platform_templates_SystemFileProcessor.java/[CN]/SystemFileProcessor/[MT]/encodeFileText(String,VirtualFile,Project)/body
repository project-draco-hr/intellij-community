{
  final String fileName=file.getName();
  if (file.getParent().getName().equals(Project.DIRECTORY_STORE_FOLDER) && fileName.equals("workspace.xml")) {
    List<Object> componentList=new ArrayList<>();
    for (    String componentName : COMPONENT_NAMES) {
      Object component=project.getComponent(componentName);
      if (component == null) {
        try {
          Class<?> aClass=Class.forName(componentName);
          component=project.getComponent(aClass);
          if (component == null) {
            component=ServiceManager.getService(project,aClass);
          }
        }
 catch (        ClassNotFoundException ignore) {
        }
      }
      ContainerUtil.addIfNotNull(componentList,component);
    }
    if (!componentList.isEmpty()) {
      final Element root=new Element("project");
      for (      final Object component : componentList) {
        final Element element=new Element("component");
        element.setAttribute("name",ComponentManagerImpl.getComponentName(component));
        root.addContent(element);
        UIUtil.invokeAndWaitIfNeeded(new Runnable(){
          @Override public void run(){
            if (component instanceof JDOMExternalizable) {
              try {
                ((JDOMExternalizable)component).writeExternal(element);
              }
 catch (              WriteExternalException ignore) {
                LOG.error(ignore);
              }
            }
 else             if (component instanceof PersistentStateComponent) {
              Object state=((PersistentStateComponent)component).getState();
              if (state == null) {
                return;
              }
              Element element1=state instanceof Element ? (Element)state : XmlSerializer.serialize(state);
              element.addContent(element1.cloneContent());
              element.setAttribute("name",StoreUtil.getStateSpec((PersistentStateComponent)component).name());
            }
          }
        }
);
      }
      PathMacroManager.getInstance(project).collapsePaths(root);
      return JDOMUtil.writeElement(root);
    }
  }
  return null;
}
