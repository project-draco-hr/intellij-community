{
  String broHash=pushCommitFromBro();
  cd(myRepository);
  String hash=makeCommit("file.txt");
  agreeToUpdate(GitRejectedPushUpdateDialog.MERGE_EXIT_CODE);
  GitPushResult result=push("master","origin/master");
  cd(myRepository);
  String log=git("log -3 --pretty=%H#%s");
  String[] commits=StringUtil.splitByLines(log);
  String lastCommitMsg=commits[0].split("#")[1];
  assertTrue("The last commit doesn't look like a merge commit: " + lastCommitMsg,lastCommitMsg.contains("Merge"));
  assertEquals(hash,commits[1].split("#")[0]);
  assertEquals(broHash,commits[2].split("#")[0]);
  assertResult(SUCCESS,2,"master","origin/master",GitUpdateResult.SUCCESS,Collections.singletonList("bro.txt"),result);
}
