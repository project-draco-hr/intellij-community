{
  final PyFunction problemFunction=PsiTreeUtil.getParentOfType(descriptor.getPsiElement(),PyFunction.class);
  if (problemFunction == null)   return;
  final StringBuilder superCall=new StringBuilder();
  final PyClass klass=problemFunction.getContainingClass();
  if (klass == null)   return;
  final PyClass[] superClasses=klass.getSuperClasses();
  if (superClasses.length == 0)   return;
  final PyClass superClass=superClasses[0];
  final PyFunction superInit=superClass.findMethodByName(PyNames.INIT,true);
  if (superInit == null)   return;
  boolean addComma=true;
  if (klass.isNewStyleClass()) {
    addComma=false;
    if (LanguageLevel.forElement(klass).isPy3K()) {
      superCall.append("super().__init__(");
    }
 else {
      superCall.append("super(").append(klass.getName()).append(", self).__init__(");
    }
  }
 else {
    superCall.append(superClass.getName());
    superCall.append(".__init__(self");
  }
  final StringBuilder newFunction=new StringBuilder("def __init__(self");
  buildParameterList(problemFunction,superInit,superCall,newFunction,addComma);
  superCall.append(")");
  final PyStatementList statementList=problemFunction.getStatementList();
  PyExpression docstring=null;
  final PyStatement[] statements=statementList.getStatements();
  if (statements.length != 0 && statements[0] instanceof PyExpressionStatement) {
    final PyExpressionStatement st=(PyExpressionStatement)statements[0];
    if (st.getExpression() instanceof PyStringLiteralExpression) {
      docstring=st.getExpression();
    }
  }
  newFunction.append("):\n\t");
  if (docstring != null) {
    newFunction.append(docstring.getText()).append("\n\t");
  }
  newFunction.append(superCall).append("\n\t");
  boolean first=true;
  for (  PyStatement statement : statements) {
    if (first && docstring != null || statement instanceof PyPassStatement) {
      first=false;
      continue;
    }
    newFunction.append(statement.getText()).append("\n\t");
  }
  final PyElementGenerator generator=PyElementGenerator.getInstance(project);
  problemFunction.replace(generator.createFromText(LanguageLevel.forElement(problemFunction),PyFunction.class,newFunction.toString()));
}
