{
  if (myReference != null) {
    final PsiElement element=myReference.getElement();
    if (element != null && element.isValid()) {
      if (myReferenceRangeMarker == null) {
        return myReference;
      }
      final PsiReference reference=checkReferenceRange(element,new Function<Integer,PsiReference>(){
        @Override public PsiReference fun(        Integer start){
          return myReference;
        }
      }
);
      if (reference != null) {
        return reference;
      }
    }
  }
  if (myReferenceRangeMarker == null)   return null;
  final PsiElement element=getElement();
  if (element == null || !element.isValid()) {
    return null;
  }
  return checkReferenceRange(element,new Function<Integer,PsiReference>(){
    @Override public PsiReference fun(    Integer start){
      return element.findReferenceAt(start);
    }
  }
);
}
