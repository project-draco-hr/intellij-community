{
  Project project=e.getProject();
  VcsLog log=e.getData(VcsLogDataKeys.VCS_LOG);
  if (project == null || log == null) {
    e.getPresentation().setEnabledAndVisible(false);
    return;
  }
  List<VcsFullCommitDetails> selectedDetails=log.getSelectedDetails();
  if (selectedDetails.isEmpty()) {
    e.getPresentation().setEnabledAndVisible(false);
  }
 else {
    VcsFullCommitDetails details=ContainerUtil.getFirstItem(selectedDetails);
    if (details == null || details instanceof LoadingDetails) {
      e.getPresentation().setEnabledAndVisible(false);
    }
 else {
      Repo repository=getRepositoryForRoot(project,details.getRoot());
      if (repository == null) {
        e.getPresentation().setEnabledAndVisible(false);
      }
 else {
        e.getPresentation().setVisible(isVisible(project,repository,details));
        e.getPresentation().setEnabled(selectedDetails.size() == 1 && isEnabled(repository,details));
      }
    }
  }
}
