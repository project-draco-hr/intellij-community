{
  LOG.debug("URI is " + method.getURI());
  String responseBody;
  getHttpClient().executeMethod(method);
  Header contentType=method.getResponseHeader("Content-Type");
  if (contentType != null && contentType.getValue().contains("charset")) {
    responseBody=StringUtil.notNullize(method.getResponseBodyAsString());
  }
 else {
    InputStream stream=method.getResponseBodyAsStream();
    responseBody=stream == null ? "" : StreamUtil.readText(stream,"utf-8");
  }
switch (getResponseType()) {
case XML:
    TaskUtil.prettyFormatXmlToLog(LOG,responseBody);
  break;
case JSON:
TaskUtil.prettyFormatJsonToLog(LOG,responseBody);
break;
default :
LOG.debug(responseBody);
}
LOG.debug("Status code is " + method.getStatusCode());
if (method.getStatusCode() != HttpStatus.SC_OK) {
throw new Exception("Request failed with HTTP error: " + method.getStatusText());
}
return responseBody;
}
