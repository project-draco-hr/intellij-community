{
  String responseBody;
  getHttpClient().executeMethod(method);
  Header contentType=method.getResponseHeader("Content-Type");
  if (contentType != null && contentType.getValue().contains("charset")) {
    responseBody=StringUtil.notNullize(method.getResponseBodyAsString());
  }
 else {
    InputStream stream=method.getResponseBodyAsStream();
    responseBody=stream == null ? "" : StreamUtil.readText(stream,CharsetToolkit.UTF8_CHARSET);
  }
  if (method.getStatusCode() != HttpStatus.SC_OK) {
    throw new Exception("Request failed with HTTP error: " + method.getStatusText());
  }
  return responseBody;
}
