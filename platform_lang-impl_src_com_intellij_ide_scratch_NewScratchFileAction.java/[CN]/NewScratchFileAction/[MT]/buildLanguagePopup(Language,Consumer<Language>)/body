{
  List<Language> languages=LanguageUtil.getFileLanguages();
  BaseListPopupStep<Language> step=new BaseListPopupStep<Language>("Choose Language",languages){
    @NotNull @Override public String getTextFor(    Language value){
      return value.getDisplayName();
    }
    @Override public boolean isSpeedSearchEnabled(){
      return true;
    }
    @Override public PopupStep onChosen(    Language selectedValue,    boolean finalChoice){
      onChoosen.consume(selectedValue);
      return null;
    }
    @Override public Icon getIconFor(    Language language){
      LanguageFileType associatedLanguage=language.getAssociatedFileType();
      return associatedLanguage != null ? associatedLanguage.getIcon() : null;
    }
  }
;
  step.setDefaultOptionIndex(Math.max(0,languages.indexOf(ObjectUtils.chooseNotNull(previous,StdLanguages.TEXT))));
  return tweakSizeToPreferred(JBPopupFactory.getInstance().createListPopup(step));
}
