{
  final Project project=e.getProject();
  if (project == null)   return;
  Language previous=ScratchpadManager.getInstance(project).getLatestLanguage();
  if (previous == null) {
    PsiFile file=e.getData(CommonDataKeys.PSI_FILE);
    if (file != null) {
      previous=file.getLanguage();
    }
  }
  ListPopup popup=buildLanguagePopup(previous,new Consumer<Language>(){
    @Override public void consume(    Language language){
      FeatureUsageTracker.getInstance().triggerFeatureUsed("scratch");
      VirtualFile file=ScratchpadManager.getInstance(project).createScratchFile(language);
      FileEditorManager.getInstance(project).openFile(file,true);
    }
  }
);
  popup.showCenteredInCurrentWindow(project);
}
