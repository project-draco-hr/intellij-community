{
  final Project project=e.getProject();
  if (project == null)   return;
  PsiFile file=e.getData(CommonDataKeys.PSI_FILE);
  Editor editor=e.getData(CommonDataKeys.EDITOR);
  Language language=getLanguageFromCaret(project,editor,file);
  String text=getSelectionText(editor);
  if (language != null && text != null) {
    openNewFile(project,language,text,false);
    return;
  }
  final Ref<Boolean> tenMinuteScratch=Ref.create(false);
  ListPopup popup=buildLanguagePopup(project,language,new Consumer<Language>(){
    @Override public void consume(    @NotNull Language language){
      openNewFile(project,language,"",tenMinuteScratch.get());
    }
  }
);
  setupShiftActions((ListPopupImpl)popup,tenMinuteScratch);
  popup.showCenteredInCurrentWindow(project);
}
