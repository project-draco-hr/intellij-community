{
  final Project project=e.getProject();
  if (project == null)   return;
  PsiFile file=e.getData(CommonDataKeys.PSI_FILE);
  Language context=file != null ? file.getLanguage() : null;
  ListPopup popup=buildLanguagePopup(project,context,new Consumer<Language>(){
    @Override public void consume(    Language language){
      FeatureUsageTracker.getInstance().triggerFeatureUsed("scratch");
      VirtualFile file=ScratchpadManager.getInstance(project).createScratchFile(language);
      FileEditorManager.getInstance(project).openFile(file,true);
    }
  }
);
  popup.showCenteredInCurrentWindow(project);
}
