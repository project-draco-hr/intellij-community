{
  final Project project=e.getProject();
  if (project == null)   return;
  Language context=null;
  PsiFile file=e.getData(CommonDataKeys.PSI_FILE);
  if (file != null) {
    context=file.getLanguage();
  }
  ListPopup popup=buildLanguagePopup(project,context,new Consumer<Language>(){
    @Override public void consume(    Language language){
      FeatureUsageTracker.getInstance().triggerFeatureUsed("scratch");
      VirtualFile file=ScratchpadManager.getInstance(project).createScratchFile(language);
      FileEditorManager.getInstance(project).openFile(file,true);
    }
  }
);
  popup.showCenteredInCurrentWindow(project);
}
