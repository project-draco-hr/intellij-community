{
  forAllPythonEnvs(getTestName(false),new Processor<Sdk>(){
    @Override public boolean process(    Sdk sdk){
      try {
        final File tempDir=FileUtil.createTempDirectory(getTestName(false),null);
        final String venvSdkHome=((PyPackageManagerImpl)PyPackageManagerImpl.getInstance(sdk)).createVirtualEnv(tempDir.toString(),false);
        final Sdk venvSdk=createTempSdk(venvSdkHome);
        assertNotNull(venvSdk);
        assertTrue(PythonSdkType.isVirtualEnv(venvSdk));
        final List<PyPackage> packages=((PyPackageManagerImpl)PyPackageManagerImpl.getInstance(venvSdk)).getPackages();
        final PyPackage distribute=findPackage("distribute",packages);
        assertNotNull(distribute);
        assertEquals("distribute",distribute.getName());
        assertEquals(DISTRIBUTE_VERSION,distribute.getVersion());
        final PyPackage pip=findPackage("pip",packages);
        assertNotNull(pip);
        assertEquals("pip",pip.getName());
        assertEquals(PIP_VERSION,pip.getVersion());
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
catch (      PyExternalProcessException e) {
        fail(String.format("Error for interpreter '%s': %s",sdk.getHomePath(),e.getMessage()));
      }
      return true;
    }
  }
);
}
