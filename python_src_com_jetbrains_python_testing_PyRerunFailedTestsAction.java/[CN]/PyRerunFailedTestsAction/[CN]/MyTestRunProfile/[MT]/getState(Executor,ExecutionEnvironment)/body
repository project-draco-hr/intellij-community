{
  final AbstractPythonRunConfiguration configuration=((AbstractPythonRunConfiguration)getPeer());
  if (configuration instanceof TestRunConfigurationReRunResponsible) {
    final Set<PsiElement> failedTestElements=new HashSet<PsiElement>();
    for (    final AbstractTestProxy proxy : getFailedTests(getProject())) {
      final Location<?> location=proxy.getLocation(getProject(),GlobalSearchScope.allScope(getProject()));
      if (location != null) {
        failedTestElements.add(location.getPsiElement());
      }
    }
    return ((TestRunConfigurationReRunResponsible)configuration).rerunTests(executor,env,failedTestElements);
  }
  return new FailedPythonTestCommandLineStateBase(configuration,env,(PythonTestCommandLineStateBase)configuration.getState(executor,env));
}
