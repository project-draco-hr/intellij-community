{
  List<MergeableLineMarkerInfo> forMerge=new ArrayList<>();
  final Iterator<LineMarkerInfo> iterator=markers.iterator();
  while (iterator.hasNext()) {
    final LineMarkerInfo marker=iterator.next();
    if (marker instanceof MergeableLineMarkerInfo) {
      iterator.remove();
      forMerge.add((MergeableLineMarkerInfo)marker);
    }
  }
  if (forMerge.isEmpty() || editor == null)   return markers;
  List<LineMarkerInfo> result=new ArrayList<>(markers);
  TIntObjectHashMap<List<MergeableLineMarkerInfo>> sameLineMarkers=new TIntObjectHashMap<>();
  for (  MergeableLineMarkerInfo info : forMerge) {
    int line=editor.getDocument().getLineNumber(info.startOffset);
    List<MergeableLineMarkerInfo> infos=sameLineMarkers.get(line);
    if (infos == null) {
      infos=new ArrayList<>();
      sameLineMarkers.put(line,infos);
    }
    infos.add(info);
  }
  for (  Object v : sameLineMarkers.getValues()) {
    List<MergeableLineMarkerInfo> infos=(List<MergeableLineMarkerInfo>)v;
    result.addAll(MergeableLineMarkerInfo.merge(infos));
  }
  return result;
}
