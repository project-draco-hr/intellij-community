{
  Project project=e.getProject();
  RegistryValue value=Registry.get(key);
  boolean v=!value.asBoolean();
  value.setValue(v);
  if (project == null)   return;
  PropertiesComponent p=PropertiesComponent.getInstance(project);
  UISettings ui=UISettings.getInstance();
  EditorSettingsExternalizable.OptionSet eo=EditorSettingsExternalizable.getInstance().getOptions();
  DaemonCodeAnalyzerSettings ds=DaemonCodeAnalyzerSettings.getInstance();
  String before="BEFORE.DISTRACTION.MODE.";
  if (v) {
    p.setValue(before + "SHOW_STATUS_BAR",String.valueOf(ui.SHOW_STATUS_BAR));
    ui.SHOW_STATUS_BAR=false;
    p.setValue(before + "SHOW_MAIN_TOOLBAR",String.valueOf(ui.SHOW_MAIN_TOOLBAR));
    ui.SHOW_MAIN_TOOLBAR=false;
    p.setValue(before + "SHOW_NAVIGATION_BAR",String.valueOf(ui.SHOW_NAVIGATION_BAR));
    ui.SHOW_NAVIGATION_BAR=false;
    p.setValue(before + "HIDE_TOOL_STRIPES",String.valueOf(ui.HIDE_TOOL_STRIPES));
    ui.HIDE_TOOL_STRIPES=true;
    p.setValue(before + "EDITOR_TAB_PLACEMENT",String.valueOf(ui.EDITOR_TAB_PLACEMENT));
    ui.EDITOR_TAB_PLACEMENT=UISettings.TABS_NONE;
    p.setValue(before + "IS_FOLDING_OUTLINE_SHOWN",String.valueOf(eo.IS_FOLDING_OUTLINE_SHOWN));
    eo.IS_FOLDING_OUTLINE_SHOWN=false;
    p.setValue(before + "IS_WHITESPACES_SHOWN",String.valueOf(eo.IS_WHITESPACES_SHOWN));
    eo.IS_WHITESPACES_SHOWN=false;
    p.setValue(before + "ARE_LINE_NUMBERS_SHOWN",String.valueOf(eo.ARE_LINE_NUMBERS_SHOWN));
    eo.ARE_LINE_NUMBERS_SHOWN=false;
    p.setValue(before + "IS_INDENT_GUIDES_SHOWN",String.valueOf(eo.IS_INDENT_GUIDES_SHOWN));
    eo.IS_INDENT_GUIDES_SHOWN=false;
    p.setValue(before + "SHOW_METHOD_SEPARATORS",String.valueOf(ds.SHOW_METHOD_SEPARATORS));
    ds.SHOW_METHOD_SEPARATORS=false;
    TogglePresentationModeAction.storeToolWindows(project);
  }
 else {
    ui.SHOW_STATUS_BAR=p.getBoolean(before + "SHOW_STATUS_BAR",true);
    ui.SHOW_MAIN_TOOLBAR=p.getBoolean(before + "SHOW_MAIN_TOOLBAR",true);
    ui.SHOW_NAVIGATION_BAR=p.getBoolean(before + "SHOW_NAVIGATION_BAR",true);
    ui.HIDE_TOOL_STRIPES=p.getBoolean(before + "HIDE_TOOL_STRIPES",true);
    ui.EDITOR_TAB_PLACEMENT=p.getOrInitInt(before + "EDITOR_TAB_PLACEMENT",SwingConstants.TOP);
    eo.IS_FOLDING_OUTLINE_SHOWN=p.getBoolean(before + "IS_FOLDING_OUTLINE_SHOWN",true);
    eo.IS_WHITESPACES_SHOWN=p.getBoolean(before + "IS_WHITESPACES_SHOWN",false);
    eo.ARE_LINE_NUMBERS_SHOWN=p.getBoolean(before + "ARE_LINE_NUMBERS_SHOWN",false);
    eo.IS_INDENT_GUIDES_SHOWN=p.getBoolean(before + "IS_INDENT_GUIDES_SHOWN",false);
    ds.SHOW_METHOD_SEPARATORS=p.getBoolean(before + "SHOW_METHOD_SEPARATORS",false);
    TogglePresentationModeAction.restoreToolWindows(project,true,false);
  }
  UISettings.getInstance().fireUISettingsChanged();
  LafManager.getInstance().updateUI();
  EditorUtil.reinitSettings();
  DaemonCodeAnalyzer.getInstance(project).settingsChanged();
  EditorFactory.getInstance().refreshAllEditors();
}
