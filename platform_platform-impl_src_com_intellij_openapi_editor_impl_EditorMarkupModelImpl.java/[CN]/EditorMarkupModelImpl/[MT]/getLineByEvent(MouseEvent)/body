{
  int line=myEditor.offsetToLogicalLine(yPositionToOffset(e.getY(),true));
  int foldingLineDecrement=0;
  FoldRegion[] regions=myEditor.getFoldingModel().getAllFoldRegions();
  for (  FoldRegion region : regions) {
    if (region.isExpanded())     continue;
    int startFoldingLine=myEditor.offsetToLogicalLine(region.getStartOffset());
    int endFoldingLine=myEditor.offsetToLogicalLine(region.getEndOffset());
    if (startFoldingLine <= line) {
      foldingLineDecrement+=endFoldingLine - startFoldingLine;
    }
  }
  return Math.min(myEditor.getVisibleLineCount(),Math.max(0,line - foldingLineDecrement));
}
