{
  if (!dimensionsAreValid) {
    recalcEditorDimensions();
  }
  Document document=myEditor.getDocument();
  int startLineNumber=end == -1 ? 0 : offsetToLine(start,document);
  int startY;
  int lineCount;
  int editorTargetHeight=Math.max(0,myEditorTargetHeight);
  if (myEditorSourceHeight < editorTargetHeight) {
    lineCount=0;
    startY=myEditorScrollbarTop + startLineNumber * myEditor.getLineHeight();
  }
 else {
    lineCount=myEditorSourceHeight / myEditor.getLineHeight();
    startY=myEditorScrollbarTop + (int)((float)startLineNumber / lineCount * editorTargetHeight);
  }
  int endY;
  int endLineNumber=offsetToLine(end,document);
  if (end == -1 || start == -1) {
    endY=Math.min(myEditorSourceHeight,editorTargetHeight);
  }
 else   if (start == end || offsetToLine(start,document) == endLineNumber) {
    endY=startY;
  }
 else   if (myEditorSourceHeight < editorTargetHeight) {
    endY=myEditorScrollbarTop + endLineNumber * myEditor.getLineHeight();
  }
 else {
    endY=myEditorScrollbarTop + (int)((float)endLineNumber / lineCount * editorTargetHeight);
  }
  if (endY < startY)   endY=startY;
  return new ProperTextRange(startY,endY);
}
