{
  final boolean subCoverageActive=coverageDataManager.isSubCoverageActive();
  PackageAnnotator.PackageCoverageInfo info;
  if (module != null) {
    final PsiDirectory[] directories=psiPackage.getDirectories(GlobalSearchScope.moduleScope(module));
    PackageAnnotator.PackageCoverageInfo result=null;
    for (    PsiDirectory directory : directories) {
      final VirtualFile virtualFile=directory.getVirtualFile();
      result=merge(result,myDirCoverageInfos.get(virtualFile));
      result=merge(result,myTestDirCoverageInfos.get(virtualFile));
    }
    return getCoverageInformationString(result,subCoverageActive);
  }
 else {
    info=myPackageCoverageInfos.get(psiPackage.getQualifiedName());
  }
  return getCoverageInformationString(info,subCoverageActive);
}
