{
  IndexDiff index=new IndexDiff(manager.git.getRepository(),Constants.HEAD,new FileTreeIterator(manager.git.getRepository()));
  boolean changed=index.diff(new JGitProgressMonitor(indicator),ProgressMonitor.UNKNOWN,ProgressMonitor.UNKNOWN,"Commit");
  if (BaseRepositoryManager.LOG.isDebugEnabled()) {
    BaseRepositoryManager.LOG.debug(indexDiffToString(index));
  }
  if (!changed || (index.getAdded().isEmpty() && index.getChanged().isEmpty() && index.getRemoved().isEmpty())) {
    if (index.getModified().isEmpty()) {
      BaseRepositoryManager.LOG.debug("Skip scheduled commit, nothing to commit");
      return;
    }
    AddCommand addCommand=null;
    for (    String path : index.getModified()) {
      if (!path.startsWith(IcsUrlBuilder.PROJECTS_DIR_NAME)) {
        if (addCommand == null) {
          addCommand=manager.git.add();
        }
        addCommand.addFilepattern(path);
      }
    }
    if (addCommand != null) {
      addCommand.call();
    }
  }
  BaseRepositoryManager.LOG.debug("Commit");
  manager.createCommitCommand().setMessage("").call();
}
