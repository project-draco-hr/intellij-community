{
  GitRepositoryManager manager=GitUtil.getRepositoryManager(project);
  Collection<GitRepository> repositories;
  if (files == null) {
    if (GitVcsSettings.getInstance(project).getSyncSetting() == DvcsBranchSync.SYNC) {
      repositories=manager.getRepositories();
    }
 else {
      repositories=Collections.singletonList(GitBranchUtil.getCurrentRepository(project));
    }
  }
 else {
    repositories=ContainerUtil.newHashSet();
    for (    VirtualFile file : files) {
      GitRepository repo=manager.getRepositoryForFile(file);
      if (repo != null) {
        repositories.add(repo);
      }
    }
  }
  return repositories;
}
