{
  if (myAddSupportPanel.hasSelectedFrameworks()) {
    if (!myAddSupportPanel.downloadLibraries()) {
      int answer=Messages.showYesNoDialog(myAddSupportPanel.getMainPanel(),ProjectBundle.message("warning.message.some.required.libraries.wasn.t.downloaded"),CommonBundle.getWarningTitle(),Messages.getWarningIcon());
      if (answer != Messages.YES) {
        return;
      }
    }
    DumbService.allowStartingDumbModeInside(DumbModePermission.MAY_START_BACKGROUND,new Runnable(){
      @Override public void run(){
        new WriteAction(){
          protected void run(          @NotNull final Result result){
            ModifiableRootModel model=ModuleRootManager.getInstance(myModule).getModifiableModel();
            myAddSupportPanel.addSupport(myModule,model);
            model.commit();
          }
        }
.execute();
      }
    }
);
  }
  super.doOKAction();
}
