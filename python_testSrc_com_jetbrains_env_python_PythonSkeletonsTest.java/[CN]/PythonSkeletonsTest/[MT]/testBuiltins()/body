{
  runTest(new SkeletonsTask(){
    @Override public void runTestOn(    @NotNull Sdk sdk){
      final Project project=myFixture.getProject();
      final PyFile builtins=PyBuiltinCache.getBuiltinsForSdk(project,sdk);
      assertNotNull(builtins);
      final VirtualFile virtualFile=builtins.getVirtualFile();
      assertNotNull(virtualFile);
      assertTrue(virtualFile.isInLocalFileSystem());
      final String path=virtualFile.getPath();
      final PySkeletonRefresher.SkeletonHeader header=PySkeletonRefresher.readSkeletonHeader(new File(path));
      assertNotNull(header);
      final int version=header.getVersion();
      assertTrue("Header version must be > 0, currently it is " + version,version > 0);
      assertEquals(SkeletonVersionChecker.BUILTIN_NAME,header.getBinaryFile());
      myFixture.configureByFile(getTestName(false) + ".py");
      PsiFile expr=myFixture.getFile();
      final Module module=ModuleUtil.findModuleForPsiElement(expr);
      final Sdk sdkFromModule=PythonSdkType.findPythonSdk(module);
      assertNotNull(sdkFromModule);
      final Sdk sdkFromPsi=PyBuiltinCache.findSdkForFile(expr.getContainingFile());
      final PyFile builtinsFromSdkCache=PythonSdkPathCache.getInstance(project,sdkFromPsi).getBuiltins().getBuiltinsFile();
      assertNotNull(builtinsFromSdkCache);
      assertEquals(builtins,builtinsFromSdkCache);
      final PyFile builtinsFromPsi=PyBuiltinCache.getInstance(expr).getBuiltinsFile();
      assertNotNull(builtinsFromPsi);
      assertEquals(builtins,builtinsFromPsi);
      myFixture.enableInspections(PyUnresolvedReferencesInspection.class);
      edt(new Runnable(){
        @Override public void run(){
          myFixture.checkHighlighting(true,false,false);
        }
      }
);
    }
  }
);
}
