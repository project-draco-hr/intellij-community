{
  PackageInfo info=myDirectoriesByPackageNameCache.get(packageName);
  if (info == null) {
    if (myNonExistentPackages.contains(packageName))     return null;
    if (packageName.length() > Registry.intValue("java.max.package.name.length") || StringUtil.containsAnyChar(packageName,";[/")) {
      return null;
    }
    List<VirtualFile> result=ContainerUtil.newSmartList();
    if (StringUtil.isNotEmpty(packageName) && !StringUtil.startsWithChar(packageName,'.')) {
      int i=packageName.lastIndexOf('.');
      while (true) {
        PackageInfo parentInfo=getPackageInfo(i > 0 ? packageName.substring(0,i) : "");
        if (parentInfo != null) {
          result.addAll(parentInfo.getSubPackageDirectories(packageName.substring(i + 1)));
        }
        if (i < 0)         break;
        i=packageName.lastIndexOf('.',i - 1);
      }
    }
    for (    VirtualFile file : myRootsByPackagePrefix.get(packageName)) {
      if (file.isDirectory()) {
        result.add(file);
      }
    }
    if (!result.isEmpty()) {
      myDirectoriesByPackageNameCache.put(packageName,info=new PackageInfo(packageName,result));
    }
 else {
      myNonExistentPackages.add(packageName);
    }
  }
  return info;
}
