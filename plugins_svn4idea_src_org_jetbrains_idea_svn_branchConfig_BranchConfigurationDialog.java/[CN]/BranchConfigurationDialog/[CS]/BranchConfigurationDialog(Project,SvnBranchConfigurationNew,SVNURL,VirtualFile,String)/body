{
  super(project,true);
  myRoot=root;
  init();
  setTitle(SvnBundle.message("configure.branches.title"));
  final String trunkUrl=configuration.getTrunkUrl();
  if (trunkUrl == null || trunkUrl.trim().length() == 0) {
    configuration.setTrunkUrl(url);
  }
  mySvnBranchConfigManager=SvnBranchConfigurationManager.getInstance(project).getSvnBranchConfigManager();
  myTrunkLocationTextField.setText(configuration.getTrunkUrl());
  myTrunkLocationTextField.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      Pair<SVNURL,SVNURL> selectionData=SelectLocationDialog.selectLocation(project,rootUrl);
      if (selectionData != null && selectionData.getFirst() != null) {
        myTrunkLocationTextField.setText(selectionData.getFirst().toString());
      }
    }
  }
);
  final TrunkUrlValidator trunkUrlValidator=new TrunkUrlValidator(rootUrl,configuration);
  myTrunkLocationTextField.getTextField().getDocument().addDocumentListener(trunkUrlValidator);
  trunkUrlValidator.textChanged(null);
  myErrorPrompt.setUI(new MultiLineLabelUI());
  myErrorPrompt.setForeground(SimpleTextAttributes.ERROR_ATTRIBUTES.getFgColor());
  final MyListModel listModel=new MyListModel(configuration);
  myLocationList=new JBList(listModel);
  myListPanel.add(ToolbarDecorator.createDecorator(myLocationList).setAddAction(new AnActionButtonRunnable(){
    @Nullable private SVNURL usedRootUrl;
    @Override public void run(    AnActionButton button){
      Pair<SVNURL,SVNURL> result=SelectLocationDialog.selectLocation(project,ObjectUtils.notNull(usedRootUrl,rootUrl));
      if (result != null) {
        String selectedUrl=result.getFirst().toString();
        usedRootUrl=result.getSecond();
        if (selectedUrl != null) {
          if (!configuration.getBranchUrls().contains(selectedUrl)) {
            configuration.addBranches(selectedUrl,new InfoStorage<List<SvnBranchItem>>(new ArrayList<SvnBranchItem>(),InfoReliability.empty));
            mySvnBranchConfigManager.reloadBranchesAsync(myRoot,selectedUrl,InfoReliability.setByUser);
            listModel.fireItemAdded();
            myLocationList.setSelectedIndex(listModel.getSize() - 1);
          }
        }
      }
    }
  }
).setRemoveAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      int selIndex=myLocationList.getSelectedIndex();
      Object[] selection=myLocationList.getSelectedValues();
      for (      Object urlObj : selection) {
        String url=(String)urlObj;
        int index=configuration.getBranchUrls().indexOf(url);
        configuration.removeBranch(url);
        listModel.fireItemRemoved(index);
      }
      if (listModel.getSize() > 0) {
        if (selIndex >= listModel.getSize())         selIndex=listModel.getSize() - 1;
        myLocationList.setSelectedIndex(selIndex);
      }
    }
  }
).disableUpDownActions().setToolbarPosition(ActionToolbarPosition.BOTTOM).createPanel(),BorderLayout.CENTER);
}
