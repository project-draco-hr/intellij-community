{
  ASTNode add=toInsert.getNode().copyElement();
  if (afterThis == null) {
    ASTNode exprNode=list.getNode();
    ASTNode[] closingTokens=exprNode.getChildren(TokenSet.create(PyTokenTypes.LBRACKET,PyTokenTypes.LPAR));
    if (closingTokens.length == 0) {
      exprNode.addChild(add);
    }
 else {
      ASTNode next=PyUtil.getNextNonWhitespace(closingTokens[closingTokens.length - 1]);
      if (next != null) {
        ASTNode comma=createComma();
        exprNode.addChild(comma,next);
        exprNode.addChild(add,comma);
      }
 else {
        exprNode.addChild(add);
      }
    }
  }
 else {
    ASTNode lastArgNode=afterThis.getNode();
    ASTNode comma=createComma();
    ASTNode parent=lastArgNode.getTreeParent();
    ASTNode afterLast=lastArgNode.getTreeNext();
    if (afterLast == null) {
      parent.addChild(add);
    }
 else {
      parent.addChild(add,afterLast);
    }
    parent.addChild(comma,add);
  }
  return add.getPsi();
}
