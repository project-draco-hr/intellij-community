{
  MutableNode node=underdoneNodes.remove(commitHash);
  if (node == null) {
    VcsRef ref=findRefForHash(commitHash);
    VirtualFile repositoryRoot;
    if (ref == null) {
      VcsLogLogger.LOG.error("Ref should exist for this node. Hash: " + commitHash);
      repositoryRoot=NullVirtualFile.INSTANCE;
    }
 else {
      repositoryRoot=ref.getRoot();
    }
    node=createNode(commitHash,new Branch(commitHash,ref,repositoryRoot));
  }
  node.setType(COMMIT_NODE);
  node.setNodeRow(nextRow);
  nextRow.getInnerNodeList().add(node);
  graph.getAllRows().add(nextRow);
  nextRow=new MutableNodeRow(graph,nextRow.getRowIndex() + 1);
  return node;
}
