{
  if (label == null) {
    final PsiManager manager=context.getManager();
    label=JavaDocUtil.getLabelText(manager.getProject(),manager,refText,context);
  }
  LOG.assertTrue(refText != null,"refText appears to be null.");
  final PsiElement target=JavaDocUtil.findReferenceTarget(context.getManager(),refText,context);
  boolean isBrokenLink=target == null;
  if (isBrokenLink) {
    buffer.append("<font color=red>");
    buffer.append(label);
    buffer.append("</font>");
    return StringUtil.stripHtml(label,true).length();
  }
  generateLink(buffer,target,label,plainLink);
  return StringUtil.stripHtml(label,true).length();
}
