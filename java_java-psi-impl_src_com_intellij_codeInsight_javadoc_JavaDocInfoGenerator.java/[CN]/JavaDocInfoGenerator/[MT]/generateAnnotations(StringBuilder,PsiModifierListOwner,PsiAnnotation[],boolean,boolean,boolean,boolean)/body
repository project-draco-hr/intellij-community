{
  PsiManager manager=owner.getManager();
  Set<String> shownAnnotations=ContainerUtil.newHashSet();
  for (  PsiAnnotation annotation : annotations) {
    final PsiJavaCodeReferenceElement nameReferenceElement=annotation.getNameReferenceElement();
    if (nameReferenceElement == null)     continue;
    final PsiElement resolved=nameReferenceElement.resolve();
    boolean inferred=AnnotationUtil.isInferredAnnotation(annotation);
    if (!(shownAnnotations.add(annotation.getQualifiedName()) || isRepeatableAnnotationType(resolved))) {
      continue;
    }
    if (resolved instanceof PsiClass) {
      final PsiClass annotationType=(PsiClass)resolved;
      if (isDocumentedAnnotationType(annotationType)) {
        if (inferred)         buffer.append("<i>");
        final PsiClassType type=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory().createType(annotationType,PsiSubstitutor.EMPTY);
        buffer.append("@");
        if (inferred && !generateLink) {
          buffer.append(type.getPresentableText());
        }
 else {
          generateType(buffer,type,owner,generateLink,useShortNames && !external);
        }
        final PsiNameValuePair[] attributes=annotation.getParameterList().getAttributes();
        if (attributes.length > 0) {
          buffer.append("(");
          boolean first=true;
          for (          PsiNameValuePair pair : attributes) {
            if (!first)             buffer.append(",&nbsp;");
            first=false;
            final String name=pair.getName();
            if (name != null) {
              buffer.append(name);
              buffer.append(" = ");
            }
            final PsiAnnotationMemberValue value=pair.getValue();
            if (value != null) {
              if (value instanceof PsiArrayInitializerMemberValue) {
                buffer.append("{");
                boolean firstMember=true;
                for (                PsiAnnotationMemberValue memberValue : ((PsiArrayInitializerMemberValue)value).getInitializers()) {
                  if (!firstMember)                   buffer.append(",");
                  firstMember=false;
                  appendLinkOrText(buffer,memberValue,generateLink);
                }
                buffer.append("}");
              }
 else {
                appendLinkOrText(buffer,value,generateLink);
              }
            }
          }
          buffer.append(")");
        }
        if (inferred)         buffer.append("</i>");
        buffer.append("&nbsp;");
      }
    }
 else     if (external) {
      if (inferred)       buffer.append("<i>");
      String annoText=inferred ? "@" + annotation.getNameReferenceElement().getReferenceName() + annotation.getParameterList().getText() : annotation.getText();
      buffer.append(XmlStringUtil.escapeString(annoText));
      if (inferred)       buffer.append("</i>");
      buffer.append("&nbsp;");
    }
 else {
      buffer.append("<font color=red>");
      buffer.append(XmlStringUtil.escapeString(annotation.getText()));
      buffer.append("</font>");
      buffer.append("&nbsp;");
    }
    if (splitAnnotations)     buffer.append("\n");
  }
}
