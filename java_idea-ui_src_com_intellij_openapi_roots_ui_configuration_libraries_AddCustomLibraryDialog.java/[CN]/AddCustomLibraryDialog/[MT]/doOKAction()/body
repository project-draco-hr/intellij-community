{
  final LibraryCompositionSettings settings=myPanel.apply();
  if (settings != null && settings.downloadFiles(myPanel.getMainPanel())) {
    DumbService.getInstance(myModule.getProject()).allowStartingDumbModeInside(DumbService.DumbModePermission.MAY_START_BACKGROUND,new Runnable(){
      @Override public void run(){
        if (myModifiableRootModel == null) {
          final ModifiableRootModel model=ModuleRootManager.getInstance(myModule).getModifiableModel();
          new WriteAction(){
            @Override protected void run(            @NotNull final Result result){
              addLibraries(model,settings);
              model.commit();
            }
          }
.execute();
        }
 else {
          addLibraries(myModifiableRootModel,settings);
        }
      }
    }
);
    super.doOKAction();
  }
}
