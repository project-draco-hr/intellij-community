{
  final String[] stackTrace=new LineTokenizer(stacktrace).execute();
  final PsiLocation<?> psiLocation=location.toPsiLocation();
  final PsiClass containingClass=psiLocation.getParentElement(PsiClass.class);
  if (containingClass == null)   return null;
  final String qualifiedName=containingClass.getQualifiedName();
  if (qualifiedName == null)   return null;
  String containingMethod=null;
  for (Iterator<Location<PsiMethod>> iterator=psiLocation.getAncestors(PsiMethod.class,false); iterator.hasNext(); ) {
    final PsiMethod psiMethod=iterator.next().getPsiElement();
    if (containingClass.equals(psiMethod.getContainingClass()))     containingMethod=psiMethod.getName();
  }
  if (containingMethod == null)   return null;
  StackTraceLine lastLine=null;
  for (  String aStackTrace : stackTrace) {
    final StackTraceLine line=new StackTraceLine(containingClass.getProject(),aStackTrace);
    if (containingMethod.equals(line.getMethodName()) && qualifiedName.equals(line.getClassName())) {
      lastLine=line;
      break;
    }
  }
  return lastLine != null ? lastLine.getOpenFileDescriptor(containingClass.getContainingFile().getVirtualFile()) : null;
}
