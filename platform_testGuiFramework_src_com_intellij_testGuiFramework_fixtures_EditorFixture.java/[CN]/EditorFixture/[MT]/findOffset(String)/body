{
  int index=line.indexOf('^');
  if (index == -1) {
    index=line.indexOf('|');
  }
  assertTrue("The text segment should contain a caret position indicated by ^ or |",index != -1);
  String prefix=line.substring(0,index);
  if (prefix.isEmpty()) {
    prefix=null;
  }
  String suffix=line.substring(index + 1);
  if (suffix.isEmpty()) {
    suffix=null;
  }
  assertTrue("The text segment should have more text than just the caret position",prefix != null || suffix != null);
  return findOffset(prefix,suffix,true);
}
