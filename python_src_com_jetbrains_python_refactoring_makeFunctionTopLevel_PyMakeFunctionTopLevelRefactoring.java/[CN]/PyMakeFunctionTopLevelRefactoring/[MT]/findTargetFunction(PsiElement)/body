{
  if (isLocalFunction(element) || isSuitableInstanceMethod(element)) {
    return (PyFunction)element;
  }
  if (isLocalFunction(element.getParent()) || isSuitableInstanceMethod(element.getParent())) {
    return (PyFunction)element.getParent();
  }
  final PyReferenceExpression refExpr=PsiTreeUtil.getParentOfType(element,PyReferenceExpression.class);
  if (refExpr == null) {
    return null;
  }
  final PsiElement resolved=refExpr.getReference().resolve();
  if (isLocalFunction(resolved) || isSuitableInstanceMethod(resolved)) {
    return (PyFunction)resolved;
  }
  return null;
}
