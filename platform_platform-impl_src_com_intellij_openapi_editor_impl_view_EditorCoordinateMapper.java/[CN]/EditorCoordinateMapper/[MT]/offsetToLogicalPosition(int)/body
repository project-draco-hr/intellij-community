{
  int textLength=myDocument.getTextLength();
  if (offset < 0 || textLength == 0) {
    return new LogicalPosition(0,0);
  }
  offset=Math.min(offset,textLength);
  int line=myDocument.getLineNumber(offset);
  LineLayout lineLayout=myView.getLineLayout(line);
  float x=line == 0 ? myView.getPrefixTextWidthInPixels() : 0;
  int relOffset=offset - myDocument.getLineStartOffset(line);
  int column=0;
  for (  LineLayout.Fragment fragment : lineLayout.getFragmentsInLogicalOrder()) {
    if (relOffset >= fragment.getStartOffset() && relOffset <= fragment.getEndOffset()) {
      column+=fragment.offsetToColumn(x,relOffset - fragment.getStartOffset());
      break;
    }
 else {
      column+=fragment.getColumnCount(x);
      x=fragment.advance(x);
    }
  }
  return new LogicalPosition(line,column);
}
