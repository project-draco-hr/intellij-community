{
  int visualLine=pos.line;
  int column=pos.column;
  int y=visualLineToY(visualLine);
  int logicalLine=visualToLogicalLine(visualLine);
  float x=getStartX(logicalLine);
  int lastColumn=0;
  if (logicalLine < myDocument.getLineCount()) {
    for (    VisualLineFragmentsIterator.Fragment fragment : VisualLineFragmentsIterator.create(myView,myDocument.getLineStartOffset(logicalLine))) {
      int endColumn=fragment.getEndVisualColumn();
      if (column <= endColumn) {
        return new Point((int)fragment.visualColumnToX(column),y);
      }
 else {
        x=fragment.getEndX();
        lastColumn=endColumn;
      }
    }
  }
  int additionalShift=column <= lastColumn ? 0 : (column - lastColumn) * myView.getPlainSpaceWidth();
  return new Point((int)(x) + additionalShift,y);
}
