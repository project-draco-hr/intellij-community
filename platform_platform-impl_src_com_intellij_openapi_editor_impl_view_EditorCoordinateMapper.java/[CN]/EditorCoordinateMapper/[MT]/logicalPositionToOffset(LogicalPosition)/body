{
  int line=pos.line;
  if (line >= myDocument.getLineCount()) {
    return myDocument.getTextLength();
  }
 else {
    LineLayout lineLayout=myView.getLineLayout(line);
    float x=line == 0 ? myView.getPrefixTextWidthInPixels() : 0;
    int column=pos.column;
    int relOffset=0;
    for (    LineLayout.Fragment fragment : lineLayout.getFragmentsInLogicalOrder()) {
      int columnCount=fragment.getColumnCount(x);
      if (column <= columnCount) {
        relOffset+=fragment.columnToOffset(x,column);
        break;
      }
 else {
        relOffset+=fragment.getLength();
        column-=columnCount;
        x=fragment.advance(x);
      }
    }
    return myDocument.getLineStartOffset(line) + relOffset;
  }
}
