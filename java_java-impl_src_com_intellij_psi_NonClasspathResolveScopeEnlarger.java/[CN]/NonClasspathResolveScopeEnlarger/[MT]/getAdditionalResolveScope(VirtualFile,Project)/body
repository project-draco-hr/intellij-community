{
  ProjectFileIndex index=ProjectFileIndex.SERVICE.getInstance(project);
  if (index.isInLibraryClasses(file) || index.isInContent(file)) {
    return null;
  }
  String fileExtension=file.getExtension();
  if ("class".equals(fileExtension) || JavaFileType.DEFAULT_EXTENSION.equals(fileExtension)) {
    for (    PsiElementFinder finder : Extensions.getExtensions(PsiElementFinder.EP_NAME,project)) {
      if (finder instanceof NonClasspathClassFinder) {
        final List<VirtualFile> roots=((NonClasspathClassFinder)finder).getClassRoots();
        for (        VirtualFile root : roots) {
          if (VfsUtilCore.isAncestor(root,file,true)) {
            return NonClasspathDirectoriesScope.compose(roots);
          }
        }
      }
    }
  }
  return null;
}
