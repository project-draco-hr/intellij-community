{
  try {
    return new IdeaServerUrlBuilder(fileSpec,type,projectKey){
      @Override public void setDisconnectedStatus(){
        settings.setStatus(IdeaConfigurationServerStatus.CONNECTION_FAILED);
      }
      @Override public void setUnauthorizedStatus(){
        settings.setStatus(IdeaConfigurationServerStatus.UNAUTHORIZED);
      }
    }
;
  }
  finally {
    if (projectKey != null) {
      checkIfProjectKeyMappingIsStored(projectKey);
    }
  }
}
