{
  final CompiledPattern pattern=myGlobalVisitor.getContext().getPattern();
  if (isBlockElement(element)) {
    myGlobalVisitor.setCodeBlockLevel(myGlobalVisitor.getCodeBlockLevel() + 1);
    if (myGlobalVisitor.getCodeBlockLevel() == 1) {
      initTopLevelElement(element,pattern);
    }
 else {
      super.visitElement(element);
    }
    myGlobalVisitor.setCodeBlockLevel(myGlobalVisitor.getCodeBlockLevel() - 1);
    return;
  }
  if (canBePatternVariable(element)) {
    if (pattern.isRealTypedVar(element)) {
      myGlobalVisitor.handle(element);
      final MatchingHandler handler=pattern.getHandler(element);
      handler.setFilter(new NodeFilter(){
        public boolean accepts(        PsiElement other){
          return canBeVariable(other);
        }
      }
);
      return;
    }
  }
  super.visitElement(element);
}
