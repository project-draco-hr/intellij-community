{
  for (PsiElement el=element.getFirstChild(); el != null; el=el.getNextSibling()) {
    if (GlobalCompilingVisitor.getFilter().accepts(el)) {
      if (el instanceof PsiWhiteSpace) {
        myGlobalVisitor.addLexicalNode(el);
      }
    }
 else {
      el.accept(this);
      if (myGlobalVisitor.getCodeBlockLevel() == 1) {
        final MatchingHandler matchingHandler=myGlobalVisitor.getContext().getPattern().getHandler(el);
        myGlobalVisitor.getContext().getPattern().setHandler(el,new TopLevelMatchingHandler(matchingHandler));
      }
    }
  }
  if (myGlobalVisitor.getCodeBlockLevel() == 1) {
    myGlobalVisitor.getContext().getPattern().setStrategy(new MatchingStrategy(){
      public boolean continueMatching(      PsiElement start){
        return true;
      }
    }
);
  }
  pattern.setHandler(element,new TopLevelMatchingHandler(pattern.getHandler(element)));
}
