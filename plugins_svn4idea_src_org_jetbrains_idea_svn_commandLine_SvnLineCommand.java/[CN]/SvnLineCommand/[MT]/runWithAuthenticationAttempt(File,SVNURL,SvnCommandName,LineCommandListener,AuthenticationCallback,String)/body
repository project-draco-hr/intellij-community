{
  File base=firstFile != null ? (firstFile.isDirectory() ? firstFile : firstFile.getParentFile()) : null;
  base=SvnBindUtil.correctUpToExistingParent(base);
  File configDir=null;
  try {
    writeIdeaConfig2SubversionConfig(authenticationCallback,repositoryUrl);
    configDir=authenticationCallback.getSpecialConfigDir();
    while (true) {
      final String exePath=SvnApplicationSettings.getInstance().getCommandLinePath();
      final SvnLineCommand command=runCommand(exePath,commandName,listener,base,configDir,parameters);
      final Integer exitCode=command.myExitCode.get();
      if (exitCode == null || exitCode != 0) {
        logNullExitCode(command,exitCode);
        if (command.myErr.length() > 0) {
          final String errText=command.myErr.toString().trim();
          final AuthCallbackCase callback=createCallback(errText,authenticationCallback,repositoryUrl);
          if (callback != null) {
            cleanup(exePath,command,base);
            if (callback.getCredentials(errText)) {
              if (authenticationCallback.getSpecialConfigDir() != null) {
                configDir=authenticationCallback.getSpecialConfigDir();
              }
              parameters=updateParameters(callback,parameters);
              continue;
            }
          }
          throw new SvnBindException(errText);
        }
 else {
          if (exitCode != null) {
            throw new SvnBindException("Svn process exited with error code: " + exitCode);
          }
        }
      }
 else       if (command.myErr.length() > 0) {
        LOG.info("Detected warning - " + command.myErr);
      }
      return command;
    }
  }
  finally {
    if (authenticationCallback != null) {
      authenticationCallback.reset();
    }
  }
}
