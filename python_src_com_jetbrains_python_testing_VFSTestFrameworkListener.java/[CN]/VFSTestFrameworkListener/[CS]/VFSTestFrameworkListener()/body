{
  MessageBus messageBus=ApplicationManager.getApplication().getMessageBus();
  messageBus.connect().subscribe(VirtualFileManager.VFS_CHANGES,new BulkFileListener(){
    @Override public void before(    @NotNull List<? extends VFileEvent> events){
    }
    @Override public void after(    @NotNull List<? extends VFileEvent> events){
      for (      VFileEvent event : events) {
        VirtualFile vFile=event.getFile();
        if (vFile == null)         continue;
        String path=vFile.getUrl().toLowerCase();
        boolean containsNose=path.contains(PyNames.NOSE_TEST);
        boolean containsPy=path.contains("py-1") || path.contains(PyNames.PY_TEST);
        boolean containsAt=path.contains(PyNames.AT_TEST);
        if (!containsAt && !containsNose && !containsPy)         continue;
        SDKLOOP:         for (        Sdk sdk : PythonSdkType.getAllSdks()) {
          for (          String root : sdk.getRootProvider().getUrls(OrderRootType.CLASSES)) {
            if (vFile.getUrl().contains(root)) {
              if (containsNose) {
                updateTestFrameworks(sdk.getHomePath(),NOSETESTSEARCHER,PyNames.NOSE_TEST);
                break SDKLOOP;
              }
 else               if (containsPy) {
                updateTestFrameworks(sdk.getHomePath(),PYTESTSEARCHER,PyNames.PY_TEST);
                break SDKLOOP;
              }
 else {
                updateTestFrameworks(sdk.getHomePath(),ATTESTSEARCHER,PyNames.AT_TEST);
                break SDKLOOP;
              }
            }
          }
        }
      }
    }
  }
);
}
