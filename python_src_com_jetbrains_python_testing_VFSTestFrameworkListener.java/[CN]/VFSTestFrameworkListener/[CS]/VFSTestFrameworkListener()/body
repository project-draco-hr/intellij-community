{
  MessageBus messageBus=ApplicationManager.getApplication().getMessageBus();
  messageBus.connect().subscribe(VirtualFileManager.VFS_CHANGES,new BulkFileListener.Adapter(){
    @Override public void after(    @NotNull List<? extends VFileEvent> events){
      for (      VFileEvent event : events) {
        String path=event.getPath();
        boolean containsNose=path.contains(PyNames.NOSE_TEST);
        boolean containsPy=path.contains("py-1") || path.contains(PyNames.PY_TEST);
        boolean containsAt=path.contains(PyNames.AT_TEST);
        if (!containsAt && !containsNose && !containsPy)         continue;
        SDKLOOP:         for (        Sdk sdk : PythonSdkType.getAllSdks()) {
          for (          String root : sdk.getRootProvider().getUrls(OrderRootType.CLASSES)) {
            if (path.contains(root)) {
              if (containsNose) {
                updateTestFrameworks(sdk,PyNames.NOSE_TEST);
                break SDKLOOP;
              }
 else               if (containsPy) {
                updateTestFrameworks(sdk,PyNames.PY_TEST);
                break SDKLOOP;
              }
 else {
                updateTestFrameworks(sdk,PyNames.AT_TEST);
                break SDKLOOP;
              }
            }
          }
        }
      }
    }
  }
);
}
