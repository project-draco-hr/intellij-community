{
  JBPopup oldPopup=myChain.getUserData(POPUP_KEY);
  if (oldPopup != null && oldPopup.isVisible()) {
    oldPopup.cancel();
  }
  final JBPopup popup=createPopup(e);
  myChain.putUserData(POPUP_KEY,popup);
  popup.addListener(new JBPopupAdapter(){
    @Override public void onClosed(    LightweightWindowEvent event){
      if (myChain.getUserData(POPUP_KEY) == popup) {
        myChain.putUserData(POPUP_KEY,null);
      }
    }
  }
);
  InputEvent event=e.getInputEvent();
  if (event instanceof MouseEvent) {
    popup.show(new RelativePoint((MouseEvent)event));
  }
 else {
    popup.showInBestPositionFor(e.getDataContext());
  }
}
