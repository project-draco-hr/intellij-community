{
  final Editor editor=CommonDataKeys.EDITOR.getData(context);
  if (editor != null) {
    Project project=editor.getProject();
    if (project != null && project.isInitialized()) {
      PsiFile psiFile=CommonDataKeys.PSI_FILE.getData(context);
      if (psiFile == null) {
        psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
      }
      if (psiFile != null) {
        return new OpenInBrowserRequest(psiFile){
          private PsiElement element;
          @NotNull @Override public PsiElement getElement(){
            if (element == null) {
              element=getFile().findElementAt(editor.getCaretModel().getOffset());
            }
            return ObjectUtils.chooseNotNull(element,getFile());
          }
        }
;
      }
    }
  }
 else {
    PsiFile psiFile=CommonDataKeys.PSI_FILE.getData(context);
    VirtualFile virtualFile=CommonDataKeys.VIRTUAL_FILE.getData(context);
    Project project=CommonDataKeys.PROJECT.getData(context);
    if (virtualFile != null && !virtualFile.isDirectory() && virtualFile.isValid() && project != null && project.isInitialized()) {
      psiFile=PsiManager.getInstance(project).findFile(virtualFile);
    }
    if (psiFile != null) {
      return OpenInBrowserRequest.create(psiFile);
    }
  }
  return null;
}
