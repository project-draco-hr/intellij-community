{
  PsiElementFactory elementFactory=JavaPsiFacade.getElementFactory(myProject);
  PsiMethod method=(PsiMethod)info.getMember();
  PsiMethod sibling=method;
  PsiMethod anchor=null;
  while (sibling != null) {
    sibling=PsiTreeUtil.getNextSiblingOfType(sibling,PsiMethod.class);
    if (sibling != null) {
      anchor=MethodSignatureUtil.findMethodInSuperClassBySignatureInDerived(method.getContainingClass(),myTargetSuperClass,sibling.getSignature(PsiSubstitutor.EMPTY),false);
      if (anchor != null) {
        break;
      }
    }
  }
  PsiMethod methodCopy=(PsiMethod)method.copy();
  Language language=myTargetSuperClass.getLanguage();
  final PsiMethod superClassMethod=myTargetSuperClass.findMethodBySignature(methodCopy,false);
  if (superClassMethod != null && superClassMethod.findDeepestSuperMethods().length == 0 || method.findSuperMethods(myTargetSuperClass).length == 0) {
    deleteOverrideAnnotationIfFound(methodCopy);
  }
  boolean isOriginalMethodAbstract=method.hasModifierProperty(PsiModifier.ABSTRACT) || method.hasModifierProperty(PsiModifier.DEFAULT);
  if (myIsTargetInterface || info.isToAbstract()) {
    ChangeContextUtil.clearContextInfo(method);
    if (!info.isToAbstract() && !method.hasModifierProperty(PsiModifier.ABSTRACT) && PsiUtil.isLanguageLevel8OrHigher(myTargetSuperClass)) {
      RefactoringUtil.makeMethodDefault(methodCopy);
      isOriginalMethodAbstract=true;
    }
 else {
      RefactoringUtil.makeMethodAbstract(myTargetSuperClass,methodCopy);
    }
    RefactoringUtil.replaceMovedMemberTypeParameters(methodCopy,PsiUtil.typeParametersIterable(mySourceClass),substitutor,elementFactory);
    myJavaDocPolicy.processCopiedJavaDoc(methodCopy.getDocComment(),method.getDocComment(),isOriginalMethodAbstract);
    final PsiMember movedElement;
    if (superClassMethod != null && superClassMethod.hasModifierProperty(PsiModifier.ABSTRACT)) {
      movedElement=(PsiMember)superClassMethod.replace(convertMethodToLanguage(methodCopy,language));
    }
 else {
      movedElement=anchor != null ? (PsiMember)myTargetSuperClass.addBefore(methodCopy,anchor) : (PsiMember)myTargetSuperClass.add(methodCopy);
    }
    CodeStyleSettings styleSettings=CodeStyleSettingsManager.getSettings(method.getProject());
    if (styleSettings.INSERT_OVERRIDE_ANNOTATION) {
      if (PsiUtil.isLanguageLevel5OrHigher(mySourceClass) && !myIsTargetInterface || PsiUtil.isLanguageLevel6OrHigher(mySourceClass)) {
        new AddAnnotationFix(Override.class.getName(),method).invoke(method.getProject(),null,mySourceClass.getContainingFile());
      }
    }
    if (!PsiUtil.isLanguageLevel6OrHigher(mySourceClass) && myIsTargetInterface) {
      if (isOriginalMethodAbstract) {
        for (        PsiMethod oMethod : OverridingMethodsSearch.search(method)) {
          deleteOverrideAnnotationIfFound(oMethod);
        }
      }
      deleteOverrideAnnotationIfFound(method);
    }
    myMembersAfterMove.add(movedElement);
    if (isOriginalMethodAbstract) {
      method.delete();
    }
  }
 else {
    if (isOriginalMethodAbstract) {
      PsiUtil.setModifierProperty(myTargetSuperClass,PsiModifier.ABSTRACT,true);
    }
    RefactoringUtil.replaceMovedMemberTypeParameters(methodCopy,PsiUtil.typeParametersIterable(mySourceClass),substitutor,elementFactory);
    fixReferencesToStatic(methodCopy);
    if (superClassMethod != null && superClassMethod.hasModifierProperty(PsiModifier.ABSTRACT)) {
      superClassMethod.replace(convertMethodToLanguage(methodCopy,language));
    }
 else {
      final PsiMember movedElement=anchor != null ? (PsiMember)myTargetSuperClass.addBefore(convertMethodToLanguage(methodCopy,language),anchor) : (PsiMember)myTargetSuperClass.add(convertMethodToLanguage(methodCopy,language));
      myMembersAfterMove.add(movedElement);
    }
    method.delete();
  }
}
