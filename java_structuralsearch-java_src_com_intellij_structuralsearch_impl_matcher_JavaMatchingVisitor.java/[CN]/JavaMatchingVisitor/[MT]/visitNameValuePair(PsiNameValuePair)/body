{
  final PsiIdentifier nameIdentifier=pair.getNameIdentifier();
  final PsiNameValuePair elementNameValuePair=(PsiNameValuePair)myMatchingVisitor.getElement();
  final PsiIdentifier otherIdentifier=elementNameValuePair.getNameIdentifier();
  final PsiAnnotationMemberValue annotationInitializer=pair.getValue();
  if (annotationInitializer != null) {
    final boolean isTypedInitializer=myMatchingVisitor.getMatchContext().getPattern().isTypedVar(annotationInitializer) && annotationInitializer instanceof PsiReferenceExpression;
    myMatchingVisitor.setResult(myMatchingVisitor.match(annotationInitializer,elementNameValuePair.getValue()) || (isTypedInitializer && elementNameValuePair.getValue() == null && allowsAbsenceOfMatch(annotationInitializer)));
  }
  if (myMatchingVisitor.getResult()) {
    final MatchingHandler handler=myMatchingVisitor.getMatchContext().getPattern().getHandler(nameIdentifier);
    if (handler instanceof SubstitutionHandler) {
      myMatchingVisitor.setResult(((SubstitutionHandler)handler).handle(otherIdentifier,myMatchingVisitor.getMatchContext()));
    }
 else     if (nameIdentifier != null) {
      myMatchingVisitor.setResult(myMatchingVisitor.match(nameIdentifier,otherIdentifier));
    }
 else {
      myMatchingVisitor.setResult(otherIdentifier == null || otherIdentifier.getText().equals("value"));
    }
  }
}
