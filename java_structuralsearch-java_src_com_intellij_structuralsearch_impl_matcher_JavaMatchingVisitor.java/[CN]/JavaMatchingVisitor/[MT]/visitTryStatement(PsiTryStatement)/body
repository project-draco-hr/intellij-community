{
  final PsiTryStatement try2=(PsiTryStatement)myMatchingVisitor.getElement();
  myMatchingVisitor.setResult(myMatchingVisitor.matchSons(try1.getTryBlock(),try2.getTryBlock()));
  if (!myMatchingVisitor.getResult())   return;
  final PsiResourceList resourceList1=try1.getResourceList();
  final PsiCatchSection[] catches1=try1.getCatchSections();
  final PsiCodeBlock finally1=try1.getFinallyBlock();
  final PsiResourceList resourceList2=try2.getResourceList();
  final PsiCatchSection[] catches2=try2.getCatchSections();
  final PsiCodeBlock finally2=try2.getFinallyBlock();
  if (!myMatchingVisitor.getMatchContext().getOptions().isLooseMatching() && ((catches1.length == 0 && catches2.length != 0) || (finally1 == null && finally2 != null) || (resourceList1 == null && resourceList2 != null)) || catches2.length < catches1.length) {
    myMatchingVisitor.setResult(false);
  }
 else {
    final List<PsiElement> unmatchedElements=new ArrayList<PsiElement>();
    if (resourceList1 != null) {
      if (resourceList2 == null) {
        myMatchingVisitor.setResult(false);
        return;
      }
      final List<PsiResourceListElement> resources1=PsiTreeUtil.getChildrenOfTypeAsList(resourceList1,PsiResourceListElement.class);
      final List<PsiResourceListElement> resources2=PsiTreeUtil.getChildrenOfTypeAsList(resourceList2,PsiResourceListElement.class);
      myMatchingVisitor.setResult(myMatchingVisitor.matchInAnyOrder(resources1.toArray(new PsiResourceListElement[resources1.size()]),resources2.toArray(new PsiResourceListElement[resources2.size()])));
      if (!myMatchingVisitor.getResult())       return;
    }
 else     if (resourceList2 != null) {
      unmatchedElements.add(resourceList2);
    }
    ContainerUtil.addAll(unmatchedElements,catches2);
    for (    PsiCatchSection catchSection : catches1) {
      final MatchingHandler handler=myMatchingVisitor.getMatchContext().getPattern().getHandler(catchSection);
      final PsiElement pinnedNode=handler.getPinnedNode(null);
      if (pinnedNode != null) {
        myMatchingVisitor.setResult(handler.match(catchSection,pinnedNode,myMatchingVisitor.getMatchContext()));
        if (!myMatchingVisitor.getResult())         return;
      }
 else {
        boolean matched=false;
        for (int j=0; j < unmatchedElements.size(); ++j) {
          if (handler.match(catchSection,unmatchedElements.get(j),myMatchingVisitor.getMatchContext())) {
            unmatchedElements.remove(j);
            matched=true;
            break;
          }
        }
        if (!matched) {
          myMatchingVisitor.setResult(false);
          return;
        }
      }
    }
    if (finally1 != null) {
      myMatchingVisitor.setResult(myMatchingVisitor.matchSons(finally1,finally2));
    }
 else     if (finally2 != null) {
      unmatchedElements.add(finally2);
    }
    if (myMatchingVisitor.getResult() && unmatchedElements.size() > 0) {
      try2.putUserData(GlobalMatchingVisitor.UNMATCHED_ELEMENTS_KEY,unmatchedElements);
    }
  }
}
