{
  if (myDelegate instanceof SubstitutionHandler) {
    return (SubstitutionHandler)myDelegate;
  }
  final List<PsiElement> alternativeElements=element.getUserData(PatternCompiler.ALTERNATIVE_PATTERN_ROOTS);
  if (alternativeElements != null) {
    for (    PsiElement alternativeElement : alternativeElements) {
      MatchingHandler handler=context.getPattern().getHandlerSimple(alternativeElement);
      if (handler instanceof DelegatingHandler) {
        handler=((DelegatingHandler)handler).getDelegate();
      }
      if (handler instanceof SubstitutionHandler) {
        return (SubstitutionHandler)handler;
      }
    }
  }
  return null;
}
