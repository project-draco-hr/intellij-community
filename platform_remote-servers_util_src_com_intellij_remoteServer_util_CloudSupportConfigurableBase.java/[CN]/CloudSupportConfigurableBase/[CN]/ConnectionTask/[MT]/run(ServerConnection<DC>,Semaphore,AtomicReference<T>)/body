{
  connection.connectIfNeeded(new ServerConnector.ConnectionCallback<DC>(){
    @Override public void connected(    @NotNull ServerRuntimeInstance<DC> serverRuntimeInstance){
      final SR serverRuntime=(SR)serverRuntimeInstance;
      serverRuntime.getTasksExecutor().submit(new Runnable(){
        @Override public void run(){
          try {
            result.set(ConnectionTask.this.run(serverRuntime));
          }
 catch (          ServerRuntimeException e) {
            runtimeErrorOccurred(e.getMessage());
          }
 finally {
            semaphore.up();
          }
        }
      }
);
    }
    @Override public void errorOccurred(    @NotNull String errorMessage){
      runtimeErrorOccurred(errorMessage);
      semaphore.up();
    }
  }
);
}
