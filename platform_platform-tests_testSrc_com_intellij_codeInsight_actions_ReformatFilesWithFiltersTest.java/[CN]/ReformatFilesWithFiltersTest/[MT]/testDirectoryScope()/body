{
  TestFileStructure fileTree=new TestFileStructure(getModule(),myWorkingDirectory);
  PsiFile java1=fileTree.addTestFile("Test1.java","empty content");
  PsiFile php1=fileTree.addTestFile("Pair1.php","empty content");
  PsiFile js1=fileTree.addTestFile("Pair1.js","empty content");
  PsiDirectory outer=fileTree.createDirectoryAndMakeItCurrent("toFormat");
  PsiFile java2=fileTree.addTestFile("Test2.java","empty content");
  PsiFile php2=fileTree.addTestFile("Pair2.php","empty content");
  PsiFile js2=fileTree.addTestFile("Pair2.js","empty content");
  PsiDirectory inner=fileTree.createDirectoryAndMakeItCurrent("toFormat");
  PsiFile java3=fileTree.addTestFile("Test3.java","empty content");
  PsiFile php3=fileTree.addTestFile("Pair3.php","empty content");
  PsiFile js3=fileTree.addTestFile("Pair3.js","empty content");
  reformatDirectoryWithScopeFilter(myWorkingDirectory,directoryScope(outer,true));
  assertWasFormatted(java2,php2,js2,java3,php3,js3);
  assertWasNotFormatted(java1,php1,js1);
  reformatDirectoryWithScopeFilter(myWorkingDirectory,directoryScope(outer,false));
  assertWasFormatted(java2,php2,js2);
  assertWasNotFormatted(java1,php1,js1,java3,php3,js3);
  reformatDirectoryWithScopeFilter(myWorkingDirectory,directoryScope(inner,true));
  assertWasFormatted(java3,php3,js3);
  assertWasNotFormatted(java1,php1,js1,java2,php2,js2);
  reformatDirectoryWithScopeFilter(myWorkingDirectory,directoryScope(myWorkingDirectory,false).union(directoryScope(inner,false)));
  assertWasFormatted(java3,php3,js3,java1,php1,js1);
  assertWasNotFormatted(java2,php2,js2);
}
