{
  final Set<Module> modules=ContainerUtil.newLinkedHashSet();
  OrderEnumerator en=getOrderEnumeratorForOptions();
  en.forEach(new Processor<OrderEntry>(){
    @Override public boolean process(    OrderEntry each){
      if (each instanceof ModuleOrderEntry) {
        ContainerUtil.addIfNotNull(modules,((ModuleOrderEntry)each).getModule());
      }
 else       if (each instanceof ModuleSourceOrderEntry) {
        ContainerUtil.addIfNotNull(modules,each.getOwnerModule());
      }
      return true;
    }
  }
);
  return modules;
}
