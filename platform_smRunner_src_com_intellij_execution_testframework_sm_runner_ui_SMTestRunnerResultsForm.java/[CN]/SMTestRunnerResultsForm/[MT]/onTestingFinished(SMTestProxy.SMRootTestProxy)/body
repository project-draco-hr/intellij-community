{
  myEndTime=System.currentTimeMillis();
  if (myTotalTestCount == 0) {
    myTotalTestCount=myStartedTestCount;
    myStatusLine.setFraction(1);
  }
  updateStatusLabel(true);
  updateIconProgress();
  myAnimator.stopMovie();
  myTreeBuilder.updateFromRoot();
  LvcsHelper.addLabel(this);
  final Runnable onDone=new Runnable(){
    @Override public void run(){
      myTestsRunning=false;
      final boolean sortByDuration=TestConsoleProperties.SORT_BY_DURATION.value(myProperties);
      if (sortByDuration) {
        myTreeBuilder.setStatisticsComparator(myProperties,sortByDuration);
      }
    }
  }
;
  if (myLastSelected == null) {
    selectAndNotify(myTestsRootNode,onDone);
  }
 else {
    onDone.run();
  }
  fireOnTestingFinished();
  if (testsRoot.isEmptySuite() && testsRoot.isTestsReporterAttached() && myConsoleProperties instanceof SMTRunnerConsoleProperties&& ((SMTRunnerConsoleProperties)myConsoleProperties).fixEmptySuite()) {
    return;
  }
  final TestsUIUtil.TestResultPresentation presentation=new TestsUIUtil.TestResultPresentation(testsRoot,myStartTime > 0,null).getPresentation(myFailedTestCount,myFinishedTestCount - myFailedTestCount - myIgnoredTestCount,myTotalTestCount - myFinishedTestCount,myIgnoredTestCount);
  TestsUIUtil.notifyByBalloon(myConsoleProperties.getProject(),testsRoot,myConsoleProperties,presentation);
  addToHistory(testsRoot,myConsoleProperties,this);
}
