{
  final Deque<WordWithPosition> parts=new ArrayDeque<WordWithPosition>(commandLineParts);
  if (parts.isEmpty()) {
    throw new MalformedCommandLineException("No command provided");
  }
  final WordWithPosition command=parts.pop();
  final List<Pair<CommandLinePartType,WordWithPosition>> resultParts=new ArrayList<Pair<CommandLinePartType,WordWithPosition>>();
  if (command.getText().startsWith("-")) {
    throw new MalformedCommandLineException("Command can't start with option prefix");
  }
  for (  final WordWithPosition part : parts) {
    if (part.getText().startsWith("-")) {
      resultParts.add(Pair.create(CommandLinePartType.OPTION,part));
    }
 else {
      resultParts.add(Pair.create(CommandLinePartType.ARGUMENT,part));
    }
  }
  return new CommandLineParseResult(command,resultParts);
}
