{
  final Executor executor=DefaultRunExecutor.getRunExecutorInstance();
  final String executorId=executor.getId();
  ExecutionEnvironmentBuilder builder=ExecutionEnvironmentBuilder.createOrNull(executor,settings);
  if (builder == null) {
    return false;
  }
  List<ExecutionTarget> targets=ApplicationManager.getApplication().runReadAction(new Computable<List<ExecutionTarget>>(){
    @Override public List<ExecutionTarget> compute(){
      return ExecutionTargetManager.getTargetsFor(env.getProject(),settings);
    }
  }
);
  if (targets.isEmpty()) {
    return false;
  }
  final ExecutionEnvironment environment=builder.target(targets.get(0)).build();
  environment.setExecutionId(env.getExecutionId());
  if (!ExecutionTargetManager.canRun(settings,environment.getExecutionTarget())) {
    return false;
  }
  if (!environment.getRunner().canRun(executorId,environment.getRunProfile())) {
    return false;
  }
 else {
    beforeRun(environment);
    return doRunTask(executorId,environment,environment.getRunner());
  }
}
