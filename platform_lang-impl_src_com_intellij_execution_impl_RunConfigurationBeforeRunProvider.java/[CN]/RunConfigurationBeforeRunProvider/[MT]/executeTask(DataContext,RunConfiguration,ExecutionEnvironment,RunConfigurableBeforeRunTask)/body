{
  RunnerAndConfigurationSettings settings=task.getSettings();
  if (settings == null) {
    return false;
  }
  final Executor executor=DefaultRunExecutor.getRunExecutorInstance();
  final String executorId=executor.getId();
  final ProgramRunner runner=ProgramRunnerUtil.getRunner(executorId,settings);
  if (runner == null)   return false;
  final ExecutionEnvironment environment=new ExecutionEnvironment(executor,runner,settings,myProject);
  environment.setExecutionId(env.getExecutionId());
  if (!ExecutionTargetManager.canRun(settings,env.getExecutionTarget())) {
    return false;
  }
  if (!runner.canRun(executorId,environment.getRunProfile())) {
    return false;
  }
 else {
    final Semaphore targetDone=new Semaphore();
    final Ref<Boolean> result=new Ref<Boolean>(false);
    final Disposable disposable=Disposer.newDisposable();
    myProject.getMessageBus().connect(disposable).subscribe(ExecutionManager.EXECUTION_TOPIC,new ExecutionAdapter(){
      public void processStartScheduled(      final String executorIdLocal,      final ExecutionEnvironment environmentLocal){
        if (executorId.equals(executorIdLocal) && environment.equals(environmentLocal)) {
          targetDone.down();
        }
      }
      public void processNotStarted(      final String executorIdLocal,      @NotNull final ExecutionEnvironment environmentLocal){
        if (executorId.equals(executorIdLocal) && environment.equals(environmentLocal)) {
          targetDone.up();
        }
      }
      public void processStarted(      final String executorIdLocal,      @NotNull final ExecutionEnvironment environmentLocal,      @NotNull final ProcessHandler handler){
        if (executorId.equals(executorIdLocal) && environment.equals(environmentLocal)) {
          handler.addProcessListener(new ProcessAdapter(){
            public void processTerminated(            ProcessEvent event){
              result.set(event.getExitCode() == 0);
              targetDone.up();
            }
          }
);
        }
      }
    }
);
    try {
      ApplicationManager.getApplication().invokeAndWait(new Runnable(){
        @Override public void run(){
          try {
            runner.execute(environment);
          }
 catch (          ExecutionException e) {
            targetDone.up();
            LOG.error(e);
          }
        }
      }
,ModalityState.NON_MODAL);
    }
 catch (    Exception e) {
      LOG.error(e);
      Disposer.dispose(disposable);
      return false;
    }
    targetDone.waitFor();
    Disposer.dispose(disposable);
    return result.get();
  }
}
