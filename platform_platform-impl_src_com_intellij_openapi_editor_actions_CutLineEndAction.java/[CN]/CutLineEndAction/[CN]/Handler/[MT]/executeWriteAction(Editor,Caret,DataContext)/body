{
  if (caret == null && editor.getCaretModel().getCaretCount() > 1) {
    editor.getCaretModel().runForEachCaret(new CaretAction(){
      @Override public void perform(      Caret caret){
        caret.setSelection(caret.getOffset(),getEndOffset(caret));
      }
    }
);
    EditorCopyPasteHelper.getInstance().copySelectionToClipboard(editor);
    EditorModificationUtil.deleteSelectedTextForAllCarets(editor);
  }
 else {
    if (caret == null) {
      caret=editor.getCaretModel().getCurrentCaret();
    }
    int startOffset=caret.getOffset();
    int endOffset=getEndOffset(caret);
    KillRingUtil.cut(editor,startOffset,endOffset);
    caret.moveToOffset(startOffset);
  }
}
