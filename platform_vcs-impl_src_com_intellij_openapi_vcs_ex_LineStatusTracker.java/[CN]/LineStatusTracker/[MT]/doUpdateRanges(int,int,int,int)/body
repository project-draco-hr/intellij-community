{
  List<Range> rangesBeforeChange=new ArrayList<Range>();
  List<Range> rangesAfterChange=new ArrayList<Range>();
  List<Range> changedRanges=new ArrayList<Range>();
  sortRanges(myRanges,beforeFirstChangedLine,beforeLastChangedLine,rangesBeforeChange,changedRanges,rangesAfterChange);
  Range firstChangedRange=ContainerUtil.getFirstItem(changedRanges);
  Range lastChangedRange=ContainerUtil.getLastItem(changedRanges);
  if (firstChangedRange != null && firstChangedRange.getLine1() < beforeFirstChangedLine) {
    beforeFirstChangedLine=firstChangedRange.getLine1();
  }
  if (lastChangedRange != null && lastChangedRange.getLine2() > beforeLastChangedLine) {
    beforeLastChangedLine=lastChangedRange.getLine2() - 1;
  }
  doUpdateRanges(beforeFirstChangedLine,beforeLastChangedLine + 1,linesShift,beforeTotalLines,rangesBeforeChange,changedRanges,rangesAfterChange);
}
