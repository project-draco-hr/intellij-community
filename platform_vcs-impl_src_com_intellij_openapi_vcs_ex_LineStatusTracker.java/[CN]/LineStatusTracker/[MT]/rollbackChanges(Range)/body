{
  myApplication.assertWriteAccessAllowed();
synchronized (myLock) {
    TextRange currentTextRange=getCurrentTextRangeWithMagic(range);
    int offset1=currentTextRange.getStartOffset();
    int offset2=Math.min(currentTextRange.getEndOffset() + 1,myDocument.getTextLength());
    if (range.getType() == Range.INSERTED) {
      myDocument.replaceString(offset1,offset2,"");
    }
 else     if (range.getType() == Range.DELETED) {
      String upToDateContent=getUpToDateContentWithMagic(range);
      myDocument.insertString(offset1,upToDateContent);
    }
 else {
      String upToDateContent=getUpToDateContentWithMagic(range);
      myDocument.replaceString(offset1,offset2,upToDateContent);
    }
  }
}
