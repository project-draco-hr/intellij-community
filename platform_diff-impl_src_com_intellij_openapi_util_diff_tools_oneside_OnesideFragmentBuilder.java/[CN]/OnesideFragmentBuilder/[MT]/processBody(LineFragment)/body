{
  int startLine1=fragment.getStartLine1();
  int endLine1=fragment.getEndLine1() - 1;
  int lines1=endLine1 - startLine1;
  int startLine2=fragment.getStartLine2();
  int endLine2=fragment.getEndLine2() - 1;
  int lines2=endLine2 - startLine2;
  int blockStartOffset1;
  int blockEndOffset1;
  int blockStartOffset2;
  int blockEndOffset2;
  int linesBefore=totalLines;
  int linesAfter;
  if (lines1 >= 0) {
    int startOffset=myDocument1.getLineStartOffset(startLine1);
    int endOffset=myDocument1.getLineEndOffset(endLine1);
    int start=myBuilder.length();
    appendText(Side.LEFT,startOffset,endOffset,lines1,startLine1,-1);
    int end=myBuilder.length();
    blockStartOffset1=start;
    blockEndOffset1=end;
  }
 else {
    blockStartOffset1=myBuilder.length();
    blockEndOffset1=myBuilder.length();
  }
  if (lines2 >= 0) {
    int startOffset=myDocument2.getLineStartOffset(startLine2);
    int endOffset=myDocument2.getLineEndOffset(endLine2);
    int start=myBuilder.length();
    appendText(Side.RIGHT,startOffset,endOffset,lines2,-1,startLine2);
    int end=myBuilder.length();
    blockStartOffset2=start;
    blockEndOffset2=end;
  }
 else {
    blockStartOffset2=myBuilder.length();
    blockEndOffset2=myBuilder.length();
  }
  linesAfter=totalLines;
  List<DiffFragment> innerFragments=null;
  if (myInlineFragments && fragment instanceof FineLineFragment) {
    innerFragments=((FineLineFragment)fragment).getFineFragments();
  }
  myBlocks.add(new ChangedBlock(blockStartOffset1,blockEndOffset1,blockStartOffset2,blockEndOffset2,linesBefore,linesAfter,innerFragments));
  lastProcessedLine1=endLine1;
  lastProcessedLine2=endLine2;
}
