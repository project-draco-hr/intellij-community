{
  List<SocketLock> toClose=new ArrayList<SocketLock>();
  File temp=FileUtil.createTempDirectory("c",null);
  try {
    assertThat(createLock(toClose).lock(temp.getPath() + "/1",temp.getPath() + "/1-"),equalTo(SocketLock.ActivateStatus.NO_INSTANCE));
    assertThat(createLock(toClose).lock(temp.getPath() + "/1.1",temp.getPath() + "/1-1"),equalTo(SocketLock.ActivateStatus.NO_INSTANCE));
    assertThat(createLock(toClose).lock(temp.getPath() + "/2",temp.getPath() + "/2-"),equalTo(SocketLock.ActivateStatus.NO_INSTANCE));
    assertThat(createLock(toClose).lock(temp.getPath() + "/2",temp.getPath() + "/2-"),equalTo(SocketLock.ActivateStatus.ACTIVATED));
    assertThat(createLock(toClose).lock(temp.getPath() + "/1",temp.getPath() + "/1-"),equalTo(SocketLock.ActivateStatus.ACTIVATED));
    assertThat(createLock(toClose).lock(temp.getPath() + "/1.1",temp.getPath() + "/1-1"),equalTo(SocketLock.ActivateStatus.ACTIVATED));
  }
  finally {
    for (    SocketLock lock : toClose) {
      lock.dispose();
    }
    FileUtil.delete(temp);
  }
}
