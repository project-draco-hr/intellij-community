{
  LayoutManager layout=getLayout();
  ScrollPaneLayout scrollLayout=layout instanceof ScrollPaneLayout ? (ScrollPaneLayout)layout : null;
  int oldHPolicy=-1;
  int oldVPolicy=-1;
  if (scrollLayout != null) {
    if (isOverlaidScrollbar(getHorizontalScrollBar())) {
      oldHPolicy=scrollLayout.getHorizontalScrollBarPolicy();
      if (oldHPolicy == HORIZONTAL_SCROLLBAR_ALWAYS) {
        scrollLayout.setHorizontalScrollBarPolicy(myOverriddenHPolicy=HORIZONTAL_SCROLLBAR_AS_NEEDED);
      }
    }
    if (isOverlaidScrollbar(getVerticalScrollBar())) {
      oldVPolicy=scrollLayout.getVerticalScrollBarPolicy();
      if (oldVPolicy == VERTICAL_SCROLLBAR_ALWAYS) {
        scrollLayout.setVerticalScrollBarPolicy(myOverriddenVPolicy=VERTICAL_SCROLLBAR_AS_NEEDED);
      }
    }
  }
  super.layout();
  if (scrollLayout != null) {
    myHasOverlayScrollbars=relayoutScrollbars(this,scrollLayout,myHasOverlayScrollbars);
    if (oldHPolicy != -1)     scrollLayout.setHorizontalScrollBarPolicy(oldHPolicy);
    if (oldVPolicy != -1)     scrollLayout.setVerticalScrollBarPolicy(oldVPolicy);
    myOverriddenHPolicy=-1;
    myOverriddenVPolicy=-1;
  }
 else {
    myHasOverlayScrollbars=false;
  }
}
