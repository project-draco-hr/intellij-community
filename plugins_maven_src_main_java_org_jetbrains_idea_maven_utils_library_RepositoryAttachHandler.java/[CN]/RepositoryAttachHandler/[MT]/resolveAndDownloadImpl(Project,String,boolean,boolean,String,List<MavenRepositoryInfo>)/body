{
  final SmartList<MavenExtraArtifactType> extraTypes=new SmartList<MavenExtraArtifactType>();
  if (attachSources)   extraTypes.add(MavenExtraArtifactType.SOURCES);
  if (attachJavaDoc)   extraTypes.add(MavenExtraArtifactType.DOCS);
  final Ref<List<OrderRoot>> result=Ref.create(null);
  resolveLibrary(project,coord,extraTypes,repositories,new Processor<List<MavenArtifact>>(){
    public boolean process(    final List<MavenArtifact> artifacts){
      if (!artifacts.isEmpty()) {
        AccessToken accessToken=WriteAction.start();
        try {
          final List<OrderRoot> roots=createRoots(artifacts,copyTo);
          result.set(roots);
        }
  finally {
          accessToken.finish();
        }
        notifyArtifactsDownloaded(project,artifacts);
      }
      return true;
    }
  }
);
  return result.get();
}
