{
  JComponent result;
  Color fg=UIUtil.getTreeTextForeground();
  mySeparator.configure(null,false);
  final Base base=extractNode(value);
  if (base instanceof EditorNode) {
    final EditorNode editor=(EditorNode)base;
    ConfigurableGroup group=null;
    if (editor.getParent() == myRoot) {
      final DefaultMutableTreeNode prevValue=((DefaultMutableTreeNode)value).getPreviousSibling();
      if (prevValue == null || prevValue instanceof LoadingNode) {
        group=editor.getGroup();
        mySeparator.configure(group,false);
      }
 else {
        final Base prevBase=extractNode(prevValue);
        if (prevBase instanceof EditorNode) {
          final EditorNode prevEditor=(EditorNode)prevBase;
          if (prevEditor.getGroup() != editor.getGroup()) {
            group=editor.getGroup();
            mySeparator.configure(group,true);
          }
        }
      }
    }
    TreePath path=tree.getPathForRow(row);
    if (path == null) {
      if (value instanceof DefaultMutableTreeNode) {
        path=new TreePath(((DefaultMutableTreeNode)value).getPath());
      }
    }
    final boolean toStretch=tree.isVisible() && path != null;
    int forcedWidth=2000;
    if (toStretch) {
      final Rectangle visibleRect=tree.getVisibleRect();
      int nestingLevel=tree.isRootVisible() ? path.getPathCount() - 1 : path.getPathCount() - 2;
      final int left=UIUtil.getTreeLeftChildIndent();
      final int right=UIUtil.getTreeRightChildIndent();
      final Insets treeInsets=tree.getInsets();
      int indent=(left + right) * nestingLevel + (treeInsets != null ? treeInsets.left + treeInsets.right : 0);
      forcedWidth=visibleRect.width > 0 ? visibleRect.width - indent : forcedWidth;
    }
    result=configureComponent(base.getText(),base.getText(),null,null,row == -1 || selected,group != null,group != null ? group.getDisplayName() : null,forcedWidth - 4);
    if (base.isError()) {
      fg=JBColor.red;
    }
 else     if (base.isModified()) {
      fg=JBColor.blue;
    }
  }
 else {
    result=configureComponent(value.toString(),null,null,null,selected,false,null,-1);
  }
  if (value instanceof DefaultMutableTreeNode) {
    DefaultMutableTreeNode node=(DefaultMutableTreeNode)value;
    TreePath nodePath=new TreePath(node.getPath());
    myHandle.setIcon(((SimpleTree)tree).getHandleIcon(node,nodePath));
  }
 else {
    myHandle.setIcon(null);
  }
  myTextLabel.setForeground(selected ? UIUtil.getTreeSelectionForeground() : fg);
  myTextLabel.setOpaque(selected);
  if (Registry.is("ide.new.settings.dialog")) {
    myTextLabel.setBorder(new EmptyBorder(1,2,1,0));
  }
  Project project=null;
  if (base != null && Registry.is("ide.new.settings.dialog")) {
    SimpleNode parent=base.getParent();
    if (parent == myRoot) {
      project=getConfigurableProject(base);
      if (base.getConfigurable() instanceof NodeConfigurable) {
        Configurable[] configurables=((NodeConfigurable)base.getConfigurable()).getConfigurables();
        if (configurables != null) {
          project=getConfigurableProject(configurables[0]);
        }
      }
    }
 else     if (parent instanceof Base && ((Base)parent).getConfigurable() instanceof NodeConfigurable) {
      if (((Base)base.getParent()).getConfigurable() instanceof NodeConfigurable) {
        project=getConfigurableProject(base);
      }
    }
  }
  if (project != null) {
    myProjectIcon.setBackground(selected ? getSelectionBackground() : getBackground());
    myProjectIcon.setIcon(selected ? AllIcons.General.ProjectConfigurableSelected : AllIcons.General.ProjectConfigurable);
    myProjectIcon.setVisible(true);
    myProjectIcon.setToolTipText(OptionsBundle.message(project.isDefault() ? "configurable.default.project.tooltip" : "configurable.current.project.tooltip"));
  }
 else {
    myProjectIcon.setVisible(false);
  }
  if (Registry.is("ide.new.settings.dialog")) {
    result.setBackground(selected ? UIUtil.getTreeSelectionBackground() : UIUtil.getSidePanelColor());
  }
  return result;
}
