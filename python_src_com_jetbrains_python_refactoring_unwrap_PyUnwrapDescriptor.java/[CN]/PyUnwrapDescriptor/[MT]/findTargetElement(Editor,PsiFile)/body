{
  int offset=editor.getCaretModel().getOffset();
  PsiElement endElement=PyUtil.findElementAtOffset(file,offset);
  SelectionModel selectionModel=editor.getSelectionModel();
  if (selectionModel.hasSelection() && selectionModel.getSelectionStart() < offset) {
    PsiElement startElement=PyUtil.findElementAtOffset(file,selectionModel.getSelectionStart());
    if (startElement != null && startElement != endElement && startElement.getTextRange().getEndOffset() == offset) {
      return startElement;
    }
  }
  return endElement;
}
