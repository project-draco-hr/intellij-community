{
  final PsiReference[] referencesFromProviders=ReferenceProvidersRegistry.getReferencesFromProviders(this);
  PsiReference[] refs;
  if (isNamespaceDeclaration()) {
    refs=new PsiReference[referencesFromProviders.length + 1];
    final String localName=getLocalName();
    final String prefix=XmlUtil.findPrefixByQualifiedName(getName());
    final TextRange range=prefix.isEmpty() ? TextRange.from(getName().length(),0) : TextRange.from(prefix.length() + 1,localName.length());
    refs[0]=new SchemaPrefixReference(this,range,localName,null);
  }
 else {
    final String prefix=getNamespacePrefix();
    if (!prefix.isEmpty() && !getLocalName().isEmpty()) {
      refs=new PsiReference[referencesFromProviders.length + 2];
      refs[0]=new SchemaPrefixReference(this,TextRange.from(0,prefix.length()),prefix,null);
      refs[1]=new XmlAttributeReference(this);
    }
 else {
      refs=new PsiReference[referencesFromProviders.length + 1];
      refs[0]=new XmlAttributeReference(this);
    }
  }
  System.arraycopy(referencesFromProviders,0,refs,refs.length - referencesFromProviders.length,referencesFromProviders.length);
  return refs;
}
