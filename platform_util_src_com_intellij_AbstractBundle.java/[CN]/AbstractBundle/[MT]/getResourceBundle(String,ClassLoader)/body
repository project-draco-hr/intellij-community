{
  ConcurrentHashMap<String,SoftReference<ResourceBundle>> map=ourCache.get(loader);
  SoftReference<ResourceBundle> reference=map.get(pathToBundle);
  ResourceBundle result=reference == null ? null : reference.get();
  if (result == null) {
    try {
      ResourceBundle.Control control=ResourceBundle.Control.getControl(ResourceBundle.Control.FORMAT_PROPERTIES);
      result=ResourceBundle.getBundle(pathToBundle,Locale.getDefault(),loader,control);
    }
 catch (    MissingResourceException e) {
      LOG.info("Cannot load resource bundle from *.properties file, falling back to slow class loading: " + pathToBundle);
      ResourceBundle.clearCache(loader);
      result=ResourceBundle.getBundle(pathToBundle,Locale.getDefault(),loader);
    }
    map.put(pathToBundle,new SoftReference<ResourceBundle>(result));
  }
  return result;
}
