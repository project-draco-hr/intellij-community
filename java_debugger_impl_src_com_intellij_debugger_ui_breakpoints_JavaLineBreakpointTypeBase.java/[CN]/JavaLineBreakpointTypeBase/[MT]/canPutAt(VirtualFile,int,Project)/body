{
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (psiFile == null || psiFile.getViewProvider().getFileType() == StdFileTypes.XHTML) {
    return false;
  }
  if (!StdFileTypes.CLASS.equals(psiFile.getFileType()) && !DebuggerUtils.isBreakpointAware(psiFile)) {
    return false;
  }
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  if (document == null)   return false;
  final Ref<Class<? extends JavaLineBreakpointTypeBase>> result=Ref.create();
  XDebuggerUtil.getInstance().iterateLine(project,document,line,new Processor<PsiElement>(){
    @Override public boolean process(    PsiElement element){
      if ((element instanceof PsiWhiteSpace) || (PsiTreeUtil.getParentOfType(element,PsiComment.class,PsiImportStatementBase.class,PsiPackageStatement.class) != null)) {
        return true;
      }
      PsiElement parent=element;
      while (element != null) {
        if (element instanceof PsiModifierList) {
          element=element.getParent();
          continue;
        }
        final int offset=element.getTextOffset();
        if (offset >= 0) {
          if (document.getLineNumber(offset) != line) {
            break;
          }
        }
        parent=element;
        element=element.getParent();
      }
      if (parent instanceof PsiMethod) {
        if (parent.getTextRange().getEndOffset() >= document.getLineEndOffset(line)) {
          PsiCodeBlock body=((PsiMethod)parent).getBody();
          if (body != null) {
            PsiStatement[] statements=body.getStatements();
            if (statements.length > 0 && document.getLineNumber(statements[0].getTextOffset()) == line) {
              result.set(JavaLineBreakpointType.class);
            }
          }
        }
        if (result.isNull()) {
          result.set(JavaMethodBreakpointType.class);
        }
      }
 else       if (parent instanceof PsiField) {
        if (result.isNull()) {
          result.set(JavaFieldBreakpointType.class);
        }
      }
 else {
        result.set(JavaLineBreakpointType.class);
      }
      return true;
    }
  }
);
  return result.get() == getClass();
}
