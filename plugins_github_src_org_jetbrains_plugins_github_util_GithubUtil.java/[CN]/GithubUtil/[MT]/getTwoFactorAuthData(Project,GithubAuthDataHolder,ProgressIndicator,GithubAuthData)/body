{
  authHolder.runTransaction(oldAuth,new ThrowableComputable<GithubAuthData,GithubOperationCanceledException>(){
    @Override @NotNull public GithubAuthData compute() throws GithubOperationCanceledException {
      if (authHolder.getAuthData().getAuthType() != GithubAuthData.AuthType.BASIC) {
        throw new GithubOperationCanceledException("Two factor authentication can be used only with Login/Password");
      }
      GithubApiUtil.askForTwoFactorCodeSMS(oldAuth);
      final Ref<String> codeRef=new Ref<String>();
      ApplicationManager.getApplication().invokeAndWait(new Runnable(){
        @Override public void run(){
          codeRef.set(Messages.showInputDialog(project,"Authentication Code","Github Two-Factor Authentication",null));
        }
      }
,indicator.getModalityState());
      if (codeRef.isNull()) {
        throw new GithubOperationCanceledException("Can't get two factor authentication code");
      }
      return oldAuth.copyWithTwoFactorCode(codeRef.get());
    }
  }
);
}
