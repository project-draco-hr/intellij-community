{
synchronized (authHolder.myLock) {
    if (authHolder.getAuthData() != oldAuth) {
      return;
    }
    if (authHolder.getAuthData().getAuthType() != GithubAuthData.AuthType.BASIC) {
      throw new GithubOperationCanceledException("Two factor authentication can be used only with Login/Password");
    }
    GithubApiUtil.askForTwoFactorCodeSMS(oldAuth);
    final GithubTwoFactorDialog dialog=new GithubTwoFactorDialog(project);
    ApplicationManager.getApplication().invokeAndWait(new Runnable(){
      @Override public void run(){
        DialogManager.show(dialog);
      }
    }
,indicator.getModalityState());
    if (!dialog.isOK()) {
      throw new GithubOperationCanceledException("Can't get two factor authentication code");
    }
    authHolder.setTwoFactorCode(dialog.getCode());
  }
}
