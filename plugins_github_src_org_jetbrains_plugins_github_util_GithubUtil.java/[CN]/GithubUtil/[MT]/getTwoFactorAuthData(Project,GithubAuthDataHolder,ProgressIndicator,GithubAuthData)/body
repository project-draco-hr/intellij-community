{
  authHolder.runTransaction(oldAuth,new ThrowableComputable<GithubAuthData,GithubOperationCanceledException>(){
    @Override @NotNull public GithubAuthData compute() throws GithubOperationCanceledException {
      if (authHolder.getAuthData().getAuthType() != GithubAuthData.AuthType.BASIC) {
        throw new GithubOperationCanceledException("Two factor authentication can be used only with Login/Password");
      }
      GithubApiUtil.askForTwoFactorCodeSMS(oldAuth);
      final GithubTwoFactorDialog dialog=new GithubTwoFactorDialog(project);
      ApplicationManager.getApplication().invokeAndWait(new Runnable(){
        @Override public void run(){
          DialogManager.show(dialog);
        }
      }
,indicator.getModalityState());
      if (!dialog.isOK()) {
        throw new GithubOperationCanceledException("Can't get two factor authentication code");
      }
      return oldAuth.copyWithTwoFactorCode(dialog.getCode());
    }
  }
);
}
