{
  if (myTemplate != null && myVelocityFileType != FileTypes.UNKNOWN) {
    return EditorHighlighterFactory.getInstance().createEditorHighlighter(myProject,new LightVirtualFile("aaa." + myTemplate.getExtension() + ".ft"));
  }
  FileType fileType=null;
  if (myTemplate != null) {
    fileType=FileTypeManager.getInstance().getFileTypeByExtension(myTemplate.getExtension());
  }
  if (fileType == null) {
    fileType=FileTypes.PLAIN_TEXT;
  }
  SyntaxHighlighter originalHighlighter=SyntaxHighlighterFactory.getSyntaxHighlighter(fileType,null,null);
  if (originalHighlighter == null) {
    originalHighlighter=new PlainSyntaxHighlighter();
  }
  final EditorColorsScheme scheme=EditorColorsManager.getInstance().getGlobalScheme();
  LayeredLexerEditorHighlighter highlighter=new LayeredLexerEditorHighlighter(new TemplateHighlighter(),scheme);
  highlighter.registerLayer(FileTemplateTokenType.TEXT,new LayerDescriptor(originalHighlighter,""));
  return highlighter;
}
