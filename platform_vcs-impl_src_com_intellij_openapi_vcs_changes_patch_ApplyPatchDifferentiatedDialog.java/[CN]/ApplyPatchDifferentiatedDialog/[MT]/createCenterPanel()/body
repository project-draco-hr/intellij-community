{
  if (myCenterPanel == null) {
    myCenterPanel=new JPanel(new GridBagLayout());
    final GridBagConstraints centralGb=createConstraints();
    myPatchFileLabel=new JLabel(VcsBundle.message("patch.apply.file.name.field"));
    myPatchFileLabel.setLabelFor(myPatchFile);
    myCenterPanel.add(myPatchFileLabel,centralGb);
    centralGb.fill=GridBagConstraints.HORIZONTAL;
    ++centralGb.gridy;
    myCenterPanel.add(myPatchFile,centralGb);
    JPanel treePanel=new JPanel(new GridBagLayout());
    final GridBagConstraints gb=createConstraints();
    final DefaultActionGroup group=new DefaultActionGroup();
    final AnAction[] treeActions=myChangesTreeList.getTreeActions();
    group.addAll(treeActions);
    group.add(new MapDirectory());
    final MyShowDiff diffAction=new MyShowDiff();
    diffAction.registerCustomShortcutSet(CommonShortcuts.getDiff(),getRootPane());
    group.add(diffAction);
    group.add(new StripUp());
    group.add(new StripDown());
    group.add(new ResetStrip());
    group.add(new ZeroStrip());
    if (myCanChangePatchFile) {
      group.add(new AnAction("Refresh","Refresh",AllIcons.Actions.Refresh){
        @Override public void actionPerformed(        AnActionEvent e){
          syncUpdatePatchFileAndScheduleReloadIfNeeded(null);
        }
      }
);
    }
    final ActionToolbar toolbar=ActionManager.getInstance().createActionToolbar("APPLY_PATCH",group,true);
    gb.fill=GridBagConstraints.HORIZONTAL;
    treePanel.add(toolbar.getComponent(),gb);
    ++gb.gridy;
    gb.weighty=1;
    gb.fill=GridBagConstraints.BOTH;
    treePanel.add(ScrollPaneFactory.createScrollPane(myChangesTreeList),gb);
    ++gb.gridy;
    gb.weighty=0;
    gb.fill=GridBagConstraints.NONE;
    gb.insets.bottom=UIUtil.DEFAULT_VGAP;
    treePanel.add(myCommitLegendPanel.getComponent(),gb);
    ++gb.gridy;
    Splitter splitter=new Splitter(true,0.7f);
    splitter.setFirstComponent(treePanel);
    splitter.setSecondComponent(myChangeListChooser);
    ++centralGb.gridy;
    centralGb.weighty=1;
    centralGb.fill=GridBagConstraints.BOTH;
    myCenterPanel.add(splitter,centralGb);
  }
  return myCenterPanel;
}
