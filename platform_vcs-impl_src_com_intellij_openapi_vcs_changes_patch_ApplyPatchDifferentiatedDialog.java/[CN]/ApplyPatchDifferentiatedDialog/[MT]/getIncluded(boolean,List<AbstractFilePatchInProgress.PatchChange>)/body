{
  final NamedTrinity totalTrinity=new NamedTrinity();
  final NamedTrinity includedTrinity=new NamedTrinity();
  final Collection<AbstractFilePatchInProgress.PatchChange> included=new LinkedList<AbstractFilePatchInProgress.PatchChange>();
  if (doInitCheck) {
    for (    AbstractFilePatchInProgress.PatchChange change : changes) {
      acceptChange(totalTrinity,change);
      final AbstractFilePatchInProgress abstractFilePatchInProgress=change.getPatchInProgress();
      if (abstractFilePatchInProgress.baseExistsOrAdded() && (myPreselectedChanges == null || myPreselectedChanges.contains(change))) {
        acceptChange(includedTrinity,change);
        included.add(change);
      }
    }
  }
 else {
    final Collection<AbstractFilePatchInProgress.PatchChange> includedNow=myChangesTreeList.getIncludedChanges();
    final Set<AbstractFilePatchInProgress> toBeIncluded=new HashSet<AbstractFilePatchInProgress>();
    for (    AbstractFilePatchInProgress.PatchChange change : includedNow) {
      final AbstractFilePatchInProgress patch=change.getPatchInProgress();
      toBeIncluded.add(patch);
    }
    for (    AbstractFilePatchInProgress.PatchChange change : changes) {
      final AbstractFilePatchInProgress patch=change.getPatchInProgress();
      acceptChange(totalTrinity,change);
      if (toBeIncluded.contains(patch) && patch.baseExistsOrAdded()) {
        acceptChange(includedTrinity,change);
        included.add(change);
      }
    }
  }
  myInfoCalculator.setTotal(totalTrinity);
  myInfoCalculator.setIncluded(includedTrinity);
  myCommitLegendPanel.update();
  return included;
}
