{
  final FilePresentationModel filePresentationModel=myRecentPathFileChange.get();
  final VirtualFile file=filePresentationModel != null ? filePresentationModel.getVf() : null;
  if (file == null) {
    ApplicationManager.getApplication().invokeLater(myReset,ModalityState.any());
    return;
  }
  final PatchReader patchReader=loadPatches(file);
  if (patchReader == null)   return;
  List<FilePatch> filePatches=ContainerUtil.<FilePatch>newArrayList(patchReader.getPatches());
  if (!ContainerUtil.isEmpty(myBinaryShelvedPatches)) {
    filePatches.addAll(myBinaryShelvedPatches);
  }
  final List<AbstractFilePatchInProgress> matchedPatches=new MatchPatchPaths(myProject).execute(filePatches,myUseProjectRootAsPredefinedBase);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      myChangeListChooser.setDefaultName(myCommitMessage != null ? myCommitMessage : file.getNameWithoutExtension().replace('_',' ').trim());
      myPatches.clear();
      myPatches.addAll(matchedPatches);
      myReader=patchReader;
      updateTree(true);
      paintBusy(false);
    }
  }
,ModalityState.any());
}
