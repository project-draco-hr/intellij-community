{
  if (ChangeListManager.getInstance(myProject).isFreezedWithNotification(null))   return;
  if (myPatches.isEmpty() || (!myContainBasedChanges))   return;
  final List<AbstractFilePatchInProgress.PatchChange> changes=getAllChanges();
  Collections.sort(changes,myMyChangeComparator);
  List<AbstractFilePatchInProgress.PatchChange> selectedChanges=myChangesTreeList.getSelectedChanges();
  int selectedIdx=0;
  final ArrayList<DiffRequestPresentable> diffRequestPresentableList=new ArrayList<DiffRequestPresentable>(changes.size());
  if (selectedChanges.isEmpty()) {
    selectedChanges=changes;
  }
  if (!selectedChanges.isEmpty()) {
    final AbstractFilePatchInProgress.PatchChange c=selectedChanges.get(0);
    for (    AbstractFilePatchInProgress.PatchChange change : changes) {
      final AbstractFilePatchInProgress patchInProgress=change.getPatchInProgress();
      if (!patchInProgress.baseExistsOrAdded())       continue;
      DiffRequestPresentable diffRequestPresentable;
      if (patchInProgress instanceof BinaryFilePatchInProgress) {
        final ShelvedBinaryFile file=((BinaryFilePatchInProgress)patchInProgress).getPatch().getShelvedBinaryFile();
        diffRequestPresentable=new DiffRequestPresentableProxy(){
          @NotNull @Override public DiffRequestPresentable init() throws VcsException {
            return new ChangeDiffRequestPresentable(myProject,file.createChange(myProject));
          }
          @Override public String getPathPresentation(){
            final File file1=new File(VfsUtilCore.virtualToIoFile(patchInProgress.getBase()),file.AFTER_PATH == null ? file.BEFORE_PATH : file.AFTER_PATH);
            return FileUtil.toSystemDependentName(file1.getPath());
          }
        }
;
      }
 else {
        final FilePatch patch=patchInProgress.getPatch();
        final String path=patch.getBeforeName() == null ? patch.getAfterName() : patch.getBeforeName();
        diffRequestPresentable=change.createDiffRequestPresentable(myProject,new Getter<CharSequence>(){
          @Override public CharSequence get(){
            return myReader.getBaseRevision(myProject,path);
          }
        }
);
      }
      if (diffRequestPresentable != null) {
        diffRequestPresentableList.add(diffRequestPresentable);
      }
      if (change.equals(c)) {
        selectedIdx=diffRequestPresentableList.size() - 1;
      }
    }
  }
  if (diffRequestPresentableList.isEmpty())   return;
  ShowDiffAction.showDiffImpl(myProject,diffRequestPresentableList,selectedIdx,new ShowDiffUIContext(false));
}
