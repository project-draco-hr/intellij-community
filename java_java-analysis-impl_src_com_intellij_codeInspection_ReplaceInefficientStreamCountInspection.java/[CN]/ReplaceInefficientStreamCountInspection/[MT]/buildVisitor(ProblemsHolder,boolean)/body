{
  if (!PsiUtil.isLanguageLevel8OrHigher(holder.getFile())) {
    return PsiElementVisitor.EMPTY_VISITOR;
  }
  return new JavaElementVisitor(){
    @Override public void visitMethodCallExpression(    PsiMethodCallExpression methodCall){
      final PsiMethod method=methodCall.resolveMethod();
      if (isCallOf(method,CommonClassNames.JAVA_UTIL_STREAM_STREAM,COUNT_METHOD,0)) {
        final PsiMethodCallExpression qualifierCall=getQualifierMethodCall(methodCall);
        if (qualifierCall == null)         return;
        final PsiMethod qualifier=qualifierCall.resolveMethod();
        final CountFix fix;
        if (isCallOf(qualifier,CommonClassNames.JAVA_UTIL_COLLECTION,STREAM_METHOD,0)) {
          fix=new CountFix(false);
        }
 else         if (isCallOf(qualifier,CommonClassNames.JAVA_UTIL_STREAM_STREAM,FLAT_MAP_METHOD,1) && doesFlatMapCallCollectionStream(qualifierCall)) {
          fix=new CountFix(true);
        }
 else {
          return;
        }
        PsiElement nameElement=methodCall.getMethodExpression().getReferenceNameElement();
        LOG.assertTrue(nameElement != null);
        holder.registerProblem(methodCall,nameElement.getTextRange().shiftRight(-methodCall.getTextOffset()),fix.getMessage(),fix);
      }
    }
  }
;
}
