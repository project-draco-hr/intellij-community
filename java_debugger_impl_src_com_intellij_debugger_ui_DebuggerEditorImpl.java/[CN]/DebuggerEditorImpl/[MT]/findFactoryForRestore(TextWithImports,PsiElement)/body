{
  List<CodeFragmentFactory> factories=DebuggerUtilsEx.getCodeFragmentFactories(context);
  if (myExplicitlyChosen && factories.contains(myFactory))   return myFactory;
  DefaultCodeFragmentFactory defaultFactory=DefaultCodeFragmentFactory.getInstance();
  factories.remove(defaultFactory);
  for (  CodeFragmentFactory factory : factories) {
    if (factory.getFileType().equals(text.getFileType())) {
      return factory;
    }
  }
  if (!factories.isEmpty())   return factories.get(0);
 else   return defaultFactory;
}
