{
  myIsAvailableTimeStamp=0;
  try {
    if (myIsDirectory) {
      myDirectory.createSubdirectory(myNewFileName);
    }
 else {
      String newFileName=myNewFileName;
      String newDirectories=null;
      if (myNewFileName.contains("/")) {
        int pos=myNewFileName.lastIndexOf("/");
        newFileName=myNewFileName.substring(pos + 1);
        newDirectories=myNewFileName.substring(0,pos);
      }
      PsiDirectory directory=myDirectory;
      if (newDirectories != null) {
        try {
          VfsUtil.createDirectoryIfMissing(myDirectory.getVirtualFile(),newDirectories);
          VirtualFile vfsDir=VfsUtil.findRelativeFile(myDirectory.getVirtualFile(),ArrayUtil.toStringArray(StringUtil.split(newDirectories,"/")));
          directory=new PsiDirectoryImpl((PsiManagerImpl)myDirectory.getManager(),vfsDir);
        }
 catch (        IOException e) {
          throw new IncorrectOperationException(e.getMessage());
        }
      }
      final PsiFile newFile=directory.createFile(newFileName);
      String text=getFileText();
      if (text != null) {
        final FileType type=FileTypeRegistry.getInstance().getFileTypeByFileName(newFileName);
        final PsiFile psiFile=PsiFileFactory.getInstance(project).createFileFromText("_" + newFileName,type,text);
        final PsiElement psiElement=CodeStyleManager.getInstance(project).reformat(psiFile);
        text=psiElement.getText();
      }
      openFile(project,directory,newFile,text);
    }
  }
 catch (  IncorrectOperationException e) {
    myIsAvailable=false;
  }
}
