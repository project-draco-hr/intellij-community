{
  final FileEditorManager editorManager=FileEditorManager.getInstance(directory.getProject());
  final FileEditor[] fileEditors=editorManager.openFile(newFile.getVirtualFile(),true);
  if (text != null) {
    for (    FileEditor fileEditor : fileEditors) {
      if (fileEditor instanceof TextEditor) {
        final Document document=((TextEditor)fileEditor).getEditor().getDocument();
        document.setText(text);
        if (ApplicationManager.getApplication().isUnitTestMode()) {
          FileDocumentManager.getInstance().saveDocument(document);
        }
        PsiDocumentManager.getInstance(project).commitDocument(document);
        break;
      }
    }
  }
}
