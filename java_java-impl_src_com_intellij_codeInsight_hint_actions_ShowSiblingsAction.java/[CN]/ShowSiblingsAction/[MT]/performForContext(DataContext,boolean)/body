{
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  final PsiFile file=CommonDataKeys.PSI_FILE.getData(dataContext);
  if (project == null)   return;
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final Editor editor=getEditor(dataContext);
  PsiElement element=getElement(project,file,editor,CommonDataKeys.PSI_ELEMENT.getData(dataContext));
  if (element == null && file == null)   return;
  PsiFile containingFile=element != null ? element.getContainingFile() : file;
  if (containingFile == null || !containingFile.getViewProvider().isPhysical())   return;
  if (editor != null) {
    PsiReference ref=TargetElementUtil.findReference(editor,editor.getCaretModel().getOffset());
    if (element == null && ref != null) {
      element=TargetElementUtil.getInstance().adjustReference(ref);
    }
  }
  final PsiElement[] superElements=findSuperElements(element);
  if (superElements.length == 0)   return;
  final boolean isMethod=superElements[0] instanceof PsiMethod;
  NavigatablePsiElement[] navigatablePsiElements=ContainerUtil.findAllAsArray(superElements,NavigatablePsiElement.class);
  final JBPopup popup=PsiElementListNavigator.navigateOrCreatePopup(navigatablePsiElements,"Choose super " + (isMethod ? "method" : "class or interface"),"Super " + (isMethod ? "methods" : "classes/interfaces"),isMethod ? new MethodCellRenderer(false) : new PsiClassListCellRenderer(),null,new Consumer<Object[]>(){
    @Override public void consume(    Object[] objects){
      showSiblings(invokedByShortcut,project,editor,file,editor != null,(PsiElement)objects[0]);
    }
  }
);
  if (popup != null) {
    if (editor != null) {
      popup.showInBestPositionFor(editor);
    }
 else {
      popup.showCenteredInCurrentWindow(project);
    }
  }
}
