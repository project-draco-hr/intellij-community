{
  this.template=template;
  final EditorFactory factory=EditorFactory.getInstance();
  Document doc=factory.createDocument(template.getTemplate());
  final FileType ftl=FileTypeManager.getInstance().findFileTypeByName("VTL");
  if (project != null && ftl != null) {
    final PsiFile file=PsiFileFactory.getInstance(project).createFileFromText(template.getFileName(),ftl,template.getTemplate(),LocalTimeCounter.currentTime(),true);
    if (!template.isDefault()) {
      final HashMap<String,PsiType> map=new LinkedHashMap<>();
      map.put("java_version",PsiType.INT);
      map.put("class",TemplatesManager.createElementType(project,ClassElement.class));
      if (multipleFields) {
        map.put("fields",TemplatesManager.createFieldListElementType(project));
      }
 else {
        map.put("field",TemplatesManager.createElementType(project,FieldElement.class));
      }
      map.put("helper",TemplatesManager.createElementType(project,GenerationHelper.class));
      map.put("settings",PsiType.NULL);
      map.putAll(contextMap);
      availableImplicits.addAll(map.keySet());
      file.getViewProvider().putUserData(TemplatesManager.TEMPLATE_IMPLICITS,map);
    }
    final Document document=PsiDocumentManager.getInstance(project).getDocument(file);
    if (document != null) {
      doc=document;
    }
  }
  myEditor=factory.createEditor(doc,project,ftl != null ? ftl : FileTypes.PLAIN_TEXT,template.isDefault());
}
