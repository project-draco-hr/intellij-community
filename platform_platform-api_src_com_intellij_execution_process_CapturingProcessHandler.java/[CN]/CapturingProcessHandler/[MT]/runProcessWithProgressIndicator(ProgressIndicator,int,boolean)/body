{
  final int WAIT_INTERVAL=100;
  int waitingTime=0;
  boolean destroying=false;
  startNotify();
  while (!waitFor(WAIT_INTERVAL)) {
    waitingTime+=WAIT_INTERVAL;
    boolean timeout=waitingTime >= timeoutInMilliseconds;
    if (indicator.isCanceled() || timeout) {
      destroying=!timeout || destroyOnTimeout;
      if (destroying && !isProcessTerminating() && !isProcessTerminated()) {
        destroyProcess();
      }
      if (timeout) {
        myOutput.setTimeout();
      }
 else {
        myOutput.setCancelled();
      }
      break;
    }
  }
  if (destroying) {
    if (waitFor()) {
      myOutput.setExitCode(getProcess().exitValue());
    }
 else {
      LOG.info("runProcess: exit value unavailable");
    }
  }
  return myOutput;
}
