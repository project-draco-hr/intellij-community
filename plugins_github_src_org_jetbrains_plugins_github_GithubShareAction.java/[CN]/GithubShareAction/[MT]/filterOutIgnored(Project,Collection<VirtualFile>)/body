{
  final ChangeListManager changeListManager=ChangeListManager.getInstance(project);
  final FileIndexFacade fileIndex=FileIndexFacade.getInstance(project);
  return ContainerUtil.filter(files,new Condition<VirtualFile>(){
    @Override public boolean value(    VirtualFile file){
      return !changeListManager.isIgnoredFile(file) && !fileIndex.isExcludedFile(file);
    }
  }
);
}
