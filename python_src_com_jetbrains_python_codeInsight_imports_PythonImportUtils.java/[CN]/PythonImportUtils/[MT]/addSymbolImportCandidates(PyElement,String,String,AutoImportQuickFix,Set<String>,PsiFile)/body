{
  Project project=node.getProject();
  List<PsiElement> symbols=new ArrayList<>();
  symbols.addAll(PyClassNameIndex.find(refText,project,true));
  GlobalSearchScope scope=PyProjectScopeBuilder.excludeSdkTestsScope(node);
  if (!isQualifier(node)) {
    symbols.addAll(PyFunctionNameIndex.find(refText,project,scope));
  }
  symbols.addAll(PyVariableNameIndex.find(refText,project,scope));
  if (isPossibleModuleReference(node)) {
    symbols.addAll(findImportableModules(node.getContainingFile(),refText,project,scope));
  }
  if (!symbols.isEmpty()) {
    for (    PsiElement symbol : symbols) {
      if (isIndexableTopLevel(symbol)) {
        PsiFileSystemItem srcfile=symbol instanceof PsiFileSystemItem ? ((PsiFileSystemItem)symbol).getParent() : symbol.getContainingFile();
        if (srcfile != null && isAcceptableForImport(node,existingImportFile,srcfile)) {
          QualifiedName importPath=QualifiedNameFinder.findCanonicalImportPath(symbol,node);
          if (importPath == null) {
            continue;
          }
          if (symbol instanceof PsiFileSystemItem) {
            importPath=importPath.removeTail(1);
          }
          final String symbolImportQName=importPath.append(refText).toString();
          if (!seenCandidateNames.contains(symbolImportQName)) {
            fix.addImport(symbol,srcfile,importPath,asName);
            seenCandidateNames.add(symbolImportQName);
          }
        }
      }
    }
  }
}
