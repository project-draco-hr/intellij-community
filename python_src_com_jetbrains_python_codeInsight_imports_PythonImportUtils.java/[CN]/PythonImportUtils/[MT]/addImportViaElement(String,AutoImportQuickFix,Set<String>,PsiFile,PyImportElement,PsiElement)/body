{
  PyFile sourceFile=as(PyUtil.turnDirIntoInit(source),PyFile.class);
  if (sourceFile instanceof PyFileImpl) {
    PsiElement res=sourceFile.findExportedName(refText);
    final String name=res instanceof PyQualifiedNameOwner ? ((PyQualifiedNameOwner)res).getQualifiedName() : null;
    if (name != null && seenCandidateNames.contains(name)) {
      return existingImportFile;
    }
    if (res != null && !(res instanceof PyFile) && !(res instanceof PyImportElement) && res.getContainingFile() != null && PsiTreeUtil.isAncestor(source,res.getContainingFile(),false)) {
      existingImportFile=sourceFile;
      fix.addImport(res,sourceFile,importElement);
      if (name != null) {
        seenCandidateNames.add(name);
      }
    }
  }
  return existingImportFile;
}
