{
  data.init();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  PsiManagerEx.getInstanceEx(getProject()).setAssertOnFileLoadingFilter(myVirtualFileFilter,getTestRootDisposable());
  try {
    Collection<HighlightInfo> infos=doHighlighting();
    String text=myEditor.getDocument().getText();
    data.checkLineMarkers(DaemonCodeAnalyzerImpl.getLineMarkers(getDocument(getFile()),getProject()),text);
    data.checkResult(infos,text);
    return infos;
  }
  finally {
    PsiManagerEx.getInstanceEx(getProject()).setAssertOnFileLoadingFilter(VirtualFileFilter.NONE,getTestRootDisposable());
  }
}
