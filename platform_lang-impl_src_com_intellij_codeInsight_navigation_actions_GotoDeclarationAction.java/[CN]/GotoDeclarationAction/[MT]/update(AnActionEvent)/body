{
  InputEvent inputEvent=event.getInputEvent();
  if (inputEvent instanceof MouseEvent) {
    Component component=inputEvent.getComponent();
    if (component != null) {
      Point point=((MouseEvent)inputEvent).getPoint();
      Component componentAt=SwingUtilities.getDeepestComponentAt(component,point.x,point.y);
      Project project=event.getProject();
      if (project == null) {
        event.getPresentation().setEnabled(false);
        return;
      }
      Editor editor=getBaseEditor(event.getDataContext(),project);
      if (componentAt instanceof EditorGutterComponentEx) {
        event.getPresentation().setEnabled(false);
        return;
      }
 else       if (editor != null && componentAt == editor.getContentComponent()) {
        LogicalPosition pos=editor.xyToLogicalPosition(SwingUtilities.convertPoint(component,point,componentAt));
        if (EditorUtil.inVirtualSpace(editor,pos)) {
          event.getPresentation().setEnabled(false);
          return;
        }
      }
    }
  }
  for (  GotoDeclarationHandler handler : Extensions.getExtensions(GotoDeclarationHandler.EP_NAME)) {
    try {
      String text=handler.getActionText(event.getDataContext());
      if (text != null) {
        Presentation presentation=event.getPresentation();
        presentation.setText(text);
        break;
      }
    }
 catch (    AbstractMethodError e) {
      LOG.error(handler.toString(),e);
    }
  }
  super.update(event);
}
