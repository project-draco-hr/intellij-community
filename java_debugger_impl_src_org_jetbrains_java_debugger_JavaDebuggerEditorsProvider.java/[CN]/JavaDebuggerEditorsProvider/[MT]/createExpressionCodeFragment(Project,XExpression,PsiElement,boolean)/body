{
  TextWithImports text=TextWithImportsImpl.fromXExpression(expression);
  if (text != null && context != null) {
    CodeFragmentFactory factory=DebuggerEditorImpl.findAppropriateFactory(text,context);
    JavaCodeFragment codeFragment=factory.createPresentationCodeFragment(text,context,project);
    codeFragment.forceResolveScope(GlobalSearchScope.allScope(project));
    if (context != null) {
      final PsiClass contextClass=PsiTreeUtil.getNonStrictParentOfType(context,PsiClass.class);
      if (contextClass != null) {
        final PsiClassType contextType=JavaPsiFacade.getInstance(codeFragment.getProject()).getElementFactory().createType(contextClass);
        codeFragment.setThisType(contextType);
      }
    }
    return codeFragment;
  }
 else {
    return super.createExpressionCodeFragment(project,expression,context,isPhysical);
  }
}
