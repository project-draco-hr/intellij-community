{
  TextWithImports text=TextWithImportsImpl.fromXExpression(expression);
  if (text != null) {
    CodeFragmentFactory factory=DebuggerUtilsEx.findAppropriateCodeFragmentFactory(text,context);
    JavaCodeFragment codeFragment=factory.createPresentationCodeFragment(text,context,project);
    codeFragment.forceResolveScope(GlobalSearchScope.allScope(project));
    final PsiClass contextClass=PsiTreeUtil.getNonStrictParentOfType(context,PsiClass.class);
    if (contextClass != null) {
      final PsiClassType contextType=JavaPsiFacade.getInstance(codeFragment.getProject()).getElementFactory().createType(contextClass);
      codeFragment.setThisType(contextType);
    }
    return codeFragment;
  }
 else {
    return super.createExpressionCodeFragment(project,expression,context,isPhysical);
  }
}
