{
  final MavenExecutionRequest request=embedder.createRequest(file,activeProfiles,Collections.<String>emptyList(),Collections.<String>emptyList());
  final StringWriter w=new StringWriter();
  embedder.executeWithMavenSession(request,new Runnable(){
    @Override public void run(){
      try {
        ProjectBuilder builder=embedder.getComponent(ProjectBuilder.class);
        ProjectBuildingResult buildingResult=builder.build(new File(file.getPath()),request.getProjectBuildingRequest());
        MavenProject project=buildingResult.getProject();
        XMLWriter writer=new PrettyPrintXMLWriter(w,StringUtils.repeat(" ",XmlWriterUtil.DEFAULT_INDENTATION_SIZE));
        writeHeader(writer);
        writeEffectivePom(project,writer);
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  return w.toString();
}
