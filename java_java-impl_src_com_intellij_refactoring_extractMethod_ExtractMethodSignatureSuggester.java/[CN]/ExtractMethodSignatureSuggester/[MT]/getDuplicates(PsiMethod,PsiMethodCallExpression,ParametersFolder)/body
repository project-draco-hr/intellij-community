{
  final List<Match> duplicates=findDuplicatesSignature(method,folder);
  if (duplicates != null && !duplicates.isEmpty()) {
    if (ApplicationManager.getApplication().isUnitTestMode() || new PreviewDialog(method,myExtractedMethod,methodCall,myMethodCall,duplicates.size()).showAndGet()) {
      PsiDocumentManager.getInstance(myProject).commitAllDocuments();
      WriteCommandAction.runWriteCommandAction(myProject,new Runnable(){
        @Override public void run(){
          myMethodCall=(PsiMethodCallExpression)methodCall.replace(myMethodCall);
          myExtractedMethod=(PsiMethod)method.replace(myExtractedMethod);
        }
      }
);
      final DuplicatesFinder finder=MethodDuplicatesHandler.createDuplicatesFinder(myExtractedMethod);
      if (finder != null) {
        final List<VariableData> datas=finder.getParameters().getInputVariables();
        myVariableData=datas.toArray(new VariableData[datas.size()]);
        return finder.findDuplicates(myExtractedMethod.getContainingClass());
      }
    }
  }
  return null;
}
