{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null) {
    return Collections.emptyList();
  }
  final Project project=file.getProject();
  PsiDirectory parent=file.getParent();
  final Module module=ModuleUtilCore.findModuleForPsiElement(parent == null ? file : parent);
  if (module == null) {
    return Collections.emptyList();
  }
  final FileReferenceHelper[] helpers=FileReferenceHelperRegistrar.getHelpers();
  final ArrayList<PsiFileSystemItem> list=new ArrayList<PsiFileSystemItem>();
  for (  FileReferenceHelper helper : helpers) {
    if (helper.isMine(project,virtualFile)) {
      if (helper.isFallback() && !list.isEmpty()) {
        continue;
      }
      final Collection<PsiFileSystemItem> roots=helper.getRoots(module);
      for (      PsiFileSystemItem root : roots) {
        LOG.assertTrue(root != null,"Helper " + helper + " produced a null root for "+ file);
      }
      list.addAll(roots);
    }
  }
  return list;
}
