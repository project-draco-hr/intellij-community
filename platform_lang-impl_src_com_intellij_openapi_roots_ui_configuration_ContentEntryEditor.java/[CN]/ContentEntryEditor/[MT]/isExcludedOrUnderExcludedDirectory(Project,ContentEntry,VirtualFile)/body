{
  Set<VirtualFile> excludedFiles=ContainerUtil.newHashSet(entry.getExcludeFolderFiles());
  if (project != null) {
    for (    DirectoryIndexExcludePolicy policy : DirectoryIndexExcludePolicy.getExtensions(project)) {
      ContainerUtil.addAllNotNull(excludedFiles,policy.getExcludeRootsForProject());
    }
  }
  Set<VirtualFile> sourceRoots=ContainerUtil.set(entry.getSourceFolderFiles());
  VirtualFile parent=file;
  while (parent != null) {
    if (excludedFiles.contains(parent))     return true;
    if (sourceRoots.contains(parent))     return false;
    parent=parent.getParent();
  }
  return false;
}
