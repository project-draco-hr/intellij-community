{
  final Map attrs=new HashMap();
  attrs.put("name",JUnit4ReflectionUtil.getMethodName(failure.getDescription()));
  try {
    final String trace=failure.getTrace();
    final ComparisonFailureData notification=createExceptionNotification(failure.getException());
    ComparisonFailureData.registerSMAttributes(notification,trace,failure.getMessage(),attrs);
  }
 catch (  Throwable e) {
    final StringWriter stringWriter=new StringWriter();
    final PrintWriter writer=new PrintWriter(stringWriter);
    e.printStackTrace(writer);
    ComparisonFailureData.registerSMAttributes(null,stringWriter.toString(),e.getMessage(),attrs);
  }
 finally {
    myPrintStream.println(ServiceMessage.asString(ServiceMessageTypes.TEST_FAILED,attrs));
  }
}
