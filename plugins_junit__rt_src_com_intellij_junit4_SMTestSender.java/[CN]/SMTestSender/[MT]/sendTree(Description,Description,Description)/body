{
  String className=JUnit4ReflectionUtil.getClassName(description);
  if (description.getChildren().isEmpty()) {
    final String methodName=JUnit4ReflectionUtil.getMethodName((Description)description);
    if (methodName != null) {
      if (isWarning(methodName,className)) {
        className=JUnit4ReflectionUtil.getClassName(parent);
        myEmptyTests.add(getShortName(className));
      }
      myPrintStream.println("##teamcity[suiteTreeNode name=\'" + escapeName(methodName) + "\' "+ getTestMethodLocation(methodName,className)+ "]");
    }
    if (suiteParent != null) {
      final String parentFQName=JUnit4ReflectionUtil.getClassName(suiteParent);
      if (!myCurrentClassName.equals(parentFQName)) {
        List parents=(List)myParents.get(description);
        if (parents == null) {
          parents=new ArrayList();
          myParents.put(description,parents);
        }
        if (!parents.contains(parentFQName)) {
          parents.add(parentFQName);
        }
        List descriptors=(List)mySuites.get(parentFQName);
        if (descriptors == null) {
          descriptors=new ArrayList();
          mySuites.put(parentFQName,descriptors);
        }
        descriptors.add(description);
      }
    }
    return;
  }
  List tests=description.getChildren();
  boolean pass=false;
  for (Iterator iterator=tests.iterator(); iterator.hasNext(); ) {
    final Object next=iterator.next();
    final Description nextDescription=(Description)next;
    final List childTests=nextDescription.getChildren();
    if ((myCurrentClassName == null || !myCurrentClassName.equals(className)) && !pass) {
      pass=true;
      String locationHint=className;
      if (isParameter((Description)description)) {
        final String displayName=nextDescription.getDisplayName();
        final int paramIdx=displayName.indexOf(locationHint);
        if (paramIdx > -1) {
          locationHint=displayName.substring(paramIdx + locationHint.length());
          if (locationHint.startsWith("(") && locationHint.endsWith(")")) {
            locationHint=locationHint.substring(1,locationHint.length() - 1) + "." + className;
          }
        }
      }
      myPrintStream.println("##teamcity[suiteTreeStarted name=\'" + escapeName(getShortName(className)) + "\' locationHint=\'java:suite://"+ escapeName(locationHint)+ "\']");
    }
    sendTree(nextDescription,description,isParameter(description) ? null : childTests.isEmpty() && parent != null ? parent : description);
  }
  if (pass) {
    myPrintStream.println("##teamcity[suiteTreeEnded name=\'" + escapeName(getShortName(JUnit4ReflectionUtil.getClassName((Description)description))) + "\']");
  }
}
