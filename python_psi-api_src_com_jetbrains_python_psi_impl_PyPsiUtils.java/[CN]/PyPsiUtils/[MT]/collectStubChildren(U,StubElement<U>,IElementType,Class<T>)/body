{
  final List<T> result=new ArrayList<T>();
  if (stub != null) {
    final List<StubElement> children=stub.getChildrenStubs();
    for (    StubElement child : children) {
      if (child.getStubType() == elementType) {
        result.add((T)child.getPsi());
      }
    }
  }
 else {
    e.acceptChildren(new TopLevelVisitor(){
      @Override protected void checkAddElement(      PsiElement node){
        if (node.getNode().getElementType() == elementType) {
          result.add((T)node);
        }
      }
    }
);
  }
  return result;
}
