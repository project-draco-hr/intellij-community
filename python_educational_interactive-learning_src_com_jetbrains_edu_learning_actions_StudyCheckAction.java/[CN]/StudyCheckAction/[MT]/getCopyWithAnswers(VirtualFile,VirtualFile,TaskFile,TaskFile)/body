{
  VirtualFile copy=null;
  try {
    copy=file.copy(this,taskDir,file.getNameWithoutExtension() + ANSWERS_POSTFIX);
    final FileDocumentManager documentManager=FileDocumentManager.getInstance();
    final Document document=documentManager.getDocument(copy);
    if (document != null) {
      TaskFile.copy(source,target);
      StudyDocumentListener listener=new StudyDocumentListener(target);
      document.addDocumentListener(listener);
      for (      AnswerPlaceholder answerPlaceholder : target.getAnswerPlaceholders()) {
        if (!answerPlaceholder.isValid(document)) {
          continue;
        }
        final int start=answerPlaceholder.getRealStartOffset(document);
        final int end=start + answerPlaceholder.getLength();
        final String text=answerPlaceholder.getPossibleAnswer();
        document.replaceString(start,end,text);
      }
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          documentManager.saveDocument(document);
        }
      }
);
    }
  }
 catch (  IOException e) {
    LOG.error(e);
  }
  return copy;
}
