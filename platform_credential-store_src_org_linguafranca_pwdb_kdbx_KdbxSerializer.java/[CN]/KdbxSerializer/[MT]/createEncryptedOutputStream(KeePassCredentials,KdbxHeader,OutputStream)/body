{
  writeKdbxHeader(kdbxHeader,outputStream);
  OutputStream encryptedOutputStream=kdbxHeader.createEncryptedStream(credentials.getKey(),outputStream);
  new LittleEndianDataOutputStream(encryptedOutputStream).write(kdbxHeader.getStreamStartBytes());
  HashedBlockOutputStream blockOutputStream=new HashedBlockOutputStream(encryptedOutputStream);
  if (kdbxHeader.getCompressionFlags().equals(KdbxHeader.CompressionFlags.NONE)) {
    return blockOutputStream;
  }
  return new GZIPOutputStream(blockOutputStream);
}
