{
  writeKdbxHeader(kdbxHeader,outputStream);
  OutputStream encryptedOutputStream=kdbxHeader.createEncryptedStream(credentials.getKey(),outputStream);
  writeStartBytes(kdbxHeader,encryptedOutputStream);
  HashedBlockOutputStream blockOutputStream=new HashedBlockOutputStream(encryptedOutputStream,true);
  if (kdbxHeader.getCompressionFlags().equals(KdbxHeader.CompressionFlags.NONE)) {
    return blockOutputStream;
  }
  return new GZIPOutputStream(blockOutputStream);
}
