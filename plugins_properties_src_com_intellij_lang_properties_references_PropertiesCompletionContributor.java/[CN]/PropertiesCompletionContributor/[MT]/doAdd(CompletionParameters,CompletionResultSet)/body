{
  PsiElement position=parameters.getPosition();
  PsiReference[] references=ArrayUtil.mergeArrays(position.getReferences(),position.getParent().getReferences());
  PropertyReference propertyReference=ContainerUtil.findInstance(references,PropertyReference.class);
  if (propertyReference != null && !hasMoreImportantReference(references,propertyReference)) {
    final int startOffset=parameters.getOffset();
    PsiElement element=propertyReference.getElement();
    final int offsetInElement=startOffset - element.getTextRange().getStartOffset();
    TextRange range=propertyReference.getRangeInElement();
    if (offsetInElement >= range.getStartOffset()) {
      final String prefix=element.getText().substring(range.getStartOffset(),offsetInElement);
      LookupElement[] variants=getVariants(propertyReference);
      result.withPrefixMatcher(prefix).addAllElements(Arrays.asList(variants));
    }
  }
}
