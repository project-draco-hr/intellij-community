{
  PsiElement position=parameters.getPosition();
  PsiReference[] references=ArrayUtil.mergeArrays(position.getReferences(),position.getParent().getReferences());
  PropertyReference propertyReference=(PropertyReference)ContainerUtil.find(references,PROPERTY_REFERENCE);
  if (propertyReference != null) {
    final int startOffset=parameters.getOffset();
    PsiElement element=propertyReference.getElement();
    final int offsetInElement=startOffset - element.getTextRange().getStartOffset();
    TextRange range=propertyReference.getRangeInElement();
    final String prefix=element.getText().substring(range.getStartOffset(),offsetInElement);
    LookupElement[] variants=getVariants(propertyReference);
    result.withPrefixMatcher(prefix).addAllElements(Arrays.asList(variants));
    if (variants.length != 0) {
      result.stopHere();
    }
  }
}
