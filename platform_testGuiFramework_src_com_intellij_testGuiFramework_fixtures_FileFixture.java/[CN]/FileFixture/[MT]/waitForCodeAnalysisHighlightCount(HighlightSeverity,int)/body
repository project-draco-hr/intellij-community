{
  final Document document=getNotNullDocument();
  pause(new Condition("Waiting for code analysis " + severity + " count to reach "+ expected){
    @Override public boolean test(){
      Collection<HighlightInfo> highlightInfos=execute(new GuiQuery<Collection<HighlightInfo>>(){
        @Override protected Collection<HighlightInfo> executeInEDT() throws Throwable {
          CommonProcessors.CollectProcessor<HighlightInfo> processor=new CommonProcessors.CollectProcessor<HighlightInfo>();
          DaemonCodeAnalyzerEx.processHighlights(document,myProject,severity,0,document.getTextLength(),processor);
          return processor.getResults();
        }
      }
);
      assertNotNull(highlightInfos);
      return highlightInfos.size() == expected;
    }
  }
,SHORT_TIMEOUT);
  return this;
}
