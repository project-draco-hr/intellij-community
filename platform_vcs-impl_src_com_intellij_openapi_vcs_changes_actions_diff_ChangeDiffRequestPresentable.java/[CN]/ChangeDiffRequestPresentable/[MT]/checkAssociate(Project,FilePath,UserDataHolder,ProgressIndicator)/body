{
  final String pattern=FileUtilRt.getExtension(file.getName()).toLowerCase();
  if (getSkippedExtensionsFromContext(context).contains(pattern)) {
    throw new DiffRequestPresentableException("Unknown file type");
  }
  final boolean[] ret=new boolean[1];
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      int result=Messages.showOkCancelDialog(project,VcsBundle.message("diff.unknown.file.type.prompt",file.getName()),VcsBundle.message("diff.unknown.file.type.title"),VcsBundle.message("diff.unknown.file.type.associate"),CommonBundle.getCancelButtonText(),Messages.getQuestionIcon());
      if (result == Messages.OK) {
        FileType fileType=FileTypeChooser.associateFileType(file.getName());
        ret[0]=fileType != null && !FileTypes.UNKNOWN.equals(fileType);
      }
 else {
        getSkippedExtensionsFromContext(context).add(pattern);
        ret[0]=false;
      }
    }
  }
,indicator.getModalityState());
  if (!ret[0])   throw new DiffRequestPresentableException("Unknown file type");
}
