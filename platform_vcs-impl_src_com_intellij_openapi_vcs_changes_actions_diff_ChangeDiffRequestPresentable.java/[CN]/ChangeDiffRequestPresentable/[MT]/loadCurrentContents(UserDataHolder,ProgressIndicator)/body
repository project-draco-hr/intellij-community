{
  final ContentRevision bRev=myChange.getBeforeRevision();
  final ContentRevision aRev=myChange.getAfterRevision();
  if (bRev == null && aRev == null) {
    LOG.warn("Both revision contents are empty");
    throw new DiffRequestPresentableException("Bad revisions contents");
  }
  if (bRev != null)   checkContentRevision(bRev,context,indicator);
  if (aRev != null)   checkContentRevision(aRev,context,indicator);
  String title=getRequestTitle(bRev,aRev);
  indicator.setIndeterminate(true);
  DiffContent content1=createContent(bRev,indicator);
  DiffContent content2=createContent(aRev,indicator);
  String beforeRevisionTitle=getRevisionTitle(bRev,"Base version");
  String afterRevisionTitle=getRevisionTitle(aRev,"Your version");
  SimpleDiffRequest request=new SimpleDiffRequest(title,content1,content2,beforeRevisionTitle,afterRevisionTitle);
  request.putUserData(CONTENT_REVISIONS,new ContentRevision[]{aRev,bRev});
  for (  Map.Entry<Key,Object> entry : myContext.entrySet()) {
    request.putUserData(entry.getKey(),entry.getValue());
  }
  GenericDataProvider dataProvider=new GenericDataProvider();
  dataProvider.putData(VcsDataKeys.CURRENT_CHANGE,myChange);
  request.putUserData(DiffUserDataKeys.DATA_PROVIDER,dataProvider);
  return request;
}
