{
  if (file != null) {
    VirtualFile virtualFile=file.getVirtualFile();
    if (virtualFile != null) {
      PyUtil.deletePycFiles(virtualFile.getPath());
    }
    final Collection<VirtualFile> roots=PyUtil.getSourceRoots(file);
    PsiDirectory root=moveDestination;
    while (root != null && !roots.contains(root.getVirtualFile())) {
      root=root.getParentDirectory();
    }
    final boolean searchForReferences=RefactoringSettings.getInstance().MOVE_SEARCH_FOR_REFERENCES_FOR_FILE;
    if (moveDestination != root && root != null && searchForReferences && !probablyNamespacePackage(file,moveDestination,root)) {
      CreatePackageAction.createInitPyInHierarchy(moveDestination,root);
    }
    if (file instanceof PyFile) {
      updateRelativeImportsInModule((PyFile)file);
    }
  }
}
