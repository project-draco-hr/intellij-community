{
  myStorageLock.lock();
  try {
    StateStorage stateStorage=myStorages.get(fileSpec);
    if (stateStorage == null) {
      stateStorage=createStateStorage(StateStorage.class,fileSpec,roamingType,StateSplitterEx.class);
      myStorages.put(fileSpec,stateStorage);
    }
    return stateStorage;
  }
  finally {
    myStorageLock.unlock();
  }
}
