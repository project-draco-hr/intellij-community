{
  final ModalityState modalityState=ModalityState.current();
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      performWhenAllCommitted(new Runnable(){
        @Override public void run(){
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            @Override public void run(){
              if (hasUncommitedDocuments()) {
                performLaterWhenAllCommitted(runnable);
              }
 else {
                runnable.run();
              }
            }
          }
,modalityState,myProject.getDisposed());
        }
      }
);
    }
  }
);
}
