{
  VirtualFile vFile=getVirtualFile(document);
  if (vFile == null || isFreeThreaded(vFile))   return false;
  FileViewProvider viewProvider=getCachedViewProvider(document);
  return viewProvider != null && viewProvider.isEventSystemEnabled();
}
