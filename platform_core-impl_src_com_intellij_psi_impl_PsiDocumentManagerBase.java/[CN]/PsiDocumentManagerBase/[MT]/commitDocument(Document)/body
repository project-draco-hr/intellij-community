{
  if (!((TransactionGuardImpl)TransactionGuard.getInstance()).isWriteActionAllowed()) {
    LOG.error("Write access is not allowed in this context, see TransactionGuard documentation for details");
  }
  final Document document=doc instanceof DocumentWindow ? ((DocumentWindow)doc).getDelegate() : doc;
  if (!isCommitted(document)) {
    doCommit(document);
  }
}
