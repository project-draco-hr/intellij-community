{
  Library.ModifiableModel modifiableModel=lib.getModifiableModel();
  for (  String root : lib.getUrls(OrderRootType.CLASSES)) {
    modifiableModel.removeRoot(root,OrderRootType.CLASSES);
  }
  Set<VirtualFile> roots=new HashSet<VirtualFile>();
  ProjectRootManager rootManager=ProjectRootManager.getInstance(project);
  Collections.addAll(roots,rootManager.getContentRoots());
  Collections.addAll(roots,rootManager.getContentSourceRoots());
  if (paths != null) {
    for (    String dir : paths) {
      VirtualFile pathEntry=LocalFileSystem.getInstance().findFileByPath(dir);
      if (pathEntry != null && !pathEntry.isDirectory() && pathEntry.getFileType() instanceof ArchiveFileType) {
        pathEntry=JarFileSystem.getInstance().getJarRootForLocalFile(pathEntry);
      }
      if (pathEntry != null && roots.contains(pathEntry)) {
        continue;
      }
      if (pathEntry != null) {
        modifiableModel.addRoot(pathEntry,OrderRootType.CLASSES);
      }
 else {
        modifiableModel.addRoot("file://" + dir,OrderRootType.CLASSES);
      }
    }
  }
  modifiableModel.commit();
}
