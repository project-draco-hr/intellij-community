{
  final BuildoutFacet facet=myModule != null ? BuildoutFacet.getInstance(myModule) : null;
  final boolean got_facet=facet != null;
  boolean facet_is_desired=myEnabledCheckbox.isSelected();
  mySettingsPanel.apply();
  String script_name=mySettingsPanel.getScriptName();
  VirtualFile script_file=LocalFileSystem.getInstance().findFileByPath(script_name);
  if (script_file == null || script_file.isDirectory()) {
    throw new ConfigurationException("Invalid script file '" + script_name + "'");
  }
  List<String> paths_from_script=BuildoutFacet.extractFromScript(script_file);
  if (paths_from_script == null) {
    throw new ConfigurationException("Failed to extract paths from '" + script_file.getPresentableName() + "'");
  }
  mySettingsPanel.getConfiguration().setPaths(paths_from_script);
  if (facet_is_desired && !got_facet)   addFacet();
  if (!facet_is_desired && got_facet)   removeFacet(facet);
  if (facet_is_desired)   attachLibrary(paths_from_script);
 else   detachLibrary();
}
