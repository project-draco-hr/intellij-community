{
  final BuildoutFacet facet=myModule != null ? BuildoutFacet.getInstance(myModule) : null;
  final boolean got_facet=facet != null;
  boolean facet_is_desired=myEnabledCheckbox.isSelected();
  mySettingsPanel.apply();
  List<String> paths_from_script=null;
  if (facet_is_desired) {
    String script_name=mySettingsPanel.getScriptName();
    VirtualFile script_file=LocalFileSystem.getInstance().findFileByPath(script_name);
    if (script_file == null || script_file.isDirectory()) {
      throw new ConfigurationException("Invalid script file '" + script_name + "'");
    }
    paths_from_script=BuildoutFacet.extractBuildoutPaths(script_file);
    if (paths_from_script == null) {
      throw new ConfigurationException("Failed to extract paths from '" + script_file.getPresentableName() + "'");
    }
    mySettingsPanel.getConfiguration().setPaths(paths_from_script);
  }
  if (facet_is_desired && !got_facet)   addFacet(mySettingsPanel.getConfiguration());
  if (!facet_is_desired && got_facet)   removeFacet(facet);
  if (facet_is_desired)   attachLibrary(myModule);
 else   detachLibrary(myModule);
}
