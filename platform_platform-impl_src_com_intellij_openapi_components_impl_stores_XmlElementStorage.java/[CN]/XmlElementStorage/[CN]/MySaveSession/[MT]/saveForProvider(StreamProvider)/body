{
  RoamingType roamingType=getRoamingType();
  if (roamingType != null && roamingType == RoamingType.DISABLED) {
    return;
  }
  if (!streamProvider.isApplicable(myFileSpec,roamingType == null ? RoamingType.PER_USER : roamingType)) {
    return;
  }
  Element element=getElementToSave();
  if (element == null || element.getChildren().isEmpty()) {
    streamProvider.delete(myFileSpec,roamingType == null ? RoamingType.PER_USER : roamingType);
    if (roamingType == null) {
      streamProvider.delete(myFileSpec,RoamingType.PER_PLATFORM);
    }
    return;
  }
  if (roamingType != null) {
    doSaveForProvider(element,roamingType,streamProvider);
    return;
  }
  if (!myFileSpec.equals(StoragePathMacros.WORKSPACE_FILE) && element.getContent(new RoamingElementFilter(RoamingType.DISABLED)).iterator().hasNext()) {
    return;
  }
  RoamingElementFilter perPlatformFilter=new RoamingElementFilter(RoamingType.PER_PLATFORM);
  if (element.getContent(perPlatformFilter).iterator().hasNext()) {
    doSaveForProvider(element,new RoamingElementFilter(RoamingType.PER_USER));
    doSaveForProvider(element,perPlatformFilter);
  }
 else {
    doSaveForProvider(element,RoamingType.PER_USER,streamProvider);
  }
}
