{
  HttpsURLConnection connection=(HttpsURLConnection)url.openConnection();
  connection.setSSLSocketFactory(ourSslContext.getSocketFactory());
  if (!(SystemInfo.isJavaVersionAtLeast("1.7") && SystemProperties.getBooleanProperty("jsse.enableSNIExtension",true))) {
    connection.setHostnameVerifier(new EaHostnameVerifier(url.getHost(),"ftp.intellij.net"));
  }
  connection.setRequestMethod("POST");
  connection.setDoInput(true);
  connection.setDoOutput(true);
  connection.setRequestProperty("Content-Type","application/x-www-form-urlencoded; charset=" + ENCODING);
  connection.setRequestProperty("Content-Length",Integer.toString(bytes.length));
  OutputStream out=connection.getOutputStream();
  try {
    out.write(bytes);
  }
  finally {
    out.close();
  }
  return connection;
}
