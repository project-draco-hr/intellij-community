{
  Project project=getProject();
  if (project == null || project.isDisposed()) {
    return null;
  }
  VirtualFile root=HgUtil.getRootForSelectedFile(project);
  HgRepository repository=HgUtil.getRepositoryManager(project).getRepositoryForRoot(root);
  if (repository != null) {
    return HgBranchPopup.getInstance(project,repository).asListPopup();
  }
  return null;
}
