{
  final String homePath=sdk.getHomePath();
  if (homePath == null) {
    return new DummyPackageManager(sdk);
  }
  PyPackageManagerImpl manager=myInstances.get(homePath);
  if (manager == null) {
    if (PythonSdkType.isRemote(sdk)) {
      manager=new PyRemotePackageManagerImpl(sdk);
    }
 else     if (PyCondaPackageManagerImpl.isCondaVEnv(sdk) && PyCondaPackageService.getCondaExecutable(sdk.getHomeDirectory()) != null) {
      manager=new PyCondaPackageManagerImpl(sdk);
    }
 else {
      manager=new PyPackageManagerImpl(sdk);
    }
    if (sdkIsSetUp(sdk))     myInstances.put(homePath,manager);
  }
  return manager;
}
