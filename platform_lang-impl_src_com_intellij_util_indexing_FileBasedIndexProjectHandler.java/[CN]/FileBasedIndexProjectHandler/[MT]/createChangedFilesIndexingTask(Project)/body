{
  final FileBasedIndexImpl index=(FileBasedIndexImpl)FileBasedIndex.getInstance();
  final Collection<VirtualFile> files=index.getFilesToUpdate(project);
  if (files.size() + index.getNumberOfPendingInvalidations() < 20) {
    return null;
  }
  return new DumbModeTask(){
    @Override public void performInDumbMode(    @NotNull ProgressIndicator indicator){
      CacheUpdateRunner.processFiles(indicator,true,files,project,new Consumer<FileContent>(){
        @Override public void consume(        FileContent content){
          index.processRefreshedFile(project,content);
        }
      }
);
    }
  }
;
}
