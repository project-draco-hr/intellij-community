{
  if (!Registry.is(getFrameworkId() + "_sm_runner")) {
    return null;
  }
  getJavaParameters().getVMParametersList().addProperty("idea." + getFrameworkId() + ".sm_runner");
  getJavaParameters().getClassPath().add(PathUtil.getJarPathForClass(ServiceMessageTypes.class));
  final RunnerSettings runnerSettings=getRunnerSettings();
  final TestConsoleProperties testConsoleProperties=new SMTRunnerConsoleProperties(getConfiguration(),getFrameworkName(),executor);
  testConsoleProperties.setIfUndefined(TestConsoleProperties.HIDE_PASSED_TESTS,false);
  final BaseTestsOutputConsoleView consoleView=SMTestRunnerConnectionUtil.createConsoleWithCustomLocator(getFrameworkName(),testConsoleProperties,getEnvironment(),null);
  Disposer.register(getConfiguration().getProject(),consoleView);
  final OSProcessHandler handler=createHandler(executor);
  consoleView.attachToProcess(handler);
  handler.addProcessListener(new ProcessAdapter(){
    @Override public void processTerminated(    ProcessEvent event){
      Runnable runnable=new Runnable(){
        public void run(){
          final SMTestRunnerResultsForm viewer=((SMTRunnerConsoleView)consoleView).getResultsViewer();
          if (viewer.hasTestSuites() || !ResetConfigurationModuleAdapter.tryWithAnotherModule(getConfiguration(),testConsoleProperties.isDebug())) {
            TestsUIUtil.notifyByBalloon(testConsoleProperties.getProject(),viewer.hasTestSuites(),viewer.getRoot(),testConsoleProperties,null);
          }
        }
      }
;
      SwingUtilities.invokeLater(runnable);
      handler.removeProcessListener(this);
    }
  }
);
  AbstractRerunFailedTestsAction rerunFailedTestsAction=createRerunFailedTestsAction(testConsoleProperties,consoleView);
  rerunFailedTestsAction.setModelProvider(new Getter<TestFrameworkRunningModel>(){
    @Override public TestFrameworkRunningModel get(){
      return ((SMTRunnerConsoleView)consoleView).getResultsViewer();
    }
  }
);
  final DefaultExecutionResult result=new DefaultExecutionResult(consoleView,handler);
  result.setRestartActions(rerunFailedTestsAction);
  JavaRunConfigurationExtensionManager.getInstance().attachExtensionsToProcess(getConfiguration(),handler,runnerSettings);
  return result;
}
