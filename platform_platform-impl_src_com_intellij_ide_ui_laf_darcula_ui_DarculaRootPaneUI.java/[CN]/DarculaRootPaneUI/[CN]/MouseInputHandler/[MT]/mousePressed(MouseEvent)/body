{
  JRootPane rootPane=getRootPane();
  if (rootPane.getWindowDecorationStyle() == JRootPane.NONE) {
    return;
  }
  Point dragWindowOffset=ev.getPoint();
  Window w=(Window)ev.getSource();
  if (w != null) {
    w.toFront();
  }
  Point convertedDragWindowOffset=SwingUtilities.convertPoint(w,dragWindowOffset,getTitlePane());
  Frame f=null;
  Dialog d=null;
  if (w instanceof Frame) {
    f=(Frame)w;
  }
 else   if (w instanceof Dialog) {
    d=(Dialog)w;
  }
  int frameState=(f != null) ? f.getExtendedState() : 0;
  if ((getTitlePane() != null) && getTitlePane().contains(convertedDragWindowOffset)) {
    if ((((f != null) && ((frameState & Frame.MAXIMIZED_BOTH) == 0)) || (d != null)) && (dragWindowOffset.y >= BORDER_DRAG_THICKNESS) && (dragWindowOffset.x >= BORDER_DRAG_THICKNESS)&& (dragWindowOffset.x < w.getWidth() - BORDER_DRAG_THICKNESS)) {
      isMovingWindow=true;
      dragOffsetX=dragWindowOffset.x;
      dragOffsetY=dragWindowOffset.y;
    }
  }
 else   if (((f != null) && f.isResizable() && ((frameState & Frame.MAXIMIZED_BOTH) == 0)) || ((d != null) && d.isResizable())) {
    dragOffsetX=dragWindowOffset.x;
    dragOffsetY=dragWindowOffset.y;
    dragWidth=w.getWidth();
    dragHeight=w.getHeight();
    dragCursor=getCursor(calculateCorner(w,dragWindowOffset.x,dragWindowOffset.y));
  }
}
