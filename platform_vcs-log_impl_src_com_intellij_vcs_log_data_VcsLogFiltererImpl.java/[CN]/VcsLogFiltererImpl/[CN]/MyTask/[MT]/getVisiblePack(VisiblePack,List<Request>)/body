{
  int invalidateRequest=ContainerUtil.lastIndexOfInstance(requests,InvalidateRequest.class);
  int refreshRequest=ContainerUtil.lastIndexOfInstance(requests,RefreshRequest.class);
  FilterRequest filterRequest=ContainerUtil.findLastInstance(requests,FilterRequest.class);
  SortTypeRequest sortTypeRequest=ContainerUtil.findLastInstance(requests,SortTypeRequest.class);
  List<MoreCommitsRequest> moreCommitsRequests=ContainerUtil.findAll(requests,MoreCommitsRequest.class);
  myRequestsToRun.addAll(moreCommitsRequests);
  if (filterRequest != null) {
    myFilters=filterRequest.filters;
  }
  if (sortTypeRequest != null) {
    mySortType=sortTypeRequest.sortType;
  }
  if (!myIsValid) {
    if (refreshRequest > invalidateRequest) {
      myIsValid=true;
      return refresh(visiblePack,filterRequest,moreCommitsRequests);
    }
 else {
      return visiblePack;
    }
  }
 else {
    if (refreshRequest >= invalidateRequest) {
      return refresh(visiblePack,filterRequest,moreCommitsRequests);
    }
 else {
      myIsValid=false;
      VisiblePack frozenVisiblePack=visiblePack == null ? myVisiblePack : visiblePack;
      if (filterRequest != null) {
        frozenVisiblePack=refresh(visiblePack,filterRequest,moreCommitsRequests);
      }
      return new FakeVisiblePackBuilder(myLogData.getHashMap()).build(frozenVisiblePack);
    }
  }
}
