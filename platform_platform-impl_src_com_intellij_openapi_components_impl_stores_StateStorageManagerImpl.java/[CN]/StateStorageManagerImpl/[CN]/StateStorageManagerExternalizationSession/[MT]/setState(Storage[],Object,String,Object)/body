{
  StateStorageChooserEx stateStorageChooser=component instanceof StateStorageChooserEx ? (StateStorageChooserEx)component : null;
  for (  Storage storageSpec : storageSpecs) {
    Resolution resolution=stateStorageChooser == null ? Resolution.DO : stateStorageChooser.getResolution(storageSpec,StateStorageOperation.WRITE);
    if (resolution == Resolution.SKIP) {
      continue;
    }
    StateStorage stateStorage=getStateStorage(storageSpec);
    StateStorage.ExternalizationSession session=getExternalizationSession(stateStorage);
    if (session != null) {
      session.setState(component,componentName,storageSpec.deprecated() || resolution == Resolution.CLEAR ? new Element("empty") : state,storageSpec);
    }
  }
}
