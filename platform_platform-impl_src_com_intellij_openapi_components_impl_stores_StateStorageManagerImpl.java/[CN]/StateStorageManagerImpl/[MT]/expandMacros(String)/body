{
  String expanded=file;
  for (  String macro : myMacros.keySet()) {
    expanded=StringUtil.replace(expanded,macro,myMacros.get(macro));
  }
  if (!ApplicationManager.getApplication().isUnitTestMode()) {
    final Matcher matcher=MACRO_PATTERN.matcher(expanded);
    while (matcher.find()) {
      String m=matcher.group(1);
      if (m != null && !myMacros.containsKey(m)) {
        throw new IllegalArgumentException("Unknown macro: " + m + " in storage file spec: "+ file);
      }
    }
  }
  return expanded;
}
