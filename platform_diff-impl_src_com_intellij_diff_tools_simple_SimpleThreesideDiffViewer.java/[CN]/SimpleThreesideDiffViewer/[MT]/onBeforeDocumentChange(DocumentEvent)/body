{
  super.onBeforeDocumentChange(e);
  if (myDiffChanges.isEmpty())   return;
  ThreeSide side;
  if (e.getDocument() == myEditors.get(0).getDocument()) {
    side=ThreeSide.LEFT;
  }
 else   if (e.getDocument() == myEditors.get(1).getDocument()) {
    side=ThreeSide.BASE;
  }
 else   if (e.getDocument() == myEditors.get(2).getDocument()) {
    side=ThreeSide.RIGHT;
  }
 else {
    LOG.warn("Unknown document changed");
    return;
  }
  int offset1=e.getOffset();
  int offset2=e.getOffset() + e.getOldLength();
  if (StringUtil.endsWithChar(e.getOldFragment(),'\n') && StringUtil.endsWithChar(e.getNewFragment(),'\n')) {
    offset2--;
  }
  int line1=e.getDocument().getLineNumber(offset1);
  int line2=e.getDocument().getLineNumber(offset2) + 1;
  int shift=StringUtil.countNewLines(e.getNewFragment()) - StringUtil.countNewLines(e.getOldFragment());
  List<SimpleThreesideDiffChange> invalid=new ArrayList<SimpleThreesideDiffChange>();
  for (  SimpleThreesideDiffChange change : myDiffChanges) {
    if (change.processChange(line1,line2,shift,side)) {
      invalid.add(change);
    }
  }
  if (!invalid.isEmpty()) {
    myDiffChanges.removeAll(invalid);
    myInvalidDiffChanges.addAll(invalid);
  }
}
