{
synchronized (myStatus) {
    myStatus.retainEntries(new TObjectObjectProcedure<VirtualFile,Entry>(){
      @Override public boolean execute(      VirtualFile file,      Entry entry){
        return !(entry.status == Status.ACTIVE && entry.error == null);
      }
    }
);
    if (myStatus.isEmpty()) {
      return new State(Collections.<Entry>emptyList());
    }
    Entry[] entries=myStatus.values().toArray(new Entry[myStatus.size()]);
    Arrays.sort(entries);
    return new State(Arrays.asList(entries));
  }
}
