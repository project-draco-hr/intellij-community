{
  String originalText=progress != null ? progress.getText() : null;
  substituteContentLength(progress,originalText,-1);
  if (progress != null) {
    progress.setText2("Downloading " + location);
  }
  URLConnection urlConnection=HttpConfigurable.getInstance().openConnection(location);
  HttpURLConnection httpURLConnection=ObjectUtils.tryCast(urlConnection,HttpURLConnection.class);
  try {
    int timeout=(int)TimeUnit.MINUTES.toMillis(2);
    urlConnection.setConnectTimeout(timeout);
    urlConnection.setReadTimeout(timeout);
    urlConnection.connect();
    InputStream in=urlConnection.getInputStream();
    int contentLength=urlConnection.getContentLength();
    substituteContentLength(progress,originalText,contentLength);
    NetUtils.copyStreamContent(progress,in,output,contentLength);
  }
 catch (  IOException e) {
    String errorMessage="Can not download '" + location + ", headers: "+ urlConnection.getHeaderFields();
    if (httpURLConnection != null) {
      errorMessage+="', response code: " + httpURLConnection.getResponseCode() + ", response message: "+ httpURLConnection.getResponseMessage();
    }
    throw new IOException(errorMessage,e);
  }
 finally {
    if (httpURLConnection != null) {
      try {
        httpURLConnection.disconnect();
      }
 catch (      Exception e) {
        LOG.warn("Exception at disconnect()",e);
      }
    }
  }
}
