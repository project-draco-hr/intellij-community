{
  final ZipOutputStream stream=new ZipOutputStream(new FileOutputStream(jarFile));
  try {
    FileUtil.visitFiles(root,new Processor<File>(){
      @Override public boolean process(      File file){
        if (file.isFile()) {
          String path=FileUtil.toSystemIndependentName(ObjectUtils.assertNotNull(FileUtil.getRelativePath(root,file)));
          try {
            stream.putNextEntry(new ZipEntry(path));
            stream.write(FileUtil.loadFileBytes(file));
            stream.closeEntry();
          }
 catch (          IOException e) {
            throw new RuntimeException(e);
          }
        }
        return true;
      }
    }
);
  }
  finally {
    stream.close();
  }
  return jarFile;
}
