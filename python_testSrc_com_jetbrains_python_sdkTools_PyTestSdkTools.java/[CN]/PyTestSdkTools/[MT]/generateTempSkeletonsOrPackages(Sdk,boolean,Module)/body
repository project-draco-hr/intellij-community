{
  if (module != null) {
    final Project project=module.getProject();
    ModuleRootModificationUtil.setModuleSdk(module,sdk);
    UsefulTestCase.edt(new Runnable(){
      @Override public void run(){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          @Override public void run(){
            ProjectRootManager.getInstance(project).setProjectSdk(sdk);
          }
        }
);
      }
    }
);
  }
  final SdkModificator modificator=sdk.getSdkModificator();
  modificator.removeRoots(OrderRootType.CLASSES);
  for (  final String path : PythonSdkType.getSysPathsFromScript(sdk.getHomePath())) {
    PythonSdkType.addSdkRoot(modificator,path);
  }
  if (!addSkeletons) {
    UsefulTestCase.edt(new Runnable(){
      @Override public void run(){
        modificator.commitChanges();
      }
    }
);
    return;
  }
  final File tempDir=FileUtil.createTempDirectory(PyTestSdkTools.class.getName(),null);
  final File skeletonsDir=new File(tempDir,PythonSdkType.SKELETON_DIR_NAME);
  FileUtil.createDirectory(skeletonsDir);
  final String skeletonsPath=skeletonsDir.toString();
  PythonSdkType.addSdkRoot(modificator,skeletonsPath);
  UsefulTestCase.edt(new Runnable(){
    @Override public void run(){
      modificator.commitChanges();
    }
  }
);
  final SkeletonVersionChecker checker=new SkeletonVersionChecker(0);
  final PySkeletonRefresher refresher=new PySkeletonRefresher(null,null,sdk,skeletonsPath,null,null);
  final List<String> errors=refresher.regenerateSkeletons(checker);
  Assert.assertThat("Errors found",errors,Matchers.empty());
}
