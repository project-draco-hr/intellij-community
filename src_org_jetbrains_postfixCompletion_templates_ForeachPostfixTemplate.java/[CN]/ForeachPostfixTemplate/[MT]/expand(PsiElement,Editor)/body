{
  PsiExpression expr=getTopmostExpression(context);
  if (expr == null)   return;
  Project project=context.getProject();
  Document document=editor.getDocument();
  document.deleteString(expr.getTextRange().getStartOffset(),expr.getTextRange().getEndOffset());
  TemplateManager manager=TemplateManager.getInstance(project);
  Template template=manager.createTemplate("","");
  template.setToReformat(true);
  template.addTextSegment("for (");
  MacroCallNode type=new MacroCallNode(new IterableComponentTypeMacro());
  String variable="variable";
  type.addParameter(new VariableNode(variable,null));
  MacroCallNode name=new MacroCallNode(new SuggestVariableNameMacro());
  template.addVariable("type",type,type,false);
  template.addTextSegment(" ");
  template.addVariable("name",name,name,true);
  template.addTextSegment(" : ");
  template.addVariable(variable,new TextExpression(expr.getText()),false);
  template.addTextSegment(") {\n");
  template.addEndVariable();
  template.addTextSegment("\n}");
  manager.startTemplate(editor,template);
}
