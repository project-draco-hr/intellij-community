{
  CharSequence sequence=document.getCharsSequence();
  final int lineNumber=document.getLineNumber(offset);
  final int lineStartOffset=document.getLineStartOffset(lineNumber);
  final int lineEndOffset=document.getLineEndOffset(lineNumber);
  int searchStartOffset=lineStartOffset;
  int searchEndOffset=lineEndOffset;
  if (lineEndOffset - lineStartOffset > 200) {
    searchStartOffset=Math.max(offset - 100,lineStartOffset);
    searchEndOffset=Math.min(offset + 100,lineEndOffset);
  }
  CharSequence textChunkAroundOffset=sequence.subSequence(searchStartOffset,searchEndOffset);
  int offsetInChunk=offset - searchStartOffset;
  int tagStartIndex=CharArrayUtil.lastIndexOf(textChunkAroundOffset,tagStart,offsetInChunk);
  if (tagStartIndex > 0) {
    int nearestTagEndIndex=CharArrayUtil.indexOf(textChunkAroundOffset,tagEnd,tagStartIndex);
    return nearestTagEndIndex > offsetInChunk;
  }
  return false;
}
