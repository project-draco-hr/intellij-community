{
  EditorFactory editorFactory=EditorFactory.getInstance();
  Document document=editorFactory.createDocument(templateText);
  final EditorEx previewEditor=(EditorEx)editorFactory.createEditor(document,parentEditor.getProject(),fileType,true);
  MarkupModelEx model=previewEditor.getMarkupModel();
  if (model instanceof EditorMarkupModel) {
    ((EditorMarkupModel)model).setErrorStripeVisible(true);
  }
  final EditorSettings settings=previewEditor.getSettings();
  settings.setLineNumbersShown(false);
  settings.setAdditionalLinesCount(1);
  settings.setAdditionalColumnsCount(1);
  settings.setRightMarginShown(false);
  settings.setFoldingOutlineShown(false);
  settings.setLineMarkerAreaShown(false);
  settings.setIndentGuidesShown(false);
  settings.setVirtualSpace(false);
  settings.setWheelFontChangeEnabled(false);
  settings.setAdditionalPageAtBottom(false);
  previewEditor.setCaretEnabled(false);
  previewEditor.setBorder(IdeBorderFactory.createEmptyBorder());
  EditorColorsScheme colorsScheme=previewEditor.getColorsScheme();
  colorsScheme.setColor(EditorColors.CARET_ROW_COLOR,null);
  JBPanel panel=new JBPanel(new BorderLayout()){
    @NotNull @Override public Dimension getPreferredSize(){
      Dimension size=super.getPreferredSize();
      Dimension parentEditorSize=parentEditor.getScrollPane().getSize();
      int maxWidth=(int)parentEditorSize.getWidth() / 3;
      int maxHeight=(int)parentEditorSize.getHeight() / 2;
      final int width=settings.isUseSoftWraps() ? maxWidth : Math.min((int)size.getWidth(),maxWidth);
      final int height=Math.min((int)size.getHeight(),maxHeight);
      return new Dimension(width,height);
    }
    @NotNull @Override public Insets getInsets(){
      return new Insets(1,2,0,0);
    }
  }
;
  panel.setBackground(previewEditor.getBackgroundColor());
  panel.add(previewEditor.getComponent(),BorderLayout.CENTER);
  return new EmmetPreviewHint(panel,previewEditor,parentEditor);
}
