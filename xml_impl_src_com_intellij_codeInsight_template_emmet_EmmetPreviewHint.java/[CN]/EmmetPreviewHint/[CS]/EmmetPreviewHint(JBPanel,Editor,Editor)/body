{
  super(panel);
  myParentEditor=parentEditor;
  myEditor=editor;
  final Editor topLevelEditor=InjectedLanguageUtil.getTopLevelEditor(myParentEditor);
  EditorFactory.getInstance().addEditorFactoryListener(new EditorFactoryAdapter(){
    @Override public void editorReleased(    @NotNull EditorFactoryEvent event){
      if (event.getEditor() == myParentEditor || event.getEditor() == myEditor || event.getEditor() == topLevelEditor) {
        hide();
      }
    }
  }
,this);
  myEditor.getDocument().addDocumentListener(new DocumentAdapter(){
    @Override public void documentChanged(    DocumentEvent event){
      if (!isDisposed && event.isWholeTextReplaced()) {
        Pair<Point,Short> position=guessPosition();
        HintManagerImpl.adjustEditorHintPosition(EmmetPreviewHint.this,myParentEditor,position.first,position.second);
        myEditor.getScrollingModel().scrollVertically(0);
      }
    }
  }
,this);
}
