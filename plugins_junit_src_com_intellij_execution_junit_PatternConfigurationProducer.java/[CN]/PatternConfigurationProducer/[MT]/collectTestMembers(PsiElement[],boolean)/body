{
  final Set<PsiElement> foundMembers=new LinkedHashSet<PsiElement>();
  for (  PsiElement psiElement : psiElements) {
    if (psiElement instanceof PsiClassOwner) {
      final PsiClass[] classes=((PsiClassOwner)psiElement).getClasses();
      for (      PsiClass aClass : classes) {
        if (JUnitUtil.isTestClass(aClass)) {
          foundMembers.add(aClass);
        }
      }
    }
 else     if (psiElement instanceof PsiClass) {
      if (JUnitUtil.isTestClass((PsiClass)psiElement)) {
        foundMembers.add(psiElement);
      }
    }
 else     if (psiElement instanceof PsiMethod) {
      if (JUnitUtil.getTestMethod(psiElement,checkAbstract) != null) {
        foundMembers.add(psiElement);
      }
    }
 else     if (psiElement instanceof PsiDirectory) {
      final PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage((PsiDirectory)psiElement);
      if (aPackage != null) {
        foundMembers.add(aPackage);
      }
    }
  }
  return foundMembers;
}
