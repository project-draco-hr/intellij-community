{
  if (!Registry.is("ide.hide.excluded.files") && !selection.mySelectedExcludeRoots.isEmpty() && selection.mySelectedDirectories.isEmpty()&& selection.mySelectedRoots.isEmpty()) {
    e.getPresentation().setEnabledAndVisible(true);
    e.getPresentation().setText("Cancel Exclusion");
    return;
  }
  super.doUpdate(e,module,selection);
  Set<JpsModuleSourceRootType<?>> selectedRootTypes=new HashSet<JpsModuleSourceRootType<?>>();
  for (  SourceFolder root : selection.mySelectedRoots) {
    selectedRootTypes.add(root.getRootType());
  }
  if (!selectedRootTypes.isEmpty()) {
    String text;
    if (selectedRootTypes.size() == 1) {
      JpsModuleSourceRootType<?> type=selectedRootTypes.iterator().next();
      ModuleSourceRootEditHandler<?> handler=ModuleSourceRootEditHandler.getEditHandler(type);
      text="Unmark as " + handler.getRootTypeName() + " "+ StringUtil.pluralize("Root",selection.mySelectedRoots.size());
    }
 else {
      text="Unmark Roots";
    }
    e.getPresentation().setText(text);
  }
}
