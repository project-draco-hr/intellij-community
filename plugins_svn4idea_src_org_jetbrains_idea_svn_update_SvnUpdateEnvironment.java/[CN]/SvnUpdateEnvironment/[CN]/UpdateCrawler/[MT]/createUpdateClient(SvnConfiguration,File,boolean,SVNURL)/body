{
  boolean is17=WorkingCopyFormat.ONE_DOT_SEVEN.equals(myVcs.getWorkingCopyFormat(root));
  boolean isSupportedProtocol=SvnAuthenticationManager.HTTP.equals(sourceUrl.getProtocol()) || SvnAuthenticationManager.HTTPS.equals(sourceUrl.getProtocol());
  ClientFactory factory=is17 && (isSwitch || !isSupportedProtocol) ? myVcs.getSvnKitFactory() : myVcs.getFactory(root);
  final UpdateClient updateClient=factory.createUpdateClient();
  if (!isSwitch) {
    updateClient.setIgnoreExternals(configuration.isIgnoreExternals());
  }
  updateClient.setEventHandler(myHandler);
  updateClient.setUpdateLocksOnDemand(configuration.isUpdateLockOnDemand());
  return updateClient;
}
