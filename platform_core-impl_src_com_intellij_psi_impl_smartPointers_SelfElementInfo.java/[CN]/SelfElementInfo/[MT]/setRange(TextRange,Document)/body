{
  myPsiRange=null;
  VirtualFile file=FileDocumentManager.getInstance().getFile(document);
  if (file != null) {
    for (    SmartPsiElementPointerImpl pointer : ((SmartPointerManagerImpl)SmartPointerManager.getInstance(myProject)).getAlivePointers(file)) {
      SmartPointerElementInfo info=pointer.getElementInfo();
      if (info instanceof SelfElementInfo) {
        ManualRangeMarker existing=((SelfElementInfo)info).myRangeMarker;
        if (existing != null && range.equals(existing.getRange())) {
          myRangeMarker=existing;
          return;
        }
      }
    }
  }
  myRangeMarker=new ManualRangeMarker(getDocumentManager().getLastCommittedDocument(document),ProperTextRange.create(range),false,false,true);
}
