{
  if (other instanceof SelfElementInfo) {
    SelfElementInfo otherInfo=(SelfElementInfo)other;
    Segment range1=getPsiRange();
    Segment range2=otherInfo.getPsiRange();
    return Comparing.equal(getVirtualFile(),otherInfo.getVirtualFile()) && myType == otherInfo.myType && range1 != null && range2 != null && range1.getStartOffset() == range2.getStartOffset() && range1.getEndOffset() == range2.getEndOffset();
  }
  return ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
    @Override public Boolean compute(){
      return Comparing.equal(restoreElement(),other.restoreElement());
    }
  }
);
}
