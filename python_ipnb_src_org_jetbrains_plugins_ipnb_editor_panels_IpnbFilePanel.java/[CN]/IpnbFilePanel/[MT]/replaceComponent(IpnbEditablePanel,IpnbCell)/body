{
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          final int index=myIpnbPanels.indexOf(from);
          IpnbEditablePanel panel;
          if (cell instanceof IpnbCodeCell) {
            panel=new IpnbCodePanel(myProject,myParent,(IpnbCodeCell)cell);
          }
 else           if (cell instanceof IpnbMarkdownCell) {
            panel=new IpnbMarkdownPanel((IpnbMarkdownCell)cell);
          }
 else           if (cell instanceof IpnbHeadingCell) {
            panel=new IpnbHeadingPanel((IpnbHeadingCell)cell);
          }
 else {
            throw new UnsupportedOperationException(cell.getClass().toString());
          }
          if (index >= 0) {
            myIpnbFile.removeCell(index);
            myIpnbFile.addCell(cell,index);
            myIpnbPanels.remove(index);
            myIpnbPanels.add(index,panel);
          }
          if (from instanceof IpnbCodePanel) {
            panel.switchToEditing();
          }
          setSelectedCell(panel);
          saveToFile();
        }
      }
);
    }
  }
,"Ipnb.changeCellType",new Object());
}
