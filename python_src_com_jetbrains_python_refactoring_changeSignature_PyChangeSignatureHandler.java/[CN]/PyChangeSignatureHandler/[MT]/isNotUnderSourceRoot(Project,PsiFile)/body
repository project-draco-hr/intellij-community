{
  if (psiFile == null) {
    return true;
  }
  final VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile != null) {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    if (fileIndex.isExcluded(virtualFile) || (fileIndex.isInLibraryClasses(virtualFile) && !fileIndex.isInContent(virtualFile))) {
      return true;
    }
  }
  return false;
}
