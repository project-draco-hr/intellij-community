{
  if (psiFile == null)   return true;
  final VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile != null) {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    if (fileIndex.isExcluded(virtualFile) || (fileIndex.isInLibraryClasses(virtualFile) && !fileIndex.isInContent(virtualFile))) {
      String message=RefactoringBundle.getCannotRefactorMessage("Function is not under the source root");
      CommonRefactoringUtil.showErrorHint(project,editor,message,REFACTORING_NAME,REFACTORING_NAME);
      return true;
    }
  }
  return false;
}
