{
  DaemonCodeAnalyzerSettings settings=DaemonCodeAnalyzerSettings.getInstance();
  int savedDelay=settings.AUTOREPARSE_DELAY;
  settings.AUTOREPARSE_DELAY=0;
  try {
    configureByText(StdFileTypes.JAVA,"class Foo {\n" + "    void m() {\n" + "\n"+ "    }\n"+ "}");
    CodeFoldingManager.getInstance(getProject()).buildInitialFoldings(myEditor);
    EditorTestUtil.executeAction(myEditor,IdeActions.ACTION_COLLAPSE_ALL_REGIONS);
    waitForDaemon();
    checkFoldingState("[FoldRegion +(25:33), placeholder='{...}']");
    new WriteCommandAction<Void>(myProject){
      @Override protected void run(      @NotNull Result<Void> result) throws Throwable {
        myEditor.getDocument().insertString(0,"/*");
      }
    }
.execute();
    waitForDaemon();
    checkFoldingState("[FoldRegion -(0:37), placeholder='/.../', FoldRegion +(27:35), placeholder='{...}']");
    EditorTestUtil.executeAction(myEditor,IdeActions.ACTION_EXPAND_ALL_REGIONS);
    waitForDaemon();
    checkFoldingState("[FoldRegion -(0:37), placeholder='/.../']");
  }
  finally {
    settings.AUTOREPARSE_DELAY=savedDelay;
  }
}
