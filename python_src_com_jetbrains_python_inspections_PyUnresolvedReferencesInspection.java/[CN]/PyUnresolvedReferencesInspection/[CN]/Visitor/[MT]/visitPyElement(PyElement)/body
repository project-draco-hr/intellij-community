{
  super.visitPyElement(node);
  for (  final PsiReference reference : node.getReferences()) {
    if (reference.isSoft())     continue;
    HighlightSeverity severity=HighlightSeverity.ERROR;
    if (reference instanceof PsiReferenceEx) {
      severity=((PsiReferenceEx)reference).getUnresolvedHighlightSeverity(myTypeEvalContext);
      if (severity == null)       continue;
    }
    if (isGuardedByImportError(node)) {
      final PyImportElement importElement=PsiTreeUtil.getParentOfType(node,PyImportElement.class);
      if (importElement != null) {
        if (!ScopeUtil.isDeclaredAndBoundInScope(importElement,importElement.getVisibleName())) {
          final PyTargetExpression asElement=importElement.getAsNameElement();
          final PyElement toHighlight=asElement != null ? asElement : node;
          registerProblem(toHighlight,PyBundle.message("INSP.try.except.import.error",importElement.getVisibleName()),ProblemHighlightType.LIKE_UNKNOWN_SYMBOL,null);
        }
      }
      return;
    }
    boolean unresolved;
    if (reference instanceof PsiPolyVariantReference) {
      final PsiPolyVariantReference poly=(PsiPolyVariantReference)reference;
      final ResolveResult[] resolveResults=poly.multiResolve(false);
      unresolved=(resolveResults.length == 0);
      for (      ResolveResult resolveResult : resolveResults) {
        if (resolveResult instanceof ImportedResolveResult) {
          myUsedImports.addAll(((ImportedResolveResult)resolveResult).getNameDefiners());
        }
      }
    }
 else {
      unresolved=(reference.resolve() == null);
    }
    if (unresolved) {
      registerUnresolvedReferenceProblem(node,reference,severity);
      if (node.getParent() instanceof PyImportElement) {
        myAllImports.remove(node.getParent());
      }
    }
  }
}
