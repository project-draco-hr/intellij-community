{
  int length=end - start;
  if (length <= BLOCK_SIZE) {
    char[] chars=new char[length];
    if (str instanceof String) {
      ((String)str).getChars(start,end,chars,0);
    }
 else {
      char[] array=CharArrayUtil.fromSequenceWithoutCopying(str);
      if (array != null) {
        System.arraycopy(array,start,chars,0,length);
      }
 else {
        for (int i=start; i < end; i++) {
          chars[i - start]=str.charAt(i);
        }
      }
    }
    return new ImmutableText(chars);
  }
 else {
    int half=((length + BLOCK_SIZE) >> 1) & BLOCK_MASK;
    return new ImmutableText(valueOf(str,start,start + half),valueOf(str,start + half,end));
  }
}
