{
  final DataContext dataContext=e.getDataContext();
  final Presentation presentation=e.getPresentation();
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project != null) {
    final VirtualFile[] files=CommonDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
    if (files != null && files.length > 0) {
      for (      VirtualFile file : files) {
        final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
        if (!(psiFile instanceof XmlFile)) {
          continue;
        }
        final XmlFile xmlFile=(XmlFile)psiFile;
        final XmlDocument document=xmlFile.getDocument();
        if (document == null) {
          continue;
        }
        final XmlTag rootTag=document.getRootTag();
        if (rootTag == null) {
          continue;
        }
        if (!"project".equals(rootTag.getName())) {
          continue;
        }
        if (AntConfigurationBase.getInstance(project).getAntBuildFile(psiFile) != null) {
          continue;
        }
        enable(presentation);
        return;
      }
    }
  }
  disable(presentation);
}
