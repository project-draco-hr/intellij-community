{
  final DataContext dataContext=event.getDataContext();
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    return;
  }
  final VirtualFile[] contextFiles=CommonDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  if (contextFiles == null || contextFiles.length == 0) {
    return;
  }
  final AntConfiguration antConfiguration=AntConfiguration.getInstance(project);
  final Set<VirtualFile> files=new HashSet<VirtualFile>();
  files.addAll(Arrays.asList(contextFiles));
  for (  AntBuildFile buildFile : antConfiguration.getBuildFiles()) {
    files.remove(buildFile.getVirtualFile());
  }
  int filesAdded=0;
  final StringBuilder errors=new StringBuilder();
  for (  VirtualFile file : files) {
    try {
      antConfiguration.addBuildFile(file);
      filesAdded++;
    }
 catch (    AntNoFileException e) {
      String message=e.getMessage();
      if (message == null || message.length() == 0) {
        message=AntBundle.message("cannot.add.build.files.from.excluded.directories.error.message",e.getFile().getPresentableUrl());
      }
      if (errors.length() > 0) {
        errors.append("\n");
      }
      errors.append(message);
    }
  }
  if (errors.length() > 0) {
    Messages.showWarningDialog(project,errors.toString(),AntBundle.message("cannot.add.build.file.dialog.title"));
  }
  if (filesAdded > 0) {
    ToolWindowManager.getInstance(project).getToolWindow(ToolWindowId.ANT_BUILD).activate(null);
  }
}
