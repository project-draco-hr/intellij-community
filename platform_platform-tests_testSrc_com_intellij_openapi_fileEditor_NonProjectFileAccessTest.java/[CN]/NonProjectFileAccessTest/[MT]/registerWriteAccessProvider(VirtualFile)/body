{
  final Set<VirtualFile> requested=new LinkedHashSet<VirtualFile>();
  PlatformTestUtil.registerExtension(Extensions.getArea(getProject()),WritingAccessProvider.EP_NAME,new WritingAccessProvider(){
    @NotNull @Override public Collection<VirtualFile> requestWriting(    VirtualFile... files){
      Collections.addAll(requested,files);
      HashSet<VirtualFile> denied=new HashSet<VirtualFile>(Arrays.asList(filesToDeny));
      denied.retainAll(Arrays.asList(files));
      return denied;
    }
    @Override public boolean isPotentiallyWritable(    @NotNull VirtualFile file){
      return true;
    }
  }
,getTestRootDisposable());
  return requested;
}
