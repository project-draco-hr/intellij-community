{
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      try {
        final IdeaTestFixtureFactory fixtureFactory=IdeaTestFixtureFactory.getFixtureFactory();
        myTempDirFixture=fixtureFactory.createTempDirTestFixture();
        myTempDirFixture.setUp();
        myClientRoot=new File(myTempDirFixture.getTempDirPath(),"clientroot");
        myClientRoot.mkdir();
        initProject(myClientRoot,VcsEventsListenerTest.this.getTestName());
        ((StartupManagerImpl)StartupManager.getInstance(myProject)).runPostStartupActivities();
        myChangeListManager=ChangeListManager.getInstance(myProject);
        myVcs=VcsActiveEnvironmentsProxy.proxyVcs(new MyVcs(myProject,"mock"));
        myVcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(myProject);
        myVcsManager.registerVcs(myVcs);
        myVcsManager.setDirectoryMapping(myWorkingCopyDir.getPath(),myVcs.getName());
        ((ProjectComponent)myChangeListManager).projectOpened();
      }
 catch (      Exception e) {
        tearDown();
        throw new RuntimeException(e);
      }
    }
  }
);
}
