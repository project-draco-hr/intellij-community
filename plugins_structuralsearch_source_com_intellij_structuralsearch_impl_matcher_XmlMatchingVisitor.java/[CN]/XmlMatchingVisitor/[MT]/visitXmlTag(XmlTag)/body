{
  final XmlTag another=(XmlTag)myMatchingVisitor.getElement();
  final boolean isTypedVar=myMatchingVisitor.getMatchContext().getPattern().isTypedVar(tag.getName());
  myMatchingVisitor.setResult((tag.getName().equals(another.getName()) || isTypedVar) && myMatchingVisitor.matchInAnyOrder(tag.getAttributes(),another.getAttributes()));
  if (myMatchingVisitor.getResult()) {
    final XmlTagChild[] contentChildren=tag.getValue().getChildren();
    if (contentChildren.length > 0) {
      myMatchingVisitor.setResult(myMatchingVisitor.matchSequentially(new ArrayBackedNodeIterator(contentChildren),new ArrayBackedNodeIterator(another.getValue().getChildren())));
    }
  }
  if (myMatchingVisitor.getResult() && isTypedVar) {
    MatchingHandler handler=myMatchingVisitor.getMatchContext().getPattern().getHandler(tag.getName());
    myMatchingVisitor.setResult(((SubstitutionHandler)handler).handle(another,myMatchingVisitor.getMatchContext()));
  }
}
