{
  if (myProject.isDisposed())   return;
  if (myBaseStructureViewDescriptor != null && ((StructureViewComponent)myBaseStructureViewDescriptor.structureView).getTree() == null)   return;
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      if (!myVirtualFile.isValid())       return;
      final TemplateLanguageFileViewProvider provider=getViewProvider();
      if (provider == null)       return;
      StructureViewWrapper structureViewWrapper=StructureViewFactoryEx.getInstanceEx(myProject).getStructureViewWrapper();
      if (structureViewWrapper == null)       return;
      Language baseLanguage=provider.getTemplateDataLanguage();
      if (baseLanguage == myTemplateDataLanguage && (myBaseStructureViewDescriptor == null || isPsiValid(myBaseStructureViewDescriptor))) {
        updateBaseLanguageView();
      }
 else {
        myTemplateDataLanguage=baseLanguage;
        ((StructureViewWrapperImpl)structureViewWrapper).rebuild();
      }
    }
  }
);
}
