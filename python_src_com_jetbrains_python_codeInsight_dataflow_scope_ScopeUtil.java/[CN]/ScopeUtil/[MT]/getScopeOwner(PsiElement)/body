{
  if (element instanceof StubBasedPsiElement) {
    final StubElement stub=((StubBasedPsiElement)element).getStub();
    if (stub != null) {
      StubElement parentStub=stub.getParentStub();
      while (parentStub != null) {
        final PsiElement parent=parentStub.getPsi();
        if (parent instanceof ScopeOwner) {
          return (ScopeOwner)parent;
        }
        parentStub=parentStub.getParentStub();
      }
    }
  }
  return PsiTreeUtil.getParentOfType(element,ScopeOwner.class);
}
