{
  if (element == null) {
    return null;
  }
  if (element instanceof StubBasedPsiElement) {
    final StubElement stub=((StubBasedPsiElement)element).getStub();
    if (stub != null) {
      StubElement parentStub=stub.getParentStub();
      while (parentStub != null) {
        final PsiElement parent=parentStub.getPsi();
        if (parent instanceof ScopeOwner) {
          return (ScopeOwner)parent;
        }
        parentStub=parentStub.getParentStub();
      }
      return null;
    }
  }
  return CachedValuesManager.getCachedValue(element,new CachedValueProvider<ScopeOwner>(){
    @Nullable @Override public Result<ScopeOwner> compute(){
      return Result.create(calculateScopeOwnerByAST(element),PsiModificationTracker.MODIFICATION_COUNT);
    }
  }
);
}
