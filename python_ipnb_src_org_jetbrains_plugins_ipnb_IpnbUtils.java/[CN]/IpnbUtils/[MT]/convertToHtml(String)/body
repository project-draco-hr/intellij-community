{
  final StringBuilder result=new StringBuilder();
  source=replaceLinks(source);
  boolean escaped=false;
  int start=0;
  int end=StringUtil.indexOf(source,"```");
  while (end > 0) {
    result.append(source.substring(start,end));
    result.append(escaped ? "</pre>" : "<pre>");
    escaped=!escaped;
    start=end + 3;
    end=StringUtil.indexOf(source,"```",end + 1);
  }
  result.append(source.substring(start));
  return result.toString();
}
