{
  return new StateStorageManagerExternalizationSession(){
    @NotNull @Override public List<StateStorage.SaveSession> createSaveSessions(){
      final ModuleStoreImpl.ModuleFileData data=myModule.getStateStore().getMainStorageData();
      List<StateStorage.SaveSession> sessions=super.createSaveSessions();
      if (!data.isDirty()) {
        return sessions;
      }
      return ContainerUtil.concat(sessions,Collections.singletonList(new StateStorage.SaveSession(){
        @Override public void save() throws IOException {
          if (data.isDirty()) {
            myModule.getStateStore().getMainStorage().forceSave();
          }
        }
      }
));
    }
  }
;
}
