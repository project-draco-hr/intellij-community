{
  return new StateStorageManagerExternalizationSession(){
    @Nullable @Override public StateStorage.SaveSession createSaveSession(){
      final ModuleStoreImpl.ModuleFileData data=myModule.getStateStore().getMainStorageData();
      final StateStorage.SaveSession session=super.createSaveSession();
      if (data.isDirty()) {
        return new StateStorage.SaveSession(){
          @Override public void save(){
            if (session != null) {
              session.save();
            }
            if (data.isDirty()) {
              myModule.getStateStore().getMainStorage().forceSave();
            }
          }
        }
;
      }
      return session;
    }
  }
;
}
