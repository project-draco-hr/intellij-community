{
  checkNameStorage();
  final Map<StubIndexKey,Map<Object,StubIdList>> newStubIndicesValueMap=getStubIndicesValueMap(getSerializedStubTree(((SimpleUpdateData)updateData).getNewData()),inputId);
  final StubIndexImpl stubIndex=getStubIndex();
  final Collection<StubIndexKey> allStubIndices=stubIndex.getAllStubIndexKeys();
  try {
    for (    StubIndexKey key : allStubIndices) {
      stubIndex.getWriteLock(key).lock();
    }
    try {
      getWriteLock().lock();
      final Map<StubIndexKey,Map<Object,StubIdList>> previousStubIndicesValueMap=getStubIndicesValueMap(readOldData(inputId),inputId);
      super.updateWithMap(inputId,updateData);
      updateStubIndices(getAffectedIndices(previousStubIndicesValueMap,newStubIndicesValueMap),inputId,previousStubIndicesValueMap,newStubIndicesValueMap);
    }
  finally {
      getWriteLock().unlock();
    }
  }
  finally {
    for (    StubIndexKey key : allStubIndices) {
      stubIndex.getWriteLock(key).unlock();
    }
  }
}
