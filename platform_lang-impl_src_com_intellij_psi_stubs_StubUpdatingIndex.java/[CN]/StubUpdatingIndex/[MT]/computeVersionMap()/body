{
  Map<FileType,Integer> map=new HashMap<FileType,Integer>();
  for (  final FileType fileType : FileTypeManager.getInstance().getRegisteredFileTypes()) {
    if (fileType instanceof LanguageFileType) {
      Language l=((LanguageFileType)fileType).getLanguage();
      ParserDefinition parserDefinition=LanguageParserDefinitions.INSTANCE.forLanguage(l);
      if (parserDefinition != null) {
        final IFileElementType type=parserDefinition.getFileNodeType();
        if (type instanceof IStubFileElementType) {
          map.put(fileType,((IStubFileElementType)type).getStubVersion());
        }
      }
    }
    List<BinaryFileStubBuilder> builders=BinaryFileStubBuilders.INSTANCE.allForFileType(fileType);
    if (builders.size() > 0) {
      Collections.sort(builders,new Comparator<BinaryFileStubBuilder>(){
        @Override public int compare(        BinaryFileStubBuilder o1,        BinaryFileStubBuilder o2){
          return o1.getClass().getName().compareTo(o2.getClass().getName());
        }
      }
);
      Integer integer=map.get(fileType);
      int value=integer != null ? integer : 0;
      for (      BinaryFileStubBuilder builder : builders) {
        value=value * 31 + builder.getStubVersion() + builder.getClass().getName().hashCode();
      }
      map.put(fileType,value);
    }
  }
  return map;
}
