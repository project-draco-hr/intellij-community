{
  if (expression instanceof PsiReferenceExpression) {
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)expression;
    final String referenceName=referenceExpression.getReferenceName();
    if (referenceName != null) {
      final PsiElement resolved=referenceExpression.resolve();
      if (resolved instanceof PsiVariable || resolved instanceof PsiClass) {
        final PsiExpression qualifierExpression=ParenthesesUtils.stripParentheses(referenceExpression.getQualifierExpression());
        if (qualifierExpression == null) {
          return referenceName;
        }
        final String qualifierName=getQualifiedVariableName(qualifierExpression);
        return qualifierName != null ? qualifierName + "." + referenceName : null;
      }
    }
  }
 else   if (expression instanceof PsiQualifiedExpression) {
    final PsiJavaCodeReferenceElement qualifier=((PsiQualifiedExpression)expression).getQualifier();
    final String name;
    if (expression instanceof PsiThisExpression) {
      name="this";
    }
 else     if (expression instanceof PsiSuperExpression) {
      name="super";
    }
 else {
      return null;
    }
    return qualifier != null ? qualifier.getQualifiedName() + "." + name : name;
  }
  return null;
}
