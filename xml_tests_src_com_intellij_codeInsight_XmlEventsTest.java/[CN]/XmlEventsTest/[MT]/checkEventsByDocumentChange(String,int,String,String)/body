{
  final Listener listener=addPomListener();
  final XmlTag tagFromText=((XmlFile)createFile("file.xml",rootTagText)).getDocument().getRootTag();
  final PsiFileImpl containingFile=(PsiFileImpl)tagFromText.getContainingFile();
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(getProject());
  final Document document=documentManager.getDocument(containingFile);
  WriteCommandAction.runWriteCommandAction(null,new Runnable(){
    @Override public void run(){
      document.insertString(positionToInsert,stringToInsert);
      documentManager.commitDocument(document);
    }
  }
);
  assertEquals(events,listener.getEventString());
}
