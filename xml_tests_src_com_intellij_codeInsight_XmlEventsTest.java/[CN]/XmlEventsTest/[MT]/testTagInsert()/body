{
  final Listener listener=addPomListener();
  configureFromFileText("x.xml","<a>aaa\n<x>xxx</x>\n<y>yyy</y></a>");
  final XmlTag x=((XmlFile)getFile()).getRootTag().findSubTags("x")[0];
  WriteCommandAction.runWriteCommandAction(null,new Runnable(){
    @Override public void run(){
      TextRange range=x.getTextRange();
      getEditor().getDocument().insertString(range.getEndOffset() + 1,"<z>zxzz</z>\n");
      PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
    }
  }
);
  assertEquals("(child added to a child: XmlText), (child added to a child: XmlTag:z)\n",listener.getEventString());
}
