{
  Project project=getProject(element);
  if (!project.isOpen())   return;
  storeOriginalElement(project,originalElement,element);
  myPreviouslyFocused=WindowManagerEx.getInstanceEx().getFocusedComponent(project);
  JBPopup _oldHint=getDocInfoHint();
  if (PreviewManager.SERVICE.preview(myProject,DocumentationPreviewPanelProvider.ID,Couple.of(element,originalElement),requestFocus) != null) {
    return;
  }
  if (myToolWindow == null && PropertiesComponent.getInstance().isTrueValue(SHOW_DOCUMENTATION_IN_TOOL_WINDOW)) {
    createToolWindow(element,originalElement);
  }
 else   if (myToolWindow != null) {
    Content content=myToolWindow.getContentManager().getSelectedContent();
    if (content != null) {
      DocumentationComponent component=(DocumentationComponent)content.getComponent();
      boolean sameElement=element.getManager().areElementsEquivalent(component.getElement(),element);
      if (sameElement) {
        JComponent preferredFocusableComponent=content.getPreferredFocusableComponent();
        boolean focus=requestFocus || CommandProcessor.getInstance().getCurrentCommand() != null;
        if (preferredFocusableComponent != null && focus) {
          IdeFocusManager.getInstance(myProject).requestFocus(preferredFocusableComponent,true);
        }
      }
      if (!sameElement || !component.isUpToDate()) {
        content.setDisplayName(getTitle(element,true));
        fetchDocInfo(getDefaultCollector(element,originalElement),component,true);
      }
    }
    if (!myToolWindow.isVisible()) {
      myToolWindow.show(null);
    }
  }
 else   if (_oldHint != null && _oldHint.isVisible() && _oldHint instanceof AbstractPopup) {
    DocumentationComponent oldComponent=(DocumentationComponent)((AbstractPopup)_oldHint).getComponent();
    fetchDocInfo(getDefaultCollector(element,originalElement),oldComponent);
  }
 else {
    showInPopup(element,requestFocus,updateProcessor,originalElement,closeCallback);
  }
}
