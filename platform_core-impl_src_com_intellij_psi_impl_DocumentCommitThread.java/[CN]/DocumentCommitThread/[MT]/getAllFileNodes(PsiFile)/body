{
  if (!file.isValid()) {
    throw new PsiInvalidElementAccessException(file,"File " + file + " is invalid, can't commit");
  }
  if (file instanceof PsiCompiledFile) {
    throw new IllegalArgumentException("Can't commit ClsFile: " + file);
  }
  return ContainerUtil.map(file.getViewProvider().getAllFiles(),new Function<PsiFile,Pair<PsiFileImpl,FileASTNode>>(){
    @Override public Pair<PsiFileImpl,FileASTNode> fun(    PsiFile root){
      return Pair.create((PsiFileImpl)root,root.getNode());
    }
  }
);
}
