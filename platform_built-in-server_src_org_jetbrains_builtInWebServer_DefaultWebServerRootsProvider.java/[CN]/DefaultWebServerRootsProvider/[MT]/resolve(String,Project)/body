{
  PairFunction<String,VirtualFile,VirtualFile> resolver;
  if (PlatformUtils.isIntelliJ()) {
    int index=path.indexOf('/');
    if (index > 0 && !path.regionMatches(!SystemInfo.isFileSystemCaseSensitive,0,project.getName(),0,index)) {
      String moduleName=path.substring(0,index);
      AccessToken token=ReadAction.start();
      Module module;
      try {
        module=ModuleManager.getInstance(project).findModuleByName(moduleName);
      }
  finally {
        token.finish();
      }
      if (module != null && !module.isDisposed()) {
        path=path.substring(index + 1);
        resolver=WebServerPathToFileManager.getInstance(project).getResolver(path);
        ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
        for (        RootProvider rootProvider : RootProvider.values()) {
          PathInfo result=findByRelativePath(path,rootProvider.getRoots(moduleRootManager),resolver,moduleName);
          if (result != null) {
            return result;
          }
        }
        PathInfo result=findInModuleLibraries(path,module,resolver);
        if (result != null) {
          return result;
        }
      }
    }
  }
  Module[] modules;
  AccessToken token=ReadAction.start();
  try {
    modules=ModuleManager.getInstance(project).getModules();
  }
  finally {
    token.finish();
  }
  resolver=WebServerPathToFileManager.getInstance(project).getResolver(path);
  for (  RootProvider rootProvider : RootProvider.values()) {
    PathInfo result=findByRelativePath(project,path,modules,rootProvider,resolver);
    if (result != null) {
      return result;
    }
  }
  return findInLibraries(project,modules,path,resolver);
}
