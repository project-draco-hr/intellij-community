{
  if (getPropertiesFile() != null)   return true;
  final String path=FileUtil.toSystemIndependentName(myPropertiesFile.getText());
  if (StringUtil.isEmptyOrSpaces(path)) {
    String message=CodeInsightBundle.message("i18nize.empty.file.path",myPropertiesFile.getText());
    Messages.showErrorDialog(myProject,message,CodeInsightBundle.message("i18nize.error.creating.properties.file"));
    myPropertiesFile.requestFocusInWindow();
    return false;
  }
  FileType fileType=FileTypeManager.getInstance().getFileTypeByFileName(path);
  if (fileType != StdFileTypes.PROPERTIES) {
    String message=CodeInsightBundle.message("i18nize.cant.create.properties.file.because.its.name.is.associated",myPropertiesFile.getText(),fileType.getDescription());
    Messages.showErrorDialog(myProject,message,CodeInsightBundle.message("i18nize.error.creating.properties.file"));
    myPropertiesFile.requestFocusInWindow();
    return false;
  }
  final VirtualFile virtualFile;
  try {
    final File file=new File(path).getCanonicalFile();
    FileUtil.createParentDirs(file);
    virtualFile=ApplicationManager.getApplication().runWriteAction(new ThrowableComputable<VirtualFile,IOException>(){
      @Override public VirtualFile compute() throws IOException {
        VirtualFile dir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(file.getParentFile());
        if (dir == null) {
          throw new IOException("Error creating directory structure for file '" + path + "'");
        }
        return dir.createChildData(this,file.getName());
      }
    }
);
  }
 catch (  IOException e) {
    Messages.showErrorDialog(myProject,e.getLocalizedMessage(),CodeInsightBundle.message("i18nize.error.creating.properties.file"));
    return false;
  }
  PsiFile psiFile=PsiManager.getInstance(myProject).findFile(virtualFile);
  return psiFile instanceof PropertiesFile;
}
