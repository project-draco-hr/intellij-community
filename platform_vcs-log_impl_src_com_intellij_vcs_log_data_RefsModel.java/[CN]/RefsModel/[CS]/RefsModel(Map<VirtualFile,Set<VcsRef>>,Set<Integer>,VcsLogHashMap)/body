{
  myRefs=refsByRoot;
  Iterable<VcsRef> allRefs=Iterables.concat(refsByRoot.values());
  myBranches=ContainerUtil.newSmartList();
  for (  VcsRef ref : allRefs) {
    if (ref.getType().isBranch()) {
      myBranches.add(ref);
    }
  }
  myRefsToHashes=prepareRefsMap(allRefs);
  myBranchesToIndices=prepareRefsToIndicesMap(myBranches,hashMap);
  myRefsToHeadIndices=prepareRefsToIndicesMap(Iterables.filter(Iterables.concat(refsByRoot.values()),new Predicate<VcsRef>(){
    @Override public boolean apply(    VcsRef vcsRef){
      return heads.contains(hashMap.getCommitIndex(vcsRef.getCommitHash(),vcsRef.getRoot()));
    }
  }
),hashMap);
  myRootsToHeadIndices=prepareRootsMap(heads,hashMap);
}
