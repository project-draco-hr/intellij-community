{
  Document doc=editor.getDocument();
  TextRange textRange=myStatementToMove.getTextRange();
  LineRange range=new LineRange(doc.getLineNumber(textRange.getStartOffset()),doc.getLineNumber(textRange.getEndOffset()) + 1);
  int nearLine=down ? range.endLine : range.startLine - 1;
  if (nearLine < 0)   nearLine=0;
  info.toMove=range;
  info.toMove2=new LineRange(nearLine,nearLine + 1);
  if (isMoveToEmptyLine(editor,info))   return;
  int offset2=getLineStartSafeOffset(doc,info.toMove2.startLine);
  PsiElement element2=file.findElementAt(offset2);
  if (element2 != null) {
    if (element2 instanceof PsiWhiteSpace) {
      PsiElement tmp=PyPsiUtils.getSignificantToTheRight(element2,true);
      if (tmp != null && editor.offsetToLogicalPosition(tmp.getTextRange().getStartOffset()).line == info.toMove2.startLine) {
        element2=tmp;
      }
    }
    PyElement parent2=PsiTreeUtil.getParentOfType(element2,PyStringLiteralExpression.class);
    if (parent2 != null) {
      PyDocStringOwner docStringOwner=PsiTreeUtil.getParentOfType(element2,PyDocStringOwner.class);
      if (docStringOwner != null && docStringOwner.getDocStringExpression() == parent2) {
        TextRange textRange2=parent2.getTextRange();
        info.toMove2=new LineRange(doc.getLineNumber(textRange2.getStartOffset()),doc.getLineNumber(textRange2.getEndOffset()) + 1);
      }
    }
    parent2=PsiTreeUtil.getParentOfType(element2,PyFunction.class);
    PyElement parent1=PsiTreeUtil.getParentOfType(myStatementToMove,PyFunction.class);
    if (parent2 != null && parent2 != parent1) {
      TextRange textRange2=parent2.getTextRange();
      info.toMove2=new LineRange(doc.getLineNumber(textRange2.getStartOffset()),doc.getLineNumber(textRange2.getEndOffset()) + 1);
    }
    parent2=PsiTreeUtil.getParentOfType(element2,PyClass.class);
    parent1=PsiTreeUtil.getParentOfType(myStatementToMove,PyClass.class);
    if (parent2 != null && parent2 != parent1) {
      TextRange textRange2=parent2.getTextRange();
      info.toMove2=new LineRange(doc.getLineNumber(textRange2.getStartOffset()),doc.getLineNumber(textRange2.getEndOffset()) + 1);
    }
  }
}
