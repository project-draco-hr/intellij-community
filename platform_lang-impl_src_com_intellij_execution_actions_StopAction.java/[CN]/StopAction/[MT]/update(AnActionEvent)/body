{
  boolean enable=false;
  Icon icon=getTemplatePresentation().getIcon();
  String description=getTemplatePresentation().getDescription();
  Presentation presentation=e.getPresentation();
  if (ActionPlaces.MAIN_MENU.equals(e.getPlace())) {
    enable=!getCancellableProcesses(e.getProject()).isEmpty() || !getActiveDescriptors(e.getDataContext()).isEmpty();
    presentation.setText(getTemplatePresentation().getText());
  }
 else {
    RunContentDescriptor contentDescriptor=e.getData(LangDataKeys.RUN_CONTENT_DESCRIPTOR);
    ProcessHandler processHandler=contentDescriptor == null ? null : contentDescriptor.getProcessHandler();
    if (processHandler != null && !processHandler.isProcessTerminated()) {
      if (!processHandler.isProcessTerminating()) {
        enable=true;
      }
 else       if (processHandler instanceof KillableProcess && ((KillableProcess)processHandler).canKillProcess()) {
        enable=true;
        icon=AllIcons.Debugger.KillProcess;
        description="Kill process";
      }
    }
    RunProfile runProfile=e.getData(LangDataKeys.RUN_PROFILE);
    if (runProfile == null && contentDescriptor == null) {
      presentation.setText(getTemplatePresentation().getText());
    }
 else {
      presentation.setText(ExecutionBundle.message("stop.configuration.action.name",runProfile == null ? contentDescriptor.getDisplayName() : runProfile.getName()));
    }
  }
  presentation.setEnabled(enable);
  presentation.setIcon(icon);
  presentation.setDescription(description);
}
