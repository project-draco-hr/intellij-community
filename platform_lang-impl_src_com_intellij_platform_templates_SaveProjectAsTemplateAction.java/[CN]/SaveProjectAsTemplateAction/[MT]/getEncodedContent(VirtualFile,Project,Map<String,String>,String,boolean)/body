{
  String text=VfsUtilCore.loadText(virtualFile);
  if (!shouldEncode) {
    return ProjectTemplateFileProcessor.encodeFile(text,virtualFile,project);
  }
  final FileTemplate template=FileTemplateManager.getInstance(project).getDefaultTemplate(fileHeaderTemplateName);
  final String templateText=template.getText();
  final Pattern pattern=FileTemplateUtil.getTemplatePattern(template,project,new TIntObjectHashMap<String>());
  String result=convertTemplates(text,pattern,templateText);
  result=ProjectTemplateFileProcessor.encodeFile(result,virtualFile,project);
  for (  Map.Entry<String,String> entry : parameters.entrySet()) {
    result=result.replace(entry.getKey(),"${" + entry.getValue() + "}");
  }
  return result;
}
