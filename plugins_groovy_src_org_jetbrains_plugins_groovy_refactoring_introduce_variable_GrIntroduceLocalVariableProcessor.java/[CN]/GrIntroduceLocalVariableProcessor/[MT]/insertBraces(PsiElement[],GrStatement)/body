{
  List<SmartPsiElementPointer<PsiElement>> replacedPointers=ContainerUtil.newArrayList();
  final SmartPointerManager pointerManager=SmartPointerManager.getInstance(myContext.getProject());
  for (  PsiElement element : replaced) {
    replacedPointers.add(pointerManager.createSmartPsiElementPointer(element));
  }
  SmartPsiElementPointer<GrStatement> anchorPointer=pointerManager.createSmartPsiElementPointer(anchor);
  final Document document=myContext.getEditor().getDocument();
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myContext.getProject());
  documentManager.doPostponedOperationsAndUnblockDocument(document);
  final TextRange range=anchor.getTextRange();
  document.insertString(range.getEndOffset(),"}");
  document.insertString(skipSpacesBackward(document,range.getStartOffset()),"{");
  documentManager.commitDocument(document);
  for (int i=0; i < replacedPointers.size(); i++) {
    SmartPsiElementPointer<PsiElement> pointer=replacedPointers.get(i);
    replaced[i]=pointer.getElement();
  }
  anchor=anchorPointer.getElement();
  CodeStyleManager.getInstance(myContext.getProject()).reformat(anchor.getParent());
  return anchor;
}
