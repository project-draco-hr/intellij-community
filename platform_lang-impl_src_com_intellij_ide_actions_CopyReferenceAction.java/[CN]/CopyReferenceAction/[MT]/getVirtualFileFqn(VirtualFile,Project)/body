{
  final LogicalRoot logicalRoot=LogicalRootsManager.getLogicalRootsManager(project).findLogicalRoot(virtualFile);
  if (logicalRoot != null && logicalRoot.getVirtualFile() != null) {
    String logical=FileUtil.toSystemIndependentName(VfsUtilCore.virtualToIoFile(logicalRoot.getVirtualFile()).getPath());
    String path=FileUtil.toSystemIndependentName(VfsUtilCore.virtualToIoFile(virtualFile).getPath());
    return ObjectUtils.assertNotNull(FileUtil.getRelativePath(logical,path,'/'));
  }
  final VirtualFile contentRoot=ProjectRootManager.getInstance(project).getFileIndex().getContentRootForFile(virtualFile);
  if (contentRoot != null) {
    return ObjectUtils.assertNotNull(FileUtil.getRelativePath(VfsUtilCore.virtualToIoFile(contentRoot),VfsUtilCore.virtualToIoFile(virtualFile)));
  }
  return virtualFile.getPath();
}
