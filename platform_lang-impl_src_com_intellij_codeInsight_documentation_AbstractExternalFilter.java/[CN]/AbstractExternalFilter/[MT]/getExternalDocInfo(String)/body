{
  Application app=ApplicationManager.getApplication();
  if (!app.isUnitTestMode() && app.isDispatchThread() || app.isWriteAccessAllowed()) {
    LOG.error("May block indefinitely: shouldn't be called from EDT or under write lock");
    return null;
  }
  if (url == null || !MyJavadocFetcher.ourFree) {
    return null;
  }
  MyJavadocFetcher fetcher=new MyJavadocFetcher(url,new MyDocBuilder(){
    @Override public void buildFromStream(    String url,    Reader input,    StringBuilder result) throws IOException {
      doBuildFromStream(url,input,result);
    }
  }
);
  try {
    app.executeOnPooledThread(fetcher).get();
  }
 catch (  Exception e) {
    return null;
  }
  Exception exception=fetcher.myException;
  if (exception != null) {
    fetcher.myException=null;
    throw exception;
  }
  final String docText=correctRefs(ourAnchorSuffix.matcher(url).replaceAll(""),fetcher.data.toString());
  if (LOG.isDebugEnabled()) {
    LOG.debug("Filtered JavaDoc: " + docText + "\n");
  }
  return PlatformDocumentationUtil.fixupText(docText);
}
