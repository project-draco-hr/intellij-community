{
  return HttpRequests.request(url.toExternalForm()).connect(new HttpRequests.RequestProcessor<String>(){
    @Override public String process(    @NotNull HttpRequests.Request request) throws IOException {
      String result=request.getConnection().getContentEncoding();
      BufferedReader reader=new BufferedReader(new InputStreamReader(request.getInputStream()));
      try {
        for (String htmlLine=reader.readLine(); htmlLine != null; htmlLine=reader.readLine()) {
          result=parseContentEncoding(htmlLine);
          if (result != null) {
            break;
          }
        }
      }
  finally {
        reader.close();
      }
      return result;
    }
  }
,null,null);
}
