{
  GitCompoundResult checkoutResult=new GitCompoundResult(myProject);
  GitCompoundResult deleteResult=new GitCompoundResult(myProject);
  for (  GitRepository repository : getSuccessfulRepositories()) {
    GitCommandResult result=myGit.checkout(repository,myCurrentHeads.get(repository),null,true,false);
    checkoutResult.append(repository,result);
    if (result.success() && myNewBranch != null) {
      deleteResult.append(repository,myGit.branchDelete(repository,myNewBranch,true));
    }
    refresh(repository);
  }
  if (!checkoutResult.totalSuccess() || !deleteResult.totalSuccess()) {
    StringBuilder message=new StringBuilder();
    if (!checkoutResult.totalSuccess()) {
      message.append("Errors during checkout: ");
      message.append(checkoutResult.getErrorOutputWithReposIndication());
    }
    if (!deleteResult.totalSuccess()) {
      message.append("Errors during deleting ").append(code(myNewBranch)).append(": ");
      message.append(deleteResult.getErrorOutputWithReposIndication());
    }
    VcsNotifier.getInstance(myProject).notifyError("Error during rollback",message.toString());
  }
}
