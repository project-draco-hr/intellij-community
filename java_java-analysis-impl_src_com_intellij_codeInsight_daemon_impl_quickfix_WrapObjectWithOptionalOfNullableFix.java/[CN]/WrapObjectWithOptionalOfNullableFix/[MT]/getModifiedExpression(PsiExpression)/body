{
  final Project project=expression.getProject();
  PsiModifierListOwner toCheckNullability=null;
  if (expression instanceof PsiMethodCallExpression) {
    toCheckNullability=((PsiMethodCallExpression)expression).resolveMethod();
  }
 else   if (expression instanceof PsiReferenceExpression) {
    final PsiElement resolved=((PsiReferenceExpression)expression).resolve();
    if (resolved instanceof PsiModifierListOwner) {
      toCheckNullability=(PsiModifierListOwner)resolved;
    }
  }
  final Nullness nullability=toCheckNullability == null ? Nullness.NOT_NULL : DfaPsiUtil.getElementNullability(expression.getType(),toCheckNullability);
  String methodName=nullability == Nullness.NOT_NULL ? "of" : "ofNullable";
  final String newExpressionText=CommonClassNames.JAVA_UTIL_OPTIONAL + "." + methodName+ "("+ expression.getText()+ ")";
  return JavaPsiFacade.getElementFactory(project).createExpressionFromText(newExpressionText,expression);
}
