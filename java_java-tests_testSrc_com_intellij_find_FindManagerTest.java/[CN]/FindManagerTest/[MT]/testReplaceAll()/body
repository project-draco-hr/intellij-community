{
  final FindModel findModel=new FindModel();
  String toFind="xxx";
  @SuppressWarnings("SpellCheckingInspection") String toReplace="XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX";
  findModel.setStringToFind(toFind);
  findModel.setStringToReplace(toReplace);
  findModel.setWholeWordsOnly(true);
  findModel.setFromCursor(false);
  findModel.setGlobal(true);
  findModel.setMultipleFiles(false);
  findModel.setProjectScope(true);
  findModel.setRegularExpressions(false);
  findModel.setPromptOnReplace(false);
  myFindManager.setFindNextModel(null);
  myFindManager.getFindInFileModel().copyFrom(findModel);
  String text=StringUtil.repeat(toFind + "\n",6);
  configureByText(FileTypes.PLAIN_TEXT,text);
  final List<Usage> usages=FindUtil.findAll(getProject(),myEditor,findModel);
  assertNotNull(usages);
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      for (      Usage usage : usages) {
        try {
          ReplaceInProjectManager.getInstance(getProject()).replaceUsage(usage,findModel,Collections.<Usage>emptySet(),false);
        }
 catch (        FindManager.MalformedReplacementStringException e) {
          throw new RuntimeException(e);
        }
      }
    }
  }
,"",null);
  String newText=StringUtil.repeat(toReplace + "\n",6);
  assertEquals(newText,getEditor().getDocument().getText());
}
