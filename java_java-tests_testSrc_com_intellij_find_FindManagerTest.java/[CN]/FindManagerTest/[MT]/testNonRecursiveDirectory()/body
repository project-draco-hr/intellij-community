{
  VirtualFile root=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(createTempDirectory());
  addSourceContentToRoots(myModule,root);
  VirtualFile foo=createChildDirectory(root,"foo");
  VirtualFile bar=createChildDirectory(foo,"bar");
  createFile(myModule,root,"A.txt","goo doo");
  createFile(myModule,foo,"A.txt","goo doo");
  createFile(myModule,bar,"A.txt","doo goo");
  FindModel findModel=FindManagerTestUtils.configureFindModel("done");
  findModel.setProjectScope(false);
  findModel.setDirectoryName(foo.getPath());
  findModel.setStringToFind("doo");
  findModel.setWithSubdirectories(true);
  assertSize(2,findUsages(findModel));
  findModel.setWithSubdirectories(false);
  assertSize(1,findUsages(findModel));
}
