{
  PyFile sourceFile=((PyFile)PyUtil.turnDirIntoInit(source));
  if (sourceFile instanceof PyFileImpl) {
    PyStatement importStatement=importElement.getContainingImportStatement();
    String refName=null;
    if (importStatement instanceof PyFromImportStatement) {
      QualifiedName qName=((PyFromImportStatement)importStatement).getImportSourceQName();
      if (qName != null) {
        refName=qName.toString();
      }
    }
 else {
      QualifiedName importReferenceQName=importElement.getImportedQName();
      if (importReferenceQName != null) {
        refName=importReferenceQName.toString();
      }
    }
    if (refName != null) {
      if (seenFileNames.contains(refName)) {
        return existingImportFile;
      }
      seenFileNames.add(refName);
    }
    PsiElement res=sourceFile.findExportedName(refText);
    if (res != null && !(res instanceof PyFile) && !(res instanceof PyImportElement) && res.getContainingFile() != null && PsiTreeUtil.isAncestor(source,res.getContainingFile(),false)) {
      existingImportFile=sourceFile;
      fix.addImport(res,sourceFile,importElement);
    }
  }
  return existingImportFile;
}
