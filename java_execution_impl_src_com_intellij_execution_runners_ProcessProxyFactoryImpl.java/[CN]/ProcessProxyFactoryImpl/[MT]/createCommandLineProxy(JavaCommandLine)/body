{
  JavaParameters javaParameters=javaCmdLine.getJavaParameters();
  if (useLauncher(javaParameters)) {
    String mainClass=javaParameters.getMainClass();
    if (mainClass != null) {
      try {
        ProcessProxyImpl proxy=new ProcessProxyImpl();
        JavaSdkUtil.addRtJar(javaParameters.getClassPath());
        ParametersList vmParametersList=javaParameters.getVMParametersList();
        vmParametersList.defineProperty(ProcessProxyImpl.PROPERTY_PORT_NUMBER,String.valueOf(proxy.getPortNumber()));
        vmParametersList.defineProperty(ProcessProxyImpl.PROPERTY_BIN_PATH,PathManager.getBinPath());
        javaParameters.getProgramParametersList().prepend(mainClass);
        javaParameters.setMainClass(ProcessProxyImpl.LAUNCH_MAIN_CLASS);
        return proxy;
      }
 catch (      ProcessProxyImpl.NoMoreSocketsException ignored) {
      }
    }
  }
  return null;
}
