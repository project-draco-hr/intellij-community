{
  Project project=psiFile.getProject();
  Sdk sdk=null;
  final VirtualFile vfile=psiFile instanceof PsiFile ? ((PsiFile)psiFile).getOriginalFile().getVirtualFile() : psiFile.getVirtualFile();
  if (vfile != null) {
    final ProjectRootManager projectRootManager=ProjectRootManager.getInstance(project);
    sdk=projectRootManager.getProjectSdk();
    if (sdk == null) {
      final List<OrderEntry> orderEntries=projectRootManager.getFileIndex().getOrderEntriesForFile(vfile);
      for (      OrderEntry orderEntry : orderEntries) {
        if (orderEntry instanceof JdkOrderEntry) {
          sdk=((JdkOrderEntry)orderEntry).getJdk();
        }
 else         if (orderEntry instanceof ModuleLibraryOrderEntryImpl) {
          sdk=PythonSdkType.findPythonSdk(orderEntry.getOwnerModule());
        }
      }
    }
  }
  return sdk;
}
