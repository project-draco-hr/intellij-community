{
  super(project,panel);
  HgVcs myVcs=HgVcs.getInstance(myProject);
  myAmend.setEnabled(myVcs != null && myVcs.getVersion().isAmendSupported());
  myAmend.setText(myAmend.getText() + " (QRefresh)");
  final Insets insets=new Insets(2,2,2,2);
  GridBagConstraints c=new GridBagConstraints();
  c.anchor=GridBagConstraints.CENTER;
  c.insets=insets;
  c.gridx=1;
  c.gridy=2;
  c.weightx=1;
  c.fill=GridBagConstraints.HORIZONTAL;
  myCommitSubrepos=new JCheckBox("Commit subrepositories",false);
  myCommitSubrepos.setToolTipText(XmlStringUtil.wrapInHtml("Commit all subrepos for selected repositories.<br>" + " <code>hg ci <i><b>files</b></i> -S <i><b>subrepos</b></i></code>"));
  myCommitSubrepos.setMnemonic('s');
  myPanel.add(myCommitSubrepos,c);
  Collection<HgRepository> repos=HgActionUtil.collectRepositoriesFromFiles(HgUtil.getRepositoryManager(myProject),myCheckinPanel.getRoots());
  myCommitSubrepos.setVisible(ContainerUtil.exists(repos,new Condition<HgRepository>(){
    @Override public boolean value(    HgRepository repository){
      return repository.hasSubrepos();
    }
  }
));
  myCommitSubrepos.addActionListener(new MySelectionListener(myAmend));
  myAmend.addActionListener(new MySelectionListener(myCommitSubrepos));
}
