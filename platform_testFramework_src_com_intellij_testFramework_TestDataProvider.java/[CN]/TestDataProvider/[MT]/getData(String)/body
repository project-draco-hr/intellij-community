{
  if (myProject.isDisposed()) {
    throw new RuntimeException("TestDataProvider is already disposed for " + myProject + "\n"+ "If you closed a project in test, please reset IdeaTestApplication.setDataProvider.");
  }
  if (CommonDataKeys.PROJECT.is(dataId)) {
    return myProject;
  }
 else   if (CommonDataKeys.EDITOR.is(dataId) || OpenFileDescriptor.NAVIGATE_IN_EDITOR.is(dataId)) {
    return FileEditorManager.getInstance(myProject).getSelectedTextEditor();
  }
 else   if (PlatformDataKeys.FILE_EDITOR.is(dataId)) {
    Editor editor=FileEditorManager.getInstance(myProject).getSelectedTextEditor();
    return editor == null ? null : TextEditorProvider.getInstance().getTextEditor(editor);
  }
 else {
    Editor editor=(Editor)getData(CommonDataKeys.EDITOR.getName());
    if (editor != null) {
      FileEditorManagerEx manager=FileEditorManagerEx.getInstanceEx(myProject);
      Object managerData=manager.getData(dataId,editor,manager.getSelectedFiles()[0]);
      if (managerData != null) {
        return managerData;
      }
      JComponent component=editor.getContentComponent();
      if (component instanceof EditorComponentImpl) {
        return ((EditorComponentImpl)component).getData(dataId);
      }
    }
    return null;
  }
}
