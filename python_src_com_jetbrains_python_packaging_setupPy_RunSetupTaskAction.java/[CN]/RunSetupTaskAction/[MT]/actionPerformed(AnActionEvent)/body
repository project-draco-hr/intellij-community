{
  Module module=e.getData(LangDataKeys.MODULE);
  if (module == null)   return;
  final PyFile setupPy=PyPackageUtil.findSetupPy(module);
  try {
    final List<SetupTask.Option> options=SetupTaskIntrospector.getSetupTaskOptions(module,myTaskName);
    List<String> parameters=new ArrayList<String>();
    parameters.add(myTaskName);
    if (options != null) {
      SetupTaskDialog dialog=new SetupTaskDialog(module.getProject(),myTaskName,options);
      dialog.show();
      if (!dialog.isOK()) {
        return;
      }
      parameters.addAll(dialog.getCommandLine());
    }
    final PythonTask task=new PythonTask(module,myTaskName);
    final VirtualFile virtualFile=setupPy.getVirtualFile();
    task.setRunnerScript(virtualFile.getPath());
    task.setWorkingDirectory(virtualFile.getParent().getPath());
    task.setParameters(parameters);
    task.setAfterCompletion(new Runnable(){
      @Override public void run(){
        LocalFileSystem.getInstance().refresh(true);
      }
    }
);
    task.run();
  }
 catch (  ExecutionException ee) {
    Messages.showErrorDialog(module.getProject(),"Failed to run task: " + ee.getMessage(),myTaskName);
  }
}
