{
  if (myTextRange.contains(value.getTextRange())) {
    PsiElement child=value.getFirstChild();
    if (child != null && !containsQuoteChars(value)) {
      String newValue=null;
      if (child.getNode().getElementType() == XmlTokenType.XML_ATTRIBUTE_VALUE_START_DELIMITER) {
        PsiElement lastChild=value.getLastChild();
        if (lastChild != null && lastChild.getNode().getElementType() == XmlTokenType.XML_ATTRIBUTE_VALUE_END_DELIMITER) {
          CharSequence delimiterChars=child.getNode().getChars();
          if (delimiterChars.length() == 1) {
            char existingQuote=delimiterChars.charAt(0);
            if (existingQuote != myQuoteChar) {
              newValue=convertQuotes(value);
            }
          }
        }
      }
 else       if (child.getNode().getElementType() == XmlTokenType.XML_ATTRIBUTE_VALUE_TOKEN && child == value.getLastChild()) {
        newValue=surroundWithQuotes(value);
      }
      if (newValue != null) {
        int startOffset=value.getTextRange().getStartOffset() + myDelta;
        int endOffset=value.getTextRange().getEndOffset() + myDelta;
        myDocument.replaceString(startOffset,endOffset,newValue);
        myDelta+=newValue.length() - value.getTextLength();
      }
    }
  }
}
