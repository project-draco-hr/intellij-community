{
  if (!isModuleAdded || MODULE_RENAMING_REQUESTOR.equals(event.getRequestor()) || !VirtualFile.PROP_NAME.equals(event.getPropertyName())) {
    return;
  }
  VirtualFile parent=event.getParent();
  if (parent != null) {
    String parentPath=parent.getPath();
    String ancestorPath=parentPath + "/" + event.getOldValue();
    String moduleFilePath=getModuleFilePath();
    if (VfsUtilCore.isAncestor(new File(ancestorPath),new File(moduleFilePath),true)) {
      setModuleFilePath(moduleFilePath,parentPath + "/" + event.getNewValue()+ "/"+ FileUtil.getRelativePath(ancestorPath,moduleFilePath,'/'));
    }
  }
  VirtualFile moduleFile=getModuleFile();
  if (moduleFile != null && moduleFile.equals(event.getFile())) {
    String oldName=myName;
    myName=moduleNameByFileName(moduleFile.getName());
    ModuleManagerImpl.getInstanceImpl(getProject()).fireModuleRenamedByVfsEvent(ModuleImpl.this,oldName);
  }
}
