{
  if (repositoryLocation == null) {
    return null;
  }
  VirtualFile root=((HgRepositoryLocation)repositoryLocation).getRoot();
  HgFile hgFile=new HgFile(root,VcsUtil.getFilePath(root.getPath()));
  HgLogCommand hgLogCommand=new HgLogCommand(project);
  hgLogCommand.setLogFile(false);
  hgLogCommand.setFollowCopies(true);
  List<String> args=new ArrayList<>();
  args.add("--rev");
  args.add(revision);
  final List<HgFileRevision> revisions;
  revisions=hgLogCommand.execute(hgFile,1,true,args);
  if (ContainerUtil.isEmpty(revisions)) {
    return null;
  }
  HgFileRevision localRevision=revisions.get(0);
  HgRevisionNumber vcsRevisionNumber=localRevision.getRevisionNumber();
  List<HgRevisionNumber> parents=vcsRevisionNumber.getParents();
  HgRevisionNumber firstParent=parents.isEmpty() ? null : parents.get(0);
  List<Change> changes=new ArrayList<>();
  for (  String file : localRevision.getModifiedFiles()) {
    changes.add(createChange(root,file,firstParent,file,vcsRevisionNumber,FileStatus.MODIFIED));
  }
  for (  String file : localRevision.getAddedFiles()) {
    changes.add(createChange(root,null,null,file,vcsRevisionNumber,FileStatus.ADDED));
  }
  for (  String file : localRevision.getDeletedFiles()) {
    changes.add(createChange(root,file,firstParent,null,vcsRevisionNumber,FileStatus.DELETED));
  }
  for (  Map.Entry<String,String> copiedFile : localRevision.getMovedFiles().entrySet()) {
    changes.add(createChange(root,copiedFile.getKey(),firstParent,copiedFile.getValue(),vcsRevisionNumber,HgChangeProvider.RENAMED));
  }
  return new HgCommittedChangeList(myVcs,vcsRevisionNumber,localRevision.getBranchName(),localRevision.getCommitMessage(),localRevision.getAuthor(),localRevision.getRevisionDate(),changes);
}
