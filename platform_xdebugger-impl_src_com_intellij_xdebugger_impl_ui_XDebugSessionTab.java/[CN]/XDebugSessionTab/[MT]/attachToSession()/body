{
  for (  XDebugView view : myViews) {
    session.addSessionListener(new XDebugViewSessionListener(view,session),this);
  }
  XDebugTabLayouter layouter=session.getDebugProcess().createTabLayouter();
  Content consoleContent=layouter.registerConsoleContent(myUi,myConsole);
  attachNotificationTo(consoleContent);
  layouter.registerAdditionalContent(myUi);
  RunContentBuilder.addAdditionalConsoleEditorActions(myConsole,consoleContent);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  DefaultActionGroup leftToolbar=new DefaultActionGroup();
  final Executor debugExecutor=DefaultDebugExecutor.getDebugExecutorInstance();
  ExecutionEnvironment environment=getEnvironment();
  if (environment != null) {
    List<AnAction> additionalRestartActions=session.getRestartActions();
    if (!additionalRestartActions.isEmpty()) {
      leftToolbar.addAll(additionalRestartActions);
      leftToolbar.addSeparator();
    }
    leftToolbar.addAll(session.getExtraActions());
  }
  leftToolbar.addAll(getCustomizedActionGroup(XDebuggerActions.TOOL_WINDOW_LEFT_TOOLBAR_GROUP));
  for (  AnAction action : session.getExtraStopActions()) {
    leftToolbar.add(action,new Constraints(Anchor.AFTER,IdeActions.ACTION_STOP_PROGRAM));
  }
  leftToolbar.addSeparator();
  leftToolbar.add(myUi.getOptions().getLayoutActions());
  final AnAction[] commonSettings=myUi.getOptions().getSettingsActionsList();
  final AnAction commonSettingsList=myUi.getOptions().getSettingsActions();
  final DefaultActionGroup settings=new DefaultActionGroup("DebuggerSettings",commonSettings.length > 0){
    @Override public void update(    AnActionEvent e){
      e.getPresentation().setText(ActionsBundle.message("group.XDebugger.settings.text"));
      e.getPresentation().setIcon(commonSettingsList.getTemplatePresentation().getIcon());
    }
    @Override public boolean isDumbAware(){
      return true;
    }
  }
;
  for (  AnAction each : commonSettings) {
    settings.add(each);
  }
  if (commonSettings.length > 0) {
    settings.addSeparator();
  }
  if (!session.getDebugProcess().isValuesCustomSorted()) {
    settings.add(new ToggleSortValuesAction(commonSettings.length == 0));
  }
  leftToolbar.add(settings);
  leftToolbar.addSeparator();
  leftToolbar.add(PinToolwindowTabAction.getPinAction());
  leftToolbar.add(new CloseAction(environment != null ? environment.getExecutor() : debugExecutor,myRunContentDescriptor,getProject()));
  leftToolbar.add(new ContextHelpAction(debugExecutor.getHelpId()));
  DefaultActionGroup topToolbar=new DefaultActionGroup();
  topToolbar.addAll(getCustomizedActionGroup(XDebuggerActions.TOOL_WINDOW_TOP_TOOLBAR_GROUP));
  session.getDebugProcess().registerAdditionalActions(leftToolbar,topToolbar);
  myUi.getOptions().setLeftToolbar(leftToolbar,ActionPlaces.DEBUGGER_TOOLBAR);
  myUi.getOptions().setTopToolbar(topToolbar,ActionPlaces.DEBUGGER_TOOLBAR);
  if (environment != null) {
    RunProfile runConfiguration=environment.getRunProfile();
    registerFileMatcher(runConfiguration);
    initLogConsoles(runConfiguration,myRunContentDescriptor.getProcessHandler(),myConsole);
  }
}
