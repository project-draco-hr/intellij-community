{
  final List<TextRange> relativeRanges=ReferenceRange.getRanges(ref);
  if (result == null) {
    result=new ArrayList<TextRange>(relativeRanges.size());
  }
  for (  TextRange relativeRange : relativeRanges) {
    PsiElement element=ref.getElement();
    TextRange range=safeCut(element.getTextRange(),relativeRange);
    result.add(InjectedLanguageManager.getInstance(element.getProject()).injectedToHost(element,range));
  }
  return result;
}
