{
  SearchScope customScope=findModel.getCustomScope();
  PsiDirectory psiDir=getPsiDirectory(findModel,project);
  VirtualFile directory=psiDir == null ? null : psiDir.getVirtualFile();
  Module module=findModel.getModuleName() == null ? null : ModuleManager.getInstance(project).findModuleByName(findModel.getModuleName());
  return findModel.isCustomScope() && customScope != null ? customScope : directory != null ? GlobalSearchScopesCore.directoryScope(project,directory,findModel.isWithSubdirectories()) : module != null ? module.getModuleContentScope() : findModel.isProjectScope() ? ProjectScope.getContentScope(project) : GlobalSearchScope.allScope(project);
}
