{
  EditorWindow wndToOpenIn=null;
  if (Registry.is("editor.use.preview") && !myPreviewBlocker.get()) {
    wndToOpenIn=myPreviewPanel.getWindow();
    if (virtualFile.equals(myPreviewPanel.getCurrentFile()))     return wndToOpenIn;
    final VirtualFile modifiedFile=myPreviewPanel.closeCurrentFile();
    ToolWindowManager.getInstance(myProject).getToolWindow(ToolWindowId.PREVIEW).activate(null,false);
    if (modifiedFile != null) {
      CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
        @Override public void run(){
          myPreviewBlocker.set(true);
          try {
            openFileWithProviders(modifiedFile,focusEditor,searchForSplitter);
          }
  finally {
            myPreviewBlocker.set(false);
          }
        }
      }
,"",null);
    }
  }
  return wndToOpenIn;
}
