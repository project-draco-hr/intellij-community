{
  EditorWindow wndToOpenIn=null;
  if (PreviewPanel.isAvailable() && !myPreviewBlocker.get()) {
    wndToOpenIn=myPreviewPanel.getWindow();
    if (myPreviewPanel.hasCurrentFile(virtualFile))     return wndToOpenIn;
    final VirtualFile modifiedFile=myPreviewPanel.getCurrentModifiedFile();
    ToolWindowManager.getInstance(myProject).getToolWindow(ToolWindowId.PREVIEW).activate(null,false);
    if (modifiedFile != null) {
      CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
        @Override public void run(){
          myPreviewBlocker.set(true);
          try {
            openFileWithProviders(modifiedFile,focusEditor,searchForSplitter);
          }
  finally {
            myPreviewBlocker.set(false);
          }
        }
      }
,"",null);
    }
  }
  return wndToOpenIn;
}
