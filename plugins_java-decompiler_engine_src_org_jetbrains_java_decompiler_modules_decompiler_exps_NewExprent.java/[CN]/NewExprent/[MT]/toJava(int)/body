{
  StringBuilder buf=new StringBuilder();
  if (anonymous) {
    ClassNode child=DecompilerContext.getClassProcessor().getMapRootClasses().get(newtype.value);
    buf.append("(");
    if (!lambda && constructor != null) {
      InvocationExprent invsuper=child.superInvocation;
      ClassNode newnode=DecompilerContext.getClassProcessor().getMapRootClasses().get(invsuper.getClassname());
      List<VarVersionPaar> sigFields=null;
      if (newnode != null) {
        if (newnode.wrapper != null) {
          sigFields=newnode.wrapper.getMethodWrapper("<init>",invsuper.getStringDescriptor()).signatureFields;
        }
 else {
          if (newnode.type == ClassNode.CLASS_MEMBER && (newnode.access & CodeConstants.ACC_STATIC) == 0 && !constructor.getLstParameters().isEmpty()) {
            sigFields=new ArrayList<VarVersionPaar>(Collections.nCopies(constructor.getLstParameters().size(),(VarVersionPaar)null));
            sigFields.set(0,new VarVersionPaar(-1,0));
          }
        }
      }
      boolean firstpar=true;
      int start=0, end=invsuper.getLstParameters().size();
      if (enumconst) {
        start+=2;
        end-=1;
      }
      for (int i=start; i < end; i++) {
        if (sigFields == null || sigFields.get(i) == null) {
          if (!firstpar) {
            buf.append(", ");
          }
          Exprent param=invsuper.getLstParameters().get(i);
          if (param.type == Exprent.EXPRENT_VAR) {
            int varindex=((VarExprent)param).getIndex();
            if (varindex > 0 && varindex <= constructor.getLstParameters().size()) {
              param=constructor.getLstParameters().get(varindex - 1);
            }
          }
          StringBuilder buff=new StringBuilder();
          ExprProcessor.getCastedExprent(param,invsuper.getDescriptor().params[i],buff,indent,true);
          buf.append(buff);
          firstpar=false;
        }
      }
    }
    if (!enumconst) {
      String enclosing=null;
      if (!lambda && constructor != null) {
        enclosing=getQualifiedNewInstance(child.anonimousClassType.value,constructor.getLstParameters(),indent);
      }
      String typename=ExprProcessor.getCastTypeName(child.anonimousClassType);
      if (enclosing != null) {
        ClassNode anonimousNode=DecompilerContext.getClassProcessor().getMapRootClasses().get(child.anonimousClassType.value);
        if (anonimousNode != null) {
          typename=anonimousNode.simpleName;
        }
 else {
          typename=typename.substring(typename.lastIndexOf('.') + 1);
        }
      }
      buf.insert(0,"new " + typename);
      if (enclosing != null) {
        buf.insert(0,enclosing + ".");
      }
    }
    buf.append(")");
    if (enumconst && buf.length() == 2) {
      buf.setLength(0);
    }
    StringWriter strwriter=new StringWriter();
    BufferedWriter bufstrwriter=new BufferedWriter(strwriter);
    ClassWriter clwriter=new ClassWriter();
    try {
      if (lambda) {
        clwriter.classLambdaToJava(child,bufstrwriter,(constructor == null ? null : constructor.getInstance()),indent);
      }
 else {
        clwriter.classToJava(child,bufstrwriter,indent);
      }
      bufstrwriter.flush();
    }
 catch (    IOException ex) {
      throw new RuntimeException(ex);
    }
    if (lambda && !DecompilerContext.getOption(IFernflowerPreferences.LAMBDA_TO_ANONYMOUS_CLASS)) {
      buf.setLength(0);
    }
    buf.append(strwriter.toString());
  }
 else   if (directArrayInit) {
    VarType leftType=newtype.copy();
    leftType.decArrayDim();
    buf.append("{");
    for (int i=0; i < lstArrayElements.size(); i++) {
      if (i > 0) {
        buf.append(", ");
      }
      StringBuilder buff=new StringBuilder();
      ExprProcessor.getCastedExprent(lstArrayElements.get(i),leftType,buff,indent,false);
      buf.append(buff);
    }
    buf.append("}");
  }
 else {
    if (newtype.arraydim == 0) {
      if (constructor != null) {
        List<Exprent> lstParameters=constructor.getLstParameters();
        ClassNode newnode=DecompilerContext.getClassProcessor().getMapRootClasses().get(constructor.getClassname());
        List<VarVersionPaar> sigFields=null;
        if (newnode != null) {
          if (newnode.wrapper != null) {
            sigFields=newnode.wrapper.getMethodWrapper("<init>",constructor.getStringDescriptor()).signatureFields;
          }
 else {
            if (newnode.type == ClassNode.CLASS_MEMBER && (newnode.access & CodeConstants.ACC_STATIC) == 0 && !constructor.getLstParameters().isEmpty()) {
              sigFields=new ArrayList<VarVersionPaar>(Collections.nCopies(lstParameters.size(),(VarVersionPaar)null));
              sigFields.set(0,new VarVersionPaar(-1,0));
            }
          }
        }
        int start=enumconst ? 2 : 0;
        if (!enumconst || start < lstParameters.size()) {
          buf.append("(");
          boolean firstpar=true;
          for (int i=start; i < lstParameters.size(); i++) {
            if (sigFields == null || sigFields.get(i) == null) {
              if (!firstpar) {
                buf.append(", ");
              }
              StringBuilder buff=new StringBuilder();
              ExprProcessor.getCastedExprent(lstParameters.get(i),constructor.getDescriptor().params[i],buff,indent,true);
              buf.append(buff);
              firstpar=false;
            }
          }
          buf.append(")");
        }
      }
      if (!enumconst) {
        String enclosing=null;
        if (constructor != null) {
          enclosing=getQualifiedNewInstance(newtype.value,constructor.getLstParameters(),indent);
        }
        String typename=ExprProcessor.getTypeName(newtype);
        if (enclosing != null) {
          ClassNode newNode=DecompilerContext.getClassProcessor().getMapRootClasses().get(newtype.value);
          if (newNode != null) {
            typename=newNode.simpleName;
          }
 else {
            typename=typename.substring(typename.lastIndexOf('.') + 1);
          }
        }
        buf.insert(0,"new " + typename);
        if (enclosing != null) {
          buf.insert(0,enclosing + ".");
        }
      }
    }
 else {
      buf.append("new ").append(ExprProcessor.getTypeName(newtype));
      if (lstArrayElements.isEmpty()) {
        for (int i=0; i < newtype.arraydim; i++) {
          buf.append("[").append(i < lstDims.size() ? lstDims.get(i).toJava(indent) : "").append("]");
        }
      }
 else {
        for (int i=0; i < newtype.arraydim; i++) {
          buf.append("[]");
        }
        VarType leftType=newtype.copy();
        leftType.decArrayDim();
        buf.append("{");
        for (int i=0; i < lstArrayElements.size(); i++) {
          if (i > 0) {
            buf.append(", ");
          }
          StringBuilder buff=new StringBuilder();
          ExprProcessor.getCastedExprent(lstArrayElements.get(i),leftType,buff,indent,false);
          buf.append(buff);
        }
        buf.append("}");
      }
    }
  }
  return buf.toString();
}
