{
  if (ourClient == null) {
    showLoginDialog();
  }
  final HttpPost attemptRequest=new HttpPost(stepicApiUrl + "attempts");
  setHeaders(attemptRequest,"application/json");
  String attemptRequestBody=new Gson().toJson(new AttemptWrapper(task.getStepicId()));
  attemptRequest.setEntity(new StringEntity(attemptRequestBody,ContentType.APPLICATION_JSON));
  try {
    final CloseableHttpResponse attemptResponse=ourClient.execute(attemptRequest);
    final String attemptResponseString=EntityUtils.toString(attemptResponse.getEntity());
    final StatusLine statusLine=attemptResponse.getStatusLine();
    if (statusLine.getStatusCode() != 201) {
      LOG.error("Failed to make attempt " + attemptResponseString);
    }
    final AttemptWrapper.Attempt attempt=new Gson().fromJson(attemptResponseString,AttemptContainer.class).attempts.get(0);
    final Map<String,TaskFile> taskFiles=task.getTaskFiles();
    final ArrayList<SolutionFile> files=new ArrayList<SolutionFile>();
    for (    TaskFile fileEntry : taskFiles.values()) {
      files.add(new SolutionFile(fileEntry.name,fileEntry.text));
    }
    postSubmission(passed,attempt,files);
  }
 catch (  IOException e) {
    LOG.error(e.getMessage());
  }
}
