{
  final StepOptions source=new StepOptions();
  final String text=task.getTestsText(project);
  source.test=Collections.singletonList(new TestFileWrapper("tests.py",text));
  source.files=new ArrayList<TaskFile>();
  source.title=task.getName();
  for (  final Map.Entry<String,TaskFile> entry : task.getTaskFiles().entrySet()) {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        final VirtualFile taskDir=task.getTaskDir(project);
        EduUtils.createStudentFileFromAnswer(project,taskDir,taskDir,entry);
      }
    }
);
    final TaskFile taskFile=entry.getValue();
    taskFile.name=entry.getKey();
    final Document document=task.getDocument(project,taskFile.name);
    if (document != null) {
      source.text=document.getImmutableCharSequence().toString();
      taskFile.text=document.getImmutableCharSequence().toString();
    }
    source.files.add(taskFile);
  }
  return source;
}
