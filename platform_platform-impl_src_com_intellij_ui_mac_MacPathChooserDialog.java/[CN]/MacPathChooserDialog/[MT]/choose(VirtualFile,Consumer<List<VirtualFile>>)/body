{
  String path=toSelect != null ? toSelect.getCanonicalPath() : null;
  myFileDialog.setFile(path);
  myFileDialog.setVisible(true);
  File[] files=myFileDialog.getFiles();
  List<VirtualFile> virtualFilesList=getChosenFiles(Stream.of(files));
  try {
    myFileChooserDescriptor.validateSelectedFiles(virtualFilesList.toArray(VirtualFile.EMPTY_ARRAY));
  }
 catch (  Exception e) {
    Messages.showErrorDialog(myParent,e.getMessage(),myTitle);
    return;
  }
  if (!ArrayUtil.isEmpty(files)) {
    callback.consume(virtualFilesList);
  }
 else   if (callback instanceof FileChooser.FileChooserConsumer) {
    ((FileChooser.FileChooserConsumer)callback).cancelled();
  }
}
