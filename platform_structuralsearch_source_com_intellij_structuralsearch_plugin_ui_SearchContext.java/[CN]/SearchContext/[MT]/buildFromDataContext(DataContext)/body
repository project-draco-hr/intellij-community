{
  Project project=CommonDataKeys.PROJECT.getData(context);
  if (project == null) {
    project=ProjectManager.getInstance().getDefaultProject();
  }
  PsiFile file=CommonDataKeys.PSI_FILE.getData(context);
  final VirtualFile vFile=CommonDataKeys.VIRTUAL_FILE.getData(context);
  if (vFile != null && (file == null || !vFile.equals(file.getContainingFile().getVirtualFile()))) {
    file=PsiManager.getInstance(project).findFile(vFile);
  }
  final Editor editor=CommonDataKeys.EDITOR.getData(context);
  return new SearchContext(project,file,editor);
}
