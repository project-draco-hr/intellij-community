{
  final Project project=getEventProject(e);
  if (project == null) {
    return;
  }
  final ResourceBundleEditor resourceBundleEditor;
  final DataContext context=e.getDataContext();
  FileEditor fileEditor=PlatformDataKeys.FILE_EDITOR.getData(context);
  if (fileEditor instanceof ResourceBundleEditor) {
    resourceBundleEditor=(ResourceBundleEditor)fileEditor;
  }
 else {
    final Editor editor=CommonDataKeys.EDITOR.getData(context);
    resourceBundleEditor=editor != null ? editor.getUserData(ResourceBundleEditor.RESOURCE_BUNDLE_EDITOR_KEY) : null;
  }
  final String prefix;
  final String separator;
  final String place=e.getPlace();
  if (ActionPlaces.STRUCTURE_VIEW_TOOLBAR.equals(place)) {
    prefix=null;
    separator=null;
  }
 else {
    final ResourceBundleEditorViewElement selectedElement=resourceBundleEditor.getSelectedElementIfOnlyOne();
    if (selectedElement == null) {
      return;
    }
    if (selectedElement instanceof PropertiesPrefixGroup) {
      final PropertiesPrefixGroup group=(PropertiesPrefixGroup)selectedElement;
      prefix=group.getPrefix();
      separator=group.getSeparator();
    }
 else     if (selectedElement instanceof ResourceBundlePropertyStructureViewElement || selectedElement instanceof ResourceBundleFileStructureViewElement) {
      prefix=null;
      separator=null;
    }
 else {
      throw new IllegalStateException("unsupported type: " + selectedElement.getClass());
    }
  }
  final ResourceBundle resourceBundle=resourceBundleEditor.getResourceBundle();
  Messages.showInputDialog(project,PropertiesBundle.message("new.property.dialog.name.prompt.text"),PropertiesBundle.message("new.property.dialog.title"),Messages.getQuestionIcon(),null,new NewPropertyNameValidator(resourceBundle,prefix,separator));
}
