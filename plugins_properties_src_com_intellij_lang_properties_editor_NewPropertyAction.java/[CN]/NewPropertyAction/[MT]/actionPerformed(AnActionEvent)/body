{
  final Project project=getEventProject(e);
  if (project == null) {
    return;
  }
  final FileEditor editor=PlatformDataKeys.FILE_EDITOR.getData(e.getDataContext());
  if (editor == null || !(editor instanceof ResourceBundleEditor)) {
    return;
  }
  final ResourceBundleEditor resourceBundleEditor=(ResourceBundleEditor)editor;
  final String prefix;
  final String separator;
  final String place=e.getPlace();
  if (ActionPlaces.STRUCTURE_VIEW_TOOLBAR.equals(place)) {
    prefix=null;
    separator=null;
  }
 else {
    final ResourceBundleEditorViewElement selectedElement=resourceBundleEditor.getSelectedElement();
    if (selectedElement == null) {
      return;
    }
    if (selectedElement instanceof PropertiesPrefixGroup) {
      final PropertiesPrefixGroup group=(PropertiesPrefixGroup)selectedElement;
      prefix=group.getPrefix();
      separator=group.getSeparator();
    }
 else     if (selectedElement instanceof ResourceBundlePropertyStructureViewElement || selectedElement instanceof ResourceBundleFileStructureViewElement) {
      prefix=null;
      separator=null;
    }
 else {
      throw new IllegalStateException("unsupported type: " + selectedElement.getClass());
    }
  }
  final ResourceBundle resourceBundle=resourceBundleEditor.getResourceBundle();
  Messages.showInputDialog(project,PropertiesBundle.message("new.property.dialog.name.prompt.text"),PropertiesBundle.message("new.property.dialog.title"),Messages.getQuestionIcon(),null,new NewPropertyNameValidator(resourceBundle,prefix,separator));
}
