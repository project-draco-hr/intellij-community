{
  LOG.assertTrue(myDocument != null);
  final EditorFactory factory=EditorFactory.getInstance();
  EditorEx editor;
  if (myIsViewer) {
    editor=myProject == null ? (EditorEx)factory.createViewer(myDocument) : (EditorEx)factory.createViewer(myDocument,myProject);
  }
 else {
    editor=myProject == null ? (EditorEx)factory.createEditor(myDocument) : (EditorEx)factory.createEditor(myDocument,myProject);
  }
  final EditorSettings settings=editor.getSettings();
  settings.setAdditionalLinesCount(0);
  settings.setAdditionalColumnsCount(1);
  settings.setRightMarginShown(false);
  settings.setRightMargin(-1);
  settings.setFoldingOutlineShown(false);
  settings.setLineNumbersShown(false);
  settings.setLineMarkerAreaShown(false);
  settings.setIndentGuidesShown(false);
  settings.setVirtualSpace(false);
  settings.setWheelFontChangeEnabled(false);
  settings.setAdditionalPageAtBottom(false);
  editor.setHorizontalScrollbarVisible(false);
  editor.setVerticalScrollbarVisible(false);
  editor.setCaretEnabled(!myIsViewer);
  settings.setLineCursorWidth(1);
  if (myProject != null && myIsViewer) {
    final PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(editor.getDocument());
    if (psiFile != null) {
      DaemonCodeAnalyzer.getInstance(myProject).setHighlightingEnabled(psiFile,false);
    }
  }
  if (myProject != null && myFileType != null) {
    editor.setHighlighter(EditorHighlighterFactory.getInstance().createEditorHighlighter(myProject,myFileType));
  }
  final EditorColorsScheme colorsScheme=editor.getColorsScheme();
  editor.getSettings().setCaretRowShown(false);
  if (!isEnabled()) {
    editor.setColorsScheme(new DelegateColorScheme(colorsScheme){
      @Nullable @Override public Color getColor(      ColorKey key){
        return super.getColor(key);
      }
      @Override public TextAttributes getAttributes(      TextAttributesKey key){
        final TextAttributes attributes=super.getAttributes(key);
        if (!isEnabled()) {
          return new TextAttributes(UIUtil.getInactiveTextColor(),attributes.getBackgroundColor(),attributes.getEffectColor(),attributes.getEffectType(),attributes.getFontType());
        }
        return attributes;
      }
    }
);
  }
  editor.setOneLineMode(myOneLineMode);
  editor.getCaretModel().moveToOffset(myDocument.getTextLength());
  if (!shouldHaveBorder()) {
    editor.setBorder(null);
  }
  if (myIsViewer) {
    editor.getSelectionModel().removeSelection();
  }
 else   if (myWholeTextSelected) {
    doSelectAll(editor);
    myWholeTextSelected=false;
  }
  editor.putUserData(SUPPLEMENTARY_KEY,myIsSupplementary);
  editor.getContentComponent().setFocusCycleRoot(false);
  editor.getContentComponent().addFocusListener(this);
  editor.setPlaceholder(myHintText);
  initOneLineMode(editor);
  if (myIsRendererWithSelection) {
    ((EditorImpl)editor).setPaintSelection(true);
    editor.getColorsScheme().setColor(EditorColors.SELECTION_BACKGROUND_COLOR,myRendererBg);
    editor.getColorsScheme().setColor(EditorColors.SELECTION_FOREGROUND_COLOR,myRendererFg);
    editor.getSelectionModel().setSelection(0,myDocument.getTextLength());
    editor.setBackgroundColor(myRendererBg);
  }
  for (  EditorSettingsProvider provider : mySettingsProviders) {
    provider.customizeSettings(editor);
  }
  return editor;
}
