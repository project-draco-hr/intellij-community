{
  final boolean isOneLineMode=isOneLineMode();
  editor.setOneLineMode(isOneLineMode);
  EditorColorsManager colorsManager=EditorColorsManager.getInstance();
  final EditorColorsScheme defaultScheme=UIUtil.isUnderDarcula() ? colorsManager.getGlobalScheme() : colorsManager.getScheme(EditorColorsManager.DEFAULT_SCHEME_NAME);
  EditorColorsScheme customGlobalScheme=isOneLineMode ? defaultScheme : null;
  editor.setColorsScheme(editor.createBoundColorSchemeDelegate(customGlobalScheme));
  EditorColorsScheme colorsScheme=editor.getColorsScheme();
  editor.getSettings().setCaretRowShown(false);
  editor.setColorsScheme(new DelegateColorScheme(colorsScheme){
    @Override public TextAttributes getAttributes(    TextAttributesKey key){
      final TextAttributes attributes=super.getAttributes(key);
      if (!isEnabled() && attributes != null) {
        return new TextAttributes(UIUtil.getInactiveTextColor(),attributes.getBackgroundColor(),attributes.getEffectColor(),attributes.getEffectType(),attributes.getFontType());
      }
      return attributes;
    }
  }
);
  setupEditorFont(editor);
  updateBorder(editor);
  editor.setBackgroundColor(getBackgroundColor(isEnabled(),colorsScheme));
}
