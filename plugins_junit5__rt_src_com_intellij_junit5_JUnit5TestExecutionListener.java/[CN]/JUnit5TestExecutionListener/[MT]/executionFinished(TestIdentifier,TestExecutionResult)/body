{
  final String displayName=testIdentifier.getDisplayName();
  final TestExecutionResult.Status status=testExecutionResult.getStatus();
  final Throwable throwableOptional=testExecutionResult.getThrowable().orElse(null);
  if (testIdentifier.isTest()) {
    final long duration=System.currentTimeMillis() - myCurrentTestStart;
    if (status == TestExecutionResult.Status.FAILED) {
      testFailure(throwableOptional,MapSerializerUtil.TEST_FAILED,testIdentifier,duration);
    }
 else     if (status == TestExecutionResult.Status.ABORTED) {
      testFailure(throwableOptional,MapSerializerUtil.TEST_IGNORED,testIdentifier,duration);
    }
    testFinished(testIdentifier,duration);
    myFinishCount++;
  }
 else {
    String messageName=null;
    if (status == TestExecutionResult.Status.FAILED) {
      messageName=MapSerializerUtil.TEST_FAILED;
    }
 else     if (status == TestExecutionResult.Status.ABORTED) {
      messageName=MapSerializerUtil.TEST_IGNORED;
    }
    if (messageName != null && myFinishCount == 0) {
      for (      TestIdentifier childIdentifier : myTestPlan.getChildren(testIdentifier)) {
        testStarted(childIdentifier);
        testFailure(throwableOptional,messageName,childIdentifier,0);
        testFinished(childIdentifier,0);
      }
    }
    myPrintStream.println("##teamcity[testSuiteFinished " + idAndName(testIdentifier,displayName) + "\']");
  }
}
