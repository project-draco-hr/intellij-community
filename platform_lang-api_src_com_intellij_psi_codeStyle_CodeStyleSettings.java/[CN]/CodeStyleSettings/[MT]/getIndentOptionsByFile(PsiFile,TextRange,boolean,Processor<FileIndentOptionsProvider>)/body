{
  if (file != null && file.isValid() && file.isWritable()) {
    boolean isFullReformat=isFileFullyCoveredByRange(file,formatRange);
    if (!ignoreDocOptions && !isFullReformat) {
      Pair<IndentOptions,FileIndentOptionsProvider> pair=IndentOptionsInDocumentKeeper.retrieveFromUnderlyingDocument(file);
      IndentOptions indentOptions=pair != null ? pair.first : null;
      if (indentOptions != null) {
        FileIndentOptionsProvider indentProvider=pair.second;
        if (indentProvider != null && providerProcessor != null) {
          providerProcessor.process(indentProvider);
        }
        return indentOptions;
      }
    }
    FileIndentOptionsProvider[] providers=Extensions.getExtensions(FileIndentOptionsProvider.EP_NAME);
    for (    FileIndentOptionsProvider provider : providers) {
      if (!isFullReformat || provider.useOnFullReformat()) {
        IndentOptions indentOptions=provider.getIndentOptions(this,file);
        if (indentOptions != null) {
          if (providerProcessor != null) {
            providerProcessor.process(provider);
          }
          logIndentOptions(file,provider,indentOptions);
          return indentOptions;
        }
      }
    }
    return getIndentOptions(file.getFileType());
  }
 else   return OTHER_INDENT_OPTIONS;
}
