{
  final Pair<PsiElement,TextRange> data=anchor.getUserData(PyPsiUtils.SELECTION_BREAKS_AST_NODE);
  if (data != null) {
    anchor=data.first;
  }
  final PsiElement compoundStatement=PyPsiUtils.getCompoundStatement(anchor);
  final PsiElement parent=compoundStatement.getParent();
  if (parent instanceof PyFunction) {
    parent.getParent().addBefore(generatedMethod,parent);
  }
  final PsiElement statement=PyPsiUtils.getStatement(compoundStatement,anchor);
  compoundStatement.addBefore(generatedMethod,statement);
}
