{
  final Pair<PsiElement,TextRange> data=anchor.getUserData(PyPsiUtils.SELECTION_BREAKS_AST_NODE);
  if (data != null) {
    anchor=data.first;
  }
  final PsiNamedElement parent=PsiTreeUtil.getParentOfType(anchor,PyFile.class,PyFunction.class);
  if (parent instanceof PyFile) {
    final PsiElement statement=PyPsiUtils.getStatement(parent,anchor);
    parent.addBefore(generatedMethod,statement);
    return;
  }
  if (parent instanceof PyFunction) {
    parent.getParent().addBefore(generatedMethod,parent);
    return;
  }
  throw new IllegalStateException("Compound statement should not be null");
}
