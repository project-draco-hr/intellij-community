{
  final Pair<PsiElement,TextRange> data=anchor.getUserData(PyPsiUtils.SELECTION_BREAKS_AST_NODE);
  if (data != null) {
    anchor=data.first;
  }
  final PsiElement compoundStatement=PyPsiUtils.getCompoundStatement(anchor);
  if (compoundStatement.getParent() instanceof PyFunction) {
    compoundStatement.getParent().addBefore(generatedMethod,compoundStatement);
    return generatedMethod;
  }
  final PsiElement statement=PyPsiUtils.getStatement(compoundStatement,anchor);
  compoundStatement.addBefore(generatedMethod,statement);
  return generatedMethod;
}
