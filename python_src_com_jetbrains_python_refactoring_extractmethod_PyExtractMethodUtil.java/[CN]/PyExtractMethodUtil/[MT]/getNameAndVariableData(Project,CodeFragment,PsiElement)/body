{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    String name=System.getProperty(NAME);
    if (name == null) {
      name="foo";
    }
    final List<AbstractVariableData> data=new ArrayList<AbstractVariableData>();
    for (    String in : fragment.getInputVariables()) {
      final AbstractVariableData d=new AbstractVariableData();
      d.name=in + "_new";
      d.originalName=in;
      d.passAsParameter=true;
      data.add(d);
    }
    return Pair.create(name,data.toArray(new AbstractVariableData[data.size()]));
  }
  final ExtractMethodValidator validator=new ExtractMethodValidator(){
    public String check(    final String name){
      return null;
    }
    public boolean isValidName(    final String name){
      return LanguageNamesValidation.INSTANCE.forLanguage(PythonLanguage.getInstance()).isIdentifier(name,project);
    }
  }
;
  final ExtractMethodDecorator decorator=new ExtractMethodDecorator(){
    public String createMethodPreview(    final String methodName,    final AbstractVariableData[] variableDatas){
      final StringBuilder builder=new StringBuilder();
      builder.append("def ").append(methodName);
      builder.append("(");
      boolean first=true;
      for (      AbstractVariableData variableData : variableDatas) {
        if (variableData.passAsParameter) {
          if (first) {
            first=false;
          }
 else {
            builder.append(", ");
          }
          builder.append(variableData.name);
        }
      }
      builder.append(")");
      return builder.toString();
    }
  }
;
  final AbstractExtractMethodDialog dialog=new AbstractExtractMethodDialog(project,"method_name",fragment,validator,decorator);
  dialog.show();
  if (!dialog.isOK()) {
    return Pair.create(null,null);
  }
  return Pair.create(dialog.getMethodName(),dialog.getVariableData());
}
