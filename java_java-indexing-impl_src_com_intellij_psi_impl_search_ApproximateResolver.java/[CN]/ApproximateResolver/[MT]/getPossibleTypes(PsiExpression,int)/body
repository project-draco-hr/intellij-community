{
  if (maxDepth == 0)   return null;
  expression=PsiUtil.skipParenthesizedExprDown(expression);
  if (expression instanceof PsiTypeCastExpression)   return extractClass(expression.getType());
  boolean method=false;
  if (expression instanceof PsiMethodCallExpression) {
    method=true;
    expression=((PsiMethodCallExpression)expression).getMethodExpression();
  }
  if (!(expression instanceof PsiReferenceExpression))   return null;
  String name=((PsiReferenceExpression)expression).getReferenceName();
  if (name == null)   return null;
  PsiExpression qualifier=((PsiReferenceExpression)expression).getQualifierExpression();
  if (qualifier != null) {
    Set<PsiClass> qualifierType=getPossibleTypes(qualifier,maxDepth - 1);
    if (qualifierType == null)     return null;
    return method ? getPossibleCallTypes(qualifierType,name) : getPossibleMemberTypes(qualifierType,name);
  }
  if (method)   return null;
  PsiElement target=((PsiReferenceExpression)expression).resolve();
  return target instanceof PsiClass ? Collections.singleton((PsiClass)target) : extractClass(expression.getType());
}
