{
  Insets insets=parent.getInsets();
  int top=insets.top;
  int height=parent.getHeight() - insets.bottom - top;
  int left=insets.left;
  int width=parent.getWidth() - insets.right - left;
  Dimension centeredSize=myCenteredComponent == null ? new Dimension() : myCenteredComponent.getPreferredSize();
  if (myTitleComponent != null) {
    int titleHeight=myTitleComponent.getPreferredSize().height;
    myTitleComponent.setBounds(left,top,width,titleHeight);
    top+=titleHeight + myVerticalGap;
    height-=titleHeight + myVerticalGap;
  }
  if (myCenteredComponent != null) {
    myCenteredComponent.setBounds(left,top,width,centeredSize.height);
  }
  int bottomY=top + centeredSize.height;
  int bottomHeight=height - centeredSize.height;
  if (centeredSize.height > 0) {
    bottomY+=myVerticalGap;
    bottomHeight-=myVerticalGap;
  }
  if (myExpandAction != null) {
    Dimension size=myExpandAction.getPreferredSize();
    if (myLayoutData.showMinSize) {
      Point location=getCollapsedTextEndLocation(myText,myLayoutData);
      if (location != null) {
        int y=SwingUtilities.convertPoint(myText,location.x,location.y,parent).y;
        myExpandAction.setBounds(width - size.width,y,size.width,size.height);
      }
    }
 else {
      myExpandAction.setBounds(width - size.width,bottomY,size.width,size.height);
    }
  }
  if (myActionPanel != null) {
    int expandWidth=myExpandAction == null || myLayoutData.showMinSize ? 0 : myExpandAction.getPreferredSize().width + ACTION_GAP;
    width-=expandWidth;
    int components=myActionPanel.getComponentCount();
    if (components > 2) {
      myActionPanel.getComponent(0).setVisible(false);
      for (int i=1; i < components; i++) {
        Component component=myActionPanel.getComponent(i);
        if (component.isVisible()) {
          break;
        }
        component.setVisible(true);
      }
      myActionPanel.doLayout();
      if (myActionPanel.getPreferredSize().width > width) {
        myActionPanel.getComponent(0).setVisible(true);
        myActionPanel.getComponent(1).setVisible(false);
        myActionPanel.getComponent(2).setVisible(false);
        myActionPanel.doLayout();
        for (int i=3; i < components - 1; i++) {
          if (myActionPanel.getPreferredSize().width > width) {
            myActionPanel.getComponent(i).setVisible(false);
            myActionPanel.doLayout();
          }
 else {
            break;
          }
        }
      }
    }
    myActionPanel.setBounds(left,bottomY,width,bottomHeight);
  }
}
