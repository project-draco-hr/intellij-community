{
  final PsiCall topLevelCall=treeWalkUp(parent);
  if (topLevelCall != null) {
    final JavaResolveResult result=topLevelCall.resolveMethodGenerics();
    if (result instanceof MethodCandidateInfo) {
      final PsiMethod method=((MethodCandidateInfo)result).getElement();
      final PsiParameter[] topLevelParameters=method.getParameterList().getParameters();
      final PsiExpressionList topLevelCallArgumentList=topLevelCall.getArgumentList();
      LOG.assertTrue(topLevelCallArgumentList != null,topLevelCall);
      final PsiExpression[] topLevelArguments=topLevelCallArgumentList.getExpressions();
      final InferenceSession topLevelSession=new InferenceSession(method.getTypeParameters(),((MethodCandidateInfo)result).getSiteSubstitutor(),topLevelCall.getManager(),topLevelCall);
      topLevelSession.initExpressionConstraints(topLevelParameters,topLevelArguments,topLevelCall,method,((MethodCandidateInfo)result).isVarargs());
      topLevelSession.infer(topLevelParameters,topLevelArguments,topLevelCall,((MethodCandidateInfo)result).createProperties());
      return topLevelSession;
    }
  }
  return null;
}
