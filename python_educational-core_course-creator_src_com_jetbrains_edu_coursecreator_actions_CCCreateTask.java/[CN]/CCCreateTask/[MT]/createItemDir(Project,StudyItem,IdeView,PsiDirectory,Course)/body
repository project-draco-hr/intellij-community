{
  final Ref<PsiDirectory> taskDirectory=new Ref<>();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      String taskDirName=EduNames.TASK + item.getIndex();
      taskDirectory.set(DirectoryUtil.createSubdirectories(taskDirName,parentDirectory,"\\/"));
      if (taskDirectory.get() != null) {
        CCLanguageManager manager=CCUtils.getStudyLanguageManager(course);
        if (manager == null) {
          return;
        }
        createFromTemplate(taskDirectory.get(),manager.getTestsTemplate(project),view,false);
        createFromTemplate(taskDirectory.get(),FileTemplateManager.getInstance(project).getInternalTemplate(EduNames.TASK_HTML),view,false);
        String defaultExtension=manager.getDefaultTaskFileExtension();
        if (defaultExtension != null) {
          FileTemplate taskFileTemplate=manager.getTaskFileTemplateForExtension(project,defaultExtension);
          createFromTemplate(taskDirectory.get(),taskFileTemplate,view,true);
          if (taskFileTemplate != null) {
            String taskFileName=FileUtil.getNameWithoutExtension(taskFileTemplate.getName());
            ((Task)item).addTaskFile(taskFileName + "." + defaultExtension,1);
          }
        }
      }
    }
  }
);
  return taskDirectory.get();
}
