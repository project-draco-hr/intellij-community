{
  if (current != null) {
    final String str=current instanceof PsiClass ? ((PsiClass)current).getName() : current.getText();
    if (MatchUtils.compareWithNoDifferenceToPackage(str,"Object")) {
      if (objectTaken)       return;
      objectTaken=true;
    }
    PsiElement element=MatchUtils.getReferencedElement(current);
    if (element instanceof PsiClass) {
      if (visited.contains(element))       return;
      final PsiClass clazz=(PsiClass)element;
      if (acceptInterfaces || !clazz.isInterface())       visited.add(element);
      if (!firstElementTaken && acceptFirstElement || firstElementTaken)       remaining.add(clazz);
      firstElementTaken=true;
      if (clazz instanceof PsiAnonymousClass) {
        build(((PsiAnonymousClass)clazz).getBaseClassReference(),visited);
        return;
      }
      if (acceptClasses) {
        processClasses(clazz,visited);
        if (!objectTaken) {
          build(PsiClassImplUtil.getSuperClass(clazz),visited);
        }
      }
      if (acceptInterfaces) {
        final PsiReferenceList implementsList=clazz.getImplementsList();
        if (implementsList != null) {
          final PsiElement[] implementsListElements=implementsList.getReferenceElements();
          for (          PsiElement anImplementsList : implementsListElements) {
            build(anImplementsList,visited);
          }
        }
        if (!acceptClasses)         processClasses(clazz,visited);
      }
    }
 else {
      remaining.add(current);
    }
  }
}
