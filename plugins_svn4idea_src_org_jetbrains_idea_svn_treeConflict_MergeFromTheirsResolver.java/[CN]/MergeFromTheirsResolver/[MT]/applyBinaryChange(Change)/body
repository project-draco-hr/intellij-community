{
  if (change.getAfterRevision() == null) {
    FilePath path=notNull(change.getBeforeRevision()).getFile();
    VirtualFile file=LocalFileSystem.getInstance().refreshAndFindFileByPath(path.getPath());
    if (file == null) {
      throw new VcsException("Can not delete file: " + path.getPath(),true);
    }
    file.delete(TreeConflictRefreshablePanel.class);
  }
 else {
    FilePath file=change.getAfterRevision().getFile();
    String parentPath=notNull(file.getParentPath()).getPath();
    VirtualFile parentFile=VfsUtil.createDirectoryIfMissing(parentPath);
    if (parentFile == null) {
      throw new VcsException("Can not create directory: " + parentPath,true);
    }
    VirtualFile child=parentFile.createChildData(TreeConflictRefreshablePanel.class,file.getName());
    byte[] content=((BinaryContentRevision)change.getAfterRevision()).getBinaryContent();
    if (content == null) {
      throw new VcsException("Can not load Theirs content for file " + file.getPath(),true);
    }
    child.setBinaryContent(content);
  }
}
