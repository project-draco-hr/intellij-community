{
  final ProgressIndicator indicator=ProgressIndicatorProvider.getGlobalProgressIndicator();
  PsiShortNamesCache.getInstance(project).processAllClassNames(new Processor<String>(){
    int i=0;
    @Override public boolean process(    String s){
      if (indicator != null && i++ % 512 == 0) {
        indicator.checkCanceled();
      }
      consumer.consume(s);
      return true;
    }
  }
,scope,IdFilter.getProjectIdFilter(project,true));
  if (indicator != null) {
    indicator.checkCanceled();
  }
  return project;
}
