{
  final ProgressIndicator indicator=ProgressIndicatorProvider.getGlobalProgressIndicator();
  DumbService.getInstance(project).runReadActionInSmartMode(new Computable<Void>(){
    @Override public Void compute(){
      PsiShortNamesCache.getInstance(project).processAllClassNames(new Processor<String>(){
        int i;
        @Override public boolean process(        String s){
          if (indicator != null && i++ % 512 == 0) {
            indicator.checkCanceled();
          }
          consumer.consume(s);
          return true;
        }
      }
,scope,IdFilter.getProjectIdFilter(project,true));
      return null;
    }
  }
);
  if (indicator != null) {
    indicator.checkCanceled();
  }
  return project;
}
