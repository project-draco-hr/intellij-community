{
  if (beforeRestart.length == 0)   return;
  File restartDir=new File(getRestarterDir());
  String systemPath=new File(System.getProperty("user.home") + "/." + System.getProperty("idea.paths.selector")+ "/system/restart").getPath();
  if (!systemPath.equals(restartDir.getPath())) {
    throw new IOException("idea.system.path was changed. Restart is not supported.");
  }
  if (!FileUtilRt.createDirectory(restartDir)) {
    throw new IOException("Cannot create dir: " + restartDir);
  }
  File restarter=new File(restartDir,"restarter.sh");
  try (BufferedWriter output=new BufferedWriter(new FileWriter(restarter))){
    output.write("#!/bin/sh\n");
    for (int i=0; i < beforeRestart.length; i++) {
      output.write(beforeRestart[i]);
      if (i <= beforeRestart.length - 2)       output.write(' ');
      if (i >= beforeRestart.length - 2)       output.write('"');
    }
    output.write('\n');
  }
   if (!restarter.setExecutable(true,true)) {
    throw new IOException("Cannot make file executable: " + restarter);
  }
}
