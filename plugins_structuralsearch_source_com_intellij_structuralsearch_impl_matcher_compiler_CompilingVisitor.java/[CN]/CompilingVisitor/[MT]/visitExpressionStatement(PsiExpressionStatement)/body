{
  handle(expr);
  super.visitExpressionStatement(expr);
  if (!(expr.getLastChild() instanceof PsiJavaToken)) {
    final PsiElement reference=expr.getFirstChild();
    Handler referenceHandler=context.pattern.getHandler(reference);
    if (referenceHandler instanceof SubstitutionHandler && (reference instanceof PsiReferenceExpression)) {
      context.pattern.setHandler(expr,referenceHandler);
      referenceHandler.setFilter(SymbolNodeFilter.getInstance());
      setHandler(expr,new SymbolHandler((SubstitutionHandler)referenceHandler));
    }
 else     if (reference instanceof PsiLiteralExpression) {
      Handler handler=new ExpressionHandler();
      setHandler(expr,handler);
      handler.setFilter(ConstantFilter.getInstance());
    }
 else {
      Handler handler;
      setHandler(expr,handler=new ExpressionHandler());
      handler.setFilter(ExpressionFilter.getInstance());
    }
  }
 else   if (expr.getExpression() instanceof PsiReferenceExpression && (context.pattern.isRealTypedVar(expr.getExpression()))) {
    final Handler exprHandler=context.pattern.getHandler(expr);
    if (exprHandler instanceof SubstitutionHandler) {
      SubstitutionHandler handler=(SubstitutionHandler)exprHandler;
      handler.setFilter(new StatementFilter());
      handler.setMatchHandler(new StatementHandler());
    }
  }
}
