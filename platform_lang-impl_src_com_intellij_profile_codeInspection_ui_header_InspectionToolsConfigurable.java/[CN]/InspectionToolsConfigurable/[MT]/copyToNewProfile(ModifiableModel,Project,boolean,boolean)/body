{
  LOG.assertTrue(modifyLevel || modifyName);
  String profileDefaultName=selectedProfile.getName();
  if (modifyName) {
    do {
      profileDefaultName+=" (copy)";
    }
 while (hasName(profileDefaultName,modifyLevel != myPanels.get(selectedProfile).isProjectLevel()));
  }
  ProfileManager profileManager=selectedProfile.getProfileManager();
  if (modifyLevel) {
    if (profileManager == myApplicationProfileManager) {
      profileManager=myProjectProfileManager;
    }
 else {
      profileManager=myApplicationProfileManager;
    }
  }
  InspectionProfileImpl inspectionProfile=new InspectionProfileImpl(profileDefaultName,InspectionToolRegistrar.getInstance(),profileManager);
  inspectionProfile.copyFrom(selectedProfile);
  inspectionProfile.setName(profileDefaultName);
  inspectionProfile.initInspectionTools(project);
  inspectionProfile.setModified(true);
  final InspectionProfileImpl modifiableModel=(InspectionProfileImpl)inspectionProfile.getModifiableModel();
  modifiableModel.setModified(true);
  addProfile(modifiableModel,inspectionProfile);
  return modifiableModel;
}
