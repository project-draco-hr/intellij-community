{
  LOG.assertTrue(modifyLevel || modifyName);
  String profileDefaultName=selectedProfile.getName();
  if (modifyName) {
    final Matcher matcher=COPIED_PROFILE_SUFFIX_PATTERN.matcher(profileDefaultName);
    int nextIdx;
    if (matcher.matches()) {
      profileDefaultName=matcher.group(1);
      nextIdx=matcher.group(2).isEmpty() ? 1 : Integer.valueOf(matcher.group(2));
    }
 else {
      profileDefaultName+=" copy";
      nextIdx=1;
    }
    if (hasName(profileDefaultName,modifyLevel != myPanels.get(selectedProfile).isProjectLevel())) {
      String currentProfileDefaultName;
      do {
        currentProfileDefaultName=profileDefaultName + " " + String.valueOf(nextIdx);
        nextIdx++;
      }
 while (hasName(currentProfileDefaultName,modifyLevel != myPanels.get(selectedProfile).isProjectLevel()));
      profileDefaultName=currentProfileDefaultName;
    }
  }
  ProfileManager profileManager=selectedProfile.getProfileManager();
  if (modifyLevel) {
    if (profileManager == myApplicationProfileManager) {
      profileManager=myProjectProfileManager;
    }
 else {
      profileManager=myApplicationProfileManager;
    }
  }
  InspectionProfileImpl inspectionProfile=new InspectionProfileImpl(profileDefaultName,InspectionToolRegistrar.getInstance(),profileManager);
  inspectionProfile.copyFrom(selectedProfile);
  inspectionProfile.setName(profileDefaultName);
  inspectionProfile.initInspectionTools(project);
  inspectionProfile.setModified(true);
  final InspectionProfileImpl modifiableModel=inspectionProfile.getModifiableModel();
  modifiableModel.setModified(true);
  addProfile(modifiableModel,inspectionProfile);
  return modifiableModel;
}
