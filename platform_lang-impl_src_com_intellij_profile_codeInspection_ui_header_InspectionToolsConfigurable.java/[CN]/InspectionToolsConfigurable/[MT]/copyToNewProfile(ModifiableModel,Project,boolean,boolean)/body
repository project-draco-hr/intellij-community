{
  LOG.assertTrue(modifyLevel || modifyName);
  String profileDefaultName=selectedProfile.getName();
  if (modifyName) {
    if (!profileDefaultName.endsWith(COPY_SUFFIX)) {
      profileDefaultName+=" " + COPY_SUFFIX;
    }
    if (hasName(profileDefaultName,modifyLevel != myPanels.get(selectedProfile).isProjectLevel())) {
      int idx=0;
      String currentProfileDefaultName;
      do {
        idx++;
        currentProfileDefaultName=profileDefaultName + " " + String.valueOf(idx);
      }
 while (hasName(currentProfileDefaultName,modifyLevel != myPanels.get(selectedProfile).isProjectLevel()));
      profileDefaultName=currentProfileDefaultName;
    }
  }
  ProfileManager profileManager=selectedProfile.getProfileManager();
  if (modifyLevel) {
    if (profileManager == myApplicationProfileManager) {
      profileManager=myProjectProfileManager;
    }
 else {
      profileManager=myApplicationProfileManager;
    }
  }
  InspectionProfileImpl inspectionProfile=new InspectionProfileImpl(profileDefaultName,InspectionToolRegistrar.getInstance(),profileManager);
  inspectionProfile.copyFrom(selectedProfile);
  inspectionProfile.setName(profileDefaultName);
  inspectionProfile.initInspectionTools(project);
  inspectionProfile.setModified(true);
  final InspectionProfileImpl modifiableModel=(InspectionProfileImpl)inspectionProfile.getModifiableModel();
  modifiableModel.setModified(true);
  addProfile(modifiableModel,inspectionProfile);
  return modifiableModel;
}
