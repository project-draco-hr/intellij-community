{
  final PlatformFacade platformFacade=ServiceManager.getService(PlatformFacade.class);
  final List<Library> orphanIdeLibraries=ContainerUtilRt.newArrayList();
  platformFacade.updateLibraryTable(myProject,new Consumer<LibraryTable.ModifiableModel>(){
    @Override public void consume(    LibraryTable.ModifiableModel modifiableModel){
      for (      Library library : modifiableModel.getLibraries()) {
        if (!ExternalSystemApiUtil.isExternalSystemLibrary(library,myExternalSystemId))         continue;
        if (ProjectStructureHelper.isOrphanProjectLibrary(library,platformFacade.getModules(myProject))) {
          orphanIdeLibraries.add(library);
        }
      }
      for (      Library orphanIdeLibrary : orphanIdeLibraries) {
        modifiableModel.removeLibrary(orphanIdeLibrary);
      }
    }
  }
);
}
