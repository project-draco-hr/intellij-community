{
  final Map<String,String> attributes=node.getTemplateToken().getAttributes();
  String classValue=attributes.get(HtmlUtil.CLASS_ATTRIBUTE_NAME);
  if (classValue != null) {
    Iterable<String> classNames=extractClasses(classValue);
    BEM_STATE.set(node,new BemState(suggestBlockName(classNames),null,null));
    final Set<String> newClassNames=ImmutableSet.copyOf(concat(transform(classNames,new Function<String,Iterable<String>>(){
      @Override public Iterable<String> apply(      String className){
        return processClassName(className,node);
      }
    }
)));
    attributes.put(HtmlUtil.CLASS_ATTRIBUTE_NAME,CLASS_NAME_JOINER.join(newClassNames));
  }
  return node;
}
