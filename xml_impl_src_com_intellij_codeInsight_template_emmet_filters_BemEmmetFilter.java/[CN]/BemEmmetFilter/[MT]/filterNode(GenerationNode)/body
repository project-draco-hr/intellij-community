{
  final List<Couple<String>> attribute2Value=node.getTemplateToken().getAttribute2Value();
  Couple<String> classNamePair=getClassPair(attribute2Value);
  if (classNamePair != null) {
    Iterable<String> classNames=extractClasses(classNamePair.second);
    BEM_STATE.set(node,new BemState(suggestBlockName(classNames),null,null));
    final Set<String> newClassNames=ImmutableSet.copyOf(concat(transform(classNames,new Function<String,Iterable<String>>(){
      @Override public Iterable<String> apply(      String className){
        return processClassName(className,node);
      }
    }
)));
    attribute2Value.add(Couple.of(HtmlUtil.CLASS_ATTRIBUTE_NAME,CLASS_NAME_JOINER.join(newClassNames)));
  }
  return node;
}
