{
  PsiFile file=parameters.getOriginalFile();
  TextCompletionProvider provider=TextCompletionUtil.getProvider(file);
  if (provider == null)   return;
  String advertisement=provider.getAdvertisement();
  if (advertisement != null) {
    result.addLookupAdvertisement(advertisement);
  }
  String text=file.getText();
  int offset=Math.min(text.length(),parameters.getOffset());
  String prefix=provider.getPrefix(text,offset);
  if (prefix == null)   return;
  CompletionResultSet activeResult=provider.applyPrefixMatcher(result,prefix);
  provider.fillCompletionVariants(parameters,prefix,activeResult);
}
