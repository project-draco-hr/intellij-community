{
  final IpnbFileEditor fileEditor=codePanel.getFileEditor();
  final VirtualFile virtualFile=fileEditor.getVirtualFile();
  final String path=virtualFile.getPath();
  if (!myKernels.containsKey(path)) {
    startConnection(codePanel,fileEditor,path);
  }
 else {
    IpnbConnection connection=myKernels.get(path);
    if (!connection.isAlive()) {
      myKernels.remove(path);
      startConnection(codePanel,fileEditor,path);
    }
 else {
      final String messageId=connection.execute(codePanel.getCell().getSourceAsString());
      myUpdateMap.put(messageId,codePanel);
    }
  }
}
