{
  String url=IpnbSettings.getInstance(myProject).getURL();
  if (StringUtil.isEmptyOrSpaces(url)) {
    url=IpnbSettings.DEFAULT_URL;
  }
  boolean connectionStarted=startConnection(codePanel,path,url,false);
  if (!connectionStarted) {
    final String finalUrl=url;
    url=showDialogUrl(url);
    if (url == null)     return;
    IpnbSettings.getInstance(myProject).setURL(url);
    ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
      @Override public void run(){
        final boolean serverStarted=startIpythonServer(finalUrl,fileEditor);
        if (!serverStarted) {
          return;
        }
        UIUtil.invokeLaterIfNeeded(new Runnable(){
          @Override public void run(){
            startConnection(codePanel,path,finalUrl,true);
          }
        }
);
      }
    }
);
  }
}
