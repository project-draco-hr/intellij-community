{
  if (mySelectedKeymap.canModify())   return true;
  final Keymap selectedKeymap=myEditor.getModel().getSelected();
  if (selectedKeymap == null) {
    return false;
  }
  KeymapImpl newKeymap=((KeymapImpl)selectedKeymap).deriveKeymap();
  String newKeymapName=KeyMapBundle.message("new.keymap.name",selectedKeymap.getPresentableName());
  if (!tryNewKeymapName(newKeymapName)) {
    for (int i=0; ; i++) {
      newKeymapName=KeyMapBundle.message("new.indexed.keymap.name",selectedKeymap.getPresentableName(),i);
      if (tryNewKeymapName(newKeymapName)) {
        break;
      }
    }
  }
  newKeymap.setName(newKeymapName);
  newKeymap.setCanModify(true);
  final int indexOf=myEditor.getModel().getElementIndex(selectedKeymap);
  if (indexOf >= 0) {
    myEditor.getModel().add(indexOf + 1,newKeymap);
  }
 else {
    myEditor.getModel().add(newKeymap);
  }
  myEditor.getModel().setSelectedItem(newKeymap);
  processCurrentKeymapChanged(myQuickLists);
  return true;
}
