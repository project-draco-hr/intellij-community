{
  if (myNonEnglishKeyboardSupportOption != null) {
    myNonEnglishKeyboardSupportOption.setSelected(KeyboardSettingsExternalizable.getInstance().isNonEnglishKeyboardSupportEnabled());
  }
  Keymap activeKeymap=KeymapManagerEx.getInstanceEx().getActiveKeymap();
  Keymap selectedKeymap=null;
  List<Keymap> list=getManagerKeymaps();
  for (  Keymap keymap : list) {
    if (activeKeymap == keymap) {
      selectedKeymap=keymap;
      break;
    }
    if (selectedKeymap == null || KeymapManager.MAC_OS_X_10_5_PLUS_KEYMAP.equals(keymap.getName())) {
      selectedKeymap=keymap;
    }
  }
  myEditor.reset(list);
  if (myEditor.getModel().isEmpty()) {
    KeymapImpl keymap=new KeymapImpl();
    keymap.setName(KeyMapBundle.message("keymap.no.name"));
    myEditor.getModel().add(keymap);
    selectedKeymap=keymap;
  }
  myEditor.getModel().setSelectedItem(selectedKeymap);
  currentKeymapChanged();
}
