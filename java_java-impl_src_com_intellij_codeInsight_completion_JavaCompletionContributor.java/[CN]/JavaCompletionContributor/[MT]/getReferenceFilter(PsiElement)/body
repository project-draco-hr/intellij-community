{
  final PsiClass containingClass=PsiTreeUtil.getParentOfType(position,PsiClass.class,false,PsiCodeBlock.class,PsiMethod.class,PsiExpressionList.class,PsiVariable.class,PsiAnnotation.class);
  if (containingClass != null && psiElement().afterLeaf(PsiKeyword.EXTENDS,PsiKeyword.IMPLEMENTS,",","&").accepts(position)) {
    return new AndFilter(ElementClassFilter.CLASS,new NotFilter(new AssignableFromContextFilter()));
  }
  if (ANNOTATION_NAME.accepts(position)) {
    return new AnnotationTypeFilter();
  }
  if (JavaKeywordCompletion.DECLARATION_START.getValue().accepts(position) || JavaKeywordCompletion.isInsideParameterList(position) || psiElement().inside(psiElement(PsiJavaCodeReferenceElement.class).withParent(psiAnnotation())).accepts(position)) {
    return new OrFilter(ElementClassFilter.CLASS,ElementClassFilter.PACKAGE_FILTER);
  }
  if (psiElement().afterLeaf(PsiKeyword.INSTANCEOF).accepts(position)) {
    return new ElementExtractorFilter(ElementClassFilter.CLASS);
  }
  if (JavaKeywordCompletion.VARIABLE_AFTER_FINAL.accepts(position)) {
    return ElementClassFilter.CLASS;
  }
  if (JavaKeywordCompletion.AFTER_TRY_BLOCK.isAcceptable(position,position) || JavaKeywordCompletion.START_SWITCH.accepts(position) || JavaKeywordCompletion.isInstanceofPlace(position)|| JavaKeywordCompletion.isAfterPrimitiveOrArrayType(position)) {
    return null;
  }
  if (JavaKeywordCompletion.START_FOR.accepts(position)) {
    return new OrFilter(ElementClassFilter.CLASS,ElementClassFilter.VARIABLE);
  }
  if (JavaSmartCompletionContributor.AFTER_NEW.accepts(position)) {
    return ElementClassFilter.CLASS;
  }
  if (psiElement().inside(PsiReferenceParameterList.class).accepts(position)) {
    return ElementClassFilter.CLASS;
  }
  if (psiElement().inside(PsiAnnotationParameterList.class).accepts(position)) {
    return createAnnotationFilter(position);
  }
  PsiVariable var=PsiTreeUtil.getParentOfType(position,PsiVariable.class,false,PsiClass.class);
  if (var != null && PsiTreeUtil.isAncestor(var.getInitializer(),position,false)) {
    return new ExcludeDeclaredFilter(new ClassFilter(PsiVariable.class));
  }
  if (SWITCH_LABEL.accepts(position)) {
    return new ClassFilter(PsiField.class){
      @Override public boolean isAcceptable(      Object element,      PsiElement context){
        return element instanceof PsiEnumConstant;
      }
    }
;
  }
  return TrueFilter.INSTANCE;
}
