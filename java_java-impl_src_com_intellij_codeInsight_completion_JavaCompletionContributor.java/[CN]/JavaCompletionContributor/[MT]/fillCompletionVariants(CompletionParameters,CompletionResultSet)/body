{
  if (parameters.getCompletionType() != CompletionType.BASIC) {
    return;
  }
  final PsiElement position=parameters.getPosition();
  if (!isInJavaContext(position)) {
    return;
  }
  if (AFTER_NUMBER_LITERAL.accepts(position) || UNEXPECTED_REFERENCE_AFTER_DOT.accepts(position)) {
    _result.stopHere();
    return;
  }
  final CompletionResultSet result=JavaCompletionSorting.addJavaSorting(parameters,_result);
  if (ANNOTATION_ATTRIBUTE_NAME.accepts(position) && !JavaKeywordCompletion.isAfterPrimitiveOrArrayType(position)) {
    JavaKeywordCompletion.addExpectedTypeMembers(parameters,result);
    completeAnnotationAttributeName(result,position,parameters);
    result.stopHere();
    return;
  }
  final InheritorsHolder inheritors=new InheritorsHolder(result);
  if (JavaSmartCompletionContributor.IN_TYPE_ARGS.accepts(position)) {
    new TypeArgumentCompletionProvider(false,inheritors).addCompletions(parameters,new ProcessingContext(),result);
  }
  if (JavaSmartCompletionContributor.LAMBDA.accepts(parameters.getPosition())) {
    result.addAllElements(FunctionalExpressionCompletionProvider.getLambdaVariants(parameters,true));
  }
  PrefixMatcher matcher=result.getPrefixMatcher();
  if (JavaSmartCompletionContributor.AFTER_NEW.accepts(position)) {
    new JavaInheritorsGetter(ConstructorInsertHandler.BASIC_INSTANCE).generateVariants(parameters,matcher,inheritors);
  }
  if (MethodReturnTypeProvider.IN_METHOD_RETURN_TYPE.accepts(position)) {
    MethodReturnTypeProvider.addProbableReturnTypes(parameters,new Consumer<LookupElement>(){
      @Override public void consume(      LookupElement element){
        registerClassFromTypeElement(element,inheritors);
        result.addElement(element);
      }
    }
);
  }
  if (SmartCastProvider.shouldSuggestCast(parameters)) {
    SmartCastProvider.addCastVariants(parameters,new Consumer<LookupElement>(){
      @Override public void consume(      LookupElement element){
        registerClassFromTypeElement(element,inheritors);
        result.addElement(PrioritizedLookupElement.withPriority(element,1));
      }
    }
);
  }
  PsiElement parent=position.getParent();
  if (parent instanceof PsiReferenceExpression) {
    final List<ExpectedTypeInfo> expected=Arrays.asList(ExpectedTypesProvider.getExpectedTypes((PsiExpression)parent,true));
    CollectConversion.addCollectConversion((PsiReferenceExpression)parent,expected,JavaSmartCompletionContributor.decorateWithoutTypeCheck(result,expected));
  }
  if (IMPORT_REFERENCE.accepts(position)) {
    result.addElement(LookupElementBuilder.create("*"));
  }
  addKeywords(parameters,result);
  addExpressionVariants(parameters,position,result);
  Set<String> usedWords=addReferenceVariants(parameters,result,inheritors);
  if (psiElement().inside(PsiLiteralExpression.class).accepts(position)) {
    PsiReference reference=position.getContainingFile().findReferenceAt(parameters.getOffset());
    if (reference == null || reference.isSoft()) {
      WordCompletionContributor.addWordCompletionVariants(result,parameters,usedWords);
    }
  }
  JavaGenerateMemberCompletionContributor.fillCompletionVariants(parameters,result);
  addAllClasses(parameters,result,inheritors);
  if (parent instanceof PsiReferenceExpression && !((PsiReferenceExpression)parent).isQualified() && parameters.isExtendedCompletion()&& StringUtil.isNotEmpty(matcher.getPrefix())) {
    new JavaStaticMemberProcessor(parameters).processStaticMethodsGlobally(matcher,result);
  }
  result.stopHere();
}
