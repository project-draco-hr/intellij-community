{
  final GrClosableBlock closure=(GrClosableBlock)element;
  final GrParameterList parameterList=closure.getParameterList();
  final GrParameter parameter=parameterList.getParameters()[0];
  final Set<GrReferenceExpression> referencesToChange=new HashSet<>();
  final GroovyRecursiveElementVisitor visitor=new GroovyRecursiveElementVisitor(){
    @Override public void visitReferenceExpression(    @NotNull GrReferenceExpression referenceExpression){
      super.visitReferenceExpression(referenceExpression);
      if (!referenceExpression.getText().equals(parameter.getName())) {
        return;
      }
      final PsiElement referent=referenceExpression.resolve();
      if (parameter.equals(referent)) {
        referencesToChange.add(referenceExpression);
      }
    }
  }
;
  closure.accept(visitor);
  parameter.delete();
  for (  GrReferenceExpression referenceExpression : referencesToChange) {
    PsiImplUtil.replaceExpression("it",referenceExpression);
  }
}
