{
  myUpdating.set(true);
  myTable.getEmptyText().setText(StatusText.DEFAULT_EMPTY_TEXT);
  final JBLoadingPanel loadingPanel=getLoadingPanel();
  loadingPanel.startLoading();
  final ModalityState modalityState=ModalityState.current();
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      EmptyProgressIndicator indicator=new EmptyProgressIndicator(){
        @NotNull @Override public ModalityState getModalityState(){
          return modalityState;
        }
      }
;
      ProgressManager.getInstance().executeProcessUnderProgress(new Runnable(){
        @Override public void run(){
          try {
            if (myDisposed)             return;
            myUpdater=new Updater(loadingPanel,100);
            myUpdater.start();
            text.set("Loading...");
            myTree=new DTree(null,"",true);
            mySrc.refresh(userForcedRefresh);
            myTrg.refresh(userForcedRefresh);
            scan(mySrc,myTree,true);
            scan(myTrg,myTree,false);
          }
 catch (          final IOException e) {
            LOG.warn(e);
            reportException(VcsBundle.message("refresh.failed.message",StringUtil.decapitalize(e.getLocalizedMessage())));
          }
 finally {
            if (myTree != null) {
              myTree.setSource(mySrc);
              myTree.setTarget(myTrg);
              myTree.update(mySettings);
              applySettings();
            }
          }
        }
      }
,indicator);
    }
  }
);
}
