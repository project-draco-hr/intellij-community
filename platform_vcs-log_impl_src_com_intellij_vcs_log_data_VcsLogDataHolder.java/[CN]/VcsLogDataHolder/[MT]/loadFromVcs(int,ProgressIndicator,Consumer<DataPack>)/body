{
  Map<VirtualFile,List<? extends TimedVcsCommit>> logsToBuild=ContainerUtil.newHashMap();
  Map<VirtualFile,Collection<VcsRef>> refsByRoot=ContainerUtil.newHashMap();
  for (  Map.Entry<VirtualFile,RecentCommitsInfo> entry : collectInfoFromVcs(true,commitCount)) {
    VirtualFile root=entry.getKey();
    RecentCommitsInfo info=entry.getValue();
    logsToBuild.put(root,info.firstBlockCommits);
    refsByRoot.put(root,info.newRefs);
  }
  List<TimedVcsCommit> compoundLog=myMultiRepoJoiner.join(logsToBuild.values());
  DataPack dataPack=DataPack.build(convertToGraphCommits(compoundLog),collectAllRefs(refsByRoot),indicator,myHashGetter,myIndexGetter);
  if (myLogData != null && myLogData.isFullLogReady()) {
    myLogData=new LogData(myLogData.getLogs(),myLogData.getRefs(),compoundLog,dataPack,true);
  }
 else {
    myLogData=new LogData(logsToBuild,refsByRoot,compoundLog,dataPack,false);
  }
  handleOnSuccessInEdt(onSuccess,dataPack);
}
