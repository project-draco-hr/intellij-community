{
  runInBackground(new ThrowableConsumer<ProgressIndicator,VcsException>(){
    @Override public void consume(    ProgressIndicator indicator) throws VcsException {
      Collection<List<TimedVcsCommit>> logs=ContainerUtil.newArrayList();
      final Map<Hash,VcsFullCommitDetails> allDetails=ContainerUtil.newHashMap();
      for (      Map.Entry<VirtualFile,VcsLogProvider> entry : myLogProviders.entrySet()) {
        List<? extends VcsFullCommitDetails> details=entry.getValue().getFilteredDetails(entry.getKey(),filters);
        logs.add(getCommitsFromDetails(details));
        for (        VcsFullCommitDetails detail : details) {
          allDetails.put(detail.getHash(),detail);
        }
      }
      final List<TimedVcsCommit> compoundLog=myMultiRepoJoiner.join(logs);
      final List<VcsFullCommitDetails> list=ContainerUtil.mapNotNull(compoundLog,new Function<TimedVcsCommit,VcsFullCommitDetails>(){
        @Override public VcsFullCommitDetails fun(        TimedVcsCommit commit){
          VcsFullCommitDetails detail=allDetails.get(commit.getHash());
          if (detail == null) {
            LOG.error("Details not stored for commit " + commit,new Attachment("filtered_details",allDetails.toString()),new Attachment("compound_log",compoundLog.toString()));
          }
          return detail;
        }
      }
);
      invokeAndWait(new Runnable(){
        @Override public void run(){
          success.consume(list);
        }
      }
);
    }
  }
,"Retrieving filtered results from the VCS...");
}
