{
  int offset=0;
  int endOffset=-1;
  for (  Pair<TextRange,String> fragment : myHost.getDecodedFragments()) {
    final TextRange encodedTextRange=fragment.getFirst();
    final TextRange intersection=encodedTextRange.intersection(rangeInsideHost);
    if (intersection != null && !intersection.isEmpty()) {
      final String value=fragment.getSecond();
      final int valueLength=value.length();
      if (valueLength == 0) {
        return -1;
      }
 else       if (valueLength == 1) {
        if (offset == offsetInDecoded) {
          return intersection.getStartOffset();
        }
      }
 else {
        if (offset + valueLength >= offsetInDecoded) {
          final int delta=offsetInDecoded - offset;
          return intersection.getStartOffset() + delta;
        }
      }
      offset+=valueLength;
      endOffset=intersection.getEndOffset();
    }
  }
  if (offset == offsetInDecoded) {
    return endOffset;
  }
  return -1;
}
