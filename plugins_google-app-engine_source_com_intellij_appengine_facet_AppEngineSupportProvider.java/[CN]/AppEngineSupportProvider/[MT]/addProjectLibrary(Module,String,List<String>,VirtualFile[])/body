{
  return new WriteAction<Library>(){
    protected void run(    final Result<Library> result){
      final LibraryTable libraryTable=LibraryTablesRegistrar.getInstance().getLibraryTable(module.getProject());
      Library library=libraryTable.getLibraryByName(name);
      if (library == null) {
        library=libraryTable.createLibrary(name);
        final Library.ModifiableModel model=library.getModifiableModel();
        for (        String path : jarDirectories) {
          String url=VfsUtilCore.pathToUrl(path);
          VirtualFileManager.getInstance().refreshAndFindFileByUrl(url);
          model.addJarDirectory(url,false);
        }
        for (        VirtualFile sourceRoot : sources) {
          model.addRoot(sourceRoot,OrderRootType.SOURCES);
        }
        model.commit();
      }
      result.setResult(library);
    }
  }
.execute().getResultObject();
}
