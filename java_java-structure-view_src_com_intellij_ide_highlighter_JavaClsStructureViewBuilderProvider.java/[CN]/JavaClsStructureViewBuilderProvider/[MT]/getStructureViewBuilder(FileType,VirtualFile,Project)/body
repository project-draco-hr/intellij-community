{
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (fileType == JavaClassFileType.INSTANCE && psiFile != null) {
    Language language=psiFile.getLanguage();
    if (language != JavaLanguage.INSTANCE) {
      PsiStructureViewFactory factory=LanguageStructureViewBuilder.INSTANCE.forLanguage(language);
      if (factory != null) {
        return factory.getStructureViewBuilder(psiFile);
      }
    }
  }
  for (  ContentBasedFileSubstitutor processor : Extensions.getExtensions(ContentBasedFileSubstitutor.EP_NAME)) {
    if (processor.isApplicable(project,file)) {
      final Language language=processor.obtainLanguageForFile(file);
      if (language != null) {
        final PsiStructureViewFactory factory=LanguageStructureViewBuilder.INSTANCE.forLanguage(language);
        if (factory != null)         return factory.getStructureViewBuilder(psiFile);
      }
    }
  }
  if (psiFile instanceof PsiClassOwner) {
    return new TreeBasedStructureViewBuilder(){
      @Override @NotNull public StructureViewModel createStructureViewModel(      @Nullable Editor editor){
        return new JavaFileTreeModel((PsiClassOwner)psiFile,editor);
      }
    }
;
  }
  return null;
}
