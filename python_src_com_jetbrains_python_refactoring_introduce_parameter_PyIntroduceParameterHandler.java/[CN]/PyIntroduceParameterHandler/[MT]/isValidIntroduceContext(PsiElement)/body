{
  if (element != null) {
    final PyFunction function=PsiTreeUtil.getParentOfType(element,PyFunction.class);
    final ScopeOwner scopeOwner=ScopeUtil.getScopeOwner(element);
    final boolean[] isValid={true};
    if (scopeOwner != null) {
      new PyRecursiveElementVisitor(){
        @Override public void visitPyReferenceExpression(        PyReferenceExpression node){
          super.visitPyReferenceExpression(node);
          if (ControlFlowCache.getScope(scopeOwner).containsDeclaration(node.getName())) {
            isValid[0]=false;
          }
        }
      }
.visitElement(element);
    }
    final PyStatement nonlocalStatement=PsiTreeUtil.getParentOfType(element,PyNonlocalStatement.class,PyGlobalStatement.class);
    final PyStatementList statementList=PsiTreeUtil.getParentOfType(element,PyStatementList.class);
    return function != null && !isResolvedToParameter(element) && isValid[0] && nonlocalStatement == null && statementList != null;
  }
  return false;
}
