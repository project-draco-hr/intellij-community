{
  final BuildDataManager dataManager=context.getProjectDescriptor().dataManager;
  final File buildDir=dataManager.getDataPaths().getDataStorageRoot();
  if (isEnabled()) {
    boolean isRebuild=JavaBuilderUtil.isForcedRecompilationAllJavaModules(context);
    if (!JavaCompilers.JAVAC_ID.equals(JavaBuilder.getUsedCompilerId(context))) {
      CompilerBackwardReferenceIndex.removeIndexFiles(buildDir);
      return;
    }
    if (isRebuild) {
      CompilerBackwardReferenceIndex.removeIndexFiles(buildDir);
    }
 else     if (CompilerBackwardReferenceIndex.versionDiffers(buildDir)) {
      throw new BuildDataCorruptedException(new IOException("backward reference index should be updated to actual version"));
    }
    if (CompilerBackwardReferenceIndex.exist(buildDir) || isRebuild) {
      ourInstance=new BackwardReferenceIndexWriter(new CompilerBackwardReferenceIndex(buildDir),isRebuild);
    }
  }
 else {
    CompilerBackwardReferenceIndex.removeIndexFiles(buildDir);
  }
}
