{
  this.project=project;
  final DefaultMutableTreeNode root;
  patternTreeModel=new DefaultTreeModel(root=new DefaultMutableTreeNode(null));
  DefaultMutableTreeNode parent=null;
  String lastCategory=null;
  LinkedList<Object> nodesToExpand=new LinkedList<Object>();
  final PredefinedConfiguration[] predefined=PredefinedConfiguration.getPredefinedTemplates();
  for (  final PredefinedConfiguration info : predefined) {
    final DefaultMutableTreeNode node=new DefaultMutableTreeNode(info);
    if (lastCategory == null || !lastCategory.equals(info.getCategory())) {
      if (info.getCategory().length() > 0) {
        root.add(parent=new DefaultMutableTreeNode(info.getCategory()));
        nodesToExpand.add(parent);
        lastCategory=info.getCategory();
      }
 else {
        root.add(node);
        continue;
      }
    }
    parent.add(node);
  }
  parent=new DefaultMutableTreeNode(PredefinedConfiguration.USER_DEFINED_TYPE);
  userTemplatesNode=parent;
  root.add(parent);
  nodesToExpand.add(parent);
  final ConfigurationManager configurationManager=StructuralSearchPlugin.getInstance(this.project).getConfigurationManager();
  if (configurationManager.getConfigurations() != null) {
    for (    final Configuration config : configurationManager.getConfigurations()) {
      parent.add(new DefaultMutableTreeNode(config));
    }
  }
  patternTree=createTree(patternTreeModel);
  for (  final Object aNodesToExpand : nodesToExpand) {
    patternTree.expandPath(new TreePath(new Object[]{root,aNodesToExpand}));
  }
  panel=ToolbarDecorator.createDecorator(patternTree).setAddAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      addSelectedTreeNodeAndClose();
    }
  }
).setRemoveAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      Object selection=patternTree.getLastSelectedPathComponent();
      if (selection instanceof DefaultMutableTreeNode) {
        DefaultMutableTreeNode node=(DefaultMutableTreeNode)selection;
        if (node.getUserObject() instanceof Configuration) {
          Configuration configuration=(Configuration)node.getUserObject();
          patternTreeModel.removeNodeFromParent(node);
          configurationManager.removeConfiguration(configuration);
        }
      }
    }
  }
).createPanel();
  new JPanel(new BorderLayout());
  configureSelectTemplateAction(patternTree);
  historyModel=new DefaultListModel();
  historyPanel=new JPanel(new BorderLayout());
  historyPanel.add(BorderLayout.NORTH,new JLabel(SSRBundle.message("used.templates")));
  Component view=historyList=new JBList(historyModel);
  historyPanel.add(BorderLayout.CENTER,ScrollPaneFactory.createScrollPane(view));
  historyList.setCellRenderer(new ListCellRenderer());
  historyList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  new ListSpeedSearch(historyList);
  if (configurationManager.getHistoryConfigurations() != null) {
    for (    final Configuration configuration : configurationManager.getHistoryConfigurations()) {
      historyModel.addElement(configuration);
    }
    historyList.setSelectedIndex(0);
  }
  configureSelectTemplateAction(historyList);
}
