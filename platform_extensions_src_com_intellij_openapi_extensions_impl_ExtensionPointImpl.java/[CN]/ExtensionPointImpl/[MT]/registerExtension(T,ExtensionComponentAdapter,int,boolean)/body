{
  if (getExtensionIndex(extension) != -1) {
    myOwner.error("Extension was already added: " + extension);
    return;
  }
  Class<T> extensionClass=getExtensionClass();
  if (!extensionClass.isInstance(extension)) {
    myOwner.error("Extension " + extension.getClass() + " does not implement "+ extensionClass);
    return;
  }
  if (myLoadedAdapters == null)   myLoadedAdapters=new ArrayList<ExtensionComponentAdapter>();
  myLoadedAdapters.add(index,adapter);
  if (runNotifications) {
    clearCache();
    if (!adapter.isNotificationSent()) {
      if (extension instanceof Extension) {
        try {
          ((Extension)extension).extensionAdded(this);
        }
 catch (        Throwable e) {
          myOwner.error(e);
        }
      }
      notifyListenersOnAdd(extension,adapter.getPluginDescriptor());
      adapter.setNotificationSent(true);
    }
  }
}
