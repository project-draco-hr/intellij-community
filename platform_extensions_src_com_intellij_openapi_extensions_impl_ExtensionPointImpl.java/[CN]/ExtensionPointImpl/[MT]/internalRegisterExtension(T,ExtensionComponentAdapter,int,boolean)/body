{
  if (myExtensions.contains(extension)) {
    myLogger.error("Extension was already added: " + extension);
    return;
  }
  Class<T> extensionClass=getExtensionClass();
  if (!extensionClass.isInstance(extension)) {
    myLogger.error("Extension '" + extension + "' does not implement "+ extensionClass);
    return;
  }
  myExtensions.add(index,extension);
  myLoadedAdapters.add(index,adapter);
  if (runNotifications) {
    if (extension instanceof Extension) {
      try {
        ((Extension)extension).extensionAdded(this);
      }
 catch (      Throwable e) {
        myLogger.error(e);
      }
    }
    clearCache();
    notifyListenersOnAdd(extension,adapter.getPluginDescriptor());
  }
}
