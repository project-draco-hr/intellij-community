{
  final PythonSdkAdditionalData pythonAdditionalData=PyUtil.as(sdk.getSdkAdditionalData(),PythonSdkAdditionalData.class);
  final Collection<VirtualFile> excludedPaths=pythonAdditionalData != null ? pythonAdditionalData.getExcludedPathFiles() : Collections.emptyList();
  final Set<VirtualFile> moduleRoots=new HashSet<>();
  if (project != null) {
    final Module[] modules=ModuleManager.getInstance(project).getModules();
    for (    Module module : modules) {
      moduleRoots.addAll(PyUtil.getSourceRoots(module));
    }
  }
  final List<VirtualFile> results=Lists.newArrayList();
  for (  String path : paths) {
    if (path != null && !FileUtilRt.extensionEquals(path,"egg-info")) {
      final VirtualFile virtualFile=StandardFileSystems.local().refreshAndFindFileByPath(path);
      if (virtualFile != null) {
        final VirtualFile rootFile=PythonSdkType.getSdkRootVirtualFile(virtualFile);
        if (!excludedPaths.contains(rootFile) && !moduleRoots.contains(rootFile)) {
          results.add(rootFile);
          continue;
        }
      }
    }
    LOG.info("Bogus sys.path entry " + path);
  }
  return results;
}
