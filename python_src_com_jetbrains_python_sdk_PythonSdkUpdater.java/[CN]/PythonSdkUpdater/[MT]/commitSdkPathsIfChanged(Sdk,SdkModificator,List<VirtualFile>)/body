{
  final String homePath=sdk.getHomePath();
  final SdkModificator modificatorToGetRoots=sdkModificator != null ? sdkModificator : sdk.getSdkModificator();
  final List<VirtualFile> currentSdkPaths=Arrays.asList(modificatorToGetRoots.getRoots(OrderRootType.CLASSES));
  if (!Sets.difference(Sets.newHashSet(sdkPaths),Sets.newHashSet(currentSdkPaths)).isEmpty()) {
    ApplicationManager.getApplication().invokeAndWait(new Runnable(){
      @Override public void run(){
        final Sdk sdk=PythonSdkType.findSdkByPath(homePath);
        final SdkModificator modificatorToCommit=sdkModificator != null ? sdkModificator : sdk != null ? sdk.getSdkModificator() : modificatorToGetRoots;
        modificatorToCommit.removeAllRoots();
        for (        VirtualFile sdkPath : sdkPaths) {
          modificatorToCommit.addRoot(PythonSdkType.getSdkRootVirtualFile(sdkPath),OrderRootType.CLASSES);
        }
        modificatorToCommit.commitChanges();
      }
    }
,ModalityState.defaultModalityState());
  }
}
