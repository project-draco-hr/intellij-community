{
  final String workingDirectory=myConfiguration.getWorkingDirectory();
  if (!StringUtil.isEmptyOrSpaces(workingDirectory)) {
    cmd.withWorkDirectory(workingDirectory);
  }
 else   if (myConfiguration instanceof AbstractPythonTestRunConfiguration) {
    final String folderName=((AbstractPythonTestRunConfiguration)myConfiguration).getFolderName();
    if (!StringUtil.isEmptyOrSpaces(folderName)) {
      cmd.withWorkDirectory(folderName);
    }
 else {
      final String scriptName=((AbstractPythonTestRunConfiguration)myConfiguration).getScriptName();
      if (StringUtil.isEmptyOrSpaces(scriptName))       return;
      final VirtualFile script=LocalFileSystem.getInstance().findFileByPath(scriptName);
      if (script == null)       return;
      cmd.withWorkDirectory(script.getParent().getPath());
    }
  }
  if (cmd.getWorkDirectory() == null) {
    cmd.setWorkDirectory(myConfiguration.getWorkingDirectorySafe());
  }
}
