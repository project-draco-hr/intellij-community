{
  if (expression instanceof PsiFunctionalExpression) {
    final PsiClass targetTypeParameter=PsiUtil.resolveClassInClassTypeOnly(formalType);
    if (targetTypeParameter instanceof PsiTypeParameter && method.equals(((PsiTypeParameter)targetTypeParameter).getOwner())) {
      return true;
    }
    if (!((PsiFunctionalExpression)expression).isPotentiallyCompatible(formalType)) {
      return false;
    }
  }
 else   if (expression instanceof PsiParenthesizedExpression) {
    return isPotentialCompatible(((PsiParenthesizedExpression)expression).getExpression(),formalType,method);
  }
 else   if (expression instanceof PsiConditionalExpression) {
    return isPotentialCompatible(((PsiConditionalExpression)expression).getThenExpression(),formalType,method) && isPotentialCompatible(((PsiConditionalExpression)expression).getElseExpression(),formalType,method);
  }
  return true;
}
