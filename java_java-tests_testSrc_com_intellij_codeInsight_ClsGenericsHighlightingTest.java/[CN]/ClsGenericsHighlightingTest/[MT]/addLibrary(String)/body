{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final ModifiableRootModel model=ModuleRootManager.getInstance(myModule).getModifiableModel();
      final LibraryTable libraryTable=model.getModuleLibraryTable();
      final Library library=libraryTable.createLibrary("test");
      final Library.ModifiableModel libraryModel=library.getModifiableModel();
      for (      String annotationsDir : libraryPath) {
        final VirtualFile libJarLocal=LocalFileSystem.getInstance().findFileByPath(myFixture.getTestDataPath() + "/libs/" + annotationsDir);
        assertNotNull(libJarLocal);
        final VirtualFile jarRoot=JarFileSystem.getInstance().getJarRootForLocalFile(libJarLocal);
        assertNotNull(jarRoot);
        libraryModel.addRoot(jarRoot,OrderRootType.CLASSES);
      }
      libraryModel.commit();
      final String contentUrl=VfsUtilCore.pathToUrl(myFixture.getTempDirPath());
      model.addContentEntry(contentUrl).addSourceFolder(contentUrl,false);
      model.commit();
    }
  }
);
}
