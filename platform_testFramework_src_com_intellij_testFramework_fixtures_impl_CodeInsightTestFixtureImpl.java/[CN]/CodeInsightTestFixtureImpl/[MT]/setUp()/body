{
  super.setUp();
  TestRunnerUtil.replaceIdeEventQueueSafely();
  EdtTestUtil.runInEdtAndWait(new ThrowableRunnable<Throwable>(){
    @Override public void run() throws Throwable {
      myProjectFixture.setUp();
      myTempDirFixture.setUp();
      VirtualFile tempDir=myTempDirFixture.getFile("");
      PlatformTestCase.synchronizeTempDirVfs(tempDir);
      myPsiManager=(PsiManagerImpl)PsiManager.getInstance(getProject());
      configureInspections(LocalInspectionTool.EMPTY_ARRAY,getProject(),Collections.emptyList(),getTestRootDisposable());
      DaemonCodeAnalyzerImpl daemonCodeAnalyzer=(DaemonCodeAnalyzerImpl)DaemonCodeAnalyzer.getInstance(getProject());
      daemonCodeAnalyzer.prepareForTest();
      DaemonCodeAnalyzerSettings.getInstance().setImportHintEnabled(false);
      ensureIndexesUpToDate(getProject());
      ((StartupManagerImpl)StartupManagerEx.getInstanceEx(getProject())).runPostStartupActivities();
    }
  }
);
}
