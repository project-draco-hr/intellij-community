{
  assertInitialized();
  myEmptyLookup=false;
  return UIUtil.invokeAndWaitIfNeeded(new Computable<LookupElement[]>(){
    @Override public LookupElement[] compute(){
      CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
        @Override public void run(){
          final CodeCompletionHandlerBase handler=new CodeCompletionHandlerBase(type){
            @Override protected void completionFinished(            CompletionProgressIndicator indicator,            boolean hasModifiers){
              myEmptyLookup=indicator.getLookup().getItems().isEmpty();
              super.completionFinished(indicator,hasModifiers);
            }
          }
;
          Editor editor=getCompletionEditor();
          handler.invokeCompletion(getProject(),editor,invocationCount);
          PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
        }
      }
,null,null);
      return getLookupElements();
    }
  }
);
}
