{
  final List<Border> borders=new LinkedList<>();
  for (  HighlightInfo region : highlighting) {
    TextAttributes attributes=region.getTextAttributes(null,null);
    borders.add(new Border(Border.LEFT,region.getStartOffset(),attributes == null ? "null" : attributes.getForegroundColor() == null ? "null" : Integer.toHexString(attributes.getForegroundColor().getRGB()),false));
    borders.add(new Border(Border.RIGHT,region.getEndOffset(),"",false));
  }
  Collections.sort(borders);
  StringBuilder result=new StringBuilder(myEditor.getDocument().getText());
  for (  Border border : borders) {
    StringBuilder info=new StringBuilder();
    info.append('<');
    if (border.isSide() == Border.LEFT) {
      info.append(tagName);
      if (withColor) {
        info.append(" color=\'").append(border.myText).append('\'');
      }
    }
 else {
      info.append('/').append(tagName);
    }
    info.append('>');
    result.insert(border.getOffset(),info);
  }
  return result.toString();
}
