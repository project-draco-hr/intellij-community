{
  Project project=file.getProject();
  ensureIndexesUpToDate(project);
  DaemonCodeAnalyzerImpl codeAnalyzer=(DaemonCodeAnalyzerImpl)DaemonCodeAnalyzer.getInstance(project);
  TextEditor textEditor=TextEditorProvider.getInstance().getTextEditor(editor);
  ProcessCanceledException exception=null;
  for (int i=0; i < 1000; i++) {
    try {
      List<HighlightInfo> infos=codeAnalyzer.runPasses(file,editor.getDocument(),textEditor,toIgnore,canChangeDocument,null);
      infos.addAll(DaemonCodeAnalyzerEx.getInstanceEx(project).getFileLevelHighlights(project,file));
      return infos;
    }
 catch (    ProcessCanceledException e) {
      PsiDocumentManager.getInstance(project).commitAllDocuments();
      UIUtil.dispatchAllInvocationEvents();
      exception=e;
    }
  }
  throw exception;
}
