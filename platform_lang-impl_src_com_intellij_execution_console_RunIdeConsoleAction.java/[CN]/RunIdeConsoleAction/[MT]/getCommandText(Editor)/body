{
  TextRange selectedRange=EditorUtil.getSelectionInAnyMode(editor);
  Document document=editor.getDocument();
  if (selectedRange.getLength() == 0) {
    int line=document.getLineNumber(selectedRange.getStartOffset());
    selectedRange=TextRange.create(document.getLineStartOffset(line),document.getLineEndOffset(line));
  }
  return document.getText(selectedRange);
}
