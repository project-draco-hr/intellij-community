{
  TextRange selectedRange=EditorUtil.getSelectionInAnyMode(editor);
  Document document=editor.getDocument();
  if (selectedRange.getLength() == 0) {
    int line=document.getLineNumber(selectedRange.getStartOffset());
    selectedRange=TextRange.create(document.getLineStartOffset(line),document.getLineEndOffset(line));
  }
  String command=document.getText(selectedRange);
  final ConsoleView consoleView=getConsoleView(project,file,engine);
  try {
class IDE {
      public void print(      String s){
        consoleView.print(s + "\n",ConsoleViewContentType.NORMAL_OUTPUT);
      }
      public void error(      String s){
        consoleView.print(s + "\n",ConsoleViewContentType.ERROR_OUTPUT);
      }
    }
    consoleView.print("> " + command,ConsoleViewContentType.USER_INPUT);
    consoleView.print("\n",ConsoleViewContentType.USER_INPUT);
    engine.getBindings(ScriptContext.ENGINE_SCOPE).put("IDE",new IDE());
    Object o=engine.eval(command);
    consoleView.print("=> " + o,ConsoleViewContentType.NORMAL_OUTPUT);
    consoleView.print("\n",ConsoleViewContentType.NORMAL_OUTPUT);
    consoleView.print("\n",ConsoleViewContentType.NORMAL_OUTPUT);
  }
 catch (  Exception e) {
    consoleView.print(e.getMessage(),ConsoleViewContentType.ERROR_OUTPUT);
    consoleView.print("\n",ConsoleViewContentType.ERROR_OUTPUT);
  }
  ((ConsoleViewImpl)consoleView).scrollToEnd();
}
