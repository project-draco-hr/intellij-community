{
  PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  WeakReference<ConsoleView> ref=psiFile == null ? null : psiFile.getCopyableUserData(CONSOLE_VIEW_KEY);
  ConsoleView existing=ref == null ? null : ref.get();
  if (existing != null && !Disposer.isDisposed(existing))   return existing;
  ConsoleView consoleView=TextConsoleBuilderFactory.getInstance().createBuilder(project).getConsole();
  if (psiFile != null)   psiFile.putCopyableUserData(CONSOLE_VIEW_KEY,new WeakReference<ConsoleView>(consoleView));
  DefaultActionGroup toolbarActions=new DefaultActionGroup();
  JComponent consoleComponent=new JPanel(new BorderLayout());
  consoleComponent.add(consoleView.getComponent(),BorderLayout.CENTER);
  consoleComponent.add(ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN,toolbarActions,false).getComponent(),BorderLayout.WEST);
  final RunContentDescriptor descriptor=new RunContentDescriptor(consoleView,null,consoleComponent,file.getName()){
    @Override public boolean isContentReuseProhibited(){
      return true;
    }
  }
;
  final Executor executor=DefaultRunExecutor.getRunExecutorInstance();
  toolbarActions.add(new CloseAction(executor,descriptor,project));
  for (  AnAction action : consoleView.createConsoleActions()) {
    toolbarActions.add(action);
  }
  ExecutionManager.getInstance(project).getContentManager().showRunContent(executor,descriptor);
  return consoleView;
}
