{
  VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile == null)   return null;
  DocumentEx doc=(DocumentEx)PsiDocumentManager.getInstance(psiFile.getProject()).getDocument(psiFile);
  if (doc == null)   return null;
  EditorHighlighter highlighter=HighlighterFactory.createHighlighter(psiFile.getProject(),virtualFile);
  highlighter.setText(doc.getCharsSequence());
  return new TextPainter(doc,highlighter,virtualFile.getPresentableUrl(),virtualFile.getPresentableName(),psiFile,psiFile.getFileType(),editor);
}
