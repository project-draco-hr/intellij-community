{
  final ApplicationEx app=(ApplicationEx)ApplicationManager.getApplication();
  final boolean mac=Messages.canShowMacSheetPanel();
  boolean canRestart=app.isRestartCapable();
  String[] options=new String[canRestart ? 4 : 3];
  options[0]=canRestart ? "Invalidate and Restart" : "Invalidate and Exit";
  options[1]=mac ? "Cancel" : "Invalidate";
  options[2]=mac ? "Invalidate" : "Cancel";
  if (canRestart) {
    options[3]="Just Restart";
  }
  int result=Messages.showDialog(e.getData(PlatformDataKeys.PROJECT),"The caches will be invalidated and rebuilt on the next startup.\n" + "WARNING: Local History will be also cleared.\n\n" + "Would you like to continue?\n\n","Invalidate Caches",options,0,Messages.getWarningIcon());
  if (result == -1 || result == (mac ? 1 : 2)) {
    return;
  }
  if (result == 3) {
    app.restart(true);
    return;
  }
  FSRecords.invalidateCaches();
  if (result == 0)   app.restart(true);
}
