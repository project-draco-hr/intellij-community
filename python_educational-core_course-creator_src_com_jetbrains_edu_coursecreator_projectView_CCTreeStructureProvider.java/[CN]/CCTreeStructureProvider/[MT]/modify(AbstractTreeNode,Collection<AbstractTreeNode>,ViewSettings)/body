{
  if (!needModify(parent)) {
    return children;
  }
  Collection<AbstractTreeNode> nodes=new ArrayList<AbstractTreeNode>();
  for (  AbstractTreeNode node : children) {
    Project project=node.getProject();
    if (project != null) {
      if (node.getValue() instanceof PsiDirectory) {
        String name=((PsiDirectory)node.getValue()).getName();
        if (CCUtils.GENERATED_FILES_FOLDER.equals(name)) {
          continue;
        }
        PsiDirectory directory=(PsiDirectory)node.getValue();
        nodes.add(new CCDirectoryNode(project,directory,settings));
        continue;
      }
      if (node instanceof PsiFileNode) {
        PsiFileNode fileNode=(PsiFileNode)node;
        VirtualFile virtualFile=fileNode.getVirtualFile();
        if (virtualFile == null) {
          continue;
        }
        if (virtualFile.getName().contains(EduNames.WINDOWS_POSTFIX)) {
          continue;
        }
        if (virtualFile.getParent().getName().contains(EduNames.TASK) && !CCProjectService.getInstance(project).isTaskFile(virtualFile)) {
          nodes.add(new CCStudentInvisibleFileNode(project,((PsiFileNode)node).getValue(),settings));
          continue;
        }
      }
      nodes.add(node);
    }
  }
  return nodes;
}
