{
  if (stateElement == null) {
    return mergeInto;
  }
 else   if (stateClass == Element.class) {
    return (T)stateElement;
  }
 else   if (JDOMExternalizable.class.isAssignableFrom(stateClass)) {
    if (mergeInto != null) {
      String elementText=JDOMUtil.writeElement(stateElement,"\n");
      LOG.error("State is " + stateClass.getName() + ", merge into is "+ mergeInto.toString()+ ", state element text is "+ elementText);
    }
    T t=ReflectionUtil.newInstance(stateClass);
    try {
      ((JDOMExternalizable)t).readExternal(stateElement);
      return t;
    }
 catch (    InvalidDataException e) {
      throw new RuntimeException(e);
    }
  }
 else   if (mergeInto == null) {
    return XmlSerializer.deserialize(stateElement,stateClass);
  }
 else {
    XmlSerializer.deserializeInto(mergeInto,stateElement);
    return mergeInto;
  }
}
