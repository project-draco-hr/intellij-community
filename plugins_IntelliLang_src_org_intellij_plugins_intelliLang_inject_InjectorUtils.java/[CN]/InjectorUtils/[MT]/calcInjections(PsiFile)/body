{
  final TreeMap<TextRange,BaseInjection> injectionMap=new TreeMap<TextRange,BaseInjection>(RANGE_COMPARATOR);
  TIntArrayList ints=new TIntArrayList();
  StringSearcher searcher=new StringSearcher("language=",true,true,false);
  CharSequence contents=file.getViewProvider().getContents();
  final char[] contentsArray=CharArrayUtil.fromSequenceWithoutCopying(contents);
  int s0=0, s1=contents.length();
  for (int idx=searcher.scan(contents,contentsArray,s0,s1); idx != -1; idx=searcher.scan(contents,contentsArray,idx + 1,s1)) {
    ints.add(idx);
    PsiComment element=PsiTreeUtil.findElementOfClassAtOffset(file,idx,PsiComment.class,false);
    if (element != null) {
      String str=ElementManipulators.getValueText(element).trim();
      BaseInjection injection=detectInjectionFromText("",str);
      if (injection != null) {
        injectionMap.put(element.getTextRange(),injection);
      }
    }
  }
  return injectionMap;
}
