{
  PsiElement target=CompletionUtil.getOriginalOrSelf(context);
  PsiFile file=target.getContainingFile();
  if (file == null)   return null;
  TreeMap<TextRange,BaseInjection> map=getInjectionMap(file);
  if (map == null)   return null;
  Map.Entry<TextRange,BaseInjection> entry=map.lowerEntry(target.getTextRange());
  if (entry == null)   return null;
  PsiComment psiComment=PsiTreeUtil.findElementOfClassAtOffset(file,entry.getKey().getStartOffset(),PsiComment.class,false);
  if (psiComment == null)   return null;
  TextRange r0=psiComment.getTextRange();
  PsiElement commonParent=PsiTreeUtil.findCommonParent(psiComment,target);
  int h1=0, h2=0;
  PsiElement e1=psiComment, e2=target;
  for (PsiElement e=e1; e != commonParent; e1=e, e=e.getParent(), h1++)   ;
  for (PsiElement e=e2; e != commonParent; e2=e, e=e.getParent(), h2++)   ;
  int off1=r0.getEndOffset();
  int off2=e2.getTextRange().getStartOffset();
  if (off2 - off1 > 120) {
    return null;
  }
 else   if (off2 - off1 > 2) {
    Producer<PsiElement> producer=prevWalker(e2,commonParent);
    PsiElement e;
    while ((e=producer.produce()) != null && e != psiComment) {
      if (e instanceof PsiLanguageInjectionHost && ((PsiLanguageInjectionHost)e).isValidHost() && !StringUtil.isEmptyOrSpaces(e.getText())) {
        return null;
      }
    }
  }
  if (causeRef != null) {
    causeRef.set(psiComment);
  }
  return new BaseInjection(supportId).copyFrom(entry.getValue());
}
