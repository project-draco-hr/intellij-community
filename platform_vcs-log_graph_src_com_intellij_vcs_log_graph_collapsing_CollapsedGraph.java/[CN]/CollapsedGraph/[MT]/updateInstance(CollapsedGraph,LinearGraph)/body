{
  UnsignedBitSet visibleNodesId=prevCollapsedGraph.myDelegateNodesVisibility.getNodeVisibilityById();
  GraphNodesVisibility delegateNodesVisibility=new GraphNodesVisibility(newDelegateGraph,visibleNodesId);
  UpdatableIntToIntMap nodesMap=ListIntToIntMap.newInstance(delegateNodesVisibility.asFlags());
  GraphAdditionalEdges graphAdditionalEdges=GraphAdditionalEdges.updateInstance(prevCollapsedGraph.myGraphAdditionalEdges,createGetNodeIndexById(newDelegateGraph,visibleNodesId,nodesMap),createGetNodeIdByIndex(newDelegateGraph,nodesMap));
  return new CollapsedGraph(newDelegateGraph,delegateNodesVisibility,nodesMap,graphAdditionalEdges);
}
