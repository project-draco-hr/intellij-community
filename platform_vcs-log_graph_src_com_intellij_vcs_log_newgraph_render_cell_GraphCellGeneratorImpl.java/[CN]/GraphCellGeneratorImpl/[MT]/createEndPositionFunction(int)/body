{
  List<GraphElement> visibleElementsInNextRow=getSortedVisibleElementsInRow(visibleRowIndex + 1);
  final Map<GraphElement,Integer> toPosition=new HashMap<GraphElement,Integer>();
  for (int position=0; position < visibleElementsInNextRow.size(); position++)   toPosition.put(visibleElementsInNextRow.get(position),position);
  return new Function<Edge,Integer>(){
    @Override public Integer fun(    Edge edge){
      Integer position=toPosition.get(edge);
      if (position == null) {
        int downNodeVisibleIndex=edge.getDownNodeVisibleIndex();
        if (downNodeVisibleIndex != Edge.NOT_LOAD_NODE)         position=toPosition.get(myGraph.getNode(downNodeVisibleIndex));
      }
      if (position == null) {
        return -1;
      }
 else {
        return position;
      }
    }
  }
;
}
