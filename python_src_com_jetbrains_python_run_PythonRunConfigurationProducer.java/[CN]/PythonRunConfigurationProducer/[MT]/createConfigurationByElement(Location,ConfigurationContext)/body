{
  PsiFile script=location.getPsiElement().getContainingFile();
  if (script == null || script.getFileType() != PythonFileType.INSTANCE) {
    return null;
  }
  Module module=ModuleUtil.findModuleForPsiElement(script);
  if (module != null) {
    for (    RunnableScriptFilter f : Extensions.getExtensions(RunnableScriptFilter.EP_NAME)) {
      if (f.isRunnableScript(script,module)) {
        return null;
      }
    }
  }
  mySourceFile=script;
  final Project project=mySourceFile.getProject();
  RunnerAndConfigurationSettingsImpl settings=cloneTemplateConfiguration(project,context);
  PythonRunConfiguration configuration=(PythonRunConfiguration)settings.getConfiguration();
  final VirtualFile vFile=mySourceFile.getVirtualFile();
  if (vFile == null)   return null;
  configuration.setScriptName(vFile.getPath());
  final VirtualFile parent=vFile.getParent();
  if (parent != null) {
    configuration.setWorkingDirectory(parent.getPath());
  }
  configuration.setName(configuration.suggestedName());
  if (module != null) {
    configuration.setUseModuleSdk(true);
    configuration.setModule(module);
  }
  copyStepsBeforeRun(project,configuration);
  return settings;
}
