{
  final PsiElement element=instruction.getElement();
  if (instruction instanceof ReadWriteInstruction) {
    final ReadWriteInstruction rwInstruction=(ReadWriteInstruction)instruction;
    if (!rwInstruction.getAccess().isWriteAccess()) {
      return map;
    }
    final String name=rwInstruction.getName();
    final ScopeVariable variable=map.get(name);
    final PsiElement parameterScope=ScopeUtil.getParameterScope(element);
    if (parameterScope != null) {
      final ScopeVariable scopeVariable=new ScopeVariableImpl(name,true,element);
      map=map.asWritable();
      map.put(name,scopeVariable);
    }
 else {
      final ScopeVariableImpl scopeVariable;
      final boolean isParameter=variable != null && variable.isParameter();
      if (variable == null) {
        scopeVariable=new ScopeVariableImpl(name,isParameter,element);
      }
 else {
        scopeVariable=new ScopeVariableImpl(name,isParameter,variable.getDeclarations());
      }
      map=map.asWritable();
      map.put(name,scopeVariable);
    }
  }
  return map;
}
