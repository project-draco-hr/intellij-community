{
  final PsiElement element=instruction.getElement();
  final DFAMap<ScopeVariable> reducedMap=new DFAMap<ScopeVariable>();
  for (  Map.Entry<String,ScopeVariable> entry : map.entrySet()) {
    final ScopeVariable value=entry.getValue();
    if (element != null && PsiTreeUtil.isAncestor(value.getScope(),element,false)) {
      reducedMap.put(entry.getKey(),value);
    }
  }
  return processReducedMap(reducedMap,instruction,element);
}
