{
  final ArrayList<Block> subBlocks=new ArrayList<Block>();
  if (indentLabelBlocks && isCodeBlock()) {
    List<ASTNode> flattenChildren=flattenChildren(children);
    calculateAlignments(flattenChildren,classLevel);
    for (int i=0; i < flattenChildren.size(); i++) {
      ASTNode childNode=flattenChildren.get(i);
      if (childNode.getElementType() == GroovyElementTypes.LABELED_STATEMENT) {
        int start=i;
        do {
          i++;
        }
 while (i < flattenChildren.size() && flattenChildren.get(i).getElementType() != GroovyElementTypes.LABELED_STATEMENT && flattenChildren.get(i).getElementType() != GroovyTokenTypes.mRCURLY);
        subBlocks.add(new GrLabelBlock(childNode,flattenChildren.subList(start + 1,i),classLevel,getIndent(childNode),getChildWrap(childNode),myContext));
        i--;
      }
 else {
        subBlocks.add(new GroovyBlock(childNode,getIndent(childNode),getChildWrap(childNode),myContext));
      }
    }
  }
 else {
    calculateAlignments(children,classLevel);
    for (    ASTNode childNode : children) {
      subBlocks.add(new GroovyBlock(childNode,getIndent(childNode),getChildWrap(childNode),myContext));
    }
  }
  return subBlocks;
}
