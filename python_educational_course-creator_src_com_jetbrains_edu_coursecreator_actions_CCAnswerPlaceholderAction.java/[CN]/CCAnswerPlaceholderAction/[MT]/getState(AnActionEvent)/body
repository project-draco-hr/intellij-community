{
  final Project project=e.getProject();
  if (project == null || CCProjectService.getInstance(project).getCourse() == null) {
    return null;
  }
  final PsiFile psiFile=CommonDataKeys.PSI_FILE.getData(e.getDataContext());
  if (psiFile == null) {
    return null;
  }
  VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile == null) {
    return null;
  }
  final Editor editor=CommonDataKeys.EDITOR.getData(e.getDataContext());
  if (editor == null) {
    return null;
  }
  TaskFile taskFile=CCProjectService.getInstance(project).getTaskFile(virtualFile);
  if (taskFile == null) {
    return null;
  }
  AnswerPlaceholder answerPlaceholder=taskFile.getAnswerPlaceholder(editor.getDocument(),editor.getCaretModel().getLogicalPosition(),true);
  if (answerPlaceholder == null) {
    return null;
  }
  return new CCState(taskFile,answerPlaceholder,psiFile,editor,project);
}
