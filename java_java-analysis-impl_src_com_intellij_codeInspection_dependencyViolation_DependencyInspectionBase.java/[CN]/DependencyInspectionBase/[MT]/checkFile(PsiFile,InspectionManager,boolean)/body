{
  if (file.getViewProvider().getPsi(JavaLanguage.INSTANCE) == null)   return null;
  final DependencyValidationManager validationManager=DependencyValidationManager.getInstance(file.getProject());
  if (!validationManager.hasRules())   return null;
  if (validationManager.getApplicableRules(file).length == 0)   return null;
  final List<ProblemDescriptor> problems=new ArrayList<ProblemDescriptor>();
  final FactoryMap<PsiFile,DependencyRule[]> violations=new FactoryMap<PsiFile,DependencyRule[]>(){
    @Nullable @Override protected DependencyRule[] create(    PsiFile dependencyFile){
      return validationManager.getViolatorDependencyRules(file,dependencyFile);
    }
  }
;
  DependenciesBuilder.analyzeFileDependencies(file,new DependenciesBuilder.DependencyProcessor(){
    @Override public void process(    PsiElement place,    PsiElement dependency){
      PsiFile dependencyFile=dependency.getContainingFile();
      if (dependencyFile != null && dependencyFile.isPhysical() && dependencyFile.getVirtualFile() != null) {
        for (        DependencyRule dependencyRule : violations.get(dependencyFile)) {
          problems.add(manager.createProblemDescriptor(place,InspectionsBundle.message("inspection.dependency.violator.problem.descriptor",dependencyRule.getDisplayText()),isOnTheFly,createEditDependencyFixes(dependencyRule),ProblemHighlightType.GENERIC_ERROR_OR_WARNING));
        }
      }
    }
  }
);
  return problems.isEmpty() ? null : problems.toArray(new ProblemDescriptor[problems.size()]);
}
