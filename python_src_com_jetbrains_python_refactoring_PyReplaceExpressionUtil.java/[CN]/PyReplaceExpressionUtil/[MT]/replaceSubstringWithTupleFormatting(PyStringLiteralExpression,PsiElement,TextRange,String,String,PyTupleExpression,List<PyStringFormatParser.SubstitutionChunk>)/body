{
  final String newLiteralText=prefix + "%s" + suffix;
  final PyElementGenerator generator=PyElementGenerator.getInstance(oldExpression.getProject());
  final PyStringLiteralExpression newLiteralExpression=generator.createStringLiteralAlreadyEscaped(newLiteralText);
  oldExpression.replace(newLiteralExpression);
  final PyExpression[] members=tupleFormatValue.getElements();
  final int n=members.length;
  final int i=Math.min(n,Math.max(0,getPositionInRanges(PyStringFormatParser.substitutionsToRanges(substitutions),textRange)));
  final boolean last=i == n;
  final ASTNode trailingComma=PyPsiUtils.getNextComma(members[n - 1].getNode());
  if (trailingComma != null) {
    tupleFormatValue.getNode().removeChild(trailingComma);
  }
  final PyExpression before=last ? null : members[i];
  PyUtil.addListNode(tupleFormatValue,newExpression,before != null ? before.getNode() : null,i == 0 || !last,last,!last);
  return newExpression;
}
