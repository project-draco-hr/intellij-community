{
  this.project=project;
  BrowseModuleValueActionListener[] browseListeners=new BrowseModuleValueActionListener[]{new PackageBrowser(project),new TestClassBrowser(project,this),new TestNGMethodBrowser(project),new GroupBrowser(project,this),new SuiteBrowser(project),new TestClassBrowser(project,this){
    @Override protected void onClassChoosen(    PsiClass psiClass){
      final JTextField textField=myPatternTextField.getTextField();
      final String text=textField.getText();
      textField.setText(text + (text.length() > 0 ? "||" : "") + psiClass.getQualifiedName());
    }
    @Override public void actionPerformed(    ActionEvent e){
      showDialog();
    }
  }
};
  model=new TestNGConfigurationModel(project);
  model.setListener(this);
  createView();
  moduleSelector=new ConfigurationModuleSelector(project,getModulesComponent());
  alternateJDK.setDefaultJreSelector(DefaultJreSelector.fromModuleDependencies(getModulesComponent(),false));
  commonJavaParameters.setModuleContext(moduleSelector.getModule());
  moduleClasspath.getComponent().addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      commonJavaParameters.setModuleContext(moduleSelector.getModule());
    }
  }
);
  commonJavaParameters.setHasModuleMacro();
  final JPanel panel=myPattern.getComponent();
  panel.setLayout(new BorderLayout());
  myPatternTextField=new TextFieldWithBrowseButton();
  myPatternTextField.setButtonIcon(IconUtil.getAddIcon());
  panel.add(myPatternTextField,BorderLayout.CENTER);
  final FixedSizeButton editBtn=new FixedSizeButton();
  editBtn.setIcon(AllIcons.Actions.ShowViewer);
  editBtn.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      Messages.showTextAreaDialog(myPatternTextField.getTextField(),"Configure suite tests","EditParametersPopupWindow");
    }
  }
);
  panel.add(editBtn,BorderLayout.EAST);
  myTestKind.setModel(new CollectionComboBoxModel<>(Arrays.asList(TestType.values())));
  myTestKind.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      model.setType((TestType)myTestKind.getSelectedItem());
    }
  }
);
  myTestKind.setRenderer(new ListCellRendererWrapper<TestType>(){
    @Override public void customize(    JList list,    TestType value,    int index,    boolean selected,    boolean hasFocus){
      if (value != null) {
        setText(value.getPresentableName());
      }
    }
  }
);
  registerListener(new JRadioButton[]{packagesInProject,packagesInModule,packagesAcrossModules},null);
  packagesInProject.addChangeListener(new ChangeListener(){
    public void stateChanged(    ChangeEvent e){
      evaluateModuleClassPath();
    }
  }
);
  LabeledComponent[] components=new LabeledComponent[]{packageField,classField,methodField,groupField,suiteField,myPattern};
  for (int i=0; i < components.length; i++) {
    JComponent field=components[i].getComponent();
    Object document=model.getDocument(i);
    if (field instanceof TextFieldWithBrowseButton) {
      ((TextFieldWithBrowseButton)field).getTextField().setDocument((PlainDocument)document);
    }
 else     if (field instanceof EditorTextFieldWithBrowseButton) {
      document=((EditorTextFieldWithBrowseButton)field).getChildComponent().getDocument();
    }
 else {
      field=myPatternTextField;
      document=new PlainDocument();
      ((TextFieldWithBrowseButton)field).getTextField().setDocument((Document)document);
    }
    browseListeners[i].setField((ComponentWithBrowseButton)field);
    if (browseListeners[i] instanceof MethodBrowser) {
      final EditorTextField childComponent=(EditorTextField)((ComponentWithBrowseButton)field).getChildComponent();
      ((MethodBrowser)browseListeners[i]).installCompletion(childComponent);
      document=childComponent.getDocument();
    }
    model.setDocument(i,document);
  }
  model.setType(TestType.CLASS);
  propertiesFile.getComponent().getTextField().setDocument(model.getPropertiesFileDocument());
  outputDirectory.getComponent().getTextField().setDocument(model.getOutputDirectoryDocument());
  commonJavaParameters.setProgramParametersLabel(ExecutionBundle.message("junit.configuration.test.runner.parameters.label"));
  setAnchor(outputDirectory.getLabel());
  alternateJDK.setAnchor(moduleClasspath.getLabel());
  commonJavaParameters.setAnchor(moduleClasspath.getLabel());
}
