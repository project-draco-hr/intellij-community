{
  final PsiElement element=descriptor.getStartElement();
  if (element instanceof PsiMethodCallExpression) {
    if (!FileModificationService.getInstance().preparePsiElementForWrite(element.getContainingFile()))     return;
    final PsiMethodCallExpression expression=(PsiMethodCallExpression)element;
    final PsiExpression forEachMethodQualifier=expression.getMethodExpression().getQualifierExpression();
    if (forEachMethodQualifier instanceof PsiMethodCallExpression) {
      final PsiMethodCallExpression previousExpression=(PsiMethodCallExpression)forEachMethodQualifier;
      final PsiExpression qualifierExpression=previousExpression.getMethodExpression().getQualifierExpression();
      if (qualifierExpression != null) {
        final String text=createExpressionText(expression,previousExpression,qualifierExpression);
        final PsiExpression newElement;
        try {
          newElement=JavaPsiFacade.getElementFactory(project).createExpressionFromText(text,null);
        }
 catch (        IncorrectOperationException e) {
          LOG.info("Failed to parse expression '" + text + "'",e);
          return;
        }
        final PsiElement shortenedElement=JavaCodeStyleManager.getInstance(project).shortenClassReferences(newElement);
        element.replace(shortenedElement);
      }
    }
  }
}
