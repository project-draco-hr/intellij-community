{
  Editor editor=state.getEditor();
  Project project=state.getProject();
  PsiFile file=state.getFile();
  final Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  if (document == null) {
    return;
  }
  final SelectionModel model=editor.getSelectionModel();
  final int offset=model.getSelectionStart();
  final AnswerPlaceholder answerPlaceholder=new AnswerPlaceholder();
  answerPlaceholder.setOffset(offset);
  answerPlaceholder.setUseLength(false);
  String selectedText=model.getSelectedText();
  answerPlaceholder.setPossibleAnswer(selectedText);
  CCCreateAnswerPlaceholderDialog dlg=new CCCreateAnswerPlaceholderDialog(project,answerPlaceholder);
  dlg.show();
  if (dlg.getExitCode() != DialogWrapper.OK_EXIT_CODE) {
    return;
  }
  TaskFile taskFile=state.getTaskFile();
  int index=taskFile.getAnswerPlaceholders().size() + 1;
  answerPlaceholder.setIndex(index);
  taskFile.addAnswerPlaceholder(answerPlaceholder);
  answerPlaceholder.setTaskFile(taskFile);
  taskFile.sortAnswerPlaceholders();
  computeInitialState(project,file,taskFile,document);
  EduAnswerPlaceholderPainter.drawAnswerPlaceholder(editor,answerPlaceholder,JBColor.BLUE);
  EduAnswerPlaceholderPainter.createGuardedBlocks(editor,answerPlaceholder);
}
