{
  Editor editor=state.getEditor();
  Project project=state.getProject();
  PsiFile file=state.getFile();
  final Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  if (document == null) {
    return;
  }
  final SelectionModel model=editor.getSelectionModel();
  final int start=model.getSelectionStart();
  final int lineNumber=document.getLineNumber(start);
  int realStart=start - document.getLineStartOffset(lineNumber);
  final AnswerPlaceholder answerPlaceholder=new AnswerPlaceholder();
  answerPlaceholder.setLine(lineNumber);
  answerPlaceholder.setStart(realStart);
  String selectedText=model.getSelectedText();
  answerPlaceholder.setPossibleAnswer(selectedText);
  CCCreateAnswerPlaceholderDialog dlg=new CCCreateAnswerPlaceholderDialog(project,answerPlaceholder);
  dlg.show();
  if (dlg.getExitCode() != DialogWrapper.OK_EXIT_CODE) {
    return;
  }
  TaskFile taskFile=state.getTaskFile();
  int index=taskFile.getAnswerPlaceholders().size() + 1;
  answerPlaceholder.setIndex(index);
  taskFile.addAnswerPlaceholder(answerPlaceholder);
  taskFile.sortAnswerPlaceholders();
  EduAnswerPlaceholderPainter.drawAnswerPlaceholder(editor,answerPlaceholder,false,JBColor.BLUE);
  EduAnswerPlaceholderPainter.createGuardedBlocks(editor,answerPlaceholder,false);
}
