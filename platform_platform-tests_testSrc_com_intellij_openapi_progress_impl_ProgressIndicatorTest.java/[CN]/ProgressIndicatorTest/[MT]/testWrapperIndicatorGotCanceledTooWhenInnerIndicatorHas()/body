{
  final ProgressIndicator progress=new ProgressIndicatorBase(){
    @Override protected boolean isCancelable(){
      return true;
    }
  }
;
  try {
    ProgressManager.getInstance().executeProcessUnderProgress(new Runnable(){
      @Override public void run(){
        assertFalse(ProgressManagerImpl.threadsUnderCanceledIndicator.contains(Thread.currentThread()));
        assertTrue(!progress.isCanceled());
        progress.cancel();
        assertTrue(ProgressManagerImpl.threadsUnderCanceledIndicator.contains(Thread.currentThread()));
        assertTrue(progress.isCanceled());
        while (true) {
          ProgressManager.checkCanceled();
        }
      }
    }
,ProgressWrapper.wrap(progress));
    fail("PCE must have been thrown");
  }
 catch (  ProcessCanceledException ignored) {
  }
}
