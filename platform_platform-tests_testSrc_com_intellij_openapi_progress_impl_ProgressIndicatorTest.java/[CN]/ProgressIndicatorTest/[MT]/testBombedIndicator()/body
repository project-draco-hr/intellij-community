{
  final int count=10;
  new BombedProgressIndicator(count).runBombed(new Runnable(){
    @Override public void run(){
      for (int i=0; i < count * 2; i++) {
        TimeoutUtil.sleep(10);
        try {
          ProgressManager.checkCanceled();
          if (i >= count) {
            ProgressManager.checkCanceled();
            fail("PCE expected on " + i + "th check");
          }
        }
 catch (        ProcessCanceledException e) {
          if (i < count) {
            fail("Too early PCE");
          }
        }
      }
    }
  }
);
}
