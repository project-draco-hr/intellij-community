{
synchronized (myEvaluated) {
    if (myEvaluated.containsKey(element)) {
      final PyType pyType=myEvaluated.get(element);
      if (pyType != null) {
        pyType.assertValid(element.toString());
      }
      return pyType;
    }
  }
  final Set<PyTypedElement> evaluating=myEvaluating.get();
  if (evaluating.contains(element)) {
    return null;
  }
  evaluating.add(element);
  try {
    PyType result=element.getType(this);
    if (result != null) {
      result.assertValid(element.toString());
    }
synchronized (myEvaluated) {
      myEvaluated.put(element,result);
    }
    return result;
  }
  finally {
    evaluating.remove(element);
  }
}
