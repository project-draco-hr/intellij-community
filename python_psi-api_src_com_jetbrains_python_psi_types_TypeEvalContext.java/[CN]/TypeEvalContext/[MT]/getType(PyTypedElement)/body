{
  final Set<PyTypedElement> evaluating=myEvaluating.get();
  if (evaluating.contains(element)) {
    return null;
  }
  evaluating.add(element);
  try {
synchronized (myEvaluated) {
      if (myEvaluated.containsKey(element)) {
        final PyType type=myEvaluated.get(element);
        assertValid(type,element);
        return type;
      }
    }
    final PyType type=element.getType(this,Key.INSTANCE);
    assertValid(type,element);
synchronized (myEvaluated) {
      myEvaluated.put(element,type);
    }
    return type;
  }
  finally {
    evaluating.remove(element);
  }
}
