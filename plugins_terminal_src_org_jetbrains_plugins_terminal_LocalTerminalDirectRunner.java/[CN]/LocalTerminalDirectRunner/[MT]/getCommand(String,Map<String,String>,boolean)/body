{
  if (SystemInfo.isUnix) {
    List<String> command=Lists.newArrayList(shellPath.split(" "));
    String shellCommand=command.get(0);
    String shellName=command.size() > 0 ? getShellName(shellCommand) : null;
    if (shellName != null) {
      command.remove(0);
      List<String> result=Lists.newArrayList(shellCommand);
      String rcFilePath=findRCFile(shellName);
      if (rcFilePath != null && shellIntegration) {
        if (shellName.equals("bash") || (SystemInfo.isMac && shellName.equals("sh"))) {
          addRcFileArgument(envs,command,result,rcFilePath,"--rcfile");
        }
 else         if (shellName.equals("zsh")) {
          envs.put("ZDOTDIR",new File(rcFilePath).getParent());
        }
      }
      if (!loginOrInteractive(command)) {
        if (hasLoginArgument(shellName) && SystemInfo.isMac) {
          result.add("--login");
        }
        result.add("-i");
      }
      result.addAll(command);
      return ArrayUtil.toStringArray(result);
    }
 else {
      return ArrayUtil.toStringArray(command);
    }
  }
 else {
    return new String[]{shellPath};
  }
}
