{
  Map<String,String> envs=new HashMap<>(System.getenv());
  if (!SystemInfo.isWindows) {
    envs.put("TERM","xterm-256color");
  }
  EncodingEnvironmentUtil.setLocaleEnvironmentIfMac(envs,myDefaultCharset);
  for (  LocalTerminalCustomizer customizer : LocalTerminalCustomizer.EP_NAME.getExtensions()) {
    customizer.setupEnvironment(myProject,envs);
    if (directory == null) {
      directory=customizer.getDefaultFolder();
    }
  }
  try {
    return PtyProcess.exec(getCommand(),envs,directory != null ? directory : currentProjectFolder());
  }
 catch (  IOException e) {
    throw new ExecutionException(e);
  }
}
