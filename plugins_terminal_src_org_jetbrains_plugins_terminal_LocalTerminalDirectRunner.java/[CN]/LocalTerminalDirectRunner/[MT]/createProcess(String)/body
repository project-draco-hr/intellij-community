{
  Map<String,String> envs=new HashMap<>(System.getenv());
  if (!SystemInfo.isWindows) {
    envs.put("TERM","xterm-256color");
  }
  EncodingEnvironmentUtil.setLocaleEnvironmentIfMac(envs,myDefaultCharset);
  String[] command=getCommand();
  for (  LocalTerminalCustomizer customizer : LocalTerminalCustomizer.EP_NAME.getExtensions()) {
    try {
      command=customizer.customizeCommandAndEnvironment(myProject,command,envs);
      if (directory == null) {
        directory=customizer.getDefaultFolder();
      }
    }
 catch (    Exception e) {
      LOG.error("Exception during customization of the terminal session",e);
    }
  }
  try {
    return PtyProcess.exec(command,envs,directory != null ? directory : currentProjectFolder());
  }
 catch (  IOException e) {
    throw new ExecutionException(e);
  }
}
