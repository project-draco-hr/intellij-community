{
switch (type) {
case RecordType.END_REQUEST:
    int appStatus=buffer.readInt();
  int protocolStatus=buffer.readUnsignedByte();
if (appStatus != 0 || protocolStatus != ProtocolStatus.REQUEST_COMPLETE.ordinal()) {
  LOG.warn("Protocol status " + protocolStatus);
  dataBuffers.remove(id);
  responseHandler.responseReceived(id,null);
}
 else if (protocolStatus == ProtocolStatus.REQUEST_COMPLETE.ordinal()) {
  responseHandler.responseReceived(id,dataBuffers.remove(id));
}
break;
case RecordType.STDOUT:
ByteBuf data=dataBuffers.get(id);
ByteBuf sliced=isCumulateBuffer ? buffer : buffer.slice(buffer.readerIndex(),contentLength);
if (data == null) {
dataBuffers.put(id,sliced);
}
 else if (data instanceof CompositeByteBuf) {
((CompositeByteBuf)data).addComponent(sliced);
data.writerIndex(data.writerIndex() + sliced.readableBytes());
}
 else {
if (sliced instanceof CompositeByteBuf) {
data=((CompositeByteBuf)sliced).addComponent(0,data);
data.writerIndex(data.writerIndex() + data.readableBytes());
}
 else {
data=context.alloc().compositeBuffer(DEFAULT_MAX_COMPOSITE_BUFFER_COMPONENTS).addComponents(data,sliced);
data.writerIndex(data.writerIndex() + data.readableBytes() + sliced.readableBytes());
}
dataBuffers.put(id,data);
}
sliced.retain();
break;
case RecordType.STDERR:
try {
errorOutputConsumer.consume(buffer.toString(buffer.readerIndex(),contentLength,CharsetUtil.UTF_8));
}
 catch (Throwable e) {
LOG.error(e);
}
break;
default :
LOG.error("Unknown type " + type);
break;
}
return null;
}
