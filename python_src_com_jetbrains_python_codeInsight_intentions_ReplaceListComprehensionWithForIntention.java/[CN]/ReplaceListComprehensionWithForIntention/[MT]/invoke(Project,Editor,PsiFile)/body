{
  PyListCompExpression expression=PsiTreeUtil.getTopmostParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PyListCompExpression.class);
  if (expression == null) {
    return;
  }
  PsiElement parent=expression.getParent();
  PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  if (parent instanceof PyAssignmentStatement) {
    PsiElement leftExpr=((PyAssignmentStatement)parent).getLeftHandSideExpression();
    PyAssignmentStatement initAssignment=elementGenerator.createFromText(LanguageLevel.forElement(expression),PyAssignmentStatement.class,leftExpr.getText() + " = []");
    PyStatement result=elementGenerator.createFromText(LanguageLevel.forElement(expression),PyStatement.class,leftExpr.getText() + ".append(" + getResult(expression).getText()+ ")");
    PyForStatement forStatement=createForLoop(expression,elementGenerator,result);
    PyStatementList stList=new PyStatementListImpl(initAssignment.getNode());
    stList.add(initAssignment);
    stList.add(forStatement);
    stList.getStatements()[0].delete();
    parent.replace(stList);
  }
 else   if (parent instanceof PyPrintStatement) {
    PyStatement result=elementGenerator.createFromText(LanguageLevel.forElement(expression),PyStatement.class,"print " + "(" + getResult(expression).getText() + ")");
    PyForStatement forStatement=createForLoop(expression,elementGenerator,result);
    parent.replace(forStatement);
  }
}
