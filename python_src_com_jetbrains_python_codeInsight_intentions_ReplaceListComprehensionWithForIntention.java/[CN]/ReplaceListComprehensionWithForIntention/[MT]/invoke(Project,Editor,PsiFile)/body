{
  PyListCompExpression expression=PsiTreeUtil.getTopmostParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PyListCompExpression.class);
  if (expression == null) {
    return;
  }
  PsiElement parent=expression.getParent();
  PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  if (parent instanceof PyAssignmentStatement) {
    final PsiElement leftExpr=((PyAssignmentStatement)parent).getLeftHandSideExpression();
    if (leftExpr == null)     return;
    PyAssignmentStatement initAssignment=elementGenerator.createFromText(LanguageLevel.forElement(expression),PyAssignmentStatement.class,leftExpr.getText() + " = []");
    PyForStatement forStatement=createForLoop(expression,elementGenerator,leftExpr.getText() + ".append(" + expression.getResultExpression().getText()+ ")");
    PyStatementList stList=new PyStatementListImpl(initAssignment.getNode());
    stList.add(initAssignment);
    stList.add(forStatement);
    stList.getStatements()[0].delete();
    parent.replace(stList);
  }
 else   if (parent instanceof PyPrintStatement) {
    PyForStatement forStatement=createForLoop(expression,elementGenerator,"print " + "(" + expression.getResultExpression().getText() + ")");
    parent.replace(forStatement);
  }
}
