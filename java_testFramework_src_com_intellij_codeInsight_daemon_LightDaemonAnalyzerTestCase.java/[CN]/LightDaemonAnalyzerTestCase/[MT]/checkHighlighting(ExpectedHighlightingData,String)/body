{
  data.init();
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  getFile().getText();
  myJavaFilesFilter.allowTreeAccessForFile(getVFile());
  PsiManagerEx.getInstanceEx(getProject()).setAssertOnFileLoadingFilter(myJavaFilesFilter,myTestRootDisposable);
  try {
    Collection<HighlightInfo> infos=doHighlighting();
    data.checkResult(infos,getEditor().getDocument().getText(),filePath);
  }
  finally {
    PsiManagerEx.getInstanceEx(getProject()).setAssertOnFileLoadingFilter(VirtualFileFilter.NONE,myTestRootDisposable);
  }
}
