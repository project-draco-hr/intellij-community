{
  if (PATCH_PATH.length() == 0) {
    VcsApplicationSettings settings=VcsApplicationSettings.getInstance();
    PATCH_PATH=settings.PATCH_STORAGE_LOCATION;
    if (PATCH_PATH == null) {
      PATCH_PATH=myProject.getBaseDir() == null ? PathManager.getHomePath() : myProject.getBaseDir().getPresentableUrl();
    }
  }
  myPanel.setFileName(ShelveChangesManager.suggestPatchName(myProject,commitMessage,new File(PATCH_PATH),null));
  myPanel.setReversePatch(false);
  myPanel.setChanges(ContainerUtil.filter(changes,new Condition<Change>(){
    @Override public boolean value(    Change change){
      return change.getBeforeRevision() != null && change.getAfterRevision() != null;
    }
  }
));
  myPanel.showTextStoreOption();
  JComponent panel=myPanel.getPanel();
  panel.putClientProperty(SessionDialog.VCS_CONFIGURATION_UI_TITLE,"Patch File Settings");
  return panel;
}
