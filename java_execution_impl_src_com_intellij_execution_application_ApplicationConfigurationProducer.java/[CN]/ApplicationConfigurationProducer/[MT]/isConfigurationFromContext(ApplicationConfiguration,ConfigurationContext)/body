{
  final PsiElement location=context.getPsiLocation();
  final PsiClass aClass=ApplicationConfigurationType.getMainClass(location);
  if (aClass != null && Comparing.equal(JavaExecutionUtil.getRuntimeQualifiedName(aClass),appConfiguration.MAIN_CLASS_NAME)) {
    final PsiMethod method=PsiTreeUtil.getParentOfType(location,PsiMethod.class,false);
    if (method != null && TestFrameworks.getInstance().isTestMethod(method)) {
      return false;
    }
    final VirtualFile scratchFile=JavaScratchRunConfigurationExtension.getScratchVirtualFile(appConfiguration);
    if (scratchFile != null) {
      final PsiFile containingFile=aClass.getContainingFile();
      if (containingFile != null && scratchFile.equals(containingFile.getVirtualFile())) {
        return true;
      }
    }
    final Module configurationModule=appConfiguration.getConfigurationModule().getModule();
    if (Comparing.equal(context.getModule(),configurationModule))     return true;
    ApplicationConfiguration template=(ApplicationConfiguration)context.getRunManager().getConfigurationTemplate(getConfigurationFactory()).getConfiguration();
    final Module predefinedModule=template.getConfigurationModule().getModule();
    if (Comparing.equal(predefinedModule,configurationModule)) {
      return true;
    }
  }
  return false;
}
