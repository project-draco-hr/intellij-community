{
  LOG.assertTrue(!properties.isEmpty());
  final List<IProperty> propertiesWithoutAnchor=new SmartList<IProperty>();
  PropertyAnchor representativeAnchor=null;
  for (  IProperty property : properties) {
    final PropertyAnchor anchor=myAnchors.get(property);
    if (anchor == null) {
      propertiesWithoutAnchor.add(property);
    }
 else {
      if (representativeAnchor != null) {
        LOG.assertTrue(representativeAnchor == anchor);
      }
      representativeAnchor=anchor;
    }
  }
  if (representativeAnchor == null) {
    LOG.assertTrue(propertiesWithoutAnchor.size() == properties.size());
    representativeAnchor=new PropertyAnchor(properties);
  }
 else {
    representativeAnchor.addProperties(propertiesWithoutAnchor);
  }
  for (  IProperty property : propertiesWithoutAnchor) {
    myAnchors.put(property,representativeAnchor);
  }
  return representativeAnchor;
}
