{
  enableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
  final VcsDirtyScopeManagerImpl vcsDirtyScopeManager=(VcsDirtyScopeManagerImpl)VcsDirtyScopeManager.getInstance(myProject);
  final VirtualFile file=createFileInCommand("a.txt","old content");
  final VirtualFile fileB=createFileInCommand("b.txt","old content");
  final VirtualFile fileC=createFileInCommand("c.txt","old content");
  final VirtualFile fileD=createFileInCommand("d.txt","old content");
  final List<FilePath> list=ObjectsConvertor.vf2fp(Arrays.asList(file,fileB,fileC,fileD));
  vcsDirtyScopeManager.retrieveScopes();
  vcsDirtyScopeManager.changesProcessed();
  vcsDirtyScopeManager.fileDirty(file);
  vcsDirtyScopeManager.fileDirty(fileB);
  final Collection<FilePath> dirty1=vcsDirtyScopeManager.whatFilesDirty(list);
  Assert.assertTrue(dirty1.contains(VcsUtil.getFilePath(file)));
  Assert.assertTrue(dirty1.contains(VcsUtil.getFilePath(fileB)));
  Assert.assertTrue(!dirty1.contains(VcsUtil.getFilePath(fileC)));
  Assert.assertTrue(!dirty1.contains(VcsUtil.getFilePath(fileD)));
  vcsDirtyScopeManager.retrieveScopes();
  final Collection<FilePath> dirty2=vcsDirtyScopeManager.whatFilesDirty(list);
  Assert.assertTrue(dirty2.contains(VcsUtil.getFilePath(file)));
  Assert.assertTrue(dirty2.contains(VcsUtil.getFilePath(fileB)));
  Assert.assertTrue(!dirty2.contains(VcsUtil.getFilePath(fileC)));
  Assert.assertTrue(!dirty2.contains(VcsUtil.getFilePath(fileD)));
  vcsDirtyScopeManager.changesProcessed();
  final Collection<FilePath> dirty3=vcsDirtyScopeManager.whatFilesDirty(list);
  Assert.assertTrue(!dirty3.contains(VcsUtil.getFilePath(file)));
  Assert.assertTrue(!dirty3.contains(VcsUtil.getFilePath(fileB)));
  Assert.assertTrue(!dirty3.contains(VcsUtil.getFilePath(fileC)));
  Assert.assertTrue(!dirty3.contains(VcsUtil.getFilePath(fileD)));
}
