{
  File xmlFile;
  final XmlSuite xmlSuite=new XmlSuite();
  xmlSuite.setParameters(testParams);
  XmlTest xmlTest=new XmlTest(xmlSuite);
  xmlTest.setName(name);
  List<XmlClass> xmlClasses=new ArrayList<XmlClass>();
  int idx=0;
  for (  String className : map.keySet()) {
    final XmlClass xmlClass=new XmlClass(className,idx++,false);
    final Map<String,List<String>> collection=map.get(className);
    if (collection != null) {
      final ArrayList<XmlInclude> includedMethods=new ArrayList<XmlInclude>();
      int mIdx=0;
      for (      String methodName : collection.keySet()) {
        final List<Integer> includes=new ArrayList<Integer>();
        for (        String include : collection.get(methodName)) {
          try {
            includes.add(Integer.parseInt(include));
          }
 catch (          NumberFormatException e) {
            logger.log(e);
          }
        }
        includedMethods.add(new XmlInclude(methodName,includes,mIdx++));
      }
      xmlClass.setIncludedMethods(includedMethods);
    }
    xmlClasses.add(xmlClass);
  }
  xmlTest.setXmlClasses(xmlClasses);
  xmlFile=new File(rootPath,"temp-testng-customsuite.xml");
  final String toXml=xmlSuite.toXml();
  writeToFile(logger,xmlFile,toXml);
  return xmlFile;
}
