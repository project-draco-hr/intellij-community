{
  DomainObjectSet<? extends IdeaModule> ideaModules=allModels.getIdeaProject().getModules();
  List<BuildScriptClasspathModel> ideaModule=ContainerUtil.mapNotNull(ideaModules,new Function<IdeaModule,BuildScriptClasspathModel>(){
    @Override public BuildScriptClasspathModel fun(    IdeaModule module){
      BuildScriptClasspathModel classpathModel=allModels.getExtraProject(module,BuildScriptClasspathModel.class);
      if (module.getName().equals("moduleWithAdditionalClasspath")) {
        assertNotNull(classpathModel);
        assertEquals(1,classpathModel.getClasspath().size());
        ClasspathEntryModel classpathEntry=classpathModel.getClasspath().getAt(0);
        assertEquals("someDep.jar",new File(classpathEntry.getClasses().iterator().next()).getName());
      }
 else       if (module.getName().equals("baseModule") || module.getName().equals("moduleWithInheritedClasspath")) {
        assertNotNull("Null build classpath for module: " + module.getName(),classpathModel);
        assertEquals("Wrong build classpath for module: " + module.getName(),1,classpathModel.getClasspath().size());
        ClasspathEntryModel classpathEntry=classpathModel.getClasspath().getAt(0);
        assertEquals("Wrong build classpath for module: " + module.getName(),"inheritedDep.jar",new File(classpathEntry.getClasses().iterator().next()).getName());
      }
 else       if (module.getName().equals("moduleWithoutAdditionalClasspath") || module.getName().equals("testModelBuildScriptClasspathBuilder")) {
        assertNotNull("Wrong build classpath for module: " + module.getName(),classpathModel);
        assertTrue("Wrong build classpath for module: " + module.getName(),classpathModel.getClasspath().isEmpty());
      }
 else {
        fail("Unexpected module found: " + module.getName());
      }
      return classpathModel;
    }
  }
);
  assertEquals(5,ideaModule.size());
}
