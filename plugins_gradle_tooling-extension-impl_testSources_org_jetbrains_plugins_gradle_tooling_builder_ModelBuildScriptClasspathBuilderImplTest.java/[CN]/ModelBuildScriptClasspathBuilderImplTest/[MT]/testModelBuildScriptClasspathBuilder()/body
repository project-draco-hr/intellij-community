{
  DomainObjectSet<? extends IdeaModule> ideaModules=allModels.getIdeaProject().getModules();
  List<BuildScriptClasspathModel> ideaModule=ContainerUtil.mapNotNull(ideaModules,new Function<IdeaModule,BuildScriptClasspathModel>(){
    @Override public BuildScriptClasspathModel fun(    IdeaModule module){
      BuildScriptClasspathModel classpathModel=allModels.getExtraProject(module,BuildScriptClasspathModel.class);
      if (module.getName().equals("moduleWithAdditionalClasspath")) {
        assertNotNull(classpathModel);
        assertEquals(3,classpathModel.getClasspath().size());
        assertEquals("junit-4.12.jar",new File(classpathModel.getClasspath().getAt(0).getClasses().iterator().next()).getName());
        assertEquals("hamcrest-core-1.3.jar",new File(classpathModel.getClasspath().getAt(1).getClasses().iterator().next()).getName());
        assertEquals("someDep.jar",new File(classpathModel.getClasspath().getAt(2).getClasses().iterator().next()).getName());
      }
 else       if (module.getName().equals("baseModule") || module.getName().equals("moduleWithInheritedClasspath")) {
        assertNotNull("Null build classpath for module: " + module.getName(),classpathModel);
        assertEquals("Wrong build classpath for module: " + module.getName(),3,classpathModel.getClasspath().size());
        assertEquals("Wrong build classpath for module: " + module.getName(),"junit-4.12.jar",new File(classpathModel.getClasspath().getAt(0).getClasses().iterator().next()).getName());
        assertEquals("Wrong build classpath for module: " + module.getName(),"hamcrest-core-1.3.jar",new File(classpathModel.getClasspath().getAt(1).getClasses().iterator().next()).getName());
        assertEquals("Wrong build classpath for module: " + module.getName(),"inheritedDep.jar",new File(classpathModel.getClasspath().getAt(2).getClasses().iterator().next()).getName());
      }
 else       if (module.getName().equals("moduleWithoutAdditionalClasspath") || module.getName().equals("testModelBuildScriptClasspathBuilder")) {
        assertNotNull("Wrong build classpath for module: " + module.getName(),classpathModel);
        assertEquals("Wrong build classpath for module: " + module.getName(),2,classpathModel.getClasspath().size());
      }
 else {
        fail("Unexpected module found: " + module.getName());
      }
      return classpathModel;
    }
  }
);
  assertEquals(5,ideaModule.size());
}
