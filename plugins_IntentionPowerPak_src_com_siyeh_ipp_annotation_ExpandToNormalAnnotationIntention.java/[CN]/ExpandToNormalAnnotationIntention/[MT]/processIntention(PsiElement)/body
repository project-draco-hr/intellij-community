{
  final PsiNameValuePair attribute=(PsiNameValuePair)element;
  final int textOffset=attribute.getTextOffset();
  final Project project=attribute.getProject();
  final String text=buildReplacementText(attribute);
  final PsiElementFactory factory=JavaPsiFacade.getElementFactory(project);
  final PsiAnnotation newAnnotation=factory.createAnnotationFromText("@A(" + text + " )",attribute);
  final PsiAnnotationParameterList parent=(PsiAnnotationParameterList)attribute.getParent();
  for (PsiElement child=parent.getFirstChild(); child != null; child=child.getNextSibling()) {
    if (child instanceof PsiErrorElement) {
      child.delete();
      break;
    }
  }
  attribute.replace(newAnnotation.getParameterList().getAttributes()[0]);
  final FileEditorManager editorManager=FileEditorManager.getInstance(project);
  final Editor editor=editorManager.getSelectedTextEditor();
  if (editor == null) {
    return;
  }
  final CaretModel caretModel=editor.getCaretModel();
  caretModel.moveToOffset(textOffset + text.length() - 1);
}
