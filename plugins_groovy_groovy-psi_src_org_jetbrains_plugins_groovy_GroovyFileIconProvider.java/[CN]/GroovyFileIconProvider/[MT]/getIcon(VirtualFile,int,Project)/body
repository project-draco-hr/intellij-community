{
  if (project == null || virtualFile.getFileType() != GroovyFileType.GROOVY_FILE_TYPE)   return null;
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(virtualFile);
  if (!(psiFile instanceof GroovyFile))   return null;
  final GroovyFile file=(GroovyFile)psiFile;
  final Icon icon;
  if (GrFileIndexUtil.isGroovySourceFile(file)) {
    if (file.isScript()) {
      icon=GroovyScriptTypeDetector.getIcon(file);
    }
 else {
      final GrTypeDefinition[] typeDefinitions=file.getTypeDefinitions();
      icon=typeDefinitions.length > 0 ? typeDefinitions[0].getIcon(flags) : JetgroovyIcons.Groovy.Groovy_16x16;
    }
  }
 else {
    icon=JetgroovyIcons.Groovy.Groovy_outsideSources;
  }
  return ElementBase.createLayeredIcon(psiFile,icon,ElementBase.transformFlags(psiFile,flags));
}
