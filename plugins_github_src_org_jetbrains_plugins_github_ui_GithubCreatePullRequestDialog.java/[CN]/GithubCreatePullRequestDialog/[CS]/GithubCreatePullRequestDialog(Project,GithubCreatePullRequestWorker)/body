{
  super(project,true);
  myWorker=worker;
  myProjectSettings=GithubProjectSettings.getInstance(project);
  myPanel=new GithubCreatePullRequestPanel();
  myPanel.getShowDiffButton().addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      myWorker.showDiffDialog(myPanel.getSelectedBranch());
    }
  }
);
  myPanel.getSelectForkButton().addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      ForkInfo fork=myWorker.showTargetDialog();
      if (fork != null) {
        myPanel.setForks(myWorker.getForks());
        myPanel.setSelectedFork(fork.getPath());
      }
    }
  }
);
  myPanel.getForkComboBox().addItemListener(new ItemListener(){
    @Override public void itemStateChanged(    ItemEvent e){
      if (e.getStateChange() == ItemEvent.DESELECTED) {
        myPanel.setBranches(Collections.<BranchInfo>emptyList());
      }
      if (e.getStateChange() == ItemEvent.SELECTED) {
        final ForkInfo fork=(ForkInfo)e.getItem();
        if (fork == null)         return;
        myPanel.setBranches(fork.getBranches());
        myPanel.setSelectedBranch(fork.getDefaultBranch());
        if (fork.getRemoteName() == null && !fork.isProposedToCreateRemote()) {
          fork.setProposedToCreateRemote(true);
          boolean createRemote=false;
switch (GithubSettings.getInstance().getCreatePullRequestCreateRemote()) {
case YES:
            createRemote=true;
          break;
case NO:
        createRemote=false;
      break;
case UNSURE:
    createRemote=GithubNotifications.showYesNoDialog(project,"Can't Find Remote","Configure remote for '" + fork.getPath().getUser() + "'?",ourDoNotAskOption);
  break;
}
if (createRemote) {
myWorker.configureRemote(fork);
}
}
if (fork.getRemoteName() == null) {
myPanel.setDiffEnabled(false);
}
 else {
myPanel.setDiffEnabled(true);
myWorker.launchFetchRemote(fork);
}
}
}
}
);
myPanel.getBranchComboBox().addItemListener(new ItemListener(){
@Override public void itemStateChanged(ItemEvent e){
if (e.getStateChange() == ItemEvent.SELECTED) {
BranchInfo branch=(BranchInfo)e.getItem();
if (branch == null) return;
if (branch.getForkInfo().getRemoteName() != null) {
if (branch.getDiffInfoTask() != null && branch.getDiffInfoTask().isDone() && branch.getDiffInfoTask().safeGet() == null) {
myPanel.setDiffEnabled(false);
}
 else {
myPanel.setDiffEnabled(true);
}
}
if (myPanel.isTitleDescriptionEmptyOrNotModified()) {
Pair<String,String> description=myWorker.getDefaultDescriptionMessage(branch);
myPanel.setTitle(description.getFirst());
myPanel.setDescription(description.getSecond());
}
myWorker.launchLoadDiffInfo(branch);
}
}
}
);
myPanel.setForks(myWorker.getForks());
GithubFullPath defaultRepo=myProjectSettings.getCreatePullRequestDefaultRepo();
String defaultBranch=myProjectSettings.getCreatePullRequestDefaultBranch();
myPanel.setSelectedFork(defaultRepo);
if (defaultBranch != null) {
myPanel.setSelectedBranch(defaultBranch);
}
setTitle("Create Pull Request - " + myWorker.getCurrentBranch());
init();
}
