{
  StringBuilder result=new StringBuilder("");
  int start=0;
  boolean isExpression=false;
  for (int i=0; i < s.length(); i++) {
    char c=s.charAt(i);
    if (c == '$') {
      String token=s.substring(start,i);
      if (isExpression) {
        if (HEADER_TOKEN_PAGE.equals(token)) {
          result.append(myPageIndex + 1);
        }
 else         if (HEADER_TOKEN_TOTALPAGES.equals(token)) {
          result.append(myNumberOfPages);
        }
 else         if (HEADER_TOKEN_FILE.equals(token)) {
          result.append(myFullFileName);
        }
 else         if (HEADER_TOKEN_FILENAME.equals(token)) {
          result.append(myShortFileName);
        }
 else         if (HEADER_TOKEN_DATE.equals(token)) {
          result.append(myPrintDate);
        }
 else         if (HEADER_TOKEN_TIME.equals(token)) {
          result.append(myPrintTime);
        }
      }
 else {
        result.append(token);
      }
      isExpression=!isExpression;
      start=i + 1;
    }
  }
  if (!isExpression && start < s.length()) {
    result.append(s.substring(start,s.length()));
  }
  return result.toString();
}
