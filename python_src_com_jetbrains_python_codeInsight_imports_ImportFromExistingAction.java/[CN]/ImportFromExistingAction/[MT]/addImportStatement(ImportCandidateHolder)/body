{
  final Project project=myTarget.getProject();
  final PyElementGenerator gen=PyElementGenerator.getInstance(project);
  AddImportHelper.ImportPriority priority=AddImportHelper.getImportPriority(myTarget,item.getFile());
  PsiFile file=myTarget.getContainingFile();
  InjectedLanguageManager manager=InjectedLanguageManager.getInstance(project);
  if (manager.isInjectedFragment(file)) {
    file=manager.getTopLevelFile(myTarget);
  }
  if (isRoot(item.getFile())) {
    if (myImportLocally) {
      AddImportHelper.addLocalImportStatement(myTarget,myName);
    }
 else {
      AddImportHelper.addImportStatement(file,myName,item.getAsName(),priority,null);
    }
  }
 else {
    final QualifiedName path=item.getPath();
    final String qualifiedName=path != null ? path.toString() : "";
    if (myUseQualifiedImport) {
      String nameToImport=qualifiedName;
      if (item.getImportable() instanceof PsiFileSystemItem) {
        nameToImport+="." + myName;
      }
      if (myImportLocally) {
        AddImportHelper.addLocalImportStatement(myTarget,nameToImport);
      }
 else {
        AddImportHelper.addImportStatement(file,nameToImport,item.getAsName(),priority,null);
      }
      myTarget.replace(gen.createExpressionFromText(LanguageLevel.forElement(myTarget),qualifiedName + "." + myName));
    }
 else {
      if (myImportLocally) {
        AddImportHelper.addLocalFromImportStatement(myTarget,qualifiedName,myName);
      }
 else {
        AddImportHelper.addFromImportStatement(file,qualifiedName,myName,item.getAsName(),priority,null);
      }
    }
  }
}
