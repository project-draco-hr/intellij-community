{
  String name=getTestName(true);
  configureByFile(getBasePath() + name + getExtension());
  final boolean enabled=getEditor().getSettings().isVariableInplaceRenameEnabled();
  try {
    TemplateManagerImpl.setTemplateTesting(getProject(),getTestRootDisposable());
    getEditor().getSettings().setVariableInplaceRenameEnabled(true);
    invokeRefactoring();
    ReassignVariableUtil.reassign(getEditor());
    assertNull(TemplateManagerImpl.getTemplateState(getEditor()));
    checkResultByFile(getBasePath() + name + "_after"+ getExtension());
  }
  finally {
    getEditor().getSettings().setVariableInplaceRenameEnabled(enabled);
  }
}
