{
  String name=getTestName(true);
  configureByFile(getBasePath() + name + getExtension());
  final boolean enabled=getEditor().getSettings().isVariableInplaceRenameEnabled();
  try {
    TemplateManagerImpl.setTemplateTesting(getProject(),getTestRootDisposable());
    getEditor().getSettings().setVariableInplaceRenameEnabled(true);
    invokeRefactoring();
    ReassignVariableUtil.reassign(getEditor());
    assertNull(TemplateManagerImpl.getTemplateState(getEditor()));
    TextEditor textEditor=TextEditorProvider.getInstance().getTextEditor(getEditor());
    assertNotNull(textEditor);
    UndoManager.getInstance(getProject()).undo(textEditor);
    checkResultByFile(getBasePath() + name + getExtension());
  }
  finally {
    getEditor().getSettings().setVariableInplaceRenameEnabled(enabled);
  }
}
