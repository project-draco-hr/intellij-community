{
  for (  PsiExpression expr : collectExpressions(expression,PsiMember.class,PsiFile.class)) {
    PsiElement parent=expr.getParent();
    if (!(parent instanceof PsiReferenceExpression)) {
      ExpectedTypeInfo[] someExpectedTypes=ExpectedTypesProvider.getExpectedTypes(expr,PsiUtil.skipParenthesizedExprUp(parent) instanceof PsiExpressionList);
      if (someExpectedTypes.length > 0) {
        Arrays.sort(someExpectedTypes,new Comparator<ExpectedTypeInfo>(){
          @Override public int compare(          ExpectedTypeInfo o1,          ExpectedTypeInfo o2){
            return compareExpectedTypes(o1,o2,expression);
          }
        }
);
        types.add(someExpectedTypes);
      }
      continue;
    }
    String refName=((PsiReferenceExpression)parent).getReferenceName();
    if (refName == null) {
      continue;
    }
    PsiElement pparent=parent.getParent();
    if (pparent instanceof PsiMethodCallExpression) {
      expectedMethodNames.add(refName);
      if (refName.equals("equals")) {
        ExpectedTypeInfo[] someExpectedTypes=equalsExpectedTypes((PsiMethodCallExpression)pparent);
        if (someExpectedTypes.length > 0) {
          Arrays.sort(someExpectedTypes,new Comparator<ExpectedTypeInfo>(){
            @Override public int compare(            ExpectedTypeInfo o1,            ExpectedTypeInfo o2){
              return compareExpectedTypes(o1,o2,expression);
            }
          }
);
          types.add(someExpectedTypes);
        }
      }
      continue;
    }
    if (pparent instanceof PsiReferenceExpression || pparent instanceof PsiVariable || pparent instanceof PsiExpression) {
      expectedFieldNames.add(refName);
    }
  }
}
