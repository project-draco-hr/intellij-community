{
  Module module=model.getModule();
  String oldStorageType=ClassPathStorageUtil.getStorageType(module);
  if (oldStorageType.equals(storageId)) {
    return;
  }
  ClasspathStorageProvider provider=getProvider(oldStorageType);
  if (provider != null) {
    provider.detach(module);
  }
  provider=getProvider(storageId);
  if (provider == null) {
    module.clearOption(JpsProjectLoader.CLASSPATH_ATTRIBUTE);
    module.clearOption(JpsProjectLoader.CLASSPATH_DIR_ATTRIBUTE);
  }
 else {
    module.setOption(JpsProjectLoader.CLASSPATH_ATTRIBUTE,storageId);
    String root=provider.getContentRoot(model);
    if (root == null) {
      module.clearOption(JpsProjectLoader.CLASSPATH_DIR_ATTRIBUTE);
    }
 else {
      module.setOption(JpsProjectLoader.CLASSPATH_DIR_ATTRIBUTE,root);
    }
  }
}
