{
  FeatureUsageTracker.getInstance().triggerFeatureUsed("codeassists.liveTemplates");
  final LookupElement item=event.getItem();
  final Lookup lookup=event.getLookup();
  final Project project=lookup.getProject();
  if (item instanceof LiveTemplateLookupElementImpl) {
    final TemplateImpl template=((LiveTemplateLookupElementImpl)item).getTemplate();
    final String argument=myTemplate2Argument != null ? myTemplate2Argument.get(template) : null;
    new WriteCommandAction(project){
      @Override protected void run(      @NotNull Result result) throws Throwable {
        ((TemplateManagerImpl)TemplateManager.getInstance(project)).startTemplateWithPrefix(lookup.getEditor(),template,null,argument);
      }
    }
.execute();
  }
 else   if (item instanceof CustomLiveTemplateLookupElement) {
    if (myFile != null) {
      new WriteCommandAction(project){
        @Override protected void run(        @NotNull Result result) throws Throwable {
          ((CustomLiveTemplateLookupElement)item).expandTemplate(lookup.getEditor(),myFile);
        }
      }
.execute();
    }
  }
}
