{
  if (myTestConfigurator.shouldTakeScreenshotOnFailure()) {
    Method method=myTestMethod.getMethod();
    String fileNamePrefix=method.getDeclaringClass().getSimpleName() + "." + (executionIndex + 1)+ "."+ method.getName();
    String extension=".png";
    try {
      File rootDir=IdeTestApplication.getFailedTestScreenshotDirPath();
      File screenshotFilePath=new File(rootDir,fileNamePrefix + extension);
      if (screenshotFilePath.isFile()) {
        SimpleDateFormat format=new SimpleDateFormat("MM-dd-yyyy.HH:mm:ss");
        String now=format.format(new GregorianCalendar().getTime());
        screenshotFilePath=new File(rootDir,fileNamePrefix + "." + now+ extension);
      }
      myScreenshotTaker.saveDesktopAsPng(screenshotFilePath.getPath());
      System.out.println("Screenshot of failed test taken and stored at " + screenshotFilePath.getPath());
    }
 catch (    Throwable ignored) {
      System.out.println("Failed to take screenshot. Cause: " + ignored.getMessage());
    }
  }
}
