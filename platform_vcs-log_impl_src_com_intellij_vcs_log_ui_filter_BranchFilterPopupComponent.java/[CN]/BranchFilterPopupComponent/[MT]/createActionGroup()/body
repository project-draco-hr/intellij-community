{
  DefaultActionGroup actionGroup=new DefaultActionGroup();
  actionGroup.add(createAllAction());
  Collection<VcsRef> allRefs=myUi.getLogDataHolder().getDataPack().getRefsModel().getBranches();
  for (  Map.Entry<VirtualFile,Collection<VcsRef>> entry : VcsLogUtil.groupRefsByRoot(allRefs).entrySet()) {
    VirtualFile root=entry.getKey();
    Collection<VcsRef> refs=entry.getValue();
    VcsLogProvider provider=myUi.getLogDataHolder().getLogProvider(root);
    VcsLogRefManager refManager=provider.getReferenceManager();
    List<RefGroup> groups=refManager.group(refs);
    for (    RefGroup group : groups) {
      if (group.getRefs().size() == 1) {
        actionGroup.add(new SetValueAction(group.getRefs().iterator().next().getName(),this));
      }
 else {
        DefaultActionGroup innerGroup=new DefaultActionGroup();
        for (        VcsRef ref : group.getRefs()) {
          innerGroup.add(new SetValueAction(ref.getName(),this));
        }
        actionGroup.add(innerGroup);
      }
    }
  }
  return actionGroup;
}
