{
  DefaultActionGroup actionGroup=new DefaultActionGroup();
  actionGroup.add(createAllAction());
  actionGroup.add(createSelectMultipleValuesAction());
  Groups filteredGroups=new Groups();
  Collection<VcsRef> allRefs=myRefsModel.getBranches();
  for (  Map.Entry<VirtualFile,Collection<VcsRef>> entry : VcsLogUtil.groupRefsByRoot(allRefs).entrySet()) {
    VirtualFile root=entry.getKey();
    Collection<VcsRef> refs=entry.getValue();
    VcsLogProvider provider=myDataHolder.getLogProvider(root);
    VcsLogRefManager refManager=provider.getReferenceManager();
    List<RefGroup> refGroups=refManager.group(refs);
    orderRefGroups(refGroups,filteredGroups);
  }
  actionGroup.add(getFilteredActionGroup(filteredGroups));
  return actionGroup;
}
