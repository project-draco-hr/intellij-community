{
  DefaultActionGroup actionGroup=new DefaultActionGroup();
  actionGroup.add(createAllAction());
  Collection<VcsRef> allRefs=myUi.getLogDataHolder().getDataPack().getRefsModel().getBranches();
  for (  Map.Entry<VirtualFile,Collection<VcsRef>> entry : VcsLogUtil.groupRefsByRoot(allRefs).entrySet()) {
    VirtualFile root=entry.getKey();
    Collection<VcsRef> refs=entry.getValue();
    VcsLogProvider provider=myUi.getLogDataHolder().getLogProvider(root);
    VcsLogRefManager refManager=provider.getReferenceManager();
    List<RefGroup> groups=refManager.group(refs);
    List<AnAction> orderedGroups=orderRefGroups(groups);
    actionGroup.addAll(orderedGroups);
  }
  return actionGroup;
}
