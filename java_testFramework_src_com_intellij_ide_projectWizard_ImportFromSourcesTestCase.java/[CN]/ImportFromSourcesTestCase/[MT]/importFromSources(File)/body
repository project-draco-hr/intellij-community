{
  myRootDir=dir;
  try {
    myProject=doCreateProject(getIprFile());
    myBuilder.setBaseProjectPath(dir.getAbsolutePath());
    List<DetectedRootData> list=RootDetectionProcessor.detectRoots(dir);
    MultiMap<ProjectStructureDetector,DetectedProjectRoot> map=RootDetectionProcessor.createRootsMap(list);
    myBuilder.setupProjectStructure(map);
    for (    ProjectStructureDetector detector : map.keySet()) {
      List<ModuleWizardStep> steps=detector.createWizardSteps(myBuilder,myBuilder.getProjectDescriptor(detector),EmptyIcon.ICON_16);
      for (      ModuleWizardStep step : steps) {
        if (step instanceof AbstractStepWithProgress<?>) {
          performStep((AbstractStepWithProgress<?>)step);
        }
      }
    }
    myBuilder.commit(myProject,null,ModulesProvider.EMPTY_MODULES_PROVIDER);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
