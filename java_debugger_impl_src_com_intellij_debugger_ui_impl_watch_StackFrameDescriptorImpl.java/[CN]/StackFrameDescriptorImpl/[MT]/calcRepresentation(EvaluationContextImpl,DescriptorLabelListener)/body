{
  DebuggerManagerThreadImpl.assertIsManagerThread();
  if (myXStackFrame != null) {
    TextTransferable.ColoredStringBuilder builder=new TextTransferable.ColoredStringBuilder();
    myXStackFrame.customizePresentation(builder);
    return builder.getBuilder().toString();
  }
  if (myLocation == null) {
    return "";
  }
  ThreadsViewSettings settings=ThreadsViewSettings.getInstance();
  final StringBuilder label=StringBuilderSpinAllocator.alloc();
  try {
    Method method=myMethodOccurrence.getMethod();
    if (method != null) {
      myName=method.name();
      label.append(myName);
      label.append("()");
    }
    if (settings.SHOW_LINE_NUMBER) {
      String lineNumber;
      try {
        lineNumber=Integer.toString(myLocation.lineNumber());
      }
 catch (      InternalError e) {
        lineNumber=e.toString();
      }
      if (lineNumber != null) {
        label.append(':');
        label.append(lineNumber);
      }
    }
    if (settings.SHOW_CLASS_NAME) {
      String name;
      try {
        ReferenceType refType=myLocation.declaringType();
        name=refType != null ? refType.name() : null;
      }
 catch (      InternalError e) {
        name=e.toString();
      }
      if (name != null) {
        label.append(", ");
        int dotIndex=name.lastIndexOf('.');
        if (dotIndex < 0) {
          label.append(name);
        }
 else {
          label.append(name.substring(dotIndex + 1));
          if (settings.SHOW_PACKAGE_NAME) {
            label.append(" {");
            label.append(name.substring(0,dotIndex));
            label.append("}");
          }
        }
      }
    }
    if (settings.SHOW_SOURCE_NAME) {
      try {
        String sourceName;
        try {
          sourceName=myLocation.sourceName();
        }
 catch (        InternalError e) {
          sourceName=e.toString();
        }
        label.append(", ");
        label.append(sourceName);
      }
 catch (      AbsentInformationException ignored) {
      }
    }
    return label.toString();
  }
  finally {
    StringBuilderSpinAllocator.dispose(label);
  }
}
