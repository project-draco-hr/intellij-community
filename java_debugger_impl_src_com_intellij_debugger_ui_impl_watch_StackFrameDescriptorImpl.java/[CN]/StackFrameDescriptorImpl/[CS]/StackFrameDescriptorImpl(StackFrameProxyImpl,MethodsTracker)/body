{
  myFrame=frame;
  try {
    myUiIndex=frame.getFrameIndex();
    myLocation=frame.location();
    try {
      myThisObject=frame.thisObject();
    }
 catch (    EvaluateException e) {
      if (!(e.getCause() instanceof InternalException)) {
        throw e;
      }
      LOG.info(e);
    }
    myMethodOccurrence=tracker.getMethodOccurrence(myUiIndex,myLocation.method());
    myIsSynthetic=DebuggerUtils.isSynthetic(myMethodOccurrence.getMethod());
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        mySourcePosition=ContextUtil.getSourcePosition(StackFrameDescriptorImpl.this);
        final PsiFile file=mySourcePosition != null ? mySourcePosition.getFile() : null;
        if (file == null) {
          myIsInLibraryContent=true;
        }
 else {
          myBackgroundColor=FileColorManager.getInstance(file.getProject()).getFileColor(file);
          final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(getDebugProcess().getProject()).getFileIndex();
          final VirtualFile vFile=file.getVirtualFile();
          myIsInLibraryContent=vFile != null && (projectFileIndex.isInLibraryClasses(vFile) || projectFileIndex.isInLibrarySource(vFile));
        }
      }
    }
);
  }
 catch (  InternalException e) {
    LOG.info(e);
    myLocation=null;
    myMethodOccurrence=tracker.getMethodOccurrence(0,null);
    myIsSynthetic=false;
    myIsInLibraryContent=false;
  }
catch (  EvaluateException e) {
    LOG.info(e);
    myLocation=null;
    myMethodOccurrence=tracker.getMethodOccurrence(0,null);
    myIsSynthetic=false;
    myIsInLibraryContent=false;
  }
  myXStackFrame=myLocation == null ? null : ((DebugProcessImpl)getDebugProcess()).getPositionManager().createStackFrame(frame,(DebugProcessImpl)getDebugProcess(),myLocation);
}
