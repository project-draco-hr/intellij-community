{
  Project project=e.getProject();
  if (project == null) {
    return;
  }
  final AnswerPlaceholder answerPlaceholder=getAnswerPlaceholder(e);
  if (answerPlaceholder == null) {
    return;
  }
  StudyEditor studyEditor=StudyUtils.getSelectedStudyEditor(project);
  final StudyState studyState=new StudyState(studyEditor);
  Document patternDocument=StudyUtils.getPatternDocument(answerPlaceholder.getTaskFile(),studyState.getVirtualFile().getName());
  if (patternDocument == null) {
    return;
  }
  AnswerPlaceholder.MyInitialState initialState=answerPlaceholder.getInitialState();
  int startOffset=patternDocument.getLineStartOffset(initialState.myLine) + initialState.myStart;
  final String text=patternDocument.getText(new TextRange(startOffset,startOffset + initialState.myLength));
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          Document document=studyState.getEditor().getDocument();
          int offset=answerPlaceholder.getRealStartOffset(document);
          document.deleteString(offset,offset + answerPlaceholder.getLength());
          document.insertString(offset,text);
        }
      }
);
    }
  }
,NAME,null);
}
