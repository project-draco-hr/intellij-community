{
  Document document=new DocumentImpl("line0\nline1\nline2");
  MarkupModelEx model=(MarkupModelEx)DocumentMarkupModel.forDocument(document,getProject(),true);
  RangeHighlighterEx highlighter=model.addPersistentLineHighlighter(2,0,null);
  new WriteCommandAction<Void>(getProject()){
    @Override protected void run(    @NotNull Result<Void> result) throws Throwable {
      document.deleteString(document.getLineStartOffset(1),document.getTextLength());
    }
  }
.execute();
  assertTrue(highlighter.isValid());
  assertEquals(6,highlighter.getStartOffset());
}
