{
  final Query<PsiReference> query=namedElement instanceof PsiMethod ? MethodReferencesSearch.search((PsiMethod)namedElement) : ReferencesSearch.search(namedElement);
  final Collection<PsiReference> refs=query.findAll();
  for (  PsiReference ref : refs) {
    PsiElement refElement=null;
    final PsiElement element=ref.getElement();
    if (element instanceof PsiReferenceExpression) {
      final PsiReferenceExpression refExpr=(PsiReferenceExpression)element;
      PsiElement parent=refExpr.getParent();
      if (parent instanceof PsiAssignmentExpression && refExpr.equals(((PsiAssignmentExpression)parent).getLExpression())) {
        refElement=((PsiAssignmentExpression)parent).getRExpression();
      }
 else {
        if (namedElement instanceof PsiParameter) {
          PsiElement gParent=refExpr.getParent().getParent();
          if (gParent instanceof PsiMethodCallExpression) {
            if (!canInvertReferenceElement(((PsiMethodCallExpression)gParent).getMethodExpression(),true)) {
              continue;
            }
          }
        }
        refElement=refExpr;
      }
    }
    if (refElement != null) {
      elementsToInvert.add(refElement);
    }
  }
  if (namedElement instanceof PsiVariable) {
    final PsiExpression initializer=((PsiVariable)namedElement).getInitializer();
    if (initializer != null) {
      elementsToInvert.add(initializer);
    }
  }
}
