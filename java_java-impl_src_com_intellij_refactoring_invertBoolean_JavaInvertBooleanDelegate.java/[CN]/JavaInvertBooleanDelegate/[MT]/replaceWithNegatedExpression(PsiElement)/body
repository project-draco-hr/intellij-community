{
  if (!(expression instanceof PsiExpression)) {
    return;
  }
  if (expression.getParent() instanceof PsiMethodCallExpression) {
    expression=expression.getParent();
  }
  while (expression.getParent() instanceof PsiPrefixExpression && ((PsiPrefixExpression)expression.getParent()).getOperationTokenType() == JavaTokenType.EXCL) {
    expression=expression.getParent();
  }
  if (expression instanceof PsiMethodReferenceExpression) {
    final PsiLambdaExpression lambdaExpression=LambdaRefactoringUtil.convertMethodReferenceToLambda((PsiMethodReferenceExpression)expression,false,true);
    final PsiExpression callExpression=LambdaUtil.extractSingleExpressionFromBody(lambdaExpression.getBody());
    if (callExpression instanceof PsiCallExpression) {
      callExpression.replace(CodeInsightServicesUtil.invertCondition(callExpression));
    }
  }
 else   if (!(expression.getParent() instanceof PsiExpressionStatement)) {
    expression.replace(CodeInsightServicesUtil.invertCondition((PsiExpression)expression));
  }
}
