{
  final List<T> wasSelected=getSelectedChanges();
  if (!myAlwaysExpandList && !myShowFlatten) {
    myNonFlatTreeState=TreeState.createOn(myTree,(DefaultMutableTreeNode)myTree.getModel().getRoot());
  }
  myShowFlatten=showFlatten;
  setChangesToDisplay(getChanges());
  setChildIndent(showFlatten && isCurrentModelFlat());
  myTree.setCellRenderer(myShowFlatten ? myShowFlattenNodeRenderer : myNodeRenderer);
  if (!myAlwaysExpandList && !myShowFlatten && myNonFlatTreeState != null) {
    myNonFlatTreeState.applyTo(myTree,(DefaultMutableTreeNode)myTree.getModel().getRoot());
  }
  select(wasSelected);
}
