{
  if (offset == -1) {
    Document document;
    AccessToken token=ReadAction.start();
    try {
      document=file.isValid() ? FileDocumentManager.getInstance().getDocument(file) : null;
    }
  finally {
      token.finish();
    }
    if (document == null) {
      return -1;
    }
    offset=line < document.getLineCount() ? document.getLineStartOffset(line) : -1;
  }
  return offset;
}
