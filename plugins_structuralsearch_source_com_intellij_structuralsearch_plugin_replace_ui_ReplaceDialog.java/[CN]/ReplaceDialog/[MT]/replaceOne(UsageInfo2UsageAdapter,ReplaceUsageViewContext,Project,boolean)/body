{
  ReplacementInfo replacementInfo=context.getUsage2ReplacementInfo().get(info);
  boolean approved;
  if (doConfirm) {
    ReplacementPreviewDialog wrapper=new ReplacementPreviewDialog(project,info.getUsageInfo(),replacementInfo.getReplacement());
    wrapper.show();
    approved=wrapper.isOK();
  }
 else {
    approved=true;
  }
  if (approved) {
    ensureFileWritable(info);
    context.getUsageView().removeUsage(info);
    context.getReplacer().replace(replacementInfo);
    if (context.getUsageView().getUsagesCount() == 0) {
      context.getUsageView().close();
    }
  }
}
