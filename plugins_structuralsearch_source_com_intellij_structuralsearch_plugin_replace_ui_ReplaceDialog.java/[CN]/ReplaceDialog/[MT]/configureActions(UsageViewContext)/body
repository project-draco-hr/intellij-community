{
  final ReplaceUsageViewContext replaceContext=(ReplaceUsageViewContext)context;
  final Runnable replaceRunnable=new Runnable(){
    public void run(){
      LocalVcs instance=LocalVcs.getInstance(searchContext.getProject());
      LocalHistoryAction lvcsAction=instance.startAction_New(getDefaultTitle(),null,false);
      doReplace(replaceContext);
      replaceContext.getUsageView().close();
      lvcsAction.finish();
    }
  }
;
  replaceContext.getUsageView().addPerformOperationAction(replaceRunnable,"Replace All",null,SSRBundle.message("do.replace.all.button"));
  final Runnable replaceSelected=new Runnable(){
    public void run(){
      final Set<Usage> infos=replaceContext.getUsageView().getSelectedUsages();
      if (infos == null || infos.isEmpty())       return;
      LocalVcs instance=LocalVcs.getInstance(searchContext.getProject());
      LocalHistoryAction lvcsAction=instance.startAction_New(getDefaultTitle(),null,false);
      for (      final Usage info : infos) {
        final UsageInfo2UsageAdapter usage=(UsageInfo2UsageAdapter)info;
        if (isValid(usage,replaceContext)) {
          replaceOne(usage,replaceContext,searchContext.getProject(),false);
        }
      }
      lvcsAction.finish();
      if (replaceContext.getUsageView().getUsagesCount() > 0) {
        for (        Usage usage : replaceContext.getUsageView().getSortedUsages()) {
          if (!replaceContext.isExcluded(usage)) {
            replaceContext.getUsageView().selectUsages(new Usage[]{usage});
            return;
          }
        }
      }
    }
  }
;
  replaceContext.getUsageView().addButtonToLowerPane(replaceSelected,SSRBundle.message("replace.selected.button"));
  final Runnable previewReplacement=new Runnable(){
    public void run(){
      Set<Usage> selection=replaceContext.getUsageView().getSelectedUsages();
      if (selection != null && !selection.isEmpty()) {
        UsageInfo2UsageAdapter usage=(UsageInfo2UsageAdapter)selection.iterator().next();
        if (isValid(usage,replaceContext)) {
          replaceOne(usage,replaceContext,searchContext.getProject(),true);
        }
      }
    }
  }
;
  replaceContext.getUsageView().addButtonToLowerPane(previewReplacement,SSRBundle.message("preview.replacement.button"));
  super.configureActions(context);
}
