{
  final ReplaceUsageViewContext context=(ReplaceUsageViewContext)_context;
  final Runnable replaceRunnable=new Runnable(){
    public void run(){
      LocalVcs instance=LocalVcs.getInstance(searchContext.getProject());
      LvcsAction lvcsAction=instance.startAction("StructuralReplace",null,false);
      doReplace(context);
      context.getUsageView().close();
      lvcsAction.finish();
    }
  }
;
  context.getUsageView().addPerformOperationAction(replaceRunnable,"Replace All",null,"Do Replace All",'D');
  final Runnable replaceSelected=new Runnable(){
    public void run(){
      final Set<Usage> infos=context.getUsageView().getSelectedUsages();
      if (infos == null || infos.isEmpty())       return;
      LocalVcs instance=LocalVcs.getInstance(searchContext.getProject());
      LvcsAction lvcsAction=instance.startAction("StructuralReplace",null,false);
      for (      final Usage info : infos) {
        final UsageInfo2UsageAdapter usage=(UsageInfo2UsageAdapter)info;
        if (isValid(usage,context)) {
          ensureFileWritable(usage);
          replaceOne(usage,context,searchContext.getProject(),false);
        }
      }
      lvcsAction.finish();
      if (context.getUsageView().getUsagesCount() > 0) {
        for (        Usage usage : context.getUsageView().getUsages()) {
          if (!context.isExcluded(usage)) {
            context.getUsageView().selectUsages(new Usage[]{usage});
            return;
          }
        }
      }
    }
  }
;
  context.getUsageView().addButtonToLowerPane(replaceSelected,"Replace Selected",'e');
  final Runnable previewReplacement=new Runnable(){
    public void run(){
      Set<Usage> selection=context.getUsageView().getSelectedUsages();
      if (selection != null && !selection.isEmpty()) {
        UsageInfo2UsageAdapter usage=(UsageInfo2UsageAdapter)selection.iterator().next();
        if (isValid(usage,context)) {
          ensureFileWritable(usage);
          replaceOne(usage,context,searchContext.getProject(),true);
        }
      }
    }
  }
;
  context.getUsageView().addButtonToLowerPane(previewReplacement,"Preview Replacement",'r');
  super.configureActions(_context);
}
