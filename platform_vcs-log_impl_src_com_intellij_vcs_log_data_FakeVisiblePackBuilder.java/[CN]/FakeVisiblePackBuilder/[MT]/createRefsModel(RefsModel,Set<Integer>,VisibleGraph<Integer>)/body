{
  Collection<VcsRef> branchesAndHeads=ContainerUtil.filter(refsModel.getAllRefs(),new Condition<VcsRef>(){
    @Override public boolean value(    VcsRef ref){
      int commitIndex=myHashMap.getCommitIndex(ref.getCommitHash(),ref.getRoot());
      if (ref.getType().isBranch() || heads.contains(commitIndex)) {
        Integer row=visibleGraph.getVisibleRowIndex(commitIndex);
        if (row != null && row >= 0) {
          return true;
        }
      }
      return false;
    }
  }
);
  return new RefsModel(VcsLogUtil.groupRefsByRoot(branchesAndHeads),heads,myHashMap);
}
