{
  final PermanentGraphInfo<Integer> info=oldGraph.buildSimpleGraphInfo();
  Set<Integer> heads=ContainerUtil.map2Set(info.getPermanentGraphLayout().getHeadNodeIndex(),new Function<Integer,Integer>(){
    @Override public Integer fun(    Integer integer){
      return info.getPermanentCommitsInfo().getCommitId(integer);
    }
  }
);
  RefsModel newRefsModel=createRefsModel(oldPack.getRefsModel(),heads,oldGraph);
  DataPackBase newPack=new DataPackBase(oldPack.getLogProviders(),newRefsModel,false);
  GraphColorManagerImpl colorManager=new GraphColorManagerImpl(newRefsModel,DataPack.createHashGetter(myHashMap),DataPack.getRefManagerMap(oldPack.getLogProviders()));
  VisibleGraph<Integer> newGraph=new VisibleGraphImpl<Integer>(new CollapsedController(new BaseController(info),info,null),info,colorManager);
  return new VisiblePack(newPack,newGraph,true,filters);
}
