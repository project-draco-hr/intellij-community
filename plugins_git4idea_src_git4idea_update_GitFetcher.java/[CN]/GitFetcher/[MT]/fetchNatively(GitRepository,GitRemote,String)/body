{
  Git git=ServiceManager.getService(Git.class);
  String[] additionalParams=branch != null ? new String[]{getFetchSpecForBranch(branch,remote.getName())} : ArrayUtil.EMPTY_STRING_ARRAY;
  GitFetchPruneDetector pruneDetector=new GitFetchPruneDetector();
  GitCommandResult result=git.fetch(repository,remote,Collections.<GitLineHandlerListener>singletonList(pruneDetector),additionalParams);
  GitFetchResult fetchResult;
  if (result.success()) {
    fetchResult=GitFetchResult.success();
  }
 else   if (result.cancelled()) {
    fetchResult=GitFetchResult.cancel();
  }
 else {
    fetchResult=GitFetchResult.error(result.getErrorOutputAsJoinedString());
  }
  fetchResult.addPruneInfo(pruneDetector.getPrunedRefs());
  return fetchResult;
}
