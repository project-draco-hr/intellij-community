{
  final Pair<PsiMethod,PsiCallExpression> pair=getPair(parent);
  final PsiSubstitutor subst=tryToInfer(parameters,args,pair != null ? pair.second : null,pair != null ? pair.first : null);
  if (subst != null) {
    return subst;
  }
  final PsiSubstitutor substitutor=resolveBounds(myInferenceVariables.values(),mySiteSubstitutor);
  if (substitutor != null) {
    mySiteSubstitutor=substitutor;
    for (    PsiTypeParameter parameter : substitutor.getSubstitutionMap().keySet()) {
      final InferenceVariable variable=getInferenceVariable(parameter);
      if (variable != null) {
        variable.setInstantiation(substitutor.substitute(parameter));
      }
    }
  }
 else {
    return resolveSubset(myInferenceVariables.values(),mySiteSubstitutor,false);
  }
  return prepareSubstitution();
}
