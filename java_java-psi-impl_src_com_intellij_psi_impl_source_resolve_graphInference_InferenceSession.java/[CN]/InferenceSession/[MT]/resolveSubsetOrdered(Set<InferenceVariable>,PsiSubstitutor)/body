{
  PsiSubstitutor substitutor=siteSubstitutor;
  final HashSet<InferenceVariable> copy=new HashSet<InferenceVariable>(varsToResolve);
  while (!copy.isEmpty()) {
    final List<InferenceVariable> vars=InferenceVariablesOrder.resolveOrder(copy,this);
    final PsiSubstitutor resolveSubset=resolveSubset(vars,substitutor);
    copy.removeAll(vars);
    substitutor=substitutor.putAll(resolveSubset);
  }
  return substitutor;
}
