{
  final PsiSubstitutor siteSubstitutor=mySiteSubstitutor;
  while (!additionalConstraints.isEmpty()) {
    final Set<ConstraintFormula> subset=buildSubset(additionalConstraints);
    final Set<InferenceVariable> varsToResolve=new LinkedHashSet<InferenceVariable>();
    for (    ConstraintFormula formula : subset) {
      if (formula instanceof InputOutputConstraintFormula) {
        collectVarsToResolve(varsToResolve,(InputOutputConstraintFormula)formula);
      }
    }
    for (    ConstraintFormula formula : subset) {
      if (!processOneConstraint(formula,siteSubstitutor,varsToResolve,additionalConstraints))       return false;
    }
  }
  return true;
}
