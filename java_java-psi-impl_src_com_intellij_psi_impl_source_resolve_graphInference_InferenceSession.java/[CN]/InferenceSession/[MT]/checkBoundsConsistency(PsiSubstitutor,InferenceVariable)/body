{
  final PsiType eqBound=getEqualsBound(var,substitutor);
  if (eqBound != PsiType.NULL && eqBound instanceof PsiPrimitiveType)   return PsiType.NULL;
  final PsiType lowerBound=getLowerBound(var,substitutor);
  final PsiType upperBound=getUpperBound(var,substitutor);
  PsiType type;
  if (eqBound != PsiType.NULL && (myErased || eqBound != null)) {
    if (lowerBound != PsiType.NULL && !TypeConversionUtil.isAssignable(eqBound,lowerBound)) {
      registerIncompatibleErrorMessage(incompatibleBoundsMessage(var,substitutor,InferenceBound.EQ,EQUALITY_CONSTRAINTS_PRESENTATION,InferenceBound.LOWER,LOWER_BOUNDS_PRESENTATION));
      return PsiType.NULL;
    }
 else {
      type=eqBound;
    }
  }
 else {
    type=lowerBound;
  }
  if (type == PsiType.NULL) {
    if (var.isThrownBound() && isThrowable(var.getBounds(InferenceBound.UPPER))) {
      type=PsiType.getJavaLangRuntimeException(myManager,GlobalSearchScope.allScope(myManager.getProject()));
    }
 else {
      type=myErased ? null : upperBound;
    }
  }
 else {
    for (    PsiType upperType : var.getBounds(InferenceBound.UPPER)) {
      if (isProperType(upperType)) {
        String incompatibleBoundsMessage=null;
        if (type != lowerBound && !TypeConversionUtil.isAssignable(substitutor.substitute(upperType),type)) {
          incompatibleBoundsMessage=incompatibleBoundsMessage(var,substitutor,InferenceBound.EQ,EQUALITY_CONSTRAINTS_PRESENTATION,InferenceBound.UPPER,UPPER_BOUNDS_PRESENTATION);
        }
 else         if (type == lowerBound && !TypeConversionUtil.isAssignable(substitutor.substitute(upperType),lowerBound)) {
          incompatibleBoundsMessage=incompatibleBoundsMessage(var,substitutor,InferenceBound.LOWER,LOWER_BOUNDS_PRESENTATION,InferenceBound.UPPER,UPPER_BOUNDS_PRESENTATION);
        }
        if (incompatibleBoundsMessage != null) {
          registerIncompatibleErrorMessage(incompatibleBoundsMessage);
          return PsiType.NULL;
        }
      }
    }
  }
  return type;
}
