{
  final PsiElement parent=PsiUtil.skipParenthesizedExprUp(context.getParent());
  if (parent instanceof PsiExpressionList) {
    PsiElement gParent=parent.getParent();
    if (gParent instanceof PsiAnonymousClass) {
      gParent=gParent.getParent();
    }
    if (gParent instanceof PsiCallExpression) {
      final PsiExpressionList argumentList=((PsiCallExpression)gParent).getArgumentList();
      if (argumentList != null) {
        final MethodCandidateInfo.CurrentCandidateProperties properties=MethodCandidateInfo.getCurrentMethod(argumentList);
        if (properties != null && properties.isApplicabilityCheck()) {
          return getTypeByMethod(context,argumentList,properties.getMethod(),properties.getSubstitutor());
        }
        final JavaResolveResult result=((PsiCallExpression)gParent).resolveMethodGenerics();
        return getTypeByMethod(context,argumentList,result.getElement(),PsiResolveHelper.ourGraphGuard.doPreventingRecursion(argumentList.getParent(),false,new Computable<PsiSubstitutor>(){
          @Override public PsiSubstitutor compute(){
            return result.getSubstitutor();
          }
        }
));
      }
    }
  }
 else   if (parent instanceof PsiConditionalExpression) {
    PsiType targetType=PsiTypesUtil.getExpectedTypeByParent((PsiExpression)parent);
    if (targetType == null) {
      targetType=getTargetType((PsiExpression)parent);
    }
    return targetType;
  }
 else   if (parent instanceof PsiLambdaExpression) {
    if (PsiUtil.skipParenthesizedExprUp(parent.getParent()) instanceof PsiExpressionList) {
      final PsiType typeTypeByParentCall=getTargetType((PsiLambdaExpression)parent);
      return LambdaUtil.getFunctionalInterfaceReturnType(FunctionalInterfaceParameterizationUtil.getGroundTargetType(typeTypeByParentCall,(PsiLambdaExpression)parent));
    }
    return LambdaUtil.getFunctionalInterfaceReturnType(((PsiLambdaExpression)parent).getFunctionalInterfaceType());
  }
  return null;
}
