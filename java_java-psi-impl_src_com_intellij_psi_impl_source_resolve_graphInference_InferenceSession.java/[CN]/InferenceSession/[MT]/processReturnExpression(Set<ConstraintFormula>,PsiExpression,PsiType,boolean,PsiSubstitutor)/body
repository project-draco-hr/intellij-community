{
  if (returnExpression instanceof PsiCallExpression) {
    if (addConstraint) {
      final PsiMethod calledMethod=getCalledMethod((PsiCallExpression)returnExpression);
      if (calledMethod != null && PsiPolyExpressionUtil.isMethodCallPolyExpression(returnExpression,calledMethod)) {
        collectAdditionalConstraints(additionalConstraints,(PsiCallExpression)returnExpression,initialSubstitutor);
      }
    }
 else {
      getInferenceSessionContainer().registerNestedSession(this,functionalType,returnExpression);
    }
  }
 else   if (returnExpression instanceof PsiParenthesizedExpression) {
    processReturnExpression(additionalConstraints,((PsiParenthesizedExpression)returnExpression).getExpression(),functionalType,addConstraint,initialSubstitutor);
  }
 else   if (returnExpression instanceof PsiConditionalExpression) {
    processReturnExpression(additionalConstraints,((PsiConditionalExpression)returnExpression).getThenExpression(),functionalType,addConstraint,initialSubstitutor);
    processReturnExpression(additionalConstraints,((PsiConditionalExpression)returnExpression).getElseExpression(),functionalType,addConstraint,initialSubstitutor);
  }
 else   if (returnExpression instanceof PsiLambdaExpression) {
    collectLambdaReturnExpression(additionalConstraints,(PsiLambdaExpression)returnExpression,functionalType,myErased,initialSubstitutor);
  }
}
