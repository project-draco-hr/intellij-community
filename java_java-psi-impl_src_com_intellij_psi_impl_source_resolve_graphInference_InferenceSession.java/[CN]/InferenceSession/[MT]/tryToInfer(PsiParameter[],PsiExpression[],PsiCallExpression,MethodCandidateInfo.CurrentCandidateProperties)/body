{
  if (!repeatInferencePhases(true)) {
    return resolveSubset(myInferenceVariables.values(),mySiteSubstitutor);
  }
  if (properties != null && !properties.isApplicabilityCheck()) {
    initReturnTypeConstraint(properties.getMethod(),parent);
    if (!repeatInferencePhases(true)) {
      return prepareSubstitution();
    }
    if (parameters != null && args != null) {
      final Set<ConstraintFormula> additionalConstraints=new HashSet<ConstraintFormula>();
      if (parameters.length > 0) {
        collectAdditionalConstraints(parameters,args,properties.getMethod(),PsiSubstitutor.EMPTY,additionalConstraints);
      }
      if (!additionalConstraints.isEmpty() && !proceedWithAdditionalConstraints(additionalConstraints)) {
        return prepareSubstitution();
      }
    }
  }
  return null;
}
