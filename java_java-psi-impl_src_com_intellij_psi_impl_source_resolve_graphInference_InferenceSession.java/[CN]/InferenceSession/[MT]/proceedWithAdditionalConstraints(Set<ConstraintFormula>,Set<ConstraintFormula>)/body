{
  final PsiSubstitutor siteSubstitutor=PsiSubstitutor.EMPTY;
  while (!additionalConstraints.isEmpty()) {
    final Set<ConstraintFormula> subset=buildSubset(additionalConstraints,ignoredConstraints);
    final Set<InferenceVariable> varsToResolve=new LinkedHashSet<InferenceVariable>();
    for (    ConstraintFormula formula : subset) {
      if (formula instanceof InputOutputConstraintFormula) {
        collectVarsToResolve(varsToResolve,(InputOutputConstraintFormula)formula);
      }
    }
    final PsiSubstitutor substitutor=resolveSubsetOrdered(varsToResolve,siteSubstitutor);
    for (    ConstraintFormula formula : subset) {
      if (!processOneConstraint(formula,additionalConstraints,substitutor,ignoredConstraints))       return false;
    }
  }
  return true;
}
