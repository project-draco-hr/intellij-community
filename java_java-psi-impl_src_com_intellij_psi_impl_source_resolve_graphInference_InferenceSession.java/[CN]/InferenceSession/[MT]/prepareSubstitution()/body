{
  ArrayList<InferenceVariable> allVars=new ArrayList<InferenceVariable>(myInferenceVariables);
  while (!allVars.isEmpty()) {
    final List<InferenceVariable> variables=InferenceVariablesOrder.resolveOrder(allVars,this);
    for (    InferenceVariable inferenceVariable : variables) {
      final PsiTypeParameter typeParameter=inferenceVariable.getParameter();
      PsiType instantiation=inferenceVariable.getInstantiation();
      if (instantiation == PsiType.NULL) {
        checkBoundsConsistency(mySiteSubstitutor,inferenceVariable);
        mySiteSubstitutor=mySiteSubstitutor.put(typeParameter,JavaPsiFacade.getInstance(typeParameter.getProject()).getElementFactory().createType(typeParameter));
      }
    }
    allVars.removeAll(variables);
  }
  return mySiteSubstitutor;
}
