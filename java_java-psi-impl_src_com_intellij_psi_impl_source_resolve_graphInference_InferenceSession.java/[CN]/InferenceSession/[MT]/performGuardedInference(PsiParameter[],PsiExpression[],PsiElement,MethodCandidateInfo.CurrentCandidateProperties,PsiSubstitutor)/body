{
  try {
    doInfer(parameters,args,parent,properties,initialSubstitutor);
    return prepareSubstitution();
  }
  finally {
    for (    ConstraintFormula formula : myConstraintsCopy) {
      if (formula instanceof InputOutputConstraintFormula) {
        LambdaUtil.getFunctionalTypeMap().remove(((InputOutputConstraintFormula)formula).getExpression());
      }
    }
    if (properties != null && myErrorMessages != null) {
      properties.getInfo().setInferenceError(StringUtil.join(myErrorMessages,"\n"));
    }
  }
}
