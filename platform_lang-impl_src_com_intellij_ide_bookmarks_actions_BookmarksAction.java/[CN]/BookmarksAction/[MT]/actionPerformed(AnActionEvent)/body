{
  final Project project=e.getProject();
  if (project == null)   return;
  if (myPopup != null && myPopup.isVisible())   return;
  final DefaultListModel model=buildModel(project);
  final JBList list=new JBList(model);
  list.getEmptyText().setText("No Bookmarks");
  EditBookmarkDescriptionAction editDescriptionAction=new EditBookmarkDescriptionAction(project,list);
  DefaultActionGroup actions=new DefaultActionGroup();
  actions.add(editDescriptionAction);
  actions.add(new DeleteBookmarkAction(project,list));
  actions.add(new MoveBookmarkUpAction(project,list));
  actions.add(new MoveBookmarkDownAction(project,list));
  myPopup=new MasterDetailPopupBuilder(project).setList(list).setDelegate(this).setDetailView(new DetailViewImpl(project)).setDimensionServiceKey("bookmarks").setAddDetailViewToEast(true).setActionsGroup(actions).setPopupTuner(new Consumer<PopupChooserBuilder>(){
    @Override public void consume(    PopupChooserBuilder builder){
      builder.setCloseOnEnter(false).setCancelOnClickOutside(false).setCancelOnWindowDeactivation(true);
    }
  }
).setDoneRunnable(new Runnable(){
    @Override public void run(){
      myPopup.cancel();
    }
  }
).createMasterDetailPopup();
  new AnAction(){
    @Override public void actionPerformed(    AnActionEvent e){
      Object selectedValue=list.getSelectedValue();
      if (selectedValue instanceof BookmarkItem) {
        itemChosen((BookmarkItem)selectedValue,project,myPopup,true);
      }
    }
  }
.registerCustomShortcutSet(CommonShortcuts.getEditSource(),list);
  editDescriptionAction.setPopup(myPopup);
  myPopup.showCenteredInCurrentWindow(project);
  list.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
}
