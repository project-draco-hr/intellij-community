{
  final Editor editor=event.getEditor();
  final Project project=editor.getProject();
  if (project == null) {
    return;
  }
  final Document document=editor.getDocument();
  final VirtualFile openedFile=FileDocumentManager.getInstance().getFile(document);
  if (openedFile != null) {
    final TaskFile taskFile=StudyUtils.getTaskFile(project,openedFile);
    if (taskFile != null) {
      WolfTheProblemSolver.getInstance(project).clearProblems(openedFile);
      final ToolWindow studyToolWindow=ToolWindowManager.getInstance(project).getToolWindow(StudyToolWindowFactory.STUDY_TOOL_WINDOW);
      if (studyToolWindow != null) {
        StudyUtils.updateToolWindows(project);
        studyToolWindow.show(null);
      }
      if (!taskFile.getAnswerPlaceholders().isEmpty()) {
        StudyNavigator.navigateToFirstAnswerPlaceholder(editor,taskFile);
        StudyEditor.addDocumentListener(document,new EduDocumentListener(taskFile));
        StudyUtils.drawAllWindows(editor,taskFile);
        editor.addEditorMouseListener(new WindowSelectionListener(taskFile));
      }
    }
  }
}
