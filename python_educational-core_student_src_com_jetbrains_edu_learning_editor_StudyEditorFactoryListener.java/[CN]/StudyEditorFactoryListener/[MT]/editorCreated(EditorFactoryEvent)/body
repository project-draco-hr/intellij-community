{
  final Editor editor=event.getEditor();
  final Project project=editor.getProject();
  if (project == null) {
    return;
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          final Document document=editor.getDocument();
          final VirtualFile openedFile=FileDocumentManager.getInstance().getFile(document);
          if (openedFile != null) {
            final TaskFile taskFile=StudyUtils.getTaskFile(project,openedFile);
            if (taskFile != null) {
              WolfTheProblemSolver.getInstance(project).clearProblems(openedFile);
              final ToolWindow studyToolWindow=ToolWindowManager.getInstance(project).getToolWindow(StudyToolWindowFactory.STUDY_TOOL_WINDOW);
              if (studyToolWindow != null) {
                StudyUtils.updateToolWindows(project);
                studyToolWindow.show(null);
              }
              Course course=StudyTaskManager.getInstance(project).getCourse();
              if (course == null) {
                return;
              }
              if (!taskFile.getAnswerPlaceholders().isEmpty()) {
                StudyNavigator.navigateToFirstAnswerPlaceholder(editor,taskFile);
                boolean isStudyProject=EduNames.STUDY.equals(course.getCourseType());
                StudyEditor.addDocumentListener(document,new EduDocumentListener(taskFile,true,!isStudyProject));
                StudyUtils.drawAllWindows(editor,taskFile,isStudyProject);
                if (isStudyProject) {
                  editor.addEditorMouseListener(new WindowSelectionListener(taskFile));
                }
              }
            }
          }
        }
      }
);
    }
  }
);
}
