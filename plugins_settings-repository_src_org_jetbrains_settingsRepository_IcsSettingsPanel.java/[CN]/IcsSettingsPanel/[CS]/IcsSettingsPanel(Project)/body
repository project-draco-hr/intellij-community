{
  super(project,true);
  icsManager=IcsManager.OBJECT$.getInstance();
  urlTextField.setText(icsManager.getRepositoryManager().getUpstream());
  urlTextField.addBrowseFolderListener(new TextBrowseFolderListener(FileChooserDescriptorFactory.createSingleFolderDescriptor()));
  SyncType[] syncTypes=SyncType.values();
  if (SystemInfo.isMac) {
    syncTypes=ArrayUtil.reverseArray(syncTypes);
  }
  syncActions=new Action[syncTypes.length];
  for (int i=0, n=syncTypes.length; i < n; i++) {
    final SyncType syncType=syncTypes[i];
    syncActions[i]=new DialogWrapperAction(IcsBundle.OBJECT$.message("action." + (syncType == SyncType.MERGE ? "Merge" : (syncType == SyncType.RESET_TO_THEIRS ? "ResetToTheirs" : "ResetToMy")) + "Settings.text")){
      @Override protected void doAction(      ActionEvent event){
        boolean repositoryWillBeCreated=!icsManager.getRepositoryManager().isRepositoryExists();
        if (!saveRemoteRepositoryUrl()) {
          if (repositoryWillBeCreated) {
            icsManager.getRepositoryManager().deleteRepository();
          }
          return;
        }
        try {
          if (repositoryWillBeCreated && syncType != SyncType.RESET_TO_THEIRS) {
            ApplicationManager.getApplication().saveSettings();
            icsManager.sync(syncType,project,new Function0<Unit>(){
              @Override public Unit invoke(){
                SettingsRepositoryPackage.copyLocalConfig();
                return Unit.INSTANCE$;
              }
            }
);
          }
 else {
            icsManager.sync(syncType,project,null);
          }
        }
 catch (        Throwable e) {
          if (repositoryWillBeCreated) {
            icsManager.getRepositoryManager().deleteRepository();
          }
          Messages.showErrorDialog(getContentPane(),StringUtil.notNullize(e.getMessage(),"Internal error"),IcsBundle.OBJECT$.message("sync.rejected.title"));
          return;
        }
        ActionsPackage.getNOTIFICATION_GROUP().createNotification(IcsBundle.OBJECT$.message("sync.done.message"),NotificationType.INFORMATION).notify(project);
        doOKAction();
      }
    }
;
  }
  urlTextField.getTextField().getDocument().addDocumentListener(new DocumentAdapter(){
    @Override protected void textChanged(    DocumentEvent e){
      updateSyncButtonState();
    }
  }
);
  updateSyncButtonState();
  setTitle(IcsBundle.OBJECT$.message("settings.panel.title"));
  setResizable(false);
  init();
}
