{
  if (project == null || project.isDefault())   return getInstance();
  ProjectCodeStyleSettingsManager projectSettingsManager=ServiceManager.getService(project,ProjectCodeStyleSettingsManager.class);
  if (!projectSettingsManager.isLoaded()) {
synchronized (projectSettingsManager) {
      if (!projectSettingsManager.isLoaded()) {
        LegacyCodeStyleSettingsManager legacySettingsManager=ServiceManager.getService(project,LegacyCodeStyleSettingsManager.class);
        if (legacySettingsManager != null && legacySettingsManager.getState() != null) {
          try {
            DefaultJDOMExternalizer.readExternal(projectSettingsManager,legacySettingsManager.getState());
          }
 catch (          InvalidDataException e) {
            LOG.error(e);
          }
          LOG.info("Imported old project code style settings.");
        }
      }
    }
  }
  return projectSettingsManager;
}
