{
  configureByFile(BASE_PATH + getTestName(false) + ".dtd");
  doDoTest(true,false);
  final String text=myEditor.getDocument().getText();
  WriteCommandAction.runWriteCommandAction(null,new Runnable(){
    @Override public void run(){
      myEditor.getSelectionModel().setSelection(0,myEditor.getDocument().getTextLength());
    }
  }
);
  AnAction action=ActionManager.getInstance().getAction(IdeActions.ACTION_COMMENT_BLOCK);
  action.actionPerformed(AnActionEvent.createFromAnAction(action,null,"",DataManager.getInstance().getDataContext()));
  assertNotSame(text,myEditor.getDocument().getText());
  PsiDocumentManager.getInstance(myProject).commitDocument(myEditor.getDocument());
  Collection<HighlightInfo> infos=doHighlighting();
  assertEquals(0,infos.size());
  action.actionPerformed(AnActionEvent.createFromAnAction(action,null,"",DataManager.getInstance().getDataContext()));
  assertEquals(text,myEditor.getDocument().getText().trim());
  PsiDocumentManager.getInstance(myProject).commitDocument(myEditor.getDocument());
  infos=doHighlighting();
  assertEquals(0,infos.size());
}
