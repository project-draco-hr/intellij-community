{
  if (host instanceof PyStringLiteralExpression && PyDocumentationSettings.getInstance(host.getProject()).analyzeDoctest) {
    final PyDocStringOwner docStringOwner=PsiTreeUtil.getParentOfType(host,PyDocStringOwner.class);
    if (docStringOwner != null && host.equals(docStringOwner.getDocStringExpression())) {
      int start=0;
      int end=host.getTextLength() - 1;
      final String text=host.getText();
      final List<String> strings=StringUtil.split(text,"\n",false);
      boolean gotExample=false;
      int currentPosition=0;
      int maxPosition=text.length();
      boolean endsWithSlash=false;
      for (      String string : strings) {
        final String trimmedString=string.trim();
        if (!trimmedString.startsWith(">>>") && !trimmedString.startsWith("...") && gotExample&& start < end) {
          gotExample=false;
          if (!endsWithSlash)           injectionPlacesRegistrar.addPlace(PyDocstringLanguageDialect.getInstance(),TextRange.create(start,end),null,null);
        }
        if (endsWithSlash) {
          endsWithSlash=false;
          injectionPlacesRegistrar.addPlace(PyDocstringLanguageDialect.getInstance(),TextRange.create(start,getEndOffset(currentPosition,string,maxPosition)),null,null);
        }
        if (trimmedString.startsWith(">>>")) {
          if (trimmedString.endsWith("\\"))           endsWithSlash=true;
          if (!gotExample)           start=currentPosition;
          gotExample=true;
          end=getEndOffset(currentPosition,string,maxPosition);
        }
 else         if (trimmedString.startsWith("...") && gotExample) {
          if (trimmedString.endsWith("\\"))           endsWithSlash=true;
          end=getEndOffset(currentPosition,string,maxPosition);
        }
        currentPosition+=string.length();
      }
      if (gotExample && start < end)       injectionPlacesRegistrar.addPlace(PyDocstringLanguageDialect.getInstance(),TextRange.create(start,end),null,null);
    }
  }
}
