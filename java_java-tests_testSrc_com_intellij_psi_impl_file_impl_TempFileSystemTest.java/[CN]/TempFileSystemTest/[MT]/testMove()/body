{
  ProjectRootManager rootManager=ProjectRootManager.getInstance(getProject());
  VirtualFile sourceRoot=rootManager.getContentSourceRoots()[0];
  PsiManager psiManager=PsiManager.getInstance(getProject());
  PsiDirectory psiSourceRoot=psiManager.findDirectory(sourceRoot);
  PsiFile psiFile=ApplicationManager.getApplication().runWriteAction(new Computable<PsiFile>(){
    @Override public PsiFile compute(){
      return psiSourceRoot.createFile("TestDocument.xml");
    }
  }
);
  PsiDirectory subdirectory=ApplicationManager.getApplication().runWriteAction(new Computable<PsiDirectory>(){
    @Override public PsiDirectory compute(){
      return psiSourceRoot.createSubdirectory("com");
    }
  }
);
  PlatformTestCase.move(psiFile.getVirtualFile(),subdirectory.getVirtualFile());
  assertTrue(psiFile.isValid());
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      psiFile.delete();
    }
  }
);
  assertFalse(psiFile.isValid());
}
