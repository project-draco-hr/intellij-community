{
  if (psiElement.getUserData(PyPsiUtils.SELECTION_BREAKS_AST_NODE) != null) {
    final Pair<PsiElement,TextRange> data=psiElement.getUserData(PyPsiUtils.SELECTION_BREAKS_AST_NODE);
    psiElement=data.first;
  }
  PsiElement context=PsiTreeUtil.getParentOfType(psiElement,PyFunction.class);
  if (context == null) {
    context=PsiTreeUtil.getParentOfType(psiElement,PyClass.class);
  }
  if (context == null) {
    context=psiElement.getContainingFile();
  }
  if (PyRefactoringUtil.collectScopeVariables(context).contains(name)) {
    return PyBundle.message("refactoring.introduce.constant.scope.error");
  }
  return null;
}
