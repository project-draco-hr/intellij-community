{
  createBreakpoints(javaParameters.getMainClass());
  final DebuggerSession[] debuggerSession=new DebuggerSession[]{null};
  DebuggerSettings.getInstance().DEBUGGER_TRANSPORT=transport;
  GenericDebuggerRunnerSettings debuggerRunnerSettings=new GenericDebuggerRunnerSettings();
  debuggerRunnerSettings.LOCAL=true;
  debuggerRunnerSettings.setDebugPort("3456");
  ExecutionEnvironment environment=new ExecutionEnvironmentBuilder(myProject,DefaultDebugExecutor.getDebugExecutorInstance()).runnerSettings(debuggerRunnerSettings).runProfile(new MockConfiguration()).build();
  final JavaCommandLineState javaCommandLineState=new JavaCommandLineState(environment){
    @Override protected JavaParameters createJavaParameters(){
      return javaParameters;
    }
    @Override protected GeneralCommandLine createCommandLine() throws ExecutionException {
      return CommandLineBuilder.createFromJavaParameters(getJavaParameters());
    }
  }
;
  final RemoteConnection debugParameters=DebuggerManagerImpl.createDebugParameters(javaCommandLineState.getJavaParameters(),debuggerRunnerSettings,true);
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      try {
        debuggerSession[0]=attachVirtualMachine(javaCommandLineState,javaCommandLineState.getEnvironment(),debugParameters,false);
      }
 catch (      ExecutionException e) {
        fail(e.getMessage());
      }
    }
  }
);
  final ProcessHandler processHandler=debuggerSession[0].getProcess().getProcessHandler();
  debuggerSession[0].getProcess().addProcessListener(new ProcessAdapter(){
    @Override public void onTextAvailable(    ProcessEvent event,    Key outputType){
      print(event.getText(),outputType);
    }
  }
);
  DebugProcessImpl process=(DebugProcessImpl)DebuggerManagerEx.getInstanceEx(myProject).getDebugProcess(processHandler);
  assertNotNull(process);
  return debuggerSession[0];
}
