{
  final Location location=context.getLocation();
  if (location == null)   return false;
  if (!(configuration instanceof PyTestRunConfiguration))   return false;
  final PsiElement element=location.getPsiElement();
  final PsiFileSystemItem file=element instanceof PsiDirectory ? (PsiDirectory)element : element.getContainingFile();
  if (file == null)   return false;
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return false;
  if (file instanceof PyFile || file instanceof PsiDirectory) {
    final List<PyStatement> testCases=PyTestUtil.getPyTestCasesFromFile(file,TypeEvalContext.userInitiated(element.getProject(),element.getContainingFile()));
    if (testCases.isEmpty())     return false;
  }
 else {
    return false;
  }
  final Sdk sdk=PythonSdkType.findPythonSdk(context.getModule());
  if (sdk == null)   return false;
  final String keywords=getKeywords(element,sdk);
  final String scriptName=((PyTestRunConfiguration)configuration).getTestToRun();
  final String workingDirectory=configuration.getWorkingDirectory();
  final String path=virtualFile.getPath();
  final boolean isTestFileEquals=scriptName.equals(path) || path.equals(new File(workingDirectory,scriptName).getAbsolutePath());
  final String configurationKeywords=((PyTestRunConfiguration)configuration).getKeywords();
  return isTestFileEquals && (configurationKeywords.equals(keywords) || StringUtil.isEmptyOrSpaces(((PyTestRunConfiguration)configuration).getKeywords()) && keywords == null);
}
