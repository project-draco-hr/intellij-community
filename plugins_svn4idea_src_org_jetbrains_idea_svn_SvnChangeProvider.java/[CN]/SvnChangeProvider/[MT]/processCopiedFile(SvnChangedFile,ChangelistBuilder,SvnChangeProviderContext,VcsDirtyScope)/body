{
  boolean foundRename=false;
  final Status copiedStatus=copiedFile.getStatus();
  final String copyFromURL=copiedFile.getCopyFromURL();
  final FilePath copiedToPath=copiedFile.getFilePath();
  final Set<SvnChangedFile> deletedToDelete=new HashSet<SvnChangedFile>();
  for (Iterator<SvnChangedFile> iterator=context.getDeletedFiles().iterator(); iterator.hasNext(); ) {
    SvnChangedFile deletedFile=iterator.next();
    final Status deletedStatus=deletedFile.getStatus();
    if ((deletedStatus != null) && (deletedStatus.getURL() != null) && Comparing.equal(copyFromURL,deletedStatus.getURL().toString())) {
      final String clName=SvnUtil.getChangelistName(copiedFile.getStatus());
      final Change newChange=context.createMovedChange(createBeforeRevision(deletedFile,true),CurrentContentRevision.create(copiedFile.getFilePath()),copiedStatus,deletedStatus);
      applyMovedChange(copiedFile.getFilePath(),builder,dirtyScope,deletedToDelete,deletedFile,clName,newChange);
      for (Iterator<SvnChangedFile> iterChild=context.getDeletedFiles().iterator(); iterChild.hasNext(); ) {
        SvnChangedFile deletedChild=iterChild.next();
        final Status childStatus=deletedChild.getStatus();
        if (childStatus == null) {
          continue;
        }
        final SVNURL childUrl=childStatus.getURL();
        if (childUrl == null) {
          continue;
        }
        final String childURL=childUrl.toDecodedString();
        if (StringUtil.startsWithConcatenation(childURL,copyFromURL,"/")) {
          String relativePath=childURL.substring(copyFromURL.length());
          File newPath=new File(copiedFile.getFilePath().getIOFile(),relativePath);
          FilePath newFilePath=myFactory.createFilePathOn(newPath);
          if (!context.isDeleted(newFilePath)) {
            final Change movedChange=context.createMovedChange(createBeforeRevision(deletedChild,true),CurrentContentRevision.create(newFilePath),context.getTreeConflictStatus(newPath),childStatus);
            applyMovedChange(newFilePath,builder,dirtyScope,deletedToDelete,deletedChild,clName,movedChange);
          }
        }
      }
      foundRename=true;
      break;
    }
  }
  final List<SvnChangedFile> deletedFiles=context.getDeletedFiles();
  for (  SvnChangedFile file : deletedToDelete) {
    deletedFiles.remove(file);
  }
  if (!foundRename && copiedStatus.getURL() != null) {
    File wcPath=guessWorkingCopyPath(copiedStatus.getFile(),copiedStatus.getURL(),copyFromURL);
    Status status;
    try {
      status=myVcs.getFactory(wcPath).createStatusClient().doStatus(wcPath,false);
    }
 catch (    SvnBindException ex) {
      LOG.info(ex);
      status=null;
    }
    if (status != null && SvnVcs.svnStatusIs(status,StatusType.STATUS_DELETED)) {
      final FilePath filePath=myFactory.createFilePathOnDeleted(wcPath,false);
      final SvnContentRevision beforeRevision=SvnContentRevision.createBaseRevision(myVcs,filePath,status.getRevision());
      final ContentRevision afterRevision=CurrentContentRevision.create(copiedFile.getFilePath());
      builder.processChangeInList(context.createMovedChange(beforeRevision,afterRevision,copiedStatus,status),SvnUtil.getChangelistName(status),SvnVcs.getKey());
      foundRename=true;
    }
  }
  if (!foundRename) {
    LOG.info("Rename not found for " + copiedFile.getFilePath().getPresentableUrl());
    context.processStatus(copiedFile.getFilePath(),copiedStatus);
  }
}
