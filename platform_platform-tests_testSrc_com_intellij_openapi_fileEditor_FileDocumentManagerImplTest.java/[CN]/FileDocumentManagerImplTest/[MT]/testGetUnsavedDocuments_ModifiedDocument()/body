{
  final VirtualFile file=createFile();
  final Document document=myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  WriteCommandAction.runWriteCommandAction(getProject(),new Runnable(){
    @Override public void run(){
      document.insertString(0,"xxx");
    }
  }
);
  final Document[] unsavedDocuments=myDocumentManager.getUnsavedDocuments();
  assertEquals(1,unsavedDocuments.length);
  assertSame(document,unsavedDocuments[0]);
  assertEquals("test",new String(file.contentsToByteArray(),CharsetToolkit.UTF8_CHARSET));
}
