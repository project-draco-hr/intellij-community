{
  myImportFixer.handleInsert(context,this);
  PsiElement position=context.getFile().findElementAt(context.getStartOffset());
  if (position != null) {
    int genericsStart=context.getTailOffset();
    context.getDocument().insertString(genericsStart,JavaCompletionUtil.escapeXmlIfNeeded(context,calcGenerics(position,context)));
    JavaCompletionUtil.shortenReference(context.getFile(),genericsStart - 1);
  }
  int tail=context.getTailOffset();
  String braces=StringUtil.repeat("[]",getBracketsCount());
  Editor editor=context.getEditor();
  if (!braces.isEmpty()) {
    if (myAddArrayInitializer) {
      context.getDocument().insertString(tail,braces + "{}");
      editor.getCaretModel().moveToOffset(tail + braces.length() + 1);
    }
 else {
      context.getDocument().insertString(tail,braces);
      editor.getCaretModel().moveToOffset(tail + 1);
      if (context.getCompletionChar() == '[') {
        context.setAddCompletionChar(false);
      }
    }
  }
 else {
    editor.getCaretModel().moveToOffset(tail);
  }
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  InsertHandler handler=getInsertHandler();
  if (handler != null) {
    handler.handleInsert(context,this);
  }
}
