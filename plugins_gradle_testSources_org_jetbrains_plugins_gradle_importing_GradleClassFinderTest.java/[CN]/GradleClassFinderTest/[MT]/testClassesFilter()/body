{
  createProjectSubFile("settings.gradle","rootProject.name = 'multiproject'\n" + "include ':app'");
  createProjectSubFile("app/src/main/groovy/App.groovy","class App {}");
  createProjectSubFile("buildSrc/src/main/groovy/org/buildsrc/BuildSrcClass.groovy","package org.buildsrc;\n" + "import groovy.util.AntBuilder;\n" + "public class BuildSrcClass {}");
  importProject("subprojects {\n" + "    apply plugin: 'groovy'\n" + "}");
  assertModules("multiproject","app","app_main","app_test","buildSrc","buildSrc_main","buildSrc_test");
  Module buildSrcModule=getModule("buildSrc_main");
  assertNotNull(buildSrcModule);
  final AccessToken accessToken=ReadAction.start();
  try {
    PsiClass[] appClasses=JavaPsiFacade.getInstance(myProject).findClasses("App",GlobalSearchScope.allScope(myProject));
    assertEquals(1,appClasses.length);
    PsiClass[] buildSrcClasses=JavaPsiFacade.getInstance(myProject).findClasses("org.buildsrc.BuildSrcClass",GlobalSearchScope.moduleScope(buildSrcModule));
    assertEquals(1,buildSrcClasses.length);
  }
  finally {
    accessToken.finish();
  }
}
