{
  final Description root=Description.createSuiteDescription("root");
  Description testA=Description.createTestDescription("TestA","test1");
  root.addChild(testA);
  Description testB=Description.createTestDescription("TestB","test2");
  root.addChild(testB);
  final StringBuffer buf=new StringBuffer();
  final JUnit4TestListener sender=createListener(buf);
  sender.sendTree(root);
  Assert.assertEquals("output: " + buf,"##teamcity[enteredTheMatrix]\n" + "##teamcity[suiteTreeNode name='TestA.test1' locationHint='java:test://TestA.test1']\n" + "##teamcity[suiteTreeNode name='TestB.test2' locationHint='java:test://TestB.test2']\n"+ "##teamcity[treeEnded]\n",StringUtil.convertLineSeparators(buf.toString()));
  buf.setLength(0);
  sender.testRunStarted(root);
  sender.testStarted(testA);
  sender.testStarted(testB);
  sender.testFinished(testB);
  final Exception exception=new Exception();
  exception.setStackTrace(new StackTraceElement[0]);
  sender.testFailure(new Failure(testA,exception));
  sender.testFinished(testA);
  sender.testRunFinished(new Result());
  Assert.assertEquals("output: " + buf,"##teamcity[rootName name = 'root' location = 'java:suite://root']\n" + "\n" + "##teamcity[testStarted name='TestA.test1' locationHint='java:test://TestA.test1']\n"+ "\n"+ "##teamcity[testFailed name='TestA.test1' details='java.lang.Exception|n' error='true' message='']\n"+ "\n"+ "##teamcity[testFinished name='TestA.test1']\n"+ "\n"+ "##teamcity[testStarted name='TestB.test2' locationHint='java:test://TestB.test2']\n"+ "\n"+ "##teamcity[testFinished name='TestB.test2']\n",StringUtil.convertLineSeparators(buf.toString()));
}
