{
  final IdeView view=e.getData(LangDataKeys.IDE_VIEW);
  if (view == null) {
    return;
  }
  final Project project=e.getData(CommonDataKeys.PROJECT);
  final PsiDirectory directory=DirectoryChooserUtil.getOrChooseDirectory(view);
  if (directory == null)   return;
  final CreateDirectoryOrPackageHandler validator=new CreateDirectoryOrPackageHandler(project,directory,false,"."){
    @Override protected void createDirectories(    String subDirName){
      super.createDirectories(subDirName);
      PsiFileSystemItem element=getCreatedElement();
      if (element instanceof PsiDirectory) {
        createInitPyInHierarchy((PsiDirectory)element,directory);
      }
    }
  }
;
  DumbService.allowStartingDumbModeInside(DumbModePermission.MAY_START_BACKGROUND,new Runnable(){
    public void run(){
      Messages.showInputDialog(project,IdeBundle.message("prompt.enter.new.package.name"),IdeBundle.message("title.new.package"),Messages.getQuestionIcon(),"",validator);
    }
  }
);
  final PsiFileSystemItem result=validator.getCreatedElement();
  if (result != null) {
    view.selectElement(result);
  }
}
