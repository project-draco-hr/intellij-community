{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      if (psiField.isValid()) {
        final PsiFile fieldContainingFile=psiField.getContainingFile();
        final Set<PsiFile> processedFiles=new HashSet<PsiFile>();
        if (fieldContainingFile != null) {
          processedFiles.add(fieldContainingFile);
        }
        final Collection<PsiReferenceExpression> references=doFindReferences(psiField,fieldAccessFlags,ignoreAccessScope);
        for (        final PsiReferenceExpression ref : references) {
          final PsiElement usage=ref.getElement();
          final PsiFile containingPsi=usage.getContainingFile();
          if (containingPsi != null && processedFiles.add(containingPsi)) {
            final VirtualFile vFile=containingPsi.getOriginalFile().getVirtualFile();
            if (vFile != null) {
              affectedPaths.add(vFile.getPath());
            }
          }
        }
      }
    }
  }
);
}
