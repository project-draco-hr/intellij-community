{
  edt(new Runnable(){
    @Override public void run(){
      for (      Module module : scope.getAffectedModules()) {
        setupJdkForModule(module.getName());
      }
    }
  }
);
  CompilerWorkspaceConfiguration.getInstance(myProject).CLEAR_OUTPUT_DIRECTORY=true;
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  edt(new Runnable(){
    @Override public void run(){
      CompilerTestUtil.enableExternalCompiler();
      CompilerManager.getInstance(myProject).make(scope,new CompileStatusNotification(){
        @Override public void finished(        boolean aborted,        int errors,        int warnings,        CompileContext compileContext){
          semaphore.up();
        }
      }
);
    }
  }
);
  while (!semaphore.waitFor(100)) {
    if (SwingUtilities.isEventDispatchThread()) {
      UIUtil.dispatchAllInvocationEvents();
    }
  }
  if (SwingUtilities.isEventDispatchThread()) {
    UIUtil.dispatchAllInvocationEvents();
  }
}
