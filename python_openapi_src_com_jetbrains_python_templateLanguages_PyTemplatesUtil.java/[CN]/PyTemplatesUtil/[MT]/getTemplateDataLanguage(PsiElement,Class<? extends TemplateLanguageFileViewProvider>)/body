{
  if (psiElement == null) {
    return null;
  }
  final FileViewProvider provider=psiElement.getContainingFile().getViewProvider();
  if (provider instanceof TemplateLanguageFileViewProvider) {
    if (expectedProvider == null || expectedProvider.isInstance(provider)) {
      return (((TemplateLanguageFileViewProvider)provider).getTemplateDataLanguage());
    }
  }
  return psiElement.getLanguage();
}
