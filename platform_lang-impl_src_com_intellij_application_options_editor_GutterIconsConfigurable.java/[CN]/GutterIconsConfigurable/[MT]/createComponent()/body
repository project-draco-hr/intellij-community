{
  ExtensionPoint<LineMarkerProvider> point=Extensions.getRootArea().getExtensionPoint(LineMarkerProviders.EP_NAME);
  @SuppressWarnings("unchecked") LanguageExtensionPoint<LineMarkerProvider>[] extensions=(LanguageExtensionPoint<LineMarkerProvider>[])point.getExtensions();
  NullableFunction<LanguageExtensionPoint<LineMarkerProvider>,PluginDescriptor> function=new NullableFunction<LanguageExtensionPoint<LineMarkerProvider>,PluginDescriptor>(){
    @Nullable @Override public PluginDescriptor fun(    LanguageExtensionPoint<LineMarkerProvider> point){
      LineMarkerProvider instance=point.getInstance();
      return instance instanceof LineMarkerProviderDescriptor && ((LineMarkerProviderDescriptor)instance).getName() != null ? point.getPluginDescriptor() : null;
    }
  }
;
  MultiMap<PluginDescriptor,LanguageExtensionPoint<LineMarkerProvider>> map=ContainerUtil.groupBy(Arrays.asList(extensions),function);
  Map<GutterIconDescriptor,PluginDescriptor> pluginDescriptorMap=ContainerUtil.newHashMap();
  myDescriptors=new ArrayList<GutterIconDescriptor>();
  for (  final PluginDescriptor descriptor : map.keySet()) {
    Collection<LanguageExtensionPoint<LineMarkerProvider>> points=map.get(descriptor);
    for (    LanguageExtensionPoint<LineMarkerProvider> extensionPoint : points) {
      GutterIconDescriptor instance=(GutterIconDescriptor)extensionPoint.getInstance();
      if (instance.getOptions().length > 0) {
        for (        GutterIconDescriptor option : instance.getOptions()) {
          myDescriptors.add(option);
          pluginDescriptorMap.put(option,descriptor);
        }
      }
 else {
        myDescriptors.add(instance);
        pluginDescriptorMap.put(instance,descriptor);
      }
    }
  }
  List<GutterIconDescriptor> options=new ArrayList<GutterIconDescriptor>();
  for (Iterator<GutterIconDescriptor> iterator=myDescriptors.iterator(); iterator.hasNext(); ) {
    GutterIconDescriptor descriptor=iterator.next();
    if (descriptor.getOptions().length > 0) {
      options.addAll(Arrays.asList(descriptor.getOptions()));
      iterator.remove();
    }
  }
  myDescriptors.addAll(options);
  myDescriptors.sort(new Comparator<GutterIconDescriptor>(){
    @Override public int compare(    GutterIconDescriptor o1,    GutterIconDescriptor o2){
      if (pluginDescriptorMap.get(o1) != pluginDescriptorMap.get(o2))       return 0;
      return Comparing.compare(o1.getName(),o2.getName());
    }
  }
);
  PluginDescriptor current=null;
  for (  GutterIconDescriptor descriptor : myDescriptors) {
    PluginDescriptor pluginDescriptor=pluginDescriptorMap.get(descriptor);
    if (pluginDescriptor != current) {
      myFirstDescriptors.put(descriptor,pluginDescriptor);
      current=pluginDescriptor;
    }
  }
  myList.setItems(myDescriptors,new Function<GutterIconDescriptor,String>(){
    @Override public String fun(    GutterIconDescriptor descriptor){
      return descriptor.getName();
    }
  }
);
  return myPanel;
}
