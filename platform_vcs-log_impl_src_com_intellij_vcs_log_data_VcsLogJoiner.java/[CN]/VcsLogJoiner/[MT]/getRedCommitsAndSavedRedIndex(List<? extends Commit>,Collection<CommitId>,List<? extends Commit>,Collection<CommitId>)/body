{
  Set<CommitId> startRedCommits=new HashSet<CommitId>(previousRefs);
  startRedCommits.removeAll(newRefs);
  Set<CommitId> startGreenNodes=new HashSet<CommitId>(newRefs);
  for (  Commit commit : firstBlock) {
    startGreenNodes.add(commit.getId());
    startGreenNodes.addAll(commit.getParents());
  }
  RedGreenSorter<CommitId,Commit> sorter=new RedGreenSorter<CommitId,Commit>(startRedCommits,startGreenNodes,savedLog);
  int saveRegIndex=sorter.getFirstSaveIndex();
  return new Pair<Integer,Set<CommitId>>(saveRegIndex,sorter.getAllRedCommit());
}
