{
  if (!newCommitsMap.containsKey(commit.getHash())) {
    throw new IllegalStateException("Commit was inserted, but insert call again. Commit hash: " + commit.getHash());
  }
  for (  Hash parentHash : commit.getParents()) {
    TimedVcsCommit parentCommit=newCommitsMap.get(parentHash);
    if (parentCommit != null) {
      insertToList(parentCommit);
    }
  }
  int insertIndex=getInsertIndex(commit.getParents());
  list.add(insertIndex,commit);
  newCommitsMap.remove(commit.getHash());
  return insertIndex;
}
