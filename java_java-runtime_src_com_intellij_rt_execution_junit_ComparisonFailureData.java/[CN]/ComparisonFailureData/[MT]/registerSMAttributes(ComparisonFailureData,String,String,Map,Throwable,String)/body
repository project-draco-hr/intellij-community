{
  final int failureIdx=failureMessage != null ? trace.indexOf(failureMessage) : -1;
  final int failureMessageLength=failureMessage != null ? failureMessage.length() : 0;
  attrs.put("details",failureIdx > -1 ? trace.substring(failureIdx + failureMessageLength) : trace);
  if (notification != null) {
    attrs.put("expected",notification.getExpected());
    attrs.put("actual",notification.getActual());
    final String filePath=notification.getFilePath();
    if (filePath != null) {
      attrs.put("expectedFile",filePath);
    }
    final String actualFilePath=notification.getActualFilePath();
    if (actualFilePath != null) {
      attrs.put("actualFile",actualFilePath);
    }
    final int expectedIdx=trace.indexOf("expected:<");
    final String comparisonFailureMessage;
    if (expectedIdx > 0) {
      comparisonFailureMessage=trace.substring(0,expectedIdx);
    }
 else     if (failureIdx > -1) {
      comparisonFailureMessage=trace.substring(0,failureIdx + failureMessageLength);
    }
 else {
      comparisonFailureMessage=(failureMessageLength > 0 ? failureMessage + "\n" : "") + comparisonFailurePrefix;
    }
    attrs.put("message",comparisonFailureMessage);
  }
 else {
    Throwable throwableCause=null;
    try {
      throwableCause=throwable.getCause();
    }
 catch (    Throwable ignored) {
    }
    if (!isAssertionError(throwable.getClass()) && !isAssertionError(throwableCause != null ? throwableCause.getClass() : null)) {
      attrs.put("error","true");
    }
    attrs.put("message",failureIdx > -1 ? trace.substring(0,failureIdx + failureMessageLength) : failureMessage != null ? failureMessage : "");
  }
}
