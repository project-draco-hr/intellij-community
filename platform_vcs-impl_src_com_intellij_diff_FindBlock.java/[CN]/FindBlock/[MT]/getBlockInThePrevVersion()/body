{
  int startLine=myCurrentVersion.getStart();
  int endLine=myCurrentVersion.getEnd();
  Diff.Change change=Diff.buildChangesSomehow(myLines,myCurrentVersion.getSource());
  while (change != null) {
    int startLine1=change.line0;
    int startLine2=change.line1;
    int endLine1=startLine1 + change.deleted;
    int endLine2=startLine2 + change.inserted;
    int shiftStart=startLine2 - startLine1;
    int shiftEnd=endLine2 - endLine1;
    if (startLine2 <= myCurrentVersion.getStart()) {
      startLine=myCurrentVersion.getStart() - shiftStart;
    }
    if (endLine2 <= myCurrentVersion.getStart()) {
      startLine=myCurrentVersion.getStart() - shiftEnd;
    }
    if (startLine2 < myCurrentVersion.getEnd()) {
      endLine=myCurrentVersion.getEnd() - shiftEnd;
    }
    change=change.link;
  }
  if (endLine > myLines.length) {
    endLine=myLines.length;
  }
  if (startLine < 0)   startLine=0;
  if (endLine < startLine)   endLine=startLine;
  return new Block(myLines,startLine,endLine);
}
