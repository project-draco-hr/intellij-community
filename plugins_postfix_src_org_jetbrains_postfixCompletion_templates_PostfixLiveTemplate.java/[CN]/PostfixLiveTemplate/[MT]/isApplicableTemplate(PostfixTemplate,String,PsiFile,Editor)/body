{
  if (template == null || !template.isEnabled()) {
    return false;
  }
  int currentOffset=editor.getCaretModel().getOffset();
  int newOffset=currentOffset - key.length();
  CharSequence fileContent=editor.getDocument().getCharsSequence();
  StringBuilder fileContentWithoutKey=new StringBuilder();
  fileContentWithoutKey.append(fileContent.subSequence(0,newOffset));
  fileContentWithoutKey.append(fileContent.subSequence(currentOffset,fileContent.length()));
  PsiFile copyFile=copyFile(file,fileContentWithoutKey);
  Document copyDocument=copyFile.getViewProvider().getDocument();
  if (copyDocument == null) {
    return false;
  }
  if (isSemicolonNeeded(copyFile,editor)) {
    fileContentWithoutKey.insert(newOffset,';');
    copyFile=copyFile(file,fileContentWithoutKey);
    copyDocument=copyFile.getViewProvider().getDocument();
    if (copyDocument == null) {
      return false;
    }
  }
  PsiElement context=CustomTemplateCallback.getContext(copyFile,newOffset > 0 ? newOffset - 1 : newOffset);
  return template.isApplicable(context,copyDocument,newOffset);
}
