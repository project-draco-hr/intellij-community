{
  File removeRestartFromHome=new File(System.getProperty("user.home") + "/." + System.getProperty("idea.paths.selector")+ "/restart");
  if (removeRestartFromHome.exists()) {
    FileUtil.delete(removeRestartFromHome);
  }
  String javaHomeCopy=Restarter.getRestarterDir() + "/jre";
  File javaCopy=SystemInfoRt.isWindows ? new File(javaHomeCopy + "/bin/java.exe") : new File(javaHomeCopy + "/bin/java");
  if (javaCopy != null && javaCopy.isFile() && checkBundledJava(javaCopy)) {
    javaHome=javaHomeCopy;
  }
  if (javaHome != javaHomeCopy) {
    File javaHomeCopyDir=new File(javaHomeCopy);
    if (javaHomeCopyDir.exists())     FileUtil.delete(javaHomeCopyDir);
    System.out.println("Updater: java: " + javaHome + " copied to "+ javaHomeCopy);
    FileUtil.copyDir(new File(javaHome),javaHomeCopyDir);
    javaHome=javaHomeCopy;
  }
  return javaHome;
}
