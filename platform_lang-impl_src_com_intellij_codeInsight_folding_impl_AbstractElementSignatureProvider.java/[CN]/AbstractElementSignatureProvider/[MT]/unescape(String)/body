{
  StringBuilder b=StringBuilderSpinAllocator.alloc();
  try {
    int length=name.length();
    b.ensureCapacity(length);
    boolean escaped=false;
    for (int i=0; i < length; i++) {
      char c=name.charAt(i);
      if (escaped) {
        int p=REPLACEMENT_CHARS.indexOf(c);
        if (p > 0) {
          c=CHARS_TO_ESCAPE.charAt(p);
        }
        b.append(c);
        escaped=false;
      }
 else {
        if (c == ESCAPE_CHAR) {
          escaped=true;
        }
 else {
          b.append(c);
        }
      }
    }
    return b.toString();
  }
  finally {
    StringBuilderSpinAllocator.dispose(b);
  }
}
