{
  File configDirPath=getConfigDirPath();
  System.setProperty(PROPERTY_CONFIG_PATH,configDirPath.getPath());
  System.setProperty("native.mac.file.chooser.enabled","false");
  System.setProperty("idea.test.guimode","true");
  if (!isLoaded()) {
    ourInstance=new IdeaGuiTestApp();
    recreateDirectory(configDirPath);
    File newProjectsRootDirPath=getProjectCreationDirPath();
    recreateDirectory(newProjectsRootDirPath);
    ClassLoader ideClassLoader=ourInstance.getIdeClassLoader();
    Class<?> clazz=ideClassLoader.loadClass(GuiTestUtil.class.getCanonicalName());
    method("waitForIdeToStart").in(clazz).invoke();
    method("setUpDefaultGeneralSettings").in(clazz).invoke();
  }
  return ourInstance;
}
