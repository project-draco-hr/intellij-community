{
  for (  DocumentEvent event : events) {
    final DocumentEvent corrected;
    if ((event instanceof RetargetRangeMarkers)) {
      RetargetRangeMarkers retarget=(RetargetRangeMarkers)event;
      corrected=new RetargetRangeMarkers(frozen,retarget.getStartOffset(),retarget.getEndOffset(),retarget.getMoveDestinationOffset());
    }
 else {
      frozen=frozen.applyEvent(event,0);
      corrected=new DocumentEventImpl(frozen,event.getOffset(),event.getOldFragment(),event.getNewFragment(),event.getOldTimeStamp(),event.isWholeTextReplaced(),((DocumentEventImpl)event).getInitialStartOffset(),((DocumentEventImpl)event).getInitialOldLength());
    }
    map.forEachEntry(new TLongObjectProcedure<ManualRangeMarker>(){
      @Override public boolean execute(      long key,      ManualRangeMarker currentRange){
        if (currentRange != null) {
          map.put(key,currentRange.getUpdatedRange(corrected));
        }
        return true;
      }
    }
);
  }
  return frozen;
}
