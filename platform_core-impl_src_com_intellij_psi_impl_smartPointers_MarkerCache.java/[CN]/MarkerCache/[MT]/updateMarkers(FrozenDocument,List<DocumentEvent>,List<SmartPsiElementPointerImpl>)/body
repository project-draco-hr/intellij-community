{
  Map<Trinity,ManualRangeMarker> updated=getUpdatedMarkers(frozen,events);
  myMarkerSet.clear();
  for (  SmartPsiElementPointerImpl pointer : pointers) {
    SmartPointerElementInfo info=pointer.getElementInfo();
    if (info instanceof SelfElementInfo) {
      ManualRangeMarker marker=((SelfElementInfo)info).getRangeMarker();
      Trinity key=marker == null ? null : keyOf(marker);
      if (key != null) {
        marker.applyState(updated.get(key));
        ((SelfElementInfo)info).updateValidity();
        myMarkerSet.add(marker);
      }
    }
  }
  myByRange=null;
  myUpdatedRanges=null;
}
