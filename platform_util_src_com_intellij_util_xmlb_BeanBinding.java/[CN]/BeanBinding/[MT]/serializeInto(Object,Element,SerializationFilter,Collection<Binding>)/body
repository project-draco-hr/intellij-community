{
  for (  Binding binding : (bindings == null ? myPropertyBindings.keySet() : bindings)) {
    Accessor accessor=myPropertyBindings.get(binding);
    if (accessor == null) {
      LOG.warn("Illegal state: accessor null, " + binding.toString());
      continue;
    }
    if (!filter.accepts(accessor,o)) {
      continue;
    }
    Property property=accessor.getAnnotation(Property.class);
    if (property != null && property.filter() != SerializationFilter.class && !ReflectionUtil.newInstance(property.filter()).accepts(accessor,o)) {
      continue;
    }
    if (element == null) {
      element=new Element(myTagName);
    }
    Object node=binding.serialize(o,element,filter);
    if (node != null) {
      if (node instanceof org.jdom.Attribute) {
        element.setAttribute((org.jdom.Attribute)node);
      }
 else {
        JDOMUtil.addContent(element,node);
      }
    }
  }
  return element;
}
