{
  File targetDir=IoTestUtil.createTestDir(myTempDirectory,"failed_delete");
  File file=IoTestUtil.createTestFile(targetDir,"file");
  if (SystemInfo.isWindows) {
    @SuppressWarnings("IOResourceOpenedButNotSafelyClosed") RandomAccessFile rw=new RandomAccessFile(file,"rw");
    FileLock lock=null;
    try {
      lock=rw.getChannel().tryLock();
      assertFalse(FileUtil.delete(file));
    }
  finally {
      if (lock != null) {
        lock.release();
      }
      rw.close();
    }
  }
 else {
    assertEquals(0,new ProcessBuilder("chmod","a-w",file.getParentFile().getPath()).start().waitFor());
    try {
      assertFalse(FileUtil.delete(file));
    }
  finally {
      assertEquals(0,new ProcessBuilder("chmod","a+w",file.getParentFile().getPath()).start().waitFor());
    }
  }
}
