{
  File tempDir=createTempDirectory();
  assertTrue(new File(tempDir,"x.jar").createNewFile());
  VirtualFile vDir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDir);
  assertNotNull(vDir);
  final VirtualFile jar=vDir.findChild("x.jar");
  assertNotNull(jar);
  final JarFileSystem fs=JarFileSystem.getInstance();
  final NewVirtualFile root=ManagingFS.getInstance().findRoot(jar.getPath() + "!/",fs);
  PlatformTestUtil.startPerformanceTest("find root is slow",500,new ThrowableRunnable(){
    @Override public void run() throws Throwable {
      final String path=jar.getPath() + "!/";
      JobLauncher.getInstance().invokeConcurrentlyUnderProgress(Collections.nCopies(500,null),null,false,new Processor<Object>(){
        @Override public boolean process(        Object o){
          for (int i=0; i < 1000; i++) {
            NewVirtualFile rootJar=ManagingFS.getInstance().findRoot(path,fs);
            assertNotNull(rootJar);
            assertSame(root,rootJar);
          }
          return true;
        }
      }
);
    }
  }
).assertTiming();
}
