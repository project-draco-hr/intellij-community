{
  if (element instanceof PsiElement) {
    final PsiElement psiElement=(PsiElement)element;
    return ApplicationManager.getApplication().runReadAction(new Computable<Object>(){
      @Override public Object compute(){
        PsiAnchor anchor=psiElement.getUserData(PSI_ANCHORIZER_ANCHOR);
        if (!psiElement.isValid()) {
          return anchor != null ? anchor : psiElement;
        }
        if (anchor == null || anchor.retrieve() != psiElement) {
          psiElement.putUserData(PSI_ANCHORIZER_ANCHOR,anchor=PsiAnchor.create(psiElement));
        }
        return anchor;
      }
    }
);
  }
  return super.createAnchor(element);
}
