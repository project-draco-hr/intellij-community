{
  if (element instanceof PsiElement) {
    final PsiElement psiElement=(PsiElement)element;
    return ApplicationManager.getApplication().runReadAction(new Computable<Object>(){
      @Override public Object compute(){
        SmartPsiElementPointer pointer=psiElement.getUserData(PSI_ANCHORIZER_POINTER);
        if (!psiElement.isValid()) {
          return pointer != null ? pointer : psiElement;
        }
        if (pointer == null || pointer.getElement() != psiElement) {
          pointer=SmartPointerManager.getInstance(psiElement.getProject()).createSmartPsiElementPointer(psiElement);
          psiElement.putUserData(PSI_ANCHORIZER_POINTER,pointer);
        }
        return pointer;
      }
    }
);
  }
  return super.createAnchor(element);
}
