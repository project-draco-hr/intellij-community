{
  if (element instanceof PsiElement) {
    final PsiElement psiElement=(PsiElement)element;
    return ApplicationManager.getApplication().runReadAction(new Computable<Object>(){
      @Override public Object compute(){
        SmartPointerWrapper pointer=psiElement.getUserData(PSI_ANCHORIZER_POINTER);
        if (!psiElement.isValid()) {
          return pointer != null ? pointer : psiElement;
        }
        if (pointer == null || pointer.myPointer.getElement() != psiElement) {
          Project project=psiElement.getProject();
          SmartPsiElementPointer<PsiElement> psiElementPointer=SmartPointerManager.getInstance(project).createSmartPsiElementPointer(psiElement);
          pointer=new SmartPointerWrapper(psiElementPointer);
          psiElement.putUserData(PSI_ANCHORIZER_POINTER,pointer);
        }
        return pointer;
      }
    }
);
  }
  return super.createAnchor(element);
}
