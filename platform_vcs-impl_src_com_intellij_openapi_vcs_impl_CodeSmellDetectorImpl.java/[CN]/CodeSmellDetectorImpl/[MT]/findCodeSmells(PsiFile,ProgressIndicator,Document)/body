{
  final List<CodeSmellInfo> result=new ArrayList<CodeSmellInfo>();
  final DaemonCodeAnalyzerImpl codeAnalyzer=(DaemonCodeAnalyzerImpl)DaemonCodeAnalyzer.getInstance(myProject);
  List<HighlightInfo> infos=ApplicationManager.getApplication().runReadAction(new Computable<List<HighlightInfo>>(){
    @Override public List<HighlightInfo> compute(){
      return codeAnalyzer.runMainPasses(psiFile,document,progress);
    }
  }
);
  collectErrorsAndWarnings(infos,result,document);
  return result;
}
