{
  final Set<ImportOptimizer> optimizers=LanguageImportStatements.INSTANCE.forFile(file);
  final List<Runnable> runnables=new ArrayList<Runnable>();
  List<PsiFile> files=file.getViewProvider().getAllFiles();
  for (  ImportOptimizer optimizer : optimizers) {
    for (    PsiFile psiFile : files) {
      if (optimizer.supports(psiFile)) {
        runnables.add(optimizer.processFile(psiFile));
      }
    }
  }
  final ImportOptimizer optimizer=getInfoCollector() != null && optimizers.size() == 1 ? optimizers.iterator().next() : null;
  Runnable runnable=!runnables.isEmpty() ? new Runnable(){
    @Override public void run(){
      CodeStyleManagerImpl.setSequentialProcessingAllowed(false);
      try {
        for (        Runnable runnable : runnables) {
          runnable.run();
        }
        if (optimizer != null) {
          String message=retrieveMessage(optimizer);
          getInfoCollector().setOptimizeImportsNotification(message);
        }
      }
  finally {
        CodeStyleManagerImpl.setSequentialProcessingAllowed(true);
      }
    }
  }
 : EmptyRunnable.getInstance();
  return new FutureTask<Boolean>(runnable,true);
}
