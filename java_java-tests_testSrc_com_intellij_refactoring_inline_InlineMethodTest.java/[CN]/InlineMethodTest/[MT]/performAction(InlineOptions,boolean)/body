{
  PsiElement element=TargetElementUtil.findTargetElement(myEditor,TargetElementUtil.ELEMENT_NAME_ACCEPTED | TargetElementUtil.REFERENCED_ELEMENT_ACCEPTED);
  final PsiReference ref=myFile.findReferenceAt(myEditor.getCaretModel().getOffset());
  if (ref instanceof PsiJavaCodeReferenceElement) {
    final PsiElement parent=((PsiJavaCodeReferenceElement)ref).getParent();
    if (parent instanceof PsiNewExpression) {
      element=((PsiNewExpression)parent).resolveConstructor();
    }
  }
  PsiReferenceExpression refExpr=ref instanceof PsiReferenceExpression ? (PsiReferenceExpression)ref : null;
  assertTrue(element instanceof PsiMethod);
  PsiMethod method=(PsiMethod)element.getNavigationElement();
  final boolean condition=InlineMethodProcessor.checkBadReturns(method) && !InlineUtil.allUsagesAreTailCalls(method);
  assertFalse("Bad returns found",condition);
  final InlineMethodProcessor processor=new InlineMethodProcessor(getProject(),method,refExpr,myEditor,options.isInlineThisOnly(),nonCode,nonCode);
  processor.run();
}
