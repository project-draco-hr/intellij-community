{
  final ProgressManager progman=ProgressManager.getInstance();
  final Sdk basicSdk=getSdk();
  final Task.Modal createTask=new Task.Modal(myProject,"Creating virtual environment for " + basicSdk.getName(),false){
    String myPath;
    public void run(    @NotNull final ProgressIndicator indicator){
      final PyPackageManagerImpl packageManager=(PyPackageManagerImpl)PyPackageManager.getInstance(basicSdk);
      try {
        indicator.setText("Creating virtual environment for " + basicSdk.getName());
        myPath=packageManager.createVirtualEnv(getDestination(),useGlobalSitePackages());
      }
 catch (      final PyExternalProcessException e) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            packageManager.showInstallationError(getOwner(),"Failed to Create Virtual Environment",e.toString());
          }
        }
,ModalityState.any());
      }
    }
    @Override public void onSuccess(){
      if (myPath != null) {
        final Application application=ApplicationManager.getApplication();
        application.invokeLater(new Runnable(){
          @Override public void run(){
            setupVirtualEnvSdk(allSdks,myPath,associateWithProject(),setAsProjectInterpreter(),callback);
          }
        }
,ModalityState.any());
      }
    }
  }
;
  progman.run(createTask);
}
