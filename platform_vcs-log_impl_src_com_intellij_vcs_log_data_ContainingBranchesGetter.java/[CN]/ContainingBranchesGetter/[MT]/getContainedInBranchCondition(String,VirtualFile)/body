{
  LOG.assertTrue(EventQueue.isDispatchThread());
  DataPack dataPack=myDataManager.getDataPack();
  if (dataPack == DataPack.EMPTY)   return Conditions.alwaysFalse();
  PermanentGraph<Integer> graph=dataPack.getPermanentGraph();
  VcsLogRefs refs=dataPack.getRefsModel();
  VcsRef branchRef=ContainerUtil.find(refs.getBranches(),new Condition<VcsRef>(){
    @Override public boolean value(    VcsRef vcsRef){
      return vcsRef.getRoot().equals(root) && vcsRef.getName().equals(branchName);
    }
  }
);
  if (branchRef == null)   return Conditions.alwaysFalse();
  ContainedInBranchCondition condition=myConditions.get(root);
  if (condition == null || !condition.getBranch().equals(branchName)) {
    condition=new ContainedInBranchCondition(graph.getContainedInBranchCondition(Collections.singleton(myDataManager.getCommitIndex(branchRef.getCommitHash(),branchRef.getRoot()))),branchName);
    myConditions.put(root,condition);
  }
  return condition;
}
