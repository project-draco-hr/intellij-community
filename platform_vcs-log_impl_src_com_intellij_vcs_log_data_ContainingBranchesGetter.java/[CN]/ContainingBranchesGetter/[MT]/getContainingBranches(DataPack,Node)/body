{
  RefsModel refsModel=dataPack.getRefsModel();
  Set<VcsRef> containingBranches=ContainerUtil.newHashSet();
  Set<Node> visitedNodes=ContainerUtil.newHashSet();
  Set<Node> nodesToCheck=ContainerUtil.newHashSet();
  nodesToCheck.add(node);
  while (!nodesToCheck.isEmpty()) {
    Iterator<Node> nodeIterator=nodesToCheck.iterator();
    Node nextNode=nodeIterator.next();
    nodeIterator.remove();
    if (!visitedNodes.add(nextNode)) {
      continue;
    }
    for (    Edge edge : nextNode.getUpEdges()) {
      Node upNode=edge.getUpNode();
      List<VcsRef> upRefs=myCache.get(upNode);
      if (upRefs != null) {
        containingBranches.addAll(upRefs);
      }
 else {
        nodesToCheck.add(upNode);
      }
    }
    containingBranches.addAll(getBranchesPointingToThisNode(refsModel,nextNode));
  }
  return sortByName(containingBranches);
}
