{
  if (!GithubUtil.testGitExecutable(project)) {
    return;
  }
  BasicAction.saveAll();
  final GithubAuthData auth=GithubUtil.getAuthData();
  final AtomicReference<List<RepositoryInfo>> repositoryInfoRef=new AtomicReference<List<RepositoryInfo>>();
  ProgressManager.getInstance().run(new Task.Modal(project,"Access to GitHub",true){
    public void run(    @NotNull ProgressIndicator indicator){
      try {
        final List<RepositoryInfo> repositoryInfo=GithubUtil.runAndValidateAuth(project,auth,indicator,new ThrowableComputable<List<RepositoryInfo>,IOException>(){
          @Override public List<RepositoryInfo> compute() throws IOException {
            return GithubUtil.getAvailableRepos(auth);
          }
        }
);
        repositoryInfoRef.set(repositoryInfo);
      }
 catch (      IOException e) {
        LOG.info(e);
        GithubUtil.notifyError(project,"Couldn't get the list of GitHub repositories",GithubUtil.getErrorTextFromException(e));
      }
    }
  }
);
  final List<RepositoryInfo> availableRepos=repositoryInfoRef.get();
  if (availableRepos == null) {
    return;
  }
  Collections.sort(availableRepos,new Comparator<RepositoryInfo>(){
    @Override public int compare(    final RepositoryInfo r1,    final RepositoryInfo r2){
      final int comparedOwners=r1.getOwnerName().compareTo(r2.getOwnerName());
      return comparedOwners != 0 ? comparedOwners : r1.getName().compareTo(r2.getName());
    }
  }
);
  final GitCloneDialog dialog=new GitCloneDialog(project);
  for (int i=availableRepos.size() - 1; i >= 0; i--) {
    dialog.prependToHistory(availableRepos.get(i).getCloneUrl());
  }
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  dialog.rememberSettings();
  final VirtualFile destinationParent=LocalFileSystem.getInstance().findFileByIoFile(new File(dialog.getParentDirectory()));
  if (destinationParent == null) {
    return;
  }
  final String sourceRepositoryURL=dialog.getSourceRepositoryURL();
  final String directoryName=dialog.getDirectoryName();
  final String parentDirectory=dialog.getParentDirectory();
  Git git=ServiceManager.getService(Git.class);
  GitCheckoutProvider.clone(project,git,listener,destinationParent,sourceRepositoryURL,directoryName,parentDirectory);
}
