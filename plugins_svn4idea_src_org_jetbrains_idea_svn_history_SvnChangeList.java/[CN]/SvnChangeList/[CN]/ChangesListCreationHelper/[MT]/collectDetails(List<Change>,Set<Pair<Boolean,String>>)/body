{
  List<Change> result=ContainerUtil.newArrayList();
  for (  Change change : changes) {
    if ((change.getAfterRevision() == null) && (change.getBeforeRevision().getFile().isDirectory())) {
      result.addAll(getChildrenAsChanges(change.getBeforeRevision(),true,duplicates));
    }
 else     if ((change.getBeforeRevision() == null) && (change.getAfterRevision().getFile().isDirectory())) {
      if (myCopiedAddedPaths.containsKey(getRelativePath(change.getAfterRevision()))) {
        result.addAll(getChildrenAsChanges(change.getAfterRevision(),false,duplicates));
      }
    }
 else     if ((change.isIsReplaced() || change.isMoved() || change.isRenamed()) && change.getAfterRevision().getFile().isDirectory()) {
      result.addAll(getChildrenAsChanges(change.getBeforeRevision(),true,duplicates));
      result.addAll(getChildrenAsChanges(change.getAfterRevision(),false,duplicates));
    }
  }
  return result;
}
