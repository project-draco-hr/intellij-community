{
  Promise<T> oldValue=ref.getAndSet(null);
  if (oldValue instanceof AsyncPromise) {
    rejectAndDispose((AsyncPromise<T>)oldValue);
  }
}
