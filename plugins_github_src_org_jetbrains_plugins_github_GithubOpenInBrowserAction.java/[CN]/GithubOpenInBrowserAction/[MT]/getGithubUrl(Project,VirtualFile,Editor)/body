{
  GitRepositoryManager manager=GitUtil.getRepositoryManager(project);
  final GitRepository repository=manager.getRepositoryForFile(virtualFile);
  if (repository == null) {
    StringBuilder details=new StringBuilder("file: " + virtualFile.getPresentableUrl() + "; Git repositories: ");
    for (    GitRepository repo : manager.getRepositories()) {
      details.append(repo.getPresentableUrl()).append("; ");
    }
    GithubNotifications.showError(project,CANNOT_OPEN_IN_BROWSER,"Can't find git repository",details.toString());
    return null;
  }
  final String githubRemoteUrl=GithubUtil.findGithubRemoteUrl(repository);
  if (githubRemoteUrl == null) {
    GithubNotifications.showError(project,CANNOT_OPEN_IN_BROWSER,"Can't find github remote");
    return null;
  }
  String relativePath=VfsUtilCore.getRelativePath(virtualFile,repository.getRoot());
  if (relativePath == null) {
    GithubNotifications.showError(project,CANNOT_OPEN_IN_BROWSER,"File is not under repository root","Root: " + repository.getRoot().getPresentableUrl() + ", file: "+ virtualFile.getPresentableUrl());
    return null;
  }
  String hash=getCurrentFileRevisionHash(project,virtualFile);
  if (hash != null) {
    return makeUrlToOpen(editor,relativePath,hash,githubRemoteUrl);
  }
  GithubNotifications.showError(project,CANNOT_OPEN_IN_BROWSER,"Can't get last revision.");
  return null;
}
