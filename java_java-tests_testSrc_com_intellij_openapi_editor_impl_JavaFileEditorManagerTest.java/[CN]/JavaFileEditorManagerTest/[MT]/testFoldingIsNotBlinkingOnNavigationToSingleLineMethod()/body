{
  VirtualFile file=getFile("/src/Bar.java");
  PsiJavaFile psiFile=(PsiJavaFile)getPsiManager().findFile(file);
  assertNotNull(psiFile);
  PsiMethod method=psiFile.getClasses()[0].getMethods()[0];
  method.navigate(true);
  FileEditor[] editors=myManager.getEditors(file);
  assertEquals(1,editors.length);
  Editor editor=((TextEditor)editors[0]).getEditor();
  FoldRegion[] regions=editor.getFoldingModel().getAllFoldRegions();
  assertEquals(2,regions.length);
  assertTrue(regions[0].isExpanded());
  assertTrue(regions[1].isExpanded());
  EditorTestUtil.runTextEditorHighlightingPass(editor,CodeFoldingPassFactory.class);
  regions=editor.getFoldingModel().getAllFoldRegions();
  assertEquals(2,regions.length);
  assertTrue(regions[0].isExpanded());
  assertTrue(regions[1].isExpanded());
}
