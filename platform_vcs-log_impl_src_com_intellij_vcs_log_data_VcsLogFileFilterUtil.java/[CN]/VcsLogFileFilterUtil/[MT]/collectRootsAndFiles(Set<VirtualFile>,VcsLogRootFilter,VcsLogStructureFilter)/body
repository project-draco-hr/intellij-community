{
  if (rootFilter == null && structureFilter == null)   return Pair.create(roots,MultiMap.<VirtualFile,VirtualFile>create());
  if (structureFilter == null) {
    return Pair.create((Set<VirtualFile>)new HashSet<VirtualFile>(rootFilter.getRoots()),MultiMap.<VirtualFile,VirtualFile>create());
  }
  Pair<Set<VirtualFile>,MultiMap<VirtualFile,VirtualFile>> selectedRootsAndFiles=collectRoots(structureFilter.getFiles(),roots);
  if (rootFilter == null) {
    return selectedRootsAndFiles;
  }
  return Pair.create(ContainerUtil.union(new HashSet<VirtualFile>(rootFilter.getRoots()),selectedRootsAndFiles.first),selectedRootsAndFiles.second);
}
