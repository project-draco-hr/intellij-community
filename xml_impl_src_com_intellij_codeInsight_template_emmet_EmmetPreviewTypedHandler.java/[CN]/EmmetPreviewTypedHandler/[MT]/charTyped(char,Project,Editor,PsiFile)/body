{
  EmmetPreviewHint existingBalloon=EmmetPreviewHint.getExistingHint(editor);
  if (existingBalloon == null) {
    String templateText=calculateTemplateText(editor,file);
    if (!StringUtil.isEmpty(templateText)) {
      EmmetPreviewHint previewBalloon=EmmetPreviewHint.createHint(editor,templateText,file.getFileType());
      previewBalloon.showHint();
      editor.getDocument().addDocumentListener(new DocumentAdapter(){
        @Override public void documentChanged(        @NotNull DocumentEvent e){
          EmmetPreviewHint existingHint=EmmetPreviewHint.getExistingHint(editor);
          if (existingHint != null) {
            existingHint.updateText(calculateTemplateText(editor,file));
          }
 else {
            e.getDocument().removeDocumentListener(this);
          }
        }
      }
);
      editor.getCaretModel().addCaretListener(new CaretAdapter(){
        @Override public void caretPositionChanged(        @NotNull CaretEvent e){
          EmmetPreviewHint existingHint=EmmetPreviewHint.getExistingHint(e.getEditor());
          if (existingHint != null) {
            existingHint.updateText(calculateTemplateText(editor,file));
          }
 else {
            e.getEditor().getCaretModel().removeCaretListener(this);
          }
        }
      }
);
    }
  }
  return super.charTyped(c,project,editor,file);
}
