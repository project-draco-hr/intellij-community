{
  String name="";
  try {
    String enc=System.getenv("HGENCODING");
    if (enc != null && enc.length() > 0 && Charset.isSupported(enc)) {
      name=enc;
    }
 else {
      name=EncodingProjectManager.getInstance(project).getDefaultCharsetName();
    }
    if (!StringUtil.isEmptyOrSpaces(name)) {
      return Charset.forName(name);
    }
  }
 catch (  Exception e) {
    LOG.info("Couldn't find encoding " + name,e);
  }
  return Charset.defaultCharset();
}
