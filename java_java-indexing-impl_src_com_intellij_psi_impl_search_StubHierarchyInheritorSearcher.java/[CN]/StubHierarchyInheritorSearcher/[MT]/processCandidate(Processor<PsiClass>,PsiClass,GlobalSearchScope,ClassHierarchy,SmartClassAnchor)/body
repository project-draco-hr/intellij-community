{
  VirtualFile file=anchor.retrieveFile();
  if (!scope.contains(file))   return true;
  PsiClass candidate=anchor.retrieveClass(base.getProject());
  if (!PsiSearchScopeUtil.isInScope(candidate.getResolveScope(),base))   return true;
  if (hierarchy.hasAmbiguousSupers(anchor) && !candidate.isInheritor(base,false))   return true;
  return consumer.process(candidate);
}
