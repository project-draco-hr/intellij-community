{
  final PyExpression qualifier=getQualifier();
  if (qualifier != null) {
    PyType qualifierType=qualifier.getType();
    ProcessingContext ctx=new ProcessingContext();
    final Set<String> names_already=new HashSet<String>();
    ctx.put(PyType.CTX_NAMES,names_already);
    if (qualifierType != null) {
      Collection<Object> variants=new ArrayList<Object>();
      if (qualifier instanceof PyQualifiedExpression) {
        Collection<PyExpression> attrs=collectAssignedAttributes((PyQualifiedExpression)qualifier);
        variants.addAll(attrs);
        for (        PyExpression ex : attrs) {
          if (ex instanceof PyReferenceExpression) {
            PyReferenceExpression refex=(PyReferenceExpression)ex;
            names_already.add(refex.getReferencedName());
          }
        }
        Collections.addAll(variants,qualifierType.getCompletionVariants(this,ctx));
        return variants.toArray();
      }
 else       return qualifierType.getCompletionVariants(this,ctx);
    }
    return NO_VARIANTS;
  }
  if (PsiTreeUtil.getParentOfType(this,PyImportElement.class,PyFromImportStatement.class) != null) {
    return ResolveImportUtil.suggestImportVariants(this);
  }
  List<Object> ret=new ArrayList<Object>();
  LookupElementFactory factory=LookupElementFactory.getInstance();
  final VariantsProcessor processor=new VariantsProcessor();
  PyResolveUtil.treeCrawlUp(processor,this);
  PyCallExpression call_expr=PsiTreeUtil.getParentOfType(this,PyCallExpression.class);
  if (call_expr != null) {
    PyExpression callee=call_expr.getCallee();
    if (callee instanceof PyReferenceExpression) {
      PsiElement def=((PyReferenceExpression)callee).resolve();
      if (def instanceof PyFunction) {
        for (        PyParameter param : ((PyFunction)def).getParameterList().getParameters()) {
          if (!param.isKeywordContainer() && !param.isPositionalContainer()) {
            LookupItem item=(LookupItem)factory.createLookupElement(param.getName() + "=");
            item.setIcon(param.getIcon(0));
            ret.add(item);
          }
        }
      }
    }
  }
  CollectProcessor collect_proc;
  collect_proc=new CollectProcessor(PyStarImportElement.class);
  PyResolveUtil.treeCrawlUp(collect_proc,this);
  List<PsiElement> stars=collect_proc.getResult();
  for (  PsiElement star_elt : stars) {
    final PyFromImportStatement from_import_stmt=(PyFromImportStatement)star_elt.getParent();
    if (from_import_stmt != null) {
      final PyReferenceExpression import_src=from_import_stmt.getImportSource();
      if (import_src != null) {
        processor.setNotice(" | " + import_src.getName());
        PyResolveUtil.treeCrawlUp(processor,true,import_src.resolve());
      }
    }
  }
  processor.setNotice(" | __builtin__");
  PyResolveUtil.treeCrawlUp(processor,true,PyBuiltinCache.getInstance(getProject()).getBuiltinsFile());
  PsiFile f=getContainingFile();
  if (f instanceof PyFile) {
    for (    String name : PyModuleType.getPossibleInstanceMembers()) {
      LookupItem item=(LookupItem)factory.createLookupElement(name);
      item.setIcon(Icons.FIELD_ICON);
      ret.add(item);
    }
  }
  ret.addAll(processor.getResultList());
  return ret.toArray();
}
