{
  final String referencedName=getReferencedName();
  if (referencedName == null)   return null;
  if (PsiTreeUtil.getParentOfType(this,PyImportElement.class,PyFromImportStatement.class) != null) {
    PsiElement target=ResolveImportUtil.resolveImportReference(this);
    if (target instanceof PsiDirectory) {
      final PsiDirectory dir=(PsiDirectory)target;
      final PsiFile file=dir.findFile(ResolveImportUtil.INIT_PY);
      if (file != null) {
        target=file;
        file.putCopyableUserData(PyFile.KEY_IS_DIRECTORY,Boolean.TRUE);
      }
    }
    return target;
  }
  final PyExpression qualifier=getQualifier();
  if (qualifier != null) {
    PyType qualifierType=qualifier.getType();
    if (qualifierType != null) {
      return qualifierType.resolveMember(referencedName);
    }
    return null;
  }
  return PyResolveUtil.treeWalkUp(new PyResolveUtil.ResolveProcessor(referencedName),this,this,null);
}
