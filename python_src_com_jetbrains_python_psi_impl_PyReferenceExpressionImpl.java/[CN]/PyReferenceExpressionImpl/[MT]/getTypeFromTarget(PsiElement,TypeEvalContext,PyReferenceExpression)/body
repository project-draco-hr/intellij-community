{
  final PyType pyType=getReferenceTypeFromProviders(target,context);
  if (pyType != null) {
    return pyType;
  }
  if (target instanceof PyTargetExpression) {
    final String name=((PyTargetExpression)target).getName();
    if (PyNames.NONE.equals(name)) {
      return PyNoneType.INSTANCE;
    }
    if (PyNames.TRUE.equals(name) || PyNames.FALSE.equals(name)) {
      return PyBuiltinCache.getInstance(target).getBoolType();
    }
  }
  if (target instanceof PyFile) {
    return new PyModuleType((PyFile)target);
  }
  if (target instanceof PyImportedModule) {
    return new PyImportedModuleType((PyImportedModule)target);
  }
  if ((target instanceof PyTargetExpression || target instanceof PyNamedParameter) && context.allowDataFlow() && anchor != null) {
    final ScopeOwner scopeOwner=PsiTreeUtil.getParentOfType(anchor,ScopeOwner.class);
    if (scopeOwner != null && scopeOwner == PsiTreeUtil.getParentOfType(target,ScopeOwner.class)) {
      PyAugAssignmentStatement augAssignment=PsiTreeUtil.getParentOfType(anchor,PyAugAssignmentStatement.class);
      try {
        final PyElement[] defs=PyDefUseUtil.getLatestDefs(scopeOwner,(PyElement)target,augAssignment != null ? augAssignment : anchor);
        if (defs.length > 0) {
          PyType type=getTypeIfExpr(defs[0],context);
          for (int i=1; i < defs.length; i++) {
            type=PyUnionType.union(type,getTypeIfExpr(defs[i],context));
          }
          return type;
        }
      }
 catch (      PyDefUseUtil.InstructionNotFoundException e) {
      }
    }
  }
  if (target instanceof PyNamedParameter && target.getParent() instanceof PyParameterList) {
    PyFunction containingFunc=PsiTreeUtil.getParentOfType(target,PyFunction.class);
    if (containingFunc != null) {
      final String docString=PyUtil.strValue(containingFunc.getDocStringExpression());
      if (docString != null) {
        EpydocString epydocString=new EpydocString(docString);
        String typeName=epydocString.getParamType(((PyNamedParameter)target).getName());
        if (typeName != null) {
          return PyTypeParser.getTypeByName(target,typeName);
        }
      }
    }
  }
  if (target instanceof PyExpression) {
    return context.getType((PyExpression)target);
  }
  if (target instanceof PyClass) {
    return new PyClassType((PyClass)target,true);
  }
  if (target instanceof PsiDirectory) {
    PsiFile file=((PsiDirectory)target).findFile(PyNames.INIT_DOT_PY);
    if (file != null)     return getTypeFromTarget(file,context,anchor);
  }
  return null;
}
