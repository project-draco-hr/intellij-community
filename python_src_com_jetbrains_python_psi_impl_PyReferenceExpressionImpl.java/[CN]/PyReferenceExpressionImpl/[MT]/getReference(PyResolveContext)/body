{
  final PsiFile file=getContainingFile();
  final PyExpression qualifier=getQualifier();
  final boolean inCythonFile=CythonLanguageDialect.isInsideCythonFile(this);
  if (inCythonFile) {
    if (PsiTreeUtil.getParentOfType(this,CythonCImportElement.class,CythonFromCImportStatement.class) != null) {
      return new CythonImportReference(this,context);
    }
  }
  final PsiElement importParent=PsiTreeUtil.getParentOfType(this,PyImportElement.class,PyFromImportStatement.class);
  if (importParent != null) {
    return PyImportReference.forElement(this,importParent,context);
  }
  final ConsoleCommunication communication=file.getCopyableUserData(PydevConsoleRunner.CONSOLE_KEY);
  if (communication != null) {
    if (qualifier != null) {
      return new PydevConsoleReference(this,communication,qualifier.getText() + ".");
    }
    return new PydevConsoleReference(this,communication,"");
  }
  if (qualifier != null) {
    return new PyQualifiedReference(this,context);
  }
  if (inCythonFile) {
    return new CythonReference(this,context);
  }
  return new PyReferenceImpl(this,context);
}
