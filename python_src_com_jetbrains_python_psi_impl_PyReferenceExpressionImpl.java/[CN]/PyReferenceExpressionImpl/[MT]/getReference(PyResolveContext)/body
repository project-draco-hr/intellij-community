{
  final PsiFile file=getContainingFile();
  final PyExpression qualifier=getQualifier();
  if (PsiTreeUtil.getParentOfType(this,CythonCImportElement.class,CythonFromCImportStatement.class) != null) {
    return new CythonImportReference(this,context);
  }
 else   if (PsiTreeUtil.getParentOfType(this,PyImportElement.class,PyFromImportStatement.class) != null) {
    return new PyImportReferenceImpl(this,context);
  }
  if (file != null) {
    final ConsoleCommunication communication=file.getCopyableUserData(PydevConsoleRunner.CONSOLE_KEY);
    if (communication != null) {
      if (qualifier != null) {
        return new PydevConsoleReference(this,communication,qualifier.getText() + ".");
      }
      return new PydevConsoleReference(this,communication,"");
    }
  }
  if (qualifier != null) {
    return new PyQualifiedReferenceImpl(this,context);
  }
  return new PyReferenceImpl(this,context);
}
