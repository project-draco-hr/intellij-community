{
  final PsiFile file=getContainingFile();
  final PyExpression qualifier=getQualifier();
  final PsiElement importParent=PsiTreeUtil.getParentOfType(this,PyImportElement.class,PyFromImportStatement.class);
  if (importParent != null) {
    return PyImportReference.forElement(this,importParent,context);
  }
  final ConsoleCommunication communication=file.getCopyableUserData(PydevConsoleRunner.CONSOLE_KEY);
  if (communication != null) {
    if (qualifier != null) {
      return new PydevConsoleReference(this,communication,qualifier.getText() + ".",context.allowRemote());
    }
    return new PydevConsoleReference(this,communication,"",context.allowRemote());
  }
  if (qualifier != null) {
    return new PyQualifiedReference(this,context);
  }
  return new PyReferenceImpl(this,context);
}
