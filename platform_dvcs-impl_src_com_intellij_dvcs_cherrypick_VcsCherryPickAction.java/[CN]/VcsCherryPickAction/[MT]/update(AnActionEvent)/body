{
  super.update(e);
  e.getPresentation().setVisible(true);
  final VcsLog log=e.getData(VcsLogDataKeys.VCS_LOG);
  Project project=getEventProject(e);
  final List<VcsCherryPicker> cherryPickers=getActiveCherryPickersForProject(project);
  if (log == null || cherryPickers.isEmpty()) {
    e.getPresentation().setEnabledAndVisible(false);
    return;
  }
  List<CommitId> details=VcsLogUtil.collectFirstPack(log.getSelectedCommits(),VcsLogUtil.COMMITS_LIMIT);
  final Map<VirtualFile,List<Hash>> groupedByRoot=groupByRoot(details);
  VcsCherryPicker enabledCherryPicker=ContainerUtil.find(cherryPickers,new Condition<VcsCherryPicker>(){
    @Override public boolean value(    VcsCherryPicker picker){
      return picker.isEnabled(log,groupedByRoot);
    }
  }
);
  e.getPresentation().setEnabled(enabledCherryPicker != null);
  e.getPresentation().setText(enabledCherryPicker == null ? concatActionNamesForAllAvailable(cherryPickers) : enabledCherryPicker.getActionTitle());
}
