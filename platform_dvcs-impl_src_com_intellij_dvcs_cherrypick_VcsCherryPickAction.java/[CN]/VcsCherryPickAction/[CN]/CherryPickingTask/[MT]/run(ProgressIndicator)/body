{
  try {
    boolean isOk=true;
    for (    VcsFullCommitDetails details : myAllCommits) {
      if (!processDetails(details)) {
        isOk=false;
        break;
      }
    }
    if (isOk) {
      for (      Map.Entry<VcsCherryPicker,List<VcsFullCommitDetails>> entry : myGroupedCommits.entrySet()) {
        entry.getKey().cherryPick(sortCommits(entry.getValue()));
      }
    }
  }
  finally {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        myChangeListManagerEx.unblockModalNotifications();
        for (        VcsFullCommitDetails commit : myAllCommits) {
          myIdsInProgress.remove(commit.getId());
        }
      }
    }
);
  }
}
