{
  Module module=ModuleUtilCore.findModuleForPsiElement(ref);
  if (module != null) {
    if (target instanceof PsiClass && !(target instanceof PsiCompiledElement) && module != ModuleUtilCore.findModuleForPsiElement(target)) {
      PsiElement targetFile=target.getParent();
      if (targetFile instanceof PsiClassOwner) {
        PsiJavaModule targetModule=getModuleDescriptor(target);
        String packageName=((PsiClassOwner)targetFile).getPackageName();
        return checkPackageAccessibility(ref,refModule,targetModule,packageName);
      }
    }
 else     if (target instanceof PsiPackage) {
      PsiElement refImport=ref.getParent();
      if (refImport instanceof PsiImportStatementBase && ((PsiImportStatementBase)refImport).isOnDemand()) {
        PsiDirectory[] dirs=((PsiPackage)target).getDirectories(module.getModuleWithDependenciesAndLibrariesScope(false));
        if (dirs.length == 1 && ModuleUtilCore.findModuleForPsiElement(dirs[0]) != module) {
          PsiJavaModule targetModule=getModuleDescriptor(dirs[0]);
          String packageName=((PsiPackage)target).getQualifiedName();
          return checkPackageAccessibility(ref,refModule,targetModule,packageName);
        }
      }
    }
  }
  return null;
}
