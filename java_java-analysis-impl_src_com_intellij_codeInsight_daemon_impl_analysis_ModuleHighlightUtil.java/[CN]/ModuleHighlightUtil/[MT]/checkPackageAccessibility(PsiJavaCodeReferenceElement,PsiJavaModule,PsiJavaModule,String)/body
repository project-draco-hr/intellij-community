{
  if (!refModule.equals(targetModule)) {
    if (targetModule == null) {
      String message=JavaErrorMessages.message("module.package.on.classpath");
      return HighlightInfo.newHighlightInfo(HighlightInfoType.WRONG_REF).range(ref).description(message).create();
    }
    String refModuleName=refModule.getModuleName();
    String requiredName=targetModule.getModuleName();
    if (!(targetModule instanceof LightJavaModule || JavaModuleGraphUtil.exports(targetModule,packageName,refModule))) {
      String message=JavaErrorMessages.message("module.package.not.exported",requiredName,packageName,refModuleName);
      return HighlightInfo.newHighlightInfo(HighlightInfoType.WRONG_REF).range(ref).description(message).create();
    }
    if (!(PsiJavaModule.JAVA_BASE.equals(requiredName) || JavaModuleGraphUtil.reads(refModule,targetModule))) {
      String message=JavaErrorMessages.message("module.not.in.requirements",refModuleName,requiredName);
      HighlightInfo info=HighlightInfo.newHighlightInfo(HighlightInfoType.WRONG_REF).range(ref).description(message).create();
      QuickFixAction.registerQuickFixAction(info,new AddRequiredModuleFix(refModule,requiredName));
      return info;
    }
  }
  return null;
}
