{
  for (  FormatTextRange formatRange : ranges.getRanges()) {
    TextRange range=formatRange.getTextRange();
    final int rangeStart=range.getStartOffset();
    final int rangeEnd=range.getEndOffset();
    PsiElement lastElementInRange=findElementInTreeWithFormatterEnabled(file,rangeEnd);
    if (lastElementInRange instanceof PsiWhiteSpace && rangeStart < lastElementInRange.getTextRange().getStartOffset()) {
      PsiElement prev=lastElementInRange.getPrevSibling();
      if (prev != null) {
        int newEnd=prev.getTextRange().getEndOffset();
        formatRange.setTextRange(new TextRange(rangeStart,newEnd));
      }
    }
  }
}
