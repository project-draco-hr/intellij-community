{
  String annotationsPath=PathManagerEx.getTestDataPath() + "/codeInspection/bytecodeAnalysis/annotations";
  VirtualFile annotationsDir=LocalFileSystem.getInstance().refreshAndFindFileByPath(annotationsPath);
  assertNotNull(annotationsDir);
  ModuleRootModificationUtil.updateModel(myModule,new AsynchConsumer<ModifiableRootModel>(){
    @Override public void finished(){
    }
    @Override public void consume(    ModifiableRootModel modifiableRootModel){
      LibraryTable libraryTable=modifiableRootModel.getModuleLibraryTable();
      Library[] libs=libraryTable.getLibraries();
      for (      Library library : libs) {
        Library.ModifiableModel libraryModel=library.getModifiableModel();
        libraryModel.addRoot(annotationsDir,AnnotationOrderRootType.getInstance());
        libraryModel.commit();
      }
      Sdk sdk=modifiableRootModel.getSdk();
      if (sdk != null) {
        SdkModificator sdkModificator=sdk.getSdkModificator();
        sdkModificator.addRoot(annotationsDir,AnnotationOrderRootType.getInstance());
        sdkModificator.commitChanges();
      }
    }
  }
);
  VfsUtilCore.visitChildrenRecursively(annotationsDir,new VirtualFileVisitor(){
  }
);
  annotationsDir.refresh(false,true);
}
