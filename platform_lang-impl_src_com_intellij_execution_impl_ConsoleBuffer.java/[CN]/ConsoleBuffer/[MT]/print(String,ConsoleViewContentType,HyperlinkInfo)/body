{
  int numberOfSymbolsToProceed=text.length();
  int trimmedSymbolsNumber=myDeferredOutputLength;
  if (contentType != ConsoleViewContentType.USER_INPUT) {
    numberOfSymbolsToProceed=trimDeferredOutputIfNecessary(text.length());
    trimmedSymbolsNumber-=myDeferredOutputLength;
  }
 else {
    trimmedSymbolsNumber=0;
  }
  if (numberOfSymbolsToProceed <= 0) {
    return new Pair<>("",0);
  }
  if (numberOfSymbolsToProceed < text.length()) {
    text=text.substring(text.length() - numberOfSymbolsToProceed);
  }
  myDeferredTypes.add(contentType);
  text=StringUtil.convertLineSeparators(text,myKeepSlashR);
  myDeferredOutputLength+=text.length();
  StringBuilder bufferToUse;
  if (myDeferredOutput.isEmpty()) {
    myDeferredOutput.add(bufferToUse=new StringBuilder(myCyclicBufferUnitSize));
  }
 else {
    bufferToUse=myDeferredOutput.getLast();
  }
  int offset=0;
  while (offset < text.length()) {
    if (bufferToUse.length() >= myCyclicBufferUnitSize) {
      myDeferredOutput.add(bufferToUse=new StringBuilder(myCyclicBufferUnitSize));
    }
    if (bufferToUse.length() < myCyclicBufferUnitSize) {
      int numberOfSymbolsToAdd=Math.min(myCyclicBufferUnitSize - bufferToUse.length(),text.length() - offset);
      bufferToUse.append(text.substring(offset,offset + numberOfSymbolsToAdd));
      offset+=numberOfSymbolsToAdd;
    }
  }
  if (contentType == ConsoleViewContentType.USER_INPUT) {
    myDeferredUserInput.append(text);
  }
  ConsoleUtil.addToken(text.length(),info,contentType,myDeferredTokens);
  return new Pair<>(text,trimmedSymbolsNumber);
}
