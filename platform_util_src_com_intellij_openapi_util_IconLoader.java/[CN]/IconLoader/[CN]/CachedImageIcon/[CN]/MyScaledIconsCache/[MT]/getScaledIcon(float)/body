{
  float effectiveScale=scale * JBUI.scale(1f);
  SoftReference<Icon> val=scaledIconsCache.get(effectiveScale);
  Icon icon=val != null ? val.get() : null;
  if (icon == null) {
    boolean needRetinaImage=(effectiveScale >= 1.5f || UIUtil.isRetina());
    Image image=getOrigImage(needRetinaImage);
    if (image != null) {
      Icon realIcon=getRealIcon();
      int width=(int)(realIcon.getIconWidth() * scale);
      int height=(int)(realIcon.getIconHeight() * scale);
      icon=getIcon(Scalr.resize(ImageUtil.toBufferedImage(image),Scalr.Method.ULTRA_QUALITY,width,height));
      scaledIconsCache.put(effectiveScale,new SoftReference<Icon>(icon));
    }
  }
  return icon;
}
