{
  if (isLoaderDisabled() && (myRealIcon == null || dark != USE_DARK_ICONS || scale != SCALE || filter != IMAGE_FILTER || numberOfPatchers != ourPatchers.size()))   return EMPTY_ICON;
  if (!isValid()) {
    myRealIcon=null;
    dark=USE_DARK_ICONS;
    scale=SCALE;
    filter=IMAGE_FILTER;
    myScaledIconsCache.clear();
    if (numberOfPatchers != ourPatchers.size()) {
      numberOfPatchers=ourPatchers.size();
      String path=myOriginalPath == null ? null : patchPath(myOriginalPath);
      if (myClassLoader != null && path != null && path.startsWith("/")) {
        path=path.substring(1);
        final URL url=myClassLoader.getResource(path);
        if (url != null) {
          myUrl=url;
        }
      }
    }
  }
  Object realIcon=myRealIcon;
  if (realIcon instanceof Icon)   return (Icon)realIcon;
  Icon icon;
  if (realIcon instanceof Reference) {
    icon=((Reference<Icon>)realIcon).get();
    if (icon != null)     return icon;
  }
  Image image=ImageLoader.loadFromUrl(myUrl,true,filter);
  icon=checkIcon(image,myUrl);
  if (icon != null) {
    if (icon.getIconWidth() < 50 && icon.getIconHeight() < 50) {
      realIcon=icon;
    }
 else {
      realIcon=new SoftReference<Icon>(icon);
    }
    myRealIcon=realIcon;
  }
  return icon == null ? EMPTY_ICON : icon;
}
