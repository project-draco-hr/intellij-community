{
  if (options instanceof JavaVariableFindUsagesOptions) {
    final JavaVariableFindUsagesOptions varOptions=(JavaVariableFindUsagesOptions)options;
    if (varOptions.isReadAccess || varOptions.isWriteAccess) {
      if (varOptions.isReadAccess && varOptions.isWriteAccess) {
        if (!addElementUsages(element,options,processor))         return false;
      }
 else {
        if (!addElementUsages(element,varOptions,new Processor<UsageInfo>(){
          @Override public boolean process(          UsageInfo info){
            final PsiElement element=info.getElement();
            boolean isWrite=element instanceof PsiExpression && PsiUtil.isAccessedForWriting((PsiExpression)element);
            if (isWrite == varOptions.isWriteAccess) {
              if (!processor.process(info))               return false;
            }
            return true;
          }
        }
))         return false;
      }
    }
  }
 else   if (options.isUsages) {
    if (!addElementUsages(element,options,processor))     return false;
  }
  boolean success=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
    @Override public Boolean compute(){
      if (ThrowSearchUtil.isSearchable(element) && options instanceof JavaThrowFindUsagesOptions && options.isUsages) {
        ThrowSearchUtil.Root root=((JavaThrowFindUsagesOptions)options).getRoot();
        if (root == null) {
          final ThrowSearchUtil.Root[] roots=ThrowSearchUtil.getSearchRoots(element);
          if (roots != null && roots.length > 0) {
            root=roots[0];
          }
        }
        if (root != null) {
          return ThrowSearchUtil.addThrowUsages(processor,root,options);
        }
      }
      return true;
    }
  }
);
  if (!success)   return false;
  if (options instanceof JavaPackageFindUsagesOptions && ((JavaPackageFindUsagesOptions)options).isClassesUsages) {
    if (!addClassesUsages((PsiPackage)element,(JavaPackageFindUsagesOptions)options,processor))     return false;
  }
  if (options instanceof JavaClassFindUsagesOptions) {
    final JavaClassFindUsagesOptions classOptions=(JavaClassFindUsagesOptions)options;
    final PsiClass psiClass=(PsiClass)element;
    PsiManager manager=ApplicationManager.getApplication().runReadAction(new Computable<PsiManager>(){
      @Override public PsiManager compute(){
        return psiClass.getManager();
      }
    }
);
    if (classOptions.isMethodsUsages) {
      if (!addMethodsUsages(psiClass,manager,classOptions,processor))       return false;
    }
    if (classOptions.isFieldsUsages) {
      if (!addFieldsUsages(psiClass,manager,classOptions,processor))       return false;
    }
    if (psiClass.isInterface()) {
      if (classOptions.isDerivedInterfaces) {
        if (classOptions.isImplementingClasses) {
          if (!addInheritors(psiClass,classOptions,processor))           return false;
        }
 else {
          if (!addDerivedInterfaces(psiClass,classOptions,processor))           return false;
        }
      }
 else       if (classOptions.isImplementingClasses) {
        if (!addImplementingClasses(psiClass,classOptions,processor))         return false;
      }
      if (classOptions.isImplementingClasses) {
        FunctionalExpressionSearch.search(psiClass,classOptions.searchScope).forEach(new PsiElementProcessorAdapter<PsiFunctionalExpression>(new PsiElementProcessor<PsiFunctionalExpression>(){
          @Override public boolean execute(          @NotNull PsiFunctionalExpression expression){
            return addResult(expression,options,processor);
          }
        }
));
      }
    }
 else     if (classOptions.isDerivedClasses) {
      if (!addInheritors(psiClass,classOptions,processor))       return false;
    }
  }
  if (options instanceof JavaMethodFindUsagesOptions) {
    final PsiMethod psiMethod=(PsiMethod)element;
    boolean isAbstract=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      @Override public Boolean compute(){
        return psiMethod.hasModifierProperty(PsiModifier.ABSTRACT);
      }
    }
);
    final JavaMethodFindUsagesOptions methodOptions=(JavaMethodFindUsagesOptions)options;
    if (isAbstract && methodOptions.isImplementingMethods || methodOptions.isOverridingMethods) {
      if (!processOverridingMethods(psiMethod,processor,methodOptions))       return false;
      FunctionalExpressionSearch.search(psiMethod,methodOptions.searchScope).forEach(new PsiElementProcessorAdapter<PsiFunctionalExpression>(new PsiElementProcessor<PsiFunctionalExpression>(){
        @Override public boolean execute(        @NotNull PsiFunctionalExpression expression){
          return addResult(expression,options,processor);
        }
      }
));
    }
  }
  if (element instanceof PomTarget) {
    if (!addAliasingUsages((PomTarget)element,options,processor))     return false;
  }
  final Boolean isSearchable=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
    @Override public Boolean compute(){
      return ThrowSearchUtil.isSearchable(element);
    }
  }
);
  if (!isSearchable && options.isSearchForTextOccurrences && options.searchScope instanceof GlobalSearchScope) {
    Collection<String> stringsToSearch=ApplicationManager.getApplication().runReadAction(new NullableComputable<Collection<String>>(){
      @Override public Collection<String> compute(){
        return getElementNames(element);
      }
    }
);
    if (!FindUsagesHelper.processUsagesInText(element,stringsToSearch,(GlobalSearchScope)options.searchScope,processor))     return false;
  }
  return true;
}
