{
  final String tracesDirectory=getTracesDirectory(configuration);
  final TestDiscoveryIndex coverageIndex=TestDiscoveryIndex.getInstance(configuration.getProject());
synchronized (ourTracesLock) {
    final File tracesDirectoryFile=new File(tracesDirectory);
    final File[] testMethodTraces=tracesDirectoryFile.listFiles(new FilenameFilter(){
      @Override public boolean accept(      File dir,      String name){
        return name.endsWith(".tr");
      }
    }
);
    if (testMethodTraces != null) {
      for (      File testMethodTrace : testMethodTraces) {
        try {
          coverageIndex.updateFromTestTrace(testMethodTrace);
          FileUtil.delete(testMethodTrace);
        }
 catch (        IOException e) {
          LOG.error("Can not load " + testMethodTrace,e);
        }
      }
      final String[] filesInTracedDirectories=tracesDirectoryFile.list();
      if (filesInTracedDirectories == null || filesInTracedDirectories.length == 0) {
        FileUtil.delete(tracesDirectoryFile);
      }
    }
  }
}
