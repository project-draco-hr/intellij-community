{
  final ReadonlyStatusHandler.OperationStatus readOnlyFilesStatus=getReadOnlyFilesStatus(myVerifier.getWritableFiles());
  if (readOnlyFilesStatus.hasReadonlyFiles()) {
    showError(myProject,readOnlyFilesStatus.getReadonlyFilesMessage(),true);
    return ApplyPatchStatus.FAILURE;
  }
  final List<Pair<VirtualFile,ApplyTextFilePatch>> textPatches=myVerifier.getTextPatches();
  if (!fileTypesAreOk(textPatches)) {
    return ApplyPatchStatus.FAILURE;
  }
  try {
    markInternalOperation(textPatches,true);
    return actualApply(myVerifier,myCommitContext);
  }
  finally {
    markInternalOperation(textPatches,false);
  }
}
