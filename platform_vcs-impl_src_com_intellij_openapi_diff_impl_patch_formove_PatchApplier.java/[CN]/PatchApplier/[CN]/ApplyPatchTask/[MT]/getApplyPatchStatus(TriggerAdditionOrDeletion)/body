{
  final Ref<ApplyPatchStatus> refStatus=Ref.create(ApplyPatchStatus.SUCCESS);
  try {
    setConfirmationToDefault();
    CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
      @Override public void run(){
        refStatus.set(createFiles());
        addSkippedItems(trigger);
        trigger.prepare();
        refStatus.set(ApplyPatchStatus.and(refStatus.get(),executeWritable()));
      }
    }
,VcsBundle.message("patch.apply.command"),null);
  }
  finally {
    returnConfirmationBack();
    VcsFileListenerContextHelper.getInstance(myProject).clearContext();
  }
  return refStatus.get();
}
