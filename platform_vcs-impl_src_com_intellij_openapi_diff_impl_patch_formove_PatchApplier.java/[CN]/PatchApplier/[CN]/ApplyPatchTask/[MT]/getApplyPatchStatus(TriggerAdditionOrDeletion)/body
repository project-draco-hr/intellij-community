{
  final Ref<ApplyPatchStatus> refStatus=Ref.create(ApplyPatchStatus.FAILURE);
  try {
    setConfirmationToDefault();
    CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
      @Override public void run(){
        if (!createFiles()) {
          refStatus.set(ApplyPatchStatus.FAILURE);
          return;
        }
        addSkippedItems(trigger);
        trigger.prepare();
        refStatus.set(executeWritable());
      }
    }
,VcsBundle.message("patch.apply.command"),null);
  }
  finally {
    returnConfirmationBack();
    VcsFileListenerContextHelper.getInstance(myProject).clearContext();
  }
  return refStatus.get();
}
