{
  final Ref<List<JPopupMenu>> ref=new Ref<List<JPopupMenu>>();
  Pause.pause(new Condition("waiting for " + expectedCount + " JPopupMenus to show up"){
    @Override public boolean test(){
      List<JPopupMenu> popupMenus=newArrayList(myRobot.finder().findAll(new GenericTypeMatcher<JPopupMenu>(JPopupMenu.class){
        @Override protected boolean isMatching(        @NotNull JPopupMenu popupMenu){
          return popupMenu.isShowing();
        }
      }
));
      boolean allFound=popupMenus.size() == expectedCount;
      if (allFound) {
        ref.set(popupMenus);
      }
      return allFound;
    }
  }
);
  List<JPopupMenu> popupMenus=ref.get();
  assertThat(popupMenus).isNotNull().hasSize(expectedCount);
  return popupMenus;
}
