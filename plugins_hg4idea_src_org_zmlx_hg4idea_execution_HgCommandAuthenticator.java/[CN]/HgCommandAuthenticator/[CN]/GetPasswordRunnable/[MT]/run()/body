{
  final HgVcs vcs=HgVcs.getInstance(myProject);
  if (vcs == null) {
    return;
  }
  @NotNull final HgGlobalSettings hgGlobalSettings=vcs.getGlobalSettings();
  @Nullable String rememberedLoginsForUrl=null;
  if (!StringUtil.isEmptyOrSpaces(myURL)) {
    rememberedLoginsForUrl=hgGlobalSettings.getRememberedUserName(VirtualFileManager.extractPath(myURL));
  }
  String login=myProposedLogin;
  if (StringUtil.isEmptyOrSpaces(login)) {
    login=rememberedLoginsForUrl;
  }
  String password=null;
  if (!StringUtil.isEmptyOrSpaces(login) && myURL != null) {
    final String key=keyForUrlAndLogin(myURL,login);
    try {
      final PasswordSafeImpl passwordSafe=(PasswordSafeImpl)PasswordSafe.getInstance();
      if (mySilent) {
        password=passwordSafe.getMemoryProvider().getPassword(myProject,HgCommandAuthenticator.class,key);
      }
 else {
        password=passwordSafe.getPassword(myProject,HgCommandAuthenticator.class,key);
      }
    }
 catch (    PasswordSafeException e) {
      LOG.info("Couldn't get password for key [" + key + "]",e);
    }
  }
  if (!myForceAuthorization && !StringUtil.isEmptyOrSpaces(password) && !StringUtil.isEmptyOrSpaces(login)) {
    myUserName=login;
    myPassword=password;
    ok=true;
    return;
  }
  if (mySilent) {
    ok=false;
    return;
  }
  final AuthDialog dialog=new AuthDialog(myProject,HgVcsMessages.message("hg4idea.dialog.login.password.required"),HgVcsMessages.message("hg4idea.dialog.login.description",myURL),login,password,true);
  if (dialog.showAndGet()) {
    myUserName=dialog.getUsername();
    myPassword=dialog.getPassword();
    myRememberPassword=dialog.isRememberPassword();
    ok=true;
  }
}
