{
  if (!isCompletionEnabled(parameters)) {
    return;
  }
  PostfixLiveTemplate postfixLiveTemplate=getPostfixLiveTemplate(parameters.getOriginalFile(),parameters.getEditor());
  if (postfixLiveTemplate != null) {
    PsiFile file=parameters.getPosition().getContainingFile();
    final CustomTemplateCallback callback=new CustomTemplateCallback(parameters.getEditor(),file,false);
    String computedKey=postfixLiveTemplate.computeTemplateKey(callback);
    if (computedKey != null) {
      PostfixTemplate template=postfixLiveTemplate.getTemplateByKey(computedKey);
      if (template != null) {
        result=result.withPrefixMatcher(computedKey);
        result.addElement(new PostfixTemplateLookupElement(postfixLiveTemplate,template,computedKey,true));
      }
    }
    CharSequence documentContent=parameters.getEditor().getDocument().getCharsSequence();
    String possibleKey=postfixLiveTemplate.computeTemplateKeyWithoutContextChecking(documentContent,parameters.getOffset());
    if (possibleKey != null) {
      result=result.withPrefixMatcher(possibleKey);
      result.restartCompletionOnPrefixChange(StandardPatterns.string().oneOf(postfixLiveTemplate.getAllTemplateKeys()));
    }
  }
}
