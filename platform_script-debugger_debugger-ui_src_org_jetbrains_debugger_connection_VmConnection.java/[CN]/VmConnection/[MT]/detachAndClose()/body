{
  opened.setError(Promise.createError("detached and closed"));
  Vm currentVm=vm;
  Promise<Void> callback;
  if (currentVm == null) {
    callback=Promise.DONE;
  }
 else {
    vm=null;
    callback=currentVm.getAttachStateManager().detach();
  }
  close(null,ConnectionStatus.DISCONNECTED);
  return callback;
}
