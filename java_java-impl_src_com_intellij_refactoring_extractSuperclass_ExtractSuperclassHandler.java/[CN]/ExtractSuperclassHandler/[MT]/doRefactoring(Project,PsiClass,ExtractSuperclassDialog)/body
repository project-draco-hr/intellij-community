{
  final String superclassName=dialog.getExtractedSuperName();
  final PsiDirectory targetDirectory=dialog.getTargetDirectory();
  final MemberInfo[] selectedMemberInfos=ArrayUtil.toObjectArray(dialog.getSelectedMemberInfos(),MemberInfo.class);
  final DocCommentPolicy javaDocPolicy=new DocCommentPolicy(dialog.getDocCommentPolicy());
  LocalHistoryAction a=LocalHistory.getInstance().startAction(getCommandName(subclass,superclassName));
  try {
    final PsiClass superclass;
    try {
      superclass=ExtractSuperClassUtil.extractSuperClass(project,targetDirectory,superclassName,subclass,selectedMemberInfos,javaDocPolicy);
    }
  finally {
      a.finish();
    }
    ExtractClassUtil.suggestToTurnRefsToSuper(project,superclass,subclass);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
