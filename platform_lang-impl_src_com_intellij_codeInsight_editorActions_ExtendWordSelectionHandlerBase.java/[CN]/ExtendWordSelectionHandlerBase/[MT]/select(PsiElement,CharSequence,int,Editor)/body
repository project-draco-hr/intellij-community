{
  final TextRange originalRange=e.getTextRange();
  if (originalRange.getEndOffset() > editorText.length()) {
    throw new LogEventException("Invalid element range in " + getClass(),"element=" + e + "; range="+ originalRange+ "; text length="+ editorText.length()+ "; editor="+ editor+ "; committed="+ PsiDocumentManager.getInstance(e.getProject()).isCommitted(editor.getDocument()),new Attachment("editor_text.txt",editorText.toString()),new Attachment("psi_text.txt",e.getText()));
  }
  List<TextRange> ranges=expandToWholeLine(editorText,originalRange,true);
  if (ranges.size() == 1 && ranges.contains(originalRange)) {
    return expandToWholeLine(editorText,originalRange,false);
  }
  return ranges;
}
