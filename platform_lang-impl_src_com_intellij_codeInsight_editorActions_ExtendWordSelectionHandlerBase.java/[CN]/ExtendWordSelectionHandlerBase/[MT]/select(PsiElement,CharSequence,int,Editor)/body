{
  final TextRange originalRange=e.getTextRange();
  if (originalRange.getEndOffset() > editorText.length()) {
    throw new AssertionError("Invalid element range in " + getClass() + "; element="+ e+ "; range="+ originalRange+ "; length="+ editorText+ "; editor="+ editor+ "; committed="+ PsiDocumentManager.getInstance(e.getProject()).isCommitted(editor.getDocument()));
  }
  List<TextRange> ranges=expandToWholeLine(editorText,originalRange,true);
  if (ranges.size() == 1 && ranges.contains(originalRange)) {
    return expandToWholeLine(editorText,originalRange,false);
  }
  return ranges;
}
