{
  FilePath filePath=VcsUtil.getFilePath(file);
  GitRevisionNumber compareRevisionNumber=(GitRevisionNumber)GitHistoryUtils.getCurrentRevision(project,filePath,branchToCompare);
  if (compareRevisionNumber == null) {
    fileDoesntExistInBranchError(project,file,branchToCompare);
    return;
  }
  GitRevisionNumber currentRevisionNumber=(GitRevisionNumber)GitHistoryUtils.getCurrentRevision(project,filePath,head);
  if (currentRevisionNumber == null) {
    LOG.error(String.format("Current revision number is null for file [%s] and branch [%s]",filePath,head));
    return;
  }
  final GitRepository gitRepository=GitUtil.getRepositoryManager(project).getRepositoryForFile(file);
  if (gitRepository == null) {
    LOG.error("Couldn't find Git Repository for " + file.getName());
    return;
  }
  final GitRevisionNumber compareToRevisionNumber=new GitRevisionNumber(branchToCompare,compareRevisionNumber.getTimestamp());
  Collection<Change> changes=GitChangeUtils.getDiff(project,gitRepository.getRoot(),branchToCompare,head,Collections.singletonList(filePath));
  VcsDiffUtil.showDiffFor(project,changes.isEmpty() && !filePath.isDirectory() ? createChangesWithCurrentContentForFile(filePath,GitContentRevision.createRevision(filePath,compareToRevisionNumber,project,null)) : changes,VcsDiffUtil.getRevisionTitle(branchToCompare,false),VcsDiffUtil.getRevisionTitle(head,true),filePath);
}
