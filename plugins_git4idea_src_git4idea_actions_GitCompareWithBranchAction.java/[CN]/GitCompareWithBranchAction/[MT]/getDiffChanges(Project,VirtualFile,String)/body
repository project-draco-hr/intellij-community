{
  FilePath filePath=VcsUtil.getFilePath(file);
  final GitRepository gitRepository=GitUtil.getRepositoryManager(project).getRepositoryForFile(file);
  if (gitRepository == null) {
    throw new VcsException("Couldn't find Git Repository for " + file.getName());
  }
  final VirtualFile gitRepositoryRoot=gitRepository.getRoot();
  GitRevisionNumber compareRevisionNumber=new GitRevisionNumber(branchToCompare);
  Collection<Change> changes=GitChangeUtils.getDiffWithWorkingDir(project,gitRepositoryRoot,branchToCompare,Collections.singletonList(filePath),false);
  if (changes.isEmpty() && GitHistoryUtils.getCurrentRevision(project,filePath,branchToCompare) == null) {
    throw new VcsException(fileDoesntExistInBranchError(file,branchToCompare));
  }
  return changes.isEmpty() && !filePath.isDirectory() ? createChangesWithCurrentContentForFile(filePath,GitContentRevision.createRevision(filePath,compareRevisionNumber,project,null)) : changes;
}
