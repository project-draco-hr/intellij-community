{
  FilePath filePath=VcsUtil.getFilePath(file);
  final GitRepository gitRepository=GitUtil.getRepositoryManager(project).getRepositoryForFile(file);
  if (gitRepository == null) {
    throw new VcsException("Couldn't find Git Repository for " + file.getName());
  }
  final VirtualFile gitRepositoryRoot=gitRepository.getRoot();
  GitRevisionNumber compareRevisionNumber=new GitRevisionNumber(branchToCompare);
  GitRevisionNumber currentRevisionNumber=(GitRevisionNumber)GitHistoryUtils.getCurrentRevision(project,filePath,head);
  if (currentRevisionNumber == null) {
    throw new VcsException(String.format("Current revision number is null for file [%s] and branch [%s]",filePath,head));
  }
  Collection<Change> changes=GitChangeUtils.getDiff(project,gitRepositoryRoot,branchToCompare,null,Collections.singletonList(filePath));
  return changes.isEmpty() && !filePath.isDirectory() ? createChangesWithCurrentContentForFile(filePath,GitContentRevision.createRevision(filePath,compareRevisionNumber,project,null)) : changes;
}
