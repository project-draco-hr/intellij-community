{
  if (!(file instanceof XmlFile))   return Collections.emptyMap();
  return CachedValuesManager.getCachedValue(file,new CachedValueProvider<Map<String,XmlTag>>(){
    @Nullable @Override public Result<Map<String,XmlTag>> compute(){
      final Map<String,XmlTag> result=new THashMap<String,XmlTag>();
      file.accept(new XmlRecursiveElementVisitor(){
        @Override public void visitXmlTag(        final XmlTag tag){
          super.visitXmlTag(tag);
          XmlAttribute refAttr=tag.getAttribute(ITEM_REF);
          if (refAttr != null && tag.getAttribute(ITEM_SCOPE) != null) {
            getReferencesForAttributeValue(refAttr.getValueElement(),new PairFunction<String,Integer,PsiReference>(){
              @Nullable @Override public PsiReference fun(              String t,              Integer v){
                result.put(t,tag);
                return null;
              }
            }
);
          }
        }
      }
);
      return Result.create(result,file);
    }
  }
);
}
