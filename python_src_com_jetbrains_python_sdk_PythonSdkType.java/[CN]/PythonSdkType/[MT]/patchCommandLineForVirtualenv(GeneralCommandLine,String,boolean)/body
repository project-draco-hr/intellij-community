{
  @NonNls final String PATH="PATH";
  String path_value;
  File virtualenv_root=getVirtualEnvRoot(sdkHome);
  if (virtualenv_root != null) {
    String virtualenv_bin=new File(virtualenv_root,"bin").getPath();
    if (passParentEnvs) {
      path_value=System.getenv(PATH);
      path_value=PythonEnvUtil.appendToPathEnvVar(path_value,virtualenv_bin);
    }
 else {
      path_value=virtualenv_bin;
    }
    Map<String,String> new_env=PythonEnvUtil.cloneEnv(commandLine.getEnvParams());
    String existing_path=new_env.get(PATH);
    if (existing_path == null || !existing_path.contains(virtualenv_bin)) {
      new_env.put(PATH,path_value);
      commandLine.setEnvParams(new_env);
    }
  }
}
