{
  @NonNls final String PATH="PATH";
  File virtualEnvRoot=getVirtualEnvRoot(sdkHome);
  if (virtualEnvRoot != null) {
    File bin=new File(virtualEnvRoot,"bin");
    if (!bin.exists()) {
      bin=new File(virtualEnvRoot,"Scripts");
    }
    String virtualenvBin=bin.getPath();
    Map<String,String> env=commandLine.getEnvParams();
    String pathValue;
    if (env != null && env.containsKey(PATH)) {
      pathValue=PythonEnvUtil.appendToPathEnvVar(env.get(PATH),virtualenvBin);
    }
 else     if (passParentEnvs) {
      pathValue=PythonEnvUtil.appendToPathEnvVar(System.getenv(PATH),virtualenvBin);
    }
 else {
      pathValue=virtualenvBin;
    }
    Map<String,String> newEnv=PythonEnvUtil.cloneEnv(env);
    newEnv.put(PATH,pathValue);
    commandLine.setEnvParams(newEnv);
  }
}
