{
  final SdkModificator sdkModificator=sdk.getSdkModificator();
  String sdk_path=sdk.getHomePath();
  String bin_path=getInterpreterPath(sdk_path);
  final String stubs_path=PathManager.getSystemPath() + File.separator + "python_stubs"+ File.separator+ sdk_path.hashCode()+ File.separator;
  String script="import sys\n" + "for x in sys.path:\n" + "  sys.stdout.write(x+chr(10))";
  final List<String> paths=SdkUtil.getProcessOutput(sdk_path,new String[]{bin_path,"-c",script}).getStdout();
  if ((paths != null) && paths.size() > 0) {
    for (    String path : paths) {
      if (path.indexOf(File.separator) < 0)       continue;
      VirtualFile child=LocalFileSystem.getInstance().findFileByPath(path);
      if (child != null) {
        sdkModificator.addRoot(child,OrderRootType.SOURCES);
        sdkModificator.addRoot(child,OrderRootType.CLASSES);
      }
 else       LOG.info("Bogus sys.path entry " + path);
    }
    generateBuiltinStubs(sdk_path,stubs_path);
    sdkModificator.addRoot(LocalFileSystem.getInstance().refreshAndFindFileByPath(stubs_path),OrderRootType.SOURCES);
  }
  generateBinaryStubs(sdk_path,stubs_path);
  sdkModificator.commitChanges();
}
