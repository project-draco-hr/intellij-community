{
  final SdkModificator sdkModificator=sdk.getSdkModificator();
  VirtualFile libDir;
  if (SystemInfo.isLinux)   libDir=sdk.getHomeDirectory();
 else   libDir=sdk.getHomeDirectory().findChild("Lib");
  final String stubsPath=PathManager.getSystemPath() + File.separator + "python_stubs"+ File.separator+ sdk.getHomePath().hashCode()+ File.separator;
  if (libDir != null) {
    if (SystemInfo.isMac) {
      for (      VirtualFile child : libDir.getChildren()) {
        if (child.getName().startsWith("python")) {
          sdkModificator.addRoot(child,OrderRootType.SOURCES);
          sdkModificator.addRoot(child,OrderRootType.CLASSES);
          break;
        }
      }
      generateStubs(sdk.getHomePath(),stubsPath);
    }
 else {
      sdkModificator.addRoot(libDir,OrderRootType.SOURCES);
      sdkModificator.addRoot(libDir,OrderRootType.CLASSES);
      generateStubs(sdk.getHomePath(),stubsPath);
    }
    sdkModificator.addRoot(LocalFileSystem.getInstance().refreshAndFindFileByPath(stubsPath),OrderRootType.SOURCES);
  }
  sdkModificator.commitChanges();
}
