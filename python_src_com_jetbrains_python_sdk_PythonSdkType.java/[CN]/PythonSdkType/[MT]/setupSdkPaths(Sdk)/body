{
  final Ref<SdkModificator> sdkModificatorRef=new Ref<SdkModificator>();
  final Ref<Boolean> success=new Ref<Boolean>();
  success.set(true);
  final ProgressManager progman=ProgressManager.getInstance();
  final Project project=PlatformDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext());
  final Task.Modal setup_task=new Task.Modal(project,"Setting up library files for " + sdk.getName(),false){
    public void run(    @NotNull final ProgressIndicator indicator){
      try {
        final SdkModificator sdkModificator=sdk.getSdkModificator();
        setupSdkPaths(sdkModificator,indicator);
        sdkModificatorRef.set(sdkModificator);
      }
 catch (      InvalidSdkException e) {
        success.set(false);
      }
    }
  }
;
  progman.run(setup_task);
  if (success.get()) {
    if (sdkModificatorRef.get() != null)     sdkModificatorRef.get().commitChanges();
  }
 else {
    Messages.showErrorDialog(project,PyBundle.message("MSG.cant.setup.sdk.$0",FileUtil.toSystemDependentName(sdk.getSdkModificator().getHomePath())),PyBundle.message("MSG.title.bad.sdk"));
  }
}
