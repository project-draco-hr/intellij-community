{
  myFixture.configureByText(PlainTextFileType.INSTANCE,text);
  EditorEx editor=(EditorEx)myFixture.getEditor();
  IterationState iterationState=new IterationState(editor,0,editor.getDocument().getTextLength(),true);
  try {
    List<Segment> actualSegments=new ArrayList<Segment>();
    do {
      actualSegments.add(new Segment(iterationState.getStartOffset(),iterationState.getEndOffset(),iterationState.getMergedAttributes().getForegroundColor()));
      iterationState.advance();
    }
 while (!iterationState.atEnd());
    Assert.assertArrayEquals(expectedSegments,actualSegments.toArray());
  }
  finally {
    iterationState.dispose();
  }
}
