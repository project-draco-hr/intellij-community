{
  IdeFrame lastFocusedFrame=IdeFocusManager.getGlobalInstance().getLastFocusedFrame();
  Project project=lastFocusedFrame == null ? null : lastFocusedFrame.getProject();
  if (project == null) {
    Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
    return openProjects.length > 0 ? openProjects[0] : null;
  }
  return project;
}
