{
  super(project,true);
  myProject=project;
  myEditor=editor;
  mySelectionStart=selectionStart;
  mySelectionEnd=selectionEnd;
  myCachedContents=cachedContents;
  setTitle(title);
  myActiveVcs=vcs;
  myRevisions=new ArrayList<VcsFileRevision>();
  myFile=file;
  String helpId=vcsHistoryProvider.getHelpId();
  myHelpId=helpId != null ? helpId : "reference.dialogs.vcs.selection.history";
  final VcsDependentHistoryComponents components=vcsHistoryProvider.getUICustomization(session,getRootPane());
  ColumnInfo[] additionalColumns=ObjectUtils.notNull(components.getColumns(),ColumnInfo.EMPTY_ARRAY);
  myListModel=new ListTableModel<VcsFileRevision>(ArrayUtil.mergeArrays(COLUMNS,additionalColumns));
  myListModel.setSortable(false);
  myList=new TableView<VcsFileRevision>(myListModel);
  myList.getEmptyText().setText(VcsBundle.message("history.empty"));
  myDiffPanel=DiffManager.getInstance().createRequestPanel(myProject,getDisposable(),getWindow());
  final VcsRevisionNumber currentRevisionNumber=session.getCurrentRevisionNumber();
  if (currentRevisionNumber != null) {
    myRevisions.add(new CurrentRevision(file,currentRevisionNumber));
  }
  myRevisions.addAll(session.getRevisionList());
  myContentFileType=file.getFileType();
  final VcsConfiguration configuration=VcsConfiguration.getInstance(myProject);
  mySplitter=new Splitter(true,getVcsConfiguration().FILE_HISTORY_DIALOG_SPLITTER_PROPORTION);
  mySplitter.setFirstComponent(myDiffPanel.getComponent());
  mySplitter.setSecondComponent(createBottomPanel(components.getDetailsComponent()));
  mySplitter.addPropertyChangeListener(new PropertyChangeListener(){
    @Override public void propertyChange(    PropertyChangeEvent evt){
      if (Splitter.PROP_PROPORTION.equals(evt.getPropertyName())) {
        getVcsConfiguration().FILE_HISTORY_DIALOG_SPLITTER_PROPORTION=((Float)evt.getNewValue()).floatValue();
      }
    }
  }
);
  final ListSelectionListener selectionListener=new ListSelectionListener(){
    @Override public void valueChanged(    ListSelectionEvent e){
      final VcsFileRevision revision;
      if (myList.getSelectedRowCount() == 1 && !myList.isEmpty()) {
        revision=myList.getItems().get(myList.getSelectedRow());
        myComments.setText(revision.getCommitMessage());
        myComments.setCaretPosition(0);
      }
 else {
        revision=null;
        myComments.setText("");
      }
      if (components.getRevisionListener() != null) {
        components.getRevisionListener().consume(revision);
      }
      updateDiff();
    }
  }
;
  myList.getSelectionModel().addListSelectionListener(selectionListener);
  myChangesOnlyCheckBox.setSelected(configuration.SHOW_ONLY_CHANGED_IN_SELECTION_DIFF);
  try {
    updateRevisionsList();
  }
 catch (  final VcsException e) {
    canNotLoadRevisionMessage(e);
  }
  myChangesOnlyCheckBox.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      configuration.SHOW_ONLY_CHANGED_IN_SELECTION_DIFF=myChangesOnlyCheckBox.isSelected();
      try {
        updateRevisionsList();
      }
 catch (      VcsException e1) {
        canNotLoadRevisionMessage(e1);
      }
    }
  }
);
  init();
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      if (!VcsHistoryDialog.this.isShowing())       return;
      myList.getSelectionModel().addSelectionInterval(0,0);
    }
  }
);
}
