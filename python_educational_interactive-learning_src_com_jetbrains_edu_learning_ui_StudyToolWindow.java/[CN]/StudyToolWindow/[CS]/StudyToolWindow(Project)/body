{
  super(true,true);
  JPanel toolbarPanel=createToolbarPanel();
  setToolbar(toolbarPanel);
  final JTextPane taskTextPane=createTaskTextPane();
  VirtualFile[] files=FileEditorManager.getInstance(project).getSelectedFiles();
  TaskFile taskFile=null;
  for (  VirtualFile file : files) {
    taskFile=StudyUtils.getTaskFile(project,file);
    if (taskFile != null) {
      break;
    }
  }
  if (taskFile == null) {
    taskTextPane.setText(EMPTY_TASK_TEXT);
    setContent(taskTextPane);
    return;
  }
  final Task task=taskFile.getTask();
  if (task != null) {
    final String taskText=getTaskText(task,task.getTaskDir(project));
    if (taskText == null) {
      return;
    }
    JBScrollPane scrollPane=new JBScrollPane(taskTextPane);
    taskTextPane.setText(taskText);
    taskTextPane.addHyperlinkListener(BrowserHyperlinkListener.INSTANCE);
    setContent(scrollPane);
    final FileEditorManagerListener listener=new StudyFileEditorManagerListener(project,taskTextPane);
    project.getMessageBus().connect().subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,listener);
  }
}
