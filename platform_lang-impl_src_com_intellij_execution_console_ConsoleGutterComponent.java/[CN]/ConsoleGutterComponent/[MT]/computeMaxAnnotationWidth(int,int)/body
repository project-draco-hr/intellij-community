{
  gutterContentProvider.beforeUiComponentUpdate(editor);
  if (!gutterContentProvider.hasText()) {
    maxAnnotationWidth=0;
    return;
  }
  FontMetrics fontMetrics=editor.getFontMetrics(Font.PLAIN);
  int lineCount=Math.min(end,editor.getDocument().getLineCount());
  int gutterSize=0;
  for (int line=start; line < lineCount; line++) {
    String text=gutterContentProvider.getText(line,editor);
    if (text != null) {
      gutterSize=Math.max(gutterSize,fontMetrics.stringWidth(text));
    }
  }
  if (gutterSize != 0) {
    gutterSize+=lineEndInset;
  }
  maxAnnotationWidth=Math.max(gutterSize,maxAnnotationWidth);
  editor.getSettings().setAdditionalColumnsCount(1 + (maxAnnotationWidth / EditorUtil.getSpaceWidth(Font.PLAIN,editor)));
}
