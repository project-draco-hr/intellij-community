{
  gutterContentProvider.beforeUiComponentUpdate(editor);
  if (!gutterContentProvider.hasText()) {
    maxAnnotationWidth=0;
    return;
  }
  FontMetrics fontMetrics=editor.getFontMetrics(Font.PLAIN);
  int lineCount=editor.getDocument().getLineCount();
  int gutterSize=0;
  for (int i=0; i < lineCount; i++) {
    String text=gutterContentProvider.getText(i,editor);
    if (text != null) {
      gutterSize=Math.max(gutterSize,fontMetrics.stringWidth(text));
    }
  }
  if (gutterSize != 0) {
    gutterSize+=lineEndInset;
  }
  maxAnnotationWidth=gutterSize;
}
