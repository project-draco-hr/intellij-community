{
  clazz=_clazz;
  assertCanRunWriteAction(getStatus());
  ActivityTracker.getInstance().inc();
  fireBeforeWriteActionStart(_clazz);
  final AtomicBoolean stopped=new AtomicBoolean(false);
  if (!isWriteAccessAllowed()) {
    assertNoPsiLock();
  }
  try {
    if (!myLock.writeLock().tryLock()) {
      if (ourDumpThreadsOnLongWriteActionWaiting > 0) {
        executeOnPooledThread(new Runnable(){
          @Override public void run(){
            while (!stopped.get()) {
              TimeoutUtil.sleep(ourDumpThreadsOnLongWriteActionWaiting);
              if (!stopped.get()) {
                PerformanceWatcher.getInstance().dumpThreads(true);
              }
            }
          }
        }
);
      }
      myLock.writeLock().lockInterruptibly();
    }
    acquired();
  }
 catch (  InterruptedException e) {
    throw new RuntimeInterruptedException(e);
  }
  stopped.set(true);
  myWriteActionsStack.push(_clazz);
  fireWriteActionStarted(_clazz);
}
