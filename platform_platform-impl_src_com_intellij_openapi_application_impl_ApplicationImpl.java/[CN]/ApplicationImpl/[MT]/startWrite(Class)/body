{
  assertIsDispatchThread(getStatus(),"Write access is allowed from event dispatch thread only");
  boolean writeActionPending=myWriteActionPending;
  myWriteActionPending=true;
  try {
    ActivityTracker.getInstance().inc();
    fireBeforeWriteActionStart(clazz);
    try {
      if (!isWriteAccessAllowed()) {
        assertNoPsiLock();
      }
      myLock.writeLock().lockInterruptibly();
    }
 catch (    InterruptedException e) {
      throw new RuntimeInterruptedException(e);
    }
  }
  finally {
    myWriteActionPending=writeActionPending;
  }
  myWriteActionsStack.push(clazz);
  fireWriteActionStarted(clazz);
}
