{
  final Component frame=UIUtil.findUltimateParent(window);
  if (frame instanceof IdeFrame) {
    final IdeFrame ideFrame=(IdeFrame)frame;
    if (isActive() != active) {
      myActive=active;
      System.setProperty("idea.active",String.valueOf(myActive));
      ApplicationActivationListener publisher=getMessageBus().syncPublisher(ApplicationActivationListener.TOPIC);
      if (active) {
        publisher.applicationActivated(ideFrame);
      }
 else {
        publisher.applicationDeactivated(ideFrame);
        IdeFocusManager focusManager=IdeFocusManager.getGlobalInstance();
        if (focusManager instanceof FocusManagerImpl) {
          ((FocusManagerImpl)focusManager).setLastFocusedAtDeactivation(ideFrame,focusManager.getLastFocusedFor(ideFrame));
        }
      }
      return true;
    }
  }
  return false;
}
