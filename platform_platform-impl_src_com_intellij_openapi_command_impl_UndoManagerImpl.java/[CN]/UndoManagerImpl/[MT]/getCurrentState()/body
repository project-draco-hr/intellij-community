{
  FileEditor editor=myEditorProvider.getCurrentEditor();
  if (editor == null) {
    return null;
  }
  if (editor instanceof TextEditor) {
    Editor e=((TextEditor)editor).getEditor();
    if (e instanceof EditorImpl && ((EditorImpl)e).myUseNewRendering && e.isDisposed()) {
      return null;
    }
  }
  return new EditorAndState(editor,editor.getState(FileEditorStateLevel.UNDO));
}
