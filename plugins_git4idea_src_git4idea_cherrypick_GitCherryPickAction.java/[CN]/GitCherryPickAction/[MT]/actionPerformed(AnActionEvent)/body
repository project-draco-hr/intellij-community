{
  final Project project=e.getProject();
  final List<? extends VcsFullCommitDetails> commits=getSelectedCommits(e);
  if (project == null || commits == null || commits.isEmpty()) {
    LOG.info(String.format("Cherry-pick action should be disabled. Project: %s, commits: %s",project,commits));
    return;
  }
  for (  VcsFullCommitDetails commit : commits) {
    myIdsInProgress.add(commit.getHash());
  }
  FileDocumentManager.getInstance().saveAllDocuments();
  myPlatformFacade.getChangeListManager(project).blockModalNotifications();
  new Task.Backgroundable(project,"Cherry-picking",false){
    public void run(    @NotNull ProgressIndicator indicator){
      try {
        boolean autoCommit=GitVcsSettings.getInstance(myProject).isAutoCommitOnCherryPick();
        Map<GitRepository,List<VcsFullCommitDetails>> commitsInRoots=sortCommits(groupCommitsByRoots(project,commits));
        new GitCherryPicker(myProject,myGit,myPlatformFacade,autoCommit).cherryPick(commitsInRoots);
      }
  finally {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            myPlatformFacade.getChangeListManager(project).unblockModalNotifications();
            for (            VcsFullCommitDetails commit : commits) {
              myIdsInProgress.remove(commit.getHash());
            }
          }
        }
);
      }
    }
  }
.queue();
}
