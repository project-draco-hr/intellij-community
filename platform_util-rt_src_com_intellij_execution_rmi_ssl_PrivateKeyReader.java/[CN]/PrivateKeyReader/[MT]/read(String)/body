{
  KeyFactory factory;
  try {
    factory=KeyFactory.getInstance("RSA");
  }
 catch (  NoSuchAlgorithmException e) {
    throw new IOException("JCE error: " + e.getMessage());
  }
  List<String> lines=FileUtilRt.loadLines(fileName,"UTF-8");
  for (int i=0; i < lines.size(); i++) {
    String line=lines.get(i);
    if (line.contains(P1_BEGIN_MARKER)) {
      List<String> strings=lines.subList(i + 1,lines.size());
      byte[] keyBytes=readKeyMaterial(P1_END_MARKER,strings);
      RSAPrivateCrtKeySpec keySpec=getRSAKeySpec(keyBytes);
      try {
        return factory.generatePrivate(keySpec);
      }
 catch (      InvalidKeySpecException e) {
        throw new IOException("Invalid PKCS#1 PEM file: " + e.getMessage());
      }
    }
    if (line.contains(P8_BEGIN_MARKER)) {
      List<String> strings=lines.subList(i + 1,lines.size());
      byte[] keyBytes=readKeyMaterial(P8_END_MARKER,strings);
      EncodedKeySpec keySpec=new PKCS8EncodedKeySpec(keyBytes);
      try {
        return factory.generatePrivate(keySpec);
      }
 catch (      InvalidKeySpecException e) {
        throw new IOException("Invalid PKCS#8 PEM file: " + e.getMessage());
      }
    }
  }
  throw new IOException("Invalid PEM file: no begin marker");
}
