{
  PsiNamedElement target=node.getCopyableUserData(ENCODED_IMPORT);
  final String asName=node.getCopyableUserData(ENCODED_IMPORT_AS);
  final Boolean useFromImport=node.getCopyableUserData(ENCODED_USE_FROM_IMPORT);
  if (target instanceof PsiDirectory) {
    target=(PsiNamedElement)PyUtil.turnDirIntoInit(target);
  }
  if (target instanceof PyFunction) {
    final PyFunction f=(PyFunction)target;
    final PyClass c=f.getContainingClass();
    if (c != null && c.findInitOrNew(false) == f) {
      target=c;
    }
  }
  if (target == null)   return;
  if (PyBuiltinCache.getInstance(target).hasInBuiltins(target))   return;
  if (PsiTreeUtil.isAncestor(node.getContainingFile(),target,false))   return;
  if (target instanceof PyFile) {
    insertImport(node,target,asName,useFromImport != null ? useFromImport : true);
  }
 else {
    insertImport(node,target,asName);
  }
  node.putCopyableUserData(ENCODED_IMPORT,null);
  node.putCopyableUserData(ENCODED_IMPORT_AS,null);
  node.putCopyableUserData(ENCODED_USE_FROM_IMPORT,null);
}
