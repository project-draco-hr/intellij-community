{
  return new JavaElementVisitor(){
    @Override public void visitAnonymousClass(    final PsiAnonymousClass aClass){
      super.visitAnonymousClass(aClass);
      final PsiElement parent=aClass.getParent();
      final PsiElement lambdaContext=parent != null ? parent.getParent() : null;
      if (lambdaContext != null && (LambdaUtil.isValidLambdaContext(lambdaContext) || !(lambdaContext instanceof PsiExpressionStatement)) && canBeConvertedToLambda(aClass,false,reportNotAnnotatedInterfaces,Collections.emptySet())) {
        final PsiElement lBrace=aClass.getLBrace();
        LOG.assertTrue(lBrace != null);
        final TextRange rangeInElement=new TextRange(0,aClass.getStartOffsetInParent() + lBrace.getStartOffsetInParent());
        holder.registerProblem(parent,"Anonymous #ref #loc can be replaced with lambda",ProblemHighlightType.LIKE_UNUSED_SYMBOL,rangeInElement,new ReplaceWithLambdaFix());
      }
    }
  }
;
}
