{
  ApplicationManager.getApplication().assertIsDispatchThread();
  FeatureUsageTracker.getInstance().triggerFeatureUsed("editing.completion.postfix");
  final PostfixTemplate template=getTemplateByKey(key);
  final Editor editor=callback.getEditor();
  final PsiFile file=callback.getContext().getContainingFile();
  if (isApplicableTemplate(template,key,file,editor)) {
    int currentOffset=editor.getCaretModel().getOffset();
    PsiElement newContext=deleteTemplateKey(file,editor.getDocument(),currentOffset,key);
    newContext=addSemicolonIfNeeded(editor,editor.getDocument(),newContext,currentOffset - key.length());
    expandTemplate(template,editor,newContext);
  }
 else   if (editor.getCaretModel().getAllCarets().size() == 1) {
    LOG.error("Template not found by key: " + key);
  }
}
