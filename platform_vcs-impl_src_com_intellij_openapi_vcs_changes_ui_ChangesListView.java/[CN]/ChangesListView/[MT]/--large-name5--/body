{
  TreeModelBuilder builder=new TreeModelBuilder(myProject,isShowFlatten());
  final DefaultTreeModel model=builder.buildModel(changeLists,unversionedFiles,locallyDeletedFiles,modifiedWithoutEditing,switchedFiles,switchedRoots,ignoredFiles,lockedFolders,logicallyLockedFiles);
  TreeState state=TreeState.createOn(this,(ChangesBrowserNode)getModel().getRoot());
  state.setScrollToSelection(false);
  DefaultTreeModel oldModel=getModel();
  setModel(model);
  setCellRenderer(isShowFlatten() ? myShowFlattenNodeRenderer : myNodeRenderer);
  ChangesBrowserNode root=(ChangesBrowserNode)model.getRoot();
  expandPath(new TreePath(root.getPath()));
  state.applyTo(this,(ChangesBrowserNode)getModel().getRoot());
  expandDefaultChangeList(oldModel,root);
}
