{
  try {
    final String logDir=System.getProperty(GlobalOptions.LOG_DIR_OPTION,null);
    final File configFile=logDir != null ? new File(logDir,LOG_CONFIG_FILE_NAME) : new File(LOG_CONFIG_FILE_NAME);
    ensureLogConfigExists(configFile);
    String text=FileUtil.loadFile(configFile);
    final String logFile=logDir != null ? new File(logDir,LOG_FILE_NAME).getAbsolutePath() : LOG_FILE_NAME;
    text=StringUtil.replace(text,LOG_FILE_MACRO,StringUtil.replace(logFile,"\\","\\\\"));
    new DOMConfigurator().doConfigure(new StringReader(text),LogManager.getLoggerRepository());
  }
 catch (  IOException e) {
    System.err.println("Failed to configure logging: ");
    e.printStackTrace(System.err);
  }
  Logger.setFactory(MyLoggerFactory.class);
  InternalLoggerFactory.setDefaultFactory(new Log4JLoggerFactory());
}
