{
  final PsiFile containingFile=representative.getContainingFile();
  if (!containingFile.isValid()) {
    return EmptyResourceBundle.getInstance();
  }
  final ResourceBundleManager manager=ResourceBundleManager.getInstance(representative.getProject());
  final CustomResourceBundle customResourceBundle=manager.getCustomResourceBundle(representative);
  if (customResourceBundle != null) {
    return customResourceBundle;
  }
  final VirtualFile virtualFile=representative.getVirtualFile();
  if (virtualFile == null) {
    return EmptyResourceBundle.getInstance();
  }
  if (manager.isDefaultDissociated(virtualFile)) {
    return new ResourceBundleImpl(representative);
  }
  final String baseName=manager.getBaseName(containingFile);
  final PsiDirectory directory=ApplicationManager.getApplication().runReadAction(new Computable<PsiDirectory>(){
    @Nullable public PsiDirectory compute(){
      return containingFile.getContainingDirectory();
    }
  }
);
  if (directory == null)   return EmptyResourceBundle.getInstance();
  final ResourceBundle bundle=getResourceBundle(baseName,directory);
  return bundle == null ? new ResourceBundleImpl(representative) : bundle;
}
