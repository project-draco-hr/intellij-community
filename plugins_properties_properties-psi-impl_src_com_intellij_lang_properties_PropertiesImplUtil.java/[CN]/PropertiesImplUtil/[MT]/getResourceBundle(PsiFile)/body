{
  VirtualFile virtualFile=containingFile.getVirtualFile();
  if (!containingFile.isValid() || virtualFile == null) {
    return EmptyResourceBundle.getInstance();
  }
  String baseName=getBaseName(virtualFile);
  PsiDirectory directory=ApplicationManager.getApplication().runReadAction(new Computable<PsiDirectory>(){
    @Nullable public PsiDirectory compute(){
      return containingFile.getContainingDirectory();
    }
  }
);
  if (directory == null)   return EmptyResourceBundle.getInstance();
  return new ResourceBundleImpl(directory.getVirtualFile(),baseName);
}
