{
  if (getSettings().CHECK_CODE_SMELLS_BEFORE_PROJECT_COMMIT) {
    if (DumbService.getInstance(myProject).isDumb()) {
      if (Messages.showOkCancelDialog(myProject,VcsBundle.message("code.smells.error.indexing.message",ApplicationNamesInfo.getInstance().getProductName()),VcsBundle.message("code.smells.error.indexing"),"&Wait","&Commit",null) == Messages.OK) {
        return ReturnResult.CANCEL;
      }
      return ReturnResult.COMMIT;
    }
    try {
      final List<CodeSmellInfo> codeSmells=CodeSmellDetector.getInstance(myProject).findCodeSmells(CheckinHandlerUtil.filterOutGeneratedAndExcludedFiles(myCheckinPanel.getVirtualFiles(),myProject));
      if (!codeSmells.isEmpty()) {
        return processFoundCodeSmells(codeSmells,executor);
      }
 else {
        return ReturnResult.COMMIT;
      }
    }
 catch (    ProcessCanceledException e) {
      return ReturnResult.CANCEL;
    }
catch (    Exception e) {
      LOG.error(e);
      if (Messages.showOkCancelDialog(myProject,"Code analysis failed with exception: " + e.getClass().getName() + ": "+ e.getMessage(),"Code analysis failed","&Commit","&Cancel",null) == Messages.OK) {
        return ReturnResult.COMMIT;
      }
      return ReturnResult.CANCEL;
    }
  }
 else {
    return ReturnResult.COMMIT;
  }
}
