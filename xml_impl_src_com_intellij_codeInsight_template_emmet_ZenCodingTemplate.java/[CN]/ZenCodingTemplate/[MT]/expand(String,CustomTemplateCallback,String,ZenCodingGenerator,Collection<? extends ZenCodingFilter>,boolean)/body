{
  final ZenCodingNode node=parse(key,callback,defaultGenerator,surroundedText);
  if (node == null) {
    return;
  }
  if (surroundedText == null && node instanceof TemplateNode) {
    if (key.equals(((TemplateNode)node).getTemplateToken().getKey()) && callback.findApplicableTemplates(key).size() > 1) {
      callback.startTemplate();
      return;
    }
  }
  PsiElement context=callback.getContext();
  ZenCodingGenerator generator=findApplicableGenerator(node,context,false);
  List<ZenCodingFilter> filters=getFilters(node,context);
  filters.addAll(extraFilters);
  if (surroundedText == null) {
    callback.deleteTemplateKey(key);
    PsiDocumentManager.getInstance(callback.getProject()).commitDocument(callback.getEditor().getDocument());
  }
  expand(node,generator,filters,surroundedText,callback,expandPrimitiveAbbreviations);
}
