{
  Component cmp;
  myLocationString=null;
  String pattern="*" + myPopupField.getText();
  Matcher matcher=NameUtil.buildMatcher(pattern,0,true,true);
  if (isMoreItem(index)) {
    cmp=More.get(isSelected);
  }
 else {
    cmp=SearchEverywhereClassifier.EP_Manager.getListCellRendererComponent(list,value,index,isSelected,cellHasFocus);
  }
  if (cmp == null) {
    cmp=tryFileRenderer(matcher,list,value,index,isSelected,cellHasFocus);
  }
  if (cmp == null) {
    if (value instanceof GotoActionModel.ActionWrapper) {
      cmp=myActionsRenderer.getListCellRendererComponent(list,new GotoActionModel.MatchedValue(((GotoActionModel.ActionWrapper)value),pattern),index,isSelected,isSelected);
    }
 else {
      cmp=super.getListCellRendererComponent(list,value,index,isSelected,isSelected);
      final JPanel p=new JPanel(new BorderLayout());
      p.setBackground(UIUtil.getListBackground(isSelected));
      p.add(cmp,BorderLayout.CENTER);
      cmp=p;
    }
  }
  if (myLocationString != null || value instanceof BooleanOptionDescription) {
    final JPanel panel=new JPanel(new BorderLayout());
    panel.setBackground(UIUtil.getListBackground(isSelected));
    panel.add(cmp,BorderLayout.CENTER);
    final Component rightComponent;
    if (value instanceof BooleanOptionDescription) {
      final OnOffButton button=new OnOffButton();
      button.setSelected(((BooleanOptionDescription)value).isOptionEnabled());
      rightComponent=button;
    }
 else {
      rightComponent=myLocation.getListCellRendererComponent(list,value,index,isSelected,isSelected);
    }
    panel.add(rightComponent,BorderLayout.EAST);
    cmp=panel;
  }
  Color bg=cmp.getBackground();
  if (bg == null) {
    cmp.setBackground(UIUtil.getListBackground(isSelected));
    bg=cmp.getBackground();
  }
  myMainPanel.setBorder(new CustomLineBorder(bg,0,0,2,0));
  String title=getModel().titleIndex.getTitle(index);
  myMainPanel.removeAll();
  if (title != null) {
    myTitle.setText(title);
    myMainPanel.add(createTitle(" " + title),BorderLayout.NORTH);
  }
  myMainPanel.add(cmp,BorderLayout.CENTER);
  if (cmp instanceof Accessible) {
    myMainPanel.setAccessible((Accessible)cmp);
  }
  final int width=myMainPanel.getPreferredSize().width;
  if (width > myPopupActualWidth) {
    myPopupActualWidth=width;
  }
  return myMainPanel;
}
