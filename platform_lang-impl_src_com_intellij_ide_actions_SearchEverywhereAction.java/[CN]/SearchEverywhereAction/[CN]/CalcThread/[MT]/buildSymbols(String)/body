{
  int symbolsCounter=0;
  final Set<Object> elements=new LinkedHashSet<Object>();
  final GlobalSearchScope scope=GlobalSearchScope.projectScope(project);
  mySymbolsChooseByName.getProvider().filterElements(mySymbolsChooseByName,pattern,false,myProgressIndicator,new Processor<Object>(){
    @Override public boolean process(    Object o){
      if (o instanceof PsiElement) {
        final PsiElement element=(PsiElement)o;
        final PsiFile file=element.getContainingFile();
        if (file != null && file.getVirtualFile() != null && scope.accept(file.getVirtualFile())) {
          elements.add(o);
        }
      }
      return elements.size() < 30;
    }
  }
);
  final List<Object> symbols=new ArrayList<Object>();
  for (  Object object : elements) {
    if (symbolsCounter > MAX_SYMBOLS)     break;
    if (!myListModel.contains(object)) {
      symbols.add(object);
      symbolsCounter++;
      if (symbolsCounter > MAX_SYMBOLS)       break;
    }
  }
  check();
  if (symbols.size() > 0) {
    UIUtil.invokeLaterIfNeeded(new Runnable(){
      @Override public void run(){
        if (!myProgressIndicator.isCanceled()) {
          myTitleIndexes.symbols=myListModel.size();
          for (          Object file : symbols) {
            myListModel.addElement(file);
          }
          myMoreSymbolsIndex=symbols.size() >= MAX_SYMBOLS ? myListModel.size() - 1 : -1;
        }
      }
    }
);
  }
}
