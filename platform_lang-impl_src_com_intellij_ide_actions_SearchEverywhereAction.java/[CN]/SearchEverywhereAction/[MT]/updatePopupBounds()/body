{
  if (myPopup == null || !myPopup.isVisible()) {
    return;
  }
  final Container parent=getField().getParent();
  final Dimension size=myList.getPreferredSize();
  if (size.width < parent.getWidth()) {
    size.width=parent.getWidth();
  }
  Dimension sz=new Dimension(size.width,size.height);
  if (sz.width > 1000 || sz.height > 800) {
    final JBScrollPane pane=new JBScrollPane();
    final int extraWidth=pane.getVerticalScrollBar().getWidth() + 1;
    final int extraHeight=pane.getHorizontalScrollBar().getHeight() + 1;
    sz=new Dimension(Math.min(1000,Math.max(getField().getWidth(),size.width + extraWidth)),Math.min(800,size.height + extraHeight));
    sz.width+=16;
  }
 else {
    sz.height++;
    sz.height++;
    sz.width++;
    sz.width++;
  }
  myPopup.setSize(sz);
  if (myActionEvent != null && myActionEvent.getInputEvent() == null) {
    final Point p=parent.getLocationOnScreen();
    p.y+=parent.getHeight();
    if (parent.getWidth() < sz.width) {
      p.x-=sz.width - parent.getWidth();
    }
    myPopup.setLocation(p);
  }
 else {
    adjustPopup();
  }
}
