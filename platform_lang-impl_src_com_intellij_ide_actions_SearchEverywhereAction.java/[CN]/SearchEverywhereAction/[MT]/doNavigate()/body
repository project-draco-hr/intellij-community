{
  final String pattern=field.getText();
  final Object value=myList.getSelectedValue();
  final Project project=PlatformDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(field.getTextEditor()));
  IdeFocusManager focusManager=IdeFocusManager.findInstanceByComponent(field.getTextEditor());
  if (myPopup != null && myPopup.isVisible()) {
    myPopup.cancel();
  }
  AccessToken token=ApplicationManager.getApplication().acquireReadActionLock();
  try {
    if (value instanceof PsiElement) {
      NavigationUtil.activateFileWithPsiElement((PsiElement)value,true);
      return;
    }
 else     if (isVirtualFile(value)) {
      OpenFileDescriptor navigatable=new OpenFileDescriptor(project,(VirtualFile)value);
      if (navigatable.canNavigate()) {
        navigatable.navigate(true);
        return;
      }
    }
 else {
      focusManager.requestDefaultFocus(true);
      IdeFocusManager.getInstance(project).doWhenFocusSettlesDown(new Runnable(){
        @Override public void run(){
          if (value instanceof BooleanOptionDescription) {
            final BooleanOptionDescription option=(BooleanOptionDescription)value;
            option.setOptionState(!option.isOptionEnabled());
          }
 else {
            GotoActionAction.openOptionOrPerformAction(value,pattern,project,myContextComponent,myActionEvent);
          }
        }
      }
);
      return;
    }
  }
  finally {
    token.finish();
  }
  focusManager.requestDefaultFocus(true);
}
