{
  if (myDisabledActions.contains(action))   return false;
  final AnActionEvent e=new AnActionEvent(myActionEvent.getInputEvent(),myActionEvent.getDataContext(),myActionEvent.getPlace(),action.getTemplatePresentation().clone(),myActionEvent.getActionManager(),myActionEvent.getModifiers());
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      ActionUtil.performDumbAwareUpdate(action,e,false);
    }
  }
);
  final Presentation presentation=e.getPresentation();
  final boolean enabled=presentation.isEnabled() && presentation.isVisible() && !StringUtil.isEmpty(presentation.getText());
  if (!enabled) {
    myDisabledActions.add(action);
  }
  return enabled;
}
