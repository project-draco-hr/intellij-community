{
  final SearchResult classes=new SearchResult();
  if (chooseByNamePopup == null || shouldSkipPattern(pattern)) {
    return classes;
  }
  chooseByNamePopup.getProvider().filterElements(chooseByNamePopup,pattern,includeLibs,myProgressIndicator,new Processor<Object>(){
    @Override public boolean process(    Object o){
      if (SearchEverywhereClassifier.EP_Manager.isClass(o) && !myListModel.contains(o) && !classes.contains(o)) {
        if (classes.size() == max) {
          classes.needMore=true;
          return false;
        }
        classes.add(o);
        if (o instanceof PsiElementNavigationItem) {
          o=((PsiElementNavigationItem)o).getTargetElement();
        }
        if (o instanceof PsiNamedElement) {
          final String name=((PsiNamedElement)o).getName();
          VirtualFile virtualFile=SearchEverywhereClassifier.EP_Manager.getVirtualFile(o);
          if (virtualFile != null) {
            if (StringUtil.equals(name,virtualFile.getNameWithoutExtension())) {
              myAlreadyAddedFiles.add(virtualFile);
            }
          }
        }
      }
      return true;
    }
  }
);
  if (!includeLibs && classes.isEmpty()) {
    return getClasses(pattern,true,max,chooseByNamePopup);
  }
  return classes;
}
