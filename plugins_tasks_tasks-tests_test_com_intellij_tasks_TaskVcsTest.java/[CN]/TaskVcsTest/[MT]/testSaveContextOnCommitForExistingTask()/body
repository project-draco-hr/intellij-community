{
  myTaskManager.getState().saveContextOnCommit=true;
  assertEquals(1,myTaskManager.getLocalTasks().size());
  Task task=myRepository.findTask("TEST-001");
  assertNotNull(task);
  assertEquals(1,myChangeListManager.getChangeListsCopy().size());
  myTaskManager.activateTask(task,false,true);
  myChangeListManager.waitUntilRefreshed();
  assertEquals(2,myTaskManager.getLocalTasks().size());
  List<LocalChangeList> copy=myChangeListManager.getChangeListsCopy();
  assertEquals(copy.toString(),2,copy.size());
  LocalTask localTask=myTaskManager.getActiveTask();
  List<ChangeListInfo> changelists=localTask.getChangeLists();
  ChangeListInfo info=changelists.get(0);
  LocalChangeList changeList=myChangeListManager.getChangeList(info.id);
  assertNotNull(changeList);
  CommitChangeListDialog.commitChanges(getProject(),Collections.<Change>emptyList(),changeList,null,changeList.getName());
  assertEquals(2,myTaskManager.getLocalTasks().size());
  assertEquals(2,myChangeListManager.getChangeListsCopy().size());
  assertEquals(localTask,myTaskManager.getAssociatedTask(changeList));
}
