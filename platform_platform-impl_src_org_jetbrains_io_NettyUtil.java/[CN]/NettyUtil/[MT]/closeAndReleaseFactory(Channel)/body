{
  ChannelFactory channelFactory=channel.getFactory();
  try {
    channel.close().awaitUninterruptibly();
  }
  finally {
    channelFactory.releaseExternalResources();
  }
}
