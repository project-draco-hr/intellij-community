{
  myDebugName=debugName;
  myLanguage=language == null ? Language.ANY : language;
  if (register) {
    ourRegistryWriteLock.lock();
    try {
      myIndex=ourCounter++;
      LOG.assertTrue(myIndex < MAX_INDEXED_TYPES,"Too many element types registered. Out of (short) range.");
      final int registryIndex=myIndex - FIRST_TOKEN_INDEX;
      if (ourRegistry.length == registryIndex) {
        IElementType[] newRegistry=new IElementType[ourRegistry.length << 1];
        System.arraycopy(ourRegistry,0,newRegistry,0,ourRegistry.length);
        ourRegistry=newRegistry;
      }
      ourRegistry[registryIndex]=this;
    }
  finally {
      ourRegistryWriteLock.unlock();
    }
  }
 else {
    myIndex=-1;
  }
}
