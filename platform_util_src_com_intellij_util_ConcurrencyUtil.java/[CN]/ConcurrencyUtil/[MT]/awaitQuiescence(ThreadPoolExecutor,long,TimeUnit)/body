{
  long deadline=System.currentTimeMillis() + unit.toMillis(timeout);
  executor.setKeepAliveTime(1,TimeUnit.NANOSECONDS);
  String dump;
  while (System.currentTimeMillis() < deadline && (executor.getPoolSize() != 0 || (dump=ThreadDumper.dumpThreadsToString()).contains("at java.lang.Thread.exit(Thread.java:") || dump.contains("at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:"))) {
    executor.setCorePoolSize(0);
    TimeoutUtil.sleep(1);
  }
  if (executor.getPoolSize() != 0) {
    System.err.println("Executor " + executor + " is still active after "+ unit.toSeconds(timeout)+ " seconds://///\n"+ ThreadDumper.dumpThreadsToString()+ "\n/////");
  }
}
