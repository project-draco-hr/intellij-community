{
  PsiStatement statement=tb.getSingleStatement();
  PsiElementFactory elementFactory=JavaPsiFacade.getElementFactory(project);
  String stream=generateStream(iteratedValue,operations).append(".findFirst()").toString();
  if (statement instanceof PsiReturnStatement) {
    PsiReturnStatement returnStatement=(PsiReturnStatement)statement;
    PsiExpression value=returnStatement.getReturnValue();
    if (value == null)     return;
    PsiReturnStatement nextReturnStatement=StreamApiMigrationInspection.getNextReturnStatement(foreachStatement);
    if (nextReturnStatement == null)     return;
    PsiExpression orElseExpression=nextReturnStatement.getReturnValue();
    if (!ExpressionUtils.isSimpleExpression(orElseExpression))     return;
    stream=generateOptionalUnwrap(stream,tb,value,orElseExpression);
    restoreComments(foreachStatement,body);
    boolean siblings=nextReturnStatement.getParent() == foreachStatement.getParent();
    PsiElement result=foreachStatement.replace(elementFactory.createStatementFromText("return " + stream + ";",foreachStatement));
    if (siblings) {
      nextReturnStatement.delete();
    }
    simplifyAndFormat(project,result);
  }
 else {
    PsiStatement[] statements=tb.getStatements();
    if (statements.length != 2)     return;
    PsiAssignmentExpression assignment=ExpressionUtils.getAssignment(statements[0]);
    if (assignment == null)     return;
    PsiExpression lValue=assignment.getLExpression();
    if (!(lValue instanceof PsiReferenceExpression))     return;
    PsiElement element=((PsiReferenceExpression)lValue).resolve();
    if (!(element instanceof PsiVariable))     return;
    PsiVariable var=(PsiVariable)element;
    PsiExpression value=assignment.getRExpression();
    if (value == null)     return;
    restoreComments(foreachStatement,body);
    InitializerUsageStatus status=StreamApiMigrationInspection.getInitializerUsageStatus(var,foreachStatement);
    if (status != InitializerUsageStatus.UNKNOWN) {
      PsiExpression initializer=var.getInitializer();
      if (initializer != null) {
        String replacementText=generateOptionalUnwrap(stream,tb,value,initializer);
        replaceInitializer(foreachStatement,var,initializer,replacementText,status);
        return;
      }
    }
    PsiElement result=foreachStatement.replace(elementFactory.createStatementFromText(var.getName() + " = " + generateOptionalUnwrap(stream,tb,value,lValue)+ ";",foreachStatement));
    simplifyAndFormat(project,result);
  }
}
