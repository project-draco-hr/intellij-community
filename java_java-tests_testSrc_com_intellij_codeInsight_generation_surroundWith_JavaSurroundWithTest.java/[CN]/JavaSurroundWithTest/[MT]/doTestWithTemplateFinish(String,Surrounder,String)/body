{
  TemplateManagerImpl.setTemplateTesting(getProject(),getTestRootDisposable());
  configureByFile(BASE_PATH + fileName + ".java");
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      SurroundWithHandler.invoke(getProject(),getEditor(),getFile(),surrounder);
    }
  }
);
  if (textToType != null) {
    type(textToType);
  }
  TemplateState templateState=TemplateManagerImpl.getTemplateState(getEditor());
  assertNotNull(templateState);
  templateState.nextTab();
  checkResultByFile(BASE_PATH + fileName + "_after.java");
}
