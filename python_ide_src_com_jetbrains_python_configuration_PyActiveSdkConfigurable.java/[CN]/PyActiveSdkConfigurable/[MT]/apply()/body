{
  final Sdk item=(Sdk)mySdkCombo.getSelectedItem();
  Sdk newSdk=item;
  if (item instanceof PyDetectedSdk) {
    VirtualFile sdkHome=ApplicationManager.getApplication().runWriteAction(new Computable<VirtualFile>(){
      @Override public VirtualFile compute(){
        return LocalFileSystem.getInstance().refreshAndFindFileByPath(item.getName());
      }
    }
);
    newSdk=SdkConfigurationUtil.setupSdk(myProjectSdksModel.getSdks(),sdkHome,PythonSdkType.getInstance(),true,null,null);
    if (newSdk != null) {
      myProjectSdksModel.addSdk(newSdk);
      updateSdkList(false);
    }
    PySdkService.getInstance().solidifySdk(item);
  }
  myProjectSdksModel.apply();
  newSdk=newSdk == null ? null : myProjectSdksModel.findSdk(newSdk.getName());
  mySdkCombo.getModel().setSelectedItem(newSdk);
  final Sdk prevSdk=getSdk();
  setSdk(newSdk);
  if (prevSdk != null && newSdk != null) {
    final PythonSdkFlavor flavor1=PythonSdkFlavor.getFlavor(newSdk);
    final PythonSdkFlavor flavor2=PythonSdkFlavor.getFlavor(prevSdk);
    if (flavor1 != null && flavor2 != null) {
      final LanguageLevel languageLevel1=flavor1.getLanguageLevel(newSdk);
      final LanguageLevel languageLevel2=flavor2.getLanguageLevel(prevSdk);
      if ((languageLevel1.isPy3K() && languageLevel2.isPy3K()) || (!languageLevel1.isPy3K()) && !languageLevel2.isPy3K()) {
        return;
      }
    }
  }
  rehighlightStrings(myProject);
}
