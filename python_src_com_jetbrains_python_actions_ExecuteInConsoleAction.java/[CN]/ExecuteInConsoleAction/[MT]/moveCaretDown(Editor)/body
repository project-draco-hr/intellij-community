{
  VisualPosition pos=editor.getCaretModel().getVisualPosition();
  Pair<LogicalPosition,LogicalPosition> lines=EditorUtil.calcSurroundingRange(editor,pos,pos);
  int offset=editor.getCaretModel().getOffset();
  LogicalPosition lineStart=lines.first;
  LogicalPosition nextLineStart=lines.second;
  int start=editor.logicalPositionToOffset(lineStart);
  int end=editor.logicalPositionToOffset(nextLineStart);
  Document document=editor.getDocument();
  if (nextLineStart.line < document.getLineCount()) {
    int newOffset=end + offset - start;
    int nextLineEndOffset=document.getLineEndOffset(nextLineStart.line);
    if (newOffset >= nextLineEndOffset) {
      newOffset=nextLineEndOffset;
    }
    editor.getCaretModel().moveToOffset(newOffset);
    editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  }
}
