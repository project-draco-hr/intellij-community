{
  final IndexPatternProvider patternProvider=queryParameters.getPatternProvider();
  final PsiFile file=queryParameters.getFile();
  TIntArrayList commentStarts=new TIntArrayList();
  TIntArrayList commentEnds=new TIntArrayList();
  final CharSequence chars=file.getViewProvider().getContents();
  findCommentTokenRanges(file,chars,queryParameters.getRange(),commentStarts,commentEnds);
  TIntArrayList occurrences=new TIntArrayList(1);
  IndexPattern[] patterns=patternProvider != null ? patternProvider.getIndexPatterns() : null;
  for (int i=0; i < commentStarts.size(); i++) {
    int commentStart=commentStarts.get(i);
    int commentEnd=commentEnds.get(i);
    occurrences.resetQuick();
    if (patternProvider != null) {
      for (int j=patterns.length - 1; j >= 0; --j) {
        if (!collectPatternMatches(patterns[j],chars,commentStart,commentEnd,file,queryParameters.getRange(),consumer,occurrences)) {
          return false;
        }
      }
    }
 else {
      if (!collectPatternMatches(queryParameters.getPattern(),chars,commentStart,commentEnd,file,queryParameters.getRange(),consumer,occurrences)) {
        return false;
      }
    }
  }
  return true;
}
