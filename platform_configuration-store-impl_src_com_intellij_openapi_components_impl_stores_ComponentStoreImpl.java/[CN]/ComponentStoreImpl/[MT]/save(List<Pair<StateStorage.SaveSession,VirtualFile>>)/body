{
  ExternalizationSession externalizationSession=myComponents.isEmpty() ? null : getStateStorageManager().startExternalization();
  if (externalizationSession != null) {
    String[] names=ArrayUtilRt.toStringArray(myComponents.keySet());
    Arrays.sort(names);
    for (    String name : names) {
      commitComponent(externalizationSession,myComponents.get(name),name);
    }
  }
  List<Throwable> errors=null;
  for (  SettingsSavingComponent settingsSavingComponent : mySettingsSavingComponents) {
    try {
      settingsSavingComponent.save();
    }
 catch (    Throwable e) {
      if (errors == null) {
        errors=new SmartList<Throwable>();
      }
      errors.add(e);
    }
  }
  errors=doSave(externalizationSession == null ? null : externalizationSession.createSaveSessions(),readonlyFiles,errors);
  CompoundRuntimeException.doThrow(errors);
}
