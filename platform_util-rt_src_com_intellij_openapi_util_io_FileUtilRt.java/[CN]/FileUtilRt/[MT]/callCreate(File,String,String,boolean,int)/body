{
  prefix+=i == 0 ? "" : i;
  if (prefix.endsWith(".") && suffix.startsWith(".")) {
    prefix=prefix.substring(0,prefix.length() - 1);
  }
  String name=prefix + suffix;
  File f=new File(directory,name);
  if (!name.equals(f.getName())) {
    throw new IOException("Unable to create temporary file " + f + " for name "+ name);
  }
  boolean success=isDirectory ? f.mkdir() : f.createNewFile();
  if (!success) {
    throw new IOException("Unable to create temporary file " + f);
  }
  return f;
}
