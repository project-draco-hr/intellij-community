{
  prefix=new File(prefix).getName();
  File f;
  int i=0;
  do {
    String name=prefix + (i == 0 ? "" : Integer.toString(i)) + suffix;
    f=new File(directory,name);
    if (!name.equals(f.getName())) {
      throw new IOException("Unable to create temporary file, " + f + ", "+ name);
    }
    i++;
  }
 while (f.exists());
  boolean success=isDirectory ? f.mkdir() : f.createNewFile();
  if (!success) {
    throw new IOException("Unable to create temporary file " + f);
  }
  return f;
}
