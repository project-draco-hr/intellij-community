{
  List<String> parameters=new LinkedList<String>();
  parameters.add("--logfile");
  parameters.add(saveCommitMessage().getAbsolutePath());
  if (withSubrepos) {
    parameters.add("-S");
    parameters.addAll(mySubrepos);
  }
 else   if (amendCommit) {
    parameters.add("--amend");
  }
  parameters.addAll(chunk);
  HgCommandExecutor executor=new HgCommandExecutor(myProject);
  executor.setCharset(myCharset);
  ensureSuccess(executor.executeInCurrentThread(myRoot,"commit",parameters));
}
