{
  PyExpression lhsExpression=node.getLeftHandSideExpression();
  PsiElement assignedValue=node.getAssignedValue();
  if (assignedValue instanceof PyParenthesizedExpression)   assignedValue=((PyParenthesizedExpression)assignedValue).getContainedExpression();
  if (lhsExpression instanceof PyParenthesizedExpression)   lhsExpression=((PyParenthesizedExpression)lhsExpression).getContainedExpression();
  if (assignedValue instanceof PyReferenceExpression) {
    assignedValue=((PyReferenceExpression)assignedValue).followAssignmentsChain(resolveWithoutImplicits()).getElement();
  }
  if (lhsExpression instanceof PyTupleExpression) {
    int valuesLength=1;
    PyExpression[] elements=((PyTupleExpression)lhsExpression).getElements();
    if (assignedValue instanceof PySequenceExpression)     valuesLength=((PySequenceExpression)assignedValue).getElements().length;
 else     if (assignedValue instanceof PyDictLiteralExpression)     valuesLength=((PyDictLiteralExpression)assignedValue).getElements().length;
    boolean containsStarExpression=false;
    VirtualFile virtualFile=node.getContainingFile().getVirtualFile();
    if (virtualFile != null && LanguageLevel.forFile(virtualFile).isPy3K()) {
      for (      PyExpression target : elements) {
        if (target instanceof PyStarExpression) {
          if (containsStarExpression) {
            registerProblem(target,"Only one starred expression allowed in assignment");
            return;
          }
          containsStarExpression=true;
          ++valuesLength;
        }
      }
    }
    int targetsLength=elements.length;
    if (targetsLength > valuesLength) {
      registerProblem(node.getAssignedValue(),"Need more values to unpack");
    }
 else     if (!containsStarExpression && targetsLength < valuesLength) {
      registerProblem(node.getAssignedValue(),"Too many values to unpack");
    }
  }
}
