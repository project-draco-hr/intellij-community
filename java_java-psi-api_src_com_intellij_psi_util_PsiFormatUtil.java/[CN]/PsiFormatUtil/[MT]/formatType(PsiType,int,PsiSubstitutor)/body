{
  type=substitutor.substitute(type);
  if ((options & SHOW_RAW_TYPE) != 0) {
    type=TypeConversionUtil.erasure(type);
  }
 else   if ((options & SHOW_RAW_NON_TOP_TYPE) != 0) {
    if (!(PsiUtil.resolveClassInType(type) instanceof PsiTypeParameter)) {
      final boolean preserveEllipsis=type instanceof PsiEllipsisType;
      type=TypeConversionUtil.erasure(type);
      if (preserveEllipsis && type instanceof PsiArrayType) {
        type=new PsiEllipsisType(((PsiArrayType)type).getComponentType());
      }
    }
  }
  if (type == null)   return "null";
  return (options & SHOW_FQ_CLASS_NAMES) == 0 ? type.getPresentableText() : (options & USE_INTERNAL_CANONICAL_TEXT) == 0 ? type.getCanonicalText(false) : type.getInternalCanonicalText();
}
