{
  final AtomicReference<UpdateSettings> updateSettings=new AtomicReference<UpdateSettings>();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      final GitRejectedPushUpdateDialog dialog=new GitRejectedPushUpdateDialog(myProject,rejectedPushesForCurrentBranch.keySet(),initialSettings);
      dialog.show();
      final int exitCode=dialog.getExitCode();
      if (exitCode != DialogWrapper.CANCEL_EXIT_CODE) {
        mySettings.setAutoUpdateIfPushRejected(dialog.shouldAutoUpdateInFuture());
      }
      updateSettings.set(new UpdateSettings(dialog.shouldUpdateAll(),getUpdateMethodFromDialogExitCode(exitCode)));
    }
  }
);
  return updateSettings.get();
}
