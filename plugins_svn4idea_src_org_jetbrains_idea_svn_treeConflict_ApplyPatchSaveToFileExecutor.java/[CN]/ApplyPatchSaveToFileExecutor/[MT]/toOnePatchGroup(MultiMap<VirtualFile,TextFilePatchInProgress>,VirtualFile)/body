{
  List<FilePatch> result=newArrayList();
  for (  Map.Entry<VirtualFile,Collection<TextFilePatchInProgress>> entry : patchGroups.entrySet()) {
    VirtualFile oldPatchBase=entry.getKey();
    String relativePath=VfsUtilCore.getRelativePath(oldPatchBase,newPatchBase,'/');
    boolean toConvert=!isEmptyOrSpaces(relativePath) && !".".equals(relativePath);
    for (    TextFilePatchInProgress patchInProgress : entry.getValue()) {
      TextFilePatch patch=patchInProgress.getPatch();
      if (toConvert) {
        patch.setBeforeName(getNewBaseRelativePath(newPatchBase,oldPatchBase,patch.getBeforeName()));
        patch.setAfterName(getNewBaseRelativePath(newPatchBase,oldPatchBase,patch.getAfterName()));
      }
      result.add(patch);
    }
  }
  return result;
}
