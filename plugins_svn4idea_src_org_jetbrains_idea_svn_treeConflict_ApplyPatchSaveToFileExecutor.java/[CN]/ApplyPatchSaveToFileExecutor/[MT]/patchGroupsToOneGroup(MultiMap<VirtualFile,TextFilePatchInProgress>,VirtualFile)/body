{
  final List<FilePatch> textPatches=new ArrayList<FilePatch>();
  final String baseDirPath=baseDir.getPath();
  for (  Map.Entry<VirtualFile,Collection<TextFilePatchInProgress>> entry : patchGroups.entrySet()) {
    final VirtualFile vf=entry.getKey();
    final String currBasePath=vf.getPath();
    final String relativePath=VfsUtilCore.getRelativePath(vf,baseDir,'/');
    final boolean toConvert=!StringUtil.isEmptyOrSpaces(relativePath) && !".".equals(relativePath);
    for (    TextFilePatchInProgress patchInProgress : entry.getValue()) {
      final TextFilePatch patch=patchInProgress.getPatch();
      if (toConvert) {
        patch.setBeforeName(convertRelativePath(patch.getBeforeName(),currBasePath,baseDirPath));
        patch.setAfterName(convertRelativePath(patch.getAfterName(),currBasePath,baseDirPath));
      }
      textPatches.add(patch);
    }
  }
  return textPatches;
}
