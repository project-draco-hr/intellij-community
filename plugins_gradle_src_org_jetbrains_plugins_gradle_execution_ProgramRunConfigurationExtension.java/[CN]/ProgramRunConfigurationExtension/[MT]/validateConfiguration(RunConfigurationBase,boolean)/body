{
  super.validateConfiguration(configuration,isExecution);
  if (configuration instanceof ModuleBasedConfiguration && configuration instanceof CommonProgramRunConfigurationParameters) {
    final String workingDirectory=((CommonProgramRunConfigurationParameters)configuration).getWorkingDirectory();
    if (("$" + PathMacroUtil.MODULE_DIR_MACRO_NAME + "$").equals(workingDirectory)) {
      final RunConfigurationModule runConfigurationModule=((ModuleBasedConfiguration)configuration).getConfigurationModule();
      final String projectPath=ExternalSystemApiUtil.getExternalProjectPath(runConfigurationModule.getModule());
      if (StringUtil.isNotEmpty(projectPath)) {
        ((CommonProgramRunConfigurationParameters)configuration).setWorkingDirectory(projectPath);
      }
    }
  }
}
