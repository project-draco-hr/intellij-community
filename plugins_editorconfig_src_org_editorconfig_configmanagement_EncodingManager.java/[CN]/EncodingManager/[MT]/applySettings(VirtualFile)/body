{
  if (file == null || !file.isInLocalFileSystem())   return;
  if (!Utils.isEnabled(CodeStyleSettingsManager.getInstance(myProject).getCurrentSettings()))   return;
  isApplyingSettings=true;
  try {
    final String filePath=file.getCanonicalPath();
    final List<OutPair> outPairs=SettingsProviderComponent.getInstance().getOutPairs(filePath);
    final EncodingProjectManager encodingProjectManager=EncodingProjectManager.getInstance(myProject);
    final String charset=Utils.configValueForKey(outPairs,charsetKey);
    if (!charset.isEmpty()) {
      final Charset newCharset=encodingMap.get(charset);
      if (newCharset != null) {
        if (Comparing.equal(newCharset,file.getCharset()))         return;
        encodingProjectManager.setEncoding(file,newCharset);
        Utils.appliedConfigMessage(myProject,charset,charsetKey,filePath);
      }
 else {
        Utils.invalidConfigMessage(myProject,charset,charsetKey,filePath);
      }
    }
  }
  finally {
    isApplyingSettings=false;
  }
}
