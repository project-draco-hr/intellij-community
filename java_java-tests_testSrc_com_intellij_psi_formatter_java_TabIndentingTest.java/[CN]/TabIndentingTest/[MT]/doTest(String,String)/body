{
  String text=loadFile(fileNameBefore);
  final PsiFile file=createFile(fileNameBefore,text);
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            CodeStyleManager.getInstance(getProject()).reformat(file);
          }
 catch (          IncorrectOperationException e) {
            assertTrue(false);
          }
        }
      }
);
    }
  }
,null,null);
  String textAfter=loadFile(fileNameAfter);
  String fileText=file.getText();
  if (textAfter.startsWith("\n")) {
    textAfter=textAfter.substring(1);
  }
  if (fileText.startsWith("\n")) {
    fileText=fileText.substring(1);
  }
  if (!textAfter.equals(fileText)) {
    System.err.println("Expected:");
    System.err.println(textAfter);
    System.err.println();
    System.err.println("Was:");
    System.err.println(fileText);
    assertEquals(textAfter,fileText);
  }
}
