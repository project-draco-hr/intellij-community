{
  if (ApplicationManager.getApplication().isDisposed()) {
    return;
  }
  final File registeredIndicesFile=new File(PathManager.getIndexRoot(),"registered");
  final Set<String> indicesToDrop=new THashSet<>();
  try (DataInputStream in=new DataInputStream(new BufferedInputStream(new FileInputStream(registeredIndicesFile)))){
    final int size=in.readInt();
    for (int idx=0; idx < size; idx++) {
      indicesToDrop.add(IOUtil.readString(in));
    }
  }
 catch (  IOException ignored) {
  }
  for (  ID<?,?> key : ids) {
    indicesToDrop.remove(key.toString());
  }
  if (!indicesToDrop.isEmpty()) {
    LOG.info("Dropping indices:" + StringUtil.join(indicesToDrop,","));
    for (    String s : indicesToDrop) {
      FileUtil.deleteWithRenaming(IndexInfrastructure.getIndexRootDir(ID.create(s)));
    }
  }
  FileUtil.createIfDoesntExist(registeredIndicesFile);
  try (DataOutputStream os=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(registeredIndicesFile)))){
    os.writeInt(ids.size());
    for (    ID<?,?> id : ids) {
      IOUtil.writeString(id.toString(),os);
    }
  }
 catch (  IOException ignored) {
  }
}
