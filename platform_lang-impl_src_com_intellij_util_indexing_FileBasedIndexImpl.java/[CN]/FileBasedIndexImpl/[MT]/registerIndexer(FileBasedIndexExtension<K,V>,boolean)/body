{
  final ID<K,V> name=extension.getName();
  final int version=extension.getVersion();
  final File versionFile=IndexInfrastructure.getVersionFile(name);
  final boolean versionFileExisted=versionFile.exists();
  boolean versionChanged=false;
  if (isCurrentVersionCorrupted || IndexingStamp.versionDiffers(versionFile,version)) {
    if (!isCurrentVersionCorrupted && versionFileExisted) {
      versionChanged=true;
      LOG.info("Version has changed for index " + name + ". The index will be rebuilt.");
    }
    if (extension.hasSnapshotMapping() && (isCurrentVersionCorrupted || versionChanged)) {
      FileUtil.deleteWithRenaming(IndexInfrastructure.getPersistentIndexRootDir(name));
    }
    File rootDir=IndexInfrastructure.getIndexRootDir(name);
    if (rootDir.list().length > 0) {
      FileUtil.deleteWithRenaming(rootDir);
    }
    IndexingStamp.rewriteVersion(versionFile,version);
  }
  initIndexStorage(extension,version,versionFile);
  return versionChanged;
}
