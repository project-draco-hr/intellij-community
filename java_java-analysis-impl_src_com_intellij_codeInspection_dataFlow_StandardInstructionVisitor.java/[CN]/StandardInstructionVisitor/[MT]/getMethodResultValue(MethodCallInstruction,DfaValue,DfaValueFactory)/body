{
  DfaValue precalculated=instruction.getPrecalculatedReturnValue();
  if (precalculated != null) {
    return precalculated;
  }
  final PsiType type=instruction.getResultType();
  final MethodCallInstruction.MethodType methodType=instruction.getMethodType();
  if (methodType == MethodCallInstruction.MethodType.UNBOXING) {
    return factory.getBoxedFactory().createUnboxed(qualifierValue);
  }
  if (methodType == MethodCallInstruction.MethodType.BOXING) {
    DfaValue boxed=factory.getBoxedFactory().createBoxed(qualifierValue);
    return boxed == null ? factory.createTypeValue(type,Nullness.NOT_NULL) : boxed;
  }
  if (methodType == MethodCallInstruction.MethodType.CAST) {
    if (qualifierValue instanceof DfaConstValue) {
      Object casted=TypeConversionUtil.computeCastTo(((DfaConstValue)qualifierValue).getValue(),type);
      return factory.getConstFactory().createFromValue(casted,type,((DfaConstValue)qualifierValue).getConstant());
    }
    return qualifierValue;
  }
  if (type != null && (type instanceof PsiClassType || type.getArrayDimensions() > 0)) {
    return factory.createTypeValue(type,myReturnTypeNullability.get(instruction));
  }
  return DfaUnknownValue.getInstance();
}
