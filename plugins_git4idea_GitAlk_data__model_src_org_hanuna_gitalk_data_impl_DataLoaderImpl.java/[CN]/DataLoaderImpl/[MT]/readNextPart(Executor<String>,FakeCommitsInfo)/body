{
switch (state) {
case ALL_LOG_READER:
    throw new IllegalStateException("data was read");
case UNINITIALIZED:
  System.out.println("=== readNextPart() called with " + fakeCommits.commits.size() + " fake commits");
List<CommitParents> commitParentsList=new ArrayList<CommitParents>();
List<CommitParents> commits=partReader.readNextBlock(statusUpdater);
for (CommitParents commit : commits) {
if (fakeCommits.base != null && commit.getCommitHash().equals(fakeCommits.base.getCommitHash())) {
commitParentsList.addAll(fakeCommits.commits);
}
commitParentsList.add(commit);
}
state=State.PART_LOG_READER;
List<Ref> allRefs=new ArrayList<Ref>();
allRefs.addAll(new RefReader(myProject).readAllRefs());
if (fakeCommits.resultRef != null) {
allRefs.add(fakeCommits.resultRef);
allRefs.remove(fakeCommits.subjectRef);
}
dataPack=DataPackImpl.buildDataPack(commitParentsList,allRefs,statusUpdater,myProject);
break;
case PART_LOG_READER:
List<CommitParents> nextPart=partReader.readNextBlock(statusUpdater);
dataPack.appendCommits(nextPart,statusUpdater);
break;
default :
throw new IllegalStateException();
}
}
