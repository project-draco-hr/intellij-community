{
  AccessToken accessToken=ReadAction.start();
  try {
    if (DumbService.isDumb(project)) {
      mySuspendCounter.incrementAndGet();
    }
    MessageBusConnection connection=project.getMessageBus().connect(this);
    connection.subscribe(DumbService.DUMB_MODE,new DumbService.DumbModeListener(){
      @Override public void enteredDumbMode(){
        suspend();
      }
      @Override public void exitDumbMode(){
        resume();
      }
    }
);
    if (DumbService.getInstance(project).isDumb()) {
      suspend();
    }
  }
  finally {
    accessToken.finish();
  }
}
