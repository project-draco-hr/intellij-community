{
  VirtualFile myVFile=getSourceRoot().createChildData(null,name);
  VfsUtil.saveText(myVFile,text);
  final FileDocumentManager manager=FileDocumentManager.getInstance();
  final Document document=manager.getDocument(myVFile);
  manager.reloadFromDisk(document);
  Editor editor=createEditor(myVFile);
  EditorTestUtil.CaretAndSelectionState caretsState=EditorTestUtil.extractCaretAndSelectionMarkers(document);
  EditorTestUtil.setCaretsAndSelection(editor,caretsState);
  return editor;
}
