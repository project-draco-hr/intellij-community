{
  Application application=ApplicationManager.getApplication();
  if (!application.isDispatchThread() && application.isReadAccessAllowed()) {
    LOG.error("Must not start write action from within read action in the other thread - deadlock is coming");
    throw new IllegalStateException();
  }
  final RunResult<T> result=new RunResult<T>(this);
  try {
    application.invokeAndWait(new Runnable(){
      @Override public void run(){
        performWriteCommandAction(result);
      }
    }
,ModalityState.defaultModalityState());
  }
 catch (  ProcessCanceledException ignored) {
  }
  return result;
}
