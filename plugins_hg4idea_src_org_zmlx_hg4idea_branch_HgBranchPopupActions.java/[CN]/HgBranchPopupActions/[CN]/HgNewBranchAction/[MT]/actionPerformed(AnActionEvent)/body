{
  final String name=getNewBranchNameFromUser(myPreselectedRepo,"Create New Branch");
  if (name == null) {
    return;
  }
  for (  final HgRepository repository : myRepositories) {
    try {
      new HgBranchCreateCommand(myProject,repository.getRoot(),name).execute(new HgCommandResultHandler(){
        @Override public void process(        @Nullable HgCommandResult result){
          repository.update();
          if (HgErrorUtil.hasErrorsInCommandExecution(result)) {
            new HgCommandResultNotifier(myProject).notifyError(result,"Creation failed","Branch creation [" + name + "] failed");
          }
        }
      }
);
    }
 catch (    HgCommandException exception) {
      HgAbstractGlobalAction.handleException(myProject,"Can't create new branch: ",exception);
    }
  }
}
