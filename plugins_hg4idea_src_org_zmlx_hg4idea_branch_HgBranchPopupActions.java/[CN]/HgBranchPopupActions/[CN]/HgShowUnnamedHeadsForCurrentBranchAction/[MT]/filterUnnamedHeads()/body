{
  Collection<Hash> branchWithHashes=myRepository.getBranches().get(myCurrentBranchName);
  String currentHead=myRepository.getCurrentRevision();
  if (branchWithHashes == null || currentHead == null || myRepository.getState() != Repository.State.NORMAL) {
    return Collections.emptySet();
  }
 else {
    Collection<Hash> bookmarkHashes=ContainerUtil.map(myRepository.getBookmarks(),new Function<HgNameWithHashInfo,Hash>(){
      @Override public Hash fun(      HgNameWithHashInfo info){
        return info.getHash();
      }
    }
);
    branchWithHashes.removeAll(bookmarkHashes);
    branchWithHashes.remove(HashImpl.build(currentHead));
  }
  return branchWithHashes;
}
