{
  if (myPlace == null)   return null;
  final PsiElement parent=PsiUtil.skipParenthesizedExprUp(myPlace.getParent());
  if (parent instanceof PsiVariable) {
    if (myPlace.equals(PsiUtil.skipParenthesizedExprDown(((PsiVariable)parent).getInitializer()))) {
      return ((PsiVariable)parent).getType();
    }
  }
 else   if (parent instanceof PsiAssignmentExpression) {
    if (myPlace.equals(PsiUtil.skipParenthesizedExprDown(((PsiAssignmentExpression)parent).getRExpression()))) {
      return ((PsiAssignmentExpression)parent).getLExpression().getType();
    }
  }
 else   if (parent instanceof PsiReturnStatement) {
    final PsiElement psiElement=PsiTreeUtil.getParentOfType(parent,PsiLambdaExpression.class,PsiMethod.class);
    if (psiElement instanceof PsiLambdaExpression) {
      return LambdaUtil.getFunctionalInterfaceReturnType(((PsiLambdaExpression)psiElement).getFunctionalInterfaceType());
    }
 else     if (psiElement instanceof PsiMethod) {
      return ((PsiMethod)psiElement).getReturnType();
    }
  }
 else   if (parent instanceof PsiExpressionList) {
    final PsiElement pParent=parent.getParent();
    if (pParent instanceof PsiCallExpression && parent.equals(((PsiCallExpression)pParent).getArgumentList())) {
      final JavaResolveResult resolveResult=((PsiCallExpression)pParent).resolveMethodGenerics();
      final PsiElement psiElement=resolveResult.getElement();
      if (psiElement instanceof PsiMethod) {
        final PsiMethod psiMethod=(PsiMethod)psiElement;
        final PsiParameter[] parameters=psiMethod.getParameterList().getParameters();
        final int idx=ArrayUtilRt.find(((PsiExpressionList)parent).getExpressions(),PsiUtil.skipParenthesizedExprUp(myPlace));
        if (idx > -1 && parameters.length > 0) {
          PsiType parameterType=parameters[Math.min(idx,parameters.length - 1)].getType();
          if (idx >= parameters.length - 1) {
            final PsiParameter lastParameter=parameters[parameters.length - 1];
            if (lastParameter.isVarArgs()) {
              parameterType=((PsiEllipsisType)lastParameter.getType()).getComponentType();
            }
          }
          return resolveResult.getSubstitutor().substitute(parameterType);
        }
 else {
          return null;
        }
      }
    }
  }
 else   if (parent instanceof PsiLambdaExpression) {
    return LambdaUtil.getFunctionalInterfaceReturnType(((PsiLambdaExpression)parent).getFunctionalInterfaceType());
  }
  return null;
}
