{
  final Module module=ModuleUtilCore.findModuleForPsiElement(element);
  if (module == null) {
    return Collections.emptyList();
  }
  final List<String> allBundleNames;
  if (bundleName == null) {
    allBundleNames=getPluginResourceBundles(element);
  }
 else {
    allBundleNames=Collections.singletonList(bundleName);
  }
  final Project project=element.getProject();
  final GlobalSearchScope projectScope=GlobalSearchScope.projectScope(project);
  final PropertiesReferenceManager propertiesReferenceManager=PropertiesReferenceManager.getInstance(project);
  final List<PropertiesFile> allPropertiesFiles=new ArrayList<>();
  for (  String name : allBundleNames) {
    final List<PropertiesFile> propertiesFiles=propertiesReferenceManager.findPropertiesFiles(module,name);
    allPropertiesFiles.addAll(propertiesFiles);
    if (propertiesFiles.isEmpty()) {
      allPropertiesFiles.addAll(propertiesReferenceManager.findPropertiesFiles(projectScope,name,BundleNameEvaluator.DEFAULT));
    }
  }
  return allPropertiesFiles;
}
