{
  int lineNumber=editor.getCaretModel().getLogicalPosition().line;
  int caretOffset=editor.getCaretModel().getOffset();
  Document document=editor.getDocument();
  if (lineNumber >= document.getLineCount()) {
    return;
  }
  CharSequence text=document.getCharsSequence();
  boolean camel=editor.getSettings().isCamelWords();
  List<TextRange> ranges=new ArrayList<TextRange>();
  int textLength=document.getTextLength();
  if (caretOffset == textLength)   caretOffset--;
  if (caretOffset < 0)   return;
  SelectWordUtil.addWordSelection(camel,text,caretOffset,ranges);
  if (ranges.isEmpty())   return;
  SelectionModel selectionModel=editor.getSelectionModel();
  final TextRange selectionRange=new TextRange(selectionModel.getSelectionStart(),selectionModel.getSelectionEnd());
  TextRange minimumRange=new TextRange(0,editor.getDocument().getTextLength());
  for (  TextRange range : ranges) {
    if (range.contains(selectionRange) && !range.equals(selectionRange)) {
      if (minimumRange.contains(range)) {
        minimumRange=range;
      }
    }
  }
  selectionModel.setSelection(minimumRange.getStartOffset(),minimumRange.getEndOffset());
}
