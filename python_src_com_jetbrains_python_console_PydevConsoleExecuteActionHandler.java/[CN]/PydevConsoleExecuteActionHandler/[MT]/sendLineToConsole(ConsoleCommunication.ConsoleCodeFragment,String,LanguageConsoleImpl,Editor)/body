{
  if (myConsoleCommunication != null) {
    final boolean waitedForInputBefore=myConsoleCommunication.isWaitingForInput();
    if (myConsoleCommunication.isWaitingForInput()) {
      myInputBuffer.setLength(0);
    }
 else {
      executingPrompt(console);
    }
    myConsoleCommunication.execInterpreter(code,new Function<InterpreterResponse,Object>(){
      public Object fun(      final InterpreterResponse interpreterResponse){
        myInputBuffer=null;
        if (interpreterResponse.more) {
          more(console,currentEditor);
          if (myCurrentIndentSize == 0) {
            setCurrentIndentSize((line != null ? IndentHelperImpl.getIndent(getProject(),PythonFileType.INSTANCE,line,false) : 0) + getPythonIndent());
            UIUtil.invokeLaterIfNeeded(new Runnable(){
              @Override public void run(){
                indentEditor(currentEditor,myCurrentIndentSize);
              }
            }
);
          }
        }
 else {
          if (!myConsoleCommunication.isWaitingForInput()) {
            ordinaryPrompt(console,currentEditor);
          }
          setCurrentIndentSize(0);
        }
        return null;
      }
    }
);
    if (waitedForInputBefore && !myConsoleCommunication.isWaitingForInput()) {
      console.setPrompt(PyConsoleUtil.ORDINARY_PROMPT);
      PyConsoleUtil.scrollDown(currentEditor);
    }
  }
}
