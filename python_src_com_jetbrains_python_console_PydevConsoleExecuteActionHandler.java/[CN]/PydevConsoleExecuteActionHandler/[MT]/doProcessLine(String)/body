{
  if (myInputBuffer == null) {
    myInputBuffer=new StringBuilder();
  }
  if (!StringUtil.isEmptyOrSpaces(line)) {
    myInputBuffer.append(line);
    if (!line.endsWith("\n")) {
      myInputBuffer.append("\n");
    }
  }
  if (StringUtil.isEmptyOrSpaces(line) && StringUtil.isEmptyOrSpaces(myInputBuffer.toString())) {
    myInputBuffer.append("");
  }
  if (myInMultilineStringState != null) {
    if (PyConsoleUtil.isDoubleQuoteMultilineStarts(line) || PyConsoleUtil.isSingleQuoteMultilineStarts(line)) {
      myInMultilineStringState=null;
      myConsoleView.setLanguage(PythonLanguage.getInstance());
      myConsoleView.setPrompt(PyConsoleUtil.ORDINARY_PROMPT);
    }
 else {
      if (line.equals("\n")) {
        myInputBuffer.append("\n");
      }
      return;
    }
  }
 else {
    if (PyConsoleUtil.isDoubleQuoteMultilineStarts(line)) {
      myInMultilineStringState=PyConsoleUtil.DOUBLE_QUOTE_MULTILINE;
    }
 else     if (PyConsoleUtil.isSingleQuoteMultilineStarts(line)) {
      myInMultilineStringState=PyConsoleUtil.SINGLE_QUOTE_MULTILINE;
    }
    if (myInMultilineStringState != null) {
      myConsoleView.setLanguage(PlainTextLanguage.INSTANCE);
      myConsoleView.setPrompt(PyConsoleUtil.INDENT_PROMPT);
      return;
    }
  }
  if (line.endsWith("\\")) {
    myConsoleView.setPrompt(PyConsoleUtil.INDENT_PROMPT);
    return;
  }
  if (!StringUtil.isEmptyOrSpaces(line)) {
    int indent=IndentHelperImpl.getIndent(getProject(),PythonFileType.INSTANCE,line,false);
    boolean flag=false;
    if (PyConsoleIndentUtil.shouldIndent(line)) {
      indent+=getPythonIndent();
      flag=true;
    }
    if ((myCurrentIndentSize > 0 && indent > 0) || flag) {
      setCurrentIndentSize(indent);
      indentEditor(myConsoleView.getConsoleEditor(),indent);
      more();
      myConsoleCommunication.notifyCommandExecuted(true);
      return;
    }
  }
  sendLineToConsole(new ConsoleCommunication.ConsoleCodeFragment(myInputBuffer.toString(),true));
}
