{
  final MatcherImpl.CompiledOptions compiledOptions=SSBasedInspectionCompiledPatternsCache.getCompiledOptions(holder.getProject());
  if (compiledOptions == null)   return super.buildVisitor(holder,isOnTheFly);
  return new PsiElementVisitor(){
    final List<Pair<MatchContext,Configuration>> contexts=compiledOptions.getMatchContexts();
    final Matcher matcher=new Matcher(holder.getManager().getProject());
    final PairProcessor<MatchResult,Configuration> processor=new PairProcessor<MatchResult,Configuration>(){
      public boolean process(      MatchResult matchResult,      Configuration configuration){
        PsiElement element=matchResult.getMatch();
        String name=configuration.getName();
        LocalQuickFix fix=createQuickFix(holder.getManager().getProject(),matchResult,configuration);
        holder.registerProblem(holder.getManager().createProblemDescriptor(element,name,fix,ProblemHighlightType.GENERIC_ERROR_OR_WARNING,isOnTheFly));
        return true;
      }
    }
;
    @Override public void visitElement(    PsiElement element){
      if (LexicalNodesFilter.getInstance().accepts(element))       return;
      final SsrFilteringNodeIterator matchedNodes=new SsrFilteringNodeIterator(element);
      for (      Pair<MatchContext,Configuration> pair : contexts) {
        Configuration configuration=pair.second;
        MatchContext context=pair.first;
        if (Matcher.checkIfShouldAttemptToMatch(context,matchedNodes)) {
          matcher.processMatchesInElement(context,configuration,matchedNodes,processor);
        }
      }
    }
  }
;
}
