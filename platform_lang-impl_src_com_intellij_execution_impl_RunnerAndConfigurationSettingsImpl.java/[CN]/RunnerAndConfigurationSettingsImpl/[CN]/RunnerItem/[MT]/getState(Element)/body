{
  List<Element> runnerSettings=new SmartList<Element>();
  for (  ProgramRunner runner : settings.keySet()) {
    T settings=this.settings.get(runner);
    boolean wasLoaded=loadedIds.contains(runner.getRunnerId());
    if (settings == null && !wasLoaded) {
      continue;
    }
    Element state=new Element(childTagName);
    if (settings != null) {
      ((JDOMExternalizable)settings).writeExternal(state);
    }
    if (wasLoaded || !JDOMUtil.isEmpty(state)) {
      state.setAttribute(RUNNER_ID,runner.getRunnerId());
      runnerSettings.add(state);
    }
  }
  if (unloadedSettings != null) {
    for (    Element unloadedSetting : unloadedSettings) {
      runnerSettings.add(unloadedSetting.clone());
    }
  }
  Collections.sort(runnerSettings,RUNNER_COMPARATOR);
  for (  Element runnerSetting : runnerSettings) {
    element.addContent(runnerSetting);
  }
}
