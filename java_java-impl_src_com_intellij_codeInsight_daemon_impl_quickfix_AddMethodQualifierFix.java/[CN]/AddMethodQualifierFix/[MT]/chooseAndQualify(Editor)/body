{
  final BaseListPopupStep<PsiVariable> step=new BaseListPopupStep<PsiVariable>(QuickFixBundle.message("add.qualifier"),myCandidates){
    @Override public PopupStep onChosen(    final PsiVariable selectedValue,    final boolean finalChoice){
      if (selectedValue != null && finalChoice) {
        WriteCommandAction.runWriteCommandAction(selectedValue.getProject(),new Runnable(){
          @Override public void run(){
            qualify(selectedValue,editor);
          }
        }
);
      }
      return FINAL_CHOICE;
    }
    @NotNull @Override public String getTextFor(    final PsiVariable value){
      return ObjectUtils.assertNotNull(value.getName());
    }
    @Override public Icon getIconFor(    final PsiVariable aValue){
      return aValue.getIcon(0);
    }
  }
;
  final ListPopupImpl popup=new ListPopupImpl(step);
  popup.showInBestPositionFor(editor);
}
