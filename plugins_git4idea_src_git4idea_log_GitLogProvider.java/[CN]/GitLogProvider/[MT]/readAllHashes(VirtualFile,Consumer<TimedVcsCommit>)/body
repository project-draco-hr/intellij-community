{
  if (!isRepositoryReady(root)) {
    return LogDataImpl.empty();
  }
  List<String> parameters=new ArrayList<String>(GitHistoryUtils.LOG_ALL);
  parameters.add("--sparse");
  final GitBekParentFixer parentFixer=GitBekParentFixer.prepare(root,this);
  Set<VcsUser> userRegistry=ContainerUtil.newHashSet();
  Set<VcsRef> refs=ContainerUtil.newHashSet();
  GitHistoryUtils.readCommits(myProject,root,parameters,new CollectConsumer<VcsUser>(userRegistry),new CollectConsumer<VcsRef>(refs),new Consumer<TimedVcsCommit>(){
    @Override public void consume(    TimedVcsCommit commit){
      commitConsumer.consume(parentFixer.fixCommit(commit));
    }
  }
);
  return new LogDataImpl(refs,userRegistry);
}
