{
  StopWatch sw=StopWatch.start("readBranches in " + repository.getRoot().getName());
  VirtualFile root=repository.getRoot();
  repository.update();
  Collection<GitLocalBranch> localBranches=repository.getBranches().getLocalBranches();
  Collection<GitRemoteBranch> remoteBranches=repository.getBranches().getRemoteBranches();
  Set<VcsRef> refs=new THashSet<VcsRef>(localBranches.size() + remoteBranches.size());
  for (  GitLocalBranch localBranch : localBranches) {
    refs.add(myVcsObjectsFactory.createRef(localBranch.getHash(),localBranch.getName(),GitRefManager.LOCAL_BRANCH,root));
  }
  for (  GitRemoteBranch remoteBranch : remoteBranches) {
    refs.add(myVcsObjectsFactory.createRef(remoteBranch.getHash(),remoteBranch.getNameForLocalOperations(),GitRefManager.REMOTE_BRANCH,root));
  }
  String currentRevision=repository.getCurrentRevision();
  if (currentRevision != null) {
    refs.add(myVcsObjectsFactory.createRef(HashImpl.build(currentRevision),"HEAD",GitRefManager.HEAD,root));
  }
  sw.report();
  return refs;
}
