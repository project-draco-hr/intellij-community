{
  VirtualFile sourceRepo=VcsUtil.getVcsRootFor(myProject,source);
  VirtualFile targetRepo=VcsUtil.getVcsRootFor(myProject,target);
  HgCommandExecutor executor=new HgCommandExecutor(myProject,VcsFileUtil.relativeOrFullPath(sourceRepo,source));
  if (sourceRepo != null && targetRepo != null && sourceRepo.equals(targetRepo)) {
    executor.executeInCurrentThread(sourceRepo,"copy",Arrays.asList("--after",VcsFileUtil.relativeOrFullPath(sourceRepo,source),VcsFileUtil.relativeOrFullPath(targetRepo,target)));
  }
 else {
    if (targetRepo != null) {
      new HgAddCommand(myProject).executeInCurrentThread(Collections.singleton(target));
    }
  }
}
