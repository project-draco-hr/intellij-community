{
  Project project=e.getProject();
  DiffRequest diffRequest=e.getData(DIFF_REQUEST);
  if (diffRequest != null) {
    return diffRequest;
  }
  VirtualFile[] data=e.getRequiredData(CommonDataKeys.VIRTUAL_FILE_ARRAY);
  if (data.length == 1) {
    FileChooserDescriptor descriptor=getDescriptor(data[0]);
    VirtualFile[] result=FileChooser.chooseFiles(descriptor,project,data[0]);
    if (result.length != 1 || result[0] == null)     return null;
    return DiffRequestFactory.getInstance().createFromFile(project,data[0],result[0]);
  }
 else {
    return DiffRequestFactory.getInstance().createFromFile(project,data[0],data[1]);
  }
}
