{
  FileTemplateManager manager=FileTemplateManager.getDefaultInstance();
  FileTemplate template=manager.getInternalTemplate(templateName);
  try {
    String lineSeparator=LoadTextUtil.detectLineSeparator(file,false);
    if (lineSeparator == null) {
      lineSeparator=CodeStyleSettingsManager.getSettings(ProjectManagerEx.getInstanceEx().getDefaultProject()).getLineSeparator();
    }
    String content=StringUtil.trimTrailing(VfsUtilCore.loadText(file)) + lineSeparator + StringUtil.convertLineSeparators((templateAttributes != null ? template.getText(templateAttributes) : template.getText()),lineSeparator);
    content=StringUtil.convertLineSeparators(content,lineSeparator);
    VfsUtil.saveText(file,content);
  }
 catch (  IOException e) {
    LOG.warn(String.format("Unexpected exception on appending template %s config",GradleConstants.SYSTEM_ID.getReadableName()),e);
    throw new ConfigurationException(e.getMessage(),String.format("Can't append %s template config text",GradleConstants.SYSTEM_ID.getReadableName()));
  }
}
