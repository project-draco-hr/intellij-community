{
  String lineSeparator=LoadTextUtil.detectLineSeparator(file,true);
  if (lineSeparator == null) {
    lineSeparator=CodeStyleSettingsManager.getSettings(ProjectManagerEx.getInstanceEx().getDefaultProject()).getLineSeparator();
  }
  final String existingText=StringUtil.trimTrailing(VfsUtilCore.loadText(file));
  String content=(StringUtil.isNotEmpty(existingText) ? existingText + lineSeparator : "") + StringUtil.convertLineSeparators(text,lineSeparator);
  VfsUtil.saveText(file,content);
}
