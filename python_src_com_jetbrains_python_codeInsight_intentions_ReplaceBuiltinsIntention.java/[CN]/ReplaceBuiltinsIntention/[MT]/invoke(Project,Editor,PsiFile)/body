{
  PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  PsiElement element=file.findElementAt(editor.getCaretModel().getOffset());
  PyImportStatement importStatement=PsiTreeUtil.getParentOfType(element,PyImportStatement.class);
  for (  PyImportElement importElement : importStatement.getImportElements()) {
    PyReferenceExpression importReference=importElement.getImportReference();
    if (importReference != null) {
      if (LanguageLevel.forFile(file.getVirtualFile()).isPy3K()) {
        if ("__builtin__".equals(importReference.getName())) {
          importReference.replace(elementGenerator.createFromText(LanguageLevel.getDefault(),PyReferenceExpression.class,"builtins"));
        }
      }
 else {
        if ("builtins".equals(importReference.getName())) {
          importReference.replace(elementGenerator.createFromText(LanguageLevel.getDefault(),PyReferenceExpression.class,"__builtin__"));
        }
      }
    }
  }
}
