{
  if (CodeInsightSettings.getInstance().ADD_IMPORTS_ON_PASTE == CodeInsightSettings.NO) {
    return Collections.emptyList();
  }
  if (file instanceof PsiCompiledFile) {
    file=((PsiCompiledFile)file).getDecompiledPsiFile();
  }
  if (!(file instanceof PsiClassOwner)) {
    return Collections.emptyList();
  }
  final ArrayList<ReferenceData> array=new ArrayList<ReferenceData>();
  for (int j=0; j < startOffsets.length; j++) {
    final int startOffset=startOffsets[j];
    for (    final PsiElement element : CollectHighlightsUtil.getElementsInRange(file,startOffset,endOffsets[j])) {
      addReferenceData(file,startOffset,element,array);
    }
  }
  if (array.isEmpty()) {
    return Collections.emptyList();
  }
  return Collections.singletonList(new ReferenceTransferableData(array.toArray(new ReferenceData[array.size()])));
}
