{
  Project project=e.getData(CommonDataKeys.PROJECT);
  if (project == null) {
    project=ProjectManager.getInstance().getDefaultProject();
  }
  PythonNewDirectoryProjectDialog dlg=new PythonNewDirectoryProjectDialog(project);
  dlg.show();
  if (dlg.getExitCode() != DialogWrapper.OK_EXIT_CODE)   return;
  mySdk=dlg.getSdk();
  if (mySdk instanceof PyDetectedSdk) {
    mySdk=SdkConfigurationUtil.createAndAddSDK(mySdk.getName(),PythonSdkType.getInstance());
  }
  myInstallFramework=dlg.installFramework();
  Project newProject=generateProject(project,dlg);
  if (newProject != null) {
    SdkConfigurationUtil.setDirectoryProjectSdk(newProject,mySdk);
    final List<Sdk> sdks=PythonSdkType.getAllSdks();
    for (    Sdk sdk : sdks) {
      final SdkAdditionalData additionalData=sdk.getSdkAdditionalData();
      if (additionalData instanceof PythonSdkAdditionalData) {
        ((PythonSdkAdditionalData)additionalData).reassociateWithCreatedProject(newProject);
      }
    }
  }
}
