{
  Project project=e.getData(CommonDataKeys.PROJECT);
  if (project == null) {
    project=ProjectManager.getInstance().getDefaultProject();
  }
  PythonNewDirectoryProjectDialog dlg=new PythonNewDirectoryProjectDialog(project);
  dlg.show();
  if (dlg.getExitCode() != DialogWrapper.OK_EXIT_CODE)   return;
  mySdk=dlg.getSdk();
  final ProjectSdksModel model=PyConfigurableInterpreterList.getInstance(project).getModel();
  if (mySdk instanceof PyDetectedSdk) {
    VirtualFile sdkHome=ApplicationManager.getApplication().runWriteAction(new Computable<VirtualFile>(){
      @Override public VirtualFile compute(){
        return LocalFileSystem.getInstance().refreshAndFindFileByPath(mySdk.getName());
      }
    }
);
    PySdkService.getInstance().solidifySdk(mySdk);
    mySdk=SdkConfigurationUtil.setupSdk(ProjectJdkTable.getInstance().getAllJdks(),sdkHome,PythonSdkType.getInstance(),true,null,null);
    model.addSdk(mySdk);
    try {
      model.apply();
    }
 catch (    ConfigurationException exception) {
      LOG.error("Error adding detected python interpreter " + exception.getMessage());
    }
  }
  mySdk=model.findSdk(mySdk);
  myInstallFramework=dlg.installFramework();
  Project newProject=generateProject(project,dlg);
  if (newProject != null) {
    SdkConfigurationUtil.setDirectoryProjectSdk(newProject,mySdk);
    final List<Sdk> sdks=PythonSdkType.getAllSdks();
    for (    Sdk sdk : sdks) {
      final SdkAdditionalData additionalData=sdk.getSdkAdditionalData();
      if (additionalData instanceof PythonSdkAdditionalData) {
        ((PythonSdkAdditionalData)additionalData).reassociateWithCreatedProject(newProject);
      }
    }
  }
}
