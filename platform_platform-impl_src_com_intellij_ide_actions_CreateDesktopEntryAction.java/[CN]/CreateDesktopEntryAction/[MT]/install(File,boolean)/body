{
  try {
    if (globalEntry) {
      final File script=ExecUtil.createTempExecutableScript("sudo",".sh","#!/bin/sh\n" + "xdg-desktop-menu install --mode system \"" + entryFile.getAbsolutePath() + "\"\n"+ "RV=$?\n"+ "xdg-desktop-menu forceupdate --mode system\n"+ "exit $RV\n");
      script.deleteOnExit();
      final String prompt=ApplicationBundle.message("desktop.entry.sudo.prompt");
      final int result=ExecUtil.sudoAndGetOutput(asList(script.getPath()),prompt,null).getExitCode();
      if (result != 0)       throw new RuntimeException("'" + script.getAbsolutePath() + "' : "+ result);
    }
 else {
      final int result=ExecUtil.execAndGetResult("xdg-desktop-menu","install","--mode","user",entryFile.getAbsolutePath());
      if (result != 0)       throw new RuntimeException("'" + entryFile.getAbsolutePath() + "' : "+ result);
      ExecUtil.execAndGetResult("xdg-desktop-menu","forceupdate","--mode","user");
    }
  }
  finally {
    if (!entryFile.delete())     LOG.error("Failed to delete temp file '" + entryFile + "'");
  }
}
