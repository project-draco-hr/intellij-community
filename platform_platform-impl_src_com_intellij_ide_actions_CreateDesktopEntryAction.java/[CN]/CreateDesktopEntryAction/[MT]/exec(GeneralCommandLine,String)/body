{
  command.setRedirectErrorStream(true);
  ProcessOutput result=prompt != null ? ExecUtil.sudoAndGetOutput(command,prompt) : ExecUtil.execAndGetOutput(command);
  int exitCode=result.getExitCode();
  if (exitCode != 0) {
    String message="Command '" + (prompt != null ? "sudo " : "") + command.getCommandLineString()+ "' returned "+ exitCode;
    String output=result.getStdout();
    if (!StringUtil.isEmptyOrSpaces(output))     message+="\nOutput: " + output.trim();
    throw new RuntimeException(message);
  }
}
