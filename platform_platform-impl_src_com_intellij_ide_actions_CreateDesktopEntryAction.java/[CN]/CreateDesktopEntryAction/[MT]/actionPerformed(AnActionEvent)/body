{
  if (!isAvailable())   return;
  Project project=event.getProject();
  CreateDesktopEntryDialog dialog=new CreateDesktopEntryDialog(project);
  if (!dialog.showAndGet()) {
    return;
  }
  final boolean globalEntry=dialog.myGlobalEntryCheckBox.isSelected();
  ProgressManager.getInstance().run(new Task.Backgroundable(project,ApplicationBundle.message("desktop.entry.title")){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      try {
        indicator.setIndeterminate(true);
        createDesktopEntry(globalEntry);
        final String message=ApplicationBundle.message("desktop.entry.success",ApplicationNamesInfo.getInstance().getProductName());
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            Notifications.Bus.notify(new Notification(Notifications.SYSTEM_MESSAGES_GROUP_ID,"Desktop Entry Created",message,NotificationType.INFORMATION),getProject());
          }
        }
,ModalityState.NON_MODAL);
      }
 catch (      Exception e) {
        reportFailure(e,getProject());
      }
    }
  }
);
}
