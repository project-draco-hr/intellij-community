{
  Task.Backgroundable task=myTask;
  ProgressIndicator indicator=myIndicator;
  if (indicator == null) {
    if (ApplicationManager.getApplication().isHeadlessEnvironment()) {
      indicator=new EmptyProgressIndicator();
    }
 else {
      indicator=new BackgroundableProcessIndicator(task);
    }
  }
  ModalityState modalityState=myModalityState;
  if (modalityState == null)   modalityState=ModalityState.NON_MODAL;
  if (StringUtil.isEmptyOrSpaces(task.getTitle())) {
    task.setTitle(myTitle);
  }
  boolean synchronous=(task.isHeadless() && !myForceAsyncInTests) || (task.isConditionalModal() && !task.shouldStartInBackground());
  ProgressManagerImpl pm=(ProgressManagerImpl)ProgressManager.getInstance();
  if (synchronous) {
    try {
      pm.runProcessWithProgressSynchronously(task,null);
    }
  finally {
      continuation.run();
    }
  }
 else {
    pm.runProcessWithProgressAsynchronously(task,indicator,continuation,modalityState);
  }
}
