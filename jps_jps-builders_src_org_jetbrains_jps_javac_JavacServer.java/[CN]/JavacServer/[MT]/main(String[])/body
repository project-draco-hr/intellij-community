{
  JavacServer server=null;
  try {
    int port=DEFAULT_SERVER_PORT;
    if (args.length > 0) {
      try {
        port=Integer.parseInt(args[0]);
      }
 catch (      NumberFormatException e) {
        System.err.println("Error parsing port: " + e.getMessage());
        System.exit(-1);
      }
    }
    server=new JavacServer();
    server.start(port);
    final JavacServer finalServer=server;
    Runtime.getRuntime().addShutdownHook(new Thread("Shutdown hook thread"){
      @Override public void run(){
        finalServer.stop();
      }
    }
);
    System.out.println("Server classpath: " + System.getProperty("java.class.path"));
    System.err.println(SERVER_SUCCESS_START_MESSAGE + port);
  }
 catch (  Throwable e) {
    System.err.println(SERVER_ERROR_START_MESSAGE + e.getMessage());
    e.printStackTrace(System.err);
    try {
      if (server != null) {
        server.stop();
      }
    }
  finally {
      System.exit(-1);
    }
  }
}
