{
  if (stubId != -1) {
    PsiFile file=restoreFile();
    if (!(file instanceof PsiFileWithStubSupport))     return null;
    return PsiAnchor.restoreFromStubIndex((PsiFileWithStubSupport)file,stubId,myStubElementType,false);
  }
  if (!mySyncMarkerIsValid)   return null;
  PsiFile file=restoreFile();
  if (file == null)   return null;
  PsiElement anchor=file.findElementAt(getSyncStartOffset());
  if (anchor == null)   return null;
  TextRange range=anchor.getTextRange();
  if (range.getStartOffset() != getSyncStartOffset() || range.getEndOffset() != getSyncEndOffset())   return null;
  for (  SmartPointerAnchorProvider provider : SmartPointerAnchorProvider.EP_NAME.getExtensions()) {
    final PsiElement element=provider.getElement(anchor);
    if (element != null)     return element;
  }
  return null;
}
