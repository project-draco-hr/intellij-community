{
  final Color color=ColorChooser.chooseColor(editorComponent,getText(),oldColor,true);
  if (color != null) {
    final PsiManager manager=expression.getManager();
    final PsiElementFactory factory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
    final PsiExpression newCall=factory.createExpressionFromText("new " + getFqn(expression.getClassOrAnonymousClassReference()) + "("+ color.getRed()+ ", "+ color.getGreen()+ ", "+ color.getBlue()+ (color.getAlpha() < 255 ? ", " + color.getAlpha() : "")+ ")",expression);
    final PsiElement insertedElement=expression.replace(newCall);
    final CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(manager.getProject());
    codeStyleManager.reformat(insertedElement);
  }
}
