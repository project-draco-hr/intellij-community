{
  if (myShouldNotShowPopup) {
    myShouldNotShowPopup=false;
    return;
  }
  final Content[] contents=myManager.getContents();
  final AnAction[] actions=new AnAction[contents.length];
  for (int i=0; i < actions.length; i++) {
    final Content content=contents[i];
    if (content instanceof TabbedContent) {
      final List<Pair<String,JComponent>> tabs=((TabbedContent)content).getTabs();
      final AnAction[] tabActions=new AnAction[tabs.size()];
      for (int j=0; j < tabActions.length; j++) {
        final int index=j;
        tabActions[j]=new DumbAwareAction(tabs.get(index).first){
          @Override public void actionPerformed(          @NotNull AnActionEvent e){
            ((TabbedContent)content).selectContent(index);
          }
        }
;
      }
      final DefaultActionGroup group=new DefaultActionGroup(tabActions);
      group.getTemplatePresentation().setText(((TabbedContent)content).getTitlePrefix());
      group.setPopup(true);
      actions[i]=group;
    }
 else {
      actions[i]=new DumbAwareAction(content.getTabName()){
        @Override public void actionPerformed(        @NotNull AnActionEvent e){
          myManager.setSelectedContent(content,true,true);
        }
      }
;
    }
  }
  final ListPopup popup=JBPopupFactory.getInstance().createActionGroupPopup(null,new DefaultActionGroup(actions),DataManager.getInstance().getDataContext(myManager.getComponent()),JBPopupFactory.ActionSelectionAid.SPEEDSEARCH,true);
  getCurrentLayout().showContentPopup(popup);
}
