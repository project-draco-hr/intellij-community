{
  final List<SmartStepTarget> targets=findSmartStepTargets(position);
  if (!targets.isEmpty()) {
    final SmartStepTarget firstTarget=targets.get(0);
    if (targets.size() == 1) {
      session.stepInto(true,createMethodFilter(firstTarget));
    }
 else {
      final Editor editor=fileEditor.getEditor();
      final PsiMethodListPopupStep popupStep=new PsiMethodListPopupStep(editor,targets,new PsiMethodListPopupStep.OnChooseRunnable(){
        public void execute(        SmartStepTarget chosenTarget){
          session.stepInto(true,createMethodFilter(chosenTarget));
        }
      }
);
      final ListPopup popup=new ListPopupImpl(popupStep){
        @Override protected JComponent createContent(){
          final AnAction stepIntoAction=ActionManager.getInstance().getAction(XDebuggerActions.STEP_INTO);
          registerExtraHandleShortcuts(stepIntoAction.getShortcutSet());
          final AnAction smartStepIntoAction=ActionManager.getInstance().getAction(XDebuggerActions.SMART_STEP_INTO);
          registerExtraHandleShortcuts(smartStepIntoAction.getShortcutSet());
          return super.createContent();
        }
        private void registerExtraHandleShortcuts(        ShortcutSet shortcuts){
          KeyStroke stroke=KeymapUtil.getKeyStroke(shortcuts);
          if (stroke != null) {
            registerAction("handleSelection " + stroke,stroke,new AbstractAction(){
              @Override public void actionPerformed(              ActionEvent e){
                handleSelect(true);
              }
            }
);
          }
        }
      }
;
      popup.addListSelectionListener(new ListSelectionListener(){
        public void valueChanged(        ListSelectionEvent e){
          popupStep.getScopeHighlighter().dropHighlight();
          if (!e.getValueIsAdjusting()) {
            final SmartStepTarget selectedTarget=(SmartStepTarget)((JBList)e.getSource()).getSelectedValue();
            if (selectedTarget != null) {
              highlightTarget(popupStep,selectedTarget);
            }
          }
        }
      }
);
      highlightTarget(popupStep,firstTarget);
      final RelativePoint point=DebuggerUIUtil.calcPopupLocation(editor,position.getLine());
      popup.show(point);
    }
    return true;
  }
  return false;
}
