{
  super(project);
  myTask=task;
  setTitle("Edit Task " + (task.isIssue() ? task.getPresentableId() : ""));
  mySummary.setText(task.getSummary());
  AbstractVcs vcs=TaskManager.getManager(project).getActiveVcs();
  if (vcs == null) {
    myBranchLabel.setVisible(false);
    myBranch.setVisible(false);
    myChangelistLabel.setVisible(false);
    myChangelist.setVisible(false);
  }
 else {
    ChangeListManager changeListManager=ChangeListManager.getInstance(project);
    List<LocalChangeList> changeLists=changeListManager.getChangeLists();
    changeLists.add(null);
    myChangelist.setModel(new CollectionComboBoxModel<LocalChangeList>(changeLists));
    final List<ChangeListInfo> lists=task.getChangeLists();
    if (!lists.isEmpty()) {
      LocalChangeList list=changeListManager.getChangeList(lists.get(0).id);
      myChangelist.setSelectedItem(list);
    }
 else {
      myChangelist.setSelectedItem(null);
    }
    VcsTaskHandler[] handlers=VcsTaskHandler.getAllHandlers(project);
    if (handlers.length == 0) {
      myBranchLabel.setVisible(false);
      myBranch.setVisible(false);
    }
 else {
      VcsTaskHandler.TaskInfo[] tasks=handlers[0].getAllExistingTasks();
      ArrayList<VcsTaskHandler.TaskInfo> infos=new ArrayList<VcsTaskHandler.TaskInfo>(Arrays.asList(tasks));
      Collections.sort(infos);
      infos.add(null);
      myBranch.setModel(new CollectionComboBoxModel<VcsTaskHandler.TaskInfo>(infos));
      final List<BranchInfo> branches=task.getBranches(false);
      if (!branches.isEmpty()) {
        VcsTaskHandler.TaskInfo info=ContainerUtil.find(tasks,new Condition<VcsTaskHandler.TaskInfo>(){
          @Override public boolean value(          VcsTaskHandler.TaskInfo info){
            return branches.get(0).name.equals(info.getName());
          }
        }
);
        myBranch.setSelectedItem(info);
      }
 else {
        myBranch.setSelectedItem(null);
      }
    }
  }
  init();
}
