{
  super.setUpModule();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final String modulePath=getTestAppPath();
      final String srcPath=modulePath + File.separator + "src";
      VirtualFile moduleDir=LocalFileSystem.getInstance().findFileByPath(modulePath.replace(File.separatorChar,'/'));
      VirtualFile srcDir=LocalFileSystem.getInstance().findFileByPath(srcPath.replace(File.separatorChar,'/'));
      final ModuleRootManager rootManager=ModuleRootManager.getInstance(myModule);
      PsiTestUtil.removeAllRoots(myModule,rootManager.getSdk());
      PsiTestUtil.addContentRoot(myModule,moduleDir);
      PsiTestUtil.addSourceRoot(myModule,srcDir);
      IdeaTestUtil.setModuleLanguageLevel(myModule,LanguageLevel.JDK_1_8);
      PsiTestUtil.setCompilerOutputPath(myModule,VfsUtilCore.pathToUrl(FileUtil.toSystemIndependentName(myModuleOutputDir.getAbsolutePath())),false);
    }
  }
);
}
