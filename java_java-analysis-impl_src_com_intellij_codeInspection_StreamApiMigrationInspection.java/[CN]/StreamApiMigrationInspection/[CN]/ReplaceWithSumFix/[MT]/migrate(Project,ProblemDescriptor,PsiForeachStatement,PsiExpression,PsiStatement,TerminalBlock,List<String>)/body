{
  PsiAssignmentExpression assignment=tb.getSingleExpression(PsiAssignmentExpression.class);
  if (assignment == null)   return;
  PsiLocalVariable var=extractAccumulator(assignment);
  if (var == null)   return;
  PsiExpression addend=extractAddend(assignment);
  if (addend == null)   return;
  PsiType type=var.getType();
  if (!(type instanceof PsiPrimitiveType))   return;
  PsiPrimitiveType primitiveType=(PsiPrimitiveType)type;
  if (primitiveType.equalsToText("float"))   return;
  String typeName;
  if (primitiveType.equalsToText("double")) {
    typeName="Double";
  }
 else   if (primitiveType.equalsToText("long")) {
    typeName="Long";
  }
 else {
    typeName="Int";
  }
  intermediateOps.add(".mapTo" + typeName + "("+ compoundLambdaOrMethodReference(tb.getVariable(),addend,"java.util.function.To" + typeName + "Function",new PsiType[]{tb.getVariable().getType()})+ ")");
  final StringBuilder builder=generateStream(iteratedValue,intermediateOps);
  builder.append(".sum()");
  replaceWithNumericAddition(project,foreachStatement,var,builder,typeName.toLowerCase(Locale.ENGLISH));
}
