{
  PsiElementFactory elementFactory=JavaPsiFacade.getElementFactory(project);
  restoreComments(foreachStatement,foreachStatement.getBody());
  if (isDeclarationJustBefore(var,foreachStatement)) {
    PsiExpression initializer=var.getInitializer();
    if (ExpressionUtils.isZero(initializer)) {
      String typeStr=var.getType().getCanonicalText();
      String replacement=(typeStr.equals(expressionType) ? "" : "(" + typeStr + ") ") + builder;
      initializer.replace(elementFactory.createExpressionFromText(replacement,foreachStatement));
      foreachStatement.delete();
      simplifyAndFormat(project,var);
      return;
    }
  }
  PsiElement result=foreachStatement.replace(elementFactory.createStatementFromText(var.getName() + "+=" + builder+ ";",foreachStatement));
  simplifyAndFormat(project,result);
}
