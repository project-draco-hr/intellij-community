{
  final PsiForeachStatement foreachStatement=PsiTreeUtil.getParentOfType(descriptor.getPsiElement(),PsiForeachStatement.class);
  if (foreachStatement != null) {
    PsiStatement body=foreachStatement.getBody();
    final PsiExpression iteratedValue=foreachStatement.getIteratedValue();
    if (body != null && iteratedValue != null) {
      final PsiParameter parameter=foreachStatement.getIterationParameter();
      TerminalBlock tb=TerminalBlock.from(parameter,body);
      if (!FileModificationService.getInstance().preparePsiElementForWrite(foreachStatement))       return;
      PsiElementFactory factory=JavaPsiFacade.getElementFactory(project);
      List<String> replacements=tb.extractOperationReplacements(factory);
      migrate(project,descriptor,foreachStatement,iteratedValue,body,tb,replacements);
    }
  }
}
