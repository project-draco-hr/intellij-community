{
  LinkedList<Node> result=ContainerUtil.newLinkedList();
  LinkedList<VirtualFile> workItems=ContainerUtil.newLinkedList();
  workItems.add(root);
  while (!workItems.isEmpty()) {
    VirtualFile item=workItems.removeFirst();
    checkCancelled();
    final Node vcsElement=new VcsFileResolver(myVcs,item,root).resolve();
    if (vcsElement != null) {
      result.add(vcsElement);
    }
 else {
      for (      VirtualFile child : item.getChildren()) {
        checkCancelled();
        if (child.isDirectory() && myRootIterator.acceptFolderUnderVcs(root,child)) {
          workItems.add(child);
        }
      }
    }
  }
  return result;
}
