{
  final LinkedList<WorkItem> workItems=new LinkedList<WorkItem>();
  final LinkedList<Node> result=new LinkedList<Node>();
  workItems.add(new WorkItem(root));
  while (!workItems.isEmpty()) {
    final WorkItem item=workItems.removeFirst();
    checkCancelled();
    final Node vcsElement=resolveVcsElement(item.file);
    if (vcsElement != null && (item.url == null || vcsElement.onUrl(item.url))) {
      result.add(vcsElement);
      if (!goIntoNested) {
        continue;
      }
    }
    final VirtualFile file=item.file;
    if (file.isDirectory() && (!SvnUtil.isAdminDirectory(file))) {
      for (      VirtualFile child : file.getChildren()) {
        checkCancelled();
        if (myRootIterator.acceptFolderUnderVcs(root,child)) {
          workItems.add(WorkItem.create(vcsElement,child));
        }
      }
    }
  }
  return result;
}
