{
  Collection<? extends Activity> buildActivities=activitiesMap.get(ModuleBuildActivity.class);
  if (!ContainerUtil.isEmpty(buildActivities)) {
    List<Module> toMake=new SmartList<>();
    List<Module> toCompile=new SmartList<>();
    for (    Activity buildActivity : buildActivities) {
      ModuleBuildActivity moduleBuildActivity=(ModuleBuildActivity)buildActivity;
      if (moduleBuildActivity.isIncrementalBuild()) {
        toMake.add(moduleBuildActivity.getModule());
      }
 else {
        toCompile.add(moduleBuildActivity.getModule());
      }
    }
    CompilerManager compilerManager=CompilerManager.getInstance(project);
    if (!toMake.isEmpty()) {
      CompileScope scope=createScope(project,compilerManager,context,toMake);
      compilerManager.make(scope,compileNotification);
    }
    if (!toCompile.isEmpty()) {
      CompileScope scope=createScope(project,compilerManager,context,toCompile);
      compilerManager.compile(scope,compileNotification);
    }
  }
}
