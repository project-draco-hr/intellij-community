{
  ActionManager actionManager=ActionManager.getInstance();
  StringBuilder xml=new StringBuilder();
  xml.append("<Keymaps>\n");
  for (  Keymap keymap : KeymapManagerEx.getInstanceEx().getAllKeymaps()) {
    xml.append("  <Keymap name=\"").append(keymap.getPresentableName()).append("\">\n");
    for (    String id : keymap.getActionIds()) {
      String shortcuts=KeymapUtil.getShortcutsText(keymap.getShortcuts(id));
      if (!StringUtil.isEmpty(shortcuts)) {
        AnAction action=actionManager.getAction(id);
        xml.append("    <Action id=\"").append(id).append("\">\n");
        Set<String> addedShortcuts=new THashSet<>();
        for (        Shortcut shortcut : keymap.getShortcuts(id)) {
          String shortcutText=KeymapUtil.getShortcutText(shortcut);
          if (addedShortcuts.add(shortcutText)) {
            xml.append("      <Shortcut>").append(shortcutText).append("</Shortcut>\n");
          }
        }
        if (action != null) {
          String text=action.getTemplatePresentation().getText();
          if (text != null) {
            xml.append("      <Text>").append(StringUtil.escapeXml(text)).append("</Text>\n");
          }
        }
        xml.append("    </Action>\n");
      }
    }
    xml.append("  </Keymap>\n");
  }
  xml.append("</Keymaps>");
  final String path=args.length == 2 ? args[1] : PathManager.getHomePath() + File.separator + "AllKeymaps.xml";
  File out=new File(path);
  try {
    FileUtil.writeToFile(out,xml.toString());
    System.out.println("Saved to: " + out.getAbsolutePath());
  }
 catch (  IOException e) {
    e.printStackTrace();
    System.exit(1);
  }
  System.exit(0);
}
