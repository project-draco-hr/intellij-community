{
  Runnable command=new Runnable(){
    @Override public void run(){
      final Runnable run=new Runnable(){
        @Override public void run(){
          LocalHistoryAction action=LocalHistoryAction.NULL;
          try {
            String actionName;
            String dirPath=myDirectory.getVirtualFile().getPresentableUrl();
            actionName=IdeBundle.message("progress.creating.directory",dirPath,File.separator,subDirName);
            action=LocalHistory.getInstance().startAction(actionName);
            if (createFile) {
              myCreatedElement=myDirectory.createFile(subDirName);
            }
 else {
              createDirectories(subDirName);
            }
          }
 catch (          final IncorrectOperationException ex) {
            ApplicationManager.getApplication().invokeLater(new Runnable(){
              @Override public void run(){
                showErrorDialog(CreateElementActionBase.filterMessage(ex.getMessage()));
              }
            }
);
          }
 finally {
            action.finish();
          }
        }
      }
;
      ApplicationManager.getApplication().runWriteAction(run);
    }
  }
;
  CommandProcessor.getInstance().executeCommand(myProject,command,createFile ? IdeBundle.message("command.create.file") : myIsDirectory ? IdeBundle.message("command.create.directory") : IdeBundle.message("command.create.package"),null);
}
