{
  boolean inPopup=ActionPlaces.isPopupPlace(e.getPlace());
  Navigatable target=findTargetForUpdate(e.getDataContext());
  boolean enabled=target != null;
  if (inPopup && !(this instanceof OpenModuleSettingsAction) && OpenModuleSettingsAction.isModuleInProjectViewPopup(e)) {
    e.getPresentation().setVisible(false);
    return;
  }
  e.getPresentation().setVisible((enabled || !inPopup) && (myFocusEditor || !(target instanceof NavigatableWithText)));
  e.getPresentation().setEnabled(enabled);
  String navigateActionText=myFocusEditor && target instanceof NavigatableWithText ? ((NavigatableWithText)target).getNavigateActionText(true) : null;
  e.getPresentation().setText(navigateActionText == null ? getTemplatePresentation().getText() : navigateActionText);
}
