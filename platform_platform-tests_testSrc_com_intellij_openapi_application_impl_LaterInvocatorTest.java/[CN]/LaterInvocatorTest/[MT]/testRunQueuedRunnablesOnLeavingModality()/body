{
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      LaterInvocator.invokeLater(ENTER_MODAL,ModalityState.NON_MODAL);
      LaterInvocator.invokeLater(new MyRunnable("3"),ModalityState.NON_MODAL);
      flushSwingQueue();
      checkOrder(0);
      final ModalityState modalityState=ModalityState.stateForComponent(myWindow1);
      LaterInvocator.invokeLater(new MyRunnable("1"){
        @Override public void run(){
          super.run();
          checkOrder(1);
          LaterInvocator.invokeLater(new MyRunnable("2"),modalityState);
          checkOrder(1);
          LaterInvocator.leaveModal(myWindow1);
          checkOrder(2);
        }
      }
,modalityState);
      flushSwingQueue();
      flushSwingQueue();
      checkOrder(3);
    }
  }
);
}
