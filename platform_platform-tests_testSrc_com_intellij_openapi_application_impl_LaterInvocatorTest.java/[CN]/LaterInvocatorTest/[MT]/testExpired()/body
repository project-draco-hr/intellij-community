{
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      final ArrayList<String> consumed=new ArrayList<String>();
synchronized (LaterInvocatorTest.this) {
        blockSwingThread();
        ApplicationManager.getApplication().getInvokator().invokeLater(new Runnable(){
          @Override public void run(){
            ApplicationManager.getApplication().invokeLater(new MyRunnable("1"){
              @Override public void run(){
                super.run();
                TestCase.fail("Should not be executed");
              }
            }
,Conditions.alwaysTrue());
          }
        }
,ModalityState.NON_MODAL).doWhenDone(new Runnable(){
          @Override public void run(){
            consumed.add("1");
          }
        }
);
        ApplicationManager.getApplication().getInvokator().invokeLater(new MyRunnable("2"),ModalityState.NON_MODAL).doWhenDone(new Runnable(){
          @Override public void run(){
            consumed.add("2");
          }
        }
);
      }
      flushSwingQueue();
      TestCase.assertEquals(consumed.toString(),2,consumed.size());
    }
  }
);
}
