{
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      SwingUtilities.invokeLater(ENTER_MODAL);
      flushSwingQueue();
synchronized (LaterInvocatorTest.this) {
        blockSwingThread();
        SwingUtilities.invokeLater(new MyRunnable("1"));
        ApplicationManager.getApplication().invokeLater(new MyRunnable("3"),ModalityState.NON_MODAL);
        SwingUtilities.invokeLater(LEAVE_MODAL);
        SwingUtilities.invokeLater(ENTER_MODAL);
        SwingUtilities.invokeLater(new Runnable(){
          @Override public void run(){
            SwingUtilities.invokeLater(new MyRunnable("2"));
            ApplicationManager.getApplication().invokeLater(new MyRunnable("5"),ModalityState.NON_MODAL);
          }
        }
);
        ApplicationManager.getApplication().invokeLater(new MyRunnable("4"),ModalityState.NON_MODAL);
      }
      flushSwingQueue();
      SwingUtilities.invokeLater(LEAVE_MODAL);
      flushSwingQueue();
      checkOrder(5);
    }
  }
);
}
