{
  ApplicationManager.getApplication().assertIsDispatchThread();
  final PostfixTemplate template=myTemplates.get(key);
  final Editor editor=callback.getEditor();
  final PsiFile file=callback.getContext().getContainingFile();
  if (isApplicableTemplate(template,file,editor)) {
    int currentOffset=editor.getCaretModel().getOffset();
    PsiElement newContext=deleteTemplateKey(file,editor.getDocument(),currentOffset,key);
    newContext=addSemicolonIfNeeded(editor,editor.getDocument(),newContext,currentOffset - key.length());
    expandTemplate(template,editor,newContext);
  }
 else {
    LOG.error("Template not found by key: " + key);
  }
}
