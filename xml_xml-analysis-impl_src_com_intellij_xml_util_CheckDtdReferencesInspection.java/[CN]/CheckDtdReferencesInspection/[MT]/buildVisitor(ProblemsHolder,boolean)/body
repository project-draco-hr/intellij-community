{
  return new XmlElementVisitor(){
    private final Map<PsiFile,Boolean> myDoctypeMap=new HashMap<PsiFile,Boolean>();
    @Override public void visitXmlElement(    final XmlElement element){
      if (isHtml5Doctype(element)) {
        return;
      }
      if (element instanceof XmlElementContentSpec || element instanceof XmlEntityRef) {
        doCheckRefs(element,holder);
      }
    }
    private boolean isHtml5Doctype(    XmlElement element){
      if (HtmlUtil.isHtml5Context(element)) {
        return true;
      }
      PsiFile file=element.getContainingFile();
      if (file instanceof XmlFile) {
        if (!myDoctypeMap.containsKey(file)) {
          myDoctypeMap.put(file,computeHtml5Doctype((XmlFile)file));
        }
        return myDoctypeMap.get(file);
      }
      return false;
    }
    private boolean computeHtml5Doctype(    XmlFile file){
      XmlDoctype doctype=null;
      for (      HtmlDoctypeProvider provider : HtmlDoctypeProvider.EP_NAME.getExtensions()) {
        doctype=provider.getDoctype(file);
        if (doctype != null) {
          break;
        }
      }
      return doctype != null && HtmlUtil.isHtml5Doctype(doctype);
    }
  }
;
}
