{
  InspectionProfileImpl.INIT_INSPECTIONS=true;
  try {
    final String relativePath="/inspection/converter/";
    final File projectFile=new File(JavaTestUtil.getJavaTestDataPath() + relativePath + dirName+ "/options.ipr");
    for (    Element element : JDOMUtil.load(projectFile).getChildren("component")) {
      if (Comparing.strEqual(element.getAttributeValue("name"),"InspectionProjectProfileManager")) {
        final ProjectInspectionProfileManagerImpl profileManager=ProjectInspectionProfileManagerImpl.getInstanceImpl(getProject());
        profileManager.loadState(element);
        Element configElement=profileManager.getState();
        final File file=new File(JavaTestUtil.getJavaTestDataPath() + relativePath + dirName+ "/options.after.xml");
        PlatformTestUtil.assertElementsEqual(JDOMUtil.load(file),configElement);
        break;
      }
    }
  }
  finally {
    InspectionProfileImpl.INIT_INSPECTIONS=false;
  }
}
