{
  InspectionProfileImpl.INIT_INSPECTIONS=true;
  try {
    final String relativePath="/inspection/converter/";
    final File projectFile=new File(JavaTestUtil.getJavaTestDataPath() + relativePath + dirName+ "/options.ipr");
    for (    Element element : JDOMUtil.loadDocument(projectFile).getRootElement().getChildren("component")) {
      if (Comparing.strEqual(element.getAttributeValue("name"),"InspectionProjectProfileManager")) {
        final InspectionProjectProfileManager profileManager=InspectionProjectProfileManager.getInstance(getProject());
        profileManager.loadState(element);
        Element configElement=profileManager.getState();
        final File file=new File(JavaTestUtil.getJavaTestDataPath() + relativePath + dirName+ "/options.after.xml");
        PlatformTestUtil.assertElementsEqual(JDOMUtil.loadDocument(file).getRootElement(),configElement);
        break;
      }
    }
  }
  finally {
    InspectionProfileImpl.INIT_INSPECTIONS=false;
  }
}
