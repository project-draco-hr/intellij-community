{
  if (SystemInfo.isMac) {
    final String escapedCommandLine=StringUtil.join(command,new Function<String,String>(){
      @Override public String fun(      String s){
        return escapeAppleScriptArgument(s);
      }
    }
," & \" \" & ");
    final String escapedScript="do shell script " + escapedCommandLine + " with administrator privileges";
    return exec(Arrays.asList(getOsascriptPath(),"-e",escapedScript),workDir,environment);
  }
 else   if ("root".equals(System.getenv("USER"))) {
    return exec(command,workDir,environment);
  }
 else   if (hasGkSudo.getValue()) {
    final List<String> sudoCommand=new ArrayList<String>();
    sudoCommand.addAll(Arrays.asList("gksudo","--message",prompt,"--"));
    sudoCommand.addAll(command);
    return exec(sudoCommand,workDir,environment);
  }
 else   if (hasKdeSudo.getValue()) {
    final List<String> sudoCommand=new ArrayList<String>();
    sudoCommand.addAll(Arrays.asList("kdesudo","--comment",prompt,"--"));
    sudoCommand.addAll(command);
    return exec(sudoCommand,workDir,environment);
  }
 else   if (hasPkExec.getValue()) {
    final List<String> sudoCommand=new ArrayList<String>();
    sudoCommand.add("pkexec");
    sudoCommand.addAll(command);
    return exec(sudoCommand,workDir,environment);
  }
 else   if (SystemInfo.isUnix && hasTerminalApp()) {
    final String escapedCommandLine=StringUtil.join(command,new Function<String,String>(){
      @Override public String fun(      String s){
        return escapeUnixShellArgument(s);
      }
    }
," ");
    final File script=createTempExecutableScript("sudo",".sh","#!/bin/sh\n" + "echo " + escapeUnixShellArgument(prompt) + "\n"+ "echo\n"+ "sudo -- "+ escapedCommandLine+ "\n"+ "STATUS=$?\n"+ "echo\n"+ "read -p \"Press Enter to close this window...\" TEMP\n"+ "exit $STATUS\n");
    return exec(getTerminalCommand("Install",script.getAbsolutePath()),workDir,environment);
  }
  throw new UnsupportedSystemException();
}
