{
  final SubTree tree=new SubTree(myWorkingCopyDir);
  checkin();
  final File was2=new File(tree.myS2File.getPath());
  final String editedText="s1 edited";
  VcsTestUtil.editFileInCommand(myProject,tree.myS1File,editedText);
  VcsTestUtil.editFileInCommand(myProject,tree.myS2File,"s2 edited");
  VcsTestUtil.renameFileInCommand(myProject,tree.mySourceDir,"renamed");
  myDirtyScopeManager.markEverythingDirty();
  myChangeListManager.ensureUpToDate(false);
  final Change dirChange=assertRenamedChange(tree.mySourceDir);
  final Change s1Change=assertMovedChange(tree.myS1File);
  final Change s2Change=assertMovedChange(tree.myS2File);
  final FilePath fp=VcsUtil.getFilePath(was2,false);
  rollbackIMpl(Arrays.asList(dirChange,s1Change),Arrays.asList(new Change(new SimpleContentRevision("1",fp,"1"),new SimpleContentRevision("1",fp,SVNRevision.WORKING.getName()))));
}
