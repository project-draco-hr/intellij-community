{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return null;
  if (isBinary(file))   return null;
  if (myView == null && !headlessEnvironment) {
    throw new ProcessCanceledException();
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Running local inspections on " + virtualFile.getPath());
  }
  String url=ProjectUtilCore.displayUrlRelativeToProject(virtualFile,virtualFile.getPresentableUrl(),getProject(),true,false);
  incrementJobDoneAmount(getStdJobDescriptors().LOCAL_ANALYSIS,url);
  if (SingleRootFileViewProvider.isTooLargeForIntelligence(virtualFile))   return null;
  if (localScopeFiles != null && !localScopeFiles.add(virtualFile))   return null;
  return PsiDocumentManager.getInstance(getProject()).getDocument(file);
}
