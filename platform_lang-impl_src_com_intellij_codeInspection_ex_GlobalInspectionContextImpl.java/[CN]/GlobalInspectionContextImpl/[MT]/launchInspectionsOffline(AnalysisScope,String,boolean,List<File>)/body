{
  cleanupTools();
  setCurrentScope(scope);
  DefaultInspectionToolPresentation.setOutputPath(outputPath);
  try {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        performInspectionsWithProgress(scope,runGlobalToolsOnly,true);
        exportResults(inspectionsResults,outputPath);
      }
    }
);
  }
  finally {
    DefaultInspectionToolPresentation.setOutputPath(null);
  }
}
