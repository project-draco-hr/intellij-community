{
  cleanupTools();
  setCurrentScope(scope);
  DefaultInspectionToolPresentation.setOutputPath(outputPath);
  try {
    final Runnable action=new Runnable(){
      @Override public void run(){
        performInspectionsWithProgress(scope,runGlobalToolsOnly,isOfflineInspections);
        exportResults(inspectionsResults,outputPath);
      }
    }
;
    if (isOfflineInspections) {
      ApplicationManager.getApplication().runReadAction(action);
    }
 else {
      action.run();
    }
  }
  finally {
    DefaultInspectionToolPresentation.setOutputPath(null);
  }
}
