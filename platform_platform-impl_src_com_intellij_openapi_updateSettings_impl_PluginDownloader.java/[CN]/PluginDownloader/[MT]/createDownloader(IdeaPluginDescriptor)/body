{
  String url=null;
  if (descriptor instanceof PluginNode) {
    url=((PluginNode)descriptor).getDownloadUrl();
  }
  if (url == null) {
    String uuid=ApplicationManager.getApplication() == null ? UUID.randomUUID().toString() : UpdateChecker.getInstallationUID(PropertiesComponent.getInstance());
    String buildNumber=ApplicationManager.getApplication() != null ? ApplicationInfo.getInstance().getApiVersion() : ApplicationInfoImpl.getShadowInstance().getBuild().asString();
    url=RepositoryHelper.getDownloadUrl() + URLEncoder.encode(descriptor.getPluginId().getIdString(),"UTF8") + "&build="+ buildNumber+ "&uuid="+ URLEncoder.encode(uuid,"UTF8");
  }
  PluginDownloader downloader=new PluginDownloader(descriptor.getPluginId().getIdString(),url,descriptor.getVersion(),null,descriptor.getName());
  downloader.setDescriptor(descriptor);
  return downloader;
}
