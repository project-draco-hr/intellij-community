{
  String url=null;
  if (descriptor instanceof PluginNode) {
    url=((PluginNode)descriptor).getDownloadUrl();
  }
  if (url == null) {
    BuildNumber buildNumber=ApplicationInfo.getInstance().getBuild();
    String uuid=UpdateChecker.getInstallationUID(PropertiesComponent.getInstance());
    url=RepositoryHelper.getDownloadUrl() + URLEncoder.encode(descriptor.getPluginId().getIdString(),"UTF8") + "&build="+ buildNumber.asString()+ "&uuid="+ URLEncoder.encode(uuid,"UTF8");
  }
  PluginDownloader downloader=new PluginDownloader(descriptor.getPluginId().getIdString(),url,null,null,descriptor.getName());
  downloader.setDescriptor(descriptor);
  return downloader;
}
