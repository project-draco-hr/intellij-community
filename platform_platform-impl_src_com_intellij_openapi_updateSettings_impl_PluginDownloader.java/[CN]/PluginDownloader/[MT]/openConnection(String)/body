{
  final URLConnection connection;
  if (ApplicationManager.getApplication() != null) {
    connection=HttpConfigurable.getInstance().openConnection(url);
  }
 else {
    connection=new URL(url).openConnection();
    connection.setConnectTimeout(HttpConfigurable.CONNECTION_TIMEOUT);
    connection.setReadTimeout(HttpConfigurable.CONNECTION_TIMEOUT);
  }
  if (connection instanceof HttpURLConnection) {
    final int responseCode=((HttpURLConnection)connection).getResponseCode();
    if (responseCode != HttpURLConnection.HTTP_OK) {
      String location=null;
      if (responseCode == HttpURLConnection.HTTP_MOVED_PERM || responseCode == HttpURLConnection.HTTP_MOVED_TEMP) {
        location=connection.getHeaderField("Location");
      }
      if (location == null) {
        throw new IOException(IdeBundle.message("error.connection.failed.with.http.code.N",responseCode));
      }
 else {
        myPluginUrl=location;
        ((HttpURLConnection)connection).disconnect();
        return openConnection(location);
      }
    }
  }
  return connection;
}
