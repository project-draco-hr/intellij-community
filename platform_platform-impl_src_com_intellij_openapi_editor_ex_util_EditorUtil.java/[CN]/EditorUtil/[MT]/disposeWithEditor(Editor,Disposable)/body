{
  ApplicationManager.getApplication().assertIsDispatchThread();
  if (Disposer.isDisposed(disposable))   return;
  if (editor.isDisposed()) {
    Disposer.dispose(disposable);
    return;
  }
  Editor hostEditor=editor instanceof EditorWindow ? ((EditorWindow)editor).getDelegate() : editor;
  EditorFactory.getInstance().addEditorFactoryListener(new EditorFactoryAdapter(){
    @Override public void editorReleased(    @NotNull EditorFactoryEvent event){
      if (event.getEditor() == hostEditor) {
        Disposer.dispose(disposable);
      }
    }
  }
,disposable);
}
