{
  while (true) {
    offset=getLineStartOffset(offset,editor.getDocument());
    FoldRegion foldRegion=editor.getFoldingModel().getCollapsedRegionAtOffset(offset);
    if (foldRegion == null || foldRegion.getStartOffset() >= offset) {
      break;
    }
    offset=foldRegion.getStartOffset();
  }
  return offset;
}
