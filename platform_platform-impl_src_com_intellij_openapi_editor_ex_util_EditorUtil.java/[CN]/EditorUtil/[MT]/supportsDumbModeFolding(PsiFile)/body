{
  if (file.getVirtualFile() != null) {
    FileType ft=FileTypeManager.getInstance().getFileTypeByFile(file.getVirtualFile());
    if (ft instanceof LanguageFileType) {
      final FoldingBuilder foldingBuilder=LanguageFolding.INSTANCE.forLanguage(((LanguageFileType)ft).getLanguage());
      return DumbService.isDumbAware(foldingBuilder) || ApplicationManager.getApplication().isUnitTestMode();
    }
  }
  return true;
}
