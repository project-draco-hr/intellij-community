{
  PsiElement scope=myContext.getScope();
  final PsiClass targetClass=scope instanceof GroovyFileBase ? ((GroovyFileBase)scope).getScriptClass() : (PsiClass)scope;
  if (targetClass == null)   return null;
  final GrVariableDeclaration declaration=insertField(targetClass);
  final GrVariable field=declaration.getVariables()[0];
  if (mySettings.removeLocalVar()) {
    myLocalVariable=GrIntroduceHandlerBase.resolveLocalVar(myContext);
  }
  myInitializer=(GrExpression)getInitializer().copy();
  List<PsiElement> replaced=processOccurrences(targetClass,field);
switch (mySettings.initializeIn()) {
case CUR_METHOD:
    initializeInMethod(field,replaced);
  break;
case FIELD_DECLARATION:
field.setInitializerGroovy(myInitializer);
break;
case CONSTRUCTOR:
initializeInConstructor(field);
break;
case SETUP_METHOD:
initializeInSetup(field);
break;
}
JavaCodeStyleManager.getInstance(declaration.getProject()).shortenClassReferences(declaration);
if (mySettings.removeLocalVar()) {
GrIntroduceHandlerBase.deleteLocalVar(myLocalVariable);
}
return field;
}
