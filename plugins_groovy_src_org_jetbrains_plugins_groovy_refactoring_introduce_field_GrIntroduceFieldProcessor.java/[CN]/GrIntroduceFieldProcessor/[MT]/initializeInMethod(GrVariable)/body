{
  if (context.getExpression() == null)   return;
  final GrExpression expression=context.getExpression();
  final PsiElement _scope=context.getScope();
  final PsiElement scope=_scope instanceof GroovyScriptClass ? ((GroovyScriptClass)_scope).getContainingFile() : _scope;
  final GrMethod method=(GrMethod)GrIntroduceFieldHandler.getContainer(expression,scope);
  LOG.assertTrue(method != null);
  final GrStatement anchor;
  if (settings.removeLocalVar()) {
    GrVariable variable=GrIntroduceHandlerBase.resolveLocalVar(context);
    anchor=PsiTreeUtil.getParentOfType(variable,GrStatement.class);
  }
 else {
    anchor=(GrStatement)GrIntroduceHandlerBase.findAnchor(context,settings,context.getOccurrences(),method.getBlock());
  }
  generateAssignment(field,anchor,method.getBlock());
}
