{
  if (elt == null)   return null;
  PsiElement cur=elt;
  do {
    if ((processor instanceof ResolveProcessor) && !(((ResolveProcessor)processor).probe(cur))) {
      return null;
    }
    if (!cur.processDeclarations(processor,ResolveState.initial(),cur == elt ? lastParent : null,elt)) {
      if (processor instanceof ResolveProcessor) {
        return ((ResolveProcessor)processor).getResult();
      }
    }
    if (cur instanceof PsiFile)     break;
    cur=cur.getPrevSibling();
  }
 while (cur != null);
  if (elt == place)   return null;
  return treeWalkUp(processor,elt.getContext(),elt,place);
}
