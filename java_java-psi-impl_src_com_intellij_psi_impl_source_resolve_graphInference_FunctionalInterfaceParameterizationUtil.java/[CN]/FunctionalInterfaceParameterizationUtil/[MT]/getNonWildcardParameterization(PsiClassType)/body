{
  final PsiClass psiClass=psiClassType.resolve();
  if (psiClass != null) {
    final PsiTypeParameter[] typeParameters=psiClass.getTypeParameters();
    final PsiType[] parameters=psiClassType.getParameters();
    final PsiType[] newParameters=new PsiType[parameters.length];
    if (parameters.length != typeParameters.length)     return null;
    final HashSet<PsiTypeParameter> typeParametersSet=ContainerUtil.newHashSet(typeParameters);
    for (int i=0; i < parameters.length; i++) {
      PsiType paramType=parameters[i];
      if (paramType instanceof PsiWildcardType) {
        final PsiType bound=GenericsUtil.eliminateWildcards(((PsiWildcardType)paramType).getBound(),false,false);
        if (((PsiWildcardType)paramType).isSuper()) {
          newParameters[i]=bound;
        }
 else {
          newParameters[i]=bound != null ? bound : PsiType.getJavaLangObject(psiClass.getManager(),psiClassType.getResolveScope());
          for (          PsiClassType paramBound : typeParameters[i].getExtendsListTypes()) {
            if (!PsiPolyExpressionUtil.mentionsTypeParameters(paramBound,typeParametersSet)) {
              newParameters[i]=GenericsUtil.getGreatestLowerBound(newParameters[i],paramBound);
            }
          }
        }
      }
 else {
        newParameters[i]=paramType;
      }
    }
    if (!isWellFormed(psiClass,typeParameters,newParameters)) {
      return null;
    }
    final PsiClassType parameterization=JavaPsiFacade.getElementFactory(psiClass.getProject()).createType(psiClass,newParameters);
    if (!psiClassType.isAssignableFrom(parameterization)) {
      return null;
    }
    return parameterization;
  }
  return null;
}
