{
  removePaletteProviderListener();
  myDesigner=designer;
  if (designer != null) {
    addPaletteProviderListener();
  }
  VirtualFile file=designer == null ? null : designer.getFile();
  Set<PaletteGroup> currentGroups=new HashSet<PaletteGroup>(collectCurrentGroups(file));
  if (!currentGroups.equals(myGroups)) {
    refreshPalette(file);
  }
}
