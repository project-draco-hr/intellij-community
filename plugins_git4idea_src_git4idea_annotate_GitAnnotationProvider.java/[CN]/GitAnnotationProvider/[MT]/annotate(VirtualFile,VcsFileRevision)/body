{
  if (file.isDirectory()) {
    throw new VcsException("Cannot annotate a directory");
  }
  final FilePath currentFilePath=VcsUtil.getFilePath(file.getPath());
  final FilePath realFilePath;
  setProgressIndicatorText(GitBundle.message("getting.history",file.getName()));
  final List<VcsFileRevision> revisions=GitHistoryUtils.history(myProject,currentFilePath);
  if (revision == null) {
    realFilePath=GitHistoryUtils.getLastCommitName(myProject,currentFilePath);
  }
 else {
    realFilePath=((GitFileRevision)revision).getPath();
  }
  setProgressIndicatorText(GitBundle.message("computing.annotation",file.getName()));
  VcsRevisionNumber revisionNumber=revision != null ? revision.getRevisionNumber() : null;
  return annotate(realFilePath,revisionNumber,revisions,file);
}
