{
class CommitInfo {
    Date date;
    String author;
    GitRevisionNumber revision;
  }
  try {
    StringBuilder content=new StringBuilder();
    List<LineInfo> lines=new ArrayList<LineInfo>();
    HashMap<String,CommitInfo> commits=new HashMap<String,CommitInfo>();
    for (StringScanner s=new StringScanner(output); s.hasMoreData(); ) {
      String commitHash=s.spaceToken();
      if (commitHash.equals(GitRevisionNumber.NOT_COMMITTED_HASH)) {
        commitHash=null;
      }
      s.spaceToken();
      String s1=s.spaceToken();
      int lineNum=Integer.parseInt(s1);
      s.nextLine();
      CommitInfo commit=commits.get(commitHash);
      if (commit != null) {
        while (s.hasMoreData() && !s.startsWith('\t')) {
          s.nextLine();
        }
      }
 else {
        commit=new CommitInfo();
        while (s.hasMoreData() && !s.startsWith('\t')) {
          String key=s.spaceToken();
          String value=s.line();
          if (commitHash != null && AUTHOR_KEY.equals(key)) {
            commit.author=value;
          }
          if (commitHash != null && COMMITTER_TIME_KEY.equals(key)) {
            commit.date=GitUtil.parseTimestamp(value);
            commit.revision=new GitRevisionNumber(commitHash,commit.date);
          }
        }
        commits.put(commitHash,commit);
      }
      if (!s.hasMoreData()) {
        continue;
      }
      s.skipChars(1);
      int expectedLineNum=lines.size() + 1;
      if (lineNum != expectedLineNum) {
        throw new VcsException("Adding for info for line " + lineNum + " but we are expecting it to be for "+ expectedLineNum);
      }
      content.append(s.line(true));
      lines.add(new LineInfo(commit.date,commit.revision,commit.author));
    }
    return new GitFileAnnotation(myProject,file,revision,content.toString(),lines,revisions);
  }
 catch (  Exception e) {
    LOG.error("Couldn't parse annotation: " + e,new Attachment("output.txt",output));
    throw new VcsException(e);
  }
}
