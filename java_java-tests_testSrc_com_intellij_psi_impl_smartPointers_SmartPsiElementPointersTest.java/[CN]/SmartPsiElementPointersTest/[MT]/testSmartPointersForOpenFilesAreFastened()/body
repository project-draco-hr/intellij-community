{
  PsiJavaFile file=(PsiJavaFile)myJavaFacade.findClass("AClass",GlobalSearchScope.allScope(getProject())).getContainingFile();
  SmartPointerManagerImpl manager=(SmartPointerManagerImpl)SmartPointerManager.getInstance(myProject);
  VirtualFile virtualFile=file.getVirtualFile();
  assertFalse(manager.areBeltsFastened(virtualFile));
  FileEditor[] editors=FileEditorManager.getInstance(myProject).openFile(virtualFile,true);
  assertTrue(editors.length != 0);
  assertTrue(manager.areBeltsFastened(virtualFile));
  FileEditorManager.getInstance(myProject).closeFile(virtualFile);
  assertFalse(manager.areBeltsFastened(virtualFile));
  SmartPsiElementPointer<PsiClass> pointer=manager.createSmartPsiElementPointer(file.getClasses()[0]);
  assertFalse(manager.areBeltsFastened(virtualFile));
  editors=FileEditorManager.getInstance(myProject).openFile(virtualFile,true);
  assertTrue(editors.length != 0);
  assertTrue(manager.areBeltsFastened(virtualFile));
  FileEditorManager.getInstance(myProject).closeFile(virtualFile);
  assertFalse(manager.areBeltsFastened(virtualFile));
  assertEquals(file.getClasses()[0],pointer.getElement());
}
