{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      PsiClass aClass=myJavaFacade.findClass("AClass",GlobalSearchScope.allScope(getProject()));
      assertNotNull(aClass);
      Document document=PsiDocumentManager.getInstance(myProject).getDocument(aClass.getContainingFile());
      document.insertString(0,"/******/");
      SmartPointerEx pointer=(SmartPointerEx)createPointer(aClass.getNameIdentifier());
      aClass=null;
      PlatformTestUtil.tryGcSoftlyReachableObjects();
      assertNull(pointer.getCachedElement());
      assertNotNull(pointer.getElement());
      document.insertString(0,"/**/");
      PsiDocumentManager.getInstance(myProject).commitAllDocuments();
      PsiElement element=pointer.getElement();
      assertNotNull(element);
      assertTrue(element.getParent() instanceof PsiClass);
      assertTrue(element.isValid());
    }
  }
);
}
