{
  PsiFile file=configureByText(JavaFileType.INSTANCE,"class X{}");
  PsiClass aClass=((PsiClassOwner)file).getClasses()[0];
  SmartPointerManagerImpl smartPointerManager=(SmartPointerManagerImpl)SmartPointerManager.getInstance(myProject);
  SmartPsiElementPointerImpl pointer1=(SmartPsiElementPointerImpl)smartPointerManager.createSmartPsiElementPointer(aClass);
  for (int i=0; i < 1000; i++) {
    SmartPsiElementPointer<PsiClass> pointer2=smartPointerManager.createSmartPsiElementPointer(aClass);
    assertSame(pointer1,pointer2);
  }
  assertNotNull(pointer1.getRange());
  assertEquals(Byte.MAX_VALUE,pointer1.incrementAndGetReferenceCount(0));
  for (int i=0; i < 1100; i++) {
    boolean removed1=smartPointerManager.removePointer(pointer1);
    assertFalse(removed1);
    Assert.assertNotNull(pointer1.getRange());
  }
}
