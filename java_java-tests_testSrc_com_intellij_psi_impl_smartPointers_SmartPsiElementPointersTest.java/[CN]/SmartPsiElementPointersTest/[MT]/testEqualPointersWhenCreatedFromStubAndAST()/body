{
  PsiJavaFile file=(PsiJavaFile)myJavaFacade.findClass("AClass",GlobalSearchScope.allScope(getProject())).getContainingFile();
  final SmartPointerManager manager=SmartPointerManager.getInstance(myProject);
  int hash1=file.getClasses()[0].hashCode();
  final SmartPsiElementPointer<PsiClass> pointer1=manager.createSmartPsiElementPointer(file.getClasses()[0]);
  assertNotNull(((PsiFileImpl)file).getStubTree());
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  final FileASTNode node=file.getNode();
  final SmartPsiElementPointer<PsiClass> pointer2=manager.createSmartPsiElementPointer(file.getClasses()[0]);
  assertFalse(hash1 == file.getClasses()[0].hashCode());
  assertEquals(pointer1,pointer2);
  assertEquals(pointer1.getRange(),pointer2.getRange());
  assertNotNull(node);
}
