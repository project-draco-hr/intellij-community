{
  PsiFile file=configureByText(JavaFileType.INSTANCE,"class Foo extends Bar {}");
  PsiJavaCodeReferenceElement ref=PsiTreeUtil.findElementOfClassAtOffset(file,file.getText().indexOf("Bar"),PsiJavaCodeReferenceElement.class,false);
  SmartPointerEx pointer=(SmartPointerEx)createPointer(ref);
  ref=null;
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  assertNull(pointer.getCachedElement());
  ref=PsiTreeUtil.findElementOfClassAtOffset(file,file.getText().indexOf("Bar"),PsiJavaCodeReferenceElement.class,false);
  final PsiJavaCodeReferenceElement finalRef=ref;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      finalRef.handleElementRename("BarImpl");
    }
  }
);
  assertNotNull(pointer.getElement());
}
