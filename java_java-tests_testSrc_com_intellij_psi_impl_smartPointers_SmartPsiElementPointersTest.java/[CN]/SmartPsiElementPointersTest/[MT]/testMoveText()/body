{
  PsiJavaFile file=(PsiJavaFile)configureByText(JavaFileType.INSTANCE,"class C1{}\nclass C2 {}");
  DocumentEx document=(DocumentEx)file.getViewProvider().getDocument();
  SmartPsiElementPointer<PsiClass> pointer1=createPointer(file.getClasses()[0]);
  SmartPsiElementPointer<PsiClass> pointer2=createPointer(file.getClasses()[1]);
  assertEquals("C1",pointer1.getElement().getName());
  assertEquals("C2",pointer2.getElement().getName());
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  assertNull(((SmartPointerEx)pointer1).getCachedElement());
  assertNull(((SmartPointerEx)pointer2).getCachedElement());
  TextRange range=file.getClasses()[1].getTextRange();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      document.moveText(range.getStartOffset(),range.getEndOffset(),0);
    }
  }
);
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  assertEquals("C1",pointer1.getElement().getName());
  assertEquals("C2",pointer2.getElement().getName());
}
