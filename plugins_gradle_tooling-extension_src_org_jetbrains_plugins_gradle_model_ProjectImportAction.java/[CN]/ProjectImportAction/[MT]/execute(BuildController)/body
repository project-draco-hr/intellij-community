{
  Class<? extends IdeaProject> aClass1=myIsPreviewMode ? BasicIdeaProject.class : IdeaProject.class;
  final IdeaProject ideaProject=controller.getModel(aClass1);
  if (ideaProject == null || ideaProject.getModules().isEmpty()) {
    return null;
  }
  AllModels allModels=new AllModels(ideaProject);
  for (  IdeaModule module : ideaProject.getModules()) {
    for (    Class aClass : myExtraProjectModelClasses) {
      try {
        Object extraProject=controller.findModel(module,aClass);
        if (extraProject == null)         continue;
        allModels.addExtraProject(extraProject,aClass,module);
      }
 catch (      Exception e) {
        if (!myIsPreviewMode) {
          throw new ExternalSystemException(e);
        }
      }
    }
  }
  return allModels;
}
