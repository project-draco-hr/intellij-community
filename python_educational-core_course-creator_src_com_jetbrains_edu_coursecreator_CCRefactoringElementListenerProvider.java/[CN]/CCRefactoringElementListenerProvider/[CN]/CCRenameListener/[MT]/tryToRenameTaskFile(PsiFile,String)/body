{
  final PsiDirectory taskDir=file.getContainingDirectory();
  final Project project=file.getProject();
  Course course=StudyTaskManager.getInstance(project).getCourse();
  if (course == null) {
    return;
  }
  if (taskDir == null || !taskDir.getName().contains(EduNames.TASK)) {
    return;
  }
  PsiDirectory lessonDir=taskDir.getParent();
  if (lessonDir == null || !lessonDir.getName().contains(EduNames.LESSON)) {
    return;
  }
  Lesson lesson=course.getLesson(lessonDir.getName());
  if (lesson == null) {
    return;
  }
  Task task=lesson.getTask(taskDir.getName());
  if (task == null) {
    return;
  }
  Map<String,TaskFile> taskFiles=task.getTaskFiles();
  TaskFile taskFile=task.getTaskFile(oldName);
  if (taskFile == null) {
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      VirtualFile patternFile=StudyUtils.getPatternFile(project,taskFile,oldName);
      if (patternFile != null) {
        try {
          patternFile.delete(CCRefactoringElementListenerProvider.class);
        }
 catch (        IOException e) {
          LOG.info(e);
        }
      }
    }
  }
);
  taskFiles.remove(oldName);
  taskFiles.put(file.getName(),taskFile);
  CCUtils.createResourceFile(file.getVirtualFile(),course,taskDir.getVirtualFile());
}
