{
  loginIfNeeded();
  PostMethod method=new PostMethod(getUrl() + "/api.asp");
  method.addParameter("token",myToken);
  method.addParameter("cmd","search");
  method.addParameter("q",q);
  method.addParameter("cols","sTitle,fOpen,dtOpened,dtLastUpdated,ixCategory");
  int status=getHttpClient().executeMethod(method);
  if (status != 200) {
    throw new Exception("Error listing cases: " + method.getStatusLine());
  }
  Document document=new SAXBuilder(false).build(method.getResponseBodyAsStream()).getDocument();
  List<Element> errorNodes=XPath.newInstance("/response/error").selectNodes(document);
  if (!errorNodes.isEmpty()) {
    throw new Exception("Error listing cases: " + errorNodes.get(0).getText());
  }
  final XPath commentPath=XPath.newInstance("events/event");
  final List<Element> nodes=(List<Element>)XPath.newInstance("/response/cases/case").selectNodes(document);
  final List<Task> tasks=ContainerUtil.mapNotNull(nodes,new NotNullFunction<Element,Task>(){
    @NotNull @Override public Task fun(    Element element){
      return createCase(element,commentPath);
    }
  }
);
  return tasks.toArray(new Task[tasks.size()]);
}
