{
  myBaseDir=baseDir;
  File suggestedProjectDirectory=FileUtil.findSequentNonexistentFile(new File(baseDir),"untitled","");
  locationField.setText(suggestedProjectDirectory.toString());
  nameField.setDocument(new NameFieldDocument(nameField,locationField));
  mySuggestedProjectName=suggestedProjectDirectory.getName();
  nameField.setText(mySuggestedProjectName);
  nameField.selectAll();
  FileChooserDescriptor descriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
  BrowseFolderActionListener<JTextField> listener=new BrowseFolderActionListener<JTextField>(title,"",locationField,project,descriptor,TextComponentAccessor.TEXT_FIELD_WHOLE_TEXT){
    @Override protected void onFileChosen(    @NotNull VirtualFile chosenFile){
      myBaseDir=chosenFile.getPath();
      if (isProjectNameChanged(nameField.getText()) && !nameField.getText().equals(chosenFile.getName())) {
        myExternalModify=true;
        locationField.setText(new File(chosenFile.getPath(),nameField.getText()).toString());
        myExternalModify=false;
      }
 else {
        myExternalModify=true;
        locationField.setText(chosenFile.getPath());
        nameField.setText(chosenFile.getName());
        myExternalModify=false;
      }
    }
  }
;
  locationField.addActionListener(listener);
  locationField.getTextField().getDocument().addDocumentListener(new DocumentAdapter(){
    @Override protected void textChanged(    DocumentEvent e){
      if (myExternalModify) {
        return;
      }
      myModifyingLocation=true;
      String path=locationField.getText().trim();
      path=StringUtil.trimEnd(path,File.separator);
      int ind=path.lastIndexOf(File.separator);
      if (ind != -1) {
        String projectName=path.substring(ind + 1,path.length());
        if (!nameField.getText().trim().isEmpty()) {
          myBaseDir=path.substring(0,ind);
        }
        if (!projectName.equals(nameField.getText())) {
          if (!myModifyingProjectName) {
            nameField.setText(projectName);
          }
        }
      }
      myModifyingLocation=false;
    }
  }
);
}
