{
  final LibraryTable libraryTable=LibraryTablesRegistrar.getInstance().getLibraryTable();
  final Library library=libraryTable.createLibrary("NewLibrary");
  final boolean[] listenerNotifiedOnChange=new boolean[1];
  library.getRootProvider().addRootSetChangedListener(new RootProvider.RootSetChangedListener(){
    @Override public void rootSetChanged(    RootProvider wrapper){
      listenerNotifiedOnChange[0]=true;
    }
  }
);
  final Library.ModifiableModel model1=library.getModifiableModel();
  model1.addRoot("file://x.jar",OrderRootType.CLASSES);
  model1.addRoot("file://x-src.jar",OrderRootType.SOURCES);
  commit(model1);
  assertTrue(listenerNotifiedOnChange[0]);
  listenerNotifiedOnChange[0]=false;
  final Library.ModifiableModel model2=library.getModifiableModel();
  model2.setName("library");
  commit(model2);
  assertFalse(listenerNotifiedOnChange[0]);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      libraryTable.removeLibrary(library);
    }
  }
);
}
