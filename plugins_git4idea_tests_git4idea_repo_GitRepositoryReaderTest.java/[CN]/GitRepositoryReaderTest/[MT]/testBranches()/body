{
  doTest(new ResultConsumer(){
    @Override public void consume(    @NotNull File resultDir) throws Exception {
      Collection<GitRemote> remotes=GitConfig.read(myPlatformFacade,new File(myGitDir,"config")).parseRemotes();
      GitBranchesCollection branchesCollection=myRepositoryReader.readBranches(remotes);
      GitLocalBranch currentBranch=myRepositoryReader.readCurrentBranch();
      Collection<? extends GitBranch> localBranches=branchesCollection.getLocalBranches();
      Collection<? extends GitBranch> remoteBranches=branchesCollection.getRemoteBranches();
      assertEqualBranches(readCurrentBranch(resultDir),currentBranch);
      assertBranches(localBranches,readBranches(resultDir,true));
      assertBranches(remoteBranches,readBranches(resultDir,false));
    }
  }
);
}
