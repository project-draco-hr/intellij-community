{
  Pair<ArchiveFileSystem,ArchiveHandler> handlerPair=ourHandlers.remove(path);
  if (handlerPair != null) {
    String rootPath=handlerPair.first.convertLocalPathToRootPath(path);
    NewVirtualFile root=ManagingFS.getInstance().findRoot(rootPath,handlerPair.first);
    if (root != null) {
      root.markDirtyRecursively();
      if (rootsToRefresh == null)       rootsToRefresh=ContainerUtil.newHashMap();
      rootsToRefresh.put(rootPath,root);
    }
    forEachDirectoryComponent(path,new Processor<String>(){
      @Override public boolean process(      String containingDirectoryPath){
        Set<String> handlers=ourDominatorsMap.get(containingDirectoryPath);
        if (handlers != null) {
          if (handlers.remove(path) && handlers.size() == 0) {
            ourDominatorsMap.remove(containingDirectoryPath);
          }
        }
        return true;
      }
    }
);
  }
  return rootsToRefresh;
}
