{
  Pair<ArchiveFileSystem,ArchiveHandler> handlerPair=ourHandlers.remove(path);
  if (handlerPair != null) {
    forEachDirectoryComponent(path,new Processor<String>(){
      @Override public boolean process(      String containingDirectoryPath){
        Set<String> handlers=ourDominatorsMap.get(containingDirectoryPath);
        if (handlers != null && handlers.remove(path) && handlers.size() == 0) {
          ourDominatorsMap.remove(containingDirectoryPath);
        }
        return true;
      }
    }
);
    if (state == null)     state=new InvalidationState();
    state.registerPathToRefresh(path,handlerPair.first);
  }
  return state;
}
