{
  if (rootsToRefresh != null) {
    for (    VirtualFile root : rootsToRefresh.values()) {
      ((NewVirtualFile)root).markDirtyRecursively();
    }
    ZipFileCache.reset(rootsToRefresh.keySet());
    boolean async=!ApplicationManager.getApplication().isUnitTestMode();
    RefreshQueue.getInstance().refresh(async,true,null,rootsToRefresh.values());
  }
}
