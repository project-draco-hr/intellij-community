{
  final VirtualFile[] filesCopy=VfsUtilCore.toVirtualFileArray(JBIterable.from(files).toList());
  Arrays.sort(filesCopy,new Comparator<VirtualFile>(){
    @Override public int compare(    VirtualFile o1,    VirtualFile o2){
      return StringUtil.compare(o1.getName(),o2.getName(),!o1.getFileSystem().isCaseSensitive());
    }
  }
);
  return forFileLanguages(project,null,new Consumer<Language>(){
    @Override public void consume(    final Language t){
      new WriteCommandAction(project,"Change Language"){
        @Override protected void run(        @NotNull Result result) throws Throwable {
          changeLanguageWithUndo(project,t,filesCopy,mappings);
        }
      }
.execute();
    }
  }
);
}
