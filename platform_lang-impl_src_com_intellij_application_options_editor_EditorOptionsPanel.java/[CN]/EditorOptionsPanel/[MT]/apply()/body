{
  EditorSettingsExternalizable editorSettings=EditorSettingsExternalizable.getInstance();
  CodeInsightSettings codeInsightSettings=CodeInsightSettings.getInstance();
  UISettings uiSettings=UISettings.getInstance();
  VcsApplicationSettings vcsSettings=VcsApplicationSettings.getInstance();
  editorSettings.setSmoothScrolling(myCbSmoothScrolling.isSelected());
  codeInsightSettings.HIGHLIGHT_BRACES=myCbHighlightBraces.isSelected();
  codeInsightSettings.HIGHLIGHT_SCOPE=myCbHighlightScope.isSelected();
  codeInsightSettings.HIGHLIGHT_IDENTIFIER_UNDER_CARET=myCbHighlightIdentifierUnderCaret.isSelected();
  clearAllIdentifierHighlighters();
  editorSettings.setUseSoftWraps(myCbUseSoftWrapsAtEditor.isSelected(),SoftWrapAppliancePlaces.MAIN_EDITOR);
  editorSettings.setUseCustomSoftWrapIndent(myCbUseCustomSoftWrapIndent.isSelected());
  editorSettings.setCustomSoftWrapIndent(getCustomSoftWrapIndent());
  editorSettings.setAllSoftwrapsShown(!myCbShowSoftWrapsOnlyOnCaretLine.isSelected());
  editorSettings.setVirtualSpace(myCbVirtualSpace.isSelected());
  editorSettings.setCaretInsideTabs(myCbCaretInsideTabs.isSelected());
  editorSettings.setAdditionalPageAtBottom(myCbVirtualPageAtBottom.isSelected());
  boolean uiSettingsChanged=false;
  int maxClipboardContents=getMaxClipboardContents();
  if (uiSettings.MAX_CLIPBOARD_CONTENTS != maxClipboardContents) {
    uiSettings.MAX_CLIPBOARD_CONTENTS=maxClipboardContents;
    uiSettingsChanged=true;
  }
  if (uiSettingsChanged) {
    uiSettings.fireUISettingsChanged();
  }
  if (STRIP_NONE.equals(myStripTrailingSpacesCombo.getSelectedItem())) {
    editorSettings.setStripTrailingSpaces(EditorSettingsExternalizable.STRIP_TRAILING_SPACES_NONE);
  }
 else   if (STRIP_CHANGED.equals(myStripTrailingSpacesCombo.getSelectedItem())) {
    editorSettings.setStripTrailingSpaces(EditorSettingsExternalizable.STRIP_TRAILING_SPACES_CHANGED);
  }
 else {
    editorSettings.setStripTrailingSpaces(EditorSettingsExternalizable.STRIP_TRAILING_SPACES_WHOLE);
  }
  editorSettings.setEnsureNewLineAtEOF(myCbEnsureBlankLineBeforeCheckBox.isSelected());
  if (myCbShowQuickDocOnMouseMove.isSelected() ^ editorSettings.isShowQuickDocOnMouseOverElement()) {
    boolean enabled=myCbShowQuickDocOnMouseMove.isSelected();
    editorSettings.setShowQuickDocOnMouseOverElement(enabled);
    ServiceManager.getService(QuickDocOnMouseOverManager.class).setEnabled(enabled);
  }
  Long quickDocDelay=getQuickDocDelayFromGui();
  if (quickDocDelay != null) {
    editorSettings.setQuickDocOnMouseOverElementDelayMillis(quickDocDelay);
  }
  editorSettings.setDndEnabled(myCbEnableDnD.isSelected());
  editorSettings.setWheelFontChangeEnabled(myCbEnableWheelFontChange.isSelected());
  editorSettings.setMouseClickSelectionHonorsCamelWords(myCbHonorCamelHumpsWhenSelectingByClicking.isSelected());
  editorSettings.setRefrainFromScrolling(myRbPreferMovingCaret.isSelected());
  editorSettings.setVariableInplaceRenameEnabled(myCbRenameLocalVariablesInplace.isSelected());
  editorSettings.setPreselectRename(myPreselectCheckBox.isSelected());
  editorSettings.setShowInlineLocalDialog(myShowInlineDialogForCheckBox.isSelected());
  editorSettings.getOptions().SHOW_NOTIFICATION_AFTER_REFORMAT_CODE_ACTION=myShowNotificationAfterReformatCodeCheckBox.isSelected();
  editorSettings.getOptions().SHOW_NOTIFICATION_AFTER_OPTIMIZE_IMPORTS_ACTION=myShowNotificationAfterOptimizeImportsCheckBox.isSelected();
  boolean updateVcsSettings=false;
  if (vcsSettings.SHOW_WHITESPACES_IN_LST != myShowWhitespacesModificationsInLSTGutterCheckBox.isSelected()) {
    vcsSettings.SHOW_WHITESPACES_IN_LST=myShowWhitespacesModificationsInLSTGutterCheckBox.isSelected();
    updateVcsSettings=true;
  }
  if (vcsSettings.SHOW_LST_GUTTER_MARKERS != myShowLSTInGutterCheckBox.isSelected()) {
    vcsSettings.SHOW_LST_GUTTER_MARKERS=myShowLSTInGutterCheckBox.isSelected();
    updateVcsSettings=true;
  }
  if (updateVcsSettings) {
    Project[] projects=ProjectManager.getInstance().getOpenProjects();
    for (    Project project : projects) {
      LineStatusTrackerManager.getInstance(project).updateSettings();
    }
  }
  reinitAllEditors();
  String temp=myRecentFilesLimitField.getText();
  if (temp.trim().length() > 0) {
    try {
      int newRecentFilesLimit=Integer.parseInt(temp);
      if (newRecentFilesLimit > 0 && uiSettings.RECENT_FILES_LIMIT != newRecentFilesLimit) {
        uiSettings.RECENT_FILES_LIMIT=newRecentFilesLimit;
        uiSettingsChanged=true;
      }
    }
 catch (    NumberFormatException ignored) {
    }
  }
  if (uiSettingsChanged) {
    uiSettings.fireUISettingsChanged();
  }
  myErrorHighlightingPanel.apply();
  RichCopySettings settings=RichCopySettings.getInstance();
  settings.setEnabled(myCbEnableRichCopyByDefault.isSelected());
  Object item=myRichCopyColorSchemeComboBox.getSelectedItem();
  if (item instanceof String) {
    settings.setSchemeName(item.toString());
  }
  restartDaemons();
}
