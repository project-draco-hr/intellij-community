{
  if (document.isWritable())   return true;
  if (project == null)   return false;
  final VirtualFile file=FileDocumentManager.getInstance().getFile(document);
  final ReadonlyStatusHandler.OperationStatus status=ReadonlyStatusHandler.getInstance(project).ensureFilesWritable(file);
  return !status.hasReadonlyFiles();
}
