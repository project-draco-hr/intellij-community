{
  LineFragments lineFragments=doCompareWithCache(request,text1,text2,stamp1,stamp2,config,indicator);
  indicator.checkCanceled();
  if (lineFragments.isFine()) {
    List<? extends FineLineFragment> fragments=lineFragments.getFineFragments();
    fragments=ComparisonUtil.processBlocksFine(fragments,text1,text2,config.policy,config.squashFragments,config.trimFragments);
    return LineFragments.createFine(fragments);
  }
 else {
    List<? extends LineFragment> fragments=lineFragments.getFragments();
    fragments=ComparisonUtil.processBlocks(fragments,text1,text2,config.policy,config.squashFragments,config.trimFragments);
    return LineFragments.create(fragments);
  }
}
