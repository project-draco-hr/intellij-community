{
  LineFragmentCache oldCache=request.getUserData(DiffUserDataKeys.LINE_FRAGMENT_CACHE);
  LineFragmentCache cache;
  if (oldCache == null || !oldCache.checkStamps(stamp1,stamp2)) {
    cache=new LineFragmentCache(stamp1,stamp2);
  }
 else {
    cache=new LineFragmentCache(oldCache);
  }
  cache.putFragments(config.policy,fragments);
  request.putUserData(DiffUserDataKeys.LINE_FRAGMENT_CACHE,cache);
}
