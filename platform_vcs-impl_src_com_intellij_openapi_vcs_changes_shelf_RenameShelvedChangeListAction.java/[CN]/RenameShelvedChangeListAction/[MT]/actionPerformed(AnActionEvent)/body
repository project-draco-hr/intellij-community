{
  final Project project=e.getRequiredData(CommonDataKeys.PROJECT);
  final List<ShelvedChangeList> changelists=ShelvedChangesViewManager.getShelvedLists(e.getDataContext());
  final ShelvedChangeList changeList=ObjectUtils.assertNotNull(ContainerUtil.getFirstItem(changelists));
  String newName=Messages.showInputDialog(project,VcsBundle.message("shelve.changes.rename.prompt"),VcsBundle.message("shelve.changes.rename.title"),Messages.getQuestionIcon(),changeList.DESCRIPTION,new InputValidator(){
    public boolean checkInput(    final String inputString){
      if (inputString.length() == 0) {
        return false;
      }
      final List<ShelvedChangeList> list=ShelveChangesManager.getInstance(project).getShelvedChangeLists();
      for (      ShelvedChangeList oldList : list) {
        if (oldList != changeList && oldList.DESCRIPTION.equals(inputString)) {
          return false;
        }
      }
      return true;
    }
    public boolean canClose(    final String inputString){
      return checkInput(inputString);
    }
  }
);
  if (newName != null && !newName.equals(changeList.DESCRIPTION)) {
    ShelveChangesManager.getInstance(project).renameChangeList(changeList,newName);
  }
}
