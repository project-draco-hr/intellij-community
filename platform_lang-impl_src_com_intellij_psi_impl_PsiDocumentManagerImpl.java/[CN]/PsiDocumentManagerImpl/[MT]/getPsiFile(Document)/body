{
  final PsiFile psiFile=super.getPsiFile(document);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    final VirtualFile virtualFile=FileDocumentManager.getInstance().getFile(document);
    if (virtualFile != null && virtualFile.isValid()) {
      Collection<Project> projects=ProjectLocator.getInstance().getProjectsForFile(virtualFile);
      LOG.assertTrue(projects.isEmpty() || projects.contains(myProject),"Trying to get PSI for an alien project. VirtualFile=" + virtualFile + ";\n myProject="+ myProject+ ";\n projects returned: "+ projects);
    }
  }
  return psiFile;
}
