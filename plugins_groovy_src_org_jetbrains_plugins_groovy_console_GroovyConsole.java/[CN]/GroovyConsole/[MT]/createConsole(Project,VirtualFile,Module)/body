{
  final ProcessHandler processHandler=createProcessHandler(module);
  if (processHandler == null)   return null;
  final GroovyConsoleStateService consoleStateService=GroovyConsoleStateService.getInstance(project);
  consoleStateService.setFileModule(contentFile,module);
  final String title=consoleStateService.getSelectedModuleTitle(contentFile);
  final ConsoleViewImpl consoleView=new ConsoleViewImpl(project,true);
  final RunContentDescriptor descriptor=new RunContentDescriptor(consoleView,processHandler,new JPanel(new BorderLayout()),title);
  final GroovyConsole console=new GroovyConsole(project,descriptor,consoleView,processHandler);
  final JComponent consoleViewComponent=consoleView.getComponent();
  final DefaultActionGroup actionGroup=new DefaultActionGroup();
  actionGroup.add(new BuildAndRestartConsoleAction(module,project,defaultExecutor,descriptor,restarter(project,contentFile)));
  actionGroup.addSeparator();
  actionGroup.addAll(consoleView.createConsoleActions());
  actionGroup.add(new CloseAction(defaultExecutor,descriptor,project));
  final ActionToolbar toolbar=ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN,actionGroup,false);
  toolbar.setTargetComponent(consoleViewComponent);
  final JComponent ui=descriptor.getComponent();
  ui.add(consoleViewComponent,BorderLayout.CENTER);
  ui.add(toolbar.getComponent(),BorderLayout.WEST);
  consoleView.attachToProcess(processHandler);
  processHandler.addProcessListener(new ProcessAdapter(){
    @Override public void processTerminated(    ProcessEvent event){
      if (contentFile.getUserData(GROOVY_CONSOLE) == console) {
        contentFile.putUserData(GROOVY_CONSOLE,null);
      }
    }
  }
);
  processHandler.startNotify();
  ExecutionManager.getInstance(project).getContentManager().showRunContent(defaultExecutor,descriptor);
  contentFile.putUserData(GROOVY_CONSOLE,console);
  return console;
}
