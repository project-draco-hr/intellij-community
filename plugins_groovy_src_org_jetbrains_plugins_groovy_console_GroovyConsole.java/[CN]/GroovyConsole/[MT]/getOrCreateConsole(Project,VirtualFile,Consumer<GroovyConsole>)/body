{
  final GroovyConsole existingConsole=contentFile.getUserData(GROOVY_CONSOLE);
  if (existingConsole != null)   return;
  final Consumer<Module> initializer=new Consumer<Module>(){
    @Override public void consume(    Module module){
      final GroovyConsole console=createConsole(project,contentFile,module);
      if (console != null) {
        callback.consume(console);
      }
    }
  }
;
  final Module module=GroovyConsoleStateService.getInstance(project).getSelectedModule(contentFile);
  if (module == null || module.isDisposed()) {
    GroovyConsoleUtil.selectModuleAndRun(project,initializer);
  }
 else {
    initializer.consume(module);
  }
}
