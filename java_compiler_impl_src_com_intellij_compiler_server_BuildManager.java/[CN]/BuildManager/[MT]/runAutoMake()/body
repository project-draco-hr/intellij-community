{
  final Project project=getCurrentContextProject();
  if (project == null || !canStartAutoMake(project)) {
    return;
  }
  final List<TargetTypeBuildScope> scopes=CmdlineProtoUtil.createAllModulesScopes(false);
  final AutoMakeMessageHandler handler=new AutoMakeMessageHandler(project);
  final TaskFuture future=scheduleBuild(project,false,true,false,scopes,Collections.emptyList(),Collections.emptyMap(),handler);
  if (future != null) {
    myAutomakeFutures.put(future,project);
    try {
      future.waitFor();
    }
  finally {
      myAutomakeFutures.remove(future);
      if (handler.unprocessedFSChangesDetected()) {
        scheduleAutoMake();
      }
    }
  }
}
