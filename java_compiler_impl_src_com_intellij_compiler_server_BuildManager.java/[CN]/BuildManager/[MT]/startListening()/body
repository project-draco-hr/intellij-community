{
  final ServerBootstrap bootstrap=NettyKt.serverBootstrap(new NioEventLoopGroup(1,ConcurrencyUtil.newNamedThreadFactory("External compiler")));
  bootstrap.childHandler(new ChannelInitializer(){
    @Override protected void initChannel(    Channel channel) throws Exception {
      channel.pipeline().addLast(myChannelRegistrar,new ProtobufVarint32FrameDecoder(),new ProtobufDecoder(CmdlineRemoteProto.Message.getDefaultInstance()),new ProtobufVarint32LengthFieldPrepender(),new ProtobufEncoder(),myMessageDispatcher);
    }
  }
);
  Channel serverChannel=bootstrap.bind(NetUtils.getLoopbackAddress(),0).syncUninterruptibly().channel();
  myChannelRegistrar.add(serverChannel);
  return ((InetSocketAddress)serverChannel.localAddress()).getPort();
}
