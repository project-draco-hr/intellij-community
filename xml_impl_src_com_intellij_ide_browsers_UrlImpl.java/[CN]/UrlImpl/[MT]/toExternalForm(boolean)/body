{
  if (parameters == null || !skipQueryAndFragment) {
    if (raw != null) {
      return raw;
    }
  }
 else   if (externalFormWithoutParameters != null) {
    return externalFormWithoutParameters;
  }
  String result;
  try {
    String externalPath=path;
    boolean inLocalFileSystem=isInLocalFileSystem();
    if (inLocalFileSystem && SystemInfo.isWindows && externalPath.charAt(0) != '/') {
      externalPath='/' + externalPath;
    }
    result=new URI(scheme,inLocalFileSystem ? "" : authority,externalPath,null,null).toASCIIString();
  }
 catch (  URISyntaxException e) {
    throw new RuntimeException(e);
  }
  if (skipQueryAndFragment) {
    externalFormWithoutParameters=result;
    if (parameters == null) {
      raw=externalFormWithoutParameters;
    }
  }
 else {
    if (parameters != null) {
      result+=parameters;
    }
    raw=result;
  }
  return result;
}
