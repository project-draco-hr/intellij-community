{
  Set<String> newHistorySet=ContainerUtil.newHashSet(history);
  List<String> prevHistory=textFieldWithHistory.getHistory();
  List<String> mergedHistory=ContainerUtil.newArrayList();
  if (mergeWithPrevHistory) {
    for (    String item : prevHistory) {
      if (!newHistorySet.contains(item)) {
        mergedHistory.add(item);
      }
    }
  }
 else {
    String currentText=textFieldWithHistory.getText();
    if (StringUtil.isNotEmpty(currentText) && !newHistorySet.contains(currentText)) {
      mergedHistory.add(currentText);
    }
  }
  mergedHistory.addAll(history);
  textFieldWithHistory.setHistory(mergedHistory);
  setLongestAsPrototype(textFieldWithHistory,mergedHistory);
}
