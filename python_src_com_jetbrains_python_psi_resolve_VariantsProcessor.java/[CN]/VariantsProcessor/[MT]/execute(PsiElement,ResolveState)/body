{
  if (myNodeFilter != null && !myNodeFilter.value(element))   return true;
  if (element instanceof PsiNamedElement) {
    final PsiNamedElement psiNamedElement=(PsiNamedElement)element;
    final String name=psiNamedElement.getName();
    if (nameIsAcceptable(name)) {
      myVariants.put(name,setupItem(LookupElementBuilder.create(psiNamedElement).setIcon(element.getIcon(0))));
    }
  }
 else   if (element instanceof PyReferenceExpression) {
    PyReferenceExpression expr=(PyReferenceExpression)element;
    String referencedName=expr.getReferencedName();
    if (nameIsAcceptable(referencedName)) {
      myVariants.put(referencedName,setupItem(LookupElementBuilder.create(referencedName)));
    }
  }
 else   if (element instanceof NameDefiner) {
    final NameDefiner definer=(NameDefiner)element;
    for (    PyElement expr : definer.iterateNames()) {
      if (expr != null && expr != myContext) {
        String referencedName=expr.getName();
        Icon icon=expr.getIcon(0);
        if (icon == null)         icon=Icons.VARIABLE_ICON;
        if (nameIsAcceptable(referencedName)) {
          LookupElementBuilder lookupItem=setupItem(LookupElementBuilder.create(referencedName).setIcon(icon));
          if (definer instanceof PyImportElement) {
            PsiElement maybeFromImport=definer.getParent();
            if (maybeFromImport instanceof PyFromImportStatement) {
              final PyFromImportStatement fromImport=(PyFromImportStatement)maybeFromImport;
              PyReferenceExpression src=fromImport.getImportSource();
              if (src != null) {
                lookupItem=setItemNotice(lookupItem,src.getName());
              }
            }
          }
          if (definer instanceof PyAssignmentStatement) {
            PyExpression value=((PyAssignmentStatement)definer).getAssignedValue();
            PyType type=value.getType(TypeEvalContext.fast());
            if (type != null) {
              lookupItem=lookupItem.setTypeText(type.getName());
            }
          }
          myVariants.put(referencedName,lookupItem);
        }
      }
    }
  }
  return true;
}
