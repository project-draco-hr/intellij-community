{
  if (myNodeFilter != null && !myNodeFilter.value(element))   return true;
  if (element instanceof PsiNamedElement) {
    final PsiNamedElement psiNamedElement=(PsiNamedElement)element;
    final String name=psiNamedElement.getName();
    if (name != null && !myVariants.containsKey(name) && myNameFilter != null && myNameFilter.value(name)) {
      myVariants.put(name,setupItem(LookupElementBuilder.create(psiNamedElement).setIcon(element.getIcon(0))));
    }
  }
 else   if (element instanceof PyReferenceExpression) {
    PyReferenceExpression expr=(PyReferenceExpression)element;
    String referencedName=expr.getReferencedName();
    if (referencedName != null && !myVariants.containsKey(referencedName) && myNameFilter != null && myNameFilter.value(referencedName)) {
      myVariants.put(referencedName,setupItem(LookupElementBuilder.create(referencedName)));
    }
  }
 else   if (element instanceof NameDefiner) {
    final NameDefiner definer=(NameDefiner)element;
    for (    PyElement expr : definer.iterateNames()) {
      if (expr != null) {
        String referencedName=expr.getName();
        Icon icon=element.getIcon(0);
        if (icon == null)         icon=Icons.VARIABLE_ICON;
        if (referencedName != null && !myVariants.containsKey(referencedName) && myNameFilter != null && myNameFilter.value(referencedName)) {
          LookupElementBuilder lookup_item=setupItem(LookupElementBuilder.create(referencedName).setIcon(icon));
          if (definer instanceof PyImportElement) {
            PsiElement maybe_from_import=definer.getParent();
            if (maybe_from_import instanceof PyFromImportStatement) {
              final PyFromImportStatement from_import=(PyFromImportStatement)maybe_from_import;
              PyReferenceExpression src=from_import.getImportSource();
              if (src != null) {
                lookup_item=setItemNotice(lookup_item,src.getName());
              }
            }
          }
          myVariants.put(referencedName,lookup_item);
        }
      }
    }
  }
  return true;
}
