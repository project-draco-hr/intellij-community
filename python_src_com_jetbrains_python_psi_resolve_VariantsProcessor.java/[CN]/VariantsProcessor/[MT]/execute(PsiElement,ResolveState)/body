{
  if (my_filter != null && !my_filter.accept(element))   return true;
  if (element instanceof PsiNamedElement) {
    final PsiNamedElement psiNamedElement=(PsiNamedElement)element;
    final String name=psiNamedElement.getName();
    if (!myVariants.containsKey(name)) {
      final LookupItem lookup_item=(LookupItem)LookupElementFactory.getInstance().createLookupElement(psiNamedElement);
      setupItem(lookup_item);
      myVariants.put(name,lookup_item);
    }
  }
 else   if (element instanceof PyReferenceExpression) {
    PyReferenceExpression expr=(PyReferenceExpression)element;
    String referencedName=expr.getReferencedName();
    if (referencedName != null && !myVariants.containsKey(referencedName)) {
      final LookupItem lookup_item=(LookupItem)LookupElementFactory.getInstance().createLookupElement(referencedName);
      setupItem(lookup_item);
      myVariants.put(referencedName,lookup_item);
    }
  }
 else   if (element instanceof NameDefiner) {
    final NameDefiner definer=(NameDefiner)element;
    for (    PyElement expr : definer.iterateNames()) {
      if (expr != null) {
        String referencedName=expr.getName();
        if (referencedName != null && !myVariants.containsKey(referencedName)) {
          final LookupItem lookup_item=(LookupItem)LookupElementFactory.getInstance().createLookupElement(referencedName);
          setupItem(lookup_item);
          if (definer instanceof PyImportElement) {
            PsiElement maybe_from_import=definer.getParent();
            if (maybe_from_import instanceof PyFromImportStatement) {
              final PyFromImportStatement from_import=(PyFromImportStatement)maybe_from_import;
              PyReferenceExpression src=from_import.getImportSource();
              if (src != null) {
                setItemNotice(lookup_item," | " + src.getName());
              }
            }
          }
          myVariants.put(referencedName,lookup_item);
        }
      }
    }
  }
  return true;
}
