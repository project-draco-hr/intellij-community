{
  super.update(e);
  final Presentation presentation=e.getPresentation();
  if (presentation.isEnabled()) {
    final DataContext context=e.getDataContext();
    final Module module=LangDataKeys.MODULE.getData(context);
    if (PluginModuleType.isPluginModuleOrDependency(module)) {
      final IdeView view=LangDataKeys.IDE_VIEW.getData(e.getDataContext());
      final Project project=CommonDataKeys.PROJECT.getData(e.getDataContext());
      if (view != null && project != null) {
        ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
        PsiDirectory[] dirs=view.getDirectories();
        for (        PsiDirectory dir : dirs) {
          if (projectFileIndex.isUnderSourceRootOfType(dir.getVirtualFile(),JavaModuleSourceRootTypes.SOURCES) && JavaDirectoryService.getInstance().getPackage(dir) != null) {
            return;
          }
        }
      }
    }
    presentation.setEnabled(false);
    presentation.setVisible(false);
  }
}
