{
  final BitSetFlags visited=new BitSetFlags(graph.nodesCount(),false);
  for (  int head : layout.getHeadNodeIndex()) {
    IntStack stack=new IntStack();
    visited.set(head,true);
    stack.push(head);
    visitor.enterSubtree(head,head,visited);
    while (!stack.empty()) {
      int nextNode=nextNode(graph,layout,stack.peek(),visited);
      if (nextNode != NODE_NOT_FOUND) {
        visited.set(nextNode,true);
        stack.push(nextNode);
        visitor.enterSubtree(nextNode,head,visited);
      }
 else {
        visitor.leaveSubtree(stack.pop(),head,visited);
      }
    }
    visitor.leaveSubtree(head,head,visited);
  }
  if (Boolean.getBoolean("idea.is.internal")) {
    for (int i=0; i < visited.size(); i++) {
      if (!visited.get(i)) {
        LOG.warn("Missed node " + i);
      }
    }
  }
}
