{
  try {
    final PyImportStatementBase parentImport=PsiTreeUtil.getParentOfType(anchor,PyImportStatementBase.class,false);
    final PsiElement insertParent;
    if (parentImport != null && parentImport.getContainingFile() == file) {
      insertParent=parentImport.getParent();
    }
 else {
      insertParent=file;
    }
    if (InjectedLanguageManager.getInstance(file.getProject()).isInjectedFragment(file)) {
      final PsiElement element=insertParent.addBefore(newImport,getInsertPosition(insertParent,newImport,priority));
      PsiElement whitespace=element.getNextSibling();
      if (!(whitespace instanceof PsiWhiteSpace)) {
        whitespace=PsiParserFacade.SERVICE.getInstance(file.getProject()).createWhiteSpaceFromText("  >>> ");
      }
      insertParent.addBefore(whitespace,element);
    }
 else {
      if (anchor instanceof PyImportStatementBase) {
        insertParent.addAfter(newImport,anchor);
      }
 else {
        insertParent.addBefore(newImport,getInsertPosition(insertParent,newImport,priority));
      }
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
