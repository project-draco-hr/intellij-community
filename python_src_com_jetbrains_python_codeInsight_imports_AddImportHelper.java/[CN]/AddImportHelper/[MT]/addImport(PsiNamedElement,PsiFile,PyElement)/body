{
  final boolean useQualified=!PyCodeInsightSettings.getInstance().PREFER_FROM_IMPORT;
  final PsiFileSystemItem toImport=target instanceof PsiFileSystemItem ? ((PsiFileSystemItem)target).getParent() : target.getContainingFile();
  final ImportPriority priority=getImportPriority(file,toImport);
  final PyQualifiedName qName=QualifiedNameFinder.findCanonicalImportPath(target,element);
  if (qName == null)   return;
  String path=qName.toString();
  if (target instanceof PsiFileSystemItem && qName.getComponentCount() == 1) {
    addImportStatement(file,path,null,priority);
  }
 else   if (useQualified) {
    addImportStatement(file,path,null,priority);
    final PyElementGenerator elementGenerator=PyElementGenerator.getInstance(file.getProject());
    element.replace(elementGenerator.createExpressionFromText(LanguageLevel.forElement(target),qName + "." + target.getName()));
  }
 else {
    final PyQualifiedName toImportQName=QualifiedNameFinder.findCanonicalImportPath(toImport,element);
    addImportFrom(file,null,toImportQName.toString(),target.getName(),null,priority);
  }
}
