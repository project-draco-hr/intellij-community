{
  Repository repository=getRepository();
  if (treeWalk == null) {
    treeWalk=new TreeWalk(repository);
    treeWalk.setRecursive(false);
  }
  try {
    return doAdd(treeWalk,path,repository,new FileTreeIterator(getRepository()));
  }
  finally {
    treeWalk.release();
    treeWalk.reset();
  }
}
