{
  final XmlAttributeValue element=ref.getElement();
  String canonicalText=JavaFxCommonNames.JAVAFX_EVENT;
  final PsiElement parent=element.getParent();
  if (parent instanceof XmlAttribute) {
    final XmlAttribute xmlAttribute=(XmlAttribute)parent;
    final PsiField handlerField=ref.myCurrentTagClass.findFieldByName(xmlAttribute.getName(),true);
    if (handlerField != null) {
      final XmlTag xmlTag=xmlAttribute.getParent();
      final PsiSubstitutor currentTagClassSubstitutor=JavaFxPsiUtil.getTagClassSubstitutor(xmlTag,ref.myCurrentTagClass,ref.myController);
      PsiType handlerType=JavaFxPsiUtil.getPropertyClassType(handlerField);
      if (currentTagClassSubstitutor != null) {
        handlerType=currentTagClassSubstitutor.substitute(handlerType);
      }
      if (handlerType instanceof PsiClassType) {
        final Project project=element.getProject();
        final PsiClass eventHandlerClass=JavaPsiFacade.getInstance(project).findClass(JavaFxCommonNames.JAVAFX_EVENT_EVENT_HANDLER,GlobalSearchScope.allScope(project));
        if (eventHandlerClass != null) {
          final PsiTypeParameter[] typeParameters=eventHandlerClass.getTypeParameters();
          if (typeParameters.length == 1) {
            final PsiTypeParameter typeParameter=typeParameters[0];
            final PsiSubstitutor substitutor=TypeConversionUtil.getSuperClassSubstitutor(eventHandlerClass,(PsiClassType)handlerType);
            final PsiType eventType=substitutor.substitute(typeParameter);
            if (eventType != null) {
              if (eventType instanceof PsiClassType && JavaFxPsiUtil.isNotFullyResolvedGeneric((PsiClassType)eventType)) {
                canonicalText=((PsiClassType)eventType).rawType().getCanonicalText();
              }
 else {
                canonicalText=eventType.getCanonicalText();
              }
            }
          }
        }
      }
    }
  }
  return "public void " + element.getValue().substring(1) + "("+ canonicalText+ " e)";
}
