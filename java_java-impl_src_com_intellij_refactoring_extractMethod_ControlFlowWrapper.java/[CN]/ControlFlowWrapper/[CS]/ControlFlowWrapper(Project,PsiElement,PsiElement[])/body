{
  try {
    myControlFlow=ControlFlowFactory.getInstance(project).getControlFlow(codeFragment,new LocalsControlFlowPolicy(codeFragment),false,false);
  }
 catch (  AnalysisCanceledException e) {
    throw new PrepareFailedException(RefactoringBundle.message("extract.method.control.flow.analysis.failed"),e.getErrorElement());
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug(myControlFlow.toString());
  }
  int flowStart=-1;
  int index=0;
  while (index < elements.length) {
    flowStart=myControlFlow.getStartOffset(elements[index]);
    if (flowStart >= 0)     break;
    index++;
  }
  int flowEnd;
  if (flowStart < 0) {
    flowStart=0;
    flowEnd=0;
  }
 else {
    index=elements.length - 1;
    while (true) {
      flowEnd=myControlFlow.getEndOffset(elements[index]);
      if (flowEnd >= 0)       break;
      index--;
    }
  }
  myFlowStart=flowStart;
  myFlowEnd=flowEnd;
  if (LOG.isDebugEnabled()) {
    LOG.debug("start offset:" + myFlowStart);
    LOG.debug("end offset:" + myFlowEnd);
  }
}
