{
  Object obj;
  String className=stub.getClassName();
  try {
    Class<?> aClass=Class.forName(className,true,stub.getLoader());
    obj=ReflectionUtil.newInstance(aClass);
  }
 catch (  ClassNotFoundException e) {
    throw error(stub,e,"class with name ''{0}'' not found",className);
  }
catch (  NoClassDefFoundError e) {
    throw error(stub,e,"class with name ''{0}'' cannot be loaded",className);
  }
catch (  UnsupportedClassVersionError e) {
    throw error(stub,e,"error loading class ''{0}''",className);
  }
catch (  Exception e) {
    throw error(stub,e,"cannot create class ''{0}''",className);
  }
  if (!(obj instanceof AnAction)) {
    throw new IllegalStateException("class with name '" + className + "' must be an instance of '"+ AnAction.class.getName()+ "'; got "+ obj);
  }
  AnAction anAction=(AnAction)obj;
  stub.initAction(anAction);
  if (StringUtil.isNotEmpty(stub.getText())) {
    anAction.getTemplatePresentation().setText(stub.getText());
  }
  String iconPath=stub.getIconPath();
  if (iconPath != null) {
    Class<? extends AnAction> actionClass=anAction.getClass();
    setIconFromClass(actionClass,actionClass.getClassLoader(),iconPath,anAction.getTemplatePresentation(),stub.getPluginId());
  }
  return anAction;
}
