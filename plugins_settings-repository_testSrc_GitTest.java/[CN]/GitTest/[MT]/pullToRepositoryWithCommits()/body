{
  BaseRepositoryManager repositoryManager=getRepositoryManager();
  File remoteRepository=createRemoteRepository(null);
  repositoryManager.setUpstream(remoteRepository.getAbsolutePath(),null);
  byte[] data=FileUtil.loadFileBytes(new File(getTestDataPath(),"crucibleConnector.xml"));
  String addedFile="$APP_CONFIG$/crucibleConnector.xml";
  getProvider().saveContent(addedFile,data,data.length,RoamingType.GLOBAL,false);
  EmptyProgressIndicator progressIndicator=new EmptyProgressIndicator();
  repositoryManager.commit(progressIndicator);
  repositoryManager.pull(progressIndicator);
  assertThat(FileUtil.loadFile(new File(getRepository().getWorkTree(),addedFile)),equalTo(new String(data,CharsetToolkit.UTF8_CHARSET)));
  compareFiles(getRepository().getWorkTree(),remoteRepository,"crucibleConnector.xml");
}
