{
  int width=LEFT_PADDING + RIGHT_PADDING;
  List<Pair<String,LabelIcon>> labels=ContainerUtil.newArrayList();
  if (refGroups.isEmpty())   return Pair.create(labels,width);
  for (  RefGroup group : refGroups) {
    if (group.isExpanded()) {
      for (      VcsRef ref : group.getRefs()) {
        LabelIcon labelIcon=new LabelIcon(height,background,ref.getType().getBackgroundColor());
        String text=shorten ? shortenRefName(ref.getName()) : ref.getName();
        labels.add(Pair.create(text,labelIcon));
        width+=labelIcon.getIconWidth() + fontMetrics.stringWidth(text) + MIDDLE_PADDING;
      }
    }
 else {
      LabelIcon labelIcon=new LabelIcon(height,background,getGroupColors(group));
      String text=shorten ? shortenRefName(group.getName()) : group.getName();
      labels.add(Pair.create(text,labelIcon));
      width+=labelIcon.getIconWidth() + fontMetrics.stringWidth(text) + MIDDLE_PADDING;
    }
  }
  return Pair.create(labels,width);
}
