{
  int width=LEFT_PADDING + RIGHT_PADDING;
  List<Pair<String,LabelIcon>> labels=ContainerUtil.newArrayList();
  if (refGroups.isEmpty())   return Pair.create(labels,width);
  for (  RefGroup group : refGroups) {
    if (group.isExpanded()) {
      for (      VcsRef ref : group.getRefs()) {
        LabelIcon labelIcon=new LabelIcon(height,background,ref.getType().getBackgroundColor());
        width+=labelIcon.getIconWidth() + MIDDLE_PADDING;
        String text=shortenRefName(ref.getName(),fontMetrics,availableWidth - width);
        width+=fontMetrics.stringWidth(text);
        labels.add(Pair.create(text,labelIcon));
      }
    }
 else {
      LabelIcon labelIcon=new LabelIcon(height,background,getGroupColors(group));
      width+=labelIcon.getIconWidth() + MIDDLE_PADDING;
      String text=shortenRefName(group.getName(),fontMetrics,availableWidth - width);
      width+=fontMetrics.stringWidth(text);
      labels.add(Pair.create(text,labelIcon));
    }
  }
  return Pair.create(labels,width);
}
