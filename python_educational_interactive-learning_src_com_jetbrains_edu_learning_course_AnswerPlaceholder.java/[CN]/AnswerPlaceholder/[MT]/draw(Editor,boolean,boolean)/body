{
  Document document=editor.getDocument();
  if (!isValid(document)) {
    return;
  }
  TextAttributes defaultTestAttributes=EditorColorsManager.getInstance().getGlobalScheme().getAttributes(EditorColors.LIVE_TEMPLATE_ATTRIBUTES);
  JBColor color=getColor();
  int startOffset=document.getLineStartOffset(line) + start;
  RangeHighlighter highlighter=editor.getMarkupModel().addRangeHighlighter(startOffset,startOffset + length,HighlighterLayer.LAST + 1,new TextAttributes(defaultTestAttributes.getForegroundColor(),defaultTestAttributes.getBackgroundColor(),color,defaultTestAttributes.getEffectType(),defaultTestAttributes.getFontType()),HighlighterTargetArea.EXACT_RANGE);
  if (drawSelection) {
    editor.getSelectionModel().setSelection(startOffset,startOffset + length);
  }
  if (moveCaret) {
    editor.getCaretModel().moveToOffset(startOffset);
  }
  highlighter.setGreedyToLeft(true);
  highlighter.setGreedyToRight(true);
}
