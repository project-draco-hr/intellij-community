{
  if (file.isDirectory()) {
    return getContentFromDirectory(file,project,prefix);
  }
  String content=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
    @Nullable @Override public String compute(){
      try {
        Document document=FileDocumentManager.getInstance().getDocument(file);
        if (document != null) {
          return document.getText();
        }
 else {
          return new String(file.contentsToByteArray(),file.getCharset());
        }
      }
 catch (      IOException e) {
        LOG.info("Couldn't read contents of the file " + file,e);
        return null;
      }
    }
  }
);
  if (content == null) {
    GithubNotifications.showWarning(project,FAILED_TO_CREATE_GIST,"Couldn't read the contents of the file " + file);
    return Collections.emptyList();
  }
  if (StringUtil.isEmptyOrSpaces(content)) {
    return Collections.emptyList();
  }
  String filename=addPrefix(file.getName(),prefix,false);
  return Collections.singletonList(new FileContent(filename,content));
}
