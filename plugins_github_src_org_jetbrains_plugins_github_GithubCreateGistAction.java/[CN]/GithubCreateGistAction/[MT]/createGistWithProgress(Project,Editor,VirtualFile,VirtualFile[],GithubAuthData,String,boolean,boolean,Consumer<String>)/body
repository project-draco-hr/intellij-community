{
  final AtomicReference<String> url=new AtomicReference<String>();
  new Task.Backgroundable(project,"Creating Gist"){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      List<NamedContent> contents=collectContents(project,editor,file,files);
      if (contents == null) {
        return;
      }
      String gistUrl=createGist(project,auth,anonymous,contents,aPrivate,description);
      url.set(gistUrl);
    }
    @Override public void onSuccess(){
      resultHandler.consume(url.get());
    }
  }
.queue();
}
