{
  final GitHubCreateGistDialog dialog=new GitHubCreateGistDialog(project,editor,file);
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  final GithubAuthData auth=dialog.isAnonymous() ? GithubAuthData.createAnonymous() : getValidAuthData(project);
  if (auth == null) {
    return;
  }
  final Ref<String> url=new Ref<String>();
  new Task.Backgroundable(project,"Creating Gist..."){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      List<FileContent> contents=collectContents(project,editor,file,files);
      String gistUrl=createGist(project,auth,contents,dialog.isPrivate(),dialog.getDescription(),dialog.getFileName());
      url.set(gistUrl);
    }
    @Override public void onSuccess(){
      if (url.isNull()) {
        return;
      }
      if (dialog.isOpenInBrowser()) {
        BrowserUtil.launchBrowser(url.get());
      }
 else {
        GithubNotifications.showInfoURL(project,"Gist Created Successfully","Your gist url",url.get());
      }
    }
  }
.queue();
}
