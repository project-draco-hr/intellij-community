{
  String text=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
    @Nullable @Override public String compute(){
      return editor.getSelectionModel().getSelectedText();
    }
  }
);
  if (text == null) {
    text=editor.getDocument().getText();
  }
  if (StringUtil.isEmptyOrSpaces(text)) {
    return null;
  }
  return text;
}
