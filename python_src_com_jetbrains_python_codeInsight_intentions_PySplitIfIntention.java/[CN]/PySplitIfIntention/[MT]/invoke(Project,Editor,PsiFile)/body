{
  PsiElement elementAtOffset=file.findElementAt(editor.getCaretModel().getOffset());
  final IElementType elementType=elementAtOffset.getNode().getElementType();
  if (elementType == PyTokenTypes.COLON) {
    elementAtOffset=elementAtOffset.getPrevSibling();
    elementAtOffset=PyPsiUtils.getPrevNonCommentSibling(elementAtOffset,false);
  }
 else   if (elementType == PyTokenTypes.IF_KEYWORD) {
    elementAtOffset=elementAtOffset.getNextSibling();
    elementAtOffset=PyPsiUtils.getNextNonCommentSibling(elementAtOffset,false);
  }
  PyBinaryExpression element=PsiTreeUtil.getParentOfType(elementAtOffset,PyBinaryExpression.class,false);
  while (element.getParent() instanceof PyBinaryExpression) {
    element=(PyBinaryExpression)element.getParent();
  }
  PyIfStatement ifStatement=PsiTreeUtil.getParentOfType(element,PyIfStatement.class);
  PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  PyIfStatement subIf=(PyIfStatement)ifStatement.copy();
  subIf.getIfPart().getCondition().replace(element.getRightExpression());
  ifStatement.getIfPart().getCondition().replace(element.getLeftExpression());
  PyStatementList statementList=elementGenerator.createFromText(LanguageLevel.getDefault(),PyIfStatement.class,"if a:\n    a = 1").getIfPart().getStatementList();
  statementList.getStatements()[0].replace(subIf);
  PyIfStatement newIf=elementGenerator.createFromText(LanguageLevel.getDefault(),PyIfStatement.class,"if a:\n    a = 1");
  newIf.getIfPart().getCondition().replace(ifStatement.getIfPart().getCondition());
  newIf.getIfPart().getStatementList().replace(statementList);
  for (  PyIfPart elif : ifStatement.getElifParts())   newIf.add(elif);
  if (ifStatement.getElsePart() != null) {
    newIf.add(ifStatement.getElsePart());
  }
  ifStatement.replace(newIf);
}
