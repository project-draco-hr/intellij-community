{
  final PsiLanguageInjectionHost host=findInjectionHost(editor,file);
  if (host == null)   return;
  if (defaultFunctionalityWorked(host,injectable.getId()))   return;
  try {
    Language language=injectable.toLanguage();
    for (    LanguageInjectionSupport support : InjectorUtils.getActiveInjectionSupports()) {
      if (support.addInjectionInPlace(language,host)) {
        ((PsiModificationTrackerImpl)PsiManager.getInstance(project).getModificationTracker()).incCounter();
        return;
      }
    }
    if (TemporaryPlacesRegistry.getInstance(project).getLanguageInjectionSupport().addInjectionInPlace(language,host)) {
      HintManager.getInstance().showInformationHint(editor,StringUtil.escapeXml(language.getDisplayName()) + " was temporarily injected");
    }
  }
  finally {
    if (injectable.getLanguage() != null) {
      FileContentUtil.reparseFiles(project,Collections.<VirtualFile>emptyList(),true);
    }
 else {
      DaemonCodeAnalyzer.getInstance(project).restart();
    }
  }
}
