{
  Set<Integer> unhiddenNodesRowIndex=parseInts(unhiddenNodeRows);
  MutableGraph graph=GraphTestUtils.getNewMutableGraph(inputGraph);
  ShortFragmentGenerator shortFragmentGenerator=new ShortFragmentGenerator(graph);
  final Set<Node> unhiddenNodes=new HashSet<Node>();
  for (  Integer i : unhiddenNodesRowIndex) {
    unhiddenNodes.add(getCommitNode(graph,i));
  }
  shortFragmentGenerator.setUnhiddenNodes(new Get<Node,Boolean>(){
    @NotNull @Override public Boolean get(    @NotNull Node key){
      return unhiddenNodes.contains(key);
    }
  }
);
  Node commitNode=getCommitNode(graph,rowIndex);
  GraphFragment fragment;
  if (down) {
    fragment=shortFragmentGenerator.getDownShortFragment(commitNode);
  }
 else {
    fragment=shortFragmentGenerator.getUpShortFragment(commitNode);
  }
  Assert.assertEquals(fragmentStr,toStr(fragment));
}
