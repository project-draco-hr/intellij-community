{
  if (file == null) {
    super.reportStubPsiMismatch(psi,file);
    return;
  }
  String msg="Invalid stub element type in index: " + file;
  msg+="; found: " + psi;
  msg+="; file stamp: " + file.getModificationStamp();
  msg+="; file modCount: " + file.getModificationCount();
  Document document=FileDocumentManager.getInstance().getCachedDocument(file);
  if (document != null) {
    msg+="\nsaved: " + !FileDocumentManager.getInstance().isDocumentUnsaved(document);
    msg+="; doc stamp: " + document.getModificationStamp();
    msg+="; committed: " + PsiDocumentManager.getInstance(psi.getProject()).isCommitted(document);
  }
  PsiFile psiFile=psi.getManager().findFile(file);
  if (psiFile != null) {
    msg+="\nviewProvider stamp: " + psiFile.getViewProvider().getModificationStamp();
    if (psiFile instanceof PsiFileImpl) {
      StubTree stub=((PsiFileImpl)psiFile).getStubTree();
      if (stub == null) {
        FileElement treeElement=((PsiFileImpl)psiFile).getTreeElement();
        msg+="; ast loaded: " + (treeElement != null);
        if (treeElement != null) {
          msg+="; ast parsed: " + treeElement.isParsed();
        }
      }
 else {
        msg+="\nstub info=" + stub.getDebugInfo();
      }
    }
  }
  msg+="\nindex stamp: " + IndexingStamp.getIndexStamp(file,StubUpdatingIndex.INDEX_ID);
  msg+="; index creation stamp: " + IndexInfrastructure.getIndexCreationStamp(StubUpdatingIndex.INDEX_ID);
  LOG.error(msg);
}
