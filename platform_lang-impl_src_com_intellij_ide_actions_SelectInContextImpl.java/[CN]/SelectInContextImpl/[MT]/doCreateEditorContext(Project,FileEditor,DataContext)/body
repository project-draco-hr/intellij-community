{
  if (project == null || editor == null) {
    return null;
  }
  VirtualFile file=FileEditorManagerEx.getInstanceEx(project).getFile(editor);
  if (file == null) {
    file=dataContext == null ? null : PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
    if (file == null) {
      return null;
    }
  }
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (psiFile == null) {
    return null;
  }
  if (editor instanceof TextEditor) {
    return new TextEditorContext((TextEditor)editor,psiFile);
  }
 else {
    return new SimpleSelectInContext(psiFile);
  }
}
