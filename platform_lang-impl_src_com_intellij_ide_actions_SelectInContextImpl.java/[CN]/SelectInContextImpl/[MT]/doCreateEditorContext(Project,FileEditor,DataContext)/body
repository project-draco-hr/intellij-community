{
  if (project == null || editor == null) {
    return null;
  }
  VirtualFile file=FileEditorManagerEx.getInstanceEx(project).getFile(editor);
  if (file == null) {
    file=dataContext == null ? null : CommonDataKeys.VIRTUAL_FILE.getData(dataContext);
    if (file == null) {
      return null;
    }
  }
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (psiFile == null) {
    return null;
  }
  if (editor instanceof TextEditor) {
    return new TextEditorContext((TextEditor)editor,psiFile);
  }
 else {
    StructureViewBuilder builder=editor.getStructureViewBuilder();
    StructureView structureView=builder != null ? builder.createStructureView(editor,project) : null;
    Object selectorInFile=structureView != null ? structureView.getTreeModel().getCurrentEditorElement() : null;
    if (structureView != null)     Disposer.dispose(structureView);
    return new SimpleSelectInContext(psiFile,ObjectUtils.chooseNotNull(selectorInFile,psiFile));
  }
}
