{
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  if (texts.getLocal() == null || document == null)   return ApplyPatchStatus.FAILURE;
  final String fullPath=file.getParent() == null ? file.getPath() : file.getParent().getPath();
  final String windowTitle="Result Of Patch Apply To " + file.getName() + " ("+ fullPath+ ")";
  final Ref<Boolean> successRef=new Ref<Boolean>();
  Consumer<MergeResult> callback=new Consumer<MergeResult>(){
    @Override public void consume(    MergeResult result){
      FileDocumentManager.getInstance().saveDocument(document);
      successRef.set(true);
    }
  }
;
  MergeRequest request=new ApplyPatchMergeRequest(project,document,file,texts.getLocal().toString(),texts.getPatched(),windowTitle,VcsBundle.message("diff.title.local"),"Patched (with problems)",callback);
  DiffManager.getInstance().showMerge(project,request);
  return successRef.get() == Boolean.TRUE ? ApplyPatchStatus.SUCCESS : ApplyPatchStatus.FAILURE;
}
