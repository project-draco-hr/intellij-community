{
  final Module module=ModuleUtilCore.findModuleForFile(dir,project);
  if (module == null) {
    LOG.info("Module for " + dir.getPath() + " was not found");
    return;
  }
  final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
  final ContentEntry entry=MarkRootActionBase.findContentEntry(model,dir);
  if (entry == null) {
    LOG.info("Content entry for " + dir.getPath() + " was not found");
    return;
  }
  entry.addSourceFolder(dir,false);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      model.commit();
      module.getProject().save();
    }
  }
);
}
