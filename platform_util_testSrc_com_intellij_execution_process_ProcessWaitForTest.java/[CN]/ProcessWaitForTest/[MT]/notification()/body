{
  File jvm=new File(System.getProperty("java.home"),"bin/java");
  assertTrue(jvm.canExecute());
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  Process process=new ProcessBuilder(jvm.getPath(),"-version").redirectErrorStream(true).start();
  ProcessWaitFor.attach(process,new Consumer<Integer>(){
    @Override public void consume(    Integer exitCode){
      semaphore.up();
    }
  }
);
  process.waitFor();
  assertTrue(semaphore.waitFor(5000));
}
