{
  if (SystemInfo.isMac) {
    if (new File("/usr/libexec/java_home").canExecute()) {
      String path=ExecUtil.execAndReadLine(new GeneralCommandLine("/usr/libexec/java_home"));
      if (path != null && new File(path).isDirectory()) {
        return path;
      }
    }
    String home=checkKnownLocations("/Library/Java/JavaVirtualMachines","/System/Library/Java/JavaVirtualMachines");
    if (home != null)     return home;
  }
  if (SystemInfo.isLinux) {
    String home=checkKnownLocations("/usr/java","/opt/java","/usr/lib/jvm");
    if (home != null)     return home;
  }
  if (SystemInfo.isSolaris) {
    String home=checkKnownLocations("/usr/jdk");
    if (home != null)     return home;
  }
  String property=System.getProperty("java.home");
  if (property != null) {
    File javaHome=new File(property);
    if (javaHome.getName().equals("jre")) {
      javaHome=javaHome.getParentFile();
    }
    if (javaHome != null && javaHome.isDirectory()) {
      return javaHome.getAbsolutePath();
    }
  }
  return null;
}
