{
  final Object source=getSource();
  ArrayList<Language> items=new ArrayList<Language>();
  if (source instanceof LanguageFileType) {
    final Language baseLang=((LanguageFileType)source).getLanguage();
    items.add(baseLang);
    Language[] dialects=LanguageUtil.getLanguageDialects(baseLang);
    Arrays.sort(dialects,LanguageUtil.LANGUAGE_COMPARATOR);
    items.addAll(Arrays.asList(dialects));
  }
  myDialectComboBox.setModel(new CollectionComboBoxModel<Language>(items));
  boolean visible=items.size() > 1;
  myDialectLabel.setVisible(visible);
  myDialectComboBox.setVisible(visible);
  if (visible && (myExternalDocument || lastUsed != null)) {
    VirtualFile file=myExternalDocument ? FileDocumentManager.getInstance().getFile(myEditor.getDocument()) : null;
    Language curLanguage=LanguageUtil.getLanguageForPsi(myProject,file);
    int idx=items.indexOf(curLanguage);
    myDialectComboBox.setSelectedIndex(idx >= 0 ? idx : 0);
  }
}
