{
  super(project,true);
  myFile=file;
  myProject=project;
  myDirectory=directory;
  myTextSelected=isTextSelected;
  myOptimizeImportProcessorsForFileLanguageExists=myFile != null && !LanguageImportStatements.INSTANCE.forFile(myFile).isEmpty();
  myRearrangerProcessorsForFileLanguageExists=myFile != null && Rearranger.EXTENSION.forLanguage(myFile.getLanguage()) != null;
  myFileHasChanges=myFile != null && FormatChangedTextUtil.hasChanges(myFile);
  if (myFile != null)   myCommonSettings=CodeStyleSettingsManager.getSettings(myProject).getCommonSettings(myFile.getLanguage());
  myRearrangeAlwaysEnabled=myCommonSettings != null && myCommonSettings.isForceArrangeMenuAvailable() && myCommonSettings.FORCE_REARRANGE_MODE == CommonCodeStyleSettings.REARRANGE_ALWAYS;
  setOKButtonText(CodeInsightBundle.message("reformat.code.accept.button.text"));
  setTitle(title);
  init();
  myHelpId=helpId;
}
