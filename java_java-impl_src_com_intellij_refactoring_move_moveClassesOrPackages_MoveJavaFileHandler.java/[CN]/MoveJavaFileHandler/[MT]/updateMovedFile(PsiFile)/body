{
  ChangeContextUtil.decodeContextInfo(file,null,null);
  final PsiDirectory containingDirectory=file.getContainingDirectory();
  if (containingDirectory != null) {
    final PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(containingDirectory);
    if (aPackage != null) {
      final String qualifiedName=aPackage.getQualifiedName();
      final PsiNameHelper helper=PsiNameHelper.getInstance(file.getProject());
      final PsiPackageStatement packageStatement=!StringUtil.isEmptyOrSpaces(qualifiedName) && helper.isQualifiedName(qualifiedName) ? JavaPsiFacade.getElementFactory(file.getProject()).createPackageStatement(qualifiedName) : null;
      if (file instanceof PsiJavaFile) {
        final PsiPackageStatement filePackageStatement=((PsiJavaFile)file).getPackageStatement();
        if (filePackageStatement != null) {
          if (packageStatement != null) {
            filePackageStatement.getPackageReference().replace(packageStatement.getPackageReference());
          }
 else {
            filePackageStatement.delete();
          }
        }
      }
    }
  }
}
