{
  final GroovyConsoleStateService projectConsole=GroovyConsoleStateService.getInstance(project);
  final Module module=projectConsole.getSelectedModule(file);
  if (module == null || module.isDisposed())   return null;
  final GlobalSearchScope moduleScope=GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(module);
  if (!GroovyConsoleUtil.hasGroovyAll(module)) {
    final List<VirtualFile> bundledGroovyJarRoots=GroovyBundledClassFinder.getBundledGroovyJarRoots();
    if (!bundledGroovyJarRoots.isEmpty()) {
      return new NonClasspathDirectoriesScope(bundledGroovyJarRoots).uniteWith(moduleScope);
    }
  }
  return moduleScope;
}
