{
  final int offset=editor.getCaretModel().getOffset();
  final PsiElement element=file.findElementAt(offset);
  if (element == null || element instanceof PsiWhiteSpace) {
    return false;
  }
  final PsiReference reference=file.findReferenceAt(offset);
  final FileReference fileReference=reference == null ? null : FileReference.findFileReference(reference);
  if (fileReference != null) {
    final FileReferenceSet set=fileReference.getFileReferenceSet();
    final FileReference lastReference=set.getLastReference();
    return set.couldBeConvertedTo(isConvertToRelative()) && lastReference != null && (!isConvertToRelative() && !set.isAbsolutePathReference() || isConvertToRelative() && set.isAbsolutePathReference()) && lastReference.resolve() != null;
  }
  return false;
}
