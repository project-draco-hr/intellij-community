{
  final Ref<Boolean> accepted=Ref.create(false);
  final X509Certificate certificate=certificates[0];
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      int res=Messages.showOkCancelDialog(String.format("<html>The following server's certificate is unknown: <pre>%s<pre></br>Add to trust storage?</html>",formatX509Certificate(certificate)),"Unknown Server's Certificate",AllIcons.General.WarningDialog);
      accepted.set(res == Messages.OK);
    }
  }
,ModalityState.any());
  if (accepted.get()) {
    LOG.debug("Certificate was accepted");
    return myCustomManager.addCertificate(certificate);
  }
  return false;
}
