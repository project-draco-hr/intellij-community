{
  int unsafeBlockSize=getFirstSafeIndex(savedLog,firstBlock,newRefs);
  if (unsafeBlockSize == -1) {
    throw new IllegalStateException();
  }
  List<TimeCommitParents> unsafePartSavedLog=new ArrayList<TimeCommitParents>(savedLog.subList(0,unsafeBlockSize));
  Set<TimeCommitParents> allNewsCommits=getAllNewCommits(unsafePartSavedLog,firstBlock);
  unsafePartSavedLog=new NewCommitIntegrator(unsafePartSavedLog,allNewsCommits).getResultList();
  return Pair.create(ContainerUtil.concat(unsafePartSavedLog,savedLog.subList(unsafeBlockSize,savedLog.size())),allNewsCommits.size());
}
