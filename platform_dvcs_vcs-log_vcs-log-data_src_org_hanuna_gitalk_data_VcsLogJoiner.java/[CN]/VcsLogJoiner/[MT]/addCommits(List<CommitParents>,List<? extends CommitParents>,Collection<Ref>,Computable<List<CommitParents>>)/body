{
  int unsafeBlockSize=getFirstSafeIndex(savedLog,firstBlock,refs);
  if (unsafeBlockSize == -1) {
    savedLog=wholeLogGetter.compute();
    unsafeBlockSize=getFirstSafeIndex(savedLog,firstBlock,refs);
  }
  if (unsafeBlockSize == -1) {
    throw new IllegalStateException();
  }
  List<CommitParents> unsafePartSavedLog=new ArrayList<CommitParents>(savedLog.subList(0,unsafeBlockSize));
  Set<CommitParents> allNewsCommits=getAllNewCommits(unsafePartSavedLog,firstBlock);
  unsafePartSavedLog=new NewCommitIntegrator(unsafePartSavedLog,allNewsCommits).getResultList();
  return firstBlock;
}
