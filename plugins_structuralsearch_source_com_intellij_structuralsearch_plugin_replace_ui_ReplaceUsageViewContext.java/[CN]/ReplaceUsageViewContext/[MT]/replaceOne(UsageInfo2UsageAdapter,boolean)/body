{
  ReplacementInfo replacementInfo=usage2ReplacementInfo.get(info);
  boolean approved;
  if (doConfirm) {
    ReplacementPreviewDialog wrapper=new ReplacementPreviewDialog(mySearchContext.getProject(),info.getUsageInfo(),replacementInfo.getReplacement());
    wrapper.show();
    approved=wrapper.isOK();
  }
 else {
    approved=true;
  }
  if (approved) {
    ensureFileWritable(info);
    getUsageView().removeUsage(info);
    getReplacer().replace(replacementInfo);
    if (getUsageView().getUsagesCount() == 0) {
      getUsageView().close();
    }
  }
}
