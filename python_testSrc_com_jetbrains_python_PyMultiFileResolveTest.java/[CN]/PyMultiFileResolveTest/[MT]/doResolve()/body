{
  PsiFile psiFile=prepareFile();
  int offset=findMarkerOffset(psiFile);
  final PsiPolyVariantReference ref=(PsiPolyVariantReference)psiFile.findReferenceAt(offset);
  assertNotNull("<ref> in test file not found",ref);
  final PsiManagerImpl psiManager=(PsiManagerImpl)myFixture.getPsiManager();
  psiManager.setAssertOnFileLoadingFilter(new VirtualFileFilter(){
    @Override public boolean accept(    VirtualFile file){
      FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
      return fileType == PythonFileType.INSTANCE;
    }
  }
);
  try {
    final ResolveResult[] resolveResults=ref.multiResolve(false);
    if (resolveResults.length == 0) {
      return null;
    }
    return resolveResults[0].isValidResult() ? resolveResults[0].getElement() : null;
  }
  finally {
    psiManager.setAssertOnFileLoadingFilter(VirtualFileFilter.NONE);
  }
}
