{
  myFixture.configureByFile(getTestName(true) + ".py");
  final PyMakeFunctionTopLevelRefactoring action=new PyMakeFunctionTopLevelRefactoring();
  final TestActionEvent event=new TestActionEvent(action);
  action.beforeActionPerformedUpdate(event);
  assertEquals(enabled,event.getPresentation().isEnabledAndVisible());
  if (enabled) {
    try {
      action.actionPerformed(event);
      myFixture.checkResultByFile(getTestName(true) + ".after.py");
    }
 catch (    IncorrectOperationException e) {
      if (message == null) {
        fail("Refactoring failed unexpectedly with message: " + e.getMessage());
      }
      assertEquals(message,e.getMessage());
    }
  }
}
