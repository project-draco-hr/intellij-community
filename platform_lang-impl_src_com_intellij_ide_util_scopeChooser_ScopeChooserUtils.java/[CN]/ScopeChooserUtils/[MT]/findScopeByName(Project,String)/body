{
  NamedScope namedScope=scopeName == null ? null : ChangeListsScopesProvider.getInstance(project).getCustomScope(scopeName);
  if (namedScope == null) {
    namedScope=NamedScopesHolder.getScope(project,scopeName);
  }
  if (namedScope == null) {
    namedScope=new ProjectFilesScope();
  }
  GlobalSearchScope scope=GlobalSearchScopesCore.filterScope(project,namedScope);
  boolean restrictedToProject=namedScope instanceof ProjectFilesScope || namedScope instanceof ProjectProductionScope;
  if (!restrictedToProject) {
    scope=scope.intersectWith(ProjectScope.getContentScope(project));
  }
  return scope;
}
