{
  List<TargetTypeBuildScope> scopes=new ArrayList<TargetTypeBuildScope>();
  for (  JavaModuleBuildTargetType type : JavaModuleBuildTargetType.ALL_TYPES) {
    if (includeTests || !type.isTests()) {
      TargetTypeBuildScope.Builder builder=TargetTypeBuildScope.newBuilder().setTypeId(type.getTypeId()).setForceBuild(forceBuild);
      if (allModules) {
        scopes.add(builder.setAllTargets(true).build());
      }
 else       if (!modulesSet.isEmpty()) {
        scopes.add(builder.addAllTargetId(modulesSet).build());
      }
    }
  }
  TargetTypeBuildScope.Builder builder=TargetTypeBuildScope.newBuilder().setTypeId(ArtifactBuildTargetType.INSTANCE.getTypeId()).setForceBuild(forceBuild);
  if (allArtifacts) {
    scopes.add(builder.setAllTargets(true).build());
  }
 else   if (!artifactsList.isEmpty()) {
    scopes.add(builder.addAllTargetId(artifactsList).build());
  }
  runBuild(loader,dataStorageRoot,messageHandler,scopes,true);
}
