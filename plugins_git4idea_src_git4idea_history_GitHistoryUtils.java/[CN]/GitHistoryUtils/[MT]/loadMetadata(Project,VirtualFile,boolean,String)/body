{
  final VcsLogObjectsFactory factory=getObjectsFactoryWithDisposeCheck(project);
  if (factory == null) {
    return LogDataImpl.empty();
  }
  final Set<VcsRef> refs=new OpenTHashSet<VcsRef>(GitLogProvider.REF_ONLY_NAME_STRATEGY);
  final List<VcsCommitMetadata> commits=loadDetails(project,root,withRefs,false,new NullableFunction<GitLogRecord,VcsCommitMetadata>(){
    @Nullable @Override public VcsCommitMetadata fun(    GitLogRecord record){
      GitCommit commit=createCommit(project,root,record,factory);
      if (withRefs) {
        Collection<VcsRef> refsInRecord=parseRefs(record.getRefs(),commit.getId(),factory,root);
        for (        VcsRef ref : refsInRecord) {
          if (!refs.add(ref)) {
            LOG.error("Adding duplicate element to the set");
          }
        }
      }
      return commit;
    }
  }
,params);
  return new LogDataImpl(refs,commits);
}
