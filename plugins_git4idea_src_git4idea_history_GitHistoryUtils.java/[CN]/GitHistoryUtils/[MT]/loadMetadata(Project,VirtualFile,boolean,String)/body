{
  final VcsLogObjectsFactory factory=getObjectsFactoryWithDisposeCheck(project);
  if (factory == null) {
    return LogDataImpl.empty();
  }
  final Set<VcsRef> refs=ContainerUtil.newHashSet();
  final List<VcsCommitMetadata> commits=loadDetails(project,root,withRefs,false,new NullableFunction<GitLogRecord,VcsCommitMetadata>(){
    @Nullable @Override public VcsCommitMetadata fun(    GitLogRecord record){
      GitCommit commit=createCommit(project,root,record,factory);
      if (withRefs) {
        refs.addAll(parseRefs(record.getRefs(),commit.getId(),factory,root));
      }
      return commit;
    }
  }
,params);
  return new LogDataImpl(refs,commits);
}
