{
  GitLogParser.NameStatus status=withChanges ? GitLogParser.NameStatus.STATUS : GitLogParser.NameStatus.NONE;
  GitLogParser.GitLogOption[] options={HASH,COMMIT_TIME,AUTHOR_NAME,AUTHOR_TIME,AUTHOR_EMAIL,COMMITTER_NAME,COMMITTER_EMAIL,PARENTS,SUBJECT,BODY,RAW_BODY};
  if (withRefs) {
    options=ArrayUtil.append(options,REF_NAMES);
  }
  GitLogParser parser=new GitLogParser(project,status,options);
  h.setStdoutSuppressed(true);
  h.addParameters(parameters);
  h.addParameters(parser.getPretty(),"--encoding=UTF-8");
  if (withRefs) {
    h.addParameters("--decorate=full");
  }
  if (withChanges) {
    h.addParameters("-M","--name-status","-c");
  }
  h.endOptions();
  return parser;
}
