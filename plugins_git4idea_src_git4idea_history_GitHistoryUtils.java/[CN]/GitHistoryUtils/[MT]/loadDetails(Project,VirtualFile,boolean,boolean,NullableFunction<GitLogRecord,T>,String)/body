{
  GitSimpleHandler h=new GitSimpleHandler(project,root,GitCommand.LOG);
  GitLogParser.NameStatus status=withChanges ? GitLogParser.NameStatus.STATUS : GitLogParser.NameStatus.NONE;
  GitLogParser.GitLogOption[] options={HASH,COMMIT_TIME,AUTHOR_NAME,AUTHOR_TIME,AUTHOR_EMAIL,COMMITTER_NAME,COMMITTER_EMAIL,PARENTS,SUBJECT,BODY,RAW_BODY,ENCODING};
  if (withRefs) {
    options=ArrayUtil.append(options,REF_NAMES);
  }
  GitLogParser parser=new GitLogParser(project,status,options);
  h.setStdoutSuppressed(true);
  h.addParameters(parameters);
  h.addParameters(parser.getPretty(),"--encoding=UTF-8");
  if (withRefs) {
    h.addParameters("--decorate=full");
  }
  if (withChanges) {
    h.addParameters("-M","--name-status","-c");
  }
  h.endOptions();
  StopWatch sw=StopWatch.start("loading details");
  String output=h.run();
  sw.report();
  sw=StopWatch.start("parsing");
  List<GitLogRecord> records=parser.parse(output);
  sw.report();
  sw=StopWatch.start("Creating objects");
  List<T> commits=ContainerUtil.mapNotNull(records,converter);
  sw.report();
  return commits;
}
