{
  ShutDownTracker.getInstance().registerStopperThread(Thread.currentThread());
  try {
    stateStore.save(new SmartList<Pair<SaveSession,VirtualFile>>());
  }
 catch (  Throwable e) {
    PluginId pluginId=IdeErrorsDialog.findPluginId(e);
    if (pluginId == null) {
      if (e instanceof RuntimeException) {
        throw ((RuntimeException)e);
      }
 else {
        throw new StateStorageException(e);
      }
    }
 else {
      throw new PluginException(e,pluginId);
    }
  }
 finally {
    ShutDownTracker.getInstance().unregisterStopperThread(Thread.currentThread());
  }
}
