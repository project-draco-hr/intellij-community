{
  PlaceInDocument place=getPlace(project,event);
  if (place == null) {
    return;
  }
  Editor editor=event.getData(CommonDataKeys.EDITOR);
  ExpandRegionAction.expandRegionAtCaret(project,editor);
  Document document=place.getDocument();
  int line=document.getLineNumber(place.getOffset());
  if (editor != null && editor.getCaretModel().getVisualPosition().line != line) {
    editor.getCaretModel().moveToOffset(place.getOffset());
  }
  DebuggerManagerEx debugManager=DebuggerManagerEx.getInstanceEx(project);
  if (debugManager == null) {
    return;
  }
  BreakpointManager manager=debugManager.getBreakpointManager();
  final Breakpoint breakpoint=manager.findBreakpoint(document,place.getOffset(),LineBreakpoint.CATEGORY);
  if (breakpoint == null) {
    LineBreakpoint lineBreakpoint=manager.addLineBreakpoint(document,line);
    if (lineBreakpoint != null) {
      lineBreakpoint.REMOVE_AFTER_HIT=myTemporary;
      RequestManagerImpl.createRequests(lineBreakpoint);
    }
  }
 else {
    if (!breakpoint.REMOVE_AFTER_HIT && myTemporary) {
      breakpoint.REMOVE_AFTER_HIT=true;
      breakpoint.updateUI();
    }
 else {
      manager.removeBreakpoint(breakpoint);
    }
  }
}
