{
  final LocalTask defaultTask=myTaskManager.getLocalTasks().get(0);
  Task task=myRepository.findTask("TEST-001");
  assertNotNull(task);
  myTaskManager.activateTask(task,false);
  assertEquals(2,myTaskManager.getLocalTasks().size());
  LocalTask localTask=myTaskManager.getActiveTask();
  assertEquals(task,localTask);
  assertEquals(0,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(1,myChangeListManager.getChangeListsCopy().size());
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(myChangeListManager.getChangeListsCopy().get(0)));
  myTaskManager.activateTask(defaultTask,false);
  assertEquals(0,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(1,myChangeListManager.getChangeListsCopy().size());
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(myChangeListManager.getChangeListsCopy().get(0)));
  activateAndCreateChangelist(localTask);
  assertEquals(1,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(2,myChangeListManager.getChangeListsCopy().size());
  LocalChangeList activeChangeList=myChangeListManager.getDefaultChangeList();
  LocalChangeList anotherChangeList=myChangeListManager.getChangeListsCopy().get(1 - myChangeListManager.getChangeListsCopy().indexOf(activeChangeList));
  assertNotNull(activeChangeList);
  assertEquals(localTask,myTaskManager.getAssociatedTask(activeChangeList));
  assertEquals("TEST-001 Summary",activeChangeList.getName());
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(anotherChangeList));
  assertEquals(LocalChangeList.DEFAULT_NAME,anotherChangeList.getName());
  myTaskManager.activateTask(defaultTask,false);
  myChangeListManager.waitUntilRefreshed();
  assertEquals(1,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(2,myChangeListManager.getChangeListsCopy().size());
  activeChangeList=myChangeListManager.getDefaultChangeList();
  anotherChangeList=myChangeListManager.getChangeListsCopy().get(1 - myChangeListManager.getChangeListsCopy().indexOf(activeChangeList));
  assertNotNull(activeChangeList);
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(activeChangeList));
  assertEquals(LocalChangeList.DEFAULT_NAME,activeChangeList.getName());
  assertEquals(localTask,myTaskManager.getAssociatedTask(anotherChangeList));
  assertEquals("TEST-001 Summary",anotherChangeList.getName());
}
