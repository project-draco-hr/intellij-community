{
  if (pyPackage.getParent() == null) {
    return;
  }
  final VirtualFile parentDirVFile=pyPackage.getParent().getVirtualFile();
  final PsiFile initPy=pyPackage.findFile(PyNames.INIT_DOT_PY);
  final String moduleName=pyPackage.getName() + PyNames.DOT_PY;
  WriteCommandAction.runWriteCommandAction(project,new Runnable(){
    public void run(){
      try {
        if (initPy != null) {
          final VirtualFile initPyVFile=initPy.getVirtualFile();
          initPyVFile.rename(this,moduleName);
          initPyVFile.move(this,parentDirVFile);
        }
 else {
          PyUtil.getOrCreateFile(parentDirVFile.getPath() + "/" + moduleName,project);
        }
        pyPackage.getVirtualFile().delete(this);
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
  }
);
}
