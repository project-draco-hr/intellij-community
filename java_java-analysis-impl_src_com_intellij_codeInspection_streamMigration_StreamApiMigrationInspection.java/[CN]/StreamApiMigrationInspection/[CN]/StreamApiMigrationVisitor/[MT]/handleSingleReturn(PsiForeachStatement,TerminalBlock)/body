{
  PsiReturnStatement returnStatement=(PsiReturnStatement)tb.getSingleStatement();
  PsiExpression value=returnStatement.getReturnValue();
  PsiReturnStatement nextReturnStatement=getNextReturnStatement(statement);
  if (nextReturnStatement != null && (ExpressionUtils.isLiteral(value,Boolean.TRUE) || ExpressionUtils.isLiteral(value,Boolean.FALSE))) {
    boolean foundResult=(boolean)((PsiLiteralExpression)value).getValue();
    String methodName;
    if (foundResult) {
      methodName="anyMatch";
    }
 else {
      methodName="noneMatch";
      Operation lastOp=tb.getLastOperation();
      if (lastOp instanceof FilterOp && (((FilterOp)lastOp).isNegated() ^ BoolUtils.isNegation(lastOp.getExpression()))) {
        methodName="allMatch";
      }
    }
    if (nextReturnStatement.getParent() == statement.getParent() || ExpressionUtils.isLiteral(nextReturnStatement.getReturnValue(),!foundResult)) {
      registerProblem(statement,methodName,new ReplaceWithMatchFix(methodName));
      return;
    }
  }
  if (!isVariableReferenced(tb.getVariable(),value)) {
    Operation lastOp=tb.getLastOperation();
    if (!REPLACE_TRIVIAL_FOREACH && lastOp == null || (lastOp instanceof FilterOp && lastOp.getPreviousOp() == null))     return;
    registerProblem(statement,"anyMatch",new ReplaceWithMatchFix("anyMatch"));
  }
  if (nextReturnStatement != null && ExpressionUtils.isSimpleExpression(nextReturnStatement.getReturnValue()) && (!(tb.getVariable().getType() instanceof PsiPrimitiveType) || isIdentityMapping(tb.getVariable(),value))) {
    registerProblem(statement,"findFirst",new ReplaceWithFindFirstFix());
  }
}
