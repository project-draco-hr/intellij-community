{
  CreateVirtualEnvDialog.VirtualEnvCallback callback=new CreateVirtualEnvDialog.VirtualEnvCallback(){
    @Override public void virtualEnvCreated(    Sdk sdk,    boolean associateWithProject){
      PythonSdkType.setupSdkPaths(sdk,myProject,null);
      if (associateWithProject) {
        SdkAdditionalData additionalData=sdk.getSdkAdditionalData();
        if (additionalData == null) {
          additionalData=new PythonSdkAdditionalData(PythonSdkFlavor.getFlavor(sdk.getHomePath()));
          ((ProjectJdkImpl)sdk).setSdkAdditionalData(additionalData);
        }
        ((PythonSdkAdditionalData)additionalData).associateWithProject(myProject);
      }
      myCallback.consume(sdk);
    }
  }
;
  final CreateVirtualEnvDialog dialog;
  final List<Sdk> allSdks=Arrays.asList(myExistingSdks);
  if (myProject != null) {
    dialog=new CreateVirtualEnvDialog(myProject,allSdks,null);
  }
 else {
    dialog=new CreateVirtualEnvDialog(myOwnerComponent,allSdks,null);
  }
  dialog.show();
  if (dialog.isOK()) {
    dialog.createVirtualEnv(allSdks,callback);
  }
}
