{
  Application app=ApplicationManager.getApplication();
  myLegalNoticeAccepted=app.isUnitTestMode() || PropertiesComponent.getInstance().isValueSet(LEGAL_NOTICE_KEY);
  if (!myLegalNoticeAccepted) {
    MessageBusConnection connection=app.getMessageBus().connect(app);
    connection.subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new FileEditorManagerAdapter(){
      @Override public void fileOpened(      @NotNull FileEditorManager source,      @NotNull VirtualFile file){
        if (file.getFileType() == StdFileTypes.CLASS) {
          FileEditor editor=source.getSelectedEditor(file);
          if (editor instanceof TextEditor) {
            CharSequence text=((TextEditor)editor).getEditor().getDocument().getImmutableCharSequence();
            if (StringUtil.startsWith(text,BANNER)) {
              showLegalNotice(source.getProject(),file);
            }
          }
        }
      }
    }
);
  }
}
