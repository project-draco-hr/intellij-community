{
  if (expression instanceof PsiReferenceExpression) {
    PsiReferenceExpression referenceExpression=(PsiReferenceExpression)expression;
    if (!referenceExpression.isQualified()) {
      PsiElement resolved=referenceExpression.resolve();
      if (resolved instanceof PsiLocalVariable || resolved instanceof PsiParameter) {
        if (((PsiVariable)resolved).hasModifierProperty(PsiModifier.FINAL)) {
          return true;
        }
        for (        Instruction instruction : flow.getInstructions()) {
          if (instruction instanceof WriteVariableInstruction && ((WriteVariableInstruction)instruction).variable == resolved) {
            return false;
          }
        }
        return true;
      }
    }
  }
  return false;
}
