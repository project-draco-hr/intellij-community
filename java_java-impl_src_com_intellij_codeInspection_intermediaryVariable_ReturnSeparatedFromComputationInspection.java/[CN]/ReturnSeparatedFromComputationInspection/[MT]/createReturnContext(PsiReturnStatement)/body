{
  final PsiElement returnParent=returnStatement.getParent();
  if (returnParent instanceof PsiCodeBlock) {
    final PsiCodeBlock returnScope=(PsiCodeBlock)returnParent;
    final PsiStatement[] statements=returnScope.getStatements();
    if (statements.length != 0 && statements[statements.length - 1] == returnStatement) {
      PsiStatement refactoredStatement=getPrevNonEmptyStatement(returnStatement,new THashSet<>());
      if (refactoredStatement != null) {
        final PsiExpression returnValue=returnStatement.getReturnValue();
        if (returnValue instanceof PsiReferenceExpression) {
          final PsiElement resolved=((PsiReferenceExpression)returnValue).resolve();
          if (resolved instanceof PsiVariable) {
            final PsiVariable returnedVariable=(PsiVariable)resolved;
            final PsiCodeBlock variableScope=getVariableScopeBlock(returnedVariable);
            if (variableScope != null) {
              return new ReturnContext(returnStatement,returnScope,refactoredStatement,returnedVariable,variableScope);
            }
          }
        }
      }
    }
  }
  return null;
}
