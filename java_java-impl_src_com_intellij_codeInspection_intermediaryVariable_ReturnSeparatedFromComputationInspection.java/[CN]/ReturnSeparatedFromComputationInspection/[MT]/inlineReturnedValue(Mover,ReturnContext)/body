{
  List<Instruction> instructions=mover.flow.getInstructions();
  PsiAssignmentExpression assignment=null;
  for (int i=0; i < instructions.size(); i++) {
    Instruction instruction=instructions.get(i);
    if (instruction instanceof WriteVariableInstruction && ((WriteVariableInstruction)instruction).variable == mover.resultVariable) {
      PsiElement element=mover.flow.getElement(i);
      PsiElement parent=element.getParent();
      if (element instanceof PsiAssignmentExpression && parent instanceof PsiExpressionStatement) {
        if (!mover.replaceInline.contains(element)) {
          if (assignment != null) {
            return;
          }
          assignment=(PsiAssignmentExpression)element;
        }
      }
 else       if (!(getNearestEnclosingStatement(element) instanceof PsiDeclarationStatement)) {
        return;
      }
    }
  }
  PsiExpression localInitializer=context.returnedVariable instanceof PsiLocalVariable ? context.returnedVariable.getInitializer() : null;
  if (assignment != null && localInitializer == null) {
    PsiExpression rExpression=assignment.getRExpression();
    replaceReturnedValue(rExpression,context.returnStatement,mover.flow);
  }
 else   if (assignment == null && localInitializer != null) {
    replaceReturnedValue(localInitializer,context.returnStatement,mover.flow);
  }
}
