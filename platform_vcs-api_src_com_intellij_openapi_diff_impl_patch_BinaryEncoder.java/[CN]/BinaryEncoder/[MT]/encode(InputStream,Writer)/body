{
  int maxLineSize=52;
  byte[] deflated=new byte[maxLineSize];
  try (DeflaterInputStream deflaterStream=new DeflaterInputStream(input)){
    int lineSize;
    do {
      lineSize=deflaterStream.read(deflated,0,maxLineSize);
      if (lineSize <= 0)       break;
      writer.append(getCharForLineSize(lineSize));
      int newSize=((lineSize + 3) / 4) * 4;
      Arrays.fill(deflated,lineSize,newSize,(byte)0);
      writer.append(new String(Base85x.encode(deflated,newSize)));
      writer.append('\n');
    }
 while (lineSize > 0);
  }
 catch (  Base85x.Base85FormatException e) {
    throw new BinaryPatchException(e);
  }
}
