{
  super(null,cause);
  myElementReference=new SoftReference<PsiElement>(element);
  if (element == null) {
    myMessage=message;
    myDiagnostic=Attachment.EMPTY_ARRAY;
  }
 else   if (element == PsiUtilCore.NULL_PSI_ELEMENT) {
    myMessage="NULL_PSI_ELEMENT ;" + message;
    myDiagnostic=Attachment.EMPTY_ARRAY;
  }
 else {
    boolean recursiveInvocation=Boolean.TRUE.equals(element.getUserData(REPORTING_EXCEPTION));
    element.putUserData(REPORTING_EXCEPTION,Boolean.TRUE);
    try {
      Object trace=recursiveInvocation ? null : getPsiInvalidationTrace(element);
      myMessage=getMessageWithReason(element,message,recursiveInvocation,trace);
      if (trace == null) {
        myDiagnostic=Attachment.EMPTY_ARRAY;
      }
 else {
        myDiagnostic=new Attachment[]{trace instanceof Throwable ? new Attachment("invalidation",(Throwable)trace) : new Attachment("diagnostic.txt",trace.toString())};
      }
    }
  finally {
      element.putUserData(REPORTING_EXCEPTION,null);
    }
  }
}
