{
  if (ApplicationManagerEx.getApplicationEx().isDoNotSave()) {
    return;
  }
  if (!mySavingInProgress.compareAndSet(false,true)) {
    return;
  }
  try {
    if (isToSaveProjectName()) {
      try {
        String basePath=getStateStore().getProjectBasePath();
        File baseDir=basePath == null ? null : new File(basePath);
        if (baseDir != null && baseDir.exists()) {
          File ideaDir=new File(baseDir,DIRECTORY_STORE_FOLDER);
          if (ideaDir.exists() && ideaDir.isDirectory()) {
            FileUtil.writeToFile(new File(ideaDir,NAME_FILE),getName());
            myOldName=null;
            RecentProjectsManager.getInstance().clearNameCache();
          }
        }
      }
 catch (      Throwable e) {
        LOG.error("Unable to store project name",e);
      }
    }
    StoreUtil.save(ServiceKt.getStateStore(this),this);
  }
  finally {
    mySavingInProgress.set(false);
    ApplicationManager.getApplication().getMessageBus().syncPublisher(ProjectSaved.TOPIC).saved(this);
  }
}
