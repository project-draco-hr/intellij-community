{
  final SubTree tree=new SubTree(myWorkingCopyDir);
  checkin();
  VcsTestUtil.editFileInCommand(myProject,tree.myS1File,"test1");
  VcsTestUtil.editFileInCommand(myProject,tree.myS2File,"test2");
  VcsTestUtil.editFileInCommand(myProject,tree.myTargetFiles.get(1),"target1");
  myVcsDirtyScopeManager.markEverythingDirty();
  clManager.ensureUpToDate(false);
  Assert.assertEquals(3,clManager.getChangesIn(myWorkingCopyDir).size());
  try {
    Thread.sleep(100);
  }
 catch (  InterruptedException e) {
  }
  checkin();
  myWorkingCopyDir.refresh(false,true);
  imitateEvent(myWorkingCopyDir);
  clManager.ensureUpToDate(false);
  Assert.assertEquals(0,clManager.getChangesIn(myWorkingCopyDir).size());
}
