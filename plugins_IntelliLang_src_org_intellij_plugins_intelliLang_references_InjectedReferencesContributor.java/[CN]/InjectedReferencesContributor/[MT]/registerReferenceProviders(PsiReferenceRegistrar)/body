{
  registrar.registerReferenceProvider(PlatformPatterns.psiElement(),new PsiReferenceProvider(){
    @NotNull @Override public PsiReference[] getReferencesByElement(    @NotNull PsiElement element,    @NotNull ProcessingContext context){
      element.putUserData(INJECTED_REFERENCE,null);
      ReferenceInjector[] extensions=ReferenceInjector.EXTENSION_POINT_NAME.getExtensions();
      PsiReference[] references=new PsiReference[0];
      Configuration configuration=Configuration.getProjectInstance(element.getProject());
      for (      ReferenceInjector extension : extensions) {
        Collection<BaseInjection> injections=configuration.getInjectionsByLanguageId(extension.getId());
        for (        BaseInjection injection : injections) {
          if (injection.acceptForReference(element)) {
            element.putUserData(INJECTED_REFERENCE,extension);
            LanguageInjectionSupport support=InjectorUtils.findInjectionSupport(injection.getSupportId());
            element.putUserData(LanguageInjectionSupport.INJECTOR_SUPPORT,support);
            List<TextRange> area=injection.getInjectedArea(element);
            for (            TextRange range : area) {
              references=ArrayUtil.mergeArrays(references,extension.getReferences(element,context,range));
            }
          }
        }
      }
      return references;
    }
  }
);
}
