{
  myConfiguration=serverConfiguration;
  myTasksExecutor=taskExecutor;
  myLogManager=logManager;
  myRemoteName=remoteName;
  myCloudName=cloudName;
  List<DeploymentSourceHandler> handlers=new ArrayList<DeploymentSourceHandler>();
  handlers.add(new ModuleDeploymentSourceHandler());
  CloudGitDeploymentSourceHandlerProvider handlerProvider=CloudGitDeploymentConfiguratorBase.getDeploymentSourceHandlerProvider(serverType);
  if (handlerProvider != null) {
    handlers.addAll(handlerProvider.getHandlers(this));
  }
  DeploymentSource deploymentSource=task.getSource();
  for (  DeploymentSourceHandler sourceHandler : handlers) {
    if (sourceHandler.init(deploymentSource)) {
      mySourceHandler=sourceHandler;
      break;
    }
  }
  if (mySourceHandler == null) {
    throw new ServerRuntimeException("Unknown deployment source");
  }
  File contentRootFile=mySourceHandler.getRepositoryRootFile();
  myContentRootFile=contentRootFile;
  VirtualFile contentRoot=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(myContentRootFile);
  LOG.assertTrue(contentRoot != null,"Repository root is not found");
  myContentRoot=contentRoot;
  myProject=task.getProject();
  myGitRepositoryManager=GitUtil.getRepositoryManager(myProject);
  myGit=ServiceManager.getService(Git.class);
  if (myGit == null) {
    throw new ServerRuntimeException("Can't initialize GIT");
  }
  myAgentTaskExecutor=agentTaskExecutor;
  myLoggingHandler=logManager == null ? new CloudSilentLoggingHandlerImpl() : new CloudLoggingHandlerImpl(logManager);
  myPresentableName=deploymentSource.getPresentableName();
  DC deploymentConfiguration=task.getConfiguration();
  myApplicationName=deploymentConfiguration.isDefaultDeploymentName() ? deploymentNameProvider.getDeploymentName(deploymentSource) : deploymentConfiguration.getDeploymentName();
  myDeployment=agent.createDeployment(getApplicationName(),myLoggingHandler);
}
