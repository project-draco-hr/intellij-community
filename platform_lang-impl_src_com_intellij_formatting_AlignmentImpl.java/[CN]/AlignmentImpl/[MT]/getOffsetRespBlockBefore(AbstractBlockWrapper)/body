{
  if (!continueOffsetResponsibleBlockRetrieval(block)) {
    return null;
  }
  LeafBlockWrapper result=null;
  if (myOffsetRespBlocks != EMPTY) {
    LeafBlockWrapper firstAlignedBlock=null;
    LeafBlockWrapper lastAlignedBlock=null;
    for (    final LeafBlockWrapper current : myOffsetRespBlocks) {
      if (block == null || current.getStartOffset() < block.getStartOffset()) {
        if (firstAlignedBlock == null || firstAlignedBlock.getStartOffset() > current.getStartOffset()) {
          firstAlignedBlock=current;
        }
        if (lastAlignedBlock == null || lastAlignedBlock.getStartOffset() < current.getStartOffset()) {
          lastAlignedBlock=current;
        }
      }
    }
    if (firstAlignedBlock != null) {
      result=firstAlignedBlock;
    }
 else {
      result=lastAlignedBlock;
    }
  }
  if (result == null && myParentAlignment != null) {
    return myParentAlignment.getOffsetRespBlockBefore(block);
  }
 else {
    return result;
  }
}
