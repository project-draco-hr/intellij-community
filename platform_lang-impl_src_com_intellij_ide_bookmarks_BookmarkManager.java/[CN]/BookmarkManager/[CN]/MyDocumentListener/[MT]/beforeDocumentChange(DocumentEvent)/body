{
  if (e.isWholeTextReplaced())   return;
  Map<Trinity<VirtualFile,Integer,String>,Bookmark> bookmarksToRemove=null;
  for (  Bookmark bookmark : myBookmarks) {
    Document document=bookmark.getDocument();
    if (document == null || document != e.getDocument())     continue;
    if (bookmark.getLine() == -1)     continue;
    int start=document.getLineStartOffset(bookmark.getLine());
    int end=document.getLineEndOffset(bookmark.getLine());
    if (start >= e.getOffset() && end <= e.getOffset() + e.getOldLength()) {
      Trinity<VirtualFile,Integer,String> restoreBookmarkData=new Trinity<VirtualFile,Integer,String>(bookmark.getFile(),bookmark.getLine(),document.getText(new TextRange(start,end)));
      if (bookmarksToRemove == null) {
        bookmarksToRemove=new HashMap<Trinity<VirtualFile,Integer,String>,Bookmark>();
      }
      bookmarksToRemove.put(restoreBookmarkData,bookmark);
    }
  }
  if (bookmarksToRemove != null) {
    for (    Map.Entry<Trinity<VirtualFile,Integer,String>,Bookmark> entry : bookmarksToRemove.entrySet()) {
      removeBookmark(entry.getValue());
      myDeletedDocumentBookmarks.put(entry.getKey(),entry.getValue());
    }
  }
}
