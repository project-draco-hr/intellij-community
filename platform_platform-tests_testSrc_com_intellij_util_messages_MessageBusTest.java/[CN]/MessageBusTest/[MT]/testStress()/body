{
  final int threadsNumber=10;
  final int iterationsNumber=100;
  final AtomicReference<Throwable> exception=new AtomicReference<Throwable>();
  final CountDownLatch latch=new CountDownLatch(threadsNumber);
  final MessageBus parentBus=MessageBusFactory.newMessageBus("parent");
  for (int i=0; i < threadsNumber; i++) {
    new Thread(String.valueOf(i)){
      @Override public void run(){
        int remains=iterationsNumber;
        try {
          while (remains-- > 0) {
            if (exception.get() != null) {
              break;
            }
            new MessageBusImpl(String.format("child-%s-%s",Thread.currentThread().getName(),remains),parentBus);
          }
        }
 catch (        Throwable e) {
          exception.set(e);
        }
 finally {
          latch.countDown();
        }
      }
    }
.start();
  }
  latch.await();
  final Throwable e=exception.get();
  if (e != null) {
    throw e;
  }
}
