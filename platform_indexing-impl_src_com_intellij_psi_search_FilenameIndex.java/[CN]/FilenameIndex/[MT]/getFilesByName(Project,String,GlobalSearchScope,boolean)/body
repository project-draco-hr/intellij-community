{
  final Collection<VirtualFile> files=FileBasedIndex.getInstance().getContainingFiles(NAME,name,scope);
  if (files.isEmpty())   return PsiFile.EMPTY_ARRAY;
  List<PsiFileSystemItem> result=new ArrayList<PsiFileSystemItem>();
  for (  VirtualFile file : files) {
    if (!file.isValid())     continue;
    PsiManager psiManager=PsiManager.getInstance(project);
    PsiFile psiFile=psiManager.findFile(file);
    if (psiFile != null) {
      result.add(psiFile);
    }
 else     if (includeDirs) {
      PsiDirectory dir=psiManager.findDirectory(file);
      if (dir != null)       result.add(dir);
    }
  }
  if (includeDirs) {
    return ArrayUtil.toObjectArray(result,PsiFileSystemItem.class);
  }
  return result.toArray(new PsiFile[result.size()]);
}
