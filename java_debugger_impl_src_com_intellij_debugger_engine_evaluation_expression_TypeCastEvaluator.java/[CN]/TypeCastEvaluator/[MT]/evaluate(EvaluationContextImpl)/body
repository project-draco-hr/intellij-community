{
  Value value=(Value)myOperandEvaluator.evaluate(context);
  if (value == null) {
    if (myIsPrimitive) {
      throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.cast.null",myCastType));
    }
    return null;
  }
  VirtualMachineProxyImpl vm=context.getDebugProcess().getVirtualMachineProxy();
  if (DebuggerUtils.isInteger(value)) {
    value=DebuggerUtilsEx.createValue(vm,myCastType,((PrimitiveValue)value).longValue());
    if (value == null) {
      throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.cast.numeric",myCastType));
    }
  }
 else   if (DebuggerUtils.isNumeric(value)) {
    value=DebuggerUtilsEx.createValue(vm,myCastType,((PrimitiveValue)value).doubleValue());
    if (value == null) {
      throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.cast.numeric",myCastType));
    }
  }
 else   if (value instanceof BooleanValue) {
    value=DebuggerUtilsEx.createValue(vm,myCastType,((BooleanValue)value).booleanValue());
    if (value == null) {
      throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.cast.boolean",myCastType));
    }
  }
 else   if (value instanceof CharValue) {
    value=DebuggerUtilsEx.createValue(vm,myCastType,((CharValue)value).charValue());
    if (value == null) {
      throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.cast.char",myCastType));
    }
  }
 else   if (value instanceof ObjectReference) {
    Type type=value.type();
    if (!DebuggerUtils.instanceOf(type,myCastType)) {
      throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.cast.object",type.name(),myCastType));
    }
  }
  return value;
}
