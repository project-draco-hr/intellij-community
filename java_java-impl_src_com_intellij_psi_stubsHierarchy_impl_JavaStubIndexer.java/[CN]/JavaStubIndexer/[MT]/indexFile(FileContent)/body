{
  Stub stubTree=StubTreeBuilder.buildStubTree(content);
  if (!(stubTree instanceof PsiJavaFileStub))   return null;
  PsiJavaFileStub javaFileStub=(PsiJavaFileStub)stubTree;
  new StubTree(javaFileStub,false);
  ArrayList<ClassDecl> classList=new ArrayList<>();
  Set<String> usedNames=new HashSet<>();
  for (  StubElement<?> el : javaFileStub.getChildrenStubs()) {
    if (el instanceof PsiClassStubImpl) {
      ClassDecl classDecl=processClassDecl((PsiClassStubImpl<?>)el,usedNames);
      if (classDecl != null) {
        classList.add(classDecl);
      }
    }
  }
  ArrayList<IndexTree.Import> importList=new ArrayList<>();
  for (  StubElement<?> el : javaFileStub.getChildrenStubs()) {
    if (el instanceof PsiImportListStub) {
      processImport((PsiImportListStub)el,importList,usedNames);
    }
  }
  ClassDecl[] classes=classList.isEmpty() ? ClassDecl.EMPTY_ARRAY : classList.toArray(new ClassDecl[classList.size()]);
  IndexTree.Import[] imports=importList.isEmpty() ? IndexTree.Import.EMPTY_ARRAY : importList.toArray(new IndexTree.Import[importList.size()]);
  byte type=javaFileStub.isCompiled() ? IndexTree.BYTECODE : IndexTree.JAVA;
  return new Unit(javaFileStub.getPackageName(),type,imports,classes);
}
