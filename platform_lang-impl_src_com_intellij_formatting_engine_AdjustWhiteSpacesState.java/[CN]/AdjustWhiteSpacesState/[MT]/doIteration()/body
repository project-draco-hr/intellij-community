{
  if (myDependentSpacingEngine == null) {
    myDependentSpacingEngine=myDependentSpacingEngineRef.get();
    myCurrentBlock=myFirstBlockRef.get();
    myWrapProcessor=myWrapProcessorRef.get();
    myIndentAdjuster=myIndentAdjusterRef.get();
    myWrapProcessor=myWrapProcessorRef.get();
    myBlockMapperHelper=myBlockMapperHelperRef.get();
    myAlignmentsInsideRangesToModify=myAlignmentsInsideRangesToModifyRef.get();
  }
  LeafBlockWrapper blockToProcess=myCurrentBlock;
  processToken();
  if (blockToProcess != null) {
    myProgressCallback.afterProcessingBlock(blockToProcess);
  }
  if (myCurrentBlock != null) {
    return;
  }
  if (myAlignAgain.isEmpty()) {
    setDone(true);
  }
 else {
    myAlignAgain.clear();
    myDependentSpacingEngine.clear();
    myCurrentBlock=myFirstBlockRef.get();
  }
}
