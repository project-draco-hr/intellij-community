{
  if (isInstanceofPlace(position)) {
    result.consume(LookupElementDecorator.withInsertHandler(createKeyword(position,PsiKeyword.INSTANCEOF),new InsertHandler<LookupElementDecorator<LookupElement>>(){
      @Override public void handleInsert(      InsertionContext context,      LookupElementDecorator<LookupElement> item){
        TailType tailType=TailType.HUMBLE_SPACE_BEFORE_WORD;
        if (tailType.isApplicable(context)) {
          tailType.processTail(context.getEditor(),context.getTailOffset());
        }
        if ('!' == context.getCompletionChar()) {
          context.setAddCompletionChar(false);
          context.commitDocument();
          PsiInstanceOfExpression expr=PsiTreeUtil.findElementOfClassAtOffset(context.getFile(),context.getStartOffset(),PsiInstanceOfExpression.class,false);
          if (expr != null) {
            String space=context.getCodeStyleSettings().SPACE_WITHIN_PARENTHESES ? " " : "";
            context.getDocument().insertString(expr.getTextRange().getStartOffset(),"!(" + space);
            context.getDocument().insertString(context.getTailOffset(),space + ")");
          }
        }
      }
    }
));
  }
}
