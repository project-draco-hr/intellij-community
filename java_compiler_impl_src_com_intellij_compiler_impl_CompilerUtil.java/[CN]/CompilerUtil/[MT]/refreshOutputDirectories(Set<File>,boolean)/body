{
  LocalFileSystem fileSystem=LocalFileSystem.getInstance();
  List<VirtualFile> toRefresh=new ArrayList<VirtualFile>();
  int newDirectories=0;
  for (  File ioOutput : outputs) {
    VirtualFile output=fileSystem.findFileByIoFile(ioOutput);
    if (output != null) {
      toRefresh.add(output);
    }
 else     if (ioOutput.exists()) {
      VirtualFile parent=fileSystem.refreshAndFindFileByIoFile(ioOutput.getParentFile());
      if (parent != null) {
        parent.getChildren();
        toRefresh.add(parent);
        newDirectories++;
      }
    }
  }
  if (newDirectories > 10) {
    LOG.info(newDirectories + " new output directories were created, refreshing their parents together to avoid too many rootsChange events");
    RefreshQueue.getInstance().refresh(async,false,null,toRefresh);
  }
 else {
    LOG.debug("Refreshing " + outputs.size() + " outputs");
    fileSystem.refreshIoFiles(outputs,async,false,null);
  }
}
