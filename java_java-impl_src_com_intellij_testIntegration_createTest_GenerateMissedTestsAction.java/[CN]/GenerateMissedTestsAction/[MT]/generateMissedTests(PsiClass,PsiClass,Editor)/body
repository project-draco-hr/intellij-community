{
  if (testClass != null) {
    final TestFramework framework=TestFrameworks.detectFramework(testClass);
    if (framework != null) {
      final Project project=testClass.getProject();
      final Editor editor=CodeInsightUtil.positionCursorAtLBrace(project,testClass.getContainingFile(),testClass);
      if (!FileModificationService.getInstance().preparePsiElementsForWrite(testClass))       return;
      final MissedTestsDialog dialog=new MissedTestsDialog(project,srcClass,testClass,framework);
      if (dialog.showAndGet()) {
        WriteCommandAction.runWriteCommandAction(project,new Runnable(){
          @Override public void run(){
            JavaTestGenerator.addTestMethods(editor,testClass,srcClass,framework,dialog.getSelectedMethods(),false,false);
          }
        }
);
      }
    }
 else {
      HintManager.getInstance().showErrorHint(srcEditor,"Failed to detect test framework for " + testClass.getQualifiedName());
    }
  }
}
