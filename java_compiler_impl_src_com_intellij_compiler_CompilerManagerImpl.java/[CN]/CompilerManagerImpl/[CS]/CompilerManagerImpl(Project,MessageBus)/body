{
  myProject=project;
  myEventPublisher=messageBus.syncPublisher(CompilerTopics.COMPILATION_STATUS);
  for (  Compiler compiler : Extensions.getExtensions(Compiler.EP_NAME,myProject)) {
    addCompiler(compiler);
  }
  for (  CompilerFactory factory : Extensions.getExtensions(CompilerFactory.EP_NAME,myProject)) {
    Compiler[] compilers=factory.createCompilers(this);
    for (    Compiler compiler : compilers) {
      addCompiler(compiler);
    }
  }
  for (  InspectionValidator validator : Extensions.getExtensions(InspectionValidator.EP_NAME,myProject)) {
    addCompiler(new InspectionValidatorWrapper(this,InspectionManager.getInstance(project),InspectionProjectProfileManager.getInstance(project),PsiDocumentManager.getInstance(project),PsiManager.getInstance(project),validator));
  }
  addCompilableFileType(StdFileTypes.JAVA);
  final File projectGeneratedSrcRoot=CompilerPaths.getGeneratedDataDirectory(project);
  projectGeneratedSrcRoot.mkdirs();
  final LocalFileSystem lfs=LocalFileSystem.getInstance();
  myWatchRoots=lfs.addRootsToWatch(Collections.singletonList(FileUtil.toCanonicalPath(projectGeneratedSrcRoot.getPath())),true);
  Disposer.register(project,new Disposable(){
    public void dispose(){
      lfs.removeWatchedRoots(myWatchRoots);
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        FileUtil.delete(CompilerPaths.getCompilerSystemDirectory(project));
      }
    }
  }
);
}
