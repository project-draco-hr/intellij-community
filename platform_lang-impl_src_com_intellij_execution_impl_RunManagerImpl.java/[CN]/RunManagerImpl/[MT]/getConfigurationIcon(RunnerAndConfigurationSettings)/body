{
  final String uniqueID=settings.getUniqueID();
  RunnerAndConfigurationSettings selectedConfiguration=getSelectedConfiguration();
  String selectedId=selectedConfiguration != null ? selectedConfiguration.getUniqueID() : "";
  if (selectedId.equals(uniqueID)) {
    Long lastCheckTime=myIconCheckTimes.get(uniqueID);
    Long calcTime=myIconCalcTime.get(uniqueID);
    if (calcTime == null || calcTime < 150)     calcTime=150L;
    if (lastCheckTime == null || System.currentTimeMillis() - lastCheckTime > calcTime * 10) {
      myIdToIcon.remove(uniqueID);
    }
  }
  Icon icon=myIdToIcon.get(uniqueID);
  if (icon == null) {
    icon=IconDeferrer.getInstance().defer(settings.getConfiguration().getIcon(),Pair.create(myProject,settings),new Function<Pair<Project,RunnerAndConfigurationSettings>,Icon>(){
      @Override public Icon fun(      Pair<Project,RunnerAndConfigurationSettings> projectRunnerAndConfigurationSettingsPair){
        if (myProject.isDisposed())         return null;
        myIconCalcTime.remove(uniqueID);
        long startTime=System.currentTimeMillis();
        Icon icon;
        try {
          settings.checkSettings();
          icon=ProgramRunnerUtil.getConfigurationIcon(settings,false);
        }
 catch (        RuntimeConfigurationException e) {
          icon=ProgramRunnerUtil.getConfigurationIcon(settings,true);
        }
        myIconCalcTime.put(uniqueID,System.currentTimeMillis() - startTime);
        return icon;
      }
    }
);
    myIdToIcon.put(uniqueID,icon);
    myIconCheckTimes.put(uniqueID,System.currentTimeMillis());
  }
  return icon;
}
