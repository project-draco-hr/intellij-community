{
  myFinished=false;
  if (myFile != null) {
    myHighlightingSession=new HighlightingSessionImpl(myFile,myEditor,progress,getColorsScheme(),getId(),myRestrictRange);
    if (!progress.isCanceled()) {
      Disposer.register((Disposable)progress,myHighlightingSession);
      if (progress.isCanceled()) {
        Disposer.dispose(myHighlightingSession);
        Disposer.dispose((Disposable)progress);
      }
    }
    progress.checkCanceled();
    if (progress instanceof UserDataHolder) {
      ((UserDataHolder)progress).putUserData(HIGHLIGHTING_SESSION,myHighlightingSession);
    }
  }
  try {
    collectInformationWithProgress(progress);
  }
  finally {
    if (myFile != null) {
      sessionFinished();
    }
  }
}
