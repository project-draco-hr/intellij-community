{
  TextRange textRange=((ProblemDescriptorBase)problemDescriptor).getTextRange();
  if (textRange == null || psiElement == null)   return null;
  boolean isFileLevel=psiElement instanceof PsiFile && textRange.equals(psiElement.getTextRange());
  final HighlightSeverity severity=highlightInfoType.getSeverity(psiElement);
  TextAttributes attributes=mySeverityRegistrar.getTextAttributesBySeverity(severity);
  HighlightInfo highlightInfo=new HighlightInfo(attributes,null,highlightInfoType,textRange.getStartOffset(),textRange.getEndOffset(),message,toolTip,severity,problemDescriptor.isAfterEndOfLine(),null,isFileLevel,0);
  if (!HighlightInfo.isAcceptedByFilters(highlightInfo,psiElement)) {
    return null;
  }
  highlightInfo.setProblemGroup(problemDescriptor.getProblemGroup());
  return highlightInfo;
}
