{
  final Course course=StudyTaskManager.getInstance(project).getCourse();
  if (course == null) {
    return null;
  }
  VirtualFile taskDir=file.getParent();
  if (taskDir == null) {
    return null;
  }
  if ("src".equals(taskDir.getName())) {
    taskDir=taskDir.getParent();
    if (taskDir == null) {
      return null;
    }
  }
  final String taskDirName=taskDir.getName();
  if (taskDirName.contains(EduNames.TASK)) {
    final VirtualFile lessonDir=taskDir.getParent();
    if (lessonDir != null) {
      int lessonIndex=EduUtils.getIndex(lessonDir.getName(),EduNames.LESSON);
      List<Lesson> lessons=course.getLessons();
      if (!indexIsValid(lessonIndex,lessons)) {
        return null;
      }
      final Lesson lesson=lessons.get(lessonIndex);
      int taskIndex=EduUtils.getIndex(taskDirName,EduNames.TASK);
      final List<Task> tasks=lesson.getTaskList();
      if (!indexIsValid(taskIndex,tasks)) {
        return null;
      }
      final Task task=tasks.get(taskIndex);
      return task.getFile(file.getName());
    }
  }
  return null;
}
