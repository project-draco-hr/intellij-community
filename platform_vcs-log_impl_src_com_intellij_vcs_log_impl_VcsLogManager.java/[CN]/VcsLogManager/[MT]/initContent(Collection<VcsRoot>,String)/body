{
  final Map<VirtualFile,VcsLogProvider> logProviders=findLogProviders(roots);
  Consumer<VisiblePack> visiblePackConsumer=new Consumer<VisiblePack>(){
    @Override public void consume(    final VisiblePack pack){
      UIUtil.invokeLaterIfNeeded(new Runnable(){
        @Override public void run(){
          if (!Disposer.isDisposed(myUi)) {
            myUi.setVisiblePack(pack);
          }
        }
      }
);
    }
  }
;
  VcsLogDataHolder logDataHolder=new VcsLogDataHolder(myProject,this,logProviders,mySettings,myUiProperties,visiblePackConsumer);
  myUi=new VcsLogUiImpl(logDataHolder,myProject,mySettings,new VcsLogColorManagerImpl(logProviders.keySet()),myUiProperties,logDataHolder.getFilterer());
  myLogRefresher=new PostponeableLogRefresher(myProject,logDataHolder,contentTabName);
  refreshLogOnVcsEvents(logProviders);
  logDataHolder.initialize();
  final VcsLogGraphTable graphTable=myUi.getTable();
  if (graphTable.getRowCount() > 0) {
    IdeFocusManager.getInstance(myProject).requestFocus(graphTable,true).doWhenProcessed(new Runnable(){
      @Override public void run(){
        graphTable.setRowSelectionInterval(0,0);
      }
    }
);
  }
  return myUi.getMainFrame().getMainComponent();
}
