{
  final Map<VirtualFile,VcsLogProvider> logProviders=findLogProviders();
  Consumer<DataPack> dataPackUpdateHandler=new Consumer<DataPack>(){
    @Override public void consume(    final DataPack dataPack){
      UIUtil.invokeAndWaitIfNeeded(new Runnable(){
        @Override public void run(){
          if (!Disposer.isDisposed(myUi)) {
            myUi.setDataPack(dataPack);
            myProject.getMessageBus().syncPublisher(VcsLogDataHolder.REFRESH_COMPLETED).refresh(dataPack);
          }
        }
      }
);
    }
  }
;
  VcsLogDataHolder logDataHolder=new VcsLogDataHolder(myProject,this,logProviders,mySettings,dataPackUpdateHandler);
  myUi=new VcsLogUiImpl(logDataHolder,myProject,mySettings,new VcsLogColorManagerImpl(logProviders.keySet()),myUiProperties,EmptyDataPack.getInstance());
  myLogRefresher=new PostponeableLogRefresher(myProject,logDataHolder);
  refreshLogOnVcsEvents(logProviders);
  logDataHolder.initialize();
  final VcsLogGraphTable graphTable=myUi.getTable();
  if (graphTable.getRowCount() > 0) {
    IdeFocusManager.getInstance(myProject).requestFocus(graphTable,true).doWhenProcessed(new Runnable(){
      @Override public void run(){
        graphTable.setRowSelectionInterval(0,0);
      }
    }
);
  }
  return myUi.getMainFrame().getMainComponent();
}
