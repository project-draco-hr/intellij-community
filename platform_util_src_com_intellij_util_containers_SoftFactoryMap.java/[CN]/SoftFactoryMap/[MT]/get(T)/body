{
  final SoftReference<V> reference=myMap.get(key);
  final V v=com.intellij.reference.SoftReference.dereference(reference);
  if (v != null) {
    return v == NULL ? null : v;
  }
  final V value=create(key);
  SoftReference<V> valueRef=new SoftReference<V>(value == null ? (V)NULL : value);
  SoftReference<V> prevRef=myMap.putIfAbsent(key,valueRef);
  V prev=com.intellij.reference.SoftReference.dereference(prevRef);
  return prev == null || prev == NULL ? value : prev;
}
