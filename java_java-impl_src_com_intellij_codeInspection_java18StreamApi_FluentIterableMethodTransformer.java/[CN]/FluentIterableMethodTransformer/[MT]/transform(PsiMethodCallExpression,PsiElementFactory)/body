{
  final String formatted=formatMethod(expression.getArgumentList().getExpressions());
  final String negation=negate() ? "!" : "";
  final PsiExpression qualifierExpression=expression.getMethodExpression().getQualifierExpression();
  LOG.assertTrue(qualifierExpression != null);
  final String oldQualifierText=qualifierExpression.getText();
  final String expressionText=negation + oldQualifierText + "."+ formatted;
  final PsiElement replaced=expression.replace(elementFactory.createExpressionFromText(expressionText,null));
  if (replaced instanceof PsiMethodCallExpression) {
    PsiMethodCallExpression methodCallExpression=(PsiMethodCallExpression)replaced;
    while (true) {
      final PsiExpression qualifier=methodCallExpression.getMethodExpression().getQualifierExpression();
      LOG.assertTrue(qualifier != null);
      if (oldQualifierText.equals(qualifier.getText())) {
        return methodCallExpression;
      }
      methodCallExpression=(PsiMethodCallExpression)qualifier;
    }
  }
 else {
    return null;
  }
}
