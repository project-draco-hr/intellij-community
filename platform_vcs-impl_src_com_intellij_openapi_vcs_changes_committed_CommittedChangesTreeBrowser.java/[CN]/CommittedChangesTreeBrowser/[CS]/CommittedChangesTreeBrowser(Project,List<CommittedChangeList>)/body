{
  super(new BorderLayout());
  myProject=project;
  myDecorators=new LinkedList<>();
  myChangeLists=changeLists;
  myChangesTree=new ChangesBrowserTree();
  myChangesTree.setRootVisible(false);
  myChangesTree.setShowsRootHandles(true);
  myChangesTree.setCellRenderer(new CommittedChangeListRenderer(project,myDecorators));
  TreeUtil.expandAll(myChangesTree);
  myChangesTree.setExpandableItemsEnabled(false);
  myDetailsView=new RepositoryChangesBrowser(project,Collections.<CommittedChangeList>emptyList());
  myDetailsView.getViewerScrollPane().setBorder(RIGHT_BORDER);
  myChangesTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      updateBySelectionChange();
    }
  }
);
  final TreeLinkMouseListener linkMouseListener=new TreeLinkMouseListener(new CommittedChangeListRenderer(project,myDecorators));
  linkMouseListener.installOn(myChangesTree);
  myLeftPanel=new JPanel(new BorderLayout());
  initSplitters();
  updateBySelectionChange();
  Keymap keymap=KeymapManager.getInstance().getActiveKeymap();
  CustomShortcutSet quickdocShortcuts=new CustomShortcutSet(keymap.getShortcuts(IdeActions.ACTION_QUICK_JAVADOC));
  EmptyAction.registerWithShortcutSet("CommittedChanges.Details",quickdocShortcuts,this);
  myCopyProvider=new TreeCopyProvider(myChangesTree);
  myTreeExpander=new DefaultTreeExpander(myChangesTree);
  myDetailsView.addToolbarAction(ActionManager.getInstance().getAction("Vcs.ShowTabbedFileHistory"));
  myHelpId=ourHelpId;
  myDetailsView.getDiffAction().registerCustomShortcutSet(myDetailsView.getDiffAction().getShortcutSet(),myChangesTree);
  myConnection=myProject.getMessageBus().connect();
  myConnection.subscribe(ITEMS_RELOADED,new CommittedChangesReloadListener(){
    public void itemsReloaded(){
    }
    public void emptyRefresh(){
      updateGrouping();
    }
  }
);
}
