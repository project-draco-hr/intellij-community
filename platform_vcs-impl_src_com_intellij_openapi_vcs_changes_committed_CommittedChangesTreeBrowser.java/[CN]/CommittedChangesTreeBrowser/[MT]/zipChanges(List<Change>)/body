{
  final List<Change> result=new ArrayList<Change>();
  for (  Change change : changes) {
    final ContentRevision beforeRev=change.getBeforeRevision();
    if (beforeRev == null) {
      result.add(change);
      continue;
    }
    Change oldChange=null;
    final FilePath beforePath=beforeRev.getFile();
    for (    Change processedChange : result) {
      ContentRevision rev=processedChange.getAfterRevision();
      if (rev != null && rev.getFile().equals(beforePath)) {
        oldChange=processedChange;
        break;
      }
    }
    if (oldChange == null) {
      result.add(change);
      continue;
    }
    result.remove(oldChange);
    if (oldChange.getBeforeRevision() != null || change.getAfterRevision() != null) {
      result.add(new Change(oldChange.getBeforeRevision(),change.getAfterRevision()));
    }
  }
  return result;
}
