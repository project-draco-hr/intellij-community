{
  GlobalSearchScope scope=null;
  Module[] modules=getConvertContextModules();
  if (modules.length != 0) {
    PsiFile file=getFile();
    file=file.getOriginalFile();
    VirtualFile virtualFile=file.getVirtualFile();
    if (virtualFile != null) {
      boolean tests=TestSourcesFilter.isTestSources(virtualFile,file.getProject());
      for (      Module module : modules) {
        if (scope == null) {
          scope=module.getModuleRuntimeScope(tests);
        }
 else {
          scope=scope.union(module.getModuleRuntimeScope(tests));
        }
      }
    }
  }
  return scope;
}
