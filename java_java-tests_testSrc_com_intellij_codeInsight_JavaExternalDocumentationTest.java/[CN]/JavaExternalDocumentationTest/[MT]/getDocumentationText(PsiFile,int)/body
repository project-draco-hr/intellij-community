{
  Project project=psiFile.getProject();
  Document document=PsiDocumentManager.getInstance(project).getDocument(psiFile);
  assertNotNull(document);
  Editor editor=EditorFactory.getInstance().createEditor(document,project);
  try {
    if (caretPosition >= 0) {
      editor.getCaretModel().moveToOffset(caretPosition);
    }
    DocumentationManager documentationManager=DocumentationManager.getInstance(project);
    MockDocumentationComponent documentationComponent=new MockDocumentationComponent(documentationManager);
    try {
      documentationManager.setDocumentationComponent(documentationComponent);
      documentationManager.showJavaDocInfo(editor,psiFile,false);
      waitTillDone(documentationManager.getLastAction());
      return documentationComponent.getText();
    }
  finally {
      JBPopup hint=documentationComponent.getHint();
      if (hint != null)       Disposer.dispose(hint);
      Disposer.dispose(documentationComponent);
    }
  }
  finally {
    EditorFactory.getInstance().releaseEditor(editor);
  }
}
