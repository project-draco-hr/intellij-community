{
  if (event != null && !event.isConsumed()) {
    int id=event.getID();
    if (id == KeyEvent.KEY_TYPED) {
      return extended ? null : getKeyStroke(event.getKeyChar());
    }
    boolean released=id == KeyEvent.KEY_RELEASED;
    if (released || id == KeyEvent.KEY_PRESSED) {
      int code=event.getKeyCode();
      if (extended) {
        code=getExtendedKeyCode(event);
        if (code == event.getKeyCode()) {
          return null;
        }
      }
      return getKeyStroke(code,event.getModifiers(),released);
    }
  }
  return null;
}
