{
  ourLastInitializerPlace=myIntroduceFieldPanel.getInitializerPlace();
  final PsiType forcedType=getType();
  LOG.assertTrue(forcedType == null || forcedType.isValid(),forcedType);
  final BaseExpressionToFieldHandler.Settings settings=new BaseExpressionToFieldHandler.Settings(getInputName(),getExpr(),getOccurrences(),myIntroduceFieldPanel.isReplaceAllOccurrences(),myStatic,myIntroduceFieldPanel.isDeclareFinal(),myIntroduceFieldPanel.getInitializerPlace(),myIntroduceFieldPanel.getFieldVisibility(),(PsiLocalVariable)getLocalVariable(),forcedType,myIntroduceFieldPanel.isDeleteVariable(),myParentClass,false,false);
  new WriteCommandAction(myProject,getCommandName(),getCommandName()){
    @Override protected void run(    @NotNull Result result) throws Throwable {
      if (getLocalVariable() != null) {
        final LocalToFieldHandler.IntroduceFieldRunnable fieldRunnable=new LocalToFieldHandler.IntroduceFieldRunnable(false,(PsiLocalVariable)getLocalVariable(),myParentClass,settings,myStatic,myOccurrences);
        fieldRunnable.run();
      }
 else {
        final BaseExpressionToFieldHandler.ConvertToFieldRunnable convertToFieldRunnable=new BaseExpressionToFieldHandler.ConvertToFieldRunnable(myExpr,settings,settings.getForcedType(),myOccurrences,myOccurrenceManager,getAnchorElementIfAll(),getAnchorElement(),myEditor,myParentClass);
        convertToFieldRunnable.run();
      }
    }
  }
.execute();
}
