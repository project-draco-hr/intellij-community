{
  if (getFrame() != null) {
    setState(getFrame().getExtendedState());
  }
  JRootPane rootPane=getRootPane();
  Window window=getWindow();
  boolean leftToRight=(window == null) ? rootPane.getComponentOrientation().isLeftToRight() : window.getComponentOrientation().isLeftToRight();
  boolean isSelected=(window == null) ? true : window.isActive();
  int width=getWidth();
  int height=getHeight();
  Color background;
  Color foreground;
  Color darkShadow;
  if (isSelected) {
    background=UIUtil.getPanelBackground();
    foreground=myActiveForeground;
    darkShadow=Gray._73;
  }
 else {
    background=UIUtil.getPanelBackground();
    foreground=myInactiveForeground;
    darkShadow=myInactiveShadow;
  }
  g.setColor(background);
  g.fillRect(0,0,width,height);
  int xOffset=leftToRight ? JBUI.scale(5) : width - JBUI.scale(5);
  if (getWindowDecorationStyle() == JRootPane.FRAME && myMenuBar != null) {
    final int menuBarWithOffset=myMenuBar.getWidth() + JBUI.scale(5);
    xOffset+=leftToRight ? menuBarWithOffset : -menuBarWithOffset;
  }
  String theTitle=getTitle();
  if (theTitle != null) {
    FontMetrics fm=SwingUtilities2.getFontMetrics(rootPane,g);
    g.setColor(foreground);
    int yOffset=((height - fm.getHeight()) / 2) + fm.getAscent();
    Rectangle rect=new Rectangle(0,0,0,0);
    if (myIconifyButton != null && myIconifyButton.getParent() != null) {
      rect=myIconifyButton.getBounds();
    }
    int titleW;
    if (leftToRight) {
      if (rect.x == 0) {
        rect.x=window.getWidth() - window.getInsets().right - 2;
      }
      titleW=rect.x - xOffset - 4;
      theTitle=SwingUtilities2.clipStringIfNecessary(rootPane,fm,theTitle,titleW);
    }
 else {
      titleW=xOffset - rect.x - rect.width- 4;
      theTitle=SwingUtilities2.clipStringIfNecessary(rootPane,fm,theTitle,titleW);
      xOffset-=SwingUtilities2.stringWidth(rootPane,fm,theTitle);
    }
    int titleLength=SwingUtilities2.stringWidth(rootPane,fm,theTitle);
    if (myIdeMenu == null) {
      SwingUtilities2.drawString(rootPane,g,theTitle,xOffset,yOffset);
      xOffset+=leftToRight ? titleLength + JBUI.scale(5) : -JBUI.scale(5);
    }
  }
  g.setColor(UIManager.getColor("MenuBar.darcula.borderColor"));
  g.drawLine(0,getHeight() - 1,getWidth(),getHeight() - 1);
}
