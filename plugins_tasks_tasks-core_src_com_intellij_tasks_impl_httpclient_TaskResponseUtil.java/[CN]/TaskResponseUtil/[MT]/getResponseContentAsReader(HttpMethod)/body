{
  InputStream stream=response.getResponseBodyAsStream();
  String charsetName=null;
  org.apache.commons.httpclient.Header header=response.getResponseHeader(HTTP.CONTENT_TYPE);
  if (header != null) {
    for (    HeaderElement part : header.getElements()) {
      NameValuePair pair=part.getParameterByName("charset");
      if (pair != null) {
        charsetName=pair.getValue();
      }
    }
  }
  return new InputStreamReader(stream,charsetName == null ? DEFAULT_CHARSET_NAME : charsetName);
}
