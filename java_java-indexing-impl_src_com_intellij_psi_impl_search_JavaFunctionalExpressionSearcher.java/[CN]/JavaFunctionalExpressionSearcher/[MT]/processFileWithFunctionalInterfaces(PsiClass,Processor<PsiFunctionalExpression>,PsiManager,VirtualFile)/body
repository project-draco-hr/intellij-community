{
  final PsiFile psiFile=psiManager.findFile(file);
  if (psiFile != null) {
    final Ref<Boolean> ref=new Ref<Boolean>(true);
    psiFile.accept(new JavaRecursiveElementWalkingVisitor(){
      @Override public void visitElement(      PsiElement element){
        if (!ref.get()) {
          return;
        }
        super.visitElement(element);
      }
      private void visitFunctionalExpression(      PsiFunctionalExpression expression){
        PsiType functionalInterfaceType=expression.getFunctionalInterfaceType();
        if (InheritanceUtil.isInheritorOrSelf(PsiUtil.resolveClassInType(functionalInterfaceType),aClass,true)) {
          if (!consumer.process(expression)) {
            ref.set(false);
          }
        }
      }
      @Override public void visitLambdaExpression(      PsiLambdaExpression expression){
        super.visitLambdaExpression(expression);
        visitFunctionalExpression(expression);
      }
      @Override public void visitMethodReferenceExpression(      PsiMethodReferenceExpression expression){
        super.visitMethodReferenceExpression(expression);
        visitFunctionalExpression(expression);
      }
    }
);
    if (!ref.get())     return false;
  }
  return true;
}
