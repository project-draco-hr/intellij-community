{
  MultiMap<VirtualFile,Integer> result=MultiMap.createLinked();
  MultiMap<VirtualFile,Integer> unlikely=MultiMap.createLinked();
  for (  Location location : queries.keySet()) {
    MultiMap<VirtualFile,Integer> offsets=getOffsetsForLocation(descriptor,location,queries.get(location));
    for (    VirtualFile file : offsets.keySet()) {
      (likelyFiles.contains(file) ? result : unlikely).putValues(file,offsets.get(file));
    }
    if (LOG.isDebugEnabled()) {
      logIfLarge(offsets,location);
    }
  }
  result.putAllValues(unlikely);
  if (LOG.isDebugEnabled()) {
    LOG.debug("checking " + result.values().size() + " fun-expressions in "+ result.keySet().size()+ " files");
  }
  return result;
}
