{
  final GlobalSearchScope scope;
  if (useScope instanceof GlobalSearchScope) {
    scope=(GlobalSearchScope)useScope;
  }
 else   if (useScope instanceof LocalSearchScope) {
    final Set<VirtualFile> files=new HashSet<VirtualFile>();
    ContainerUtil.addAllNotNull(files,ContainerUtil.map(((LocalSearchScope)useScope).getScope(),new Function<PsiElement,VirtualFile>(){
      @Override public VirtualFile fun(      PsiElement element){
        return PsiUtilCore.getVirtualFile(element);
      }
    }
));
    scope=GlobalSearchScope.filesScope(project,files);
  }
 else {
    scope=new EverythingGlobalScope(project);
  }
  return scope;
}
