{
  final ProjectDescriptor projectDescriptor=context.getProjectDescriptor();
  final JpsJavaCompilerConfiguration configuration=JpsJavaExtensionService.getInstance().getOrCreateCompilerConfiguration(projectDescriptor.getProject());
  final boolean shouldClear=configuration.isClearOutputDirectoryOnRebuild();
  if (shouldClear) {
    clearOutputs(context);
  }
 else {
    for (    BuildTarget<?> target : projectDescriptor.getBuildTargetIndex().getAllTargets()) {
      if (context.getScope().isAffected(target)) {
        clearOutputFilesUninterruptibly(context,target);
      }
    }
  }
  try {
    projectDescriptor.timestamps.getStorage().clean();
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning timestamps storage",e);
  }
  try {
    projectDescriptor.dataManager.clean();
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning compiler storages",e);
  }
  myProjectDescriptor.fsState.clearAll();
}
