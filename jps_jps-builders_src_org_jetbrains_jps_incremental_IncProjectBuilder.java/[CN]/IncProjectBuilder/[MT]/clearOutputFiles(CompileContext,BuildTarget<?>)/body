{
  final SourceToOutputMapping map=context.getProjectDescriptor().dataManager.getSourceToOutputMap(target);
  final THashSet<File> dirsToDelete=target instanceof ModuleBasedTarget ? new THashSet<File>(FileUtil.FILE_HASHING_STRATEGY) : null;
  for (  String srcPath : map.getSources()) {
    final Collection<String> outs=map.getOutputs(srcPath);
    if (outs != null && !outs.isEmpty()) {
      List<String> deletedPaths=new ArrayList<String>();
      for (      String out : outs) {
        BuildOperations.deleteRecursively(out,deletedPaths,dirsToDelete);
      }
      if (!deletedPaths.isEmpty()) {
        context.processMessage(new FileDeletedEvent(deletedPaths));
      }
    }
  }
  registerTargetsWithClearedOutput(context,Collections.singletonList(target));
  if (dirsToDelete != null) {
    FSOperations.pruneEmptyDirs(context,dirsToDelete);
  }
}
