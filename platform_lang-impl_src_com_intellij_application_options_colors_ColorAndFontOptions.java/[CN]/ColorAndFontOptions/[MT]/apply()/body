{
  if (myApplyCompleted) {
    return;
  }
  try {
    EditorColorsManager myColorsManager=EditorColorsManager.getInstance();
    List<EditorColorsScheme> result=new ArrayList<EditorColorsScheme>(mySchemes.values().size());
    for (    MyColorScheme scheme : mySchemes.values()) {
      if (!scheme.isDefault()) {
        scheme.apply();
      }
      result.add(scheme.getOriginalScheme());
    }
    EditorColorsScheme originalScheme=mySelectedScheme.getOriginalScheme();
    ((EditorColorsManagerImpl)myColorsManager).getSchemeManager().setSchemes(result,originalScheme);
    if (DarculaLaf.NAME.equals(originalScheme.getName()) && !UIUtil.isUnderDarcula()) {
      if (Messages.showYesNoDialog("Darcula color scheme has been set for editors. Would you like to set Darcula as default Look and Feel?","Darcula Look and Feel",Messages.getQuestionIcon()) == Messages.YES) {
        LafManager.getInstance().setCurrentLookAndFeel(new DarculaLookAndFeelInfo());
        DarculaInstaller.install();
      }
    }
    for (    Project project : ProjectManager.getInstance().getOpenProjects()) {
      DaemonCodeAnalyzer.getInstance(project).restart();
    }
    reset();
  }
  finally {
    myApplyCompleted=true;
  }
}
