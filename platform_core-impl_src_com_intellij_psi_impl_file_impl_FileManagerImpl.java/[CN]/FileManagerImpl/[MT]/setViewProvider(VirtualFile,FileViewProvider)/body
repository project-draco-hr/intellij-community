{
  FileViewProvider prev=findCachedViewProvider(virtualFile);
  if (prev != null) {
    DebugUtil.startPsiModification(null);
    try {
      DebugUtil.onInvalidated(prev);
    }
  finally {
      DebugUtil.finishPsiModification();
    }
  }
  if (!(virtualFile instanceof VirtualFileWindow)) {
    if (fileViewProvider == null) {
      myVFileToViewProviderMap.remove(virtualFile);
      Document document=FileDocumentManager.getInstance().getCachedDocument(virtualFile);
      if (document != null) {
        PsiDocumentManagerBase.cachePsi(document,null);
      }
    }
 else {
      myVFileToViewProviderMap.put(virtualFile,fileViewProvider);
    }
  }
}
