{
  myActionManager=actionManagerEx;
  myActionManager.addAnActionListener(new AnActionListener(){
    @Override public void beforeActionPerformed(    AnAction action,    DataContext dataContext,    final AnActionEvent event){
      String id=myActionManager.getId(action);
      if (id == null)       return;
      if ("StartStopMacroRecording".equals(id)) {
        myLastActionInputEvent.add(event.getInputEvent());
      }
 else       if (myIsRecording) {
        myRecordingMacro.appendAction(id);
        String shortcut=null;
        if (event.getInputEvent() instanceof KeyEvent) {
          shortcut=KeymapUtil.getKeystrokeText(KeyStroke.getKeyStrokeForEvent((KeyEvent)event.getInputEvent()));
        }
        notifyUser(id + (shortcut != null ? " (" + shortcut + ")" : ""),false);
        myLastActionInputEvent.add(event.getInputEvent());
      }
    }
    @Override public void beforeEditorTyping(    char c,    DataContext dataContext){
    }
    @Override public void afterActionPerformed(    final AnAction action,    final DataContext dataContext,    final AnActionEvent event){
    }
  }
);
  myKeyProcessor=new MyKeyPostpocessor();
  IdeEventQueue.getInstance().addPostprocessor(myKeyProcessor,null);
}
