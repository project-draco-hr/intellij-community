{
  final int invokePolicy=getInvokePolicy(context);
  final Exception[] exception=new Exception[1];
  final Value[] result=new Value[1];
  getManagerThread().startLongProcessAndFork(new Runnable(){
    @Override public void run(){
      ThreadReferenceProxyImpl thread=context.getThread();
      try {
        try {
          if (LOG.isDebugEnabled()) {
            final VirtualMachineProxyImpl virtualMachineProxy=getVirtualMachineProxy();
            virtualMachineProxy.logThreads();
            LOG.debug("Invoke in " + thread.name());
            assertThreadSuspended(thread,context);
          }
          if (myMethod.isVarArgs()) {
            int lastIndex=myArgs.size() - 1;
            if (lastIndex >= 0) {
              final Object lastArg=myArgs.get(lastIndex);
              if (lastArg instanceof ArrayReference) {
                final ArrayReference arrayRef=(ArrayReference)lastArg;
                if (((ArrayType)arrayRef.referenceType()).componentType() instanceof InterfaceType) {
                  List<String> argTypes=myMethod.argumentTypeNames();
                  if (argTypes.size() > lastIndex && argTypes.get(lastIndex).startsWith(CommonClassNames.JAVA_LANG_OBJECT)) {
                    myArgs.remove(lastIndex);
                    myArgs.addAll(arrayRef.getValues());
                  }
                }
              }
            }
          }
          if (!Patches.IBM_JDK_DISABLE_COLLECTION_BUG) {
            for (            Object arg : myArgs) {
              if (arg instanceof ObjectReference) {
                ((ObjectReference)arg).disableCollection();
              }
            }
          }
          result[0]=invokeMethod(invokePolicy,myMethod,myArgs);
        }
  finally {
          if (!Patches.IBM_JDK_DISABLE_COLLECTION_BUG) {
            for (            Object arg : myArgs) {
              if (arg instanceof ObjectReference) {
                ((ObjectReference)arg).enableCollection();
              }
            }
          }
        }
      }
 catch (      Exception e) {
        exception[0]=e;
      }
    }
  }
);
  if (exception[0] != null) {
    if (exception[0] instanceof InvocationException) {
      throw (InvocationException)exception[0];
    }
 else     if (exception[0] instanceof ClassNotLoadedException) {
      throw (ClassNotLoadedException)exception[0];
    }
 else     if (exception[0] instanceof IncompatibleThreadStateException) {
      throw (IncompatibleThreadStateException)exception[0];
    }
 else     if (exception[0] instanceof InvalidTypeException) {
      throw (InvalidTypeException)exception[0];
    }
 else     if (exception[0] instanceof RuntimeException) {
      throw (RuntimeException)exception[0];
    }
 else {
      LOG.error("Unexpected exception " + exception[0]);
    }
  }
  return (E)result[0];
}
