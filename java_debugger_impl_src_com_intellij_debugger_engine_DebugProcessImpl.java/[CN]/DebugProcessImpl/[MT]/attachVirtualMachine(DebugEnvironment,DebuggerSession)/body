{
  mySession=session;
  myWaitFor.down();
  ApplicationManager.getApplication().assertIsDispatchThread();
  LOG.assertTrue(isInInitialState());
  myConnection=environment.getRemoteConnection();
  createVirtualMachine(environment);
  ExecutionResult executionResult;
  try {
synchronized (myProcessListeners) {
      executionResult=environment.createExecutionResult();
      myExecutionResult=executionResult;
      if (executionResult == null) {
        fail();
        return null;
      }
      for (      ProcessListener processListener : myProcessListeners) {
        executionResult.getProcessHandler().addProcessListener(processListener);
      }
      myProcessListeners.clear();
    }
  }
 catch (  ExecutionException e) {
    fail();
    throw e;
  }
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return executionResult;
  }
  return executionResult;
}
