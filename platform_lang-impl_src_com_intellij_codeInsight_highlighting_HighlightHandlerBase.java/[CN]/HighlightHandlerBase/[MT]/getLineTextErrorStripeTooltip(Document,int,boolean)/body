{
  final int lineNumber=document.getLineNumber(offset);
  int lineStartOffset=document.getLineStartOffset(lineNumber);
  int lineEndOffset=document.getLineEndOffset(lineNumber);
  int lineFragmentEndOffset=Math.min(lineStartOffset + 140,lineEndOffset);
  String lineText=document.getImmutableCharSequence().subSequence(lineStartOffset,lineFragmentEndOffset).toString();
  if (lineFragmentEndOffset != lineEndOffset) {
    lineText=lineText.trim() + "...";
  }
  return "  " + (escape ? StringUtil.escapeXml(lineText.trim()) : lineText.trim()) + "  ";
}
