{
  if (modules == null || modules.length == 0)   return null;
  return new ModuleSourceScope(modules[0].getProject()){
    private GlobalSearchScope myGlobalSearchScope;
    private GlobalSearchScope myLibScope;
    public GlobalSearchScope getGlobalSearchScope(){
      if (myGlobalSearchScope == null) {
        myGlobalSearchScope=evaluateScopesAndUnite(modules,new ScopeForModuleEvaluator(){
          public GlobalSearchScope evaluate(          final Module module){
            return GlobalSearchScope.moduleWithDependenciesScope(module);
          }
        }
);
      }
      return myGlobalSearchScope;
    }
    public GlobalSearchScope getLibrariesScope(){
      if (myLibScope == null) {
        myLibScope=evaluateScopesAndUnite(modules,new ScopeForModuleEvaluator(){
          public GlobalSearchScope evaluate(          final Module module){
            return new ModuleWithDependenciesAndLibsDependencies(module);
          }
        }
);
      }
      return myLibScope;
    }
    public Module[] getModulesToCompile(){
      return modules;
    }
  }
;
}
