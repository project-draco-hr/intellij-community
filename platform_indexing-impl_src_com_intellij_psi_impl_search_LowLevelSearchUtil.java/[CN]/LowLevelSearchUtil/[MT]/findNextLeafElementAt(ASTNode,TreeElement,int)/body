{
  TreeElement leafNode;
  int offsetR=offset;
  if (last != null) {
    offsetR-=last.getStartOffset() + last.getTextLength();
    out:     while (offsetR >= 0) {
      TreeElement next=last.getTreeNext();
      if (next == null) {
        last=last.getTreeParent();
        continue out;
      }
      int length=next.getTextLength();
      offsetR-=length;
      last=next;
    }
    scopeNode=last;
    offsetR+=scopeNode.getTextLength();
  }
  leafNode=(LeafElement)scopeNode.findLeafElementAt(offsetR);
  return leafNode;
}
