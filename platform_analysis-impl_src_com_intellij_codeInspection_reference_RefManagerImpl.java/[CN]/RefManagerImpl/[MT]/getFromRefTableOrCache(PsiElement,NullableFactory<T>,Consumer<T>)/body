{
  PsiAnchor psiAnchor=createAnchor(element);
  T result=(T)myRefTable.get(psiAnchor);
  if (result != null)   return result;
  if (!isValidPointForReference()) {
    return null;
  }
  result=(T)myRefTable.get(psiAnchor);
  if (result != null)   return result;
  result=factory.create();
  if (result == null)   return null;
  RefElement prev=myRefTable.putIfAbsent(psiAnchor,result);
  if (prev == null) {
    if (whenCached != null)     whenCached.consume(result);
  }
 else {
    result=(T)prev;
  }
  return result;
}
