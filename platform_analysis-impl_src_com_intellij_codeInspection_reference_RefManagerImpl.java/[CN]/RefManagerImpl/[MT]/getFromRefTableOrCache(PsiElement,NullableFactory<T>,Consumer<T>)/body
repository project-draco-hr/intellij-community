{
  PsiAnchor psiAnchor=createAnchor(element);
  T result;
synchronized (myRefTable) {
    result=(T)myRefTable.get(psiAnchor);
    if (result != null)     return result;
    if (!isValidPointForReference()) {
      return null;
    }
    result=factory.create();
    if (result == null)     return null;
    myRefTable.put(psiAnchor,result);
  }
  if (whenCached != null) {
    whenCached.consume(result);
  }
  return result;
}
