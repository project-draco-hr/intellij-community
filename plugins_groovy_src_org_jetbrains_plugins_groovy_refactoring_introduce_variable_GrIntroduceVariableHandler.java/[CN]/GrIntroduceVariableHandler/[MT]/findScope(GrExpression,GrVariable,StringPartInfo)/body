{
  final PsiElement scope=stringPartInfo != null ? GroovyRefactoringUtil.getEnclosingContainer(stringPartInfo.getLiteral()) : GroovyRefactoringUtil.getEnclosingContainer(selectedExpr);
  if (scope == null || !(scope instanceof GroovyPsiElement)) {
    throw new GrRefactoringError(GroovyRefactoringBundle.message("refactoring.is.not.supported.in.the.current.context",REFACTORING_NAME));
  }
  if (!GroovyRefactoringUtil.isAppropriateContainerForIntroduceVariable(scope)) {
    throw new GrRefactoringError(GroovyRefactoringBundle.message("refactoring.is.not.supported.in.the.current.context",REFACTORING_NAME));
  }
  return scope;
}
