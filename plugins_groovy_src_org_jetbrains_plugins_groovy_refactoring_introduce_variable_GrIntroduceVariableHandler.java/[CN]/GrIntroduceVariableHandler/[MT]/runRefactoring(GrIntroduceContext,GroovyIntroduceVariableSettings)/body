{
  final GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(context.getProject());
  final String[] modifiers=settings.isDeclareFinal() ? new String[]{PsiModifier.FINAL} : null;
  final GrVariableDeclaration varDecl=factory.createVariableDeclaration(modifiers,"foo",settings.getSelectedType(),settings.getName());
  generateInitializer(context,varDecl.getVariables()[0]);
  try {
    GrVariable insertedVar;
    if (context.getStringPart() != null) {
      insertedVar=processStringPart(context,settings,varDecl);
    }
 else {
      insertedVar=processExpression(context,settings,factory,varDecl);
    }
    if (context.getEditor() != null && getPositionMarker() != null) {
      context.getEditor().getCaretModel().moveToOffset(getPositionMarker().getTextRange().getEndOffset());
      context.getEditor().getSelectionModel().removeSelection();
    }
    return insertedVar;
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
  return null;
}
