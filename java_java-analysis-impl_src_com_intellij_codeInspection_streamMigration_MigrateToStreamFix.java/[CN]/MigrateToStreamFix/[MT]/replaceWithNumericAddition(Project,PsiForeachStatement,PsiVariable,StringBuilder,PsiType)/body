{
  PsiElementFactory elementFactory=JavaPsiFacade.getElementFactory(project);
  restoreComments(foreachStatement,foreachStatement.getBody());
  if (StreamApiMigrationInspection.isDeclarationJustBefore(var,foreachStatement)) {
    PsiExpression initializer=var.getInitializer();
    if (ExpressionUtils.isZero(initializer)) {
      PsiType type=var.getType();
      String replacement=(type.equals(expressionType) ? "" : "(" + type.getCanonicalText() + ") ") + builder;
      initializer.replace(elementFactory.createExpressionFromText(replacement,foreachStatement));
      removeLoop(foreachStatement);
      simplifyAndFormat(project,var);
      return;
    }
  }
  PsiElement result=foreachStatement.replace(elementFactory.createStatementFromText(var.getName() + "+=" + builder+ ";",foreachStatement));
  simplifyAndFormat(project,result);
}
