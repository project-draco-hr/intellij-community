{
  PsiElement element=descriptor.getPsiElement();
  if (element instanceof PsiForeachStatement) {
    PsiForeachStatement foreachStatement=(PsiForeachStatement)element;
    PsiStatement body=foreachStatement.getBody();
    final PsiExpression iteratedValue=foreachStatement.getIteratedValue();
    if (body != null && iteratedValue != null) {
      final PsiParameter parameter=foreachStatement.getIterationParameter();
      StreamApiMigrationInspection.TerminalBlock tb=StreamApiMigrationInspection.TerminalBlock.from(parameter,body);
      if (!FileModificationService.getInstance().preparePsiElementForWrite(foreachStatement))       return;
      List<Operation> operations=tb.extractOperations();
      migrate(project,descriptor,foreachStatement,iteratedValue,body,tb,operations);
    }
  }
}
