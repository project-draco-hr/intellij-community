{
  TemplatesGroup group=getSelectedGroup();
  if (group == null)   return null;
  if (myCurrentCard == Cards.TEMPLATES) {
    return myTemplatesList.getSelectedTemplate();
  }
  Collection<ProjectTemplate> templates=myTemplatesMap.get(group);
  if (!templates.isEmpty())   return templates.iterator().next();
  final ModuleBuilder builder=group.getModuleBuilder();
  Map.Entry<ProjectTemplate,ModuleBuilder> entry=ContainerUtil.find(myBuilders.entrySet(),new Condition<Map.Entry<ProjectTemplate,ModuleBuilder>>(){
    @Override public boolean value(    Map.Entry<ProjectTemplate,ModuleBuilder> entry){
      return entry.getValue() == builder;
    }
  }
);
  return entry == null ? null : entry.getKey();
}
