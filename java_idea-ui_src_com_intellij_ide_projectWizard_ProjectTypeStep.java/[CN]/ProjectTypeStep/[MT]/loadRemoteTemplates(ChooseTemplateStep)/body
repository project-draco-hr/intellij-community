{
  ProgressManager.getInstance().run(new Task.Backgroundable(myContext.getProject(),"Loading Templates"){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      try {
        myTemplatesList.setPaintBusy(true);
        chooseTemplateStep.getTemplateList().setPaintBusy(true);
        RemoteTemplatesFactory factory=new RemoteTemplatesFactory();
        for (        String group : factory.getGroups()) {
          ProjectTemplate[] templates=factory.createTemplates(group,myContext);
          for (          ProjectTemplate template : templates) {
            String id=((ArchivedProjectTemplate)template).getCategory();
            for (            TemplatesGroup templatesGroup : myTemplatesMap.keySet()) {
              if (Comparing.equal(id,templatesGroup.getId()) || Comparing.equal(group,templatesGroup.getName())) {
                myTemplatesMap.putValue(templatesGroup,template);
              }
            }
          }
        }
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            TemplatesGroup group=getSelectedGroup();
            if (group == null)             return;
            Collection<ProjectTemplate> templates=myTemplatesMap.get(group);
            setTemplatesList(group,templates,true);
            chooseTemplateStep.updateStep();
          }
        }
);
      }
  finally {
        myTemplatesList.setPaintBusy(false);
        chooseTemplateStep.getTemplateList().setPaintBusy(false);
      }
    }
  }
);
}
