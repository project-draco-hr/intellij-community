{
  PsiExpression expression=resource.getExpression();
  if (expression instanceof PsiThisExpression)   return null;
  if (expression instanceof PsiReferenceExpression) {
    PsiElement target=((PsiReferenceExpression)expression).resolve();
    if (target == null)     return null;
    if (target instanceof PsiVariable) {
      PsiVariable variable=(PsiVariable)target;
      PsiModifierList modifierList=variable.getModifierList();
      if (modifierList != null && modifierList.hasModifierProperty(PsiModifier.FINAL))       return null;
      PsiElement scope=null;
      if (variable instanceof PsiParameter)       scope=((PsiParameter)variable).getDeclarationScope();
 else       if (variable instanceof PsiResourceVariable)       scope=variable.getParent().getParent();
 else       if (variable instanceof PsiLocalVariable)       scope=PsiTreeUtil.getParentOfType(variable,PsiCodeBlock.class);
      if (scope != null) {
        if (HighlightControlFlowUtil.isEffectivelyFinal(variable,scope,null))         return null;
      }
    }
    String text=JavaErrorMessages.message("resource.variable.must.be.final");
    return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(expression).descriptionAndTooltip(text).create();
  }
  return null;
}
