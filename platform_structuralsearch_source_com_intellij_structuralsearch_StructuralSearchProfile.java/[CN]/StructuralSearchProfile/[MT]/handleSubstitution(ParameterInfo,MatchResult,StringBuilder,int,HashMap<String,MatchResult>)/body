{
  if (info.getName().equals(match.getName())) {
    String replacementString=match.getMatchImage();
    boolean forceAddingNewLine=false;
    if (match.hasSons() && !match.isScopeMatch()) {
      StringBuilder buf=new StringBuilder();
      for (      final MatchResult matchResult : match.getAllSons()) {
        final PsiElement currentElement=matchResult.getMatch();
        if (buf.length() > 0) {
          if (info.isArgumentContext()) {
            buf.append(',');
          }
 else {
            buf.append(' ');
          }
        }
        buf.append(matchResult.getMatchImage());
        forceAddingNewLine=currentElement instanceof PsiComment;
      }
      replacementString=buf.toString();
    }
 else {
      if (info.isStatementContext()) {
        forceAddingNewLine=match.getMatch() instanceof PsiComment;
      }
    }
    offset=Replacer.insertSubstitution(result,offset,info,replacementString);
    if (forceAddingNewLine && info.isStatementContext()) {
      result.insert(info.getStartIndex() + offset + 1,'\n');
      offset++;
    }
  }
  return offset;
}
