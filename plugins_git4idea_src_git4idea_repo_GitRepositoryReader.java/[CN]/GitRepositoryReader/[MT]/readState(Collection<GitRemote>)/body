{
  Pair<Set<GitLocalBranch>,Set<GitRemoteBranch>> branches=readBranches(remotes);
  Set<GitLocalBranch> localBranches=branches.first;
  HeadInfo headInfo=readHead();
  Repository.State state=readRepositoryState(headInfo);
  GitLocalBranch currentBranch;
  String currentRevision;
  if (!headInfo.isBranch) {
    currentBranch=null;
    currentRevision=headInfo.content;
  }
 else   if (!localBranches.isEmpty()) {
    currentBranch=findCurrentBranch(headInfo,state,localBranches);
    currentRevision=getCurrentRevision(headInfo,currentBranch);
  }
 else   if (headInfo.content != null) {
    currentBranch=new GitLocalBranch(headInfo.content,GitBranch.DUMMY_HASH);
    currentRevision=null;
  }
 else {
    currentBranch=null;
    currentRevision=null;
  }
  return new GitBranchState(currentRevision,currentBranch,state,localBranches,branches.second);
}
