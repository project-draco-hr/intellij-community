{
  FileViewProvider viewProvider=myFileManager.createFileViewProvider(vFile,true);
  myFileManager.setViewProvider(vFile,viewProvider);
  PsiFile newPsiFile=myManager.findFile(vFile);
  if (newPsiFile == null) {
    return;
  }
  if (!viewProvider.isPhysical()) {
    Document document=viewProvider.getDocument();
    if (document != null) {
      PsiDocumentManagerBase.cachePsi(document,newPsiFile);
    }
  }
  if (parentDir != null) {
    PsiTreeChangeEventImpl treeEvent=new PsiTreeChangeEventImpl(myManager);
    treeEvent.setParent(parentDir);
    treeEvent.setOldChild(oldPsiFile);
    treeEvent.setNewChild(newPsiFile);
    myManager.childReplaced(treeEvent);
  }
}
