{
  PsiExpression toplevel=JavaI18nUtil.getTopLevelExpression(expression);
  PsiVariable var=null;
  if (toplevel instanceof PsiAssignmentExpression) {
    PsiExpression lExpression=((PsiAssignmentExpression)toplevel).getLExpression();
    while (lExpression instanceof PsiArrayAccessExpression) {
      lExpression=((PsiArrayAccessExpression)lExpression).getArrayExpression();
    }
    if (lExpression instanceof PsiReferenceExpression) {
      final PsiElement resolved=((PsiReferenceExpression)lExpression).resolve();
      if (resolved instanceof PsiVariable)       var=(PsiVariable)resolved;
    }
  }
  if (var == null) {
    PsiElement parent=toplevel.getParent();
    if (parent instanceof PsiVariable && toplevel.equals(((PsiVariable)parent).getInitializer())) {
      var=(PsiVariable)parent;
    }
 else     if (parent instanceof PsiSwitchLabelStatement) {
      final PsiSwitchStatement switchStatement=((PsiSwitchLabelStatement)parent).getEnclosingSwitchStatement();
      if (switchStatement != null) {
        final PsiExpression switchStatementExpression=switchStatement.getExpression();
        if (switchStatementExpression instanceof PsiReferenceExpression) {
          final PsiElement resolved=((PsiReferenceExpression)switchStatementExpression).resolve();
          if (resolved instanceof PsiVariable)           var=(PsiVariable)resolved;
        }
      }
    }
  }
  if (var != null) {
    if (annotatedAsNonNls(var)) {
      return true;
    }
    if (ignoreAssignedToConstants && var.hasModifierProperty(PsiModifier.STATIC) && var.hasModifierProperty(PsiModifier.FINAL)) {
      return true;
    }
    nonNlsTargets.add(var);
  }
  return false;
}
