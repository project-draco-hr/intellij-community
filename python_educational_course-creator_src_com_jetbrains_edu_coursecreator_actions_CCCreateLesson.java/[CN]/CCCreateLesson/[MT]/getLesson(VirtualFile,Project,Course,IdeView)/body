{
  VirtualFile courseDir=project.getBaseDir();
  String lessonName;
  int lessonIndex;
  if (sourceDirectory.equals(courseDir)) {
    lessonIndex=course.getLessons().size() + 1;
    String suggestedName=EduNames.LESSON + lessonIndex;
    lessonName=view == null ? suggestedName : Messages.showInputDialog("Name:",TITLE,null,suggestedName,null);
  }
 else {
    Lesson sourceLesson=course.getLesson(sourceDirectory.getName());
    if (sourceLesson == null) {
      return null;
    }
    final int index=sourceLesson.getIndex();
    CCCreateStudyItemDialog dialog=new CCCreateStudyItemDialog(project,EduNames.LESSON,sourceLesson.getName(),index);
    dialog.show();
    if (dialog.getExitCode() != DialogWrapper.OK_EXIT_CODE) {
      return null;
    }
    lessonName=dialog.getName();
    lessonIndex=index + dialog.getIndexDelta();
  }
  if (lessonName == null) {
    return null;
  }
  return createAndInitLesson(course,lessonName,lessonIndex);
}
