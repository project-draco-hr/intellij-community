{
  final DocumentImpl doc=new DocumentImpl("foo1\nfoo2\nfoo3\nfoo4");
  Editor editor=EditorFactory.getInstance().createEditor(doc);
  final FoldingModel model=editor.getFoldingModel();
  try {
    model.runBatchFoldingOperation(new Runnable(){
      @Override public void run(){
        model.addFoldRegion(0,4,"/*...*/");
        model.addFoldRegion(5,9,"/*...*/");
      }
    }
);
    assertSize(2,model.getAllFoldRegions());
    WriteCommandAction.runWriteCommandAction(getProject(),new Runnable(){
      @Override public void run(){
        doc.deleteString(0,5);
      }
    }
);
    assertSize(1,model.getAllFoldRegions());
  }
  finally {
    EditorFactory.getInstance().releaseEditor(editor);
  }
}
