{
  if (channel.isOpen()) {
    ByteBuf lengthBuffer=channel.alloc().buffer(4);
    lengthBuffer.writeInt(message.readableBytes());
    channel.write(lengthBuffer);
    return channel.writeAndFlush(message);
  }
 else {
    return channel.newFailedFuture(new ClosedChannelException());
  }
}
