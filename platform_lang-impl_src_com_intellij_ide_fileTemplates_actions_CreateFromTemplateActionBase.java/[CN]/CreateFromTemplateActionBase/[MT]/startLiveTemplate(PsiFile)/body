{
  Project project=file.getProject();
  final Editor editor=EditorHelper.openInEditor(file);
  if (editor == null)   return;
  final TemplateImpl template=new TemplateImpl("",file.getText(),"");
  template.setInline(true);
  int count=template.getSegmentsCount();
  if (count == 0)   return;
  Set<String> variables=new HashSet<String>();
  for (int i=0; i < count; i++) {
    variables.add(template.getSegmentName(i));
  }
  variables.removeAll(TemplateImpl.INTERNAL_VARS_SET);
  for (  String variable : variables) {
    template.addVariable(variable,null,"\"" + variable + "\"",true);
  }
  WriteCommandAction.runWriteCommandAction(project,new Runnable(){
    @Override public void run(){
      editor.getDocument().setText(template.getTemplateText());
    }
  }
);
  TemplateManager.getInstance(project).startTemplate(editor,template);
}
