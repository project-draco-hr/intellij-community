{
  LOG.assertTrue(SwingUtilities.isEventDispatchThread());
  myHideAlarm.cancelAllRequests();
  hideHints(HIDE_BY_OTHER_HINT,false,false);
  if (editor != myLastEditor) {
    hideAllHints();
  }
  if (!ApplicationManager.getApplication().isUnitTestMode() && !editor.getContentComponent().isShowing())   return;
  if (!ApplicationManager.getApplication().isActive())   return;
  updateLastEditor(editor);
  getPublisher().hintShown(editor.getProject(),hint,flags);
  Component component=hint.getComponent();
  if (ScreenReader.isActive()) {
    hintInfo.setRequestFocus(true);
  }
  doShowInGivenLocation(hint,editor,p,hintInfo,true);
  ListenerUtil.addMouseListener(component,new MouseAdapter(){
    @Override public void mousePressed(    MouseEvent e){
      myHideAlarm.cancelAllRequests();
    }
  }
);
  ListenerUtil.addFocusListener(component,new FocusAdapter(){
    @Override public void focusGained(    FocusEvent e){
      myHideAlarm.cancelAllRequests();
    }
  }
);
  if (BitUtil.isSet(flags,HIDE_BY_MOUSEOVER)) {
    ListenerUtil.addMouseMotionListener(component,new MouseMotionAdapter(){
      @Override public void mouseMoved(      MouseEvent e){
        hideHints(HIDE_BY_MOUSEOVER,true,false);
      }
    }
);
  }
  myHintsStack.add(new HintInfo(hint,flags,reviveOnEditorChange));
  if (timeout > 0) {
    Timer timer=UIUtil.createNamedTimer("Hint timeout",timeout,new ActionListener(){
      @Override public void actionPerformed(      ActionEvent event){
        hint.hide();
      }
    }
);
    timer.setRepeats(false);
    timer.start();
  }
}
