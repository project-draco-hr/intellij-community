{
  final Runnable performCheckoutAction=new Runnable(){
    @Override public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
      finishAction.run();
    }
  }
;
  if (VcsConfiguration.getInstance(myProject).REARRANGE_BEFORE_PROJECT_COMMIT) {
    new RearrangeCodeProcessor(myProject,BeforeCheckinHandlerUtil.getPsiFiles(myProject,myPanel.getVirtualFiles()),COMMAND_NAME,performCheckoutAction).run();
  }
 else {
    performCheckoutAction.run();
  }
}
