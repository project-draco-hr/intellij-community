{
  final Document document=context.getDocument();
  final PsiFile file=context.getFile();
  final PsiMethod method=getObject();
  final LookupElement[] allItems=context.getElements();
  final boolean overloadsMatter=allItems.length == 1 && getUserData(JavaCompletionUtil.FORCE_SHOW_SIGNATURE_ATTR) == null;
  final boolean hasParams=MethodParenthesesHandler.hasParams(this,allItems,overloadsMatter,method);
  JavaCompletionUtil.insertParentheses(context,this,overloadsMatter,hasParams);
  final int startOffset=context.getStartOffset();
  final OffsetKey refStart=context.trackOffset(startOffset,true);
  if (shouldInsertTypeParameters() && mayNeedTypeParameters(context.getFile().findElementAt(context.getStartOffset()))) {
    qualifyMethodCall(file,startOffset,document);
    insertExplicitTypeParameters(context,refStart);
  }
 else   if (myHelper != null) {
    context.commitDocument();
    importOrQualify(document,file,method,startOffset);
  }
  final PsiType type=method.getReturnType();
  if (context.getCompletionChar() == '!' && type != null && PsiType.BOOLEAN.isAssignableFrom(type)) {
    context.setAddCompletionChar(false);
    context.commitDocument();
    final int offset=context.getOffset(refStart);
    final PsiMethodCallExpression methodCall=PsiTreeUtil.findElementOfClassAtOffset(file,offset,PsiMethodCallExpression.class,false);
    if (methodCall != null) {
      FeatureUsageTracker.getInstance().triggerFeatureUsed(CodeCompletionFeatures.EXCLAMATION_FINISH);
      document.insertString(methodCall.getTextRange().getStartOffset(),"!");
    }
  }
  if (hasParams && context.getCompletionChar() != Lookup.COMPLETE_STATEMENT_SELECT_CHAR && Registry.is("java.completion.argument.live.template")) {
    startArgumentLiveTemplate(context,method);
  }
}
