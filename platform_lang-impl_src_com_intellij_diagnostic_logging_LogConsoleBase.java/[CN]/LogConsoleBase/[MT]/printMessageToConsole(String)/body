{
  final ConsoleView console=getConsoleNotNull();
  if (myContentPreprocessor != null) {
    List<LogFragment> fragments=myContentPreprocessor.parseLogLine(line + '\n');
    for (    LogFragment fragment : fragments) {
      ConsoleViewContentType consoleViewType=ConsoleViewContentType.getConsoleViewType(fragment.getOutputType());
      if (consoleViewType != null) {
        String formattedText=myFormatter.formatMessage(fragment.getText());
        console.print(formattedText,consoleViewType);
      }
    }
    return line.length() + 1;
  }
 else {
    final LogFilterModel.MyProcessingResult processingResult=myModel.processLine(line);
    if (processingResult.isApplicable()) {
      final Key key=processingResult.getKey();
      if (key != null) {
        ConsoleViewContentType type=ConsoleViewContentType.getConsoleViewType(key);
        if (type != null) {
          final String messagePrefix=processingResult.getMessagePrefix();
          if (messagePrefix != null) {
            String formattedPrefix=myFormatter.formatPrefix(messagePrefix);
            console.print(formattedPrefix,type);
          }
          String formattedMessage=myFormatter.formatMessage(line);
          console.print(formattedMessage + "\n",type);
          return (messagePrefix != null ? messagePrefix.length() : 0) + line.length() + 1;
        }
      }
    }
    return 0;
  }
}
