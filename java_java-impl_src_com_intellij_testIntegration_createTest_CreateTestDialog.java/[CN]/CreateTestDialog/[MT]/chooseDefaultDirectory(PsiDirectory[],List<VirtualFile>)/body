{
  List<PsiDirectory> dirs=new ArrayList<>();
  for (  VirtualFile file : ModuleRootManager.getInstance(myTargetModule).getSourceRoots(JavaSourceRootType.TEST_SOURCE)) {
    final PsiDirectory dir=PsiManager.getInstance(myProject).findDirectory(file);
    if (dir != null) {
      dirs.add(dir);
    }
  }
  if (!dirs.isEmpty()) {
    for (    PsiDirectory dir : dirs) {
      final String dirName=dir.getVirtualFile().getPath();
      if (dirName.contains("generated"))       continue;
      return dir;
    }
    return dirs.get(0);
  }
  for (  PsiDirectory dir : directories) {
    final VirtualFile file=dir.getVirtualFile();
    for (    VirtualFile root : roots) {
      if (VfsUtilCore.isAncestor(root,file,false)) {
        final PsiDirectory rootDir=PsiManager.getInstance(myProject).findDirectory(root);
        if (rootDir != null) {
          return rootDir;
        }
      }
    }
  }
  return null;
}
