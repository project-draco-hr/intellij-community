{
  for (Iterator<IdeaPluginDescriptor> i=list.iterator(); i.hasNext(); ) {
    PluginNode node=(PluginNode)i.next();
    if (node.getPluginId() == null || repositoryUrl != null && node.getDownloadUrl() == null) {
      LOG.warn("Malformed plugin record (id:" + node.getPluginId() + " repository:"+ repositoryUrl+ ")");
      i.remove();
      continue;
    }
    if (repositoryUrl != null) {
      node.setRepositoryName(repositoryUrl);
    }
    if (node.getName() == null) {
      String url=node.getDownloadUrl();
      String name=FileUtil.getNameWithoutExtension(url.substring(url.lastIndexOf('/') + 1));
      node.setName(name);
    }
  }
  return list;
}
