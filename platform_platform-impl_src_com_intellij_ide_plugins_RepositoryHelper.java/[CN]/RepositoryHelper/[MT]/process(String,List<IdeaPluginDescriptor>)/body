{
  for (Iterator<IdeaPluginDescriptor> i=list.iterator(); i.hasNext(); ) {
    IdeaPluginDescriptor descriptor=i.next();
    if (descriptor.getPluginId() == null || descriptor.getUrl() == null) {
      LOG.warn("Malformed plugin record at " + repositoryUrl);
      i.remove();
    }
 else     if (descriptor instanceof PluginNode) {
      PluginNode node=(PluginNode)descriptor;
      if (repositoryUrl != null) {
        node.setRepositoryName(repositoryUrl);
      }
      if (node.getName() == null) {
        String url=node.getUrl();
        String name=FileUtil.getNameWithoutExtension(url.substring(url.lastIndexOf('/') + 1));
        ((PluginNode)descriptor).setName(name);
      }
    }
  }
  return list;
}
