{
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myProject);
  final Document document=editor.getDocument();
  final PsiFile psiFile=documentManager.getPsiFile(document);
  if (psiFile instanceof PsiClassOwner && psiFile.isPhysical()) {
    SrcFileAnnotator annotator=getAnnotator(editor);
    if (annotator == null) {
      annotator=new SrcFileAnnotator(psiFile,editor);
    }
    annotator.hideCoverageData();
    if (myCurrentSuite != null) {
      final List<PsiPackage> packages=getCurrentSuitePackages();
      if (isUnderFilteredPackages((PsiClassOwner)psiFile,packages)) {
        annotator.showCoverageInformation(myCurrentSuite);
      }
 else {
        final List<PsiClass> classes=getCurrentSuiteClasses();
        for (        PsiClass aClass : classes) {
          final PsiFile containingFile=aClass.getContainingFile();
          if (psiFile.equals(containingFile)) {
            annotator.showCoverageInformation(myCurrentSuite);
            break;
          }
        }
      }
    }
    myAnnotators.put(editor,annotator);
  }
}
