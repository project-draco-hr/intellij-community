{
  final RunProfile profile=getEnvironment().getRunProfile();
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    RunContentDescriptor contentDescriptor=new RunContentDescriptor(profile,myExecutionResult,myUi);
    Disposer.register(contentDescriptor,this);
    return contentDescriptor;
  }
  final ExecutionConsole console=myExecutionResult.getExecutionConsole();
  if (console != null) {
    if (console instanceof ExecutionConsoleEx) {
      ((ExecutionConsoleEx)console).buildUi(myUi);
    }
 else {
      buildConsoleUiDefault(myUi,console);
    }
    initLogConsoles(profile,myExecutionResult.getProcessHandler(),console);
  }
  RunContentDescriptor contentDescriptor=new RunContentDescriptor(profile,myExecutionResult,myUi);
  Disposer.register(contentDescriptor,this);
  myUi.getOptions().setLeftToolbar(createActionToolbar(contentDescriptor),ActionPlaces.UNKNOWN);
  if (profile instanceof RunConfigurationBase) {
    if (console instanceof ObservableConsoleView && !ApplicationManager.getApplication().isUnitTestMode()) {
      ((ObservableConsoleView)console).addChangeListener(new ConsoleToFrontListener((RunConfigurationBase)profile,getProject(),getEnvironment().getExecutor(),contentDescriptor,myUi),this);
    }
  }
  return contentDescriptor;
}
