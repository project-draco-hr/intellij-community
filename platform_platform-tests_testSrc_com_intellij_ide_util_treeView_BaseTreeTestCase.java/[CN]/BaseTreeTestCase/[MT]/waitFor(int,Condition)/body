{
  boolean isDispatchThread=ApplicationManager.getApplication().isDispatchThread();
  long start=System.currentTimeMillis();
  while (System.currentTimeMillis() - start < timeoutMs) {
    if (condition.value(null))     return true;
    if (isDispatchThread)     UIUtil.dispatchAllInvocationEvents();
  }
  return false;
}
