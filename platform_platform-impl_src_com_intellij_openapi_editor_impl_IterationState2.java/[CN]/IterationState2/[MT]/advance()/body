{
  myStartOffset=myEndOffset;
  advanceSegmentHighlighters();
  advanceCurrentSelectionIndex();
  advanceCurrentVirtualSelectionIndex();
  if (!myUseOnlyFullLineHighlighters) {
    myCurrentFold=myFoldingModel.getCollapsedRegionAtOffset(myReverseIteration ? myStartOffset - 1 : myStartOffset);
  }
  if (myCurrentFold != null) {
    myEndOffset=myReverseIteration ? myCurrentFold.getStartOffset() : myCurrentFold.getEndOffset();
  }
 else {
    myEndOffset=getHighlighterEnd(myStartOffset);
    setEndOffsetIfCloser(getSelectionEnd());
    setEndOffsetIfCloser(getMinSegmentHighlightersEnd());
    setEndOffsetIfCloser(getFoldRangesEnd(myStartOffset));
    setEndOffsetIfCloser(getCaretEnd(myStartOffset));
    setEndOffsetIfCloser(getGuardedBlockEnd(myStartOffset));
  }
  reinit();
}
