{
  try {
    VirtualFile windowCopy=answerFile.copy(this,answerFile.getParent(),"window" + taskWindow.getIndex() + ".py");
    final FileDocumentManager documentManager=FileDocumentManager.getInstance();
    final Document windowDocument=documentManager.getDocument(windowCopy);
    if (windowDocument != null) {
      TaskFile windowTaskFile=new TaskFile();
      TaskFile.copy(answerTaskFile,windowTaskFile);
      StudyDocumentListener listener=new StudyDocumentListener(windowTaskFile);
      windowDocument.addDocumentListener(listener);
      int start=taskWindow.getRealStartOffset(windowDocument);
      int end=start + taskWindow.getLength();
      TaskWindow userTaskWindow=usersTaskFile.getTaskWindows().get(taskWindow.getIndex());
      int userStart=userTaskWindow.getRealStartOffset(usersDocument);
      int userEnd=userStart + userTaskWindow.getLength();
      String text=usersDocument.getText(new TextRange(userStart,userEnd));
      windowDocument.replaceString(start,end,text);
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          documentManager.saveDocument(windowDocument);
        }
      }
);
      Process smartTestProcess=testRunner.launchTests(project,windowCopy.getNameWithoutExtension());
      boolean res=testRunner.testsPassed(smartTestProcess);
      userTaskWindow.setStatus(res ? StudyStatus.Solved : StudyStatus.Failed);
      windowCopy.delete(this);
    }
  }
 catch (  IOException e) {
    LOG.error(e);
  }
catch (  ExecutionException e) {
    e.printStackTrace();
  }
}
