{
  return new ImagePainter(){
    Image image;
    float alpha;
    Insets insets;
    Fill fillType;
    Place place;
    String current;
    @Override public boolean needsRepaint(){
      return ensureImageLoaded();
    }
    @Override public void executePaint(    Component component,    Graphics2D g){
      if (image == null)       return;
      executePaint(g,component,image,fillType,place,alpha,insets);
    }
    boolean ensureImageLoaded(){
      String value=StringUtil.notNullize(PropertiesComponent.getInstance().getValue(propertyName),System.getProperty(propertyName,""));
      if (!Comparing.equal(value,current)) {
        current=value;
        loadImageAsync(value);
      }
      return image != null;
    }
    private void resetImage(    String value,    Image newImage,    float newAlpha,    Fill newFill,    Place newPlace){
      if (!Comparing.equal(current,value))       return;
      boolean prevOk=image != null;
      clearImages(-1);
      image=newImage;
      insets=JBUI.emptyInsets();
      alpha=newAlpha;
      fillType=newFill;
      place=newPlace;
      boolean newOk=newImage != null;
      if (prevOk || newOk) {
        repaintAllWindows();
      }
    }
    private void loadImageAsync(    final String propertyValue){
      String[] parts=(propertyValue != null ? propertyValue : propertyName + ".png").split(",");
      final float newAlpha=Math.abs(Math.min(StringUtil.parseInt(parts.length > 1 ? parts[1] : "",10) / 100f,1f));
      final Fill newFillType=StringUtil.parseEnum(parts.length > 2 ? parts[2].toUpperCase(Locale.ENGLISH) : "",Fill.SCALE,Fill.class);
      final Place newPlace=StringUtil.parseEnum(parts.length > 3 ? parts[3].toUpperCase(Locale.ENGLISH) : "",Place.CENTER,Place.class);
      String filePath=parts[0];
      if (StringUtil.isEmpty(filePath)) {
        resetImage(propertyValue,null,newAlpha,newFillType,newPlace);
        return;
      }
      try {
        URL url=filePath.contains("://") ? new URL(filePath) : (FileUtil.isAbsolutePlatformIndependent(filePath) ? new File(filePath) : new File(PathManager.getConfigPath(),filePath)).toURI().toURL();
        ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
          @Override public void run(){
            final Image m=ImageLoader.loadFromUrl(url);
            ApplicationManager.getApplication().invokeLater(new Runnable(){
              @Override public void run(){
                resetImage(propertyValue,m,newAlpha,newFillType,newPlace);
              }
            }
,modalityState);
          }
        }
);
      }
 catch (      Exception e) {
        resetImage(propertyValue,null,newAlpha,newFillType,newPlace);
      }
    }
  }
;
}
