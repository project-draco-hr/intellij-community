{
  int cw0=component.getWidth();
  int ch0=component.getHeight();
  Insets i=JBUI.insets(insets.top * ch0 / 100,insets.left * cw0 / 100,insets.bottom * ch0 / 100,insets.right * cw0 / 100);
  int cw=cw0 - i.left - i.right;
  int ch=ch0 - i.top - i.bottom;
  int w=image.getWidth(null);
  int h=image.getHeight(null);
  if (w <= 0 || h <= 0)   return;
  @Nullable GraphicsConfiguration cfg=g.getDeviceConfiguration();
  Cached cached=cachedMap.get(cfg);
  VolatileImage scaled=cached == null ? null : cached.image;
  if (fillType == Fill.SCALE || fillType == Fill.TILE) {
    int sw, sh;
    if (fillType == Fill.SCALE) {
      boolean useWidth=cw * h > ch * w;
      sw=useWidth ? cw : w * ch / h;
      sh=useWidth ? h * cw / w : ch;
    }
 else {
      sw=cw < w ? w : (cw + w) / w * w;
      sh=ch < h ? h : (ch + h) / h * h;
    }
    int sw0=scaled == null ? -1 : scaled.getWidth(null);
    int sh0=scaled == null ? -1 : scaled.getHeight(null);
    boolean rescale=cached == null || cached.used.width != sw || cached.used.height != sh;
    while ((scaled=validateImage(cfg,scaled)) == null || rescale) {
      if (scaled == null || sw0 < sw || sh0 < sh) {
        scaled=createImage(cfg,sw + sw / 10,sh + sh / 10);
        cachedMap.put(cfg,cached=new Cached(scaled,new Dimension(sw,sh)));
      }
 else {
        cached.used.setSize(sw,sh);
      }
      Graphics2D gg=scaled.createGraphics();
      gg.setComposite(AlphaComposite.Src);
      if (fillType == Fill.SCALE) {
        gg.setRenderingHint(RenderingHints.KEY_INTERPOLATION,RenderingHints.VALUE_INTERPOLATION_BILINEAR);
        gg.drawImage(image,0,0,sw,sh,null);
      }
 else {
        for (int x=0; x < sw; x+=w) {
          for (int y=0; y < sh; y+=h) {
            UIUtil.drawImage(gg,image,x,y,null);
          }
        }
      }
      gg.dispose();
      rescale=false;
    }
    w=sw;
    h=sh;
  }
 else {
    while ((scaled=validateImage(cfg,scaled)) == null) {
      scaled=createImage(cfg,w,h);
      cachedMap.put(cfg,cached=new Cached(scaled,new Dimension(w,h)));
      Graphics2D gg=scaled.createGraphics();
      gg.setComposite(AlphaComposite.Src);
      gg.drawImage(image,0,0,null);
      gg.dispose();
    }
  }
  long currentTime=System.currentTimeMillis();
  cached.touched=currentTime;
  if (cachedMap.size() > 2) {
    clearImages(currentTime);
  }
  int x, y;
  if (place == Place.CENTER || place == Place.TOP_CENTER || place == Place.BOTTOM_CENTER) {
    x=i.left + (cw - w) / 2;
    y=place == Place.TOP_CENTER ? i.top : place == Place.BOTTOM_CENTER ? ch0 - i.bottom - h : i.top + (ch - h) / 2;
  }
 else   if (place == Place.TOP_LEFT || place == Place.TOP_RIGHT || place == Place.BOTTOM_LEFT || place == Place.BOTTOM_RIGHT) {
    x=place == Place.TOP_LEFT || place == Place.BOTTOM_LEFT ? i.left : cw0 - i.right - w;
    y=place == Place.TOP_LEFT || place == Place.TOP_RIGHT ? i.top : ch0 - i.bottom - h;
  }
 else {
    return;
  }
  float adjustedAlpha=Boolean.TRUE.equals(g.getRenderingHint(IdeBackgroundUtil.ADJUST_ALPHA)) ? alpha / 2 : alpha;
  GraphicsConfig gc=new GraphicsConfig(g).setAlpha(adjustedAlpha);
  UIUtil.drawImage(g,scaled,x,y,w,h,null);
  gc.restore();
}
