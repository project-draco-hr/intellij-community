{
  Predicate<PsiFile> filter=null;
  for (  PsiElementFinder finder : filteredFinders()) {
    Predicate<PsiFile> finderFilter=finder.getPackageFilesFilter(psiPackage,scope);
    if (finderFilter != null) {
      if (filter == null) {
        filter=finderFilter;
      }
 else       if (filter instanceof AndPredicate) {
        ((AndPredicate<PsiFile>)filter).myComponents.add(finderFilter);
      }
 else {
        filter=new AndPredicate<PsiFile>(filter,finderFilter);
      }
    }
  }
  Set<PsiFile> result=new HashSet<PsiFile>();
  PsiDirectory[] directories=psiPackage.getDirectories(scope);
  for (  PsiDirectory directory : directories) {
    for (    PsiFile file : directory.getFiles()) {
      if (filter == null || filter.apply(file)) {
        result.add(file);
      }
    }
  }
  for (  PsiElementFinder finder : filteredFinders()) {
    Collections.addAll(result,finder.getPackageFiles(psiPackage,scope));
  }
  return result.toArray(new PsiFile[result.size()]);
}
