{
  super(project,GlobalSearchScope.allScope(project),true,true);
  myProject=project;
  myTitle=title;
  myVirtualFile=lightFile;
  EditorFactory editorFactory=EditorFactory.getInstance();
  myEditorDocument=FileDocumentManager.getInstance().getDocument(lightFile);
  if (myEditorDocument == null) {
    throw new AssertionError("no document for: " + lightFile);
  }
  myFile=psiFileFactory == null ? createFile(myProject,myVirtualFile) : psiFileFactory.fun(myVirtualFile,myProject);
  myConsoleEditor=(EditorEx)editorFactory.createEditor(myEditorDocument,myProject);
  myConsoleEditor.addFocusListener(myFocusListener);
  myCurrentEditor=myConsoleEditor;
  myHistoryViewer=(EditorEx)editorFactory.createViewer(((EditorFactoryImpl)editorFactory).createDocument(true),myProject);
  myBusConnection=myProject.getMessageBus().connect();
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      installEditorFactoryListener();
    }
  }
,myProject.getDisposed());
}
