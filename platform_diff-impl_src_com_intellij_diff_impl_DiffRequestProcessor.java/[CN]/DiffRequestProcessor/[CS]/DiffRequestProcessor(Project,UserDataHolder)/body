{
  myProject=project;
  myAvailableTools=DiffManagerEx.getInstance().getDiffTools();
  myToolOrder=new LinkedList<DiffTool>();
  myContext=new MyDiffContext(context);
  myActiveRequest=new NoDiffRequest();
  myDiffSettings=DiffSettingsHolder.getInstance().getSettings(getContextUserData(DiffUserDataKeysEx.PLACE));
  myPanel=new JPanel(new BorderLayout());
  myMainPanel=new MyPanel();
  myContentPanel=new ModifiablePanel();
  myToolbarPanel=new ModifiablePanel();
  myToolbarStatusPanel=new ModifiablePanel();
  myPanel.add(myMainPanel,BorderLayout.CENTER);
  JPanel topPanel=new JPanel(new BorderLayout());
  topPanel.add(myToolbarPanel,BorderLayout.CENTER);
  topPanel.add(myToolbarStatusPanel,BorderLayout.EAST);
  myMainPanel.add(topPanel,BorderLayout.NORTH);
  myMainPanel.add(myContentPanel,BorderLayout.CENTER);
  myMainPanel.setFocusTraversalPolicyProvider(true);
  myMainPanel.setFocusTraversalPolicy(new MyFocusTraversalPolicy());
  JComponent bottomPanel=myContext.getUserData(DiffUserDataKeysEx.BOTTOM_PANEL);
  if (bottomPanel != null)   myMainPanel.add(bottomPanel,BorderLayout.SOUTH);
  if (bottomPanel instanceof Disposable)   Disposer.register(this,(Disposable)bottomPanel);
  myOpenInEditorAction=new OpenInEditorAction(new Runnable(){
    @Override public void run(){
      onAfterNavigate();
    }
  }
);
}
