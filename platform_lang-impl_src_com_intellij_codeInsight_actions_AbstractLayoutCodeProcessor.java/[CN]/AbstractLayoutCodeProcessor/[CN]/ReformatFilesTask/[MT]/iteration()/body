{
  if (myStopFormatting) {
    return true;
  }
  if (!myFilesCountingFinished) {
    countingIteration();
    return true;
  }
  updateIndicator(myFilesProcessed);
  if (myFileTreeIterator.hasNext()) {
    final PsiFile file=myFileTreeIterator.next();
    myFilesProcessed++;
    if (file.isWritable() && canBeFormatted(file) && acceptedByFilters(file)) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          performFileProcessing(file);
        }
      }
);
    }
  }
  return true;
}
