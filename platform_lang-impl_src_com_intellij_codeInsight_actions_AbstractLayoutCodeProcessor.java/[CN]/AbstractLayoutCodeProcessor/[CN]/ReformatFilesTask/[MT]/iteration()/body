{
  if (myStopFormatting) {
    return true;
  }
  if (!myFilesCountingFinished) {
    updateIndicatorText(ApplicationBundle.message("bulk.reformat.prepare.progress.text"),"");
    countingIteration();
    return true;
  }
  updateIndicatorFraction(myFilesProcessed);
  if (hasFilesToProcess(myFileTreeIterator)) {
    PsiFile file=nextFile(myFileTreeIterator);
    myFilesProcessed++;
    if (shouldProcessFile(file)) {
      updateIndicatorText(ApplicationBundle.message("bulk.reformat.process.progress.text"),getPresentablePath(file));
      DumbService.getInstance(myProject).withAlternativeResolveEnabled(new Runnable(){
        @Override public void run(){
          performFileProcessing(file);
        }
      }
);
    }
  }
  return true;
}
