{
  PsiFile[] files=dir.getFiles();
  for (  PsiFile file : files) {
    if (canBeFormatted(file)) {
      array.add(file);
    }
  }
  if (recursive) {
    for (    PsiDirectory subdir : dir.getSubdirectories()) {
      collectFilesToProcess(array,subdir,recursive);
    }
  }
}
