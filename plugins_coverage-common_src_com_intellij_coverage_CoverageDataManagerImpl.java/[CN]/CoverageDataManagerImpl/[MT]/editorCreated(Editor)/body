{
  final PsiFile psiFile=ApplicationManager.getApplication().runReadAction(new Computable<PsiFile>(){
    @Nullable @Override public PsiFile compute(){
      if (myProject.isDisposed())       return null;
      final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myProject);
      final Document document=editor.getDocument();
      return documentManager.getPsiFile(document);
    }
  }
);
  if (psiFile != null && myCurrentSuitesBundle != null && psiFile.isPhysical()) {
    final CoverageEngine engine=myCurrentSuitesBundle.getCoverageEngine();
    if (!engine.coverageEditorHighlightingApplicableTo(psiFile)) {
      return;
    }
    SrcFileAnnotator annotator=getAnnotator(editor);
    if (annotator == null) {
      annotator=new SrcFileAnnotator(psiFile,editor);
    }
    if (myCurrentSuitesBundle != null) {
      if (engine.acceptedByFilters(psiFile,myCurrentSuitesBundle)) {
        annotator.showCoverageInformation(myCurrentSuitesBundle);
      }
    }
synchronized (ANNOTATORS_LOCK) {
      myAnnotators.put(editor,annotator);
    }
  }
}
