{
  PsiElement element=PsiTreeUtil.getParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PyBinaryExpression.class,false);
  while (element.getParent() instanceof PyBinaryExpression) {
    element=element.getParent();
  }
  StringBuilder stringLiteral=new StringBuilder();
  StringBuilder parameters=new StringBuilder("(");
  NotNullFunction<String,String> escaper=StringUtil.escaper(false,null);
  for (  PyExpression expression : getSimpleExpressions((PyBinaryExpression)element)) {
    if (expression instanceof PyStringLiteralExpression) {
      stringLiteral.append(escaper.fun(((PyStringLiteralExpression)expression).getStringValue()));
    }
 else {
      stringLiteral.append("%s");
      parameters.append(expression.getText()).append(", ");
    }
  }
  PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  PyStringLiteralExpression stringLiteralExpression=elementGenerator.createStringLiteralAlreadyEscaped("\"" + stringLiteral.toString() + "\"");
  PyParenthesizedExpression expression=(PyParenthesizedExpression)elementGenerator.createFromText(LanguageLevel.getDefault(),PyExpressionStatement.class,parameters.substring(0,parameters.length() - 2) + ")").getExpression();
  element.replace(elementGenerator.createBinaryExpression("%",stringLiteralExpression,expression));
}
