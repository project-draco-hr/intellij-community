{
  final List<PsiMethod> validEnclosingMethods=getEnclosingMethods(method);
  if (validEnclosingMethods.size() > 1 && !ApplicationManager.getApplication().isUnitTestMode()) {
    final EnclosingMethodSelectionDialog dialog=new EnclosingMethodSelectionDialog(method.getProject(),validEnclosingMethods);
    if (!dialog.showAndGet()) {
      return null;
    }
    method=dialog.getSelectedMethod();
  }
 else   if (validEnclosingMethods.size() == 1) {
    method=validEnclosingMethods.get(0);
  }
  return method;
}
