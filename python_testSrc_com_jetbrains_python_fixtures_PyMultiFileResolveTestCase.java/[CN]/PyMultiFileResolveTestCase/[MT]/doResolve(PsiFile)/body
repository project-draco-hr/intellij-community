{
  final PsiReference ref=PyResolveTestCase.findReferenceByMarker(psiFile);
  final PsiManagerEx psiManager=(PsiManagerEx)myFixture.getPsiManager();
  psiManager.setAssertOnFileLoadingFilter(new VirtualFileFilter(){
    @Override public boolean accept(    VirtualFile file){
      FileType fileType=file.getFileType();
      return fileType == PythonFileType.INSTANCE;
    }
  }
,getTestRootDisposable());
  final PsiElement result;
  if (ref instanceof PsiPolyVariantReference) {
    final ResolveResult[] resolveResults=((PsiPolyVariantReference)ref).multiResolve(false);
    result=resolveResults.length == 0 || !resolveResults[0].isValidResult() ? null : resolveResults[0].getElement();
  }
 else {
    result=ref.resolve();
  }
  psiManager.setAssertOnFileLoadingFilter(VirtualFileFilter.NONE,getTestRootDisposable());
  return result;
}
