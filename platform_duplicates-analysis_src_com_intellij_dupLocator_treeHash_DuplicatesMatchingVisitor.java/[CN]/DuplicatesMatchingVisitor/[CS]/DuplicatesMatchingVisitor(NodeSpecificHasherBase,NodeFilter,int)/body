{
  myNodeSpecificHasher=nodeSpecificHasher;
  myNodeFilter=nodeFilter;
  myDiscardCost=discardCost;
  myTreeHasher=new TreeHasherBase(null,myNodeSpecificHasher.getDuplicatesProfile(),discardCost){
    @Override protected TreeHashResult hash(    @NotNull PsiElement root,    PsiFragment upper,    @NotNull NodeSpecificHasher hasher){
      TreeHashResult result=myPsiElement2HashAndCost.get(root);
      if (result == null) {
        result=super.hash(root,upper,hasher);
        myPsiElement2HashAndCost.put(root,result);
      }
      return result;
    }
  }
;
}
