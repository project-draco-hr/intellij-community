{
  final LinkedHashMap<PluginId,PluginDownloader> toUpdate=new LinkedHashMap<PluginId,PluginDownloader>();
  final IdeaPluginDescriptor[] descriptors=new IdeaPluginDescriptor[]{loadDescriptor("plugin1.xml"),loadDescriptor("plugin2.xml")};
  final BuildNumber currentBuildNumber=BuildNumber.fromString("IU-142.100");
  for (  IdeaPluginDescriptor descriptor : descriptors) {
    UpdateChecker.checkAndPrepareToInstall(PluginDownloader.createDownloader(descriptor,null,currentBuildNumber),new InstalledPluginsState(new UpdateSettings()),toUpdate,new ArrayList<IdeaPluginDescriptor>(),null);
  }
  Assert.assertEquals("Found: " + toUpdate.size(),1,toUpdate.size());
  final PluginDownloader downloader=toUpdate.values().iterator().next();
  Assert.assertNotNull(downloader);
  Assert.assertEquals("0.1",downloader.getPluginVersion());
}
