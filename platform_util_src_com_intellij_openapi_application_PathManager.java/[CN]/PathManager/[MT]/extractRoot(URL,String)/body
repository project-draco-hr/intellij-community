{
  if (!(StringUtil.startsWithChar(resourcePath,'/') || StringUtil.startsWithChar(resourcePath,'\\'))) {
    log("precondition failed: " + resourcePath);
    return null;
  }
  String resultPath=null;
  String protocol=resourceURL.getProtocol();
  if (URLUtil.FILE_PROTOCOL.equals(protocol)) {
    String path=resourceURL.getFile();
    String testPath=path.replace('\\','/');
    String testResourcePath=resourcePath.replace('\\','/');
    if (StringUtil.endsWithIgnoreCase(testPath,testResourcePath)) {
      resultPath=path.substring(0,path.length() - resourcePath.length());
    }
  }
 else   if (URLUtil.JAR_PROTOCOL.equals(protocol)) {
    Pair<String,String> paths=URLUtil.splitJarUrl(resourceURL.getFile());
    if (paths != null) {
      resultPath=paths.first;
    }
  }
  if (resultPath == null) {
    log("cannot extract: " + resourcePath + " from "+ resourceURL);
    return null;
  }
  if (SystemInfo.isWindows && resultPath.startsWith("/")) {
    resultPath=resultPath.substring(1);
  }
  resultPath=StringUtil.trimEnd(resultPath,File.separator);
  resultPath=URLUtil.unescapePercentSequences(resultPath);
  return resultPath;
}
