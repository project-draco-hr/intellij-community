{
  String[] propFiles={System.getProperty(PROPERTIES_FILE),getUserPropertiesPath(),getUserHome() + "/idea.properties",getHomePath() + "/bin/idea.properties",getHomePath() + "/bin/" + getOSSpecificBinSubdir()+ "/idea.properties",getHomePath() + "/community/bin/idea.properties"};
  for (  String path : propFiles) {
    if (path != null) {
      File propFile=new File(path);
      if (propFile.exists()) {
        try {
          Reader fis=new BufferedReader(new FileReader(propFile));
          try {
            Map<String,String> properties=FileUtil.loadProperties(fis);
            Properties sysProperties=System.getProperties();
            for (            String key : properties.keySet()) {
              if (PROPERTY_HOME_PATH.equals(key) || PROPERTY_HOME.equals(key)) {
                log(propFile.getPath() + ": '" + PROPERTY_HOME_PATH+ "' and '"+ PROPERTY_HOME+ "' properties cannot be redefined");
              }
 else               if (sysProperties.getProperty(key,null) != null) {
                log(propFile.getPath() + ": '" + key+ "' already defined");
              }
 else {
                String value=substituteVars(properties.get(key));
                sysProperties.setProperty(key,value);
              }
            }
          }
  finally {
            fis.close();
          }
        }
 catch (        IOException e) {
          log("Problem reading from property file: " + propFile.getPath());
        }
      }
    }
  }
}
