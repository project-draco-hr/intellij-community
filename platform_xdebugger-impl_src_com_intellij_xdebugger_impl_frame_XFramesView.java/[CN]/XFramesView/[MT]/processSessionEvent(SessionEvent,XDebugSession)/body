{
  if (event == SessionEvent.BEFORE_RESUME) {
    return;
  }
  if (event == SessionEvent.FRAME_CHANGED) {
    XStackFrame currentStackFrame=session.getCurrentStackFrame();
    if (currentStackFrame != null) {
      myFramesList.setSelectedValue(currentStackFrame,true);
    }
    return;
  }
  myListenersEnabled=false;
  for (  StackFramesListBuilder builder : myBuilders.values()) {
    builder.dispose();
  }
  myBuilders.clear();
  mySelectedStack=null;
  XSuspendContext suspendContext=session.getSuspendContext();
  if (suspendContext == null) {
    requestClear(session);
    return;
  }
  if (event == SessionEvent.PAUSED) {
    cancelClear();
    clear(session);
  }
  XExecutionStack[] executionStacks=suspendContext.getExecutionStacks();
  addExecutionStacks(Arrays.asList(executionStacks));
  XExecutionStack activeExecutionStack=suspendContext.getActiveExecutionStack();
  myThreadComboBox.setSelectedItem(activeExecutionStack);
  myThreadsPanel.removeAll();
  myThreadsPanel.add(myToolbar.getComponent(),BorderLayout.EAST);
  final boolean invisible=executionStacks.length == 1 && StringUtil.isEmpty(executionStacks[0].getDisplayName());
  if (!invisible) {
    myThreadsPanel.add(myThreadComboBox,BorderLayout.CENTER);
  }
  myToolbar.setAddSeparatorFirst(!invisible);
  updateFrames(activeExecutionStack,session);
  myListenersEnabled=true;
}
