{
  if (variable == null) {
    final PsiElement target=referenceExpression.resolve();
    if (!(target instanceof PsiVariable)) {
      return null;
    }
    variable=(PsiVariable)target;
  }
  final PsiCodeBlock block=PsiTreeUtil.getParentOfType(variable,PsiCodeBlock.class);
  if (block == null) {
    return null;
  }
  final PsiElement[] defs=DefUseUtil.getDefs(block,variable,referenceExpression);
  if (defs.length != 1) {
    return null;
  }
  final PsiElement def=defs[0];
  if (def instanceof PsiVariable) {
    final PsiVariable target=(PsiVariable)def;
    final PsiExpression initializer=target.getInitializer();
    return ParenthesesUtils.stripParentheses(initializer);
  }
 else   if (def instanceof PsiReferenceExpression) {
    final PsiElement parent=def.getParent();
    if (!(parent instanceof PsiAssignmentExpression)) {
      return null;
    }
    final PsiAssignmentExpression assignmentExpression=(PsiAssignmentExpression)parent;
    if (assignmentExpression.getOperationTokenType() != JavaTokenType.EQ) {
      return null;
    }
    return ParenthesesUtils.stripParentheses(assignmentExpression.getRExpression());
  }
  return null;
}
