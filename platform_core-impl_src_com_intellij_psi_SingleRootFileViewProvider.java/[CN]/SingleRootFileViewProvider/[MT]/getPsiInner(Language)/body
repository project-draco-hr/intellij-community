{
  if (target != getBaseLanguage()) {
    return null;
  }
  PsiFile psiFile=myPsiFile.get();
  if (psiFile == null) {
    psiFile=createFile();
    if (psiFile == null) {
      psiFile=PsiUtilCore.NULL_PSI_FILE;
    }
    boolean set=myPsiFile.compareAndSet(null,psiFile);
    if (!set) {
      if (psiFile instanceof PsiFileImpl) {
        if (myPsiFile.get() == psiFile) {
          LOG.error(this + ".createFile() must create new file instance but got the same: " + psiFile);
        }
        ((PsiFileImpl)psiFile).markInvalidated();
      }
      psiFile=myPsiFile.get();
    }
  }
  return psiFile == PsiUtilCore.NULL_PSI_FILE ? null : psiFile;
}
