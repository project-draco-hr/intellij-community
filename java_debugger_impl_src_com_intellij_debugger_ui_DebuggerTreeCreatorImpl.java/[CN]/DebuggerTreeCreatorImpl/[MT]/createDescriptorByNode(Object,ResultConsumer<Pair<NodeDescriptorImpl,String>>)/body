{
  if (node instanceof DebuggerTreeNodeImpl) {
    final DebuggerTreeNodeImpl debuggerTreeNode=(DebuggerTreeNodeImpl)node;
    final DebuggerContextImpl context=DebuggerManagerEx.getInstanceEx(myProject).getContext();
    context.getDebugProcess().getManagerThread().schedule(new DebuggerContextCommandImpl(context){
      @Override public void threadAction(){
        try {
          final TextWithImports evaluationText=DebuggerTreeNodeExpression.createEvaluationText(debuggerTreeNode,context);
          resultConsumer.onSuccess(Pair.create(debuggerTreeNode.getDescriptor(),evaluationText.getText()));
        }
 catch (        EvaluateException e) {
          resultConsumer.onFailure(e);
        }
      }
    }
);
  }
}
