{
  super.setUp();
  myProjectFixture=IdeaTestFixtureFactory.getFixtureFactory().createFixtureBuilder(getTestName(true)).getFixture();
  myProjectFixture.setUp();
  myProject=myProjectFixture.getProject();
  myProjectRoot=myProject.getBaseDir();
  delete(new File(myProjectRoot.getParent().getPath(),".mock"));
  cd(myProjectRoot);
  Module module=doCreateRealModuleIn("foo",myProject,EmptyModuleType.getInstance());
  myRootModel=((ModuleRootManagerImpl)ModuleRootManager.getInstance(module)).getRootModel();
  mkdir(myRepositoryFolderName);
  myRepository=myProjectRoot.findChild(myRepositoryFolderName);
  myVcs=new MockAbstractVcs(myProject);
  myVcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(myProject);
  ExtensionPoint<VcsRootChecker> point=getExtensionPoint();
  myExtension=new VcsRootChecker(){
    @Override public VcsKey getSupportedVcs(){
      return myVcs.getKeyInstanceMethod();
    }
    @Override public boolean isRoot(    @NotNull String path){
      return new File(path,".mock").exists();
    }
    @Override public boolean isVcsDir(    @Nullable String path){
      return path != null && path.toLowerCase().endsWith(".mock");
    }
  }
;
  point.registerExtension(myExtension);
  myVcsManager.registerVcs(myVcs);
  myVcsName=myVcs.getName();
}
