{
  int startX=getWhitespaceSeparatorOffset() + 1;
  IterationState state=new IterationState(myEditor,firstVisibleOffset,lastVisibleOffset,false,true);
  while (!state.atEnd()) {
    VisualPosition logicalStart=myEditor.offsetToVisualPosition(state.getStartOffset());
    int startY=myEditor.visualPositionToXY(logicalStart).y;
    int endY=myEditor.visualPositionToXY(myEditor.offsetToVisualPosition(state.getEndOffset())).y;
    if (logicalStart.getColumn() == 0) {
      g.setColor(myEditor.getBackgroundColor(state.getMergedAttributes()));
      g.fillRect(startX,startY,clip.width - startX,endY - startY + myEditor.getLineHeight());
    }
 else     if (startY != endY) {
      g.setColor(myEditor.getBackgroundColor(state.getMergedAttributes()));
      g.fillRect(startX,startY + myEditor.getLineHeight(),clip.width - startX,endY - startY + myEditor.getLineHeight());
    }
    state.advance();
  }
}
