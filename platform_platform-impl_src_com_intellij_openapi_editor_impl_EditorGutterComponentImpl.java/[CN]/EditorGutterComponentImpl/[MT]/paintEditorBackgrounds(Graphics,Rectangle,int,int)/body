{
  Color defaultBackgroundColor=myEditor.getBackgroundColor();
  int startX=myEditor.isInDistractionFreeMode() ? 0 : getWhitespaceSeparatorOffset() + (isFoldingOutlineShown() ? 1 : 0);
  IterationState state=new IterationState(myEditor,firstVisibleOffset,lastVisibleOffset,false,true);
  while (!state.atEnd()) {
    VisualPosition visualStart=myEditor.offsetToVisualPosition(state.getStartOffset());
    VisualPosition visualEnd=myEditor.offsetToVisualPosition(state.getEndOffset());
    for (int line=visualStart.getLine(); line <= visualEnd.getLine(); line++) {
      if (line == visualStart.getLine()) {
        if (visualStart.getColumn() == 0) {
          drawEditorLineBackgroundRect(g,clip,state,defaultBackgroundColor,startX,myEditor.visibleLineToY(line));
        }
      }
 else       if (line != visualEnd.getLine() || visualEnd.getColumn() != 0) {
        drawEditorLineBackgroundRect(g,clip,state,defaultBackgroundColor,startX,myEditor.visibleLineToY(line));
      }
    }
    state.advance();
  }
}
