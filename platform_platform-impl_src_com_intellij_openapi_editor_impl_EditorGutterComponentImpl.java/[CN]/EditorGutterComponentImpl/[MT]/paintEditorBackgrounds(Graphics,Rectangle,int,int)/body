{
  int startX=getWhitespaceSeparatorOffset() + 1;
  IterationState state=new IterationState(myEditor,firstVisibleOffset,lastVisibleOffset,true,false);
  while (!state.atEnd()) {
    VisualPosition visualStart=myEditor.offsetToVisualPosition(state.getStartOffset());
    VisualPosition visualEnd=myEditor.offsetToVisualPosition(state.getEndOffset());
    int startY=myEditor.visualPositionToXY(visualStart).y;
    int endY=myEditor.visualPositionToXY(visualEnd).y;
    if (visualStart.getColumn() == 0) {
      g.setColor(myEditor.getBackgroundColor(state.getMergedAttributes()));
      g.fillRect(startX,startY,clip.width - startX,endY - startY + myEditor.getLineHeight());
    }
 else     if (startY != endY && visualEnd.getColumn() != 0) {
      g.setColor(myEditor.getBackgroundColor(state.getMergedAttributes()));
      g.fillRect(startX,startY + myEditor.getLineHeight(),clip.width - startX,endY - startY + myEditor.getLineHeight());
    }
    state.advance();
  }
}
