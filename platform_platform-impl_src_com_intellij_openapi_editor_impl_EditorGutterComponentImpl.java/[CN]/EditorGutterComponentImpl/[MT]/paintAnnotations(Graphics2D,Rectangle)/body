{
  int x=getAnnotationsAreaOffset();
  int w=getAnnotationsAreaWidthEx();
  if (w == 0)   return;
  AffineTransform old=setMirrorTransformIfNeeded(g,x,w);
  try {
    Color color=myEditor.getColorsScheme().getColor(EditorColors.ANNOTATIONS_COLOR);
    g.setColor(color != null ? color : JBColor.blue);
    g.setFont(myEditor.getColorsScheme().getFont(EditorFontType.PLAIN));
    for (int i=0; i < myTextAnnotationGutters.size(); i++) {
      TextAnnotationGutterProvider gutterProvider=myTextAnnotationGutters.get(i);
      int lineHeight=myEditor.getLineHeight();
      int startLineNumber=clip.y / lineHeight;
      int endLineNumber=(clip.y + clip.height) / lineHeight + 1;
      int lastLine=myEditor.logicalToVisualPosition(new LogicalPosition(endLineNumber(),0)).line;
      endLineNumber=Math.min(endLineNumber,lastLine + 1);
      if (startLineNumber >= endLineNumber) {
        break;
      }
      int annotationSize=myTextAnnotationGutterSizes.get(i);
      for (int j=startLineNumber; j < endLineNumber; j++) {
        int logLine=myEditor.visualToLogicalPosition(new VisualPosition(j,0)).line;
        String s=gutterProvider.getLineText(logLine,myEditor);
        final EditorFontType style=gutterProvider.getStyle(logLine,myEditor);
        final Color bg=gutterProvider.getBgColor(logLine,myEditor);
        if (bg != null) {
          g.setColor(bg);
          g.fillRect(x,j * lineHeight,annotationSize,lineHeight);
        }
        g.setColor(myEditor.getColorsScheme().getColor(gutterProvider.getColor(logLine,myEditor)));
        g.setFont(myEditor.getColorsScheme().getFont(style));
        if (!StringUtil.isEmpty(s)) {
          g.drawString(s,GAP_BETWEEN_ANNOTATIONS / 2 + x,(j + 1) * lineHeight - myEditor.getDescent());
        }
      }
      x+=annotationSize;
    }
  }
  finally {
    if (old != null)     g.setTransform(old);
  }
}
