{
  g.setColor(myEditor.getColorsScheme().getColor(EditorColors.WHITESPACES_COLOR));
  for (int i=start; i < end; i++) {
    char c=text.charAt(isRtl ? fragmentStart + fragment.getLength() - i - 1 : i + fragmentStart);
    if (" \t\u3000".indexOf(c) >= 0 && whitespacePaintingStrategy.showWhitespaceAtOffset(i + fragmentStart)) {
      int startX=(int)fragment.offsetToX(x,start,i);
      int endX=(int)fragment.offsetToX(x,start,i + 1);
      if (c == ' ') {
        g.fillRect((startX + endX) / 2,y,1,1);
      }
 else       if (c == '\t') {
        endX-=myView.getPlainSpaceWidth() / 4;
        int height=myView.getCharHeight();
        int halfHeight=height / 2;
        int mid=y - halfHeight;
        int top=y - height;
        UIUtil.drawLine(g,startX,mid,endX,mid);
        UIUtil.drawLine(g,endX,y,endX,top);
        g.fillPolygon(new int[]{endX - halfHeight,endX - halfHeight,endX},new int[]{y,y - height,y - halfHeight},3);
      }
 else       if (c == '\u3000') {
        final int charHeight=myView.getCharHeight();
        g.drawRect(startX + 2,y - charHeight,endX - startX - 4,charHeight);
      }
    }
  }
}
