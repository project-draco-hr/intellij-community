{
  Rectangle viewRectangle=myEditor.getScrollingModel().getVisibleArea();
  if (x - viewRectangle.x < 0) {
    return;
  }
  int lineHeight=myView.getLineHeight();
  EditorSettings settings=myEditor.getSettings();
  Color caretColor=myEditor.getColorsScheme().getColor(EditorColors.CARET_COLOR);
  if (caretColor == null)   caretColor=new JBColor(Gray._0,Gray._255);
  g.setColor(caretColor);
  if (myEditor.isInsertMode() != settings.isBlockCursor()) {
    if (UIUtil.isRetina()) {
      g.fillRect(x,y,settings.getLineCursorWidth(),lineHeight);
    }
 else {
      for (int i=0; i < settings.getLineCursorWidth(); i++) {
        UIUtil.drawLine(g,x + i,y,x + i,y + lineHeight - 1);
      }
    }
  }
 else {
    Color background=myEditor.getCaretModel().getTextAttributes().getBackgroundColor();
    if (background == null)     background=myEditor.getBackgroundColor();
    g.setXORMode(background);
    g.fillRect(Math.min(x,x + width),y,Math.abs(width),lineHeight - 1);
    g.setPaintMode();
  }
}
