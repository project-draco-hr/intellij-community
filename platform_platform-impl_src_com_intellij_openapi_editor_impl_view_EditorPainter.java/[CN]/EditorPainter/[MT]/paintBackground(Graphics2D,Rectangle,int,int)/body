{
  int lineCount=myEditor.getVisibleLineCount();
  for (int visualLine=startVisualLine; visualLine <= endVisualLine; visualLine++) {
    int y=myView.visualLineToY(visualLine);
    LineLayout prefixLayout=myView.getPrefixLayout();
    if (visualLine == 0 && prefixLayout != null) {
      paintBackground(g,myView.getPrefixAttributes(),0,y,prefixLayout.getWidth());
    }
    if (visualLine >= lineCount)     break;
    paintLineFragments(g,clip,visualLine,y,new LineFragmentPainter(){
      @Override public void paint(      Graphics2D g,      VisualLineFragmentsIterator.Fragment fragment,      int start,      int end,      TextAttributes attributes,      float xStart,      float xEnd,      int y){
        paintBackground(g,attributes,xStart,y,xEnd - xStart);
      }
      @Override public void paintAfterLineEnd(      Graphics2D g,      Rectangle clip,      IterationState it,      float x,      int y){
        x=paintAfterLineEndBackgroundSegments(g,it,x,y);
        if (it.getEndOffset() < myDocument.getTextLength()) {
          paintBackground(g,it.getPastLineEndBackgroundAttributes(),x,y,clip.x + clip.width - x);
        }
 else {
          if (it.hasPastFileEndBackgroundSegments()) {
            x=paintAfterLineEndBackgroundSegments(g,it,x,y);
          }
          paintBackground(g,it.getPastFileEndBackground(),x,y,clip.x + clip.width - x);
        }
      }
    }
);
  }
}
