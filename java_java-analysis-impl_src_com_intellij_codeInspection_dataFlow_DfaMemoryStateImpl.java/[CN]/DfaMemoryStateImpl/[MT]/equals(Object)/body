{
  if (obj == this)   return true;
  if (!(obj instanceof DfaMemoryStateImpl))   return false;
  DfaMemoryStateImpl that=(DfaMemoryStateImpl)obj;
  if (myEphemeral != that.myEphemeral)   return false;
  if (myDistinctClasses.size() != that.myDistinctClasses.size())   return false;
  if (myStack.size() != that.myStack.size())   return false;
  if (myOffsetStack.size() != that.myOffsetStack.size())   return false;
  if (myUnknownVariables.size() != that.myUnknownVariables.size())   return false;
  if (!myStack.equals(that.myStack))   return false;
  if (!myOffsetStack.equals(that.myOffsetStack))   return false;
  if (!myUnknownVariables.equals(that.myUnknownVariables))   return false;
  if (!getNonTrivialEqClasses().equals(that.getNonTrivialEqClasses()))   return false;
  if (!getDistinctClassPairs().equals(that.getDistinctClassPairs()))   return false;
  for (  DfaVariableValue var : myVariableStates.keySet()) {
    DfaVariableState thatState=that.myVariableStates.get(var);
    if (!myVariableStates.get(var).equals(thatState != null ? thatState : createVariableState(var))) {
      return false;
    }
  }
  for (  DfaVariableValue var : that.myVariableStates.keySet()) {
    if (!myVariableStates.containsKey(var) && !that.myVariableStates.get(var).equals(createVariableState(var))) {
      return false;
    }
  }
  return true;
}
