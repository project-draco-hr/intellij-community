{
  DfaMemoryStateImpl newState=createNew();
  newState.myEphemeral=myEphemeral;
  newState.myStack.addAll(myStack);
  newState.myDistinctClasses.addAll(myDistinctClasses.toArray());
  newState.myUnknownVariables.addAll(myUnknownVariables);
  newState.myOffsetStack=new TIntStack(myOffsetStack);
  for (int i=0; i < myEqClasses.size(); i++) {
    EqClass aClass=myEqClasses.get(i);
    newState.myEqClasses.add(aClass != null ? new EqClass(aClass) : null);
  }
  for (  DfaVariableValue dfaVariableValue : myVariableStates.keySet()) {
    newState.myVariableStates.put(dfaVariableValue,myVariableStates.get(dfaVariableValue).clone());
  }
  return newState;
}
