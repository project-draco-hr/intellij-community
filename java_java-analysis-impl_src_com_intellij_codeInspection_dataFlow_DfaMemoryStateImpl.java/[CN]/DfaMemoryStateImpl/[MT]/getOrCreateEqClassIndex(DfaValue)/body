{
  int i=getEqClassIndex(dfaValue);
  if (i != -1)   return i;
  if (!canBeInRelation(dfaValue) || !canBeReused(dfaValue) && !(((DfaBoxedValue)dfaValue).getWrappedValue() instanceof DfaConstValue)) {
    return null;
  }
  int freeIndex=myEqClasses.indexOf(null);
  int resultIndex=freeIndex >= 0 ? freeIndex : myEqClasses.size();
  EqClass aClass=new EqClass(myFactory);
  aClass.add(dfaValue.getID());
  if (freeIndex >= 0) {
    myEqClasses.set(freeIndex,aClass);
  }
 else {
    myEqClasses.add(aClass);
  }
  addToMap(dfaValue.getID(),resultIndex);
  return resultIndex;
}
