{
  final FileTypeChooser chooser=new FileTypeChooser(suggestPatterns(fileName),fileName);
  if (!chooser.showAndGet()) {
    return null;
  }
  final FileType type=chooser.getSelectedType();
  if (type == FileTypes.UNKNOWN || type == null)   return null;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      FileTypeManagerEx.getInstanceEx().associatePattern(type,(String)chooser.myPattern.getSelectedItem());
    }
  }
);
  return type;
}
