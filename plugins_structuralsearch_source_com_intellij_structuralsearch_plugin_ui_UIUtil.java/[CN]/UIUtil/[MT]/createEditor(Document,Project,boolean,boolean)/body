{
  final Editor editor=editable ? EditorFactory.getInstance().createEditor(doc,project) : EditorFactory.getInstance().createViewer(doc,project);
  EditorSettings editorSettings=editor.getSettings();
  editorSettings.setVirtualSpace(false);
  editorSettings.setLineMarkerAreaShown(false);
  editorSettings.setLineNumbersShown(false);
  editorSettings.setFoldingOutlineShown(false);
  EditorColorsScheme scheme=editor.getColorsScheme();
  scheme.setColor(EditorColors.CARET_ROW_COLOR,null);
  if (!editable) {
    final EditorColorsScheme globalScheme=EditorColorsManager.getInstance().getGlobalScheme();
    Color c=globalScheme.getColor(EditorColors.READONLY_BACKGROUND_COLOR);
    if (c == null) {
      c=globalScheme.getDefaultBackground();
    }
    ((EditorEx)editor).setBackgroundColor(c);
  }
 else {
    ((EditorEx)editor).setEmbeddedIntoDialogWrapper(true);
  }
  TemplateContext context=new TemplateContext();
  context.JAVA_CODE=true;
  TemplateEditorUtil.setHighlighter(editor,context);
  if (addToolTipForVariableHandler) {
    SubstitutionShortInfoHandler handler=new SubstitutionShortInfoHandler(editor);
    editor.addEditorMouseMotionListener(handler);
    editor.getDocument().addDocumentListener(handler);
    editor.getCaretModel().addCaretListener(handler);
    editor.putUserData(LISTENER_KEY,handler);
  }
  return editor;
}
