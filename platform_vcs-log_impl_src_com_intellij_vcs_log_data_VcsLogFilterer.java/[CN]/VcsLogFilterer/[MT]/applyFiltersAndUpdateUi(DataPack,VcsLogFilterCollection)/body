{
  List<VcsLogDetailsFilter> detailsFilters=filters.getDetailsFilters();
  applyGraphFilters(dataPack,filters.getBranchFilter());
  final AbstractVcsLogTableModel model;
  if (!detailsFilters.isEmpty() && !USE_NEW_GRAPH_FOR_FILTERING) {
    List<Pair<Hash,VirtualFile>> filteredCommits=filterByDetails(dataPack,detailsFilters);
    model=new NoGraphTableModel(dataPack,myLogDataHolder,myUI,filteredCommits,LoadMoreStage.INITIAL);
  }
 else {
    if (!detailsFilters.isEmpty()) {
      List<Pair<Hash,VirtualFile>> filteredCommits=filterByDetails(dataPack,detailsFilters);
      Condition<Integer> filter=getFilterFromCommits(filteredCommits);
      dataPack.getGraphFacade().setFilter(filter);
    }
 else {
      dataPack.getGraphFacade().setFilter(Conditions.<Integer>alwaysTrue());
    }
    model=new GraphTableModel(dataPack,myLogDataHolder,myUI,LoadMoreStage.INITIAL);
  }
  return model;
}
