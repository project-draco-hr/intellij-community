{
  final TaskFile taskFile=StudyTaskManager.getInstance(myProject).getTaskFile(file);
  if (taskFile == null) {
    return null;
  }
  if (taskFile.isValid()) {
    return null;
  }
  if (!(fileEditor instanceof StudyEditor)) {
    return null;
  }
  final Editor editor=((StudyEditor)fileEditor).getEditor();
  EditorNotificationPanel panel=new EditorNotificationPanel();
  panel.setText("Task file is invalid\n");
  final InvalidTaskFileFix fix=StudyEditor.getFix(taskFile);
  if (fix != null) {
    panel.createActionLabel("fix file",new Runnable(){
      @Override public void run(){
        final Document document=editor.getDocument();
        StudyEditor.deleteGuardedBlocks(document);
        editor.getMarkupModel().removeAllHighlighters();
        taskFile.setTrackChanges(false);
        fix.applyFix(document);
        taskFile.setTrackChanges(true);
        taskFile.drawAllWindows(editor);
        StudyEditor.deleteFix(taskFile);
        taskFile.setValidAndUpdate(true,file,fix.getProject());
      }
    }
);
  }
 else {
    panel.createActionLabel("refresh task file","RefreshTaskAction");
  }
  return panel;
}
