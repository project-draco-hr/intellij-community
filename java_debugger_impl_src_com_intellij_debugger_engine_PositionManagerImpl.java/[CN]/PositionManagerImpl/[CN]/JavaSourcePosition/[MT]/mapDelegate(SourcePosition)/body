{
  return ApplicationManager.getApplication().runReadAction(new Computable<SourcePosition>(){
    @Override public SourcePosition compute(){
      int lineNumber=original.getLine();
      PsiElement element=original.getElementAt();
      PsiClass aClass=getEnclosingClass(element);
      if (aClass != null) {
        if (Comparing.equal(myExpectedClassName,JVMNameUtil.getClassVMName(aClass))) {
          return original;
        }
        final Document document=PsiDocumentManager.getInstance(element.getProject()).getDocument(element.getContainingFile());
        if (document == null || lineNumber >= document.getLineCount()) {
          return original;
        }
        int endOffset=document.getLineEndOffset(lineNumber);
        element=PsiTreeUtil.nextLeaf(element);
        while (element != null && element.getTextOffset() < endOffset) {
          aClass=getEnclosingClass(element);
          if (aClass == null)           break;
          if (Comparing.equal(myExpectedClassName,JVMNameUtil.getClassVMName(aClass))) {
            return SourcePosition.createFromElement(element);
          }
          element=PsiTreeUtil.nextLeaf(element);
        }
      }
      return original;
    }
  }
);
}
