{
  myCheckHostname.setVisible(false);
  myCheckValidityPeriod.setVisible(false);
  myTrustManager=CertificatesManager.getInstance().getCustomTrustManager();
  myTrustManager.addListener(this);
  myCertificatesList=new JBList(new CollectionListModel<X509Certificate>());
  myCertificatesList.getEmptyText().setText("No certificates");
  myCertificatesList.setCellRenderer(new ListCellRendererWrapper<X509Certificate>(){
    @Override public void customize(    JList list,    X509Certificate certificate,    int index,    boolean selected,    boolean hasFocus){
      if (!new CertificateWrapper(certificate).isValid()) {
        setForeground(UIUtil.getLabelDisabledForeground());
      }
      setText(getCommonName(certificate));
    }
  }
);
  ToolbarDecorator decorator=ToolbarDecorator.createDecorator(myCertificatesList).disableUpDownActions();
  decorator.setVisibleRowCount(5);
  decorator.setAddAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      FileChooser.chooseFile(CERTIFICATE_DESCRIPTOR,null,null,new Consumer<VirtualFile>(){
        @Override public void consume(        VirtualFile file){
          String path=file.getPath();
          X509Certificate certificate=CertificateUtil.loadX509Certificate(path);
          if (certificate == null) {
            Messages.showErrorDialog(myRootPanel,"Malformed X509 server certificate","Not Imported");
          }
 else           if (getCertificates().contains(certificate)) {
            Messages.showWarningDialog(myRootPanel,"Certificate already exists","Not Imported");
          }
 else {
            getListModel().add(certificate);
            addCertificatePanel(certificate);
            myCertificatesList.setSelectedValue(certificate,true);
          }
        }
      }
);
    }
  }
).setRemoveAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      CollectionListModel<X509Certificate> model=getListModel();
      List<X509Certificate> selected=new ArrayList<X509Certificate>();
      for (      int i : myCertificatesList.getSelectedIndices()) {
        selected.add((X509Certificate)myCertificatesList.getModel().getElementAt(i));
      }
      for (      X509Certificate certificate : selected) {
        model.remove(certificate);
      }
      if (getListModel().getSize() > 0) {
        myCertificatesList.setSelectedIndex(0);
      }
 else {
        myDetailsPanel.removeAll();
        myDetailsPanel.repaint();
      }
    }
  }
);
  myCertificatesList.addListSelectionListener(new ListSelectionListener(){
    @Override public void valueChanged(    ListSelectionEvent e){
      X509Certificate certificate=getSelectedCertificate();
      if (certificate != null) {
        String uniqueName=getCardName(certificate);
        ((CardLayout)myDetailsPanel.getLayout()).show(myDetailsPanel,uniqueName);
      }
    }
  }
);
  myCertificatesListPanel.add(decorator.createPanel(),BorderLayout.CENTER);
}
