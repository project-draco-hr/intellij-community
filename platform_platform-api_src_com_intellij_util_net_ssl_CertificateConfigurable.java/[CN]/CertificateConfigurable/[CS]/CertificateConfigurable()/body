{
  myTrustManager=CertificatesManager.getInstance().getCustomTrustManager();
  myCertificatesList=new JBList();
  myCertificatesList.getEmptyText().setText("No certificates");
  myCertificatesList.setCellRenderer(new ListCellRendererWrapper<X509Certificate>(){
    @Override public void customize(    JList list,    X509Certificate certificate,    int index,    boolean selected,    boolean hasFocus){
      if (!new CertificateWrapper(certificate).isValid()) {
        setForeground(UIUtil.getLabelDisabledForeground());
      }
      setText(new CertificateWrapper(certificate).getSubjectField(COMMON_NAME));
    }
  }
);
  for (  X509Certificate certificate : myTrustManager.getCertificates()) {
    addCertificatePanel(certificate);
  }
  ToolbarDecorator decorator=ToolbarDecorator.createDecorator(myCertificatesList).disableUpDownActions();
  decorator.setVisibleRowCount(5);
  decorator.setAddAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      FileChooser.chooseFile(CERTIFICATE_DESCRIPTOR,null,null,new Consumer<VirtualFile>(){
        @Override public void consume(        VirtualFile file){
          String path=file.getPath();
          X509Certificate certificate=CertificateUtil.loadX509Certificate(path);
          if (certificate != null) {
            getListModel().add(certificate);
            addCertificatePanel(certificate);
            myCertificatesList.setSelectedValue(certificate,true);
          }
 else {
            Messages.showErrorDialog(myRootPanel,"Cannot Load Certificate","Possibly malformed X509 server certificate " + path);
          }
        }
      }
);
    }
  }
).setRemoveAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      CollectionListModel<X509Certificate> model=getListModel();
      for (      int i : myCertificatesList.getSelectedIndices()) {
        X509Certificate certificate=(X509Certificate)myCertificatesList.getModel().getElementAt(i);
        model.remove(certificate);
      }
      if (getListModel().getSize() > 0) {
        myCertificatesList.setSelectedIndex(0);
      }
 else {
        myDetailsPanel.removeAll();
        myDetailsPanel.repaint();
      }
    }
  }
);
  myCertificatesList.addListSelectionListener(new ListSelectionListener(){
    @Override public void valueChanged(    ListSelectionEvent e){
      X509Certificate certificate=getSelectedCertificate();
      if (certificate != null) {
        String uniqueName=certificate.getSubjectX500Principal().getName();
        ((CardLayout)myDetailsPanel.getLayout()).show(myDetailsPanel,uniqueName);
      }
    }
  }
);
  myCertificatesListPanel.add(decorator.createPanel(),BorderLayout.CENTER);
}
