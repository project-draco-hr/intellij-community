{
  LOG.assertTrue(isDispatchThread(),"leaveModal() should be invoked in event-dispatch thread");
  if (LOG.isDebugEnabled()) {
    LOG.debug("leaveModal:" + modalEntity);
  }
  while (ourFlushQueueRunnable.runNextEvent())   ;
  ourModalityStateMulticaster.getMulticaster().beforeModalityStateChanged(false);
  boolean removed=ourModalEntities.remove(modalEntity);
  ourModalityStack.pop();
  LOG.assertTrue(removed,modalEntity);
  LOG.assertTrue(!ourModalityStack.isEmpty(),modalEntity);
  cleanupQueueForModal(modalEntity);
  ourQueueSkipCount=0;
  requestFlush();
}
