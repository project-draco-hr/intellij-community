{
  Repository repository=initRepository("foo");
  LocalTask defaultTask=myTaskManager.getActiveTask();
  assertNotNull(defaultTask);
  assertEquals(0,defaultTask.getBranches().size());
  LocalTaskImpl foo=myTaskManager.createLocalTask("foo");
  LocalTask localTask=myTaskManager.activateTask(foo,false);
  myTaskManager.createBranch(localTask,defaultTask,myTaskManager.suggestBranchName(localTask));
  assertEquals(2,localTask.getBranches().size());
  assertEquals(1,defaultTask.getBranches().size());
  BranchInfo info=new BranchInfo();
  info.name="non-existing";
  info.repository=defaultTask.getBranches().get(0).repository;
  defaultTask.addBranch(info);
  repository.update();
  assertEquals("foo",repository.getCurrentBranchName());
  myTaskManager.activateTask(defaultTask,false);
  repository.update();
  assertEquals(getDefaultBranchName(),repository.getCurrentBranchName());
  assertEquals(2,getNumberOfBranches(repository));
}
