{
  List<GitRepository> repositories=initRepositories("community","idea");
  LocalTask defaultTask=myTaskManager.getActiveTask();
  assertNotNull(defaultTask);
  LocalTaskImpl foo=myTaskManager.createLocalTask("foo");
  LocalTask localTask=myTaskManager.activateTask(foo,false);
  myTaskManager.createBranch(localTask,defaultTask,myTaskManager.suggestBranchName(localTask));
  assertEquals(4,localTask.getBranches().size());
  assertEquals(2,localTask.getBranches(true).size());
  assertEquals(2,localTask.getBranches(false).size());
  assertEquals(2,defaultTask.getBranches().size());
  myTaskManager.activateTask(defaultTask,false);
  GitRepository repository=repositories.get(0);
  assertEquals("master",repository.getCurrentBranch().getName());
  foo=myTaskManager.createLocalTask("foo");
  localTask=myTaskManager.activateTask(foo,false);
  myTaskManager.createBranch(localTask,defaultTask,myTaskManager.suggestBranchName(localTask));
  assertEquals("foo",repository.getCurrentBranch().getName());
  myTaskManager.mergeBranch(localTask);
  repository.update();
  assertEquals("master",repository.getCurrentBranch().getName());
  assertEquals(1,repository.getBranches().getLocalBranches().size());
  myTaskManager.activateTask(defaultTask,false);
  myTaskManager.activateTask(foo,false);
}
