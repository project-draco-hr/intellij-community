{
  List<GitRepository> repositories=initRepositories("community","idea");
  GitRepository repository=repositories.get(0);
  VcsTaskHandler[] handlers=VcsTaskHandler.getAllHandlers(getProject());
  assertEquals(1,handlers.length);
  VcsTaskHandler handler=handlers[0];
  final String first="first";
  handler.startNewTask(first);
  assertEquals(2,repository.getBranches().getLocalBranches().size());
  assertEquals(first,repository.getCurrentBranch().getName());
  final String second="second";
  handler.startNewTask(second);
  assertEquals(3,repository.getBranches().getLocalBranches().size());
  assertEquals(second,repository.getCurrentBranch().getName());
  handler.switchTask(first);
  assertEquals(first,repository.getCurrentBranch().getName());
  handler.closeTask(second);
  assertEquals(2,repository.getBranches().getLocalBranches().size());
}
