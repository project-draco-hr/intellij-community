{
  VirtualFile root=repository.getRoot();
  File file=new File(root.getPath(),"foo.txt");
  assertTrue(file.createNewFile());
  final VirtualFile virtualFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(file);
  addFiles(getProject(),root,virtualFile);
  myDirtyScopeManager.fileDirty(virtualFile);
  myChangeListManager.ensureUpToDate(false);
  Change change=myChangeListManager.getChange(virtualFile);
  assertNotNull(change);
  ProjectLevelVcsManager.getInstance(getProject()).getAllActiveVcss()[0].getCheckinEnvironment().commit(Collections.singletonList(change),"foo");
}
