{
  final ClassFilesIndexFeaturesHolder indicesHolder=ClassFilesIndexFeaturesHolder.getInstance(getProject());
  try {
    indicesHolder.projectOpened();
    compileAndIndexData(TEST_INDEX_FILE_NAME);
    final LookupElement[] allLookupElements=runCompletion();
    final List<WeightableChainLookupElement> targetLookupElements=new SmartList<WeightableChainLookupElement>();
    for (    final LookupElement lookupElement : allLookupElements) {
      if (lookupElement instanceof WeightableChainLookupElement) {
        targetLookupElements.add((WeightableChainLookupElement)lookupElement);
      }
    }
    return targetLookupElements;
  }
  finally {
    indicesHolder.projectClosed();
  }
}
