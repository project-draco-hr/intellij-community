{
  EventLoopGroup eventLoopGroup=null;
  if (shutdownEventLoopGroup) {
    for (    Channel channel : openChannels) {
      if (channel instanceof ServerChannel) {
        eventLoopGroup=channel.eventLoop().parent();
        break;
      }
    }
  }
  try {
    openChannels.close().awaitUninterruptibly(30,TimeUnit.SECONDS);
  }
  finally {
    if (eventLoopGroup != null) {
      eventLoopGroup.shutdownGracefully(1,2,TimeUnit.NANOSECONDS);
    }
  }
}
