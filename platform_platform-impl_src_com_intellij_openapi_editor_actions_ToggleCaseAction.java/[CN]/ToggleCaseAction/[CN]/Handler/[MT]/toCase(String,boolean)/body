{
  StringBuilder builder=new StringBuilder(text.length());
  boolean prevIsSlash=false;
  for (int i=0; i < text.length(); ++i) {
    char c=text.charAt(i);
    if (!prevIsSlash) {
      c=lower ? Character.toLowerCase(c) : Character.toUpperCase(c);
    }
    prevIsSlash=c == '\\';
    builder.append(c);
  }
  return builder.toString();
}
