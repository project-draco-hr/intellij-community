{
  Project project=getProject();
  ExecutionManagerImpl executionManager=ExecutionManagerImpl.getInstance(project);
  FakeRunConfiguration rc=new FakeRunConfiguration(project,true);
  RunnerAndConfigurationSettingsImpl settings=new RunnerAndConfigurationSettingsImpl(RunManagerImpl.getInstanceImpl(project),rc,false);
  settings.setSingleton(true);
  ExecutionEnvironment env1=createEnv(project,settings);
  executionManager.restartRunProfile(env1);
  UIUtil.dispatchAllInvocationEvents();
  ProcessHandler processHandler1=getProcessHandler(executionManager);
  ExecutionEnvironment env2=createEnv(project,settings);
  executionManager.restartRunProfile(env2);
  UIUtil.dispatchInvocationEvent();
  ProcessHandler processHandler2=getProcessHandler(executionManager);
  assertTrue(processHandler1 == processHandler2);
  assertTrue(processHandler1.isProcessTerminating());
  ExecutionEnvironment env3=createEnv(project,settings);
  executionManager.restartRunProfile(env3);
  UIUtil.dispatchAllInvocationEvents();
  FakeProcessHandler processHandler3=getProcessHandler(executionManager);
  assertTrue(processHandler1 != processHandler3);
  assertTrue(!processHandler3.isProcessTerminating() && !processHandler3.isProcessTerminated());
  processHandler3.killProcess();
}
