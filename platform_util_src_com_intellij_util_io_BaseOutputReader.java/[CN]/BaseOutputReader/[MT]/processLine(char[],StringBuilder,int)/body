{
  for (int i=0; i < n; i++) {
    char c=buffer[i];
    if (c == '\n' && line.length() > 0 && line.charAt(line.length() - 1) == '\r') {
      line.setCharAt(line.length() - 1,'\n');
    }
 else {
      line.append(c);
    }
    if (c == '\n') {
      sendLine(line);
    }
  }
}
