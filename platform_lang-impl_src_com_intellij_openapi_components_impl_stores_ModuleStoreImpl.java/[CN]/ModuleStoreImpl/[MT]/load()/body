{
  String moduleTypeId=getMainStorageData().myOptions.get(Module.ELEMENT_TYPE);
  myModule.setOption(Module.ELEMENT_TYPE,ModuleTypeManager.getInstance().findByID(moduleTypeId).getId());
  if (ApplicationManager.getApplication().isHeadlessEnvironment() || ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  final TrackingPathMacroSubstitutor substitutor=getStateStorageManager().getMacroSubstitutor();
  if (substitutor != null) {
    final Collection<String> macros=substitutor.getUnknownMacros(null);
    if (!macros.isEmpty()) {
      final Project project=myModule.getProject();
      StartupManager.getInstance(project).runWhenProjectIsInitialized(new Runnable(){
        @Override public void run(){
          StorageUtil.notifyUnknownMacros(substitutor,project,null);
        }
      }
);
    }
  }
}
