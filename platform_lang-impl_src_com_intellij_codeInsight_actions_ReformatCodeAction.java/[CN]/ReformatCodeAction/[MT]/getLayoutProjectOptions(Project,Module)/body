{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return myTestOptions;
  }
  final String text=module != null ? CodeInsightBundle.message("process.scope.module",module.getModuleFilePath()) : CodeInsightBundle.message("process.scope.project",project.getPresentableUrl());
  final boolean enableOnlyVCSChangedRegions=module != null ? FormatChangedTextUtil.hasChanges(module) : FormatChangedTextUtil.hasChanges(project);
  LayoutProjectCodeDialog dialog=new LayoutProjectCodeDialog(project,CodeInsightBundle.message("process.reformat.code"),text,true,enableOnlyVCSChangedRegions);
  dialog.show();
  if (!dialog.isOK())   return null;
  return dialog;
}
