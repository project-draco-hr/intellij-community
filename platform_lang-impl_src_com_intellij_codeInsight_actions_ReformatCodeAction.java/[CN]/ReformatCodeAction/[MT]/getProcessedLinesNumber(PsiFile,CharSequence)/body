{
  Project project=file.getProject();
  Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  if (document == null) {
    return 0;
  }
  int totalLinesProcessed=0;
  try {
    List<TextRange> ranges=FormatChangedTextUtil.calculateChangedTextRanges(project,file,before);
    for (    TextRange range : ranges) {
      int lineStartNumber=document.getLineNumber(range.getStartOffset());
      int lineEndNumber=document.getLineNumber(range.getEndOffset());
      int linesCoveredByRange=lineEndNumber - lineStartNumber + 1;
      totalLinesProcessed+=linesCoveredByRange;
    }
  }
 catch (  FilesTooBigForDiffException e) {
    e.printStackTrace();
  }
  return totalLinesProcessed;
}
