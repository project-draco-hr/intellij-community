{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return (LayoutCodeOptions)myTestOptions;
  }
  LayoutCodeDialog dialog=new LayoutCodeDialog(project,CodeInsightBundle.message("process.reformat.code"),file,dir,hasSelection ? Boolean.TRUE : Boolean.FALSE,HELP_ID);
  if (!dialog.showAndGet()) {
    return null;
  }
  EditorSettingsExternalizable.getInstance().getOptions().SHOW_REFORMAT_DIALOG=!dialog.isDoNotAskMe();
  updateShowDialogSetting(dialog,"\"Reformat Code\" dialog disabled");
  return dialog;
}
