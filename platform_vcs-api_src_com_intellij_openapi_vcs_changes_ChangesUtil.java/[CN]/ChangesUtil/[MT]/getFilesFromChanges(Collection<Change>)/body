{
  ArrayList<VirtualFile> files=new ArrayList<VirtualFile>();
  for (  Change change : changes) {
    final ContentRevision afterRevision=change.getAfterRevision();
    if (afterRevision != null) {
      FilePath filePath=afterRevision.getFile();
      VirtualFile file=filePath.getVirtualFile();
      if (file == null || !file.isValid()) {
        file=LocalFileSystem.getInstance().refreshAndFindFileByPath(filePath.getPath());
      }
      if (file != null && file.isValid()) {
        files.add(file);
      }
    }
  }
  return VfsUtilCore.toVirtualFileArray(files);
}
