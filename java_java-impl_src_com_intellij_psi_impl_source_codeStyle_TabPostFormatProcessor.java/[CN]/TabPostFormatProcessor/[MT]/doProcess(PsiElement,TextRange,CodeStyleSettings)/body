{
  ASTNode node=source.getNode();
  if (node == null) {
    return range;
  }
  Language language=source.getLanguage();
  if (language != JavaLanguage.INSTANCE) {
    return range;
  }
  if (!source.isValid())   return range;
  PsiFile file=source.getContainingFile();
  CommonCodeStyleSettings.IndentOptions indentOptions=settings.getIndentOptionsByFile(file,range);
  boolean useTabs=indentOptions.USE_TAB_CHARACTER;
  boolean smartTabs=indentOptions.SMART_TABS;
  int tabWidth=indentOptions.TAB_SIZE;
  return processViaPsi(node,range,new TreeHelperImpl(),useTabs,smartTabs,tabWidth);
}
