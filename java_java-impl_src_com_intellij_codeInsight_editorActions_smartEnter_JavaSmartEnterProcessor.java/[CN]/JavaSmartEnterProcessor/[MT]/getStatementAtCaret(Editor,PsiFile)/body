{
  PsiElement atCaret=super.getStatementAtCaret(editor,psiFile);
  if (atCaret instanceof PsiWhiteSpace)   return null;
  if (atCaret instanceof PsiJavaToken && "}".equals(atCaret.getText())) {
    atCaret=atCaret.getParent();
    if (!(atCaret instanceof PsiAnonymousClass || atCaret instanceof PsiArrayInitializerExpression || psiElement(PsiCodeBlock.class).withParent(PsiLambdaExpression.class).accepts(atCaret))) {
      return null;
    }
  }
  PsiElement statementAtCaret=PsiTreeUtil.getParentOfType(atCaret,PsiStatement.class,PsiCodeBlock.class,PsiMember.class,PsiComment.class,PsiImportStatementBase.class,PsiPackageStatement.class);
  if (statementAtCaret instanceof PsiBlockStatement)   return null;
  if (statementAtCaret != null && statementAtCaret.getParent() instanceof PsiForStatement) {
    if (!PsiTreeUtil.hasErrorElements(statementAtCaret)) {
      statementAtCaret=statementAtCaret.getParent();
    }
  }
  return statementAtCaret instanceof PsiStatement || statementAtCaret instanceof PsiMember || statementAtCaret instanceof PsiImportStatementBase|| statementAtCaret instanceof PsiPackageStatement ? statementAtCaret : null;
}
