{
  ProjectRootManagerEx rootManager=ProjectRootManagerEx.getInstanceEx(project);
  rootManager.setProjectSdk(jdk);
  JavaSdkVersion version=JavaSdk.getInstance().getVersion(jdk);
  if (version != null) {
    LanguageLevel maxLevel=version.getMaxLanguageLevel();
    LanguageLevelProjectExtension extension=LanguageLevelProjectExtension.getInstance(ProjectManager.getInstance().getDefaultProject());
    Boolean aDefault=extension.isDefault();
    LanguageLevelProjectExtension ext=LanguageLevelProjectExtension.getInstance(project);
    if (aDefault != null && aDefault || maxLevel.compareTo(ext.getLanguageLevel()) < 0) {
      ext.setLanguageLevel(maxLevel);
    }
  }
}
