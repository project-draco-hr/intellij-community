{
  final Map<JpsArtifact,JpsArtifact> result=new HashMap<JpsArtifact,JpsArtifact>();
  final GraphGenerator<JpsArtifact> graph=createArtifactsGraph();
  for (  JpsArtifact artifact : graph.getNodes()) {
    final Iterator<JpsArtifact> in=graph.getIn(artifact);
    while (in.hasNext()) {
      JpsArtifact next=in.next();
      if (next.equals(artifact)) {
        result.put(artifact,artifact);
        break;
      }
    }
  }
  final DFSTBuilder<JpsArtifact> builder=new DFSTBuilder<JpsArtifact>(graph);
  if (builder.isAcyclic() && result.isEmpty())   return Collections.emptyMap();
  for (  Collection<JpsArtifact> component : builder.getComponents()) {
    if (component.size() > 1) {
      for (      JpsArtifact artifact : component) {
        result.put(artifact,artifact);
      }
    }
  }
  for (int i=0; i < graph.getNodes().size(); i++) {
    final JpsArtifact artifact=builder.getNodeByTNumber(i);
    if (!result.containsKey(artifact)) {
      final Iterator<JpsArtifact> in=graph.getIn(artifact);
      while (in.hasNext()) {
        final JpsArtifact next=result.get(in.next());
        if (next != null) {
          result.put(artifact,next);
        }
      }
    }
  }
  return result;
}
