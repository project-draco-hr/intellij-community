{
  PsiElement statementBefore=findStatementBeforeCaret(nodeAtCaret);
  PsiElement statementAfter=findStatementAfterCaret(nodeAtCaret);
  if (statementBefore != statementAfter) {
    return false;
  }
  if (statementBefore == null) {
    return false;
  }
  if (PsiTreeUtil.hasErrorElements(statementBefore)) {
    if (!autoWrapInProgress) {
      return false;
    }
  }
  if (inFromImportParentheses(statementBefore,nodeAtCaret.getTextRange().getStartOffset())) {
    return false;
  }
  PsiElement wrappableBefore=findWrappable(nodeAtCaret,true);
  PsiElement wrappableAfter=findWrappable(nodeAtCaret,false);
  if (!(wrappableBefore instanceof PsiComment)) {
    while (wrappableBefore != null) {
      PsiElement next=PsiTreeUtil.getParentOfType(wrappableBefore,WRAPPABLE_CLASSES);
      if (next == null) {
        break;
      }
      wrappableBefore=next;
    }
  }
  if (!(wrappableAfter instanceof PsiComment)) {
    while (wrappableAfter != null) {
      PsiElement next=PsiTreeUtil.getParentOfType(wrappableAfter,WRAPPABLE_CLASSES);
      if (next == null) {
        break;
      }
      wrappableAfter=next;
    }
  }
  if (wrappableBefore instanceof PsiComment || wrappableAfter instanceof PsiComment) {
    return false;
  }
  return wrappableAfter == null || wrappableBefore != wrappableAfter;
}
