{
  if (offset > 0) {
    final PsiElement beforeCaret=file.findElementAt(offset - 1);
    if (beforeCaret instanceof PsiWhiteSpace && beforeCaret.getText().indexOf('\\') >= 0) {
      return false;
    }
  }
  PsiElement statementBefore=findStatementBeforeCaret(file,offset);
  PsiElement statementAfter=findStatementAfterCaret(file,offset);
  if (statementBefore != statementAfter) {
    return false;
  }
  if (statementBefore == null) {
    return false;
  }
  if (PsiTreeUtil.hasErrorElements(statementBefore)) {
    if (!autoWrapInProgress) {
      return false;
    }
  }
  if (inFromImportParentheses(statementBefore,offset)) {
    return false;
  }
  PsiElement wrappableBefore=findWrappable(file,offset,true);
  PsiElement wrappableAfter=findWrappable(file,offset,false);
  if (!(wrappableBefore instanceof PsiComment)) {
    while (wrappableBefore != null) {
      PsiElement next=PsiTreeUtil.getParentOfType(wrappableBefore,WRAPPABLE_CLASSES);
      if (next == null) {
        break;
      }
      wrappableBefore=next;
    }
  }
  if (!(wrappableAfter instanceof PsiComment)) {
    while (wrappableAfter != null) {
      PsiElement next=PsiTreeUtil.getParentOfType(wrappableAfter,WRAPPABLE_CLASSES);
      if (next == null) {
        break;
      }
      wrappableAfter=next;
    }
  }
  if (wrappableBefore instanceof PsiComment || wrappableAfter instanceof PsiComment) {
    return false;
  }
  return wrappableAfter == null || wrappableBefore != wrappableAfter;
}
