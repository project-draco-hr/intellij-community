{
  if (firstQuoteOffset < 0 || firstQuoteOffset > document.getTextLength() - 3) {
    return false;
  }
  final String quotes=document.getText(TextRange.from(firstQuoteOffset,3));
  if (!quotes.equals("\"\"\"") && !quotes.equals("'''")) {
    return false;
  }
  final PyStringLiteralExpression pyString=DocStringUtil.getParentDefinitionDocString(element);
  if (pyString != null) {
    String nodeText=element.getText();
    final int prefixLength=PyStringLiteralExpressionImpl.getPrefixLength(nodeText);
    nodeText=nodeText.substring(prefixLength);
    final String literalText=pyString.getText();
    if (literalText.endsWith(nodeText) && nodeText.startsWith(quotes)) {
      if (firstQuoteOffset == pyString.getTextOffset() + prefixLength) {
        PsiErrorElement error=PsiTreeUtil.getNextSiblingOfType(pyString,PsiErrorElement.class);
        if (error != null) {
          return true;
        }
        error=PsiTreeUtil.getNextSiblingOfType(pyString.getParent(),PsiErrorElement.class);
        if (error != null) {
          return true;
        }
        if (nodeText.length() < 6 || !nodeText.endsWith(quotes)) {
          return true;
        }
        final String docstringIndent=PyIndentUtil.getLineIndent(document,document.getLineNumber(firstQuoteOffset));
        for (        String line : LineTokenizer.tokenizeIntoList(nodeText,false)) {
          final String lineIndent=(String)PyIndentUtil.getLineIndent(line);
          final String lineContent=line.substring(lineIndent.length());
          if ((lineContent.startsWith("def ") || lineContent.startsWith("class ")) && docstringIndent.length() > lineIndent.length() && docstringIndent.startsWith(lineIndent)) {
            return true;
          }
        }
      }
    }
  }
  return false;
}
