{
  Document document=editor.getDocument();
  if (!isValid(document)) {
    return;
  }
  EditorColorsScheme scheme=EditorColorsManager.getInstance().getGlobalScheme();
  final TextAttributes defaultTestAttributes=new TextAttributes(scheme.getDefaultForeground(),scheme.getDefaultBackground(),null,EffectType.BOXED,Font.PLAIN);
  final JBColor color=getColor();
  int startOffset=document.getLineStartOffset(line) + start;
  RangeHighlighter rh=editor.getMarkupModel().addRangeHighlighter(startOffset,startOffset + length,HighlighterLayer.LAST + 1,defaultTestAttributes,HighlighterTargetArea.EXACT_RANGE);
  rh.setCustomRenderer(new CustomHighlighterRenderer(){
    @Override public void paint(    @NotNull Editor editor,    @NotNull RangeHighlighter highlighter,    @NotNull Graphics g){
      g.setColor(color);
      Point point=editor.logicalPositionToXY(editor.offsetToLogicalPosition(highlighter.getStartOffset()));
      Point pointEnd=editor.logicalPositionToXY(editor.offsetToLogicalPosition(highlighter.getEndOffset()));
      g.drawRect(point.x,point.y - 2,(pointEnd.x - point.x),editor.getLineHeight() + 1);
    }
  }
);
  if (drawSelection) {
    editor.getSelectionModel().setSelection(startOffset,startOffset + length);
  }
  if (moveCaret) {
    editor.getCaretModel().moveToOffset(startOffset);
  }
  rh.setGreedyToLeft(true);
  rh.setGreedyToRight(true);
}
