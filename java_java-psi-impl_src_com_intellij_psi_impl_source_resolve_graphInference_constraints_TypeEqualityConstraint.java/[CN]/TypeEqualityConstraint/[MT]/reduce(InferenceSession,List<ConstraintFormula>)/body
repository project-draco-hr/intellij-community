{
  if (myT instanceof PsiWildcardType && myS instanceof PsiWildcardType) {
    final PsiType tBound=((PsiWildcardType)myT).getBound();
    final PsiType sBound=((PsiWildcardType)myS).getBound();
    if (tBound == null && sBound == null)     return true;
    if (sBound == null && ((PsiWildcardType)myT).isExtends()) {
      constraints.add(new TypeEqualityConstraint(((PsiWildcardType)myS).getExtendsBound(),tBound));
      return true;
    }
    if (tBound == null && ((PsiWildcardType)myS).isExtends()) {
      constraints.add(new TypeEqualityConstraint(((PsiWildcardType)myT).getExtendsBound(),sBound));
      return true;
    }
    if (((PsiWildcardType)myT).isExtends() && ((PsiWildcardType)myS).isExtends() || ((PsiWildcardType)myT).isSuper() && ((PsiWildcardType)myS).isSuper()) {
      LOG.assertTrue(tBound != null);
      LOG.assertTrue(sBound != null);
      constraints.add(new TypeEqualityConstraint(tBound,sBound));
      return true;
    }
  }
  if (myT instanceof PsiWildcardType || myS instanceof PsiWildcardType) {
    return false;
  }
  if (session.isProperType(myT) && session.isProperType(myS)) {
    if (myT == null)     return myS == null || myS.equalsToText(CommonClassNames.JAVA_LANG_OBJECT);
    if (myS == null)     return true;
    return Comparing.equal(myT,myS);
  }
  InferenceVariable inferenceVariable=session.getInferenceVariable(myS);
  if (inferenceVariable != null) {
    inferenceVariable.addBound(myT,InferenceBound.EQ);
    return true;
  }
  inferenceVariable=session.getInferenceVariable(myT);
  if (inferenceVariable != null) {
    inferenceVariable.addBound(myS,InferenceBound.EQ);
    return true;
  }
  if (myT instanceof PsiClassType && myS instanceof PsiClassType) {
    final PsiClassType.ClassResolveResult tResult=((PsiClassType)myT).resolveGenerics();
    final PsiClassType.ClassResolveResult sResult=((PsiClassType)myS).resolveGenerics();
    final PsiClass tClass=tResult.getElement();
    if (tClass != null && tClass.equals(sResult.getElement())) {
      final PsiSubstitutor tSubstitutor=tResult.getSubstitutor();
      final PsiSubstitutor sSubstitutor=sResult.getSubstitutor();
      for (      PsiTypeParameter typeParameter : tClass.getTypeParameters()) {
        final PsiType tSubstituted=tSubstitutor.substitute(typeParameter);
        final PsiType sSubstituted=sSubstitutor.substitute(typeParameter);
        if (tSubstituted != null && sSubstituted != null) {
          constraints.add(new TypeEqualityConstraint(tSubstituted,sSubstituted));
        }
      }
      return true;
    }
  }
  if (myT instanceof PsiArrayType && myS instanceof PsiArrayType) {
    constraints.add(new TypeEqualityConstraint(((PsiArrayType)myT).getComponentType(),((PsiArrayType)myS).getComponentType()));
    return true;
  }
  if (myT instanceof PsiCapturedWildcardType && myS instanceof PsiCapturedWildcardType) {
    return new TypeEqualityConstraint(((PsiCapturedWildcardType)myT).getWildcard(),((PsiCapturedWildcardType)myS).getWildcard()).reduce(session,constraints);
  }
  return false;
}
