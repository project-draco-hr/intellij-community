{
  final PsiBuilder.Marker rootMarker=builder.mark();
  while (!builder.eof()) {
    IElementType type=builder.getTokenType();
    if (type == RestTokenTypes.EXPLISIT_MARKUP_START) {
      builder.advanceLexer();
      parseMarkup(builder);
    }
 else     if (type == RestTokenTypes.REFERENCE_NAME || type == RestTokenTypes.SUBSTITUTION) {
      PsiBuilder.Marker marker=builder.mark();
      builder.advanceLexer();
      marker.done(RestTokenTypes.REFERENCE_NAME);
    }
 else     if (type == RestTokenTypes.TITLE) {
      PsiBuilder.Marker marker=builder.mark();
      builder.advanceLexer();
      marker.done(RestTokenTypes.TITLE);
    }
 else     if (type == RestTokenTypes.FIELD) {
      PsiBuilder.Marker marker=builder.mark();
      builder.advanceLexer();
      marker.done(RestTokenTypes.FIELD);
    }
 else     if (type == RestTokenTypes.INLINE_LINE) {
      PsiBuilder.Marker marker=builder.mark();
      builder.advanceLexer();
      marker.done(RestElementTypes.INLINE_BLOCK);
    }
 else     if (type == RestTokenTypes.ANONYMOUS_HYPERLINK) {
      PsiBuilder.Marker marker=builder.mark();
      builder.advanceLexer();
      marker.done(RestElementTypes.REFERENCE_TARGET);
    }
 else     if (type == RestTokenTypes.LINE) {
      PsiBuilder.Marker marker=builder.mark();
      while (type == RestTokenTypes.LINE || type == RestTokenTypes.WHITESPACE) {
        builder.advanceLexer();
        type=builder.getTokenType();
      }
      marker.done(RestElementTypes.LINE_TEXT);
    }
 else     builder.advanceLexer();
  }
  rootMarker.done(root);
  return builder.getTreeBuilt();
}
