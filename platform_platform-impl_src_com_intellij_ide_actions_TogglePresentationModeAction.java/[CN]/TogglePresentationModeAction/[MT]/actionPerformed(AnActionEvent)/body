{
  UISettings settings=UISettings.getInstance();
  Project project=e.getProject();
  settings.PRESENTATION_MODE=!settings.PRESENTATION_MODE;
  if (project != null) {
    hideToolWindows(project);
  }
  settings.fireUISettingsChanged();
  UIDefaults defaults=UIManager.getDefaults();
  Enumeration<Object> keys=defaults.keys();
  if (settings.PRESENTATION_MODE) {
    while (keys.hasMoreElements()) {
      Object key=keys.nextElement();
      if (key instanceof String && !((String)key).startsWith("old.") && ((String)key).endsWith(".font")) {
        Font font=defaults.getFont(key);
        defaults.put("old." + key,font);
        defaults.put(key,font.deriveFont((float)Math.min(20,settings.PRESENTATION_MODE_FONT_SIZE)));
      }
    }
  }
 else {
    while (keys.hasMoreElements()) {
      Object key=keys.nextElement();
      if (key instanceof String && ((String)key).startsWith("old.") && ((String)key).endsWith(".font")) {
        Font font=defaults.getFont(key);
        defaults.put(((String)key).substring(4),font);
        defaults.put(key,font);
      }
    }
  }
  if (project != null) {
    Window frame=IdeFrameImpl.getActiveFrame();
    if (frame instanceof IdeFrameImpl) {
      final PropertiesComponent propertiesComponent=PropertiesComponent.getInstance(project);
      if (settings.PRESENTATION_MODE) {
        propertiesComponent.setValue("full.screen.before.presentation.mode",String.valueOf(((IdeFrameImpl)frame).isInFullScreen()));
        ((IdeFrameImpl)frame).toggleFullScreen(true);
      }
 else {
        final String value=propertiesComponent.getValue("full.screen.before.presentation.mode");
        ((IdeFrameImpl)frame).toggleFullScreen("true".equalsIgnoreCase(value));
      }
    }
  }
  UISettings.getInstance().fireUISettingsChanged();
  LafManager.getInstance().updateUI();
  EditorUtil.reinitSettings();
}
