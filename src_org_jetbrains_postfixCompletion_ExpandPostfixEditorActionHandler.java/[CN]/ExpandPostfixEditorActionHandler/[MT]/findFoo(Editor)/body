{
  Project project=editor.getProject();
  if (project == null)   return null;
  PsiFile file=PsiUtilBase.getPsiFileInEditor(editor,project);
  if (file == null)   return null;
  int offset=editor.getCaretModel().getOffset();
  PsiElement elementAt=file.findElementAt(offset);
  if (elementAt == null)   return null;
  if (elementAt instanceof PsiWhiteSpace && offset > 0) {
    elementAt=file.findElementAt(offset - 1);
  }
  if (elementAt == null)   return null;
  PostfixExecutionContext executionContext=new PostfixExecutionContext(true,"postfix",false);
  PostfixTemplateContext templateContext=myTemplatesManager.isAvailable(elementAt,executionContext);
  if (templateContext == null)   return null;
  List<LookupElement> elements=myTemplatesManager.collectTemplates(templateContext);
  Document document=editor.getDocument();
  for (  LookupElement element : elements) {
    String lookupString=element.getLookupString();
    if (offset > lookupString.length()) {
      String prefix=document.getText(new TextRange(offset - lookupString.length(),offset));
      if (prefix.equals(lookupString)) {
        return element;
      }
    }
  }
  return null;
}
