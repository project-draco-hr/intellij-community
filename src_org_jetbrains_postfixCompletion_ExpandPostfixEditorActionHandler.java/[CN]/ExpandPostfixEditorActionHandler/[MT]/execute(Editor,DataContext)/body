{
  final LookupElement lookupElement=findFoo(editor);
  if (lookupElement != null) {
    PsiFile psiFile=PsiUtilBase.getPsiFileInEditor(editor,editor.getProject());
    OffsetMap offsetMap=new OffsetMap(editor.getDocument());
    int offset=editor.getCaretModel().getOffset() - lookupElement.getLookupString().length();
    offsetMap.addOffset(CompletionInitializationContext.START_OFFSET,offset);
    final InsertionContext context=new InsertionContext(offsetMap,'\t',new LookupElement[]{lookupElement},psiFile,editor,false);
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        lookupElement.handleInsert(context);
      }
    }
);
    return;
  }
  myUnderlying.execute(editor,dataContext);
}
