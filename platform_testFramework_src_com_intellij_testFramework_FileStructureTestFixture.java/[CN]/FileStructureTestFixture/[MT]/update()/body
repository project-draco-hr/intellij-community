{
  final Ref<FilteringTreeStructure.FilteringNode> nodeRef=new Ref<FilteringTreeStructure.FilteringNode>();
  final FileStructurePopup popup=getPopup();
  popup.getTreeBuilder().refilter().doWhenProcessed(new Runnable(){
    @Override public void run(){
      getStructure().rebuild();
      updateTree();
      getBuilder().updateFromRoot();
      TreeUtil.expandAll(getTree());
      nodeRef.set(popup.selectPsiElement(popup.getCurrentElement(myFile)));
      getBuilder().getUi().select(nodeRef.get(),null);
    }
  }
);
  return nodeRef.get();
}
