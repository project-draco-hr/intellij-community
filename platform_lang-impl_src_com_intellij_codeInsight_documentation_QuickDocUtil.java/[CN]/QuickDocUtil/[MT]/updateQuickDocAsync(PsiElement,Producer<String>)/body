{
  final Project project=element.getProject();
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      final String documentation=docProducer.produce();
      if (StringUtil.isEmpty(documentation))       return;
      SwingUtilities.invokeLater(new Runnable(){
        @Override public void run(){
          DocumentationManager documentationManager=DocumentationManager.getInstance(project);
          DocumentationComponent component;
          JBPopup hint=documentationManager.getDocInfoHint();
          if (hint != null) {
            component=(DocumentationComponent)((AbstractPopup)hint).getComponent();
          }
 else           if (documentationManager.hasActiveDockedDocWindow()) {
            ToolWindow toolWindow=ToolWindowManager.getInstance(project).getToolWindow(ToolWindowId.DOCUMENTATION);
            Content selectedContent=toolWindow == null ? null : toolWindow.getContentManager().getSelectedContent();
            component=selectedContent == null ? null : (DocumentationComponent)selectedContent.getComponent();
          }
 else {
            component=null;
          }
          if (component != null) {
            component.replaceText(documentation,element);
          }
        }
      }
);
    }
  }
);
}
