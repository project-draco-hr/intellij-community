{
  TextEditorState state=new TextEditorState();
  state.LINE=editor.getCaretModel().getLogicalPosition().line;
  state.COLUMN=editor.getCaretModel().getLogicalPosition().column;
  state.SELECTION_START=editor.getSelectionModel().getSelectionStart();
  state.SELECTION_END=editor.getSelectionModel().getSelectionEnd();
  state.VERTICAL_SCROLL_PROPORTION=level == FileEditorStateLevel.UNDO ? -1 : EditorUtil.calcVerticalScrollProportion(editor);
  if (editor instanceof EditorEx) {
    state.VERTICAL_SCROLL_OFFSET=editor.getScrollingModel().getVerticalScrollOffset();
    JScrollBar scrollBar=((EditorEx)editor).getScrollPane().getVerticalScrollBar();
    state.MAX_VERTICAL_SCROLL_OFFSET=scrollBar == null ? 0 : scrollBar.getMaximum();
  }
  return state;
}
