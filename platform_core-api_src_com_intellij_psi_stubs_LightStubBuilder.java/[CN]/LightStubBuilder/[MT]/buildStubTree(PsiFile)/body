{
  LighterAST tree=myForcedLighterAst;
  if (tree == null) {
    FileType fileType=file.getFileType();
    if (!(fileType instanceof LanguageFileType)) {
      LOG.error("File is not of LanguageFileType: " + fileType + ", "+ file);
      return null;
    }
    Language language=((LanguageFileType)fileType).getLanguage();
    final IFileElementType contentType=LanguageParserDefinitions.INSTANCE.forLanguage(language).getFileNodeType();
    if (!(contentType instanceof ILightStubFileElementType)) {
      LOG.error("File is not of ILightStubFileElementType: " + contentType + ", "+ file);
      return null;
    }
    tree=file.getNode().getLighterAST();
  }
  if (tree == null)   return null;
  final StubElement rootStub=createStubForFile(file,tree);
  buildStubTree(tree,tree.getRoot(),rootStub);
  return rootStub;
}
