{
  MutableNode node=underdoneNodes.remove(commitHash);
  if (node == null) {
    Collection<VcsRef> refs=findRefForHash(commitHash);
    VirtualFile repositoryRoot;
    if (refs.isEmpty()) {
      LOG.error("Ref should exist for this node. Hash: " + commitHash);
      repositoryRoot=NullVirtualFile.INSTANCE;
    }
 else {
      repositoryRoot=refs.iterator().next().getRoot();
    }
    node=createNode(commitHash,new Branch(commitHash,refs,repositoryRoot));
  }
  node.setType(COMMIT_NODE);
  node.setNodeRow(nextRow);
  nextRow.getInnerNodeList().add(node);
  graph.getAllRows().add(nextRow);
  nextRow=new MutableNodeRow(graph,nextRow.getRowIndex() + 1);
  return node;
}
