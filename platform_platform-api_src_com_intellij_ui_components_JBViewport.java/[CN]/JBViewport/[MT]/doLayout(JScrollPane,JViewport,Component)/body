{
  updateBorder(view);
  Dimension actualSize=viewport.getSize();
  Dimension extentSize=viewport.toViewCoordinates(actualSize);
  Dimension viewPreferredSize=view.getPreferredSize();
  Dimension viewSize=new Dimension(viewPreferredSize);
  Point viewPosition=viewport.getViewPosition();
  Scrollable scrollable=null;
  if (view instanceof Scrollable) {
    scrollable=(Scrollable)view;
    if (scrollable.getScrollableTracksViewportWidth())     viewSize.width=actualSize.width;
    if (scrollable.getScrollableTracksViewportHeight())     viewSize.height=actualSize.height;
  }
  int maxX=viewSize.width - extentSize.width;
  if (scrollable == null || pane.getComponentOrientation().isLeftToRight()) {
    if (viewPosition.x > maxX) {
      viewPosition.x=Math.max(0,maxX);
    }
  }
 else {
    viewPosition.x=maxX < 0 ? maxX : Math.max(0,Math.min(maxX,viewPosition.x));
  }
  int maxY=viewSize.height - extentSize.height;
  if (viewPosition.y > maxY) {
    viewPosition.y=Math.max(0,maxY);
  }
  if (scrollable == null) {
    if (viewPosition.x == 0 && actualSize.width > viewPreferredSize.width)     viewSize.width=actualSize.width;
    if (viewPosition.y == 0 && actualSize.height > viewPreferredSize.height)     viewSize.height=actualSize.height;
  }
  if (!(view instanceof TypingTarget)) {
    if (ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER == pane.getHorizontalScrollBarPolicy()) {
      viewPosition.x=0;
      viewSize.width=extentSize.width;
    }
    if (ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER == pane.getVerticalScrollBarPolicy()) {
      viewPosition.y=0;
      viewSize.height=extentSize.height;
    }
  }
  viewport.setViewPosition(viewPosition);
  viewport.setViewSize(viewSize);
}
