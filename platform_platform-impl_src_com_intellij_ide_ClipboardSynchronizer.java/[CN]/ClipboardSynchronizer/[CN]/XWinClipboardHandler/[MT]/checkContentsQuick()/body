{
  final Clipboard clipboard=Toolkit.getDefaultToolkit().getSystemClipboard();
  final Class<? extends Clipboard> aClass=clipboard.getClass();
  if (!"sun.awt.X11.XClipboard".equals(aClass.getName()))   return null;
  Method getClipboardFormats=ReflectionUtil.getDeclaredMethod(aClass,"getClipboardFormats");
  final String timeout=System.getProperty(DATA_TRANSFER_TIMEOUT_PROPERTY);
  System.setProperty(DATA_TRANSFER_TIMEOUT_PROPERTY,SHORT_TIMEOUT);
  try {
    final long[] formats=(long[])getClipboardFormats.invoke(clipboard);
    if (formats == null || formats.length == 0) {
      return Collections.emptySet();
    }
    @SuppressWarnings({"unchecked"}) final Set<DataFlavor> set=DataTransferer.getInstance().getFlavorsForFormats(formats,FLAVOR_MAP).keySet();
    return set;
  }
 catch (  IllegalAccessException ignore) {
  }
catch (  IllegalArgumentException ignore) {
  }
catch (  InvocationTargetException e) {
    final Throwable cause=e.getCause();
    if (cause instanceof IllegalStateException) {
      throw (IllegalStateException)cause;
    }
  }
 finally {
    System.setProperty(DATA_TRANSFER_TIMEOUT_PROPERTY,timeout);
  }
  return null;
}
