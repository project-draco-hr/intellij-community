{
  PsiElement element=descriptor.getPsiElement();
  if (element == null)   return;
  final PsiFile myFile=element.getContainingFile();
  if (!FileModificationService.getInstance().prepareFileForWrite(myFile))   return;
  try {
    String error;
    PsiDirectory directory=null;
    try {
      directory=MoveClassesOrPackagesUtil.chooseDestinationPackage(project,myTargetPackage,myFile.getContainingDirectory());
      if (directory == null) {
        return;
      }
      error=RefactoringMessageUtil.checkCanCreateFile(directory,myFile.getName());
    }
 catch (    IncorrectOperationException e) {
      error=e.getLocalizedMessage();
    }
    if (error != null) {
      Messages.showMessageDialog(project,error,CommonBundle.getErrorTitle(),Messages.getErrorIcon());
      return;
    }
    new MoveClassesOrPackagesProcessor(project,((PsiJavaFile)myFile).getClasses(),new SingleSourceRootMoveDestination(PackageWrapper.create(JavaDirectoryService.getInstance().getPackage(directory)),directory),false,false,null).run();
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
