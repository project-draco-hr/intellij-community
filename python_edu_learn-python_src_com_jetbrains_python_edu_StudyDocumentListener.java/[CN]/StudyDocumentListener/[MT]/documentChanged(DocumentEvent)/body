{
  if (e instanceof DocumentEventImpl) {
    DocumentEventImpl event=(DocumentEventImpl)e;
    Document document=e.getDocument();
    if (myEmptyDocument) {
      Editor editor=StudyEditor.getSelectedEditor(myProject);
      if (editor != null && editor.getDocument() == document) {
        myTaskFile.drawAllWindows(editor);
        return;
      }
    }
    int offset=e.getOffset();
    int change=event.getNewLength() - event.getOldLength();
    if (myTaskWindow != null) {
      int newLength=myTaskWindow.getLength() + change;
      myTaskWindow.setLength(newLength <= 0 ? 0 : newLength);
      if (e.getNewFragment().equals("\n")) {
        myTaskWindow.setLength(myTaskWindow.getLength() + 1);
      }
    }
    int newEnd=offset + event.getNewLength();
    int newLine=document.getLineNumber(newEnd);
    int lineChange=newLine - myOldLine;
    myTaskFile.incrementLines(myOldLine + 1,lineChange);
    int newEndOffsetInLine=offset + e.getNewLength() - document.getLineStartOffset(newLine);
    int oldEndOffsetInLine=offset + e.getOldLength() - myOldLineStartOffset;
    myTaskFile.updateLine(lineChange,myOldLine,newEndOffsetInLine,oldEndOffsetInLine);
  }
}
