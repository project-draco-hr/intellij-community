{
  Editor editor=CommonDataKeys.EDITOR.getData(dataContext);
  if (editor == null) {
    final PsiFile file=CommonDataKeys.PSI_FILE.getData(dataContext);
    if (file != null) {
      final VirtualFile virtualFile=file.getVirtualFile();
      if (virtualFile != null) {
        final FileEditor fileEditor=FileEditorManager.getInstance(file.getProject()).getSelectedEditor(virtualFile);
        if (fileEditor instanceof TextEditor) {
          editor=((TextEditor)fileEditor).getEditor();
        }
      }
    }
  }
  return editor;
}
