{
  Pattern pat=Pattern.compile(markerRegexp);
  Matcher mat=pat.matcher(fileText);
  int rest_index=0;
  Map<String,Integer> offsets=new HashMap<String,Integer>();
  StringBuffer text=new StringBuffer();
  while (mat.find(rest_index)) {
    String mark=mat.group();
    CharSequence prev_part=fileText.subSequence(rest_index,mat.start());
    text.append(prev_part);
    offsets.put(mark,text.length());
    rest_index=mat.end();
  }
  if (rest_index < fileText.length())   text.append(fileText.substring(rest_index));
  Map<String,PsiElement> result=new HashMap<String,PsiElement>();
  myFile=createFile(myModule,fileName,text.toString());
  for (  Map.Entry<String,Integer> entry : offsets.entrySet()) {
    result.put(entry.getKey(),myFile.findElementAt(entry.getValue()));
  }
  return result;
}
