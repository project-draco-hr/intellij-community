{
  final FoldRegion[] allRegions=editor.getFoldingModel().getAllFoldRegions();
  Arrays.sort(allRegions,RangeMarker.BY_START_OFFSET);
  return new Iterator<FoldRegion>(){
    private int sectionStart;
    private int current;
    private int sectionEnd;
{
      advanceSection();
    }
    private void advanceSection(){
      sectionStart=sectionEnd;
      for (sectionEnd=sectionStart + 1; sectionEnd < allRegions.length && allRegions[sectionEnd].getStartOffset() == allRegions[sectionStart].getStartOffset(); sectionEnd++)       ;
      current=sectionEnd;
    }
    @Override public boolean hasNext(){
      return current > sectionStart || sectionEnd < allRegions.length;
    }
    @Override public FoldRegion next(){
      if (!hasNext()) {
        throw new NoSuchElementException();
      }
      if (current <= sectionStart) {
        advanceSection();
      }
      return allRegions[--current];
    }
  }
;
}
