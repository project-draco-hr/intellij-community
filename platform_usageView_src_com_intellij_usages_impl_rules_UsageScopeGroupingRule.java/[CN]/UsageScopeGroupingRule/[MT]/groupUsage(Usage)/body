{
  if (!(usage instanceof PsiElementUsage)) {
    return null;
  }
  PsiElementUsage elementUsage=(PsiElementUsage)usage;
  PsiElement element=elementUsage.getElement();
  VirtualFile virtualFile=PsiUtilCore.getVirtualFile(element);
  if (virtualFile == null) {
    return null;
  }
  Project project=element.getProject();
  ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  boolean isInLib=fileIndex.isInLibraryClasses(virtualFile) || fileIndex.isInLibrarySource(virtualFile);
  if (isInLib)   return LIBRARY;
  return TestSourcesFilter.isTestSources(virtualFile,project) ? TEST : PRODUCTION;
}
