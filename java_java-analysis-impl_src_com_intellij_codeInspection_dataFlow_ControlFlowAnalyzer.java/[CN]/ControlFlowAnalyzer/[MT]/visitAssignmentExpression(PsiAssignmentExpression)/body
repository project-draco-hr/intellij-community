{
  PsiExpression lExpr=expression.getLExpression();
  PsiExpression rExpr=expression.getRExpression();
  startElement(expression);
  if (rExpr == null) {
    pushUnknown();
    finishElement(expression);
    return;
  }
  IElementType op=expression.getOperationTokenType();
  PsiType type=expression.getType();
  boolean isBoolean=PsiType.BOOLEAN.equals(type);
  if (op == JavaTokenType.EQ) {
    lExpr.accept(this);
    rExpr.accept(this);
    generateBoxingUnboxingInstructionFor(rExpr,type);
  }
 else   if (op == JavaTokenType.ANDEQ) {
    if (isBoolean) {
      generateBooleanAssignmentExpression(true,lExpr,rExpr,type);
    }
 else {
      generateDefaultAssignmentBinOp(lExpr,rExpr,type);
    }
  }
 else   if (op == JavaTokenType.OREQ) {
    if (isBoolean) {
      generateBooleanAssignmentExpression(false,lExpr,rExpr,type);
    }
 else {
      generateDefaultAssignmentBinOp(lExpr,rExpr,type);
    }
  }
 else   if (op == JavaTokenType.XOREQ) {
    if (isBoolean) {
      generateXorExpression(expression,new PsiExpression[]{lExpr,rExpr},type,true);
    }
 else {
      generateDefaultAssignmentBinOp(lExpr,rExpr,type);
    }
  }
 else   if (op == JavaTokenType.PLUSEQ && type != null && type.equalsToText(JAVA_LANG_STRING)) {
    lExpr.accept(this);
    addInstruction(new DupInstruction());
    rExpr.accept(this);
    addInstruction(new BinopInstruction(JavaTokenType.PLUS,null,myProject));
  }
 else {
    generateDefaultAssignmentBinOp(lExpr,rExpr,type);
  }
  addInstruction(new AssignInstruction(rExpr,myFactory.createValue(lExpr)));
  flushArrayElementsOnUnknownIndexAssignment(lExpr);
  finishElement(expression);
}
