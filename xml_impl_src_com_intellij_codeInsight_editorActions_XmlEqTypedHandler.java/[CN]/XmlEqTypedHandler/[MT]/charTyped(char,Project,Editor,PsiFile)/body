{
  if (needToInsertQuotes) {
    int offset=editor.getCaretModel().getOffset();
    PsiElement fileContext=file.getContext();
    String toInsert="\"\"";
    if (fileContext != null) {
      if (fileContext.getText().startsWith("\""))       toInsert="''";
    }
    editor.getDocument().insertString(offset,toInsert);
    editor.getCaretModel().moveToOffset(offset + 1);
    AutoPopupController.getInstance(project).scheduleAutoPopup(editor);
  }
  needToInsertQuotes=false;
  return super.charTyped(c,project,editor,file);
}
