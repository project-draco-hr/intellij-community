{
  if (needToInsertQuotes) {
    int offset=editor.getCaretModel().getOffset();
    PsiElement fileContext=file.getContext();
    String toInsert=null;
    if (fileContext != null) {
      if (fileContext.getText().startsWith("\""))       toInsert="''";
      if (fileContext.getText().startsWith("\'"))       toInsert="\"\"";
    }
    if (toInsert == null) {
      final String quote=XmlAttributeInsertHandler.getAttributeQuote(HtmlUtil.hasHtml(file) || HtmlUtil.supportsXmlTypedHandlers(file));
      toInsert=quote + quote;
    }
    editor.getDocument().insertString(offset,toInsert);
    editor.getCaretModel().moveToOffset(offset + toInsert.length() / 2);
    AutoPopupController.getInstance(project).scheduleAutoPopup(editor);
  }
  needToInsertQuotes=false;
  return super.charTyped(c,project,editor,file);
}
