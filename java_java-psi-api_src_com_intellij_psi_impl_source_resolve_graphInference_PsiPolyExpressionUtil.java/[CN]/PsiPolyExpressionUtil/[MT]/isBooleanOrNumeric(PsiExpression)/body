{
  if (expr instanceof PsiParenthesizedExpression) {
    return isBooleanOrNumeric(((PsiParenthesizedExpression)expr).getExpression());
  }
  if (expr == null)   return null;
  PsiType type=null;
  if (expr instanceof PsiNewExpression && !PsiDiamondType.hasDiamond((PsiNewExpression)expr) || hasStandaloneForm(expr)) {
    type=expr.getType();
  }
 else   if (expr instanceof PsiMethodCallExpression) {
    final PsiMethod method=((PsiMethodCallExpression)expr).resolveMethod();
    if (method != null) {
      type=method.getReturnType();
    }
  }
  final ConditionalKind kind=isBooleanOrNumericType(type);
  if (kind != null) {
    return kind;
  }
  if (expr instanceof PsiConditionalExpression) {
    final PsiExpression thenExpression=((PsiConditionalExpression)expr).getThenExpression();
    final PsiExpression elseExpression=((PsiConditionalExpression)expr).getElseExpression();
    final ConditionalKind thenKind=isBooleanOrNumeric(thenExpression);
    final ConditionalKind elseKind=isBooleanOrNumeric(elseExpression);
    if (thenKind == elseKind || elseKind == null)     return thenKind;
    if (thenKind == null)     return elseKind;
  }
  return null;
}
