{
  final String qName=aClass.getQualifiedName();
  if (qName != null) {
    buf.append(qName);
  }
 else {
    final PsiClass parentClass=PsiTreeUtil.getContextOfType(aClass,PsiClass.class,true);
    if (parentClass != null) {
      formatClassName(parentClass,buf);
      buf.append("$");
      buf.append(getNonQualifiedClassIdx(aClass,parentClass));
      final String name=aClass.getName();
      if (name != null) {
        buf.append(name);
      }
    }
  }
}
