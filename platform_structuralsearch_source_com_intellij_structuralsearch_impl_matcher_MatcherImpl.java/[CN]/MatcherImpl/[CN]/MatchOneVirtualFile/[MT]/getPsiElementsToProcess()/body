{
  return ApplicationManager.getApplication().runReadAction(new Computable<List<PsiElement>>(){
    @Override public List<PsiElement> compute(){
      final PsiFile file=PsiManager.getInstance(project).findFile(myFileOrDir);
      if (file == null) {
        return Collections.emptyList();
      }
      final FileViewProvider viewProvider=file.getViewProvider();
      final List<PsiElement> elementsToProcess=new SmartList<PsiElement>();
      for (      Language lang : viewProvider.getLanguages()) {
        if (myProfile.isMyFile(file,lang,myOurPatternLanguage,myOurPatternLanguage2)) {
          elementsToProcess.add(viewProvider.getPsi(lang));
        }
      }
      return elementsToProcess;
    }
  }
);
}
