{
  Profile inspectionProfile=null;
  if (myProfileName != null) {
    inspectionProfile=loadProfileByName(myProfileName);
    if (inspectionProfile == null) {
      logError("Profile with configured name (" + myProfileName + ") was not found (neither in project nor in config directory)");
      gracefulExit();
      return null;
    }
    return inspectionProfile;
  }
  if (myProfilePath != null) {
    inspectionProfile=loadProfileByPath(myProfilePath);
    if (inspectionProfile == null) {
      logError("Failed to load profile from \'" + myProfilePath + "\'");
      gracefulExit();
      return null;
    }
    return inspectionProfile;
  }
  if (myStubProfile != null) {
    if (!myRunWithEditorSettings) {
      inspectionProfile=loadProfileByName(myStubProfile);
      if (inspectionProfile != null)       return inspectionProfile;
      inspectionProfile=loadProfileByPath(myStubProfile);
      if (inspectionProfile != null)       return inspectionProfile;
    }
    inspectionProfile=InspectionProjectProfileManager.getInstance(myProject).getInspectionProfile();
    logError("Using default project profile");
  }
  return inspectionProfile;
}
