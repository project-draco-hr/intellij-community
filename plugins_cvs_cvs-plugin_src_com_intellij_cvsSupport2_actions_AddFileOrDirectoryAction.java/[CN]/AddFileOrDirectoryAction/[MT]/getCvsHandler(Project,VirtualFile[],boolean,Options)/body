{
  final ArrayList<VirtualFile> filesToAdd=collectFilesToAdd(files);
  if (filesToAdd.isEmpty())   return CvsHandler.NULL;
  LOG.assertTrue(!filesToAdd.isEmpty());
  final Collection<AddedFileInfo> roots=new CreateTreeOnFileList(filesToAdd,project).getRoots();
  if (roots.isEmpty()) {
    LOG.error(filesToAdd);
  }
  if (showDialog) {
    final AbstractAddOptionsDialog dialog=AbstractAddOptionsDialog.createDialog(project,roots,dialogOptions);
    if (!dialog.showAndGet()) {
      return CvsHandler.NULL;
    }
  }
  return CommandCvsHandler.createAddFilesHandler(project,roots);
}
