{
  myProject=project;
  myRequestChain=requestChain;
  myAvailableTools=DiffManagerEx.getInstance().getDiffTools();
  myToolOrder=new LinkedList<DiffTool>(myAvailableTools);
  myContext=new MyDiffContext();
  myActiveRequest=NoDiffRequest.INSTANCE;
  myDiffWindow=new MyDiffWindow();
  myPanel=new MyPanel();
  myContentPanel=new ModifiablePanel();
  myToolbarPanel=new ModifiablePanel();
  myToolbarStatusPanel=new ModifiablePanel();
  JPanel topPanel=new JPanel(new BorderLayout());
  if (!useShortHeader) {
    myTitleLabel=null;
    topPanel.add(myToolbarPanel,BorderLayout.WEST);
    topPanel.add(myToolbarStatusPanel,BorderLayout.EAST);
  }
 else {
    JPanel toolbarPanel=new JPanel(new BorderLayout());
    toolbarPanel.add(myToolbarPanel,BorderLayout.WEST);
    toolbarPanel.add(myToolbarStatusPanel,BorderLayout.EAST);
    myTitleLabel=new JLabel();
    myTitleLabel.setBorder(BorderFactory.createEmptyBorder(1,2,0,0));
    topPanel.add(myTitleLabel,BorderLayout.WEST);
    topPanel.add(toolbarPanel,BorderLayout.EAST);
  }
  myPanel.add(topPanel,BorderLayout.NORTH);
  myPanel.add(myContentPanel,BorderLayout.CENTER);
  JComponent bottomPanel=myContext.getUserData(DiffUserDataKeysEx.BOTTOM_PANEL);
  if (bottomPanel != null)   myPanel.add(bottomPanel,BorderLayout.SOUTH);
  if (bottomPanel instanceof Disposable)   Disposer.register(this,(Disposable)bottomPanel);
  myPanel.setFocusTraversalPolicyProvider(true);
  myPanel.setFocusTraversalPolicy(new MyFocusTraversalPolicy());
  myOpenInEditorAction=new OpenInEditorAction(new Runnable(){
    @Override public void run(){
      onAfterNavigate();
    }
  }
);
  myShowActionGroupPopupAction=new ShowActionGroupPopupAction();
}
