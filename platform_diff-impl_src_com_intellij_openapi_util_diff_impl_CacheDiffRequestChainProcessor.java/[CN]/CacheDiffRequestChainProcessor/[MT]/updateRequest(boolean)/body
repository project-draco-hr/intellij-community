{
  boolean hadFocus=isFocused();
  DiffRequest request=loadRequest();
  if (!force && request == myActiveRequest)   return;
  myActiveRequest.onAssigned(false);
  request.onAssigned(true);
  myActiveRequest=request;
  myActiveTool=getSuitableTool(myActiveRequest);
  if (myActiveViewer != null)   Disposer.dispose(myActiveViewer);
  myActiveViewer=myActiveTool.createComponent(myContext,myActiveRequest);
  myContentPanel.setContent(myActiveViewer.getComponent());
  if (myTitleLabel != null) {
    myTitleLabel.setText(request.getWindowTitle());
  }
 else {
    setWindowTitle(request.getWindowTitle());
  }
  myPanel.validate();
  DiffTool.ToolbarComponents toolbarComponents=myActiveViewer.init();
  DefaultActionGroup group=buildToolbar(toolbarComponents.toolbarActions);
  myToolbarPanel.setContent(DiffUtil.createToolbar(group).getComponent());
  for (  AnAction action : group.getChildren(null)) {
    action.registerCustomShortcutSet(action.getShortcutSet(),myPanel);
  }
  myToolbarStatusPanel.setContent(toolbarComponents.statusPanel);
  myPanel.validate();
  if (hadFocus)   requestFocus();
}
