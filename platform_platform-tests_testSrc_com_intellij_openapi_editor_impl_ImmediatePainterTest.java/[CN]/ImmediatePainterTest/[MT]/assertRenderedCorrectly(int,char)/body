{
  myEditor.getCaretModel().getPrimaryCaret().moveToOffset(offset);
  JComponent editorComponent=myEditor.getContentComponent();
  Dimension size=editorComponent.getPreferredSize();
  editorComponent.setSize(size);
  KeyboardFocusManager.setCurrentKeyboardFocusManager(new MockFocusManager(editorComponent));
  BufferedImage image=UIUtil.createImage(size.width,size.height,BufferedImage.TYPE_INT_ARGB);
  Graphics2D graphics=image.createGraphics();
  BufferedImage immediateImage;
  DataContext dataContext=((EditorImpl)myEditor).getDataContext();
  try {
    editorComponent.paint(graphics);
    ((EditorImpl)myEditor).processKeyTypedImmediately(c,graphics,dataContext);
    immediateImage=copy(image);
    ((EditorImpl)myEditor).processKeyTypedNormally(c,dataContext);
    editorComponent.paint(graphics);
  }
  finally {
    graphics.dispose();
  }
  assertEqual(immediateImage,image);
}
