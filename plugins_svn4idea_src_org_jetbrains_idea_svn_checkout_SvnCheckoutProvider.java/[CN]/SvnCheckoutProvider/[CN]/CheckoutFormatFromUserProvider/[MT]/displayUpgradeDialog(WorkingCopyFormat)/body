{
  final UpgradeFormatDialog dialog=new UpgradeFormatDialog(myProject,myPath,false);
  final ModalityState dialogState=ModalityState.any();
  dialog.startLoading();
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      final List<WorkingCopyFormat> formats=loadSupportedFormats();
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          final String errorMessage=error.get();
          if (errorMessage != null) {
            dialog.doCancelAction();
            Messages.showErrorDialog(SvnBundle.message("message.text.cannot.load.supported.formats",errorMessage),SvnBundle.message("message.title.check.out"));
          }
 else {
            dialog.setSupported(formats);
            dialog.setData(ContainerUtil.getFirstItem(formats,WorkingCopyFormat.UNKNOWN));
            dialog.stopLoading();
          }
        }
      }
,dialogState);
    }
  }
);
  dialog.show();
  return dialog.isOK() ? dialog.getUpgradeMode() : WorkingCopyFormat.UNKNOWN;
}
