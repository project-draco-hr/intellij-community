{
synchronized (this) {
    if (myCommonSettingsMap == null) {
      return;
    }
    final Map<String,Language> idToLang=new THashMap<>();
    for (    Language language : myCommonSettingsMap.keySet()) {
      idToLang.put(language.getID(),language);
    }
    String[] languages=ArrayUtil.toStringArray(ContainerUtil.union(myUnknownSettingsMap.keySet(),idToLang.keySet()));
    Arrays.sort(languages);
    for (    String id : languages) {
      final Language language=idToLang.get(id);
      if (language != null) {
        final CommonCodeStyleSettings commonSettings=myCommonSettingsMap.get(language);
        Element commonSettingsElement=new Element(COMMON_SETTINGS_TAG);
        commonSettings.writeExternal(commonSettingsElement);
        commonSettingsElement.setAttribute(LANGUAGE_ATTR,language.getID());
        if (!commonSettingsElement.getChildren().isEmpty()) {
          element.addContent(commonSettingsElement);
        }
      }
 else {
        final Content unknown=myUnknownSettingsMap.get(id);
        if (unknown != null) {
          element.addContent(unknown.detach());
        }
      }
    }
  }
}
