{
  XmlDocument document=token.getFile().getDocument();
  if (document != null) {
    XmlTag tag=document.getRootTag();
    if (tag != null && !tag.getText().isEmpty()) {
      tag.accept(new XmlElementVisitor(){
        @Override public void visitXmlTag(        final XmlTag tag){
          if (!tag.isEmpty()) {
            final XmlTagValue tagValue=tag.getValue();
            final Matcher matcher=PATTERN.matcher(tagValue.getText());
            if (matcher.matches()) {
              ApplicationManager.getApplication().runWriteAction(new Runnable(){
                @Override public void run(){
                  tagValue.setText(matcher.replaceAll(""));
                }
              }
);
            }
          }
          tag.acceptChildren(this);
        }
      }
);
      return tag.getText();
    }
 else {
      return PATTERN.matcher(document.getText()).replaceAll("");
    }
  }
  return text;
}
