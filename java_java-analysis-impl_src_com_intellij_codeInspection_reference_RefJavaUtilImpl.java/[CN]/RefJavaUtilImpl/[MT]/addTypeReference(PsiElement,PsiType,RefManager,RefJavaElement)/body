{
  if (psiType != null) {
    final RefClass ownerClass=getOwnerClass(refManager,psiElement);
    if (ownerClass != null) {
      psiType=psiType.getDeepComponentType();
      if (psiType instanceof PsiClassType) {
        PsiClass psiClass=PsiUtil.resolveClassInType(psiType);
        if (psiClass != null && refManager.belongsToScope(psiClass)) {
          RefClassImpl refClass=(RefClassImpl)refManager.getReference(psiClass);
          if (refClass != null) {
            refClass.addTypeReference(ownerClass);
            if (refMethod != null) {
              refClass.addClassExporter(refMethod);
            }
          }
        }
 else {
          ((RefManagerImpl)refManager).fireNodeMarkedReferenced(psiClass,psiElement,false);
        }
      }
    }
  }
}
