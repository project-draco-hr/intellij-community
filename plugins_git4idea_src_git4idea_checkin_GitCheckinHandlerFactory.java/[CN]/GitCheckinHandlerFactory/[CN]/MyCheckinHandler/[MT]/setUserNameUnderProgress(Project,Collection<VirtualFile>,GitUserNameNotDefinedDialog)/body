{
  final Ref<String> error=Ref.create();
  ProgressManager.getInstance().run(new Task.Modal(project,"Setting Git User Name...",false){
    @Override public void run(    @NotNull ProgressIndicator pi){
      try {
        if (dialog.isGlobal()) {
          GitConfigUtil.setValue(project,notDefined.iterator().next(),GitConfigUtil.USER_NAME,dialog.getUserName(),"--global");
          GitConfigUtil.setValue(project,notDefined.iterator().next(),GitConfigUtil.USER_EMAIL,dialog.getUserEmail(),"--global");
        }
 else {
          for (          VirtualFile root : notDefined) {
            GitConfigUtil.setValue(project,root,GitConfigUtil.USER_NAME,dialog.getUserName());
            GitConfigUtil.setValue(project,root,GitConfigUtil.USER_EMAIL,dialog.getUserEmail());
          }
        }
      }
 catch (      VcsException e) {
        String message="Couldn't set user.name and user.email";
        LOG.error(message,e);
        error.set(message);
      }
    }
  }
);
  if (error.isNull()) {
    return true;
  }
 else {
    Messages.showErrorDialog(myPanel.getComponent(),error.get());
    return false;
  }
}
