{
  if (FileTypes.UNKNOWN.equals(fileType))   fileType=PlainTextFileType.INSTANCE;
  LineSeparator separator=respectLineSeparators ? StringUtil.detectSeparators(text) : null;
  String correctedContent=StringUtil.convertLineSeparators(text);
  Document document=createDocument(project,correctedContent,fileType,fileName,readOnly);
  FileAwareDocumentContent content=new FileAwareDocumentContent(project,document,fileType,highlightFile,separator,charset,bom);
  if (fileName != null)   content.putUserData(DiffUserDataKeysEx.FILE_NAME,fileName);
  return content;
}
