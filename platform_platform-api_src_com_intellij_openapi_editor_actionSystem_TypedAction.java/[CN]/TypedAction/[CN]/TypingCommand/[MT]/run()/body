{
  ApplicationManager.getApplication().runWriteAction(new DocumentRunnable(myEditor.getDocument(),myEditor.getProject()){
    @Override public void run(){
      myEditor.getCaretModel().runForEachCaret(new CaretAction(){
        @Override public void perform(        Caret caret){
          Document doc=myEditor.getDocument();
          doc.startGuardedBlockChecking();
          try {
            getHandler().execute(myEditor,myCharTyped,myDataContext);
          }
 catch (          ReadOnlyFragmentModificationException e) {
            EditorActionManager.getInstance().getReadonlyFragmentModificationHandler(doc).handle(e);
          }
 finally {
            doc.stopGuardedBlockChecking();
          }
        }
      }
);
    }
  }
);
}
