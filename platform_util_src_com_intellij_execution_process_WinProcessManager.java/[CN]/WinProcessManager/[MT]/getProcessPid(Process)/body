{
  if (process.getClass().getName().equals("java.lang.Win32Process") || process.getClass().getName().equals("java.lang.ProcessImpl")) {
    try {
      long handle=ReflectionUtil.getField(process.getClass(),process,long.class,"handle");
      Kernel32 kernel=Kernel32.INSTANCE;
      WinNT.HANDLE winHandle=new WinNT.HANDLE();
      winHandle.setPointer(Pointer.createConstant(handle));
      return kernel.GetProcessId(winHandle);
    }
 catch (    Throwable e) {
      throw new IllegalStateException(e);
    }
  }
 else {
    throw new IllegalStateException("Unknown Process implementation");
  }
}
