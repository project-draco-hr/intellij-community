{
  final Collection<DataNode<?>> moduleDataNodes=dataNodes.get(ProjectKeys.MODULE);
  if (!moduleDataNodes.isEmpty()) {
    final AbstractExternalSystemSettings systemSettings=ExternalSystemApiUtil.getSettings(externalProjectsView.getProject(),externalProjectsView.getSystemId());
    for (    DataNode<?> dataNode : moduleDataNodes) {
      final ModuleData data=(ModuleData)dataNode.getData();
      final ExternalProjectSettings projectSettings=systemSettings.getLinkedProjectSettings(data.getLinkedExternalProjectPath());
      DataNode<ProjectData> projectDataNode=ExternalSystemApiUtil.findParent(dataNode,PROJECT);
      final boolean isRoot=projectSettings != null && data.getLinkedExternalProjectPath().equals(projectSettings.getExternalProjectPath()) && projectDataNode != null && projectDataNode.getData().getInternalName().equals(data.getInternalName());
      final ModuleNode moduleNode=new ModuleNode(externalProjectsView,(DataNode<ModuleData>)dataNode,isRoot);
      result.add(moduleNode);
    }
  }
}
