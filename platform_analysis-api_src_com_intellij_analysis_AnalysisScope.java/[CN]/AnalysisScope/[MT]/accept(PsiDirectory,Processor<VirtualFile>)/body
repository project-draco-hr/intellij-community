{
  final Project project=dir.getProject();
  final ProjectFileIndex index=ProjectRootManager.getInstance(project).getFileIndex();
  final boolean processGeneratedFiles=GeneratedSourcesFilter.isGeneratedSourceByAnyFilter(dir.getVirtualFile(),project);
  return VfsUtilCore.iterateChildrenRecursively(dir.getVirtualFile(),VirtualFileFilter.ALL,new ContentIterator(){
    @Override @SuppressWarnings({"SimplifiableIfStatement"}) public boolean processFile(    @NotNull final VirtualFile fileOrDir){
      if (isFiltered(fileOrDir,index))       return true;
      if (!processGeneratedFiles && GeneratedSourcesFilter.isGeneratedSourceByAnyFilter(fileOrDir,project))       return true;
      if (!fileOrDir.isDirectory()) {
        return processor.process(fileOrDir);
      }
      return true;
    }
  }
);
}
