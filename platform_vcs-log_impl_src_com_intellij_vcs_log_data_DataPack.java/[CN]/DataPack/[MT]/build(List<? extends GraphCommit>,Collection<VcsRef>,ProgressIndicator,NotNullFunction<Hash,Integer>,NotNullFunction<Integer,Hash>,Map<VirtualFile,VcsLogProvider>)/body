{
  indicator.setText("Building graph...");
  final RefsModel refsModel=new RefsModel(allRefs,indexGetter);
  GraphColorManagerImpl colorManager=new GraphColorManagerImpl(refsModel,hashGetter,getRefManagerMap(logProviders));
  if (USE_NEW_FACADE) {
    if (!commits.isEmpty()) {
      return new DataPack(refsModel,GraphFacadeImpl.newInstance(commits,getBranchCommitHashIndexes(allRefs,indexGetter),colorManager));
    }
 else {
      return new DataPack(refsModel,new EmptyGraphFacade());
    }
  }
 else {
    GraphFacade graphFacade=new GraphFacadeBuilderImpl().build(commits,refsModel,colorManager);
    return new DataPack(refsModel,graphFacade);
  }
}
