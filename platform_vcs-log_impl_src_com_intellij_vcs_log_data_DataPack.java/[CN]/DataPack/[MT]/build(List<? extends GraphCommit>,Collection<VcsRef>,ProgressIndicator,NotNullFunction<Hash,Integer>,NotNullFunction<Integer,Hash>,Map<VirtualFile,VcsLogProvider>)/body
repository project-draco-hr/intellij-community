{
  indicator.setText("Building graph...");
  final RefsModel refsModel=new RefsModel(allRefs,indexGetter);
  GraphColorManagerImpl colorManager=new GraphColorManagerImpl(refsModel,hashGetter,getRefManagerMap(providers));
  if (USE_NEW_FACADE) {
    if (!commits.isEmpty()) {
      return new DataPack(refsModel,GraphFacadeImpl.newInstance(commits,getBranchCommitHashIndexes(allRefs,indexGetter),colorManager),providers);
    }
 else {
      return new DataPack(refsModel,new EmptyGraphFacade(),providers);
    }
  }
 else {
    GraphFacade graphFacade=new GraphFacadeBuilderImpl().build(commits,refsModel,colorManager);
    return new DataPack(refsModel,graphFacade,providers);
  }
}
