{
  FilePath originalFilePath=HgUtil.getOriginalFileName(filePath,ChangeListManager.getInstance(project));
  if (revisionNumber == null && !filePath.isDirectory() && !filePath.equals(originalFilePath)) {
    return getHistoryForUncommittedRenamed(originalFilePath,vcsRoot,project,limit);
  }
  final HgLogCommand logCommand=new HgLogCommand(project);
  logCommand.setFollowCopies(!filePath.isDirectory());
  logCommand.setIncludeRemoved(true);
  List<String> args=new ArrayList<>();
  if (revisionNumber != null) {
    args.add("--rev");
    args.add("reverse(0::" + revisionNumber.getChangeset() + ")");
  }
  return logCommand.execute(new HgFile(vcsRoot,filePath),limit,false,args);
}
