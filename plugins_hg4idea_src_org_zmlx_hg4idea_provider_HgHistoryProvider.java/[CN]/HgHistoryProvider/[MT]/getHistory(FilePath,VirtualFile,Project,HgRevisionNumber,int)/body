{
  final HgFile hgFile=new HgFile(vcsRoot,filePath);
  FilePath originalFileName=HgUtil.getOriginalFileName(hgFile.toFilePath(),ChangeListManager.getInstance(project));
  HgFile originalHgFile=new HgFile(hgFile.getRepo(),originalFileName);
  if (revisionNumber == null && !filePath.isDirectory() && !originalHgFile.toFilePath().equals(hgFile.toFilePath())) {
    return getHistoryForUncommittedRenamed(originalHgFile,vcsRoot,project,limit);
  }
  final HgLogCommand logCommand=new HgLogCommand(project);
  logCommand.setFollowCopies(!filePath.isDirectory());
  logCommand.setIncludeRemoved(true);
  List<String> args=new ArrayList<String>();
  if (revisionNumber != null) {
    args.add("--rev");
    args.add("reverse(0::" + revisionNumber.getChangeset() + ")");
  }
  return logCommand.execute(hgFile,limit,false,args);
}
