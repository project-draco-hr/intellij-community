{
  if (file == null)   return "";
  return ApplicationManager.getApplication().runReadAction(new Computable<String>(){
    @Override public String compute(){
      ProjectFileIndex fileIndex=ProjectRootManager.getInstance(myProject).getFileIndex();
      boolean hideExcludedFiles=Registry.is("ide.hide.excluded.files");
      Module module=fileIndex.getModuleForFile(file,hideExcludedFiles);
      VirtualFile contentRoot=fileIndex.getContentRootForFile(file,hideExcludedFiles);
      if (module == null || contentRoot == null)       return file.getPresentableUrl();
      StringBuffer result=new StringBuffer();
      result.append("[");
      result.append(module.getName());
      result.append("] ");
      result.append(contentRoot.getName());
      String relativePath=VfsUtilCore.getRelativePath(file,contentRoot,File.separatorChar);
      if (!relativePath.isEmpty()) {
        result.append(File.separatorChar);
        result.append(relativePath);
      }
      return result.toString();
    }
  }
);
}
