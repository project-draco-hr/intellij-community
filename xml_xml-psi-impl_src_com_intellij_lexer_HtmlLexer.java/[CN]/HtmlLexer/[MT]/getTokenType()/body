{
  if (myTokenType != null)   return myTokenType;
  IElementType tokenType=super.getTokenType();
  myTokenStart=super.getTokenStart();
  myTokenEnd=super.getTokenEnd();
  if (hasSeenStyle()) {
    if (hasSeenTag() && isStartOfEmbeddmentTagContent(tokenType)) {
      Language stylesheetLanguage=getStyleLanguage();
      IElementType currentStylesheetElementType;
      if ((stylesheetLanguage == null || LanguageUtil.isInjectableLanguage(stylesheetLanguage)) && (currentStylesheetElementType=getCurrentStylesheetElementType()) != null) {
        myTokenEnd=skipToTheEndOfTheEmbeddment();
        tokenType=currentStylesheetElementType;
      }
    }
 else     if (ourInlineStyleElementType != null && isStartOfEmbeddmentAttributeValue(tokenType) && hasSeenAttribute()) {
      tokenType=ourInlineStyleElementType;
    }
  }
 else   if (hasSeenScript()) {
    if (hasSeenTag() && isStartOfEmbeddmentTagContent(tokenType)) {
      Language scriptLanguage=getScriptLanguage();
      IElementType currentScriptElementType;
      if ((scriptLanguage == null || LanguageUtil.isInjectableLanguage(scriptLanguage)) && (currentScriptElementType=getCurrentScriptElementType()) != null) {
        myTokenEnd=skipToTheEndOfTheEmbeddment();
        tokenType=currentScriptElementType;
      }
    }
 else     if (hasSeenAttribute() && isStartOfEmbeddmentAttributeValue(tokenType) && ourInlineScriptElementType != null) {
      myTokenEnd=skipToTheEndOfTheEmbeddment();
      tokenType=ourInlineScriptElementType;
    }
  }
  return myTokenType=tokenType;
}
