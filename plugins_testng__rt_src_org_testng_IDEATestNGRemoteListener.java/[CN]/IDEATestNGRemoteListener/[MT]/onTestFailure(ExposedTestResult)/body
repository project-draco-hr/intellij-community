{
  Throwable ex=result.getThrowable();
  String methodName=getTestMethodNameWithParams(result);
  final Map<String,String> attrs=new HashMap<String,String>();
  attrs.put("name",methodName);
  final String failureMessage=ex.getMessage();
  ComparisonFailureData notification;
  try {
    notification=TestNGExpectedPatterns.createExceptionNotification(failureMessage);
  }
 catch (  Throwable e) {
    notification=null;
  }
  ComparisonFailureData.registerSMAttributes(notification,getTrace(ex),failureMessage,attrs,ex);
  myPrintStream.println(ServiceMessage.asString(ServiceMessageTypes.TEST_FAILED,attrs));
  onTestFinished(result);
}
