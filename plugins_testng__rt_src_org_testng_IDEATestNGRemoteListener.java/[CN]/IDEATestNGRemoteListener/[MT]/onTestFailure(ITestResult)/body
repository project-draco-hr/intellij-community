{
  final Throwable ex=result.getThrowable();
  final String trace=getTrace(ex);
  final Map<String,String> attrs=new HashMap<String,String>();
  final String methodName=getMethodName(result);
  attrs.put("name",methodName);
  final String failureMessage=ex.getMessage();
  attrs.put("message",failureMessage != null ? failureMessage : "");
  attrs.put("details",trace);
  attrs.put("error","true");
  System.out.println(ServiceMessage.asString(ServiceMessageTypes.TEST_FAILED,attrs));
  System.out.println("##teamcity[testFinished name=\'" + methodName + "\']");
}
