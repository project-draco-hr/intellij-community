{
  final Throwable ex=result.getThrowable();
  final String trace=getTrace(ex);
  final Map<String,String> attrs=new HashMap<String,String>();
  final String methodName=getMethodName(result);
  attrs.put("name",methodName);
  final String failureMessage=ex.getMessage();
  ComparisonFailureData notification;
  try {
    notification=TestNGExpectedPatterns.createExceptionNotification(failureMessage);
  }
 catch (  Throwable e) {
    notification=null;
  }
  ComparisonFailureData.registerSMAttributes(notification,trace,failureMessage,attrs);
  System.out.println(ServiceMessage.asString(ServiceMessageTypes.TEST_FAILED,attrs));
  System.out.println("\n##teamcity[testFinished name=\'" + escapeName(methodName) + "\']");
}
