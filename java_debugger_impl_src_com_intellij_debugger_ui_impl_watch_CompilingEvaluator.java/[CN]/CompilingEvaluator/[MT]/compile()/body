{
  JavaCompiler compiler=ToolProvider.getSystemJavaCompiler();
  MemoryFileManager manager=new MemoryFileManager(compiler);
  DiagnosticCollector<JavaFileObject> diagnostic=new DiagnosticCollector<JavaFileObject>();
  Module module=ModuleUtilCore.findModuleForPsiElement(myPsiContext);
  PathsList cp=null;
  if (module != null) {
    cp=ModuleRootManager.getInstance(module).orderEntries().compileOnly().recursively().exportedOnly().withoutSdk().getPathsList();
  }
  if (!compiler.getTask(null,manager,diagnostic,cp != null ? Arrays.asList("-cp",cp.getPathsString()) : null,null,Arrays.asList(new SourceFileObject(getMainClassName(),JavaFileObject.Kind.SOURCE,getClassCode()))).call()) {
    StringBuilder res=new StringBuilder("Compilation failed:\n");
    for (    Diagnostic<? extends JavaFileObject> d : diagnostic.getDiagnostics()) {
      res.append(d);
    }
    throw new EvaluateException(res.toString());
  }
  return manager.classes;
}
