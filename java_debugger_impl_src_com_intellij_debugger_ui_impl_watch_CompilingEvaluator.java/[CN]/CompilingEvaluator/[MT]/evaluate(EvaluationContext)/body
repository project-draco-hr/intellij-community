{
  DebugProcess process=evaluationContext.getDebugProcess();
  ClassLoaderReference classLoader=ClassLoadingUtils.getClassLoader(evaluationContext,process);
  String version=((VirtualMachineProxyImpl)process.getVirtualMachineProxy()).version();
  Collection<ClassObject> classes=compile(JdkVersionUtil.getVersion(version));
  defineClasses(classes,evaluationContext,process,classLoader);
  try {
    SourcePosition position=ContextUtil.getSourcePosition(evaluationContext);
    ExpressionEvaluator evaluator=DebuggerInvocationUtil.commitAndRunReadAction(myProject,new EvaluatingComputable<ExpressionEvaluator>(){
      @Override public ExpressionEvaluator compute() throws EvaluateException {
        TextWithImports callCode=getCallCode();
        PsiElement copyContext=myData.getAnchor();
        CodeFragmentFactory factory=DebuggerUtilsEx.findAppropriateCodeFragmentFactory(callCode,copyContext);
        return factory.getEvaluatorBuilder().build(factory.createCodeFragment(callCode,copyContext,myProject),position);
      }
    }
);
    ((EvaluationContextImpl)evaluationContext).setClassLoader(classLoader);
    return evaluator.evaluate(evaluationContext);
  }
 catch (  Exception e) {
    throw new EvaluateException("Error during generated code invocation " + e,e);
  }
}
