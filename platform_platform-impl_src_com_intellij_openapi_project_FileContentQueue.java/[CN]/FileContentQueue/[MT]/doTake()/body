{
  FileContent result=null;
  while (result == null) {
    if (ourAllowParallelFileReading) {
      result=myLoadedContentsQueue.poll();
      if (result == null) {
        VirtualFile virtualFileToLoad=myFilesToLoadQueue.poll();
        while (virtualFileToLoad != null) {
          if (isValidFile(virtualFileToLoad)) {
            FileContent content=new FileContent(virtualFileToLoad);
            try {
              content.getBytes();
              return content;
            }
 catch (            Throwable t) {
              if (t instanceof IOException || t instanceof InvalidVirtualFileAccessException) {
                LOG.info(t);
              }
 else {
                LOG.error(t);
              }
            }
          }
          virtualFileToLoad=myFilesToLoadQueue.poll();
        }
        while (!myContentLoadingThreadTerminated) {
          try {
            result=myLoadedContentsQueue.poll(300,TimeUnit.MILLISECONDS);
            if (result != null)             break;
          }
 catch (          InterruptedException ex) {
            throw new RuntimeException(ex);
          }
        }
      }
    }
 else {
      try {
        result=myLoadedContentsQueue.poll(300,TimeUnit.MILLISECONDS);
      }
 catch (      InterruptedException ex) {
        throw new RuntimeException(ex);
      }
    }
    if (result == null && myContentLoadingThreadTerminated) {
      return null;
    }
  }
  final VirtualFile file=result.getVirtualFile();
  if (file == null) {
    try {
      myLoadedContentsQueue.put(result);
    }
 catch (    InterruptedException ignore) {
    }
    return null;
  }
synchronized (myProceedWithLoadingLock) {
    myLoadedBytesInQueue-=result.getLength();
    myProceedWithLoadingLock.notifyAll();
  }
  return result;
}
