{
  String testRoots=System.getProperty("test.roots");
  if (testRoots != null) {
    System.out.println("Collecting tests from roots specified by test.roots property: " + testRoots);
    return testRoots.split(";");
  }
  String[] roots=ExternalClasspathClassLoader.getRoots();
  if (roots != null) {
    if (Comparing.equal(System.getProperty(TestCaseLoader.SKIP_COMMUNITY_TESTS),"true")) {
      System.out.println("Skipping community tests");
      Set<String> set=normalizePaths(roots);
      set.removeAll(normalizePaths(ExternalClasspathClassLoader.getExcludeRoots()));
      roots=ArrayUtil.toStringArray(set);
    }
    System.out.println("Collecting tests from roots specified by classpath.file property: " + Arrays.toString(roots));
    return roots;
  }
 else {
    final ClassLoader loader=TestAll.class.getClassLoader();
    if (loader instanceof URLClassLoader) {
      return getClassRoots(((URLClassLoader)loader).getURLs());
    }
    final Class<? extends ClassLoader> loaderClass=loader.getClass();
    if (loaderClass.getName().equals("com.intellij.util.lang.UrlClassLoader")) {
      try {
        final Method declaredMethod=loaderClass.getDeclaredMethod("getBaseUrls");
        final List<URL> urls=(List<URL>)declaredMethod.invoke(loader);
        return getClassRoots(urls.toArray(new URL[urls.size()]));
      }
 catch (      Throwable ignore) {
      }
    }
    return System.getProperty("java.class.path").split(File.pathSeparator);
  }
}
