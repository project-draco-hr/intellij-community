{
  if (settings.getConfiguration() instanceof ExternalSystemRunConfiguration) {
    final Pair<String,RunnerAndConfigurationSettings> pair=myMap.remove(System.identityHashCode(settings));
    if (pair == null)     return;
    final ExternalProjectsManager.ExternalProjectsStateProvider stateProvider=myManager.getStateProvider();
    final ExternalSystemTaskExecutionSettings taskExecutionSettings=((ExternalSystemRunConfiguration)settings.getConfiguration()).getSettings();
    if (taskExecutionSettings.getExternalProjectPath() == null)     return;
    final TaskActivationState activation=stateProvider.getTasksActivation(taskExecutionSettings.getExternalSystemId(),taskExecutionSettings.getExternalProjectPath());
    for (    Phase phase : Phase.values()) {
      for (Iterator<String> iterator=activation.getTasks(phase).iterator(); iterator.hasNext(); ) {
        String task=iterator.next();
        if (pair.first.equals(task)) {
          iterator.remove();
          break;
        }
      }
    }
  }
}
