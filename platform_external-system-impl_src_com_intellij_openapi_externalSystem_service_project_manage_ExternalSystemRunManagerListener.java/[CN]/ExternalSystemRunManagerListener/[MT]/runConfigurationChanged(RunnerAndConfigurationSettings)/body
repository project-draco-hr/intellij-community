{
  if (settings.getConfiguration() instanceof ExternalSystemRunConfiguration) {
    final Pair<String,RunnerAndConfigurationSettings> pair=myMap.get(System.identityHashCode(settings));
    if (pair != null) {
      final ExternalProjectsManager.ExternalProjectsStateProvider stateProvider=myManager.getStateProvider();
      final ExternalSystemTaskExecutionSettings taskExecutionSettings=((ExternalSystemRunConfiguration)settings.getConfiguration()).getSettings();
      if (taskExecutionSettings.getExternalProjectPath() == null)       return;
      final TaskActivationState activation=stateProvider.getTasksActivation(taskExecutionSettings.getExternalSystemId(),taskExecutionSettings.getExternalProjectPath());
      for (      Phase phase : Phase.values()) {
        final Set<String> modifiableActivationTasks=activation.getTasks(phase);
        for (        String task : ContainerUtil.newTroveSet(modifiableActivationTasks)) {
          if (pair.first.equals(task)) {
            modifiableActivationTasks.remove(task);
            final String runConfigurationActivationTaskName=getRunConfigurationActivationTaskName(settings);
            modifiableActivationTasks.add(runConfigurationActivationTaskName);
            myMap.put(System.identityHashCode(settings),Pair.create(runConfigurationActivationTaskName,settings));
            break;
          }
        }
      }
    }
  }
}
