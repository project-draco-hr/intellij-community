{
  myProgressCallback=callback;
  CommonCodeStyleSettings.IndentOptions defaultIndentOption=options.myIndentOptions;
  CodeStyleSettings settings=options.mySettings;
  BlockIndentOptions blockIndentOptions=new BlockIndentOptions(settings,defaultIndentOption,block);
  myDocument=model.getDocument();
  myReformatContext=options.myReformatContext;
  final InitialInfoBuilder builder=prepareToBuildBlocksSequentially(block,model,options,settings,defaultIndentOption,myProgressCallback);
  myWrapState=new WrapBlocksState(builder,blockIndentOptions);
  myStateProcessor=new StateProcessor(myWrapState);
}
