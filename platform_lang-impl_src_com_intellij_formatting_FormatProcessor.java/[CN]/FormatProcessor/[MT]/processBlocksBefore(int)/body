{
  AdjustWhiteSpacesState state=new AdjustWhiteSpacesState(myFirstTokenBlock,myDependentSpacingEngine,myWrapProcessor,myIndentAdjuster,myBlockMapperHelper,myAlignmentsInsideRangesToModify,myReformatContext,myProgressCallback);
  LeafBlockWrapper last=null;
  while (!state.isDone() && state.getCurrentBlock().getStartOffset() < offset) {
    last=state.getCurrentBlock();
    state.doIteration();
  }
  return state.getCurrentBlock() != null ? state.getCurrentBlock() : last;
}
