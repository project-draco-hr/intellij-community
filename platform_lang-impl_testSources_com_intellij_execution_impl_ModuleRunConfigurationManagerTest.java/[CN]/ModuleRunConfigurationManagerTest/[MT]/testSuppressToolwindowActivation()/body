{
  RunnerAndConfigurationSettings settings=new RunnerAndConfigurationSettingsImpl(new MyRunManagerImpl(),new MyModuleBasedConfiguration("my-name",getProject(),getModule()),false);
  settings.setActivateToolWindowBeforeRun(true);
  MockProgramRunner programRunner=new MockProgramRunner();
  ExecutionEnvironment env=new ExecutionEnvironmentBuilder(getProject(),DefaultRunExecutor.getRunExecutorInstance()).runnerAndSettings(programRunner,settings).build();
  RunContentDescriptor descriptorToReuse=new RunContentDescriptor(null,null,new JPanel(),"name");
  descriptorToReuse.setActivateToolWindowWhenAdded(false);
  descriptorToReuse.setReuseToolWindowActivation(true);
  env.setContentToReuse(descriptorToReuse);
  ExecutionManager executionManager=ExecutionManager.getInstance(getProject());
  executionManager.restartRunProfile(env);
  UIUtil.dispatchAllInvocationEvents();
  RunContentDescriptor lastDescriptor=ExecutionTestUtil.getSingleRunContentDescriptor(executionManager);
  assertFalse(lastDescriptor.isActivateToolWindowWhenAdded());
  Disposer.dispose(descriptorToReuse);
}
