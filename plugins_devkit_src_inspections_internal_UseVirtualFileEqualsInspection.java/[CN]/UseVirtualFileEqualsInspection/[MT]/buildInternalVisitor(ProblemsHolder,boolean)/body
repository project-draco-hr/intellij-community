{
  return new JavaElementVisitor(){
    @Override public void visitBinaryExpression(    @NotNull PsiBinaryExpression expression){
      super.visitBinaryExpression(expression);
      if (!ComparisonUtils.isEqualityComparison(expression)) {
        return;
      }
      final PsiExpression lhs=expression.getLOperand();
      final PsiExpression rhs=expression.getROperand();
      if (rhs == null || lhs.textMatches(PsiKeyword.NULL) || rhs.textMatches(PsiKeyword.NULL) || lhs.textMatches(PsiKeyword.THIS) || rhs.textMatches(PsiKeyword.THIS)) {
        return;
      }
      if (InheritanceUtil.isInheritor(lhs.getType(),VirtualFile.class.getName()) || InheritanceUtil.isInheritor(rhs.getType(),VirtualFile.class.getName())) {
        holder.registerProblem(expression,"VirtualFile objects should be compared by equals(), not ==",ProblemHighlightType.GENERIC_ERROR_OR_WARNING);
      }
    }
  }
;
}
