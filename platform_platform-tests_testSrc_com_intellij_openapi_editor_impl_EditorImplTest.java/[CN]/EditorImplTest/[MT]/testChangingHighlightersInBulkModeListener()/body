{
  DocumentBulkUpdateListener.Adapter listener=new DocumentBulkUpdateListener.Adapter(){
    @Override public void updateFinished(    @NotNull Document doc){
      if (doc == myEditor.getDocument()) {
        myEditor.getMarkupModel().addRangeHighlighter(7,8,0,null,HighlighterTargetArea.EXACT_RANGE);
      }
    }
  }
;
  getProject().getMessageBus().connect(myTestRootDisposable).subscribe(DocumentBulkUpdateListener.TOPIC,listener);
  initText("abcdef");
  DocumentEx document=(DocumentEx)myEditor.getDocument();
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      document.setInBulkUpdate(true);
      document.insertString(3,"\n\n");
      document.setInBulkUpdate(false);
    }
  }
.execute();
  RangeHighlighter[] highlighters=myEditor.getMarkupModel().getAllHighlighters();
  assertEquals(1,highlighters.length);
  assertEquals(7,highlighters[0].getStartOffset());
  assertEquals(8,highlighters[0].getEndOffset());
}
