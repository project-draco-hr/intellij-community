{
  initText("long long line<caret>");
  configureSoftWraps(12);
  DocumentEx document=(DocumentEx)myEditor.getDocument();
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      document.setInBulkUpdate(true);
      document.replaceString(4,5,"-");
      document.setInBulkUpdate(false);
    }
  }
.execute().throwException();
  assertEquals(new VisualPosition(1,5),myEditor.getCaretModel().getVisualPosition());
}
