{
  Element element=new Element(STATE);
synchronized (myStateMap) {
    for (    Map.Entry<String,WindowState> entry : myStateMap.entrySet()) {
      String key=entry.getKey();
      if (key != null) {
        WindowState state=entry.getValue();
        Element child=new Element(STATE);
        if (state.myLocation != null) {
          writeTo(child,X,state.myLocation.x);
          writeTo(child,Y,state.myLocation.y);
        }
        if (state.mySize != null) {
          writeTo(child,WIDTH,state.mySize.width);
          writeTo(child,HEIGHT,state.mySize.height);
        }
        if (state.myState != null) {
          writeTo(child,EXTENDED,state.myState);
        }
        writeTo(element,KEY,key);
        element.addContent(child);
      }
    }
  }
  return element;
}
