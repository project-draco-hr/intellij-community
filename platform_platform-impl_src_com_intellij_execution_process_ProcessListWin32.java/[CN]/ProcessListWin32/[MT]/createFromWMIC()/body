{
  @SuppressWarnings("SpellCheckingInspection") String[] command={"wmic.exe","path","win32_process","get","Caption,Processid,Commandline"};
  Process p=ProcessUtils.createProcess(command,null,null);
  List<ProcessInfo> lst=new ArrayList<ProcessInfo>();
  BufferedReader br=new BufferedReader(new InputStreamReader(p.getInputStream()));
  try {
    String line=br.readLine();
    int commandLineI=line.indexOf("CommandLine");
    int processIdI=line.indexOf("ProcessId");
    if (commandLineI == -1) {
      throw new AssertionError("Could not find CommandLine in: " + line);
    }
    if (processIdI == -1) {
      throw new AssertionError("Could not find ProcessId in: " + line);
    }
    while (true) {
      line=br.readLine();
      if (line == null) {
        break;
      }
      if (line.trim().length() == 0) {
        continue;
      }
      String name=line.substring(0,commandLineI).trim();
      String commandLine=line.substring(commandLineI,processIdI).trim();
      String processId=line.substring(processIdI,line.length()).trim();
      lst.add(new ProcessInfo(Integer.parseInt(processId),name,commandLine));
    }
    if (lst.size() == 0) {
      throw new AssertionError("Error: no processes found");
    }
    return lst.toArray(new ProcessInfo[lst.size()]);
  }
 catch (  Exception e) {
    LOG.error(e);
    throw e;
  }
 finally {
    br.close();
  }
}
