{
  if (replace == Replace.ID_REPLACE) {
    return;
  }
  checkReplace(replace);
  cache.clear();
  int deltaSize=replace.addedElementCount() - replace.removedElementCount();
  int upSaveIndex=binarySearch(replace.from());
  if (upSaveIndex > 0) {
    upSaveIndex--;
  }
 else {
    positionItems.set(0,new PositionItem(0,generator.generateFirst()));
  }
  PositionItem upSavePositionItem=positionItems.get(upSaveIndex);
  int downSaveIndex=upSaveIndex;
  while (downSaveIndex < positionItems.size() && positionItems.get(downSaveIndex).getPosition() <= replace.to()) {
    downSaveIndex++;
  }
  size=size + deltaSize;
  fixPositionsTail(downSaveIndex,deltaSize);
  int downSavePosition=size;
  if (downSaveIndex < positionItems.size()) {
    downSavePosition=positionItems.get(downSaveIndex).getPosition();
  }
  List<PositionItem> mediate=regenerateMediate(upSavePositionItem,downSavePosition);
  positionItems.subList(upSaveIndex + 1,downSaveIndex).clear();
  positionItems.addAll(upSaveIndex + 1,mediate);
}
