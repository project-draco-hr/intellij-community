{
  checkReplace(replace);
  cache.clear();
  int deltaSize=replace.addElementsCount() - replace.removeElementsCount();
  int upSaveIndex=binarySearch(replace.from());
  PositionItem upSavePositionItem=positionItems.get(upSaveIndex);
  int downSaveIndex=upSaveIndex;
  while (downSaveIndex < positionItems.size() && positionItems.get(downSaveIndex).getPosition() < replace.to()) {
    downSaveIndex++;
  }
  size=size + deltaSize;
  fixPositionsTail(downSaveIndex,deltaSize);
  int downSavePosition=size;
  if (downSaveIndex < positionItems.size()) {
    downSavePosition=positionItems.get(downSaveIndex).getPosition();
  }
  List<PositionItem> mediate=regenerateMediate(upSavePositionItem,downSavePosition);
  positionItems.subList(upSaveIndex + 1,downSaveIndex).clear();
  positionItems.addAll(upSaveIndex + 1,mediate);
}
