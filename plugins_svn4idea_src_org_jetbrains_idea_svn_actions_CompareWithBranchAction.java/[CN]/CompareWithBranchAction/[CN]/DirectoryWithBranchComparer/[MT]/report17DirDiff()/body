{
  final File ioFile=new File(myVirtualFile.getPath());
  final SVNWCClient wcClient=myVcs.createWCClient();
  final SVNInfo info1=wcClient.doInfo(ioFile,SVNRevision.HEAD);
  if (info1 == null) {
    SVNErrorMessage err=SVNErrorMessage.create(SVNErrorCode.ENTRY_NOT_FOUND,"''{0}'' is not under version control",myVirtualFile.getPath());
    SVNErrorManager.error(err,SVNLogType.WC);
  }
 else   if (info1.getURL() == null) {
    SVNErrorMessage err=SVNErrorMessage.create(SVNErrorCode.ENTRY_MISSING_URL,"''{0}'' has no URL",myVirtualFile.getPath());
    SVNErrorManager.error(err,SVNLogType.WC);
  }
  final SVNReporter17 reporter17=new SVNReporter17(ioFile,new SVNWCContext(SvnConfiguration.getInstance(myProject).getOptions(myProject),new ISVNEventHandler(){
    @Override public void handleEvent(    SVNEvent event,    double progress) throws SVNException {
    }
    @Override public void checkCancelled() throws SVNCancelException {
    }
  }
),false,true,SVNDepth.INFINITY,false,false,true,false,SVNDebugLog.getDefaultLog());
  SVNRepository repository=null;
  SVNRepository repository2=null;
  try {
    repository=myVcs.createRepository(info1.getURL());
    long rev=repository.getLatestRevision();
    repository2=myVcs.createRepository(myElementUrl.toString());
    SvnDiffEditor diffEditor=new SvnDiffEditor(myVirtualFile,repository2,rev,true);
    repository.diff(myElementUrl,rev,rev,null,true,SVNDepth.INFINITY,false,reporter17,SVNCancellableEditor.newInstance(diffEditor,new SvnProgressCanceller(),null));
    changes.addAll(diffEditor.getChangesMap().values());
  }
  finally {
    if (repository != null) {
      repository.closeSession();
    }
    if (repository2 != null) {
      repository2.closeSession();
    }
  }
}
