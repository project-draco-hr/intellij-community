{
  if (defaultTargetDirectory == null) {
    defaultTargetDirectory=getCommonParentDirectory(elements);
  }
  Project project=defaultTargetDirectory != null ? defaultTargetDirectory.getProject() : elements[0].getProject();
  if (defaultTargetDirectory != null) {
    defaultTargetDirectory=resolveDirectory(defaultTargetDirectory);
    if (defaultTargetDirectory == null)     return;
  }
  if (defaultTargetDirectory == null) {
    VirtualFile root=project.getBaseDir();
    if (root == null)     root=VfsUtil.getUserHomeDir();
    if (root != null)     defaultTargetDirectory=PsiManager.getInstance(project).findDirectory(root);
  }
  copyAsFiles(elements,defaultTargetDirectory,project);
}
