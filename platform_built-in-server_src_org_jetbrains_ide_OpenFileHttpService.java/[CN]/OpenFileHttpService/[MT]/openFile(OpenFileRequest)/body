{
  String systemIndependentName=FileUtil.toSystemIndependentName(FileUtil.expandUserHome(request.file));
  final File file=new File(systemIndependentName);
  if (file.isAbsolute()) {
    if (com.intellij.ide.impl.ProjectUtil.isRemotePath(systemIndependentName)) {
      final Ref<Promise<Void>> result=new Ref<>();
      try {
        SwingUtilities.invokeAndWait(new Runnable(){
          @Override public void run(){
            if (System.currentTimeMillis() - lastTimeRejected < waitUntilNextRequestTimeout) {
              return;
            }
            String msg=IdeBundle.message("warning.load.file.from.share",systemIndependentName);
            String title=IdeBundle.message("title.load.file.from.share");
            boolean confirmed=com.intellij.ide.impl.ProjectUtil.confirmLoadingFromRemotePath(msg,title);
            if (!confirmed) {
              lastTimeRejected=System.currentTimeMillis();
              waitUntilNextRequestTimeout=Math.min(2 * Math.max(waitUntilNextRequestTimeout,2000),60 * 60 * 1000);
              result.set(Promise.reject(NOT_FOUND));
            }
 else {
              waitUntilNextRequestTimeout=0;
            }
          }
        }
);
      }
 catch (      Throwable ignored) {
      }
      if (result.get() != null) {
        return result.get();
      }
    }
    return openAbsolutePath(file,request);
  }
  RefreshQueue queue=RefreshQueue.getInstance();
  queue.cancelSession(refreshSessionId);
  OpenFileTask task=new OpenFileTask(FileUtil.toCanonicalPath(systemIndependentName,'/'),request);
  requests.offer(task);
  RefreshSession session=queue.createSession(true,true,new Runnable(){
    @Override public void run(){
      OpenFileTask task;
      while ((task=requests.poll()) != null) {
        try {
          if (openRelativePath(task.path,task.request)) {
            task.promise.setResult(null);
          }
 else {
            task.promise.setError(NOT_FOUND);
          }
        }
 catch (        Throwable e) {
          task.promise.setError(e);
        }
      }
    }
  }
,ModalityState.NON_MODAL);
  session.addAllFiles(ManagingFS.getInstance().getLocalRoots());
  refreshSessionId=session.getId();
  session.launch();
  return task.promise;
}
