{
  List<VirtualFile> result=new ArrayList<VirtualFile>();
  final Module[] modules=ModuleManager.getInstance(psiPackage.getProject()).getModules();
  String qualifiedName=psiPackage.getQualifiedName();
  for (  final Module module : modules) {
    for (    final ContentEntry contentEntry : ModuleRootManager.getInstance(module).getContentEntries()) {
      final List<SourceFolder> sourceFolders=contentEntry.getSourceFolders(JavaModuleSourceRootTypes.SOURCES);
      for (      final SourceFolder sourceFolder : sourceFolders) {
        final String packagePrefix=sourceFolder.getPackagePrefix();
        if (packagePrefix.startsWith(qualifiedName)) {
          final VirtualFile file=sourceFolder.getFile();
          if (file != null) {
            result.add(file);
          }
        }
      }
    }
  }
  return VfsUtilCore.toVirtualFileArray(result);
}
