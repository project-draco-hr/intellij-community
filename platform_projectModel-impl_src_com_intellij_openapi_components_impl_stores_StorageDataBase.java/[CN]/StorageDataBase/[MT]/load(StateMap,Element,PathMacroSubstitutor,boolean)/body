{
  if (pathMacroSubstitutor != null) {
    pathMacroSubstitutor.expandPaths(rootElement);
  }
  StringInterner interner=intern ? new StringInterner() : null;
  for (Iterator<Element> iterator=rootElement.getChildren(COMPONENT).iterator(); iterator.hasNext(); ) {
    Element element=iterator.next();
    String name=getComponentNameIfValid(element);
    if (name == null || !(element.getAttributes().size() > 1 || !element.getChildren().isEmpty())) {
      continue;
    }
    iterator.remove();
    if (interner != null) {
      JDOMUtil.internElement(element,interner);
    }
    states.put(name,element);
    if (pathMacroSubstitutor instanceof TrackingPathMacroSubstitutor) {
      ((TrackingPathMacroSubstitutor)pathMacroSubstitutor).addUnknownMacros(name,PathMacrosCollector.getMacroNames(element));
    }
    element.removeAttribute(NAME);
  }
}
