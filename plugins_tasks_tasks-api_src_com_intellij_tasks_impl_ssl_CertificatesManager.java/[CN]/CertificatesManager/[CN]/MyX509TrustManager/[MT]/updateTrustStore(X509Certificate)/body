{
  Application app=ApplicationManager.getApplication();
  if (app.isUnitTestMode() || app.isHeadlessEnvironment()) {
    myCustomManager.addCertificate(certificate);
    return;
  }
  final CountDownLatch proceeded=new CountDownLatch(1);
  app.invokeLater(new Runnable(){
    @Override public void run(){
      try {
        if (new UntrustedCertificateWarningDialog(certificate).showAndGet()) {
          LOG.debug("Certificate was accepted");
          myCustomManager.addCertificate(certificate);
        }
      }
  finally {
        proceeded.countDown();
      }
    }
  }
,ModalityState.any());
  try {
    proceeded.await();
  }
 catch (  InterruptedException e) {
    LOG.error(e);
  }
}
