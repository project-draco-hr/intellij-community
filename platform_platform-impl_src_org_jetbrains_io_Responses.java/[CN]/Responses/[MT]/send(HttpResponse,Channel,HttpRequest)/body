{
  if (response.getStatus() != HttpResponseStatus.NOT_MODIFIED && !HttpHeaders.isContentLengthSet(response)) {
    HttpHeaders.setContentLength(response,response instanceof FullHttpResponse ? ((FullHttpResponse)response).content().readableBytes() : 0);
  }
  addCommonHeaders(response);
  send(response,channel,request != null && !addKeepAliveIfNeed(response,request));
}
