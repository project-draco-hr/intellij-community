{
  final TextFieldWithPopupHandlerUI ui=this;
  myTextField.addFocusListener(new FocusAdapter(){
    @Override public void focusGained(    FocusEvent e){
      myTextField.repaint();
    }
    @Override public void focusLost(    FocusEvent e){
      myTextField.repaint();
    }
  }
);
  myTextField.addMouseMotionListener(new MouseMotionAdapter(){
    @Override public void mouseMoved(    MouseEvent e){
      if (ui.getComponent() != null && isSearchField(myTextField)) {
        if (ui.getActionUnder(e) != null) {
          myTextField.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
        }
 else {
          myTextField.setCursor(Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR));
        }
      }
    }
  }
);
  myTextField.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      if (isSearchField(myTextField)) {
        final SearchAction action=ui.getActionUnder(e);
        if (action != null) {
switch (action) {
case POPUP:
            ui.showSearchPopup();
          break;
case CLEAR:
        Object listener=myTextField.getClientProperty("JTextField.Search.CancelAction");
      if (listener instanceof ActionListener) {
        ((ActionListener)listener).actionPerformed(new ActionEvent(this,ActionEvent.ACTION_PERFORMED,"action"));
      }
    myTextField.setText("");
  break;
}
e.consume();
}
}
}
}
);
}
