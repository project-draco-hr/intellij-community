{
  if (!LanguageLevel.forElement(file).isPy3K())   return false;
  PyExpression problemElement=PsiTreeUtil.getParentOfType(file.findElementAt(editor.getCaretModel().getOffset() - 1),PyNamedParameter.class);
  if (problemElement == null)   problemElement=PsiTreeUtil.getTopmostParentOfType(file.findElementAt(editor.getCaretModel().getOffset() - 1),PyQualifiedExpression.class);
  if (problemElement == null)   return false;
  if (problemElement instanceof PyQualifiedExpression) {
    final PyExpression qualifier=((PyQualifiedExpression)problemElement).getQualifier();
    if (qualifier != null && !qualifier.getText().equals(PyNames.CANONICAL_SELF)) {
      problemElement=qualifier;
    }
  }
  if (problemElement.getParent() instanceof PyCallExpression || PsiTreeUtil.getParentOfType(problemElement,PyLambdaExpression.class) != null) {
    return false;
  }
  final PyType type=problemElement.getType(TypeEvalContext.slow());
  if (type == null || type instanceof PyReturnTypeReference) {
    PyFunction pyFunction=PsiTreeUtil.getParentOfType(problemElement,PyFunction.class);
    PsiReference reference=problemElement.getReference();
    if (problemElement instanceof PyQualifiedExpression) {
      final PyExpression qualifier=((PyQualifiedExpression)problemElement).getQualifier();
      if (qualifier != null && !qualifier.getText().equals(PyNames.CANONICAL_SELF))       reference=qualifier.getReference();
    }
    if (pyFunction != null) {
      PyParameter parameter=null;
      final PsiElement resolvedReference=reference != null ? reference.resolve() : null;
      if (problemElement instanceof PyParameter)       parameter=(PyParameter)problemElement;
 else       if (resolvedReference instanceof PyParameter)       parameter=(PyParameter)resolvedReference;
      if (parameter instanceof PyNamedParameter && (((PyNamedParameter)parameter).getAnnotation() != null || parameter.getDefaultValue() != null))       return false;
      if (parameter != null)       return true;
 else {
        if (resolvedReference instanceof PyTargetExpression) {
          final PyExpression assignedValue=((PyTargetExpression)resolvedReference).findAssignedValue();
          if (assignedValue instanceof PyCallExpression) {
            final Callable callable=((PyCallExpression)assignedValue).resolveCalleeFunction(PyResolveContext.defaultContext());
            if (callable instanceof PyFunction && ((PyFunction)callable).getAnnotation() == null)             return true;
          }
        }
      }
    }
  }
  return false;
}
