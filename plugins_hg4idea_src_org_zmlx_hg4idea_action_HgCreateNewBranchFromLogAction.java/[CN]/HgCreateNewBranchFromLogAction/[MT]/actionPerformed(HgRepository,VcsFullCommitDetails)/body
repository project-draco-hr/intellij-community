{
  final Hash revisionHash=commit.getId();
  final Project project=repository.getProject();
  FileDocumentManager.getInstance().saveAllDocuments();
  String shortHash=revisionHash.toShortString();
  final String name=getNewBranchNameFromUser(repository,"Create New Branch From " + shortHash);
  if (name != null) {
    new Task.Backgroundable(project,HgVcsMessages.message("hg4idea.progress.updatingTo",shortHash)){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        if (HgUpdateCommand.updateRepoToInCurrentThread(project,repository.getRoot(),revisionHash.asString(),false)) {
          new HgBranchPopupActions.HgNewBranchAction(project,Collections.singletonList(repository),repository).createNewBranch(name);
        }
      }
    }
.queue();
  }
}
