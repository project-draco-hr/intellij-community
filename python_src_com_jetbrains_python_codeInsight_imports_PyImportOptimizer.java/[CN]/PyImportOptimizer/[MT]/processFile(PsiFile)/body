{
  final LocalInspectionToolSession session=new LocalInspectionToolSession(file,0,file.getTextLength());
  final PyUnresolvedReferencesInspection.Visitor visitor=new PyUnresolvedReferencesInspection.Visitor(null,session,Collections.<String>emptyList());
  file.accept(new PyRecursiveElementVisitor(){
    @Override public void visitPyElement(    PyElement node){
      super.visitPyElement(node);
      node.accept(visitor);
    }
  }
);
  return new Runnable(){
    @Override public void run(){
      visitor.optimizeImports();
      if (file instanceof PyFile) {
        new ImportSorter((PyFile)file).run();
      }
    }
  }
;
}
