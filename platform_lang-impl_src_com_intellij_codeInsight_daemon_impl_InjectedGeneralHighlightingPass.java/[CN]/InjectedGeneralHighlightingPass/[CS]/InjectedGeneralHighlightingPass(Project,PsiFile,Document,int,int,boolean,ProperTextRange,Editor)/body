{
  super(project,file,document,startOffset,endOffset,updateAll,priorityRange,editor);
  LOG.assertTrue(file.isValid());
  setId(Pass.UPDATE_ALL);
  final DaemonCodeAnalyzerEx codeAnalyzer=DaemonCodeAnalyzerEx.getInstanceEx(project);
  myApplyCommand=new Runnable(){
    @Override public void run(){
      ProperTextRange range=new ProperTextRange(myStartOffset,myEndOffset);
      MarkupModel model=DocumentMarkupModel.forDocument(myDocument,myProject,true);
      codeAnalyzer.cleanFileLevelHighlights(myProject,Pass.UPDATE_ALL,myFile);
      final EditorColorsScheme colorsScheme=getColorsScheme();
      UpdateHighlightersUtil.setHighlightersInRange(myProject,myDocument,range,colorsScheme,myHighlights,(MarkupModelEx)model,getId());
    }
  }
;
  setProgressLimit(document.getTextLength() / 2);
}
