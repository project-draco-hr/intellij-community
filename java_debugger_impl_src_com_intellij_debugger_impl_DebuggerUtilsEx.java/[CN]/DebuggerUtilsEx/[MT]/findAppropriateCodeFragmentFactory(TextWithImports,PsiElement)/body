{
  CodeFragmentFactory factory=ApplicationManager.getApplication().runReadAction(new Computable<CodeFragmentFactory>(){
    @Override public CodeFragmentFactory compute(){
      return getCodeFragmentFactory(context,text.getFileType());
    }
  }
);
  return new CodeFragmentFactoryContextWrapper(factory);
}
