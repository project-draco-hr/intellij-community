{
  if (expression == null)   return null;
  if (expression instanceof PsiParenthesizedExpression) {
    return getExpressionDfaValue(((PsiParenthesizedExpression)expression).getExpression());
  }
  if (expression instanceof PsiArrayAccessExpression) {
    PsiExpression arrayExpression=((PsiArrayAccessExpression)expression).getArrayExpression();
    DfaValue qualifier=getExpressionDfaValue(arrayExpression);
    if (qualifier instanceof DfaVariableValue) {
      PsiVariable indexVar=getArrayIndexVariable(((PsiArrayAccessExpression)expression).getIndexExpression());
      if (indexVar != null) {
        return myFactory.getVarFactory().createVariableValue(indexVar,expression.getType(),false,(DfaVariableValue)qualifier);
      }
    }
    return null;
  }
  if (expression instanceof PsiMethodCallExpression) {
    return createReferenceValue(((PsiMethodCallExpression)expression).getMethodExpression());
  }
  if (expression instanceof PsiReferenceExpression) {
    return createReferenceValue((PsiReferenceExpression)expression);
  }
  if (expression instanceof PsiLiteralExpression) {
    return myFactory.createLiteralValue((PsiLiteralExpression)expression);
  }
  if (expression instanceof PsiNewExpression || expression instanceof PsiLambdaExpression) {
    return myFactory.createTypeValue(expression.getType(),Nullness.NOT_NULL);
  }
  final Object value=JavaConstantExpressionEvaluator.computeConstantExpression(expression,false);
  PsiType type=expression.getType();
  if (value != null && type != null) {
    if (value instanceof String) {
      return myFactory.createTypeValue(type,Nullness.NOT_NULL);
    }
    return myFactory.getConstFactory().createFromValue(value,type,null);
  }
  return null;
}
