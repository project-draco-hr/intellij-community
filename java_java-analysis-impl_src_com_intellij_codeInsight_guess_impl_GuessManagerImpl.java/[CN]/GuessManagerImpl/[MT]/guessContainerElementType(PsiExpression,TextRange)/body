{
  HashSet<PsiType> typesSet=new HashSet<>();
  PsiType type=containerExpr.getType();
  PsiType elemType;
  if ((elemType=getGenericElementType(type)) != null)   return new PsiType[]{elemType};
  if (containerExpr instanceof PsiReferenceExpression) {
    PsiElement refElement=((PsiReferenceExpression)containerExpr).resolve();
    if (refElement instanceof PsiVariable) {
      PsiFile file=refElement.getContainingFile();
      if (file == null) {
        file=containerExpr.getContainingFile();
      }
      HashSet<PsiVariable> checkedVariables=new HashSet<>();
      addTypesByVariable(typesSet,(PsiVariable)refElement,file,checkedVariables,CHECK_USAGE | CHECK_DOWN,rangeToIgnore);
      checkedVariables.clear();
      addTypesByVariable(typesSet,(PsiVariable)refElement,file,checkedVariables,CHECK_UP,rangeToIgnore);
    }
  }
  return typesSet.toArray(PsiType.createArray(typesSet.size()));
}
