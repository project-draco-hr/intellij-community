{
  ProjectFileIndex fileIndex=ProjectRootManager.getInstance(myProject).getFileIndex();
  VirtualFile temp=myRootVFile.createChildDirectory(this,"temp");
  VirtualFile fileSourceRoot=myRootVFile.createChildData(this,"fileSourceRoot.txt");
  checkNotInProject(fileSourceRoot);
  PsiTestUtil.addContentRoot(myModule,fileSourceRoot);
  PsiTestUtil.addSourceRoot(myModule,fileSourceRoot);
  checkInfo(fileSourceRoot,myModule,false,false,"",JavaSourceRootType.SOURCE,myModule);
  assertTrue(fileIndex.isInContent(fileSourceRoot));
  assertTrue(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot.delete(this);
  checkNotInProject(fileSourceRoot);
  assertFalse(fileIndex.isInContent(fileSourceRoot));
  assertFalse(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot=myRootVFile.createChildData(this,"fileSourceRoot.txt");
  checkInfo(fileSourceRoot,myModule,false,false,"",JavaSourceRootType.SOURCE,myModule);
  assertTrue(fileIndex.isInContent(fileSourceRoot));
  assertTrue(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot.delete(this);
  checkNotInProject(fileSourceRoot);
  assertFalse(fileIndex.isInContent(fileSourceRoot));
  assertFalse(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot=temp.createChildData(this,"fileSourceRoot.txt");
  checkNotInProject(fileSourceRoot);
  fileSourceRoot.move(this,myRootVFile);
  checkInfo(fileSourceRoot,myModule,false,false,"",JavaSourceRootType.SOURCE,myModule);
  assertTrue(fileIndex.isInContent(fileSourceRoot));
  assertTrue(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot.delete(this);
  checkNotInProject(fileSourceRoot);
  assertFalse(fileIndex.isInContent(fileSourceRoot));
  assertFalse(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot=temp.createChildData(this,"fileSourceRoot.txt");
  checkNotInProject(fileSourceRoot);
  fileSourceRoot=fileSourceRoot.copy(this,myRootVFile,"fileSourceRoot.txt");
  checkInfo(fileSourceRoot,myModule,false,false,"",JavaSourceRootType.SOURCE,myModule);
  assertTrue(fileIndex.isInContent(fileSourceRoot));
  assertTrue(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot.delete(this);
  checkNotInProject(fileSourceRoot);
  assertFalse(fileIndex.isInContent(fileSourceRoot));
  assertFalse(fileIndex.isInSource(fileSourceRoot));
  fileSourceRoot=myRootVFile.createChildData(this,"temp_file.txt");
  checkNotInProject(fileSourceRoot);
  fileSourceRoot.rename(this,"fileSourceRoot.txt");
  checkInfo(fileSourceRoot,myModule,false,false,"",JavaSourceRootType.SOURCE,myModule);
  assertTrue(fileIndex.isInContent(fileSourceRoot));
  assertTrue(fileIndex.isInSource(fileSourceRoot));
}
