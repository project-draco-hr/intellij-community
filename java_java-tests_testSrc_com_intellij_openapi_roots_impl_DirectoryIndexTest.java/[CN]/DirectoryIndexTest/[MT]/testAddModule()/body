{
  myIndex.checkConsistency();
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      VirtualFile newModuleContent=createChildDirectory(myRootVFile,"newModule");
      createChildDirectory(newModuleContent,"subDir");
      ModuleManager moduleManager=ModuleManager.getInstance(myProject);
      Module module=moduleManager.newModule(myRootVFile.getPath() + "/newModule.iml",StdModuleTypes.JAVA.getId());
      PsiTestUtil.addContentRoot(module,newModuleContent);
    }
  }
.execute().throwException();
  myIndex.checkConsistency();
}
