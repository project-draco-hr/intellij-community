{
  String rootPath=myModule1Dir.getPath();
  final File f=new File(rootPath,"excludedDir/dir/anotherContentRoot");
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ModifiableRootModel rootModel=ModuleRootManager.getInstance(myModule).getModifiableModel();
      rootModel.getContentEntries()[0].addExcludeFolder(VfsUtilCore.pathToUrl(FileUtil.toSystemIndependentName(f.getParentFile().getParent())));
      rootModel.commit();
      ModuleRootModificationUtil.addContentRoot(myModule2,FileUtil.toSystemIndependentName(f.getPath()));
      assertTrue(f.getPath(),f.exists() || f.mkdirs());
      LocalFileSystem.getInstance().refresh(false);
    }
  }
);
  assertExcluded(LocalFileSystem.getInstance().findFileByIoFile(f.getParentFile().getParentFile()),myModule);
  assertInProject(LocalFileSystem.getInstance().findFileByIoFile(f));
}
