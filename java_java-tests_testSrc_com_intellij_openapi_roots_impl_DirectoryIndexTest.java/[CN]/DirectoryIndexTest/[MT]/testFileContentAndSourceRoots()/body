{
  VirtualFile fileRoot=createChildData(myRootVFile,"fileRoot.txt");
  VirtualFile fileSourceRoot=createChildData(myRootVFile,"fileSourceRoot.txt");
  VirtualFile fileTestSourceRoot=createChildData(myRootVFile,"fileTestSourceRoot.txt");
  assertNotInProject(fileRoot);
  assertFalse(myFileIndex.isInContent(fileRoot));
  assertIteratedContent(myFileIndex,null,Arrays.asList(fileRoot,fileSourceRoot,fileTestSourceRoot));
  ContentEntry contentEntry=PsiTestUtil.addContentRoot(myModule,fileRoot);
  assertEquals(fileRoot,contentEntry.getFile());
  checkInfo(fileRoot,myModule,false,false,"",null);
  assertTrue(myFileIndex.isInContent(fileRoot));
  assertFalse(myFileIndex.isInSource(fileRoot));
  PsiTestUtil.addContentRoot(myModule,fileSourceRoot);
  PsiTestUtil.addSourceRoot(myModule,fileSourceRoot);
  checkInfo(fileSourceRoot,myModule,false,false,"",JavaSourceRootType.SOURCE,myModule);
  assertTrue(myFileIndex.isInContent(fileSourceRoot));
  assertTrue(myFileIndex.isInSource(fileSourceRoot));
  PsiTestUtil.addContentRoot(myModule,fileTestSourceRoot);
  PsiTestUtil.addSourceRoot(myModule,fileTestSourceRoot,true);
  checkInfo(fileTestSourceRoot,myModule,false,false,"",JavaSourceRootType.TEST_SOURCE,myModule);
  assertTrue(myFileIndex.isInContent(fileTestSourceRoot));
  assertTrue(myFileIndex.isInSource(fileTestSourceRoot));
  assertIteratedContent(myFileIndex,Arrays.asList(fileRoot,fileSourceRoot,fileTestSourceRoot),null);
  PsiTestUtil.removeSourceRoot(myModule,fileTestSourceRoot);
  checkInfo(fileTestSourceRoot,myModule,false,false,"",null);
  assertTrue(myFileIndex.isInContent(fileTestSourceRoot));
  assertFalse(myFileIndex.isInSource(fileTestSourceRoot));
  assertIteratedContent(myFileIndex,Arrays.asList(fileRoot,fileSourceRoot,fileTestSourceRoot),null);
  PsiTestUtil.removeContentEntry(myModule,contentEntry.getFile());
  assertNotInProject(fileRoot);
  assertFalse(myFileIndex.isInContent(fileRoot));
  assertFalse(myFileIndex.isInSource(fileRoot));
  assertIteratedContent(myFileIndex,Arrays.asList(fileSourceRoot,fileTestSourceRoot),Arrays.asList(fileRoot));
}
