{
  final ScopeOwner owner=ScopeUtil.getScopeOwner(this);
  if (ControlFlowCache.getScope(owner).isGlobal(getName())) {
    return GlobalSearchScope.projectScope(getProject());
  }
  PyElement container=this;
  while (true) {
    PyElement parentContainer=PsiTreeUtil.getParentOfType(container,PyFunction.class,PyClass.class);
    if (parentContainer instanceof PyClass) {
      if (getQualifier() != null) {
        return super.getUseScope();
      }
      break;
    }
    if (parentContainer == null) {
      break;
    }
    container=parentContainer;
  }
  if (container instanceof PyFunction) {
    return new LocalSearchScope(container);
  }
  return super.getUseScope();
}
