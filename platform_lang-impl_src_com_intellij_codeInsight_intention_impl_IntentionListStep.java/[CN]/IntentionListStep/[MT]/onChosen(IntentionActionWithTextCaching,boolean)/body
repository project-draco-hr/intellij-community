{
  if (finalChoice && !(action.getAction() instanceof AbstractEmptyIntentionAction)) {
    applyAction(action);
    return FINAL_CHOICE;
  }
  if (hasSubstep(action)) {
    return getSubStep(action,action.getToolName());
  }
  return FINAL_CHOICE;
}
