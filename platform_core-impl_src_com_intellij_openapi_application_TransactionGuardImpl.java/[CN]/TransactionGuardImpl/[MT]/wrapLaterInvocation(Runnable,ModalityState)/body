{
  if (isWriteSafeModality(modalityState)) {
    return new Runnable(){
      @Override public void run(){
        ApplicationManager.getApplication().assertIsDispatchThread();
        final boolean prev=myWritingAllowed;
        String prevTrace=myWritingAllowedTrace;
        setWritingAllowed(true);
        try {
          runnable.run();
        }
  finally {
          myWritingAllowed=prev;
          myWritingAllowedTrace=prevTrace;
        }
      }
    }
;
  }
  return runnable;
}
