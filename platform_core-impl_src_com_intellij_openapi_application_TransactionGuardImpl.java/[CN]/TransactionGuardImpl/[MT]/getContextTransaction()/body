{
  if (!ApplicationManager.getApplication().isDispatchThread()) {
    ProgressIndicator indicator=ProgressIndicatorProvider.getGlobalProgressIndicator();
    return indicator != null ? myModalities.get(indicator.getModalityState()) : null;
  }
  return myWritingAllowed ? myCurrentTransaction : null;
}
