{
  if (!isInsideTransaction()) {
    throw new IllegalStateException("acceptNestedTransactions must be called inside a transaction");
  }
  final List<TransactionKind> toRemove=ContainerUtil.newArrayList();
  for (  TransactionKind kind : kinds) {
    if (myMergeableKinds.add(kind)) {
      toRemove.add(kind);
    }
  }
  return new AccessToken(){
    @Override public void finish(){
      myMergeableKinds.removeAll(toRemove);
    }
  }
;
}
