{
  final TransactionIdImpl prevTransaction=myCurrentTransaction;
  final Object prevUnsafeModality=myUnsafeModality;
  final boolean wasWritingAllowed=myWritingAllowed;
  myWritingAllowed=true;
  myCurrentTransaction=new TransactionIdImpl();
  myUnsafeModality=null;
  return new AccessToken(){
    @Override public void finish(){
      Queue<Transaction> queue=getQueue(prevTransaction);
      queue.addAll(myCurrentTransaction.myQueue);
      myCurrentTransaction.myQueue=queue;
      if (!queue.isEmpty()) {
        pollQueueLater();
      }
      myWritingAllowed=wasWritingAllowed;
      myCurrentTransaction=prevTransaction;
      myUnsafeModality=prevUnsafeModality;
    }
  }
;
}
