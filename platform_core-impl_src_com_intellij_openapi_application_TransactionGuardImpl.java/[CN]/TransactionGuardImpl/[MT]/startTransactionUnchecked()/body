{
  ApplicationManager.getApplication().assertIsDispatchThread();
  final boolean wasWritingAllowed=myWritingAllowed;
  myWritingAllowed=true;
  myCurrentTransaction=new TransactionIdImpl(myCurrentTransaction);
  return new AccessToken(){
    @Override public void finish(){
      Queue<Transaction> queue=getQueue(myCurrentTransaction.myParent);
      queue.addAll(myCurrentTransaction.myQueue);
      if (!queue.isEmpty()) {
        pollQueueLater();
      }
      myWritingAllowed=wasWritingAllowed;
      myCurrentTransaction.myFinished=true;
      myCurrentTransaction=myCurrentTransaction.myParent;
    }
  }
;
}
