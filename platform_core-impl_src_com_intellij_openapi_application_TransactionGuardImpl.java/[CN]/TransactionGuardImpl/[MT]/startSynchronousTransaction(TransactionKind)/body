{
  ApplicationManager.getApplication().assertIsDispatchThread();
  if (kind != null && myMergeableKinds.contains(kind)) {
    return AccessToken.EMPTY_ACCESS_TOKEN;
  }
  if (myInsideTransaction) {
    throw new IllegalStateException("Nested transactions are not allowed");
  }
  myInsideTransaction=true;
  return new AccessToken(){
    @Override public void finish(){
      myInsideTransaction=false;
      if (!myQueue.isEmpty()) {
        pollQueueLater();
      }
    }
  }
;
}
