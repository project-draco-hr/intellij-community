{
  try {
    IdeaTestRunner testRunner=(IdeaTestRunner)getAgentClass(agentName).newInstance();
    if (ourCommandFileName != null) {
      if (!"none".equals(ourForkMode) || ourWorkingDirs != null && new File(ourWorkingDirs).length() > 0) {
        final List newArgs=new ArrayList();
        newArgs.add(agentName);
        newArgs.addAll(listeners);
        PrintStream printOutputStream=System.out;
        PrintStream printErrStream=System.err;
        return new JUnitForkedSplitter(ourWorkingDirs,ourForkMode,printOutputStream,printErrStream,newArgs).startSplitting(args,name,ourCommandFileName,ourRepeatCount);
      }
    }
    return testRunner.startRunnerWithArgs(args,listeners,name,ourCount,true);
  }
 catch (  Exception e) {
    e.printStackTrace(System.err);
    return -2;
  }
}
