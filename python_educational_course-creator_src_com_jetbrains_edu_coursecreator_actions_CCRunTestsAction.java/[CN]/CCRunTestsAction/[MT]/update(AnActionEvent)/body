{
  Presentation presentation=e.getPresentation();
  presentation.setText("");
  presentation.setVisible(false);
  presentation.setEnabled(false);
  final ConfigurationContext context=ConfigurationContext.getFromContext(e.getDataContext());
  Location location=context.getLocation();
  if (location == null) {
    return;
  }
  PsiElement psiElement=location.getPsiElement();
  PsiFile psiFile=psiElement.getContainingFile();
  Project project=e.getProject();
  if (project == null || psiFile == null) {
    presentation.setVisible(false);
    presentation.setEnabled(false);
    return;
  }
  final CCProjectService service=CCProjectService.getInstance(project);
  final Course course=service.getCourse();
  final PsiDirectory taskDir=psiFile.getContainingDirectory();
  final PsiDirectory lessonDir=taskDir.getParent();
  if (lessonDir == null)   return;
  if (course == null)   return;
  final Lesson lesson=service.getLesson(lessonDir.getName());
  if (lesson == null)   return;
  final Task task=service.getTask(taskDir.getVirtualFile().getPath());
  if (task == null) {
    presentation.setVisible(false);
    presentation.setEnabled(false);
    return;
  }
  TaskFile taskFile=service.getTaskFile(psiFile.getVirtualFile());
  if (taskFile == null) {
    LOG.info("could not find task file");
    presentation.setVisible(false);
    presentation.setEnabled(false);
    return;
  }
  if (psiFile.getName().contains(".answer")) {
    presentation.setEnabled(true);
    presentation.setVisible(true);
    presentation.setText("Run tests from '" + psiFile.getName() + "'");
  }
 else {
    presentation.setEnabled(false);
    presentation.setVisible(false);
  }
}
