{
  Cursor currentCursor=getCursor();
  try {
    setCursor(new Cursor(Cursor.WAIT_CURSOR));
    final JPanel editorPanel=new JPanel();
    editorPanel.setLayout(new BorderLayout());
    final int problemCount=myTree.getSelectedProblemCount();
    JComponent previewPanel=null;
    final InspectionToolWrapper tool=myTree.getSelectedToolWrapper();
    if (tool != null && refEntity != null && problemCount == 1) {
      final InspectionToolPresentation presentation=myGlobalInspectionContext.getPresentation(tool);
      previewPanel=presentation.getCustomPreviewPanel(refEntity);
    }
    EditorEx previewEditor=null;
    if (previewPanel == null) {
      final Pair<JComponent,EditorEx> panelAndEditor=createBaseRightComponentFor(problemCount,refEntity);
      previewPanel=panelAndEditor.getFirst();
      previewEditor=panelAndEditor.getSecond();
    }
    editorPanel.add(previewPanel,BorderLayout.CENTER);
    if (problemCount > 0) {
      final QuickFixPreviewDecorator fixToolbar=new QuickFixPreviewDecorator(previewEditor,this);
      myLoadingProgressPreview=fixToolbar;
      editorPanel.add(fixToolbar,BorderLayout.NORTH);
    }
    mySplitter.setSecondComponent(editorPanel);
  }
  finally {
    setCursor(currentCursor);
  }
}
