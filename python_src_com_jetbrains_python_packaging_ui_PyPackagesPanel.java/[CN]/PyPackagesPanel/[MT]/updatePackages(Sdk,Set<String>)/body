{
  myPackagesTable.setPaintBusy(true);
  final Application application=ApplicationManager.getApplication();
  application.executeOnPooledThread(new Runnable(){
    @Override public void run(){
      List<PyPackage> packages=Lists.newArrayList();
      if (selectedSdk != null) {
        try {
          packages=((PyPackageManagerImpl)PyPackageManager.getInstance(selectedSdk)).getPackages();
        }
 catch (        PyExternalProcessException e) {
        }
 finally {
          final List<PyPackage> finalPackages=packages;
          final Map<String,String> cache=PyPIPackageUtil.getPyPIPackages();
          if (cache.isEmpty()) {
            updateCache(application);
          }
          application.invokeLater(new Runnable(){
            @Override public void run(){
              if (selectedSdk == mySelectedSdk) {
                myPackagesTableModel.getDataVector().clear();
                for (                PyPackage pyPackage : finalPackages) {
                  if (installed != null) {
                    installed.add(pyPackage.getName());
                  }
                  final String version=cache.get(pyPackage.getName());
                  myPackagesTableModel.addRow(new Object[]{pyPackage,pyPackage.getVersion(),version == null ? "" : version});
                }
                if (!cache.isEmpty())                 myPackagesTable.setPaintBusy(false);
              }
            }
          }
,ModalityState.any());
        }
      }
    }
  }
);
}
