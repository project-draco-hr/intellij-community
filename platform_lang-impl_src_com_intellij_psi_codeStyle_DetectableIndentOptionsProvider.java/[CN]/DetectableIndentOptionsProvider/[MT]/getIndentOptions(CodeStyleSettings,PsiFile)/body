{
  if (!isEnabled(settings,file)) {
    return null;
  }
  Project project=file.getProject();
  PsiDocumentManager psiManager=PsiDocumentManager.getInstance(project);
  Document document=psiManager.getDocument(file);
  if (document == null) {
    return null;
  }
  IndentOptions options=getValidCachedIndentOptions(file,document);
  if (options != null) {
    return options;
  }
  TimeStampedIndentOptions indentOptions=getDefault(file.getFileType(),project,document.getModificationStamp());
  indentOptions.associateWithDocument(document);
  DetectAndAdjustIndentOptionsTask task=new DetectAndAdjustIndentOptionsTask(project,document,indentOptions,BOUNDED_EXECUTOR);
  task.scheduleInBackgroundForCommittedDocument();
  return indentOptions;
}
