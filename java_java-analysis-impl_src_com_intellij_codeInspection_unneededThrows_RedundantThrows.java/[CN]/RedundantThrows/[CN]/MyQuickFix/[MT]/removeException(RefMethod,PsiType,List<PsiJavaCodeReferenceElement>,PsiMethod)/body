{
  PsiManager psiManager=psiMethod.getManager();
  PsiJavaCodeReferenceElement[] refs=psiMethod.getThrowsList().getReferenceElements();
  for (  PsiJavaCodeReferenceElement ref : refs) {
    PsiType refType=JavaPsiFacade.getInstance(psiManager.getProject()).getElementFactory().createType(ref);
    if (exceptionType.isAssignableFrom(refType)) {
      refsToDelete.add(ref);
    }
  }
  if (refMethod != null) {
    for (    RefMethod refDerived : refMethod.getDerivedMethods()) {
      removeException(refDerived,exceptionType,refsToDelete,(PsiMethod)refDerived.getElement());
    }
  }
 else {
    final Query<Couple<PsiMethod>> query=AllOverridingMethodsSearch.search(psiMethod.getContainingClass());
    query.forEach(new Processor<Couple<PsiMethod>>(){
      @Override public boolean process(      final Couple<PsiMethod> pair){
        if (pair.first == psiMethod) {
          removeException(null,exceptionType,refsToDelete,pair.second);
        }
        return true;
      }
    }
);
  }
}
