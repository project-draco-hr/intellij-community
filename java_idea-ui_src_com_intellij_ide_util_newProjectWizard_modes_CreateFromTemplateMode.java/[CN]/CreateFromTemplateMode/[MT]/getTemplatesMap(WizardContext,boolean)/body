{
  ProjectTemplatesFactory[] factories=ProjectTemplatesFactory.EP_NAME.getExtensions();
  final MultiMap<TemplatesGroup,ProjectTemplate> groups=new MultiMap<TemplatesGroup,ProjectTemplate>();
  for (  ProjectTemplatesFactory factory : factories) {
    if (!includeArchived && (factory instanceof ArchivedTemplatesFactory))     continue;
    for (    String group : factory.getGroups()) {
      ProjectTemplate[] templates=factory.createTemplates(group,context);
      List<ProjectTemplate> values=Arrays.asList(templates);
      if (!values.isEmpty()) {
        Icon icon=factory.getGroupIcon(group);
        TemplatesGroup templatesGroup=new TemplatesGroup(group,null,icon,factory.getGroupWeight(group),null,group);
        groups.putValues(templatesGroup,values);
      }
    }
  }
  return groups;
}
