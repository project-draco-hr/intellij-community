{
  final Project project=getEventProject(e);
  if (project == null)   return;
  ProcessInfo[] processList=OSProcessUtil.getProcessList();
  XLocalAttachDebuggerProvider[] providers=Extensions.getExtensions(XLocalAttachDebuggerProvider.EP);
  ProcessListStep step=new ProcessListStep(collectAttachItems(project,processList,providers),project);
  final ListPopup popup=JBPopupFactory.getInstance().createListPopup(step);
  final JList mainList=((ListPopupImpl)popup).getList();
  ListSelectionListener listener=new ListSelectionListener(){
    @Override public void valueChanged(    ListSelectionEvent event){
      if (event.getValueIsAdjusting())       return;
      Object item=((JList)event.getSource()).getSelectedValue();
      if (item == null) {
        item=mainList.getSelectedValue();
      }
      if (item instanceof AttachItem) {
        String debuggerName=((AttachItem)item).getSelectedDebugger().getDebuggerDisplayName();
        debuggerName=StringUtil.shortenTextWithEllipsis(debuggerName,50,0);
        ((ListPopupImpl)popup).setCaption(XDebuggerBundle.message("xdebugger.attach.toLocal.popup.adText",debuggerName));
      }
    }
  }
;
  popup.addListSelectionListener(listener);
  listener.valueChanged(new ListSelectionEvent(mainList,mainList.getMinSelectionIndex(),mainList.getMaxSelectionIndex(),false));
  popup.showCenteredInCurrentWindow(project);
}
