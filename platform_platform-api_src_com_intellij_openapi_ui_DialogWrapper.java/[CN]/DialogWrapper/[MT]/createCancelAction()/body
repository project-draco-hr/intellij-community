{
  return new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      MenuSelectionManager menuSelectionManager=MenuSelectionManager.defaultManager();
      MenuElement[] selectedPath=menuSelectionManager.getSelectedPath();
      if (selectedPath.length > 0) {
        menuSelectionManager.clearSelectedPath();
      }
 else {
        if (ApplicationManager.getApplication() == null) {
          doCancelAction(e);
          return;
        }
        final StackingPopupDispatcher popupDispatcher=StackingPopupDispatcher.getInstance();
        if (popupDispatcher != null && !popupDispatcher.isPopupFocused()) {
          Component focusOwner=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();
          JTree tree=UIUtil.getParentOfType(JTree.class,focusOwner);
          JTable table=UIUtil.getParentOfType(JTable.class,focusOwner);
          if (tree != null && tree.isEditing()) {
            tree.cancelEditing();
            return;
          }
          if (table != null && table.isEditing()) {
            TableUtil.stopEditing(table);
            return;
          }
          doCancelAction(e);
        }
      }
    }
  }
;
}
