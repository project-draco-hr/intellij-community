{
  final ExecutionEnvironment action=findRestartAction(descriptor);
  if (action == null) {
    return null;
  }
  final Ref<RunProfileState> stateRef=new Ref<RunProfileState>();
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      try {
        stateRef.set(action.getState());
      }
 catch (      final ExecutionException e) {
        throw new IllegalStateException("Error obtaining execution state",e);
      }
    }
  }
,ModalityState.NON_MODAL);
  return stateRef.get();
}
