{
  new WriteCommandAction.Simple(null){
    @Override protected void run() throws Throwable {
      LightPlatformTestCase.closeAndDeleteProject();
    }
  }
.execute().throwException();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      ((ApplicationImpl)ApplicationManager.getApplication()).setDisposeInProgress(true);
      LightPlatformTestCase.disposeApplication();
      UIUtil.dispatchAllInvocationEvents();
    }
  }
);
  try {
    LeakHunter.checkProjectLeak();
    Disposer.assertIsEmpty(true);
  }
 catch (  Exception e) {
    captureMemorySnapshot();
    throw e;
  }
}
