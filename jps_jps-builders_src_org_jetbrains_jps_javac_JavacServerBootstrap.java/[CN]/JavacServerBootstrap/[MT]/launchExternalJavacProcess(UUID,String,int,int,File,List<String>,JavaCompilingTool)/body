{
  final List<String> cmdLine=new ArrayList<String>();
  appendParam(cmdLine,getVMExecutablePath(sdkHomePath));
  appendParam(cmdLine,"-Djava.awt.headless=true");
  final int xms=heapSize / 2;
  if (xms > 32) {
    appendParam(cmdLine,"-Xms" + xms + "m");
  }
  appendParam(cmdLine,"-Xmx" + heapSize + "m");
  final String encoding=System.getProperty("file.encoding");
  if (encoding != null) {
    appendParam(cmdLine,"-Dfile.encoding=" + encoding);
  }
  final String lang=System.getProperty("user.language");
  if (lang != null) {
    appendParam(cmdLine,"-Duser.language=" + lang);
  }
  final String country=System.getProperty("user.country");
  if (country != null) {
    appendParam(cmdLine,"-Duser.country=" + country);
  }
  final String region=System.getProperty("user.region");
  if (region != null) {
    appendParam(cmdLine,"-Duser.region=" + region);
  }
  appendParam(cmdLine,"-D" + ExternalJavacProcess.JPS_JAVA_COMPILING_TOOL_PROPERTY + "="+ compilingTool.getId());
  appendParam(cmdLine,"-Djava.ext.dirs=");
  appendParam(cmdLine,"-Dlog4j.defaultInitOverride=true");
  for (  String option : vmOptions) {
    appendParam(cmdLine,option);
  }
  appendParam(cmdLine,"-classpath");
  final List<File> cp=ClasspathBootstrap.getExternalJavacProcessClasspath(sdkHomePath,compilingTool);
  final StringBuilder classpath=new StringBuilder();
  for (  File file : cp) {
    if (classpath.length() > 0) {
      classpath.append(File.pathSeparator);
    }
    classpath.append(file.getPath());
  }
  appendParam(cmdLine,classpath.toString());
  appendParam(cmdLine,org.jetbrains.jps.javac.ExternalJavacProcess.class.getName());
  appendParam(cmdLine,uuid.toString());
  appendParam(cmdLine,"127.0.0.1");
  appendParam(cmdLine,Integer.toString(port));
  workingDir.mkdirs();
  appendParam(cmdLine,FileUtil.toSystemIndependentName(workingDir.getPath()));
  final ProcessBuilder builder=new ProcessBuilder(cmdLine);
  builder.directory(workingDir);
  final Process process=builder.start();
  final ExternalJavacProcessHandler processHandler=new ExternalJavacProcessHandler(process);
  processHandler.addProcessListener(new ProcessAdapter(){
    @Override public void processTerminated(    ProcessEvent event){
      processHandler.setExitCode(event.getExitCode());
    }
    public void onTextAvailable(    ProcessEvent event,    Key outputType){
      final String text=event.getText();
      if (!StringUtil.isEmptyOrSpaces(text)) {
        if (outputType == ProcessOutputTypes.STDOUT) {
          System.out.print("JAVAC_PROCESS: " + text);
        }
 else         if (outputType == ProcessOutputTypes.STDERR) {
          System.err.print("JAVAC_PROCESS: " + text);
        }
      }
    }
  }
);
  processHandler.startNotify();
  return processHandler;
}
