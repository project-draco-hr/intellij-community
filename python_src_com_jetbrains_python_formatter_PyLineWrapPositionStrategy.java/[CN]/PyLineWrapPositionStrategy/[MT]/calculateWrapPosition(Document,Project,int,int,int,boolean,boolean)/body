{
  int wrapPosition=super.calculateWrapPosition(document,project,startOffset,endOffset,maxPreferredOffset,allowToBeyondMaxPreferredOffset,virtual);
  if (wrapPosition < 0)   return wrapPosition;
  final CharSequence text=document.getCharsSequence();
  if (wrapPosition > 0) {
    char charBefore=text.charAt(wrapPosition - 1);
    if (charBefore == '\'' || charBefore == '"') {
      return wrapPosition + 1;
    }
  }
  char c=text.charAt(wrapPosition);
  if (!StringUtil.isWhiteSpace(c) || project == null) {
    return wrapPosition;
  }
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
  if (documentManager != null) {
    final PsiFile psiFile=documentManager.getPsiFile(document);
    if (psiFile != null) {
      final PsiElement element=psiFile.findElementAt(wrapPosition);
      final StringLiteralExpression string=PsiTreeUtil.getParentOfType(element,StringLiteralExpression.class);
      if (string != null) {
        return wrapPosition + 1;
      }
    }
  }
  return wrapPosition;
}
