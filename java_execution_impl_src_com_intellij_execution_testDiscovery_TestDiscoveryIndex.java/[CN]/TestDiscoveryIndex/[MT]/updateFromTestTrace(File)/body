{
synchronized (ourLock) {
    int fileNameDotIndex=file.getName().lastIndexOf('.');
    final String testName=fileNameDotIndex != -1 ? file.getName().substring(0,fileNameDotIndex) : file.getName();
    Holder holder=getHolder();
    if (holder.myDisposed)     return;
    Map<String,List<String>> classData=loadClassAndMethodsMap(file);
    Map<String,List<String>> previousClassData=holder.myTestNameToUsedClassesAndMethodMap.get(testName);
    ValueDiff valueDiff=new ValueDiff(classData,previousClassData);
    if (valueDiff.myRemovedClassData != null && !valueDiff.myRemovedClassData.isEmpty()) {
      for (      String classQName : valueDiff.myRemovedClassData.keySet()) {
        for (        String methodName : valueDiff.myRemovedClassData.get(classQName)) {
          holder.myMethodQNameToTestNames.appendData(createKey(classQName,methodName),new PersistentHashMap.ValueDataAppender(){
            @Override public void append(            DataOutput dataOutput) throws IOException {
              IOUtil.writeUTF(dataOutput,REMOVED_MARKER);
              IOUtil.writeUTF(dataOutput,testName);
            }
          }
);
        }
      }
    }
    if (valueDiff.myAddedOrChangedClassData != null && !valueDiff.myAddedOrChangedClassData.isEmpty()) {
      for (      String classQName : valueDiff.myAddedOrChangedClassData.keySet()) {
        for (        String methodName : valueDiff.myAddedOrChangedClassData.get(classQName)) {
          holder.myMethodQNameToTestNames.appendData(createKey(classQName,methodName),new PersistentHashMap.ValueDataAppender(){
            @Override public void append(            DataOutput dataOutput) throws IOException {
              IOUtil.writeUTF(dataOutput,testName);
            }
          }
);
        }
      }
    }
    if (valueDiff.myAddedOrChangedClassData != null && !valueDiff.myAddedOrChangedClassData.isEmpty() || valueDiff.myRemovedClassData != null && !valueDiff.myRemovedClassData.isEmpty()) {
      holder.myTestNameToUsedClassesAndMethodMap.put(testName,classData);
    }
  }
}
