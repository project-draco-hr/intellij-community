{
  try {
    if (!((DocumentEx)event.getDocument()).isInBulkUpdate()) {
      updateCachedOffsets();
    }
    if (ApplicationManager.getApplication().hasWriteAction(ExternalChangeAction.class))     myDocumentHasBeenChangedExternally=true;
  }
  finally {
    myDocumentChangeProcessed=true;
  }
}
