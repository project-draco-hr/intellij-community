{
  if (!myEnabled) {
    throw new IllegalStateException("DocumentCommitThread is disabled");
  }
  int attempts=0;
  int delay=100;
synchronized (documentsToCommit) {
    while (!documentsToCommit.isEmpty() || currentTask != null) {
      documentsToCommit.wait(delay);
      if (delay * attempts > timeout) {
        throw new RuntimeException("timeout");
      }
      attempts++;
    }
  }
}
