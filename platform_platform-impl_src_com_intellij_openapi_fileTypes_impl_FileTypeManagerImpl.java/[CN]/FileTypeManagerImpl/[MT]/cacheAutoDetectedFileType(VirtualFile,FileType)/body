{
  DataOutputStream stream=autoDetectedAttribute.writeAttribute(file);
  boolean wasAutodetectedAsText=fileType == FileTypes.PLAIN_TEXT;
  boolean wasAutodetectedAsBinary=fileType == FileTypes.UNKNOWN;
  try {
    try {
      byte b=(byte)((wasAutodetectedAsText ? AUTO_DETECTED_AS_TEXT_FLAG : 0) | (wasAutodetectedAsBinary ? AUTO_DETECTED_AS_BINARY_FLAG : 0));
      stream.writeByte(b);
    }
  finally {
      stream.close();
    }
  }
 catch (  IOException e) {
    LOG.error(e);
  }
  if (file instanceof VirtualFileWithId) {
    int id=Math.abs(((VirtualFileWithId)file).getId());
    autoDetectWasRun.set(id);
    autoDetectedAsText.set(id,wasAutodetectedAsText);
    autoDetectedAsBinary.set(id,wasAutodetectedAsBinary);
    if (wasAutodetectedAsText || wasAutodetectedAsBinary) {
      file.putUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY,null);
      return;
    }
  }
  file.putUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY,fileType);
}
