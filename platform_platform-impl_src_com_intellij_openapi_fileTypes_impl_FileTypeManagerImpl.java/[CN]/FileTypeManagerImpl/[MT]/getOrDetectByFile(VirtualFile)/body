{
  FileType fileType=file.getUserData(FILE_TYPE_KEY);
  if (fileType != null) {
    return fileType;
  }
  if (file instanceof LightVirtualFile) {
    fileType=((LightVirtualFile)file).getAssignedFileType();
    if (fileType != null) {
      return fileType;
    }
  }
  for (  FileTypeIdentifiableByVirtualFile type : mySpecialFileTypes) {
    if (type.isMyFileType(file)) {
      if (toLog()) {
        log("F: getOrDetectByFile(" + file.getName() + "): Special file type: "+ type.getName());
      }
      return type;
    }
  }
  fileType=getFileTypeByFileName(file.getNameSequence());
  if (fileType == UnknownFileType.INSTANCE) {
    fileType=null;
  }
  if (toLog()) {
    log("F: getOrDetectByFile(" + file.getName() + ") By name file type: "+ (fileType == null ? null : fileType.getName()));
  }
  return fileType;
}
