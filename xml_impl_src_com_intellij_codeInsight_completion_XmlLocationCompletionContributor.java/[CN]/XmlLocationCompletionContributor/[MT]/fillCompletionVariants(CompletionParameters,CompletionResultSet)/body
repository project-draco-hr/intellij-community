{
  PsiReference reference=parameters.getPosition().getContainingFile().findReferenceAt(parameters.getOffset());
  if (reference instanceof URLReference) {
    if (((URLReference)reference).isSchemaLocation()) {
      Object[] objects=completeSchemaLocation(reference.getElement());
      result.addAllElements(ContainerUtil.map(objects,MAPPING));
      return;
    }
    Object[] objects=completeNamespace(reference.getElement());
    result.addAllElements(ContainerUtil.map(objects,MAPPING));
    return;
  }
  if (reference instanceof PsiMultiReference)   reference=((PsiMultiReference)reference).getReferences()[0];
  if (reference instanceof DependentNSReference) {
    MultiMap<String,String> map=ExternalResourceManagerEx.getInstanceEx().getUrlsByNamespace(parameters.getOriginalFile().getProject());
    String namespace=((DependentNSReference)reference).getNamespaceReference().getCanonicalText();
    Collection<String> strings=map.get(namespace);
    for (    String string : strings) {
      if (!namespace.equals(string)) {
        result.consume(PrioritizedLookupElement.withPriority(LookupElementBuilder.create(string),100));
      }
    }
    if (!strings.isEmpty())     result.stopHere();
  }
}
