{
  if (numberOfResults == 0)   return;
  MatchResultImpl substitution=context.getResult().findSon(name);
  if (substitution != null) {
    final LinkedList<PsiElement> matchedNodes=context.getMatchedNodes();
    if (substitution.hasSons()) {
      final LinkedList<MatchResult> sons=(LinkedList<MatchResult>)substitution.getMatches();
      while (numberOfResults > 0) {
        --numberOfResults;
        final MatchResult matchResult=sons.removeLast();
        if (matchedNodes != null)         matchedNodes.remove(matchResult.getMatch());
      }
      if (sons.size() == 0) {
        context.getResult().removeSon(name);
      }
    }
 else {
      final MatchResultImpl matchResult=context.getResult().removeSon(name);
      if (matchedNodes != null)       matchedNodes.remove(matchResult.getMatch());
    }
  }
}
