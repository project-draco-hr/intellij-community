{
  Collection<String> notReloadableComponents;
  boolean willBeReloaded=false;
  try {
    AccessToken token=WriteAction.start();
    try {
      notReloadableComponents=store.reload(causes);
    }
 catch (    Throwable e) {
      Messages.showWarningDialog(ProjectBundle.message("project.reload.failed",e.getMessage()),ProjectBundle.message("project.reload.failed.title"));
      return ReloadComponentStoreStatus.ERROR;
    }
 finally {
      token.finish();
    }
    if (ContainerUtil.isEmpty(notReloadableComponents)) {
      return ReloadComponentStoreStatus.SUCCESS;
    }
    willBeReloaded=askToRestart(store,notReloadableComponents,causes);
    return willBeReloaded ? ReloadComponentStoreStatus.RESTART_AGREED : ReloadComponentStoreStatus.RESTART_CANCELLED;
  }
  finally {
    if (!willBeReloaded) {
      for (      Pair<VirtualFile,StateStorage> cause : causes) {
        if (cause.second instanceof XmlElementStorage) {
          ((XmlElementStorage)cause.second).enableSaving();
        }
      }
    }
  }
}
