{
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          if (myRequirementsTxt != null) {
            if (myRequirementsTxt.isWritable()) {
              myRequirementsTxt.insertString(0,myPackageName + "\n");
            }
          }
 else {
            final PyElementGenerator generator=PyElementGenerator.getInstance(project);
            if (mySetupPyRequires != null) {
              if (mySetupPyRequires.getContainingFile().isWritable()) {
                final PyStringLiteralExpression literal=generator.createStringLiteralFromString(myPackageName);
                mySetupPyRequires.add(literal);
              }
            }
 else             if (mySetupArgumentList != null) {
              final PyKeywordArgument requiresArg=generateRequiresKwarg(generator);
              if (requiresArg != null) {
                mySetupArgumentList.addArgument(requiresArg);
              }
            }
          }
        }
        @Nullable private PyKeywordArgument generateRequiresKwarg(        PyElementGenerator generator){
          final String text=String.format("foo(requires=[\"%s\"])",myPackageName);
          final PyExpression generated=generator.createExpressionFromText(myLanguageLevel,text);
          PyKeywordArgument installRequiresArg=null;
          if (generated instanceof PyCallExpression) {
            final PyCallExpression foo=(PyCallExpression)generated;
            for (            PyExpression arg : foo.getArguments()) {
              if (arg instanceof PyKeywordArgument) {
                final PyKeywordArgument kwarg=(PyKeywordArgument)arg;
                if ("requires".equals(kwarg.getKeyword())) {
                  installRequiresArg=kwarg;
                }
              }
            }
          }
          return installRequiresArg;
        }
      }
);
    }
  }
,getName(),null);
}
