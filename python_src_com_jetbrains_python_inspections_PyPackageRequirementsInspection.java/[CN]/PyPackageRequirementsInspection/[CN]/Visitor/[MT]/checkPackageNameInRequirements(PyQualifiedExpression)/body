{
  final List<PyExpression> expressions=PyResolveUtil.unwindQualifiers(importedExpression);
  if (!expressions.isEmpty()) {
    final PyExpression packageReferenceExpression=expressions.get(0);
    final String packageName=packageReferenceExpression.getName();
    if (packageName != null && !myIgnoredPackages.contains(packageName)) {
      final Collection<String> stdlibPackages=PyStdlibUtil.getPackages();
      if (stdlibPackages != null) {
        for (        String name : stdlibPackages) {
          if (packageName.equals(name)) {
            return;
          }
        }
      }
      final Module module=ModuleUtil.findModuleForPsiElement(packageReferenceExpression);
      if (module != null) {
        final List<PyRequirement> requirements=PyPackageManager.getRequirements(module);
        if (requirements != null) {
          for (          PyRequirement req : requirements) {
            if (packageName.equalsIgnoreCase(req.getName())) {
              return;
            }
          }
          final PsiReference reference=packageReferenceExpression.getReference();
          if (reference != null) {
            final PsiElement element=reference.resolve();
            if (element != null) {
              final PsiFile file=element.getContainingFile();
              final VirtualFile virtualFile=file.getVirtualFile();
              if (ModuleUtil.moduleContainsFile(module,virtualFile,false)) {
                return;
              }
            }
          }
          registerProblem(packageReferenceExpression,String.format("Package '%s' is not listed in project requirements",packageName),ProblemHighlightType.WEAK_WARNING,null,new AddToRequirementsFix(module,packageName,LanguageLevel.forElement(importedExpression)),new IgnoreRequirementFix(Collections.singleton(packageName)));
        }
      }
    }
  }
}
