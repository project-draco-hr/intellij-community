{
  final PsiElement realContext=PyPsiUtils.getRealContext(element);
  final ScopeOwner originalOwner;
  if (realContext != element && realContext instanceof PyFile) {
    originalOwner=(PyFile)realContext;
  }
 else {
    originalOwner=ScopeUtil.getScopeOwner(realContext);
  }
  final PsiElement parent=element.getParent();
  final boolean isGlobalOrNonlocal=parent instanceof PyGlobalStatement || parent instanceof PyNonlocalStatement;
  ScopeOwner owner=originalOwner;
  if (isGlobalOrNonlocal) {
    final ScopeOwner outerScopeOwner=ScopeUtil.getScopeOwner(owner);
    if (outerScopeOwner != null) {
      owner=outerScopeOwner;
    }
  }
  scopeCrawlUp(processor,owner,originalOwner,name,roof,realContext);
}
