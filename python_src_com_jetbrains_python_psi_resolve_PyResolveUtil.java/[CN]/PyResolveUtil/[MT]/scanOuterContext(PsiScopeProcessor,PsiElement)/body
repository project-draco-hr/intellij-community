{
  PsiElement ret=null;
  PsiElement our_cap=PsiTreeUtil.getParentOfType(start,Callable.class);
  if (our_cap != null) {
    PyFunction innerFunction=PsiTreeUtil.getParentOfType(our_cap,PyFunction.class);
    PsiElement cap=our_cap;
    while (true) {
      cap=PsiTreeUtil.getParentOfType(cap,PyFunction.class);
      if (cap == null)       cap=start.getContainingFile();
      ret=treeCrawlUp(processor,true,cap);
      if ((ret != null) && !PsiTreeUtil.isAncestor(our_cap,ret,true)) {
        if (!refersFromMethodToClass(innerFunction,ret)) {
          break;
        }
      }
      if (cap instanceof PsiFile)       break;
    }
  }
  return ret;
}
