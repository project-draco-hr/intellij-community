{
  while (scopeOwner != null) {
    if (!(scopeOwner instanceof PyClass) || scopeOwner == originalScopeOwner) {
      final Scope scope=ControlFlowCache.getScope(scopeOwner);
      if (name != null) {
        final boolean includeNestedGlobals=scopeOwner instanceof PyFile;
        for (        PsiNamedElement resolved : scope.getNamedElements(name,includeNestedGlobals)) {
          if (!processor.execute(resolved,ResolveState.initial())) {
            return;
          }
        }
      }
 else {
        for (        PsiNamedElement element : scope.getNamedElements()) {
          if (!processor.execute(element,ResolveState.initial())) {
            return;
          }
        }
      }
      for (      PyImportedNameDefiner definer : scope.getImportedNameDefiners()) {
        if (!processor.execute(definer,ResolveState.initial())) {
          return;
        }
      }
    }
    if (scopeOwner == roof) {
      return;
    }
    scopeOwner=ScopeUtil.getScopeOwner(scopeOwner);
  }
}
