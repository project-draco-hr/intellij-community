{
  while (scopeOwner != null) {
    if (!(scopeOwner instanceof PyClass) || scopeOwner == originalScopeOwner) {
      final Scope scope=ControlFlowCache.getScope(scopeOwner);
      boolean found=false;
      if (name != null) {
        final PsiElement resolved=scope.getNamedElement(name);
        if (resolved != null) {
          if (!processor.execute(resolved,ResolveState.initial())) {
            found=true;
          }
        }
      }
 else {
        for (        PsiNamedElement element : scope.getNamedElements()) {
          if (!processor.execute(element,ResolveState.initial())) {
            found=true;
            break;
          }
        }
      }
      for (      NameDefiner definer : scope.getNameDefiners()) {
        if (!processor.execute(definer,ResolveState.initial())) {
          found=true;
          break;
        }
      }
      if (found) {
        return;
      }
    }
    if (scopeOwner == roof) {
      return;
    }
    scopeOwner=ScopeUtil.getScopeOwner(scopeOwner);
  }
}
