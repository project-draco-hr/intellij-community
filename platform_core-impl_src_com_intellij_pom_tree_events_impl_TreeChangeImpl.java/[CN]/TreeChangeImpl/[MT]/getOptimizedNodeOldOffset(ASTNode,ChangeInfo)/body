{
  if (!ourEnableOptimizedNodeOldOffset)   return haveNotCalculated;
  ASTNode prevSibling=child.getTreePrev();
  if (prevSibling != null) {
    if (mySortedChanges.size() > 0) {
      Pair<ASTNode,Integer> pair=mySortedChanges.get(mySortedChanges.size() - 1);
      if (pair.getFirst() == prevSibling) {
        ChangeInfo prevSiblingChange=myChanges.get(prevSibling);
        if ((prevSiblingChange.getChangeType() == ChangeInfo.REMOVED && changeInfo.getChangeType() == ChangeInfo.REMOVED) || (prevSiblingChange.getChangeType() == ChangeInfo.ADD && changeInfo.getChangeType() == ChangeInfo.ADD)) {
          int optimizedResult=pair.getSecond() + prevSiblingChange.getOldLength();
          if (ourDoChecks) {
            int oldOffset=calculateOldOffsetLinearly(child);
            if (optimizedResult != oldOffset) {
              LOG.error("Failed optimized node old offset check:" + changeInfo + ", previous:"+ prevSibling+ ","+ prevSiblingChange);
              ourEnableOptimizedNodeOldOffset=false;
              optimizedResult=oldOffset;
            }
          }
          return optimizedResult;
        }
      }
    }
  }
  return haveNotCalculated;
}
