{
  int length=0;
  PsiFileSystemItem parent=file;
  while (true) {
    if (parent == null)     return null;
    if (parent.equals(ancestor))     break;
    if (length > 0) {
      length++;
    }
    String name=parent.getName();
    if (name == null) {
      throw new AssertionError("Null name for " + parent + " of "+ parent.getClass());
    }
    length+=name.length();
    parent=parent.getParent();
  }
  char[] chars=new char[length];
  int index=chars.length;
  parent=file;
  while (true) {
    if (parent.equals(ancestor))     break;
    if (index < length) {
      chars[--index]='/';
    }
    String name=parent.getName();
    for (int i=name.length() - 1; i >= 0; i--) {
      chars[--index]=name.charAt(i);
    }
    parent=parent.getParent();
  }
  return StringFactory.createShared(chars);
}
