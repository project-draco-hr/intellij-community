{
  GraphicsConfig config=GraphicsUtil.setupAAPainting(g);
  try {
    Color bg=background == null ? JBColor.background() : background;
    if (UIUtil.isUnderAquaLookAndFeel()) {
      if (state == ActionButtonComponent.PUSHED) {
        ((Graphics2D)g).setPaint(UIUtil.getGradientPaint(0,0,ALPHA_40,size.width,size.height,ALPHA_20));
        ((Graphics2D)g).fill(getShape(size));
        g.setColor(ALPHA_30);
        ((Graphics2D)g).draw(getShape(size));
      }
 else       if (state == ActionButtonComponent.POPPED) {
        ((Graphics2D)g).setPaint(UIUtil.getGradientPaint(0,0,bg,0,size.height,ColorUtil.darker(bg,2)));
        ((Graphics2D)g).fill(getShape(size));
      }
    }
 else {
      final boolean dark=UIUtil.isUnderDarcula();
      g.setColor(state == ActionButtonComponent.PUSHED ? ColorUtil.shift(bg,dark ? 1d / 0.7d : 0.7d) : dark ? Gray._255.withAlpha(40) : ALPHA_40);
      ((Graphics2D)g).fill(getShape(size));
    }
  }
  finally {
    config.restore();
  }
}
