{
  if (element == null)   return Collections.emptyList();
  StubElement<?> stub=element instanceof StubBasedPsiElement ? ((StubBasedPsiElement)element).getStub() : null;
  if (stub == null) {
    return getChildrenOfTypeAsList(element,aClass);
  }
  List<T> result=new SmartList<T>();
  for (  StubElement childStub : stub.getChildrenStubs()) {
    PsiElement child=childStub.getPsi();
    if (aClass.isInstance(child)) {
      result.add((T)child);
    }
  }
  return result;
}
