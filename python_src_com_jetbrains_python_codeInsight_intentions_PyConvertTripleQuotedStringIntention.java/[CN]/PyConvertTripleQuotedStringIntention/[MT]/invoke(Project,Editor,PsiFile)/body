{
  final PyStringLiteralExpression string=PsiTreeUtil.getParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PyStringLiteralExpression.class);
  final PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  if (string != null) {
    final PsiElement parent=string.getParent();
    String stringText=string.getText();
    final int prefixLength=PyStringLiteralExpressionImpl.getPrefixLength(stringText);
    final String prefix=stringText.substring(0,prefixLength);
    final char firstQuote=stringText.substring(prefixLength).charAt(0);
    stringText=string.getStringValue();
    final List<String> subStrings=StringUtil.split(stringText,"\n",false,true);
    final StringBuilder result=new StringBuilder();
    if (subStrings.size() != 1) {
      result.append("(");
    }
    boolean lastString=false;
    for (    String s : subStrings) {
      result.append(prefix);
      result.append(firstQuote);
      final String validSubstring=convertToValidSubString(s,firstQuote);
      if (s.endsWith("'''") || s.endsWith("\"\"\"")) {
        lastString=true;
      }
      result.append(validSubstring);
      result.append(firstQuote);
      if (!lastString) {
        result.append(" ").append("\n");
      }
    }
    if (subStrings.size() != 1) {
      result.append(")");
    }
    final PyExpressionStatement e=elementGenerator.createFromText(LanguageLevel.forElement(string),PyExpressionStatement.class,result.toString());
    PyExpression expression=e.getExpression();
    if ((parent instanceof PyParenthesizedExpression || parent instanceof PyTupleExpression) && expression instanceof PyParenthesizedExpression) {
      expression=((PyParenthesizedExpression)expression).getContainedExpression();
    }
    if (expression != null) {
      string.replace(expression);
    }
  }
}
