{
  PyStringLiteralExpression string=PsiTreeUtil.getParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PyStringLiteralExpression.class);
  PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
  if (string != null) {
    StringBuilder strBuilder=new StringBuilder();
    for (    ASTNode node : string.getStringNodes())     strBuilder.append(node.getText());
    String stringText=strBuilder.toString();
    String[] subStrings=stringText.split("\n");
    Character firstQuote=stringText.charAt(0);
    StringBuilder result=new StringBuilder();
    if (subStrings.length != 1)     result.append("(");
    boolean lastString=false;
    for (    String s : subStrings) {
      result.append(firstQuote);
      String validSubstring=convertToValidSubString(s,firstQuote);
      if (s.endsWith("'''") || s.endsWith("\"\"\"")) {
        lastString=true;
      }
      result.append(validSubstring);
      result.append(firstQuote);
      if (!lastString)       result.append(" ").append(firstQuote).append("\\n").append(firstQuote).append("\n");
    }
    if (subStrings.length != 1)     result.append(")");
    PyExpressionStatement e=elementGenerator.createFromText(LanguageLevel.forElement(string),PyExpressionStatement.class,result.toString());
    string.replace(e.getExpression());
  }
}
