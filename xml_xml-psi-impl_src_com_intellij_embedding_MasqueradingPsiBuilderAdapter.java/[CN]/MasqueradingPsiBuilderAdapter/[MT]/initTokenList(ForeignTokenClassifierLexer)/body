{
  lexer.start(getDelegate().getOriginalText());
  myShrunkSequence=new ArrayList<MyShiftedToken>();
  int realPos=0;
  int shrunkPos=0;
  IElementType currentTokenType;
  while ((currentTokenType=lexer.getTokenType()) != null) {
    final boolean isForeign=lexer.isForeignToken();
    final int tokenLength=lexer.getTokenEnd() - lexer.getTokenStart();
    if (!isForeign) {
      myShrunkSequence.add(new MyShiftedToken(currentTokenType,realPos,realPos + tokenLength,shrunkPos,shrunkPos + tokenLength));
      shrunkPos+=tokenLength;
    }
    realPos+=tokenLength;
    lexer.advance();
  }
}
