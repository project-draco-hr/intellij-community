{
  Project project=e.getProject();
  StudyTaskManager taskManager=StudyTaskManager.getInstance(project);
  Window selectedTaskWindow=taskManager.getSelectedWindow();
  Editor selectedEditor=null;
  if (selectedTaskWindow != null) {
    FileEditor fileEditor=FileEditorManagerImpl.getInstanceEx(project).getSplitters().getCurrentWindow().getSelectedEditor().getSelectedEditorWithProvider().getFirst();
    if (fileEditor instanceof StudyEditor) {
      FileEditor defaultEditor=((StudyEditor)fileEditor).getDefaultEditor();
      if (defaultEditor instanceof PsiAwareTextEditorImpl) {
        selectedEditor=((PsiAwareTextEditorImpl)defaultEditor).getEditor();
      }
      if (selectedEditor != null) {
        VirtualFile openedFile=FileDocumentManager.getInstance().getFile(selectedEditor.getDocument());
        ru.compscicenter.edide.course.TaskFile selectedTaskFile=StudyTaskManager.getInstance(project).getTaskFile(openedFile);
        boolean toDraw=false;
        for (        Window taskWindow : selectedTaskFile.getWindows()) {
          if (toDraw) {
            selectedEditor.getMarkupModel().removeAllHighlighters();
            taskManager.setSelectedWindow(taskWindow);
            taskWindow.draw(selectedEditor,!taskWindow.isResolveStatus());
            return;
          }
          if (taskWindow == selectedTaskWindow) {
            toDraw=true;
          }
        }
      }
    }
  }
}
