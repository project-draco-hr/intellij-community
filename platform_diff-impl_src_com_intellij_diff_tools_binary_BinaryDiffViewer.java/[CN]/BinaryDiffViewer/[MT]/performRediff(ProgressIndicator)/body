{
  try {
    indicator.checkCanceled();
    List<DiffContent> contents=myRequest.getContents();
    if (contents.get(0) instanceof EmptyContent) {
      return new Runnable(){
        @Override public void run(){
          clearDiffPresentation();
          myPanel.addNotification(DiffNotifications.INSERTED_CONTENT);
        }
      }
;
    }
    if (contents.get(1) instanceof EmptyContent) {
      return new Runnable(){
        @Override public void run(){
          clearDiffPresentation();
          myPanel.addNotification(DiffNotifications.REMOVED_CONTENT);
        }
      }
;
    }
    if (!(contents.get(0) instanceof FileContent) || !(contents.get(1) instanceof FileContent)) {
      return new Runnable(){
        @Override public void run(){
          clearDiffPresentation();
        }
      }
;
    }
    final VirtualFile file1=((FileContent)contents.get(0)).getFile();
    final VirtualFile file2=((FileContent)contents.get(1)).getFile();
    if (!file1.isValid() || !file2.isValid()) {
      return new Runnable(){
        @Override public void run(){
          myPanel.addNotification(DiffNotifications.ERROR);
          clearDiffPresentation();
        }
      }
;
    }
    final boolean equal=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      @Override public Boolean compute(){
        try {
          byte[] bytes1=file1.contentsToByteArray();
          byte[] bytes2=file2.contentsToByteArray();
          return Arrays.equals(bytes1,bytes2);
        }
 catch (        IOException e) {
          LOG.warn(e);
          return false;
        }
      }
    }
);
    return new Runnable(){
      @Override public void run(){
        clearDiffPresentation();
        if (equal)         myPanel.addNotification(DiffNotifications.EQUAL_CONTENTS);
      }
    }
;
  }
 catch (  ProcessCanceledException ignore) {
    return new Runnable(){
      @Override public void run(){
        clearDiffPresentation();
        myPanel.addNotification(DiffNotifications.OPERATION_CANCELED);
      }
    }
;
  }
catch (  Throwable e) {
    LOG.error(e);
    return new Runnable(){
      @Override public void run(){
        clearDiffPresentation();
        myPanel.addNotification(DiffNotifications.ERROR);
      }
    }
;
  }
}
