{
  final DataContext dataContext=e.getDataContext();
  final PsiElement[] psiElements=LangDataKeys.PSI_ELEMENT_ARRAY.getData(dataContext);
  final LinkedHashSet<PsiElement> classes=new LinkedHashSet<PsiElement>();
  PsiElementProcessor.CollectElements<PsiElement> processor=new PsiElementProcessor.CollectElements<PsiElement>(classes);
  getPatternBasedProducer().collectTestMembers(psiElements,true,true,processor);
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  final List<T> patternConfigurations=collectPatternConfigurations(classes,project);
  if (patternConfigurations.size() == 1) {
    final T configuration=patternConfigurations.get(0);
    for (    PsiElement aClass : classes) {
      getPatterns(configuration).add(AbstractPatternBasedConfigurationProducer.getQName(aClass));
    }
  }
 else {
    JBPopupFactory.getInstance().createListPopup(new BaseListPopupStep<T>("Choose suite to add",patternConfigurations){
      @Override public PopupStep onChosen(      T configuration,      boolean finalChoice){
        for (        PsiElement aClass : classes) {
          getPatterns(configuration).add(AbstractPatternBasedConfigurationProducer.getQName(aClass));
        }
        return FINAL_CHOICE;
      }
      @Override public Icon getIconFor(      T configuration){
        return configuration.getIcon();
      }
      @NotNull @Override public String getTextFor(      T value){
        return value.getName();
      }
    }
).showInBestPositionFor(dataContext);
  }
}
