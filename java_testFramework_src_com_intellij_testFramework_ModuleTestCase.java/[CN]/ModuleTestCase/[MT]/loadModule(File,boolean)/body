{
  Module module=ApplicationManager.getApplication().runWriteAction(new Computable<Module>(){
    @Override public Module compute(){
      ProjectImpl project=(ProjectImpl)myProject;
      boolean oldOptimiseTestLoadSpeed=project.isOptimiseTestLoadSpeed();
      if (loadComponentStates) {
        project.setOptimiseTestLoadSpeed(false);
      }
      try {
        LocalFileSystem.getInstance().refreshIoFiles(Collections.singletonList(moduleFile));
        return ModuleManager.getInstance(myProject).loadModule(moduleFile.getAbsolutePath());
      }
 catch (      Exception e) {
        LOG.error(e);
        return null;
      }
 finally {
        project.setOptimiseTestLoadSpeed(oldOptimiseTestLoadSpeed);
      }
    }
  }
);
  myModulesToDispose.add(module);
  return module;
}
