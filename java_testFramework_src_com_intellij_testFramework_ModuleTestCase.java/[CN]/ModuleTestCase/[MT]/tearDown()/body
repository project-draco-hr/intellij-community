{
  try {
    ModuleManager moduleManager=ModuleManager.getInstance(myProject);
    List<Throwable> errors=null;
    AccessToken token=WriteAction.start();
    try {
      for (      Module module : myModulesToDispose) {
        try {
          String moduleName=module.getName();
          if (moduleManager.findModuleByName(moduleName) != null) {
            moduleManager.disposeModule(module);
          }
        }
 catch (        Throwable e) {
          if (errors == null) {
            errors=new SmartList<Throwable>();
          }
          errors.add(e);
        }
      }
    }
  finally {
      token.finish();
    }
    CompoundRuntimeException.throwIfNotEmpty(errors);
  }
  finally {
    myModulesToDispose.clear();
    super.tearDown();
  }
}
