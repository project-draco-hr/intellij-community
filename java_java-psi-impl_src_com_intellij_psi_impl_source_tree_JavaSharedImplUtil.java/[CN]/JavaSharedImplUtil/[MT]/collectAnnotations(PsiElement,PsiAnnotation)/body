{
  List<PsiAnnotation[]> annotations=ContainerUtil.newSmartList();
  List<PsiAnnotation> current=null;
  boolean found=(stopAt == null), stop=false;
  for (PsiElement child=anchor.getNextSibling(); child != null; child=child.getNextSibling()) {
    if (child instanceof PsiComment || child instanceof PsiWhiteSpace)     continue;
    if (child instanceof PsiAnnotation) {
      if (current == null)       current=ContainerUtil.newSmartList();
      current.add((PsiAnnotation)child);
      if (child == stopAt)       found=stop=true;
      continue;
    }
    if (PsiUtil.isJavaToken(child,JavaTokenType.LBRACKET)) {
      annotations.add(ContainerUtil.toArray(current,PsiAnnotation.ARRAY_FACTORY));
      current=null;
      if (stop)       return annotations;
    }
 else     if (!PsiUtil.isJavaToken(child,JavaTokenType.RBRACKET)) {
      break;
    }
  }
  return !found || stop ? null : annotations;
}
