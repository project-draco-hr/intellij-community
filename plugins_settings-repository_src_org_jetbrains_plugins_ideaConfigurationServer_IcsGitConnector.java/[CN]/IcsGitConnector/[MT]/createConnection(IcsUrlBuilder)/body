{
  HttpClient httpClient=new HttpClient();
  httpClient.setTimeout(TIMEOUT);
  httpClient.setConnectionTimeout(TIMEOUT);
  HostConfiguration hostConfiguration=httpClient.getHostConfiguration();
  URI uri=new URI(builder.getServerUrl(),false);
  HttpConfigurable proxySettings=IcsManager.getInstance().getIdeaServerSettings().getHttpProxySettings();
  CommonProxy.getInstance().ensureAuthenticator();
  hostConfiguration.setHost(uri);
  if (proxySettings.USE_HTTP_PROXY) {
    hostConfiguration.setProxy(proxySettings.PROXY_HOST,proxySettings.PROXY_PORT);
    if (proxySettings.PROXY_AUTHENTICATION) {
      httpClient.getState().setProxyCredentials(AuthScope.ANY,new UsernamePasswordCredentials(proxySettings.PROXY_LOGIN,proxySettings.getPlainProxyPassword()));
    }
  }
  HttpConnection connection=httpClient.getHttpConnectionManager().getConnection(hostConfiguration);
  connection.getParams().setConnectionTimeout(TIMEOUT);
  if (!connection.isOpen()) {
    connection.open();
  }
  return new Pair<HttpClient,HttpConnection>(httpClient,connection);
}
