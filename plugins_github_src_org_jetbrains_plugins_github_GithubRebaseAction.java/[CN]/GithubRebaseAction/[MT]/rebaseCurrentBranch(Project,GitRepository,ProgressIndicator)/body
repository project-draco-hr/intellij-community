{
  final Git git=ServiceManager.getService(project,Git.class);
  final GitPlatformFacade facade=ServiceManager.getService(project,GitPlatformFacade.class);
  AccessToken token=DvcsUtil.workingTreeChangeStarted(project);
  try {
    List<VirtualFile> rootsToSave=Collections.singletonList(gitRepository.getRoot());
    GitPreservingProcess process=new GitPreservingProcess(project,facade,git,rootsToSave,"Rebasing","upstream/master",indicator,new Runnable(){
      @Override public void run(){
        doRebaseCurrentBranch(project,gitRepository.getRoot(),indicator);
      }
    }
);
    process.execute();
  }
  finally {
    DvcsUtil.workingTreeChangeFinished(project,token);
  }
}
