{
  if (!(file instanceof PyFile))   return null;
  final PsiElement element=PyUtil.findNonWhitespaceAtOffset(file,editor.getCaretModel().getOffset());
  if (element == null) {
    return null;
  }
  if (isLocalFunction(element.getParent()) && ((PyFunction)element.getParent()).getNameIdentifier() == element) {
    return (PyFunction)element.getParent();
  }
  final PsiReference reference=element.getReference();
  if (reference == null) {
    return null;
  }
  final PsiElement resolved=reference.resolve();
  if (isLocalFunction(resolved)) {
    return (PyFunction)resolved;
  }
  return null;
}
