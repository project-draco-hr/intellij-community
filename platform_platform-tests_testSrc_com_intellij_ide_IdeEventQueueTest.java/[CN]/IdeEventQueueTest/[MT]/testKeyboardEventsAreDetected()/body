{
  assertTrue(EventQueue.isDispatchThread());
  IdeEventQueue ideEventQueue=IdeEventQueue.getInstance();
  EventQueue eventQueue=Toolkit.getDefaultToolkit().getSystemEventQueue();
  assertSame(ideEventQueue,eventQueue);
  PlatformTestUtil.dispatchAllEventsInIdeEventQueue();
  int posted=ideEventQueue.myKeyboardEventsPosted.get();
  int dispatched=ideEventQueue.myKeyboardEventsDispatched.get();
  KeyEvent pressX=new KeyEvent(new JLabel(),KeyEvent.KEY_PRESSED,1,InputEvent.ALT_DOWN_MASK,11,'x');
  eventQueue.postEvent(pressX);
  assertEquals(posted + 1,ideEventQueue.myKeyboardEventsPosted.get());
  assertEquals(dispatched,ideEventQueue.myKeyboardEventsDispatched.get());
  assertEquals(pressX,dispatchAllInvocationEventsUntilOtherEvent(ideEventQueue));
  assertEquals(posted + 1,ideEventQueue.myKeyboardEventsPosted.get());
  assertEquals(dispatched + 1,ideEventQueue.myKeyboardEventsDispatched.get());
  AWTEvent ev2=new ActionEvent(new JLabel(),ActionEvent.ACTION_PERFORMED,"Command");
  eventQueue.postEvent(ev2);
  assertEquals(posted + 1,ideEventQueue.myKeyboardEventsPosted.get());
  assertEquals(dispatched + 1,ideEventQueue.myKeyboardEventsDispatched.get());
  assertEquals(ev2,dispatchAllInvocationEventsUntilOtherEvent(ideEventQueue));
  assertEquals(posted + 1,ideEventQueue.myKeyboardEventsPosted.get());
  assertEquals(dispatched + 1,ideEventQueue.myKeyboardEventsDispatched.get());
  KeyEvent keyRelease=new KeyEvent(new JLabel(),KeyEvent.KEY_RELEASED,1,InputEvent.ALT_DOWN_MASK,11,'x');
  eventQueue.postEvent(keyRelease);
  assertEquals(posted + 2,ideEventQueue.myKeyboardEventsPosted.get());
  assertEquals(dispatched + 1,ideEventQueue.myKeyboardEventsDispatched.get());
  assertEquals(keyRelease,dispatchAllInvocationEventsUntilOtherEvent(ideEventQueue));
  assertEquals(posted + 2,ideEventQueue.myKeyboardEventsPosted.get());
  assertEquals(dispatched + 2,ideEventQueue.myKeyboardEventsDispatched.get());
}
