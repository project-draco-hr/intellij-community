{
  final CheckForUpdateResult result=checkForUpdates(updateSettings);
  if (result.getState() == UpdateStrategy.State.LOADED) {
    UpdateSettings settings=UpdateSettings.getInstance();
    settings.saveLastCheckedInfo();
    settings.setKnownChannelIds(result.getAllChannelsIds());
  }
 else   if (result.getState() == UpdateStrategy.State.CONNECTION_ERROR) {
    showErrorMessage(showDialog,project,IdeBundle.message("updates.error.connection.failed"));
    return;
  }
  boolean platformUpdate=newChannelReady(result.getChannelToPropose()) || result.getUpdatedChannel() != null;
  final List<PluginDownloader> updatedPlugins=platformUpdate ? null : updatePlugins(showDialog,project,hostsConfigurable,indicator);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      showUpdateResult(project,result,updatedPlugins,enableLink,showDialog);
      if (callback != null) {
        callback.setDone();
      }
    }
  }
);
}
