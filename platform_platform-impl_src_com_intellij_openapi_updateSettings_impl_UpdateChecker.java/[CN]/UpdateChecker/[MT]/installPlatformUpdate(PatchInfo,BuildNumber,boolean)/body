{
  final Ref<DownloadPatchResult> result=Ref.create(DownloadPatchResult.CANCELED);
  if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    @Override public void run(){
      try {
        ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
        downloadAndInstallPatch(patch,toBuild,forceHttps,indicator);
        result.set(DownloadPatchResult.SUCCESS);
      }
 catch (      IOException e) {
        LOG.info(e);
        result.set(DownloadPatchResult.FAILED);
        Notifications.Bus.notify(new Notification("Updater","Failed to download patch file",e.getMessage(),NotificationType.ERROR));
      }
    }
  }
,IdeBundle.message("update.downloading.patch.progress.title"),true,null)) {
    return DownloadPatchResult.CANCELED;
  }
  return result.get();
}
