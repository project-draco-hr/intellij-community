{
  boolean amend=myNextCommitAmend;
  for (  List<String> paths : VcsFileUtil.chunkPaths(root,files)) {
    GitSimpleHandler handler=new GitSimpleHandler(project,root,GitCommand.COMMIT);
    handler.setStdoutSuppressed(false);
    if (myNextCommitSignOff) {
      handler.addParameters("--signoff");
    }
    if (amend) {
      handler.addParameters("--amend");
    }
 else {
      amend=true;
    }
    handler.addParameters("--only","-F",message.getAbsolutePath());
    if (myNextCommitAuthor != null) {
      handler.addParameters("--author=" + myNextCommitAuthor);
    }
    if (myNextCommitAuthorDate != null) {
      handler.addParameters("--date",COMMIT_DATE_FORMAT.format(myNextCommitAuthorDate));
    }
    handler.endOptions();
    handler.addParameters(paths);
    handler.run();
  }
  if (!project.isDisposed()) {
    GitRepositoryManager manager=GitUtil.getRepositoryManager(project);
    manager.updateRepository(root);
  }
}
