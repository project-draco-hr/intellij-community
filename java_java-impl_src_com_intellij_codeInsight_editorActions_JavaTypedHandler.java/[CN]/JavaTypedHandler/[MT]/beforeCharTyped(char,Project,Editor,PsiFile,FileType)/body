{
  if (c == '@' && file instanceof PsiJavaFile) {
    autoPopupJavadocLookup(project,editor);
  }
 else   if (c == '#' || c == '.') {
    autoPopupMemberLookup(project,editor);
  }
  int offsetBefore=editor.getCaretModel().getOffset();
  myJavaLTTyped='<' == c && file instanceof PsiJavaFile && !(file instanceof JspFile) && CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET && PsiUtil.isLanguageLevel5OrHigher(file) && isAfterClassLikeIdentifierOrDot(offsetBefore,editor);
  if ('>' == c) {
    if (file instanceof PsiJavaFile && !(file instanceof JspFile) && CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET&& PsiUtil.isLanguageLevel5OrHigher(file)) {
      if (handleJavaGT(editor,JavaTokenType.LT,JavaTokenType.GT,INVALID_INSIDE_REFERENCE))       return Result.STOP;
    }
  }
  if (c == ';') {
    if (handleSemicolon(editor,fileType))     return Result.STOP;
  }
  if (fileType == StdFileTypes.JAVA && c == '{') {
    int offset=editor.getCaretModel().getOffset();
    if (offset == 0) {
      return Result.CONTINUE;
    }
    HighlighterIterator iterator=((EditorEx)editor).getHighlighter().createIterator(offset - 1);
    while (!iterator.atEnd() && iterator.getTokenType() == TokenType.WHITE_SPACE) {
      iterator.retreat();
    }
    if (iterator.atEnd() || iterator.getTokenType() == JavaTokenType.RBRACKET || iterator.getTokenType() == JavaTokenType.EQ) {
      return Result.CONTINUE;
    }
    Document doc=editor.getDocument();
    PsiDocumentManager.getInstance(project).commitDocument(doc);
    final PsiElement leaf=file.findElementAt(offset);
    if (PsiTreeUtil.getParentOfType(leaf,PsiArrayInitializerExpression.class,false,PsiCodeBlock.class,PsiMember.class) != null) {
      return Result.CONTINUE;
    }
    PsiElement st=leaf != null ? leaf.getParent() : null;
    PsiElement prev=offset > 1 ? file.findElementAt(offset - 1) : null;
    if (CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET && isRparenth(leaf) && (st instanceof PsiWhileStatement || st instanceof PsiIfStatement)&& shouldInsertStatementBody(st,doc,prev)) {
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        @Override public void run(){
          new JavaSmartEnterProcessor().process(project,editor,file);
        }
      }
,"Insert block statement",null);
      return Result.STOP;
    }
    if (leaf != null && PsiTreeUtil.getParentOfType(PsiTreeUtil.prevVisibleLeaf(leaf),PsiNewExpression.class,true,PsiCodeBlock.class,PsiMember.class) != null) {
      return Result.CONTINUE;
    }
    if (PsiTreeUtil.getParentOfType(leaf,PsiCodeBlock.class,false,PsiMember.class) != null) {
      EditorModificationUtil.insertStringAtCaret(editor,"{");
      TypedHandler.indentOpenedBrace(project,editor);
      return Result.STOP;
    }
  }
  return Result.CONTINUE;
}
