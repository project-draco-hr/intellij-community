{
  File realDir=myTempDir.newFolder("real");
  File symLink=IoTestUtil.createSymLink(realDir.getPath(),myTempDir.getRoot() + "/link");
  File mappedDir=new File(myTempDir.getRoot(),"mapped");
  CanonicalPathMap pathMap=new CanonicalPathMap(Collections.singletonList(symLink.getPath()),Collections.emptyList());
  List<Pair<String,String>> mappings=ContainerUtil.newArrayList();
  mappings.add(pair(mappedDir.getPath(),realDir.getPath()));
  pathMap.addMapping(mappings);
  Collection<String> watchedPaths=pathMap.getWatchedPaths(new File(mappedDir,"file.txt").getPath(),true,false);
  assertThat(watchedPaths).containsExactly(new File(symLink,"file.txt").getPath());
}
