{
  GrIntroduceContext context=getContext();
  PsiElement[] occurrences=getOccurrences();
  EnumSet<GrIntroduceFieldSettings.Init> result=EnumSet.noneOf(GrIntroduceFieldSettings.Init.class);
  if (context.getExpression() != null || context.getVar() != null && context.getVar().getInitializerGroovy() != null || context.getStringPart() != null) {
    result.add(GrIntroduceFieldSettings.Init.FIELD_DECLARATION);
  }
  if (!(context.getScope() instanceof GroovyScriptClass || context.getScope() instanceof GroovyFileBase)) {
    result.add(GrIntroduceFieldSettings.Init.CONSTRUCTOR);
  }
  PsiElement scope=context.getScope();
  if (isReplaceAllOccurrences() || occurrences.length == 1) {
    PsiElement parent=PsiTreeUtil.findCommonParent(occurrences);
    PsiElement container=GrIntroduceHandlerBase.getEnclosingContainer(parent);
    if (container != null && PsiTreeUtil.isAncestor(scope,container,false)) {
      PsiElement anchor=GrIntroduceHandlerBase.findAnchor(occurrences,container);
      if (anchor != null) {
        result.add(GrIntroduceFieldSettings.Init.CUR_METHOD);
      }
    }
  }
  if (scope instanceof GrTypeDefinition && TestFrameworks.getInstance().isTestClass((PsiClass)scope)) {
    result.add(GrIntroduceFieldSettings.Init.SETUP_METHOD);
  }
  return result;
}
