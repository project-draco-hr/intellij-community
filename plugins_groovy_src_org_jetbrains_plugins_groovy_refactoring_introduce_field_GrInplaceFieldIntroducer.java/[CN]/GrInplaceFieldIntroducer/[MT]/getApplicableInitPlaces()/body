{
  GrIntroduceContext context=getContext();
  PsiElement[] occurrences=getOccurrences();
  EnumSet<GrIntroduceFieldSettings.Init> result=EnumSet.of(GrIntroduceFieldSettings.Init.FIELD_DECLARATION);
  if (!(context.getScope() instanceof GroovyScriptClass || context.getScope() instanceof GroovyFileBase)) {
    result.add(GrIntroduceFieldSettings.Init.CONSTRUCTOR);
  }
  PsiElement scope=context.getScope();
  if (isReplaceAllOccurrences()) {
    PsiElement parent=PsiTreeUtil.findCommonParent(occurrences);
    PsiElement container=GrIntroduceHandlerBase.getEnclosingContainer(parent);
    if (container != null) {
      PsiElement anchor=GrIntroduceHandlerBase.findAnchor(occurrences,container);
      if (anchor != null) {
        result.add(GrIntroduceFieldSettings.Init.CUR_METHOD);
      }
    }
  }
  if (scope instanceof GrTypeDefinition && TestFrameworks.getInstance().isTestClass((PsiClass)scope)) {
    result.add(GrIntroduceFieldSettings.Init.SETUP_METHOD);
  }
  return result;
}
