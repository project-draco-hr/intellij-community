{
  final String missingValue="missing";
  if (element instanceof PyStringLiteralExpression) {
    final PyStringLiteralExpression expr=(PyStringLiteralExpression)element;
    final List<TextRange> ranges=expr.getStringValueTextRanges();
    final String text=expr.getText();
    for (    TextRange range : ranges) {
      if (formatting != Formatting.NONE) {
        final String part=range.substring(text);
        final List<FormatStringChunk> chunks=formatting == Formatting.NEW_STYLE ? parseNewStyleFormat(part) : parsePercentFormat(part);
        for (int i=0; i < chunks.size(); i++) {
          final FormatStringChunk chunk=chunks.get(i);
          if (chunk instanceof ConstantChunk) {
            final int nextIndex=i + 1;
            final String chunkPrefix;
            if (i == 1 && chunks.get(0) instanceof SubstitutionChunk) {
              chunkPrefix=missingValue;
            }
 else             if (i == 0) {
              chunkPrefix=prefix;
            }
 else {
              chunkPrefix="";
            }
            final String chunkSuffix;
            if (nextIndex < chunks.size() && chunks.get(nextIndex) instanceof SubstitutionChunk) {
              chunkSuffix=missingValue;
            }
 else             if (nextIndex == chunks.size()) {
              chunkSuffix=suffix;
            }
 else {
              chunkSuffix="";
            }
            final TextRange chunkRange=chunk.getTextRange().shiftRight(range.getStartOffset());
            registrar.addPlace(chunkPrefix,chunkSuffix,expr,chunkRange);
          }
        }
      }
 else {
        registrar.addPlace(prefix,suffix,expr,range);
      }
    }
  }
 else   if (element instanceof PyParenthesizedExpression) {
    final PyExpression contained=((PyParenthesizedExpression)element).getContainedExpression();
    if (contained != null) {
      processStringLiteral(contained,registrar,prefix,suffix,formatting);
    }
  }
 else   if (element instanceof PyBinaryExpression) {
    final PyBinaryExpression expr=(PyBinaryExpression)element;
    final PyExpression left=expr.getLeftExpression();
    final PyExpression right=expr.getRightExpression();
    final boolean isLeftString=isStringLiteralPart(left,null);
    if (expr.isOperator("+")) {
      final boolean isRightString=right != null && isStringLiteralPart(right,null);
      if (isLeftString) {
        processStringLiteral(left,registrar,prefix,isRightString ? "" : missingValue,formatting);
      }
      if (isRightString) {
        processStringLiteral(right,registrar,isLeftString ? "" : missingValue,suffix,formatting);
      }
    }
 else     if (expr.isOperator("%")) {
      processStringLiteral(left,registrar,prefix,suffix,Formatting.PERCENT);
    }
  }
 else   if (element instanceof PyCallExpression) {
    final PyExpression qualifier=getFormatCallQualifier((PyCallExpression)element);
    if (qualifier != null) {
      processStringLiteral(qualifier,registrar,prefix,suffix,Formatting.NEW_STYLE);
    }
  }
}
