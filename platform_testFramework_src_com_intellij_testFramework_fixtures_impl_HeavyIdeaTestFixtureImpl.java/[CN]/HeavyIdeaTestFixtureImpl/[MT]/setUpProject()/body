{
  EdtTestUtil.runInEdtAndWait(new ThrowableRunnable<Throwable>(){
    @Override public void run() throws Throwable {
      File tempDirectory=FileUtil.createTempDirectory(myName,"");
      PlatformTestCase.synchronizeTempDirVfs(LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDirectory));
      myFilesToDelete.add(tempDirectory);
      File projectFile=new File(tempDirectory,myName + ProjectFileType.DOT_DEFAULT_EXTENSION);
      LocalFileSystem.getInstance().refreshAndFindFileByIoFile(projectFile);
      ByteArrayOutputStream buffer=new ByteArrayOutputStream();
      new Throwable(projectFile.getPath()).printStackTrace(new PrintStream(buffer));
      myProject=PlatformTestCase.createProject(projectFile,buffer.toString());
      ProjectManagerEx.getInstanceEx().openTestProject(myProject);
      for (      ModuleFixtureBuilder moduleFixtureBuilder : myModuleFixtureBuilders) {
        moduleFixtureBuilder.getFixture().setUp();
      }
      LightPlatformTestCase.clearUncommittedDocuments(myProject);
      ((FileTypeManagerImpl)FileTypeManager.getInstance()).drainReDetectQueue();
    }
  }
);
}
