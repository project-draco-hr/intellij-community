{
  StringBuilder argument=new StringBuilder("-javaagent:");
  final String agentPath=PathUtil.getJarPathForClass(ProjectData.class);
  final String parentPath=handleSpacesInPath(agentPath,new FileFilter(){
    @Override public boolean accept(    File file){
      final String fileName=file.getName();
      return fileName.startsWith("coverage-") || fileName.startsWith("asm-all") || fileName.startsWith("trove4j");
    }
  }
);
  argument.append(parentPath).append(File.separator).append(new File(agentPath).getName());
  argument.append("=");
  try {
    final File tempFile=createTempFile();
    tempFile.deleteOnExit();
    write2file(tempFile,sessionDataFilePath);
    write2file(tempFile,String.valueOf(collectLineInfo));
    write2file(tempFile,Boolean.FALSE.toString());
    write2file(tempFile,Boolean.FALSE.toString());
    write2file(tempFile,String.valueOf(isSampling));
    if (sourceMapPath != null) {
      write2file(tempFile,Boolean.TRUE.toString());
      write2file(tempFile,sourceMapPath);
    }
    if (patterns != null) {
      for (      String coveragePattern : patterns) {
        coveragePattern=coveragePattern.replace("$","\\$").replace(".","\\.").replaceAll("\\*",".*");
        if (!coveragePattern.endsWith(".*")) {
          coveragePattern+="(\\$.*)*";
        }
        write2file(tempFile,coveragePattern);
      }
    }
    argument.append(tempFile.getCanonicalPath());
  }
 catch (  IOException e) {
    LOG.info("Coverage was not enabled",e);
    return;
  }
  javaParameters.getVMParametersList().add(argument.toString());
  int agentDebugPort=Registry.intValue("coverage.agent.debug.port",-1);
  if (agentDebugPort >= 0) {
    javaParameters.getVMParametersList().add("-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=" + agentDebugPort);
  }
}
