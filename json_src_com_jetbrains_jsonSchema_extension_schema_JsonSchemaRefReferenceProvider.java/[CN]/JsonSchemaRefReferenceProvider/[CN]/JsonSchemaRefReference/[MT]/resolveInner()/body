{
  final FileBasedIndex index=FileBasedIndex.getInstance();
  final String text=getCanonicalText();
  String id=null;
  String ref=text.substring(1);
  if (!text.startsWith("#")) {
    final int idx=text.indexOf("#");
    if (idx <= 0)     return null;
    id=text.substring(0,idx);
    ref=text.substring(idx + 1);
  }
  final Project project=getElement().getProject();
  final Ref<Pair<VirtualFile,Integer>> reference=new Ref<>();
  final GlobalSearchScope filter=id == null ? GlobalSearchScope.fileScope(getElement().getContainingFile()) : JsonSchemaResourcesRootsProvider.enlarge(project,GlobalSearchScope.allScope(project));
  String finalId=id;
  index.processValues(JsonSchemaFileIndex.PROPERTIES_INDEX,ref,null,new FileBasedIndex.ValueProcessor<Integer>(){
    @Override public boolean process(    VirtualFile file,    Integer value){
      if (finalId != null) {
        if (!JsonSchemaService.Impl.getEx(project).checkFileForId(finalId,file)) {
          return true;
        }
      }
      reference.set(Pair.create(file,value));
      return false;
    }
  }
,filter);
  if (!reference.isNull()) {
    final Pair<VirtualFile,Integer> pair=reference.get();
    final PsiFile file=getElement().getManager().findFile(pair.getFirst());
    if (file != null) {
      return file.findElementAt(pair.getSecond());
    }
  }
  return null;
}
