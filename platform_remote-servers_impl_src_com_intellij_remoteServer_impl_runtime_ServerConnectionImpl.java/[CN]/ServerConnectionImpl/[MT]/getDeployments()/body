{
  Set<Deployment> result=new LinkedHashSet<Deployment>();
  Map<Deployment,DeploymentImpl> orderedDeployments=new TreeMap<Deployment,DeploymentImpl>(getServer().getType().getDeploymentComparator());
synchronized (myLocalDeployments) {
synchronized (myRemoteDeployments) {
      for (      LocalDeploymentImpl localDeployment : myLocalDeployments.values()) {
        localDeployment.setRemoteDeployment(null);
        orderedDeployments.put(localDeployment,localDeployment);
      }
      result.addAll(orderedDeployments.keySet());
      for (      DeploymentImpl remoteDeployment : myRemoteDeployments.values()) {
        DeploymentImpl deployment=orderedDeployments.get(remoteDeployment);
        if (deployment != null) {
          if (deployment instanceof LocalDeploymentImpl) {
            ((LocalDeploymentImpl)deployment).setRemoteDeployment(remoteDeployment);
          }
        }
 else {
          orderedDeployments.put(remoteDeployment,remoteDeployment);
        }
      }
      result.addAll(orderedDeployments.keySet());
    }
  }
  return result;
}
