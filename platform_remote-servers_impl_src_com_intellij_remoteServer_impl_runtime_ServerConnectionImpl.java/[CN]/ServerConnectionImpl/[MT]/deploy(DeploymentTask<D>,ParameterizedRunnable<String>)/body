{
  connectIfNeeded(new ConnectionCallbackBase<D>(){
    @Override public void connected(    @NotNull ServerRuntimeInstance<D> instance){
      DeploymentSource source=task.getSource();
      D configuration=task.getConfiguration();
      String deploymentName=instance.getDeploymentName(source,configuration);
      LocalDeploymentImpl deployment;
synchronized (myLocalDeployments) {
        deployment=new LocalDeploymentImpl(ServerConnectionImpl.this,deploymentName,DeploymentStatus.DEPLOYING,null,null,task,instance.getDeploymentGroup(source,configuration));
        myLocalDeployments.put(deploymentName,deployment);
      }
      DeploymentLogManagerImpl logManager=new DeploymentLogManagerImpl(task.getProject(),new ChangeListener()).withMainHandlerVisible(true);
      LoggingHandlerImpl handler=logManager.getMainLoggingHandler();
      myLogManagers.put(deploymentName,logManager);
      handler.printlnSystemMessage("Deploying '" + deploymentName + "'...");
      onDeploymentStarted.run(deploymentName);
      instance.deploy(task,logManager,new DeploymentOperationCallbackImpl(deploymentName,(DeploymentTaskImpl<D>)task,handler,deployment));
    }
  }
);
}
