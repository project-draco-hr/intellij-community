{
  final String deploymentName=deployment.getName();
  myLocalDeployments.put(deploymentName,new DeploymentImpl(deploymentName,DeploymentStatus.UNDEPLOYING,null,null));
  myEventDispatcher.queueDeploymentsChanged(this);
  runtime.undeploy(new DeploymentRuntime.UndeploymentTaskCallback(){
    @Override public void succeeded(){
      myLocalDeployments.remove(deploymentName);
      myEventDispatcher.queueDeploymentsChanged(ServerConnectionImpl.this);
    }
    @Override public void errorOccurred(    @NotNull String errorMessage){
      myLocalDeployments.put(deploymentName,new DeploymentImpl(deploymentName,DeploymentStatus.DEPLOYED,errorMessage,runtime));
      myEventDispatcher.queueDeploymentsChanged(ServerConnectionImpl.this);
    }
  }
);
}
