{
  Map<String,Object> fileToState=states.get(componentName);
  if (fileName == null || newState == null || JDOMUtil.isEmpty(newState)) {
    if (fileToState == null) {
      return null;
    }
 else     if (fileName == null) {
      return states.remove(componentName);
    }
 else {
      Object oldState=fileToState.remove(fileName);
      if (fileToState.isEmpty()) {
        states.remove(componentName);
      }
      return oldState;
    }
  }
  if (fileToState == null) {
    fileToState=new THashMap<String,Object>();
    fileToState.put(fileName,newState);
    states.put(componentName,fileToState);
  }
 else {
    Object oldState=fileToState.get(fileName);
    byte[] newBytes=null;
    if (oldState instanceof Element) {
      if (JDOMUtil.areElementsEqual((Element)oldState,newState)) {
        return null;
      }
    }
 else     if (oldState != null) {
      newBytes=getNewByteIfDiffers(fileName,newState,(byte[])oldState);
      if (newBytes == null) {
        return null;
      }
    }
    fileToState.put(fileName,newBytes == null ? newState : newBytes);
  }
  return newState;
}
