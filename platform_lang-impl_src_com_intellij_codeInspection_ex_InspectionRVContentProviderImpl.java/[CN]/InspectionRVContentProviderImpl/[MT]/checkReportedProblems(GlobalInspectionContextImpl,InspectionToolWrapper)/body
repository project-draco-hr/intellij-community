{
  InspectionToolPresentation presentation=context.getPresentation(toolWrapper);
  presentation.updateContent();
  final SearchScope searchScope=context.getCurrentScope().toSearchScope();
  if (searchScope instanceof LocalSearchScope) {
    final Map<String,Set<RefEntity>> contents=presentation.getContent();
    final Map<RefEntity,CommonProblemDescriptor[]> problemElements=presentation.getProblemElements();
    for (    Set<RefEntity> entities : contents.values()) {
      for (Iterator<RefEntity> iterator=entities.iterator(); iterator.hasNext(); ) {
        RefEntity entity=iterator.next();
        if (entity instanceof RefElement) {
          final PsiElement element=((RefElement)entity).getElement();
          if (element != null) {
            final TextRange range=element.getTextRange();
            if (range != null && ((LocalSearchScope)searchScope).containsRange(element.getContainingFile(),range)) {
              continue;
            }
          }
        }
        problemElements.remove(entity);
        iterator.remove();
      }
    }
  }
  return presentation.hasReportedProblems();
}
