{
  int caretOffset=editor.getCaretModel().getOffset();
  PsiElement element=psiFile.findElementAt(caretOffset);
  if (element == null) {
    return null;
  }
  while (caretOffset > 0 && element instanceof PsiWhiteSpace) {
    caretOffset--;
    element=psiFile.findElementAt(caretOffset);
  }
  PyStatement statement=PsiTreeUtil.getParentOfType(element,PyStatement.class);
  if (statement != null) {
    PyStatementList statementList=PsiTreeUtil.findChildOfType(statement,PyStatementList.class);
    if (statementList == null) {
      statementList=PsiTreeUtil.getParentOfType(statement,PyStatementList.class);
      if (statementList != null) {
        statement=PsiTreeUtil.getParentOfType(statementList,PyStatement.class);
      }
    }
    if (statement != null) {
      if (caretOffset == statement.getTextRange().getStartOffset()) {
        final PyStatement statementAbove=PsiTreeUtil.getParentOfType(statement,PyStatement.class);
        if (statementAbove != null) {
          return new TextRange(statementAbove.getTextRange().getStartOffset(),statement.getTextRange().getEndOffset());
        }
      }
      return statement.getTextRange();
    }
  }
  return null;
}
