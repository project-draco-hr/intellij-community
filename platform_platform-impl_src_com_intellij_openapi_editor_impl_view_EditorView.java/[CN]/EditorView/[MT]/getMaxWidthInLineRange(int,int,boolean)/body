{
  int maxWidth=0;
  endVisualLine=Math.min(endVisualLine,myEditor.getVisibleLineCount() - 1);
  for (int i=startVisualLine; i <= endVisualLine; i++) {
    int startOffset=myMapper.visualLineToOffset(i);
    float x=0;
    int maxOffset=0;
    for (    VisualLineFragmentsIterator.Fragment fragment : VisualLineFragmentsIterator.create(this,startOffset,false,quick)) {
      x=fragment.getEndX();
      maxOffset=Math.max(maxOffset,fragment.getMaxOffset());
    }
    if (myEditor.getSoftWrapModel().getSoftWrap(maxOffset) != null) {
      x+=myEditor.getSoftWrapModel().getMinDrawingWidthInPixels(SoftWrapDrawingType.BEFORE_SOFT_WRAP_LINE_FEED);
    }
    maxWidth=Math.max(maxWidth,(int)x);
  }
  return maxWidth;
}
