{
  ChangeListManager manager=ChangeListManager.getInstance(project);
  if (myRbNew.isSelected()) {
    String newText=myNewListPanel.getChangeListName();
    if (manager.findChangeList(newText) != null) {
      Messages.showErrorDialog(project,VcsBundle.message("changes.newchangelist.warning.already.exists.text",newText),VcsBundle.message("changes.newchangelist.warning.already.exists.title"));
      return null;
    }
  }
  final boolean existingSelected=myRbExisting.isSelected();
  VcsConfiguration.getInstance(myProject).PRESELECT_EXISTING_CHANGELIST=existingSelected;
  if (existingSelected) {
    return (LocalChangeList)myExistingListsCombo.getSelectedItem();
  }
 else {
    LocalChangeList changeList=manager.addChangeList(myNewListPanel.getChangeListName(),myNewListPanel.getDescription());
    myNewListPanel.changelistCreatedOrChanged(changeList);
    if (myNewListPanel.getMakeActiveCheckBox().isSelected()) {
      manager.setDefaultChangeList(changeList);
    }
    VcsConfiguration.getInstance(project).MAKE_NEW_CHANGELIST_ACTIVE=myNewListPanel.getMakeActiveCheckBox().isSelected();
    return changeList;
  }
}
