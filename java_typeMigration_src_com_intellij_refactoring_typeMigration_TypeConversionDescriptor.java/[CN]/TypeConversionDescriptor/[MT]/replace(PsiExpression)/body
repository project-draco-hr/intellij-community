{
  if (getExpression() != null)   expression=getExpression();
  final Project project=expression.getProject();
  final ReplaceOptions options=new ReplaceOptions();
  final MatchOptions matchOptions=new MatchOptions();
  matchOptions.setFileType(StdFileTypes.JAVA);
  options.setMatchOptions(matchOptions);
  final Replacer replacer=new Replacer(project,null);
  try {
    final String replacement=replacer.testReplace(expression.getText(),getStringToReplace(),getReplaceByString(),options);
    try {
      JavaCodeStyleManager.getInstance(project).shortenClassReferences(expression.replace(JavaPsiFacade.getInstance(project).getElementFactory().createExpressionFromText(replacement,expression)));
    }
 catch (    IncorrectOperationException e) {
      LOG.error(e);
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
