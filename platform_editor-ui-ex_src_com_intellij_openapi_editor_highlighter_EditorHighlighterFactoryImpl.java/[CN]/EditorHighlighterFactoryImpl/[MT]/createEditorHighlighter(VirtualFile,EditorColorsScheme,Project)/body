{
  FileType fileType=vFile.getFileType();
  if (fileType instanceof LanguageFileType) {
    LanguageFileType substFileType=substituteFileType(((LanguageFileType)fileType).getLanguage(),vFile,project);
    if (substFileType != null) {
      EditorHighlighterProvider provider=FileTypeEditorHighlighterProviders.INSTANCE.forFileType(substFileType);
      EditorHighlighter editorHighlighter=provider.getEditorHighlighter(project,fileType,vFile,settings);
      boolean isPlain=editorHighlighter.getClass() == LexerEditorHighlighter.class && ((LexerEditorHighlighter)editorHighlighter).isPlain();
      if (!isPlain) {
        return editorHighlighter;
      }
    }
    try {
      return FileTypeEditorHighlighterProviders.INSTANCE.forFileType(fileType).getEditorHighlighter(project,fileType,vFile,settings);
    }
 catch (    Exception e) {
      LOG.error(e);
    }
  }
  SyntaxHighlighter highlighter=null;
  for (  ContentBasedFileSubstitutor processor : Extensions.getExtensions(ContentBasedFileSubstitutor.EP_NAME)) {
    boolean applicable;
    try {
      applicable=processor.isApplicable(project,vFile);
    }
 catch (    Exception e) {
      LOG.error(e);
      continue;
    }
    if (applicable && processor instanceof ContentBasedClassFileProcessor) {
      highlighter=((ContentBasedClassFileProcessor)processor).createHighlighter(project,vFile);
    }
  }
  if (highlighter == null) {
    highlighter=SyntaxHighlighterFactory.getSyntaxHighlighter(fileType,project,vFile);
  }
  return createEditorHighlighter(highlighter,settings);
}
