{
  if (range.getType() == Range.MODIFIED)   return range;
  if (range.getType() == Range.INSERTED || range.getType() == Range.DELETED) {
    boolean canExpandBefore=range.getOffset1() != 0 && range.getUOffset1() != 0;
    boolean canExpandAfter=range.getOffset2() < document.getLineCount() && range.getUOffset2() < uDocument.getLineCount();
    int offset1=range.getOffset1() - (canExpandBefore ? 1 : 0);
    int uOffset1=range.getUOffset1() - (canExpandBefore ? 1 : 0);
    int offset2=range.getOffset2() + (canExpandAfter ? 1 : 0);
    int uOffset2=range.getUOffset2() + (canExpandAfter ? 1 : 0);
    return new Range(offset1,offset2,uOffset1,uOffset2,range.getType());
  }
  throw new IllegalArgumentException("Unknown range type: " + range.getType());
}
