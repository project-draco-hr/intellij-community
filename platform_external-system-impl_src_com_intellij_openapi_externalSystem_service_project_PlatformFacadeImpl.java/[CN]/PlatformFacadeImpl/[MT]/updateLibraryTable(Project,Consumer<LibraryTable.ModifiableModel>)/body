{
  final ModifiableModelsProvider modifiableModelsProvider=ModifiableModelsProvider.SERVICE.getInstance();
  final LibraryTable.ModifiableModel modifiableModel=ApplicationManager.getApplication().runReadAction(new Computable<LibraryTable.ModifiableModel>(){
    @Override public LibraryTable.ModifiableModel compute(){
      return modifiableModelsProvider.getLibraryTableModifiableModel(project);
    }
  }
);
  task.consume(modifiableModel);
  if (modifiableModel.isChanged()) {
    doWriteAction(new Runnable(){
      @Override public void run(){
        modifiableModel.commit();
      }
    }
);
  }
}
