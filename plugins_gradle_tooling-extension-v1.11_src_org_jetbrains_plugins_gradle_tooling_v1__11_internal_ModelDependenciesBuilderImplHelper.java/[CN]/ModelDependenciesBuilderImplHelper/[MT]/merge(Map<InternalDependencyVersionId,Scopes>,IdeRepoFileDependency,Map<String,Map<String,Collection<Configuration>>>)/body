{
  final String configurationName=dependency.getDeclaredConfiguration().getName();
  final GradleDependencyScope scope=deduceScope(configurationName,userScopes);
  if (scope == null)   return;
  final ModuleVersionIdentifier dependencyId;
  if (dependency instanceof UnresolvedIdeRepoFileDependency) {
    UnresolvedIdeRepoFileDependency unresolvedDependency=(UnresolvedIdeRepoFileDependency)dependency;
    dependencyId=new MyModuleVersionIdentifier(unresolvedDependency.getFile().getName());
  }
 else {
    dependencyId=dependency.getId();
  }
  String classifier=parseClassifier(dependencyId,dependency.getFile());
  String dependencyFileName=null;
  if (dependency.getFile() != null) {
    dependencyFileName=dependency.getFile().getName();
  }
  InternalDependencyVersionId versionId=new InternalDependencyVersionId(dependency,dependencyId.getName(),dependencyId.getName(),dependencyFileName,dependencyId.getGroup(),dependencyId.getVersion(),classifier);
  Scopes scopes=map.get(versionId);
  if (scopes == null) {
    map.put(versionId,new Scopes(scope));
  }
 else {
    scopes.add(scope);
  }
}
