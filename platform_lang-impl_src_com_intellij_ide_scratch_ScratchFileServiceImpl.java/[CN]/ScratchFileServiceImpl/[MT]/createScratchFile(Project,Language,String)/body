{
  RunResult<VirtualFile> result=new WriteCommandAction<VirtualFile>(project,UIBundle.message("file.chooser.create.new.file.command.name")){
    @Override protected void run(    @NotNull Result<VirtualFile> result) throws Throwable {
      VirtualFile dir=VfsUtil.createDirectories(getRootPath(SCRATCHES));
      VirtualFile file=VfsUtil.createChildSequent(LocalFileSystem.getInstance(),dir,"scratch","");
      getScratchesMapping().setMapping(file,language);
      VfsUtil.saveText(file,initialContent);
      result.setResult(file);
    }
  }
.execute();
  if (result.hasException()) {
    Messages.showMessageDialog(UIBundle.message("create.new.file.could.not.create.file.error.message","scratch"),UIBundle.message("error.dialog.title"),Messages.getErrorIcon());
    return null;
  }
  return result.getResultObject();
}
