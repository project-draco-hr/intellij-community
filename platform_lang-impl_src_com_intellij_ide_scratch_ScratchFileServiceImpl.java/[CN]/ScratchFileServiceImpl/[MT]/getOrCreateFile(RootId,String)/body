{
  return ApplicationManager.getApplication().runWriteAction(new ThrowableComputable<VirtualFile,IOException>(){
    @Override public VirtualFile compute() throws IOException {
      VirtualFile dir=VfsUtil.createDirectories(getRootPath(rootId));
      VirtualFile existingFile=dir.findChild(pathName);
      if (existingFile != null && !existingFile.isDirectory())       return existingFile;
      String ext=PathUtil.getFileExtension(pathName);
      String name=ext == null ? pathName : StringUtil.trimEnd(pathName,"." + ext);
      return VfsUtil.createChildSequent(LocalFileSystem.getInstance(),dir,name,StringUtil.notNullize(ext));
    }
  }
);
}
