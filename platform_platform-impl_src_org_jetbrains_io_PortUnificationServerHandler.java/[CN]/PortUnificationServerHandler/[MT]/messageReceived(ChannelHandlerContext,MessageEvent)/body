{
  Object m=e.getMessage();
  if (!(m instanceof ChannelBuffer)) {
    context.sendUpstream(e);
    return;
  }
  ChannelBuffer input=(ChannelBuffer)m;
  if (!input.readable()) {
    return;
  }
  if (cumulation == null) {
    if (input.readableBytes() < 5) {
      cumulation=context.getChannel().getConfig().getBufferFactory().getBuffer(8);
      cumulation.writeBytes(input);
    }
 else {
      decode(context,input,e.getRemoteAddress());
    }
  }
 else {
    if ((cumulation.readableBytes() + input.readableBytes()) < 5) {
      cumulation.writeBytes(input);
    }
 else {
      ChannelBuffer compositeBuffer=ChannelBuffers.wrappedBuffer(cumulation,input);
      cumulation=null;
      decode(context,compositeBuffer,e.getRemoteAddress());
    }
  }
}
