{
  PyIfStatement expression=PsiTreeUtil.getParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PyIfStatement.class);
  PyIfStatement ifStatement=getIfStatement(expression);
  PyStatement firstStatement=getFirstStatement(ifStatement);
  if (firstStatement != null && firstStatement instanceof PyIfStatement) {
    PyExpression condition=((PyIfStatement)firstStatement).getIfPart().getCondition();
    PyElementGenerator elementGenerator=PyElementGenerator.getInstance(project);
    PyExpression newCondition=elementGenerator.createExpressionFromText(ifStatement.getIfPart().getCondition().getText() + " and " + condition.getText());
    ifStatement.getIfPart().getCondition().replace(newCondition);
    PyStatementList stList=((PyIfStatement)firstStatement).getIfPart().getStatementList();
    PyStatementList ifStatementList=ifStatement.getIfPart().getStatementList();
    List<PsiComment> comments=PsiTreeUtil.getChildrenOfTypeAsList(ifStatement.getIfPart(),PsiComment.class);
    comments.addAll(PsiTreeUtil.getChildrenOfTypeAsList(((PyIfStatement)firstStatement).getIfPart(),PsiComment.class));
    for (    PsiElement comm : comments) {
      ifStatement.getIfPart().addBefore(comm,ifStatementList);
      comm.delete();
    }
    ifStatementList.replace(stList);
  }
}
