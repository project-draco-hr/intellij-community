{
  try {
    if (getModel().getHistory().isEmpty())     return;
    if (myRootType.isHidden()) {
      saveHistoryOld();
      return;
    }
    AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
    try {
      VirtualFile file=HistoryRootType.getInstance().findFile(null,getHistoryName(myRootType,myId),ScratchFileService.Option.create_if_missing);
      VfsUtil.saveText(file,StringUtil.join(getModel().getHistory(),myRootType.getEntrySeparator()));
    }
  finally {
      token.finish();
    }
  }
 catch (  Exception ex) {
    LOG.error(ex);
  }
}
