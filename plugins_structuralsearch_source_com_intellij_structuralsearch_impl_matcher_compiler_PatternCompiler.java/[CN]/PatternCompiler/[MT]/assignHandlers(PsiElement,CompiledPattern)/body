{
  root.accept(new PsiRecursiveElementWalkingVisitor(){
    @Override public void visitElement(    PsiElement element){
      super.visitElement(element);
      if (element.getUserData(ALTERNATIVE_PATTERN_ROOTS) != null) {
        final MatchingHandler handler=pattern.getHandler(element);
        pattern.setHandler(element,new CompositeHandler(handler));
      }
    }
  }
);
}
