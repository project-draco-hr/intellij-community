{
  try {
    onStart(command);
    boolean repeat=true;
    CommandExecutor executor=null;
    while (repeat) {
      executor=newExecutor(command);
      executor.run();
      repeat=onAfterCommand(executor,command);
    }
    return executor;
  }
  finally {
    onFinish();
  }
}
