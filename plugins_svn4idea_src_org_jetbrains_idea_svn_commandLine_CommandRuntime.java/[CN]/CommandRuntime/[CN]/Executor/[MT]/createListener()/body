{
  return new LineCommandAdapter(){
    @Override public void onLineAvailable(    String line,    Key outputType){
      if (LOG.isDebugEnabled()) {
        LOG.debug("==> " + line);
      }
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        System.out.println("==> " + line);
      }
      myListener.onLineAvailable(line,outputType);
      if (myListener.isCanceled()) {
        LOG.info("Cancelling command: " + myCommand.getCommandText());
        myCommand.destroyProcess();
      }
    }
    @Override public void processTerminated(    int exitCode){
      myListener.processTerminated(exitCode);
      myCommand.setExitCodeReference(exitCode);
    }
    @Override public void startFailed(    Throwable exception){
      myListener.startFailed(exception);
      myExceptionRef.set(exception);
    }
  }
;
}
