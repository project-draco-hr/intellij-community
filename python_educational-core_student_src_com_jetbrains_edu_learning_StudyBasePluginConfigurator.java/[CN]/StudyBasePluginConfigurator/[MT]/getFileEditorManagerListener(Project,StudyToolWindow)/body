{
  return new FileEditorManagerListener(){
    @Override public void fileOpened(    @NotNull FileEditorManager source,    @NotNull VirtualFile file){
      Task task=getTask(file);
      setTaskText(task,file.getParent());
    }
    @Override public void fileClosed(    @NotNull FileEditorManager source,    @NotNull VirtualFile file){
      for (      VirtualFile openedFile : source.getOpenFiles()) {
        if (StudyUtils.getTaskFile(project,openedFile) != null) {
          return;
        }
      }
      toolWindow.setEmptyText(project);
    }
    @Override public void selectionChanged(    @NotNull FileEditorManagerEvent event){
      VirtualFile file=event.getNewFile();
      if (file != null) {
        Task task=getTask(file);
        setTaskText(task,file.getParent());
      }
      toolWindow.setBottomComponent(null);
    }
    @Nullable private Task getTask(    @NotNull VirtualFile file){
      TaskFile taskFile=StudyUtils.getTaskFile(project,file);
      if (taskFile != null) {
        return taskFile.getTask();
      }
 else {
        return null;
      }
    }
    private void setTaskText(    @Nullable final Task task,    @Nullable final VirtualFile taskDirectory){
      String text=StudyUtils.getTaskTextFromTask(taskDirectory,task);
      if (text == null) {
        toolWindow.setEmptyText(project);
        return;
      }
      toolWindow.setTaskText(text,taskDirectory,project);
    }
  }
;
}
