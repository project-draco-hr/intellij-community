{
  if (type != null) {
    final Substring typeSub=myOriginalDocString.getParamTypeSubstring(name);
    if (typeSub != null) {
      replace(typeSub.getTextRange(),type);
      return;
    }
    final Substring nameSub=ContainerUtil.find(myOriginalDocString.getParameterSubstrings(),new Condition<Substring>(){
      @Override public boolean value(      Substring substring){
        return substring.toString().equals(name);
      }
    }
);
    if (nameSub != null) {
      updateParamDeclarationWithType(nameSub,type);
      return;
    }
  }
  final Section paramSection=findFirstParametersSection();
  if (paramSection != null) {
    final List<SectionField> fields=paramSection.getFields();
    if (!fields.isEmpty()) {
      final SectionField firstField=fields.get(0);
      final String newLine=createParamLine(name,type,getSectionIndent(paramSection),getFieldIndent(paramSection,firstField));
      insertBeforeLine(getFieldStartLine(firstField),newLine);
    }
 else {
      final String newLine=createParamLine(name,type,getSectionIndent(paramSection),getExpectedFieldIndent());
      insertAfterLine(getSectionLastTitleLine(paramSection),newLine);
    }
  }
 else {
    final int line=findLastNonEmptyLine();
    final String newSection=createBuilder().withSectionIndent(getExpectedFieldIndent()).addEmptyLine().startParametersSection().addParameter(name,type,"").buildContent(getExpectedSectionIndent(),true);
    insertAfterLine(line,newSection);
  }
}
