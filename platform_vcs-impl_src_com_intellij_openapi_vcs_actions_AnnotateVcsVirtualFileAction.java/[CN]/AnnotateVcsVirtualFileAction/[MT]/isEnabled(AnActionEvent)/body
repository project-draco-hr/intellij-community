{
  Project project=e.getData(CommonDataKeys.PROJECT);
  if (project == null || project.isDisposed())   return false;
  VirtualFile[] selectedFiles=e.getData(CommonDataKeys.VIRTUAL_FILE_ARRAY);
  if (selectedFiles == null || selectedFiles.length != 1)   return false;
  VirtualFile file=selectedFiles[0];
  if (file.isDirectory() || file.getFileType().isBinary())   return false;
  if (getEditors(project,file).isEmpty())   return false;
  AnnotationData data=extractData(project,file);
  if (data == null)   return false;
  AnnotationProvider provider=data.vcs.getAnnotationProvider();
  return provider instanceof AnnotationProviderEx;
}
