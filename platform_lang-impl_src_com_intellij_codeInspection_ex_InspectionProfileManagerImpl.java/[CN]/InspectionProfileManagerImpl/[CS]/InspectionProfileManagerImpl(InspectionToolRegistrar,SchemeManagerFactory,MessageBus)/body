{
  myRegistrar=registrar;
  registerProvidedSeverities();
  mySchemeManager=schemeManagerFactory.create(INSPECTION_DIR,new LazySchemeProcessor<Profile,InspectionProfileImpl>(){
    @NotNull public InspectionProfileImpl createScheme(    @NotNull SchemeDataHolder dataHolder,    @NotNull Function<String,String> attributeProvider,    boolean duringLoad){
      String profileName=ObjectUtils.chooseNotNull(attributeProvider.apply(InspectionProfileLoadUtil.PROFILE_NAME_TAG),"unnamed");
      return new InspectionProfileImpl(profileName,myRegistrar,InspectionProfileManagerImpl.this,getDefaultProfile(),dataHolder);
    }
    @NotNull @Override public SchemeState getState(    @NotNull Profile scheme){
      return !(scheme instanceof InspectionProfileImpl) || scheme.isProjectLevel() ? SchemeState.NON_PERSISTENT : ((InspectionProfileImpl)scheme).wasInitialized() ? SchemeState.POSSIBLY_CHANGED : SchemeState.UNCHANGED;
    }
    @NotNull @Override public Element writeScheme(    @NotNull InspectionProfileImpl scheme){
      Element root=new Element("inspections");
      root.setAttribute("profile_name",scheme.getName());
      scheme.serializeInto(root,false);
      return root;
    }
    @Override public void onSchemeAdded(    @NotNull final InspectionProfileImpl scheme){
      updateProfileImpl(scheme);
      fireProfileChanged(scheme);
      onProfilesChanged();
    }
    @Override public void onSchemeDeleted(    @NotNull final InspectionProfileImpl scheme){
      onProfilesChanged();
    }
    @Override public void onCurrentSchemeChanged(    @Nullable Scheme oldScheme){
      Profile current=mySchemeManager.getCurrentScheme();
      if (current != null) {
        fireProfileChanged((Profile)oldScheme,current,null);
      }
      onProfilesChanged();
    }
  }
);
  mySeverityRegistrar=new SeverityRegistrar(messageBus);
}
