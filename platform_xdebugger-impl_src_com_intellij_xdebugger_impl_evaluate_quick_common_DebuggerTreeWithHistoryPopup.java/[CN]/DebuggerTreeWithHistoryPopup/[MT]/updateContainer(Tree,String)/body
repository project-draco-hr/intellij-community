{
  if (myPopup != null) {
    myPopup.cancel();
  }
  tree.getModel().addTreeModelListener(createTreeListener(tree));
  myPopup=JBPopupFactory.getInstance().createComponentPopupBuilder(createMainPanel(tree),tree).setRequestFocus(true).setTitle(title).setResizable(true).setMovable(true).setDimensionServiceKey(myProject,DIMENSION_SERVICE_KEY,false).setMayBeParent(true).setCancelCallback(new Computable<Boolean>(){
    @Override public Boolean compute(){
      Window parent=SwingUtilities.getWindowAncestor(tree);
      if (parent != null) {
        for (        Window child : parent.getOwnedWindows()) {
          if (child.isShowing()) {
            return false;
          }
        }
      }
      return true;
    }
  }
).createPopup();
  if (tree instanceof Disposable) {
    Disposer.register(myPopup,(Disposable)tree);
  }
  if (myEditor.getComponent().getRootPane() == null) {
    myPopup.cancel();
    return;
  }
  myPopup.show(new RelativePoint(myEditor.getContentComponent(),myPoint));
  updateInitialBounds(tree);
}
