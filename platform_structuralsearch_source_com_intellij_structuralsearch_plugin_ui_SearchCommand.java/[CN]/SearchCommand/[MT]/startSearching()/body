{
  final UsageViewContext context=createUsageViewContext();
  final UsageViewPresentation presentation=new UsageViewPresentation();
  presentation.setOpenInNewTab(FindSettings.getInstance().isShowResultsInSeparateView());
  context.configure(presentation);
  final FindUsagesProcessPresentation processPresentation=new FindUsagesProcessPresentation(presentation);
  processPresentation.setShowNotFoundMessage(true);
  processPresentation.setShowPanelIfOnlyOneUsage(true);
  processPresentation.setProgressIndicatorFactory(new Factory<ProgressIndicator>(){
    @Override public ProgressIndicator create(){
      FindProgressIndicator indicator=new FindProgressIndicator(mySearchContext.getProject(),presentation.getScopeText());
      indicator.addStateDelegate(new AbstractProgressIndicatorExBase(){
        @Override public void cancel(){
          super.cancel();
          stopAsyncSearch();
        }
      }
);
      return indicator;
    }
  }
);
  PsiDocumentManager.getInstance(mySearchContext.getProject()).commitAllDocuments();
  final ConfigurableUsageTarget target=context.getTarget();
  ((FindManagerImpl)FindManager.getInstance(mySearchContext.getProject())).getFindUsagesManager().addToHistory(target);
  UsageViewManager.getInstance(mySearchContext.getProject()).searchAndShowUsages(new UsageTarget[]{target},new Factory<UsageSearcher>(){
    @Override public UsageSearcher create(){
      return new UsageSearcher(){
        @Override public void generate(        @NotNull final Processor<Usage> processor){
          findUsages(processor);
        }
      }
;
    }
  }
,processPresentation,presentation,new UsageViewManager.UsageViewStateListener(){
    @Override public void usageViewCreated(    @NotNull UsageView usageView){
      context.setUsageView(usageView);
      context.configureActions();
    }
    @Override public void findingUsagesFinished(    final UsageView usageView){
    }
  }
);
}
