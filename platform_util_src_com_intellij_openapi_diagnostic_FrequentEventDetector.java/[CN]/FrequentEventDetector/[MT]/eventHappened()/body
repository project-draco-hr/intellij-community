{
  if (myEventsPosted.incrementAndGet() > myEventCountThreshold) {
    boolean shouldLog=false;
synchronized (myEventsPosted) {
      if (myEventsPosted.get() > myEventCountThreshold) {
        long timeNow=System.currentTimeMillis();
        shouldLog=timeNow - myStartedCounting < myTimeSpanMs;
        myEventsPosted.set(0);
        myStartedCounting=timeNow;
      }
    }
    if (shouldLog) {
      String trace=ExceptionUtil.getThrowableText(new Throwable());
      boolean logTrace;
synchronized (myEventsPosted) {
        logTrace=myRecentTraces.put(trace,trace) == null;
      }
      String message="Too many events posted" + (logTrace ? "\n" + trace : "");
      if (myLevel == Level.INFO) {
        LOG.info(message);
      }
 else       if (myLevel == Level.WARN) {
        LOG.warn(message);
      }
 else {
        LOG.error(message);
      }
    }
  }
}
