{
  File projectPath=copyProjectBeforeOpening(projectDirName);
  updateLocalProperties(projectPath);
  if (forOpen) {
    File toDotIdea=new File(projectPath,Project.DIRECTORY_STORE_FOLDER);
    ensureExists(toDotIdea);
    File fromDotIdea=new File(getTestProjectsRootDirPath(),join("commonFiles",Project.DIRECTORY_STORE_FOLDER));
    assertThat(fromDotIdea).isDirectory();
    for (    File from : notNullize(fromDotIdea.listFiles())) {
      if (from.isDirectory()) {
        File destination=new File(toDotIdea,from.getName());
        if (!destination.isDirectory()) {
          copyDirContent(from,destination);
        }
        continue;
      }
      File to=new File(toDotIdea,from.getName());
      if (!to.isFile()) {
        copy(from,to);
      }
    }
  }
 else {
    cleanUpProjectForImport(projectPath);
  }
  return projectPath;
}
