{
  final GrExpression qualifier=refExpr.getQualifier();
  if (!(resolved instanceof PsiClass) && !(resolved instanceof PsiPackage)) {
    if (qualifier == null) {
      return TypeInferenceHelper.getCurrentContext().getVariableType(refExpr);
    }
 else {
      PsiType qType=qualifier.getType();
      if (qType instanceof PsiClassType && !(qType instanceof GrMapType)) {
        final PsiType mapValueType=getTypeFromMapAccess(refExpr);
        if (mapValueType != null) {
          return mapValueType;
        }
      }
    }
  }
  return null;
}
