{
  FontMetrics fontMetrics=((EditorImpl)myEditor).getFontMetrics(Font.PLAIN);
  DocumentEx document=myEditor.getDocument();
  Insets insets=getInsets();
  int maxLineWidth=getWidth() - (insets != null ? insets.left + insets.right : 0);
  myDocumentTextBuilder.setLength(0);
  if (getHeight() / myEditor.getLineHeight() < 1.1f) {
    String line=document.getText().replace('\n',RETURN_SYMBOL);
    appendAbbreviatedLine(myDocumentTextBuilder,line,fontMetrics,maxLineWidth);
  }
 else {
    for (LineIterator line=document.createLineIterator(); !line.atEnd(); line.advance()) {
      String lineText=document.getText(new TextRange(line.getStart(),line.getEnd()));
      appendAbbreviatedLine(myDocumentTextBuilder,lineText,fontMetrics,maxLineWidth);
    }
  }
  setText(myDocumentTextBuilder.toString(),true);
}
