{
  FontMetrics fontMetrics=((EditorImpl)myEditor).getFontMetrics(Font.PLAIN);
  Insets insets=getInsets();
  int maxLineWidth=getWidth() - (insets != null ? insets.left + insets.right : 0);
  myDocumentTextBuilder.setLength(0);
  DocumentEx document=myEditor.getDocument();
  for (LineIterator line=document.createLineIterator(); !line.atEnd(); line.advance()) {
    String lineText=document.getText(new TextRange(line.getStart(),line.getEnd()));
    appendAbbreviatedLine(myDocumentTextBuilder,lineText,fontMetrics,maxLineWidth);
  }
  setText(myDocumentTextBuilder.toString(),false);
}
