{
  if (metrics.charWidth('m') * line.length() <= maxWidth) {
    to.append(line);
    return;
  }
  int abbrWidth=metrics.stringWidth(ABBREVIATION_SUFFIX);
  int abbrIdx=0;
  for (; abbrIdx < line.length(); abbrIdx++) {
    int nextCharWidth=metrics.charWidth(line.charAt(abbrIdx));
    if (abbrWidth + nextCharWidth >= maxWidth)     break;
    abbrWidth+=nextCharWidth;
  }
  to.append(line,0,abbrIdx);
  to.append(ABBREVIATION_SUFFIX);
  if (abbrIdx != line.length() && line.endsWith("\n")) {
    to.append('\n');
  }
}
