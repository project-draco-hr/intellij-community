{
  int maxLineLength=0;
  int linesCount=0;
  Matcher m=LINE_PATTERN.matcher(myRawText);
  while (m.find()) {
    maxLineLength=Math.max(maxLineLength,m.end(1) - m.start());
    linesCount++;
  }
  FontMetrics fontMetrics=((EditorImpl)myEditor).getFontMetrics(myTextAttributes != null ? myTextAttributes.getFontType() : Font.PLAIN);
  int preferredHeight=myEditor.getLineHeight() * Math.max(1,linesCount);
  int preferredWidth=fontMetrics.charWidth('m') * maxLineLength;
  Insets insets=getInsets();
  if (insets != null) {
    preferredHeight+=insets.top + insets.bottom;
    preferredWidth+=insets.left + insets.right;
  }
  myPreferredSize=new Dimension(preferredWidth,preferredHeight);
}
