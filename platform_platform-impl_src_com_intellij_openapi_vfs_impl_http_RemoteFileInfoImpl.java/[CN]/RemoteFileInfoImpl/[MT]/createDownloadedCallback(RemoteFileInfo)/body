{
  final AsyncPromise<VirtualFile> promise=new AsyncPromise<VirtualFile>();
  remoteFileInfo.addDownloadingListener(new FileDownloadingAdapter(){
    @Override public void fileDownloaded(    VirtualFile localFile){
      try {
        remoteFileInfo.removeDownloadingListener(this);
      }
  finally {
        promise.setResult(localFile);
      }
    }
    @Override public void errorOccurred(    @NotNull String errorMessage){
      try {
        remoteFileInfo.removeDownloadingListener(this);
      }
  finally {
        promise.setError(Promise.createError(errorMessage));
      }
    }
    @Override public void downloadingCancelled(){
      try {
        remoteFileInfo.removeDownloadingListener(this);
      }
  finally {
        promise.setError(Promise.createError("Cancelled"));
      }
    }
  }
);
  return promise;
}
