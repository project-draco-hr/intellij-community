{
synchronized (myLock) {
switch (getState()) {
case DOWNLOADING_NOT_STARTED:
      startDownloading();
    return createDownloadedCallback(this);
case DOWNLOADING_IN_PROGRESS:
  return createDownloadedCallback(this);
case DOWNLOADED:
return Promise.resolve(myLocalVirtualFile);
case ERROR_OCCURRED:
default :
return rejectedPromise("errorOccurred");
}
}
}
