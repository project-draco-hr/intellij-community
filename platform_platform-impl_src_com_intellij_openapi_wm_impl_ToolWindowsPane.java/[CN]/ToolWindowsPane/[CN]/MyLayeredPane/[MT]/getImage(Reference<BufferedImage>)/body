{
  LOG.assertTrue(UISettings.getInstance().ANIMATE_WINDOWS);
  BufferedImage image=SoftReference.dereference(imageRef);
  if (image == null || image.getWidth(null) < getWidth() || image.getHeight(null) < getHeight()) {
    final int width=Math.max(Math.max(1,getWidth()),myFrame.getWidth());
    final int height=Math.max(Math.max(1,getHeight()),myFrame.getHeight());
    if (SystemInfo.isWindows) {
      image=myFrame.getGraphicsConfiguration().createCompatibleImage(width,height);
    }
 else {
      image=UIUtil.createImage(width,height,BufferedImage.TYPE_INT_RGB);
    }
    imageRef=new SoftReference<>(image);
  }
  return Pair.create(image,imageRef);
}
