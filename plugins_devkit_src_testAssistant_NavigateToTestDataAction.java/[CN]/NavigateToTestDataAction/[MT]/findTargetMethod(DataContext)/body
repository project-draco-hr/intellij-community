{
  final Location<?> location=Location.DATA_KEY.getData(context);
  if (location != null) {
    final PsiElement element=location.getPsiElement();
    PsiMethod method=PsiTreeUtil.getParentOfType(element,PsiMethod.class,false);
    if (method != null) {
      return method;
    }
  }
  final Editor editor=CommonDataKeys.EDITOR.getData(context);
  final PsiFile file=CommonDataKeys.PSI_FILE.getData(context);
  if (file != null && editor != null) {
    PsiElement element=file.findElementAt(editor.getCaretModel().getOffset());
    return PsiTreeUtil.getParentOfType(element,PsiMethod.class);
  }
  return null;
}
