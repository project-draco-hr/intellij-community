{
  String text;
  if (matchedNode instanceof PsiReferenceExpression && ((PsiReferenceExpression)matchedNode).getQualifierExpression() != null) {
    final PsiElement element=((PsiReferenceExpression)matchedNode).resolve();
    if (element instanceof PsiClass)     return matchedNode.getText();
    final PsiElement referencedElement=((PsiReferenceExpression)matchedNode).getReferenceNameElement();
    text=referencedElement != null ? referencedElement.getText() : "";
    if (element == null && text.length() > 0 && Character.isUpperCase(text.charAt(0))) {
      return matchedNode.getText();
    }
  }
 else   if (matchedNode instanceof PsiLiteralExpression) {
    text=matchedNode.getText();
  }
 else   if (matchedNode instanceof XmlAttributeValue) {
    text=matchedNode.getText();
  }
 else {
    text=SubstitutionHandler.getTypedVarString(matchedNode);
  }
  return text;
}
