{
  List<String> plugins=new ArrayList<String>();
  for (  IdeaPluginDescriptor descriptor : PluginManagerCore.getPlugins()) {
    if (!descriptor.isBundled() && descriptor.isEnabled()) {
      plugins.add(descriptor.getPluginId().getIdString());
    }
  }
  if (plugins.isEmpty()) {
    return;
  }
  ZipEntry e=new ZipEntry(PluginManager.INSTALLED_TXT);
  zipOut.putNextEntry(e);
  zipOut.ignoreClose=true;
  try {
    PluginManagerCore.writePluginsList(plugins,new OutputStreamWriter(zipOut,CharsetToolkit.UTF8_CHARSET));
  }
  finally {
    zipOut.ignoreClose=false;
    zipOut.closeEntry();
  }
}
