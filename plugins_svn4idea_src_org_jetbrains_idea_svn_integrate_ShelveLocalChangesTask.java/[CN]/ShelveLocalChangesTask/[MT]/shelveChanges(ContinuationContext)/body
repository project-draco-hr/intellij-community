{
  List<VirtualFile> changedFiles=newArrayList();
  ShelveChangesManager shelveManager=ShelveChangesManager.getInstance(myMergeContext.getProject());
  for (  Map.Entry<String,Collection<Change>> entry : myIntersection.getChangesSubset().entrySet()) {
    try {
      saveAllDocuments();
      shelveManager.shelveChanges(entry.getValue(),myIntersection.getComment(entry.getKey()) + " (auto shelve before merge)",true,true);
      changedFiles.addAll(getAfterRevisionsFiles(entry.getValue().stream(),true).collect(toList()));
    }
 catch (    IOException e) {
      end(context,new VcsException(e));
    }
catch (    VcsException e) {
      end(context,e);
    }
  }
  return changedFiles;
}
