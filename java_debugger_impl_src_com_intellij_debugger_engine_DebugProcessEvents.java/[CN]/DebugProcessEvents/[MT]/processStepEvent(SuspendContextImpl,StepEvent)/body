{
  final ThreadReference thread=event.thread();
  preprocessEvent(suspendContext,thread);
  RequestHint hint=(RequestHint)event.request().getProperty("hint");
  deleteStepRequests(event.thread());
  boolean shouldResume=false;
  final Project project=getProject();
  if (hint != null) {
    final int nextStepDepth=hint.getNextStepDepth(suspendContext);
    if (nextStepDepth == RequestHint.RESUME) {
      shouldResume=true;
    }
 else     if (nextStepDepth != RequestHint.STOP) {
      final ThreadReferenceProxyImpl threadProxy=suspendContext.getThread();
      doStep(suspendContext,threadProxy,hint.getSize(),nextStepDepth,hint);
      shouldResume=true;
    }
    if (!shouldResume && hint.isRestoreBreakpoints()) {
      DebuggerManagerEx.getInstanceEx(project).getBreakpointManager().enableBreakpoints(this);
    }
  }
  if (shouldResume) {
    getSuspendManager().voteResume(suspendContext);
  }
 else {
    showStatusText("");
    if (myReturnValueWatcher != null) {
      myReturnValueWatcher.disable();
    }
    getSuspendManager().voteSuspend(suspendContext);
    if (hint != null) {
      final MethodFilter methodFilter=hint.getMethodFilter();
      if (methodFilter instanceof NamedMethodFilter && !hint.wasStepTargetMethodMatched()) {
        final String message="Method <b>" + ((NamedMethodFilter)methodFilter).getMethodName() + "()</b> has not been called";
        XDebugSessionImpl.NOTIFICATION_GROUP.createNotification(message,MessageType.INFO).notify(project);
      }
      if (hint.wasStepTargetMethodMatched() && hint.isResetIgnoreFilters()) {
        List<ClassFilter> activeFilters=getActiveFilters();
        String currentClassName=getCurrentClassName(suspendContext.getThread());
        if (currentClassName == null || !DebuggerUtilsEx.isFiltered(currentClassName,activeFilters)) {
          mySession.resetIgnoreStepFiltersFlag();
        }
      }
    }
  }
}
