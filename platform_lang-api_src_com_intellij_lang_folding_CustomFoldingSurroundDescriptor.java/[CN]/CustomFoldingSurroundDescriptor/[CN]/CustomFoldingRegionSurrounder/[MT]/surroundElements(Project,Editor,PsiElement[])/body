{
  if (elements.length == 0)   return null;
  PsiElement firstElement=elements[0];
  PsiElement lastElement=elements[elements.length - 1];
  PsiFile psiFile=firstElement.getContainingFile();
  Language language=psiFile.getLanguage();
  Commenter commenter=LanguageCommenters.INSTANCE.forLanguage(language);
  if (commenter == null)   return null;
  String linePrefix=commenter.getLineCommentPrefix();
  if (linePrefix == null)   return null;
  int prefixLength=linePrefix.length();
  int startOffset=firstElement.getTextRange().getStartOffset();
  final Document document=editor.getDocument();
  int endOffset=lastElement.getTextRange().getEndOffset();
  int delta=0;
  TextRange rangeToSelect=new TextRange(startOffset,startOffset);
  String startText=myProvider.getStartString();
  int descPos=startText.indexOf("?");
  if (descPos >= 0) {
    startText=startText.replace("?",DEFAULT_DESC_TEXT);
    rangeToSelect=new TextRange(startOffset + descPos,startOffset + descPos + DEFAULT_DESC_TEXT.length());
  }
  String startString=linePrefix + startText + "\n";
  String endString="\n" + linePrefix + myProvider.getEndString();
  document.insertString(endOffset,endString);
  delta+=endString.length();
  final int startCommentInsertionOffset=document.getLineStartOffset(document.getLineNumber(startOffset));
  document.insertString(startCommentInsertionOffset,startString);
  delta+=startString.length();
  rangeToSelect=rangeToSelect.shiftRight(prefixLength);
  PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
  documentManager.commitDocument(documentManager.getDocument(psiFile));
  adjustLineIndent(project,psiFile,language,new TextRange(endOffset + delta - endString.length(),endOffset + delta));
  adjustLineIndent(project,psiFile,language,new TextRange(startCommentInsertionOffset,startCommentInsertionOffset + startString.length()));
  return rangeToSelect;
}
