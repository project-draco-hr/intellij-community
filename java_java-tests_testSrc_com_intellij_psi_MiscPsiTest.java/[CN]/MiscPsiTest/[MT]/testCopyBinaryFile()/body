{
  VirtualFile vFile=myRoot.createChildData(null,"Test.xxx");
  final byte[] bytes=new byte[]{12,34,56,78,90,45,83,0x22,(byte)0xff,(byte)0xff,(byte)0xff,(byte)0xee};
  vFile.setBinaryContent(bytes);
  VirtualFile vDir=myRoot.createChildDirectory(null,"dir");
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  PsiFile file=myPsiManager.findFile(vFile);
  assertTrue(file instanceof PsiBinaryFile);
  PsiDirectory dir=myPsiManager.findDirectory(vDir);
  PsiFile fileCopy=(PsiFile)file.copy();
  fileCopy=(PsiFile)fileCopy.setName("NewTest.xxx");
  PsiFile newFile=(PsiFile)dir.add(fileCopy);
  assertTrue(newFile instanceof PsiBinaryFile);
  assertOrderedEquals(newFile.getVirtualFile().contentsToByteArray(),bytes);
}
