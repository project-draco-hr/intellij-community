{
  String text="1234567890";
  VirtualFile vFile=myFixture.addFileToProject("Test.xxx",text).getVirtualFile();
  VirtualFile vDir=myFixture.getTempDirFixture().findOrCreateDir("dir");
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  PsiFile file=getPsiManager().findFile(vFile);
  PsiDirectory dir=getPsiManager().findDirectory(vDir);
  PsiFile fileCopy=(PsiFile)file.copy();
  fileCopy=(PsiFile)fileCopy.setName("NewTest.txt");
  PsiFile newFile=(PsiFile)dir.add(fileCopy);
  assertTrue(newFile instanceof PsiPlainTextFile);
  assertEquals(text,VfsUtil.loadText(newFile.getVirtualFile()));
  assertEquals(newFile.getVirtualFile().getModificationStamp(),newFile.getViewProvider().getModificationStamp());
  assertFalse(FileDocumentManager.getInstance().isFileModified(newFile.getVirtualFile()));
}
