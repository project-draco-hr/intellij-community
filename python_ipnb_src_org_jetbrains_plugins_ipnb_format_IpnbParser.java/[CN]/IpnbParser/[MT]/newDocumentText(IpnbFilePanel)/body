{
  final IpnbFile ipnbFile=ipnbPanel.getIpnbFile();
  if (ipnbFile == null)   return null;
  for (  IpnbEditablePanel panel : ipnbPanel.getIpnbPanels()) {
    if (panel.isModified()) {
      panel.updateCellSource();
    }
  }
  final IpnbFileRaw fileRaw=ipnbFile.getRawFile();
  final IpnbWorksheet worksheet=new IpnbWorksheet();
  for (  IpnbCell cell : ipnbFile.getCells()) {
    worksheet.cells.add(IpnbCellRaw.fromCell(cell));
  }
  fileRaw.worksheets=new IpnbWorksheet[]{worksheet};
  return gson.toJson(fileRaw);
}
