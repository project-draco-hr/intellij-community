{
  final String path=virtualFile.getPath();
  IpnbFileRaw rawFile=gson.fromJson(fileText.toString(),IpnbFileRaw.class);
  if (rawFile == null) {
    final IpnbFileRaw ipnbFileRaw=new IpnbFileRaw();
    if (!isIpythonNewFormat(virtualFile)) {
      ipnbFileRaw.nbformat=3;
    }
    return new IpnbFile(ipnbFileRaw,Lists.<IpnbCell>newArrayList(),path);
  }
  List<IpnbCell> cells=new ArrayList<IpnbCell>();
  final IpnbWorksheet[] worksheets=rawFile.worksheets;
  if (worksheets == null) {
    for (    IpnbCellRaw rawCell : rawFile.cells) {
      cells.add(rawCell.createCell());
    }
  }
 else {
    for (    IpnbWorksheet worksheet : worksheets) {
      final List<IpnbCellRaw> rawCells=worksheet.cells;
      for (      IpnbCellRaw rawCell : rawCells) {
        cells.add(rawCell.createCell());
      }
    }
  }
  return new IpnbFile(rawFile,cells,path);
}
