{
  try {
    myProgress.setIndeterminate(true);
    myProgress.setText("Scanning indexed files...");
    final Set<PsiFile> filesForFastWordSearch=getFilesForFastWordSearch();
    myProgress.setIndeterminate(false);
    searchInFiles(consumer,processPresentation,filesForFastWordSearch);
    myProgress.setIndeterminate(true);
    myProgress.setText("Scanning non-indexed files...");
    boolean skipIndexed=canRelyOnIndices();
    final Collection<PsiFile> otherFiles=collectFilesInScope(filesForFastWordSearch,skipIndexed);
    myProgress.setIndeterminate(false);
    long start=System.currentTimeMillis();
    searchInFiles(consumer,processPresentation,otherFiles);
    if (skipIndexed && otherFiles.size() > 1000) {
      logStats(otherFiles,start);
    }
  }
 catch (  ProcessCanceledException e) {
  }
  if (!myLargeFiles.isEmpty()) {
    processPresentation.setLargeFilesWereNotScanned(myLargeFiles);
  }
  if (!myProgress.isCanceled()) {
    myProgress.setText(FindBundle.message("find.progress.search.completed"));
  }
}
