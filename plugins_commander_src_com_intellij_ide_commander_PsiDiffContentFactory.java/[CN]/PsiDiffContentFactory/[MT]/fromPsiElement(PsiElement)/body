{
  if (psiElement instanceof PsiFile) {
    return DiffContentFactory.create(psiElement.getProject(),((PsiFile)psiElement).getVirtualFile());
  }
 else   if (psiElement instanceof PsiDirectory) {
    return DiffContentFactory.create(psiElement.getProject(),((PsiDirectory)psiElement).getVirtualFile());
  }
  PsiFile containingFile=psiElement.getContainingFile();
  if (containingFile == null) {
    String text=psiElement.getText();
    if (text == null)     return null;
    return DiffContentFactory.create(text,psiElement.getLanguage().getAssociatedFileType());
  }
  DocumentContent wholeFileContent=DiffContentFactory.createDocument(psiElement.getProject(),containingFile.getVirtualFile());
  if (wholeFileContent == null)   return null;
  return new DocumentFragmentContent(psiElement.getProject(),wholeFileContent,psiElement.getTextRange());
}
