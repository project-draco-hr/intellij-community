{
  final AntBuildFile buildFile=getCurrentBuildFile();
  if (buildFile == null || !buildFile.exists()) {
    return;
  }
  TreePath selectionPath=myTree.getSelectionPath();
  if (selectionPath == null)   return;
  final DefaultMutableTreeNode node=(DefaultMutableTreeNode)selectionPath.getLastPathComponent();
  final Object userObject=node.getUserObject();
  AntBuildTarget target=null;
  if (userObject instanceof AntTargetNodeDescriptor) {
    AntTargetNodeDescriptor targetNodeDescriptor=(AntTargetNodeDescriptor)userObject;
    target=targetNodeDescriptor.getTarget();
  }
 else   if (userObject instanceof AntBuildFileNodeDescriptor) {
    AntBuildModel model=((AntBuildFileNodeDescriptor)userObject).getBuildFile().getModel();
    target=model.findTarget(model.getDefaultTargetName());
  }
  String name=target != null ? target.getDisplayName() : null;
  if (target == null || name == null) {
    return;
  }
  RunManagerImpl runManager=(RunManagerImpl)RunManager.getInstance(e.getProject());
  RunnerAndConfigurationSettings settings=runManager.createRunConfiguration(name,AntRunConfigurationType.getInstance().getFactory());
  AntRunConfiguration configuration=(AntRunConfiguration)settings.getConfiguration();
  configuration.acceptSettings(target);
  if (RunDialog.editConfiguration(e.getProject(),settings,ExecutionBundle.message("create.run.configuration.for.item.dialog.title",configuration.getName()))) {
    runManager.addConfiguration(settings,runManager.isConfigurationShared(settings),runManager.getBeforeRunTasks(settings.getConfiguration()),false);
    runManager.setSelectedConfiguration(settings);
  }
}
