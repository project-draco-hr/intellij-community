{
  PsiType functionalInterfaceType=null;
  final Map<PsiMethodReferenceExpression,PsiType> map=PsiMethodReferenceUtil.ourRefs.get();
  if (map != null) {
    functionalInterfaceType=FunctionalInterfaceParameterizationUtil.getGroundTargetType(map.get(reference));
  }
  if (functionalInterfaceType == null) {
    functionalInterfaceType=reference.getFunctionalInterfaceType();
  }
  return functionalInterfaceType;
}
