{
  try {
    Element element=new Element("state");
    myLock.writeLock().lock();
    for (    Map.Entry<String,String> entry : myMacros.entrySet()) {
      String value=entry.getValue();
      if (!StringUtil.isEmptyOrSpaces(value)) {
        final Element macro=new Element(MACRO_ELEMENT);
        macro.setAttribute(NAME_ATTR,entry.getKey());
        macro.setAttribute(VALUE_ATTR,value);
        element.addContent(macro);
      }
    }
    for (    final String macro : myIgnoredMacros) {
      final Element macroElement=new Element(IGNORED_MACRO_ELEMENT);
      macroElement.setAttribute(NAME_ATTR,macro);
      element.addContent(macroElement);
    }
    return element;
  }
  finally {
    myLock.writeLock().unlock();
  }
}
