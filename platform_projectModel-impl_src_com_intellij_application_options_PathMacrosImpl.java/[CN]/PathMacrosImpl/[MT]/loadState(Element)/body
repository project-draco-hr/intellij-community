{
  try {
    myLock.writeLock().lock();
    for (    Element macro : element.getChildren(MACRO_ELEMENT)) {
      final String name=macro.getAttributeValue(NAME_ATTR);
      String value=macro.getAttributeValue(VALUE_ATTR);
      if (name == null || value == null) {
        continue;
      }
      if (SYSTEM_MACROS.contains(name)) {
        continue;
      }
      if (value.length() > 1 && value.charAt(value.length() - 1) == '/') {
        value=value.substring(0,value.length() - 1);
      }
      myMacros.put(name,value);
    }
    for (    Element macroElement : element.getChildren(IGNORED_MACRO_ELEMENT)) {
      String ignoredName=macroElement.getAttributeValue(NAME_ATTR);
      if (!StringUtil.isEmpty(ignoredName) && !myIgnoredMacros.contains(ignoredName)) {
        myIgnoredMacros.add(ignoredName);
      }
    }
  }
  finally {
    myModificationStamp++;
    myLock.writeLock().unlock();
  }
}
