{
  for (  String name : getUserMacroNames()) {
    String value=getValue(name);
    if (!StringUtil.isEmptyOrSpaces(value)) {
      result.addMacroExpand(name,value);
    }
  }
  myLock.readLock().lock();
  try {
    for (    Map.Entry<String,String> entry : myLegacyMacros.entrySet()) {
      result.addMacroExpand(entry.getKey(),entry.getValue());
    }
  }
  finally {
    myLock.readLock().unlock();
  }
}
