{
  final int oldCaretPosition=myReplaceTextComponent != null ? myReplaceTextComponent.getCaretPosition() : 0;
  String oldText=myReplaceTextComponent != null ? myReplaceTextComponent.getText() : myFindModel.getStringToReplace();
  if (!updateTextComponent(false)) {
    return;
  }
  if (oldText != null) {
    myReplaceTextComponent.setText(oldText);
  }
  myReplaceTextComponent.getDocument().addDocumentListener(new DocumentAdapter(){
    @Override protected void textChanged(    DocumentEvent e){
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          replaceFieldDocumentChanged();
        }
      }
);
    }
  }
);
  if (!getFindModel().isMultiline()) {
    new ReplaceOnEnterAction(this,myReplaceTextComponent);
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      myReplaceTextComponent.setCaretPosition(oldCaretPosition);
    }
  }
);
  new VariantsCompletionAction(myReplaceTextComponent);
  new NextOccurrenceAction(this,myReplaceFieldWrapper,false);
  new PrevOccurrenceAction(this,myReplaceFieldWrapper);
  myReplaceFieldWrapper.revalidate();
  myReplaceFieldWrapper.repaint();
}
