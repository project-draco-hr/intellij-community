{
  TaskManagerImpl taskManager=(TaskManagerImpl)TaskManager.getManager(myProject);
  taskManager.getState().markAsInProgress=isMarkAsInProgress();
  TaskManager.VcsOperation operation=getVcsOperation();
  taskManager.getState().vcsOperation=operation.ordinal();
  TaskRepository repository=myTask.getRepository();
  if (isMarkAsInProgress() && repository != null) {
    try {
      repository.setTaskState(myTask,TaskState.IN_PROGRESS);
    }
 catch (    Exception ex) {
      Messages.showErrorDialog(myProject,"Could not set state for " + myTask.getId(),"Error");
      LOG.warn(ex);
    }
  }
  LocalTask localTask=taskManager.activateTask(myTask,isClearContext());
  LocalTask activeTask=taskManager.getActiveTask();
  taskManager.activateInVcs(localTask,activeTask,operation,myBranchName.getText());
  if (myTask.getType() == TaskType.EXCEPTION && AnalyzeTaskStacktraceAction.hasTexts(myTask)) {
    AnalyzeTaskStacktraceAction.analyzeStacktrace(myTask,myProject);
  }
  super.doOKAction();
}
