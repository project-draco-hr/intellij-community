{
  XDebuggerEvaluator evaluator=stackFrame.getEvaluator();
  if (evaluator != null) {
    evaluator.evaluate(XExpressionImpl.fromText(sb.toString(),EvaluationMode.CODE_FRAGMENT),new XDebuggerEvaluator.XEvaluationCallback(){
      @Override public void evaluated(      @NotNull XValue result){
        debugProcess.getManagerThread().schedule(debugProcess.createPopFrameCommand(debuggerContext,stackFrame.getStackFrameProxy()));
      }
      @Override public void errorOccurred(      @NotNull final String errorMessage){
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            Messages.showMessageDialog(project,DebuggerBundle.message("error.executing.finally",errorMessage),UIUtil.removeMnemonic(ActionsBundle.actionText(DebuggerActions.POP_FRAME)),Messages.getErrorIcon());
          }
        }
);
      }
    }
,stackFrame.getSourcePosition());
  }
 else {
    Messages.showMessageDialog(project,XDebuggerBundle.message("xdebugger.evaluate.stack.frame.has.not.evaluator"),UIUtil.removeMnemonic(ActionsBundle.actionText(DebuggerActions.POP_FRAME)),Messages.getErrorIcon());
  }
}
