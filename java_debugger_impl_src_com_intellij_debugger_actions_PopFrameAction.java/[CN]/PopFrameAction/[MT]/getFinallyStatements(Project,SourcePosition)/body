{
  if (position == null) {
    return Collections.emptyList();
  }
  List<PsiStatement> res=new ArrayList<>();
  PsiElement element=position.getFile().findElementAt(position.getOffset());
  PsiTryStatement tryStatement=PsiTreeUtil.getParentOfType(element,PsiTryStatement.class);
  while (tryStatement != null) {
    PsiResourceList resourceList=tryStatement.getResourceList();
    if (resourceList != null) {
      PsiElementFactory factory=JavaPsiFacade.getInstance(project).getElementFactory();
      for (      PsiResourceListElement listElement : resourceList) {
        if (listElement instanceof PsiResourceVariable) {
          res.add(factory.createStatementFromText(((PsiResourceVariable)listElement).getName() + ".close();",tryStatement));
        }
      }
    }
    PsiCodeBlock finallyBlock=tryStatement.getFinallyBlock();
    if (finallyBlock != null) {
      ContainerUtil.addAll(res,finallyBlock.getStatements());
    }
    tryStatement=PsiTreeUtil.getParentOfType(tryStatement,PsiTryStatement.class);
  }
  return res;
}
