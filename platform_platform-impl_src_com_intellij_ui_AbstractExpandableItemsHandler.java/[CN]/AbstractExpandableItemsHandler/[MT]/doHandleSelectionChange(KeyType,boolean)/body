{
  Window window=SwingUtilities.getWindowAncestor(myComponent);
  if (selected == null || window == null || !window.isActive() || !myEnabled || !myComponent.isEnabled() || !myComponent.isShowing() || !myComponent.getVisibleRect().intersects(getVisibleRect(selected)) || !myComponent.isFocusOwner() && !processIfUnfocused || isPopup()) {
    hideHint();
    return;
  }
  if (!Comparing.equal(myKey,selected)) {
    hideHint();
  }
  myKey=selected;
  Point location=createToolTipImage(myKey);
  if (location == null) {
    hideHint();
  }
 else   if (myPopup == null) {
    myPopup=new OurHeavyWeightPopup(myComponent,myTipComponent,location.x,location.y);
    Window popupWindow=SwingUtilities.getWindowAncestor(myTipComponent);
    WindowManagerEx.getInstanceEx().setWindowShadow(popupWindow,WindowManagerEx.WindowShadowMode.DISABLED);
    myPopup.show();
    repaintKeyItem();
  }
 else {
    Dimension size=myTipComponent.getPreferredSize();
    Window popupWindow=SwingUtilities.getWindowAncestor(myTipComponent);
    popupWindow.setBounds(location.x,location.y,size.width,size.height);
    myTipComponent.repaint();
    repaintKeyItem();
  }
}
