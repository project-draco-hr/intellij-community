{
  File dir=createTempDirectory();
  VirtualFile vDir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(dir);
  VirtualFile vFile=vDir.createChildData(this,"test.xxxxxxxx");
  VfsUtil.saveText(vFile,"text");
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  assertEquals(PlainTextFileType.INSTANCE,vFile.getFileType());
  PsiFile psiFile=((PsiManagerEx)PsiManager.getInstance(getProject())).getFileManager().findFile(vFile);
  assertNotNull(psiFile);
  assertEquals(PlainTextFileType.INSTANCE,psiFile.getFileType());
}
