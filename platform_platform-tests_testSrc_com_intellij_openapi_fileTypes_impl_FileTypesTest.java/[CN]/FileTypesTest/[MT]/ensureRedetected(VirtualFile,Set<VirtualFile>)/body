{
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  log("T: ensureRedetected: commit. re-detect queue: " + myFileTypeManager.dumpReDetectQueue());
  UIUtil.dispatchAllInvocationEvents();
  log("T: ensureRedetected: dispatch. re-detect queue: " + myFileTypeManager.dumpReDetectQueue());
  myFileTypeManager.drainReDetectQueue();
  log("T: ensureRedetected: drain. re-detect queue: " + myFileTypeManager.dumpReDetectQueue());
  UIUtil.dispatchAllInvocationEvents();
  log("T: ensureRedetected: dispatch");
  FileType type=vFile.getFileType();
  log("T: ensureRedetected: getFileType (" + type.getName() + ")");
  assertTrue(detectorCalled.contains(vFile));
  detectorCalled.clear();
  log("T: ensureRedetected: clear");
}
