{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      myFileTypeManager.associatePattern(PlainTextFileType.INSTANCE,"*.fromPlugin");
    }
  }
);
  Element element=myFileTypeManager.getState();
  String s=JDOMUtil.writeElement(element);
  final AbstractFileType typeFromPlugin=new AbstractFileType(new SyntaxTable());
  PlatformTestUtil.registerExtension(FileTypeFactory.FILE_TYPE_FACTORY_EP,new FileTypeFactory(){
    @Override public void createFileTypes(    @NotNull FileTypeConsumer consumer){
      consumer.consume(typeFromPlugin,"fromPlugin");
    }
  }
,getTestRootDisposable());
  myFileTypeManager.initStandardFileTypes();
  myFileTypeManager.loadState(element);
  myFileTypeManager.initComponent();
  Map<FileNameMatcher,Pair<FileType,Boolean>> mappings=myFileTypeManager.getRemovedMappings();
  assertEquals(1,mappings.size());
  assertEquals(typeFromPlugin,mappings.values().iterator().next().first);
}
