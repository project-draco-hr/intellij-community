{
  myFileTypeManager.associatePattern(PlainTextFileType.INSTANCE,"*.fromPlugin");
  Element element=new Element("foo");
  myFileTypeManager.writeExternal(element);
  String s=JDOMUtil.writeElement(element);
  log(s);
  final AbstractFileType typeFromPlugin=new AbstractFileType(new SyntaxTable());
  PlatformTestUtil.registerExtension(FileTypeFactory.FILE_TYPE_FACTORY_EP,new FileTypeFactory(){
    @Override public void createFileTypes(    @NotNull FileTypeConsumer consumer){
      consumer.consume(typeFromPlugin,"fromPlugin");
    }
  }
,getTestRootDisposable());
  myFileTypeManager.initStandardFileTypes();
  myFileTypeManager.readExternal(element);
  myFileTypeManager.initComponent();
  Map<FileNameMatcher,Pair<FileType,Boolean>> mappings=myFileTypeManager.getRemovedMappings();
  assertEquals(1,mappings.size());
  assertEquals(typeFromPlugin,mappings.values().iterator().next().first);
}
