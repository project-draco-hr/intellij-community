{
  FileType propFileType=myFileTypeManager.getFileTypeByFileName("xx.properties");
  assertEquals("Properties",propFileType.getName());
  File file=createTempFile("xx.properties","xx=yy");
  VirtualFile vFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(file);
  assertEquals(propFileType,myFileTypeManager.getFileTypeByFile(vFile));
  rename(vFile,"xx.zxmcnbzmxnbc");
  UIUtil.dispatchAllInvocationEvents();
  assertEquals(PlainTextFileType.INSTANCE,myFileTypeManager.getFileTypeByFile(vFile));
  rename(vFile,"xx.properties");
  myFileTypeManager.drainReDetectQueue();
  for (int i=0; i < 100; i++) {
    PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
    UIUtil.dispatchAllInvocationEvents();
    assertEquals(propFileType,myFileTypeManager.getFileTypeByFile(vFile));
    assertEmpty(myFileTypeManager.dumpReDetectQueue());
  }
}
