{
  final Sdk sdk=PythonSdkType.findPythonSdk(ModuleUtilCore.findModuleForPsiElement(file));
  if (sdk == null)   return null;
  final String homePath=sdk.getHomePath();
  if (homePath == null)   return null;
  final InspectionProfile profile=InspectionProjectProfileManager.getInstance(file.getProject()).getInspectionProfile();
  final HighlightDisplayKey key=HighlightDisplayKey.find("PyPep8Inspection");
  if (!profile.isToolEnabled(key)) {
    return null;
  }
  return new State(homePath,file.getText(),profile.getErrorLevel(key,file));
}
