{
  DataInputStream stream=(DataInputStream)in;
  final ValueContainerImpl<T> valueContainer=new ValueContainerImpl<T>();
  while (stream.available() > 0) {
    final int valueCount=DataInputOutputUtil.readINT(in);
    if (valueCount < 0) {
      valueContainer.removeAssociatedValue(-valueCount);
      valueContainer.setNeedsCompacting(true);
    }
 else {
      for (int valueIdx=0; valueIdx < valueCount; valueIdx++) {
        final T value=myExternalizer.read(in);
        final int idCount=DataInputOutputUtil.readINT(in);
        valueContainer.ensureFileSetCapacityForValue(value,idCount);
        int prev=0;
        for (int i=0; i < idCount; i++) {
          final int id=DataInputOutputUtil.readINT(in);
          valueContainer.addValue(prev + id,value);
          prev+=id;
        }
      }
    }
  }
  return valueContainer;
}
