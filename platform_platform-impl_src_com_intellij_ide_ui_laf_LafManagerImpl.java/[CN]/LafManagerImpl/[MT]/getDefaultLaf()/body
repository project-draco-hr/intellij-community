{
  if (WelcomeWizardUtil.getWizardLAF() != null) {
    UIManager.LookAndFeelInfo laf=findLaf(WelcomeWizardUtil.getWizardLAF());
    LOG.assertTrue(laf != null);
    return laf;
  }
  final String systemLafClassName=UIManager.getSystemLookAndFeelClassName();
  if (SystemInfo.isMac) {
    String className=useIntelliJInsteadOfAqua() ? IntelliJLaf.class.getName() : systemLafClassName;
    UIManager.LookAndFeelInfo laf=findLaf(className);
    LOG.assertTrue(laf != null,"Could not find look and feel: " + className);
    return laf;
  }
  if (PlatformUtils.isRubyMine() || PlatformUtils.isPyCharm()) {
    final String desktop=AccessController.doPrivileged(new GetPropertyAction("sun.desktop"));
    if ("gnome".equals(desktop)) {
      UIManager.LookAndFeelInfo laf=findLaf(systemLafClassName);
      if (laf != null) {
        return laf;
      }
      LOG.info("Could not find system look and feel: " + systemLafClassName);
    }
  }
  final String defaultLafName=WelcomeWizardUtil.getDefaultLAF();
  if (defaultLafName != null) {
    UIManager.LookAndFeelInfo defaultLaf=findLaf(defaultLafName);
    if (defaultLaf != null) {
      return defaultLaf;
    }
  }
  UIManager.LookAndFeelInfo ideaLaf=findLaf(isIntelliJLafEnabled() ? IntelliJLaf.class.getName() : IdeaLookAndFeelInfo.CLASS_NAME);
  if (ideaLaf != null) {
    return ideaLaf;
  }
  throw new IllegalStateException("No default look&feel found");
}
