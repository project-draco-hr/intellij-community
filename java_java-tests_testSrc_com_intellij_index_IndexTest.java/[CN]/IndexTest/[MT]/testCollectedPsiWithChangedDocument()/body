{
  final VirtualFile vFile=myFixture.addClass("class Foo {}").getContainingFile().getVirtualFile();
  assertNotNull(findClass("Foo"));
  PsiFile psiFile=getPsiManager().findFile(vFile);
  assertNotNull(psiFile);
  Document document=FileDocumentManager.getInstance().getDocument(vFile);
  document.deleteString(0,document.getTextLength());
  assertNotNull(findClass("Foo"));
  psiFile=null;
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  assertNull(getPsiManager().getFileManager().getCachedPsiFile(vFile));
  PsiClass foo=findClass("Foo");
  assertNotNull(foo);
  assertTrue(foo.isValid());
  assertEquals("class Foo {}",foo.getText());
  assertTrue(foo.isValid());
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  assertNull(findClass("Foo"));
}
