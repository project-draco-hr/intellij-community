{
  String s1="class A {\n" + "  int bbb(int c, int ddd, int eee) {\n" + "    int a = 1;\n"+ "    try { int b = 1; } catch(Type t) { a = 2; } catch(Type2 t2) { a = 3; }\n"+ "  }\n"+ "}";
  String s2="try  { '_st*; } catch('_Type 't+) { '_st2*; }";
  final List<PsiVariable> vars=new ArrayList<>();
  final PsiFile file=PsiFileFactory.getInstance(getProject()).createFileFromText("_.java",s1);
  file.acceptChildren(new JavaRecursiveElementWalkingVisitor(){
    @Override public void visitVariable(    final PsiVariable variable){
      super.visitVariable(variable);
      vars.add(variable);
    }
  }
);
  assertEquals(7,vars.size());
  List<MatchResult> results=new ArrayList<>();
  Matcher testMatcher=new Matcher(getProject());
  MatchOptions options=new MatchOptions();
  options.setSearchPattern(s2);
  MatcherImplUtil.transform(options);
  options.setFileType(StdFileTypes.JAVA);
  for (  PsiVariable var : vars) {
    final List<MatchResult> matchResult=testMatcher.matchByDownUp(var,options);
    results.addAll(matchResult);
    assertTrue((var instanceof PsiParameter && var.getParent() instanceof PsiCatchSection && !matchResult.isEmpty()) || matchResult.isEmpty());
  }
  assertEquals(2,results.size());
  MatchResult result=results.get(0);
  assertEquals("t",result.getMatchImage());
  result=results.get(1);
  assertEquals("t2",result.getMatchImage());
  results.clear();
  String s2_2="try  { '_st*; } catch('Type:Type2 '_t) { '_st2*; }";
  options.clearVariableConstraints();
  options.setSearchPattern(s2_2);
  MatcherImplUtil.transform(options);
  for (  PsiVariable var : vars) {
    final PsiTypeElement typeElement=var.getTypeElement();
    final List<MatchResult> matchResult=testMatcher.matchByDownUp(typeElement,options);
    results.addAll(matchResult);
    assertTrue((var instanceof PsiParameter && var.getParent() instanceof PsiCatchSection && !matchResult.isEmpty()) || matchResult.isEmpty());
  }
  assertEquals(1,results.size());
  result=results.get(0);
  assertEquals("Type2",result.getMatchImage());
}
