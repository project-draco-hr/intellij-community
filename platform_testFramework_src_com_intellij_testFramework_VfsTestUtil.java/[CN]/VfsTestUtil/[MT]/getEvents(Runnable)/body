{
  List<VFileEvent> allEvents=new ArrayList<>();
  MessageBusConnection connection=ApplicationManager.getApplication().getMessageBus().connect();
  connection.subscribe(VirtualFileManager.VFS_CHANGES,new BulkFileListener.Adapter(){
    @Override public void after(    @NotNull List<? extends VFileEvent> events){
      allEvents.addAll(events);
    }
  }
);
  try {
    action.run();
  }
  finally {
    connection.disconnect();
  }
  return allEvents;
}
