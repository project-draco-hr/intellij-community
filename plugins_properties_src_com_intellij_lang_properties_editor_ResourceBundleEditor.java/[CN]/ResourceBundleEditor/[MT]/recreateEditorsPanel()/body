{
  myValuesPanel.removeAll();
  myValuesPanel.setLayout(new CardLayout());
  if (!myProject.isOpen())   return;
  JPanel valuesPanelComponent=new MyJPanel(new GridBagLayout());
  myValuesPanel.add(new JBScrollPane(valuesPanelComponent){
    @Override public void updateUI(){
      super.updateUI();
      getViewport().setBackground(UIUtil.getPanelBackground());
    }
  }
,VALUES);
  myValuesPanel.add(myNoPropertySelectedPanel,NO_PROPERTY_SELECTED);
  final List<PropertiesFile> propertiesFiles=myResourceBundle.getPropertiesFiles();
  GridBagConstraints gc=new GridBagConstraints(0,0,0,0,0,0,GridBagConstraints.NORTHWEST,GridBagConstraints.BOTH,new Insets(5,5,5,5),0,0);
  releaseAllEditors();
  myTitledPanels.clear();
  int y=0;
  Editor previousEditor=null;
  Editor firstEditor=null;
  for (  final PropertiesFile propertiesFile : propertiesFiles) {
    final EditorEx editor=createEditor();
    final Editor oldEditor=myEditors.put(propertiesFile.getVirtualFile(),editor);
    if (firstEditor == null) {
      firstEditor=editor;
    }
    if (previousEditor != null) {
      editor.putUserData(ChooseSubsequentPropertyValueEditorAction.PREV_EDITOR_KEY,previousEditor);
      previousEditor.putUserData(ChooseSubsequentPropertyValueEditorAction.NEXT_EDITOR_KEY,editor);
    }
    previousEditor=editor;
    if (oldEditor != null) {
      EditorFactory.getInstance().releaseEditor(oldEditor);
    }
    editor.setViewer(!propertiesFile.getVirtualFile().isWritable());
    editor.getContentComponent().addKeyListener(new KeyAdapter(){
      @Override public void keyTyped(      KeyEvent e){
        if (editor.isViewer()) {
          editor.setViewer(ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(propertiesFile.getVirtualFile()).hasReadonlyFiles());
        }
      }
    }
);
    editor.addFocusListener(new FocusChangeListener(){
      @Override public void focusGained(      final Editor editor){
        mySelectedEditor=editor;
      }
      @Override public void focusLost(      final Editor editor){
        if (!editor.isViewer() && propertiesFile.getContainingFile().isValid()) {
          writeEditorPropertyValue(null,editor,propertiesFile.getVirtualFile());
        }
      }
    }
);
    gc.gridx=0;
    gc.gridy=y++;
    gc.gridheight=1;
    gc.gridwidth=GridBagConstraints.REMAINDER;
    gc.weightx=1;
    gc.weighty=1;
    gc.anchor=GridBagConstraints.CENTER;
    String title=propertiesFile.getName();
    title+=PropertiesUtil.getPresentableLocale(propertiesFile.getLocale());
    JComponent comp=new JPanel(new BorderLayout()){
      @Override public Dimension getPreferredSize(){
        Insets insets=getBorder().getBorderInsets(this);
        return new Dimension(100,editor.getLineHeight() * 4 + insets.top + insets.bottom);
      }
    }
;
    comp.add(editor.getComponent(),BorderLayout.CENTER);
    comp.setBorder(IdeBorderFactory.createTitledBorder(title,false));
    myTitledPanels.put(propertiesFile.getVirtualFile(),(JPanel)comp);
    valuesPanelComponent.add(comp,gc);
  }
  if (previousEditor != null) {
    previousEditor.putUserData(ChooseSubsequentPropertyValueEditorAction.NEXT_EDITOR_KEY,firstEditor);
    firstEditor.putUserData(ChooseSubsequentPropertyValueEditorAction.PREV_EDITOR_KEY,previousEditor);
  }
  gc.gridx=0;
  gc.gridy=y;
  gc.gridheight=GridBagConstraints.REMAINDER;
  gc.gridwidth=GridBagConstraints.REMAINDER;
  gc.weightx=10;
  gc.weighty=1;
  valuesPanelComponent.add(new JPanel(),gc);
  selectionChanged();
  myValuesPanel.repaint();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      updateEditorsFromProperties(true);
    }
  }
);
}
