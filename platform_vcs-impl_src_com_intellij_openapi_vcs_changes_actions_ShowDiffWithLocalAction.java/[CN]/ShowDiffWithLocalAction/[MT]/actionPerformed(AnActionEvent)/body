{
  Project project=e.getData(CommonDataKeys.PROJECT);
  if (ChangeListManager.getInstance(project).isFreezedWithNotification(null))   return;
  ChangesSelection selection=e.getRequiredData(VcsDataKeys.CHANGES_SELECTION);
  int index=0;
  List<Change> changesToLocal=new ArrayList<Change>();
  for (int i=0; i < selection.getChanges().size(); i++) {
    if (i == selection.getIndex())     index=changesToLocal.size();
    ContentRevision afterRevision=selection.getChanges().get(i).getAfterRevision();
    if (afterRevision != null && isValidAfterRevision(afterRevision)) {
      changesToLocal.add(new Change(afterRevision,CurrentContentRevision.create(afterRevision.getFile())));
    }
  }
  if (!changesToLocal.isEmpty()) {
    showDiffForChange(project,changesToLocal,index);
  }
}
