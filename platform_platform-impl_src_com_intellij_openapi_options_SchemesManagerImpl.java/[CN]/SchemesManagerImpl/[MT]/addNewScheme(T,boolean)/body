{
  int toReplace=-1;
  for (int i=0; i < mySchemes.size(); i++) {
    T existing=mySchemes.get(i);
    if (existing.getName().equals(scheme.getName())) {
      if (!Comparing.equal(existing.getClass(),scheme.getClass())) {
        LOG.warn("'" + scheme.getName() + "' "+ existing.getClass().getSimpleName()+ " replaced with "+ scheme.getClass().getSimpleName());
      }
      toReplace=i;
      if (replaceExisting && existing instanceof ExternalizableScheme) {
        ExternalInfo oldInfo=mySchemeToInfo.remove((ExternalizableScheme)existing);
        if (scheme instanceof ExternalizableScheme) {
          ExternalInfo newInfo=mySchemeToInfo.get((ExternalizableScheme)scheme);
          if (newInfo == null || newInfo.fileName == null) {
            if (oldInfo != null && oldInfo.fileName != null) {
              getExternalInfo((ExternalizableScheme)scheme).fileName=oldInfo.fileName;
            }
          }
        }
      }
      break;
    }
  }
  if (toReplace == -1) {
    mySchemes.add(scheme);
  }
 else   if (replaceExisting || !(scheme instanceof ExternalizableScheme)) {
    mySchemes.set(toReplace,scheme);
  }
 else {
    renameScheme((ExternalizableScheme)scheme,UniqueNameGenerator.generateUniqueName(scheme.getName(),collectExistingNames(mySchemes)));
    mySchemes.add(scheme);
  }
  schemeAdded(scheme);
}
