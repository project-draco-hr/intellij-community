{
  if (filesToDelete.isEmpty()) {
    return errors;
  }
  if (provider != null && provider.isEnabled()) {
    for (    String name : filesToDelete) {
      try {
        StorageUtil.delete(provider,myFileSpec + '/' + name,myRoamingType);
      }
 catch (      Throwable e) {
        if (errors == null) {
          errors=new SmartList<Throwable>();
        }
        errors.add(e);
      }
    }
  }
 else   if (dir != null) {
    AccessToken token=null;
    try {
      for (      VirtualFile file : dir.getChildren()) {
        if (filesToDelete.contains(file.getName())) {
          if (token == null) {
            token=WriteAction.start();
          }
          try {
            file.delete(this);
          }
 catch (          IOException e) {
            if (errors == null) {
              errors=new SmartList<Throwable>();
            }
            errors.add(e);
          }
        }
      }
    }
  finally {
      if (token != null) {
        token.finish();
      }
    }
  }
  filesToDelete.clear();
  return errors;
}
