{
  if (myFilesToDelete.isEmpty()) {
    return errors;
  }
  if (myProvider != null && myProvider.isEnabled()) {
    for (    String nameWithoutExtension : myFilesToDelete) {
      deleteServerFile(nameWithoutExtension + mySchemeExtension);
      if (!DirectoryStorageData.DEFAULT_EXT.equals(mySchemeExtension)) {
        deleteServerFile(nameWithoutExtension + DirectoryStorageData.DEFAULT_EXT);
      }
    }
  }
  if (dir != null) {
    AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(DocumentRunnable.IgnoreDocumentRunnable.class);
    try {
      for (      VirtualFile file : dir.getChildren()) {
        if (myFilesToDelete.contains(file.getNameWithoutExtension())) {
          try {
            file.delete(this);
          }
 catch (          IOException e) {
            if (errors == null) {
              errors=new SmartList<Throwable>();
            }
            errors.add(e);
          }
        }
      }
      myFilesToDelete.clear();
    }
  finally {
      token.finish();
    }
  }
  return errors;
}
