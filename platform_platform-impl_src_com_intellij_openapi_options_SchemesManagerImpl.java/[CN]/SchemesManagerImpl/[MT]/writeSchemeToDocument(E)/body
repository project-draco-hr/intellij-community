{
  if (isShared(scheme)) {
    String originalPath=scheme.getExternalInfo().getOriginalPath();
    if (originalPath != null) {
      Element root=new Element(SHARED_SCHEME);
      root.setAttribute(NAME,scheme.getName());
      root.setAttribute(ORIGINAL_SCHEME_PATH,originalPath);
      Parent child=myProcessor.writeScheme(scheme);
      root.addContent(new Element(SCHEME_LOCAL_COPY).addContent(child instanceof Element ? (Element)child : ((Document)child).detachRootElement()));
      return root;
    }
 else {
      return null;
    }
  }
 else {
    return myProcessor.writeScheme(scheme);
  }
}
