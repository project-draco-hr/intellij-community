{
  String extension;
  if (StringUtilRt.endsWithIgnoreCase(fileName,mySchemeExtension)) {
    extension=mySchemeExtension;
  }
 else   if (StringUtilRt.endsWithIgnoreCase(fileName,DirectoryStorageData.DEFAULT_EXT)) {
    extension=DirectoryStorageData.DEFAULT_EXT;
  }
 else   if (allowAny) {
    extension=PathUtil.getFileExtension(fileName.toString());
    LOG.assertTrue(extension != null);
  }
 else {
    throw new IllegalStateException("Scheme file extension " + fileName + " is unknown, must be filtered out");
  }
  return extension;
}
