{
  Set<VirtualFile> roots=myFilterModel.getDataPack().getLogProviders().keySet();
  Collection<VirtualFile> visibleRoots;
  VcsLogStructureFilter previousFilter=myFilterModel.getFilter();
  if (previousFilter == null) {
    if (visible) {
      visibleRoots=roots;
    }
 else {
      visibleRoots=ContainerUtil.subtract(roots,Collections.singleton(root));
    }
  }
 else {
    if (visible) {
      visibleRoots=ContainerUtil.union(new HashSet<VirtualFile>(myFilterModel.getFilter().getRoots()),Collections.singleton(root));
    }
 else {
      visibleRoots=ContainerUtil.subtract(myFilterModel.getFilter().getRoots(),Collections.singleton(root));
    }
  }
  myFilterModel.setFilter(VcsLogStructureFilterImpl.build(visibleRoots,myFilterModel.getDataPack()));
}
