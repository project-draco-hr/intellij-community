{
  Project project=e.getRequiredData(CommonDataKeys.PROJECT);
  VcsLogDataPack dataPack=myFilterModel.getDataPack();
  VcsLogStructureFilter filter=myFilterModel.getFilter();
  Collection<VirtualFile> files=filter == null ? Collections.<VirtualFile>emptySet() : getAllFiles(dataPack,filter);
  Set<VirtualFile> roots=dataPack.getLogProviders().keySet();
  VcsStructureChooser chooser=new VcsStructureChooser(project,"Select Files or Folders to Filter",files,new ArrayList<VirtualFile>(roots));
  if (chooser.showAndGet()) {
    myFilterModel.setFilter(new VcsLogStructureFilterImpl(chooser.getSelectedFiles(),roots));
  }
}
