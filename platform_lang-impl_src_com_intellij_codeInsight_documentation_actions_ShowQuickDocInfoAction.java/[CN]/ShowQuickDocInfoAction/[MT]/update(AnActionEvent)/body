{
  Presentation presentation=event.getPresentation();
  DataContext dataContext=event.getDataContext();
  presentation.setEnabled(false);
  Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project == null)   return;
  Editor editor=CommonDataKeys.EDITOR.getData(dataContext);
  PsiElement element=CommonDataKeys.PSI_ELEMENT.getData(dataContext);
  if (editor == null && element == null)   return;
  if (LookupManager.getInstance(project).getActiveLookup() != null) {
    if (isValidForLookup())     presentation.setEnabled(true);
  }
 else {
    if (editor != null) {
      if (EditorGutter.KEY.getData(event.getDataContext()) != null)       return;
      PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
      if (file == null && element == null)       return;
    }
    presentation.setEnabled(true);
  }
}
