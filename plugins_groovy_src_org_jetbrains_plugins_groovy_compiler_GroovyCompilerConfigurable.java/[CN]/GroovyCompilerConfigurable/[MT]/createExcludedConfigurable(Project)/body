{
  final ExcludesConfiguration configuration=myConfig.getExcludeFromStubGeneration();
  final ProjectFileIndex index=ProjectRootManager.getInstance(project).getFileIndex();
  final FileChooserDescriptor descriptor=new FileChooserDescriptor(true,true,false,false,false,true){
    @Override public boolean isFileVisible(    VirtualFile file,    boolean showHiddenFiles){
      return super.isFileVisible(file,showHiddenFiles) && !index.isExcluded(file);
    }
  }
;
  descriptor.setRoots(ContainerUtil.concat(ContainerUtil.map(ModuleManager.getInstance(project).getModules(),new Function<Module,List<VirtualFile>>(){
    @Override public List<VirtualFile> fun(    final Module module){
      return ModuleRootManager.getInstance(module).getSourceRoots(JavaModuleSourceRootTypes.SOURCES);
    }
  }
)));
  return new ExcludedEntriesConfigurable(project,descriptor,configuration);
}
