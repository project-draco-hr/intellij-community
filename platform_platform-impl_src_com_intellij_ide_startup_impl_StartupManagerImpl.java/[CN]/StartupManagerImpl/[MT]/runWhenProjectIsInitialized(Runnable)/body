{
  final Application application=ApplicationManager.getApplication();
  if (application == null)   return;
synchronized (this) {
    boolean initialized=myProject.isInitialized() || application.isUnitTestMode() && myPostStartupActivitiesPassed;
    if (!initialized) {
      registerPostStartupActivity(action);
      return;
    }
  }
  Runnable runnable=new Runnable(){
    @Override public void run(){
      if (!myProject.isDisposed()) {
        action.run();
      }
    }
  }
;
  if (application.isDispatchThread() && ModalityState.current() == ModalityState.NON_MODAL) {
    runnable.run();
  }
 else {
    application.invokeLater(runnable,ModalityState.NON_MODAL);
  }
}
