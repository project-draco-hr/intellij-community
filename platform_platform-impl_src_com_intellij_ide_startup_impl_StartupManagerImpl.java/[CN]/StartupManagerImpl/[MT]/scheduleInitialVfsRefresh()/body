{
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      if (myProject.isDisposed())       return;
      markContentRootsForRefresh();
      Application app=ApplicationManager.getApplication();
      if (!app.isHeadlessEnvironment()) {
        final long sessionId=VirtualFileManager.getInstance().asyncRefresh(null);
        final MessageBusConnection connection=app.getMessageBus().connect();
        connection.subscribe(ProjectLifecycleListener.TOPIC,new ProjectLifecycleListener.Adapter(){
          @Override public void afterProjectClosed(          @NotNull Project project){
            if (project != myProject)             return;
            RefreshQueue.getInstance().cancelSession(sessionId);
            connection.disconnect();
          }
        }
);
      }
 else {
        VirtualFileManager.getInstance().syncRefresh();
      }
    }
  }
);
}
