{
  if (isTypingLatencyStatsEnabled()) {
    if (myZeroLatencyTypingWasEnabled != isZeroLatencyTypingEnabled()) {
      resetTypingLatencyStats();
      myZeroLatencyTypingWasEnabled=isZeroLatencyTypingEnabled();
    }
    myTypingLatencyMeter.registerStart();
  }
  if (isZeroLatencyTypingEnabled() && getDocument().isWritable() && !myEditor.isViewer()&& canPaintImmediately(c)) {
    for (    Caret caret : getCaretModel().getAllCarets()) {
      paintImmediately(g,caret.getOffset(),c,myEditor.isInsertMode());
    }
    if (isTypingLatencyStatsEnabled()) {
      myTypingLatencyMeter.registerFinish();
    }
  }
  if (isTypingLatencyStatsEnabled()) {
    myCharsTyped++;
    if (myCharsTyped == TYPING_STATS_SAMPLE_SIZE) {
      String stats="Zero-latency: " + isZeroLatencyTypingEnabled() + "; "+ myTypingLatencyMeter.stat();
      printToEventLog(stats);
      resetTypingLatencyStats();
    }
  }
}
