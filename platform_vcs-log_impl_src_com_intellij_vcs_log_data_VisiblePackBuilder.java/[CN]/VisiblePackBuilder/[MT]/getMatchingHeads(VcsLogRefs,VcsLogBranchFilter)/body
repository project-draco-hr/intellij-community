{
  final Collection<String> branchNames=new HashSet<String>(filter.getBranchNames());
  final Collection<String> excludedBranches=new HashSet<String>(filter.getExcludedBranchNames());
  final boolean filterByAcceptance=!filter.getBranchNames().isEmpty();
  return new HashSet<Integer>(ContainerUtil.mapNotNull(refs.getBranches(),new Function<VcsRef,Integer>(){
    @Override public Integer fun(    @NotNull VcsRef ref){
      boolean acceptRef=filterByAcceptance ? branchNames.contains(ref.getName()) : !excludedBranches.contains(ref.getName());
      return acceptRef ? myHashMap.getCommitIndex(ref.getCommitHash()) : null;
    }
  }
));
}
