{
  Set<Integer> matchingCommits=null;
  if (commitCount == CommitCountStage.INITIAL) {
    matchingCommits=getMatchedCommitIndex(filterInMemory(graph,detailsFilters,matchingHeads));
    if (matchingCommits.size() < commitCount.getCount()) {
      commitCount=commitCount.next();
      matchingCommits=null;
    }
  }
  if (matchingCommits == null) {
    try {
      matchingCommits=getMatchedCommitIndex(getFilteredDetailsFromTheVcs(myLogProviders,filters,commitCount.getCount()));
    }
 catch (    VcsException e) {
      matchingCommits=Collections.emptySet();
      LOG.error(e);
    }
  }
  return new FilterResult(matchingCommits,matchingCommits.size() >= commitCount.getCount(),commitCount);
}
