{
  VcsLogBranchFilter branchFilter=filters.getBranchFilter();
  VcsLogRootFilter rootFilter=filters.getRootFilter();
  VcsLogStructureFilter structureFilter=filters.getStructureFilter();
  if (branchFilter == null && rootFilter == null && structureFilter == null)   return null;
  Set<Integer> filteredByFile=null;
  Set<Integer> filteredByBranch=null;
  if (branchFilter != null) {
    filteredByBranch=getMatchingHeads(refs,branchFilter);
  }
  if (rootFilter != null) {
    filteredByFile=getMatchingHeads(refs,rootFilter);
  }
  if (structureFilter != null) {
    if (filteredByFile == null) {
      filteredByFile=getMatchingHeads(refs,roots,structureFilter);
    }
 else {
      filteredByFile=ContainerUtil.union(filteredByFile,getMatchingHeads(refs,roots,structureFilter));
    }
  }
  if (filteredByBranch == null)   return filteredByFile;
  if (filteredByFile == null)   return filteredByBranch;
  return new HashSet<Integer>(ContainerUtil.intersection(filteredByBranch,filteredByFile));
}
