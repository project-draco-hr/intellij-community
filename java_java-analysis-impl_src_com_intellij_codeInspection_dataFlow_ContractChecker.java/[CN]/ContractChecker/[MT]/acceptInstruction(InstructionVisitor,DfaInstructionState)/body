{
  DfaMemoryState memState=instructionState.getMemoryState();
  if (memState.isEphemeral()) {
    return DfaInstructionState.EMPTY_ARRAY;
  }
  Instruction instruction=instructionState.getInstruction();
  if (instruction instanceof CheckReturnValueInstruction) {
    PsiElement anchor=((CheckReturnValueInstruction)instruction).getReturn();
    DfaValue retValue=memState.pop();
    if (breaksContract(retValue,myContract.returnValue,memState)) {
      myViolations.add(anchor);
    }
 else {
      myNonViolations.add(anchor);
    }
    return InstructionVisitor.nextInstruction(instruction,this,memState);
  }
  if (instruction instanceof ReturnInstruction) {
    if (((ReturnInstruction)instruction).isViaException()) {
      ContainerUtil.addIfNotNull(myFailures,((ReturnInstruction)instruction).getAnchor());
    }
  }
  if (instruction instanceof MethodCallInstruction && ((MethodCallInstruction)instruction).getMethodType() == MethodCallInstruction.MethodType.REGULAR_METHOD_CALL && myContract.returnValue == MethodContract.ValueConstraint.THROW_EXCEPTION) {
    ContainerUtil.addIfNotNull(myFailures,((MethodCallInstruction)instruction).getCallExpression());
    return DfaInstructionState.EMPTY_ARRAY;
  }
  return super.acceptInstruction(visitor,instructionState);
}
