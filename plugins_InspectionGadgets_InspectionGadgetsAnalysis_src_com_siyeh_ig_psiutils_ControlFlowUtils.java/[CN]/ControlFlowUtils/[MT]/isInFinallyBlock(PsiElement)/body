{
  final PsiType type;
  if (element instanceof PsiThrowStatement) {
    final PsiThrowStatement throwStatement=(PsiThrowStatement)element;
    final PsiExpression exception=throwStatement.getException();
    type=exception != null ? exception.getType() : null;
  }
 else {
    type=null;
  }
  PsiElement currentElement=element;
  while (true) {
    final PsiTryStatement tryStatement=PsiTreeUtil.getParentOfType(currentElement,PsiTryStatement.class,true,PsiClass.class,PsiLambdaExpression.class);
    if (tryStatement == null) {
      return false;
    }
    final PsiCodeBlock finallyBlock=tryStatement.getFinallyBlock();
    if (PsiTreeUtil.isAncestor(finallyBlock,currentElement,true)) {
      return true;
    }
    if (type != null && isCaught(tryStatement,type)) {
      return false;
    }
    currentElement=tryStatement;
  }
}
