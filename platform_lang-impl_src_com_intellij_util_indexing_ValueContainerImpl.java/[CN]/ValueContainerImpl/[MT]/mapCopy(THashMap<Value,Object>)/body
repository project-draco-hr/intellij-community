{
  if (map == null) {
    return null;
  }
  final THashMap<Value,Object> cloned=map.clone();
  cloned.forEachEntry(new TObjectObjectProcedure<Value,Object>(){
    @Override public boolean execute(    Value key,    Object val){
      if (val instanceof IdSet) {
        cloned.put(key,((IdSet)val).clone());
      }
      return true;
    }
  }
);
  return cloned;
}
