{
  Document document=editor.getDocument();
  int lineCount=document.getLineCount();
  for (int i=0; i < lineCount; i++) {
    if (offset >= document.getLineStartOffset(i) && offset < document.getLineStartOffset(i + 1)) {
      return i;
    }
  }
  if (offset > document.getTextLength()) {
    return -1;
  }
  return lineCount - 1;
}
