{
  Window selectedTaskWindow=StudyTaskManager.getInstance(project).getSelectedWindow();
  if (selectedTaskWindow != null) {
    RangeHighlighter selectedRangeHighlighter=selectedTaskWindow.getRangeHighlighter();
    if (selectedRangeHighlighter != null) {
      int lineChange=selectedEditor.getDocument().getLineCount() - getLineNum();
      if (lineChange != 0) {
        int newStartLine=getLineNumByOffset(selectedEditor,selectedRangeHighlighter.getStartOffset());
        int newEndLine=getLineNumByOffset(selectedEditor,selectedRangeHighlighter.getEndOffset());
        increment(newStartLine,lineChange);
        selectedTaskWindow.setLine(selectedTaskWindow.getLine() - lineChange);
        setNewOffsetInLine(newEndLine,selectedTaskWindow.getStart() + selectedTaskWindow.getOffsetInLine(),selectedRangeHighlighter.getEndOffset() - selectedEditor.getDocument().getLineStartOffset(newEndLine));
      }
 else {
        int oldEnd=selectedTaskWindow.getRealStartOffset(selectedEditor) + selectedTaskWindow.getOffsetInLine();
        int endChange=selectedRangeHighlighter.getEndOffset() - oldEnd;
        incrementAfterOffset(selectedTaskWindow.getLine(),selectedTaskWindow.getStart(),endChange);
      }
      int newLength=selectedRangeHighlighter.getEndOffset() - selectedRangeHighlighter.getStartOffset();
      selectedTaskWindow.setOffsetInLine(newLength);
    }
  }
}
