{
  final PsiElement parent=getParentByStub();
  if (parent instanceof PyParameterList) {
    PyParameterList parameterList=(PyParameterList)parent;
    PyFunction func=parameterList.getContainingFunction();
    if (func != null) {
      for (      PyTypeProvider provider : Extensions.getExtensions(PyTypeProvider.EP_NAME)) {
        final Ref<PyType> resultRef=provider.getParameterType(this,func,context);
        if (resultRef != null) {
          return resultRef.get();
        }
      }
      if (isSelf()) {
        final PyClass containingClass=func.getContainingClass();
        if (containingClass != null) {
          PyType initType=null;
          final PyFunction init=containingClass.findInitOrNew(true,context);
          if (init != null && init != func) {
            initType=context.getReturnType(init);
            if (init.getContainingClass() != containingClass) {
              if (initType instanceof PyCollectionType) {
                final List<PyType> elementTypes=((PyCollectionType)initType).getElementTypes(context);
                return new PyCollectionTypeImpl(containingClass,false,elementTypes);
              }
            }
          }
          if (initType != null && !(initType instanceof PyNoneType)) {
            return initType;
          }
          final PyFunction.Modifier modifier=func.getModifier();
          return new PyClassTypeImpl(containingClass,modifier == PyFunction.Modifier.CLASSMETHOD);
        }
      }
      if (isKeywordContainer()) {
        return PyBuiltinCache.getInstance(this).getDictType();
      }
      if (isPositionalContainer()) {
        return PyBuiltinCache.getInstance(this).getTupleType();
      }
      if (context.maySwitchToAST(this)) {
        final PyExpression defaultValue=getDefaultValue();
        if (defaultValue != null) {
          final PyType type=context.getType(defaultValue);
          if (type != null && !(type instanceof PyNoneType)) {
            if (type instanceof PyTupleType) {
              return PyUnionType.createWeakType(type);
            }
            return type;
          }
        }
      }
      if (context.allowCallContext(this)) {
        final List<PyType> types=new ArrayList<PyType>();
        processLocalCalls(func,new Processor<PyCallExpression>(){
          @Override public boolean process(          @NotNull PyCallExpression call){
            final PyResolveContext resolveContext=PyResolveContext.noImplicits().withTypeEvalContext(context);
            final PyArgumentList argumentList=call.getArgumentList();
            if (argumentList != null) {
              final PyCallExpression.PyArgumentsMapping mapping=call.mapArguments(resolveContext);
              for (              Map.Entry<PyExpression,PyNamedParameter> entry : mapping.getMappedParameters().entrySet()) {
                if (entry.getValue() == PyNamedParameterImpl.this) {
                  final PyExpression argument=entry.getKey();
                  if (argument != null) {
                    final PyType type=context.getType(argument);
                    if (type != null) {
                      types.add(type);
                      return true;
                    }
                  }
                }
              }
            }
            return true;
          }
        }
);
        if (!types.isEmpty()) {
          return PyUnionType.createWeakType(PyUnionType.union(types));
        }
      }
      if (context.maySwitchToAST(this)) {
        final Set<String> attributes=collectUsedAttributes(context);
        if (!attributes.isEmpty()) {
          return new PyStructuralType(attributes,true);
        }
      }
    }
  }
  return null;
}
