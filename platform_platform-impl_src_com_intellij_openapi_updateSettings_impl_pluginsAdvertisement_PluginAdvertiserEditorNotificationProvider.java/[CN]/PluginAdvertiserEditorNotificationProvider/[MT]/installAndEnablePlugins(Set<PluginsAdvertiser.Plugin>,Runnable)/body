{
  ProgressManager.getInstance().run(new Task.Modal(null,"Search for plugins in repository",true){
    private final Set<PluginDownloader> myPlugins=new HashSet<PluginDownloader>();
    private List<IdeaPluginDescriptor> myAllPlugins;
    @Override public void run(    @NotNull ProgressIndicator indicator){
      try {
        myAllPlugins=RepositoryHelper.loadPluginsFromAllRepositories(indicator);
        for (        IdeaPluginDescriptor loadedPlugin : myAllPlugins) {
          if (plugins.contains(new PluginsAdvertiser.Plugin(loadedPlugin.getPluginId(),null,false))) {
            myPlugins.add(PluginDownloader.createDownloader(loadedPlugin));
          }
        }
      }
 catch (      Exception ignore) {
      }
    }
    @Override public void onSuccess(){
      final PluginsAdvertiserDialog advertiserDialog=new PluginsAdvertiserDialog(null,myPlugins.toArray(new PluginDownloader[myPlugins.size()]),PluginManagerMain.mapToPluginIds(myAllPlugins));
      if (advertiserDialog.showAndGet()) {
        onSuccess.run();
      }
    }
  }
);
}
