{
  if (functionalInterfaceReturnType == PsiType.VOID) {
    final PsiElement body=lambdaExpression.getBody();
    if (body instanceof PsiCodeBlock) {
      if (!LambdaUtil.getReturnExpressions(lambdaExpression).isEmpty())       return "Unexpected return value";
    }
 else     if (body instanceof PsiExpression) {
      final PsiType type=((PsiExpression)body).getType();
      try {
        if (!PsiUtil.isStatement(JavaPsiFacade.getElementFactory(body.getProject()).createStatementFromText(body.getText(),body))) {
          return "Incompatible return type " + (type == PsiType.NULL || type == null ? "<null>" : type.getPresentableText()) + " in lambda expression";
        }
      }
 catch (      IncorrectOperationException ignore) {
      }
    }
  }
 else   if (functionalInterfaceReturnType != null) {
    final List<PsiExpression> returnExpressions=LambdaUtil.getReturnExpressions(lambdaExpression);
    for (    final PsiExpression expression : returnExpressions) {
      final PsiType expressionType=PsiResolveHelper.ourGraphGuard.doPreventingRecursion(expression,true,new Computable<PsiType>(){
        @Override public PsiType compute(){
          return expression.getType();
        }
      }
);
      if (expressionType != null && !functionalInterfaceReturnType.isAssignableFrom(expressionType)) {
        return "Incompatible return type " + expressionType.getPresentableText() + " in lambda expression";
      }
    }
    if (LambdaUtil.getReturnStatements(lambdaExpression).size() > returnExpressions.size() || returnExpressions.isEmpty() && !lambdaExpression.isVoidCompatible()) {
      return "Missing return value";
    }
  }
  return null;
}
