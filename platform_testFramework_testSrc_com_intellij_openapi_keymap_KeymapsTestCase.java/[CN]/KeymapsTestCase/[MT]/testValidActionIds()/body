{
  THashSet<String> unknownActions=new THashSet<>();
  collectUnknownActions(unknownActions);
  @SuppressWarnings("MismatchedQueryAndUpdateOfCollection") Map<String,List<String>> missingActions=new FactoryMap<String,List<String>>(){
    @Override protected Map<String,List<String>> createMap(){
      return new LinkedHashMap<>();
    }
    @Nullable @Override protected List<String> create(    String key){
      return new ArrayList<>();
    }
  }
;
  for (  Keymap keymap : KeymapManagerEx.getInstanceEx().getAllKeymaps()) {
    String[] ids=keymap.getActionIds();
    Arrays.sort(ids);
    Set<String> noDuplicates=new LinkedHashSet<>(Arrays.asList(ids));
    TestCase.assertEquals(new ArrayList<>(Arrays.asList(ids)),new ArrayList<>(noDuplicates));
    for (    String cid : ids) {
      if (unknownActions.contains(cid))       continue;
      AnAction action=ActionManager.getInstance().getAction(cid);
      if (action == null) {
        if (OUTPUT_TEST_DATA) {
          System.out.print("\"" + cid + "\", ");
        }
 else {
          missingActions.get(keymap.getName()).add(cid);
        }
      }
    }
  }
  List<String> reappearedAction=new ArrayList<>();
  for (  String id : unknownActions) {
    AnAction action=ActionManager.getInstance().getAction(id);
    if (action != null) {
      reappearedAction.add(id);
    }
  }
  if (!missingActions.isEmpty() || !reappearedAction.isEmpty()) {
    StringBuilder message=new StringBuilder();
    if (!missingActions.isEmpty()) {
      for (      Map.Entry<String,List<String>> keymapAndActions : missingActions.entrySet()) {
        message.append("Unknown actions in keymap ").append(keymapAndActions.getKey()).append(", add them to unknown actions list:\n");
        for (        String action : keymapAndActions.getValue()) {
          message.append("\"").append(action).append("\",").append("\n");
        }
      }
    }
    if (!reappearedAction.isEmpty()) {
      message.append("The following actions have reappeared, remove them from unknown action list:\n");
      for (      String action : reappearedAction) {
        message.append(action).append("\n");
      }
    }
    fail("\n" + message);
  }
}
