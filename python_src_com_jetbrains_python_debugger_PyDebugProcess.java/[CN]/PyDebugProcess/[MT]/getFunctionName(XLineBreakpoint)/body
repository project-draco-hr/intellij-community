{
  if (breakpoint.getSourcePosition() == null) {
    return null;
  }
  final VirtualFile file=breakpoint.getSourcePosition().getFile();
  AccessToken lock=ApplicationManager.getApplication().acquireReadActionLock();
  try {
    final Document document=FileDocumentManager.getInstance().getDocument(file);
    final Project project=getSession().getProject();
    if (document != null) {
      if (file.getFileType() == PythonFileType.INSTANCE) {
        PsiElement psiElement=XDebuggerUtil.getInstance().findContextElement(file,breakpoint.getSourcePosition().getOffset(),project,false);
        PyFunction function=PsiTreeUtil.getParentOfType(psiElement,PyFunction.class);
        if (function != null) {
          return function.getName();
        }
      }
    }
    return null;
  }
  finally {
    lock.finish();
  }
}
