{
  dropFrameCaches();
  if (isConnected() && !mySuspendedThreads.isEmpty()) {
    final PySourcePosition pyPosition=myPositionConverter.convertToPython(position);
    String type=PyLineBreakpointType.ID;
    AccessToken lock=ApplicationManager.getApplication().acquireReadActionLock();
    try {
      final Document document=FileDocumentManager.getInstance().getDocument(position.getFile());
      if (document != null) {
        for (        XBreakpointType breakpointType : Extensions.getExtensions(XBreakpointType.EXTENSION_POINT_NAME)) {
          if (breakpointType instanceof PyBreakpointType && ((PyBreakpointType)breakpointType).canPutInDocument(getSession().getProject(),document)) {
            type=breakpointType.getId();
            break;
          }
        }
      }
    }
  finally {
      lock.finish();
    }
    myDebugger.setTempBreakpoint(type,pyPosition.getFile(),pyPosition.getLine());
    passToCurrentThread(ResumeOrStepCommand.Mode.RESUME);
  }
}
