{
  if (!mySuspendedThreads.contains(threadInfo)) {
    mySuspendedThreads.add(threadInfo);
    final List<PyStackFrameInfo> frames=threadInfo.getFrames();
    if (frames != null) {
      final PySuspendContext suspendContext=new PySuspendContext(this,threadInfo);
      XBreakpoint<?> breakpoint=null;
      if (threadInfo.isStopOnBreakpoint()) {
        final PySourcePosition position=frames.get(0).getPosition();
        breakpoint=myRegisteredBreakpoints.get(position);
        if (breakpoint == null) {
          final RemoveBreakpointCommand command=new RemoveBreakpointCommand(myDebugger,position.getFile(),position.getLine());
          myDebugger.execute(command);
        }
      }
 else       if (threadInfo.isExceptionBreak()) {
        String exceptionName=threadInfo.getMessage();
        threadInfo.setMessage(null);
        if (exceptionName != null) {
          breakpoint=myRegisteredExceptionBreakpoints.get(exceptionName);
        }
      }
      if (breakpoint != null) {
        if (!getSession().breakpointReached(breakpoint,threadInfo.getMessage(),suspendContext)) {
          resume();
        }
      }
 else {
        getSession().positionReached(suspendContext);
      }
    }
  }
}
