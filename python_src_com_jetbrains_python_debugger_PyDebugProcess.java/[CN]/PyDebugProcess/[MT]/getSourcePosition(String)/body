{
  XSourcePosition currentPosition=getCurrentFrameSourcePosition();
  if (currentPosition == null) {
    return null;
  }
  VirtualFile virtualFile=currentPosition.getFile();
  final Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
  if (document == null) {
    return null;
  }
  final FileViewProvider viewProvider=PsiManager.getInstance(getProject()).findViewProvider(virtualFile);
  if (viewProvider == null) {
    return null;
  }
  final PsiFile file=viewProvider.getPsi(PythonLanguage.getInstance());
  if (file == null) {
    return null;
  }
  PsiElement currentElement=file.findElementAt(currentPosition.getOffset());
  if (currentElement == null) {
    return null;
  }
  final Ref<PsiElement> elementRef=Ref.create();
  PyResolveUtil.scopeCrawlUp(new PsiScopeProcessor(){
    @Override public boolean execute(    @NotNull PsiElement element,    @NotNull ResolveState state){
      elementRef.set(element);
      return false;
    }
    @Nullable @Override public <T>T getHint(    @NotNull Key<T> hintKey){
      return null;
    }
    @Override public void handleEvent(    @NotNull Event event,    @Nullable Object associated){
    }
  }
,currentElement,name,null);
  return elementRef.isNull() ? null : XSourcePositionImpl.createByOffset(elementRef.get().getContainingFile().getVirtualFile(),elementRef.get().getTextOffset());
}
