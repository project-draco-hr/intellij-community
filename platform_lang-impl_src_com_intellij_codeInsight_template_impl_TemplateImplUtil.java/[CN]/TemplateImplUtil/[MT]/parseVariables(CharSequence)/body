{
  LinkedHashMap<String,Variable> variables=new LinkedHashMap<String,Variable>();
  TemplateTextLexer lexer=new TemplateTextLexer();
  lexer.start(text);
  while (true) {
    IElementType tokenType=lexer.getTokenType();
    if (tokenType == null)     break;
    int start=lexer.getTokenStart();
    int end=lexer.getTokenEnd();
    String token=text.subSequence(start,end).toString();
    if (tokenType == TemplateTokenType.VARIABLE) {
      String name=token.substring(1,token.length() - 1);
      if (!variables.containsKey(name)) {
        variables.put(name,new Variable(name,"","",true));
      }
    }
    lexer.advance();
  }
  return variables;
}
