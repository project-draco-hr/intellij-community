{
  final Project project=targetFile.getProject();
  GlobalSearchScope scope=PyProjectScopeBuilder.excludeSdkTestsScope(targetFile);
  Collection<String> keys=StubIndex.getInstance().getAllKeys(key,project);
  for (  final String elementName : CompletionUtil.sortMatching(resultSet.getPrefixMatcher(),keys)) {
    for (    T element : StubIndex.getElements(key,elementName,project,scope,elementClass)) {
      if (condition.value(element)) {
        final String name=element.getName();
        if (name != null) {
          resultSet.addElement(LookupElementBuilder.createWithSmartPointer(name,element).withIcon(element.getIcon(0)).withTailText(" " + ((NavigationItem)element).getPresentation().getLocationString(),true).withInsertHandler(insertHandler));
        }
      }
    }
  }
}
