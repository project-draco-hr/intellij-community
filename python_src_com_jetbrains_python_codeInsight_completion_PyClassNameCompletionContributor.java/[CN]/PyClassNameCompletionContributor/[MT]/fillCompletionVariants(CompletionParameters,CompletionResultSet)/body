{
  if (parameters.isExtendedCompletion()) {
    final PsiElement element=parameters.getPosition();
    final PsiElement parent=element.getParent();
    if (parent instanceof PyReferenceExpression && ((PyReferenceExpression)parent).getQualifier() != null) {
      return;
    }
    final FileViewProvider provider=element.getContainingFile().getViewProvider();
    if (provider instanceof MultiplePsiFilesPerDocumentFileViewProvider)     return;
    if (PsiTreeUtil.getParentOfType(element,PyImportStatementBase.class) != null) {
      return;
    }
    final PsiFile originalFile=parameters.getOriginalFile();
    addVariantsFromIndex(result,originalFile,PyClassNameIndex.KEY,IMPORTING_INSERT_HANDLER,Conditions.<PyClass>alwaysTrue());
    addVariantsFromIndex(result,originalFile,PyFunctionNameIndex.KEY,FUNCTION_INSERT_HANDLER,IS_TOPLEVEL);
    addVariantsFromIndex(result,originalFile,PyVariableNameIndex.KEY,IMPORTING_INSERT_HANDLER,IS_TOPLEVEL);
    addVariantsFromModules(result,originalFile);
  }
}
