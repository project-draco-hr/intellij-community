{
  final Project project=targetFile.getProject();
  final GlobalSearchScope scope=PyClassNameIndex.projectWithLibrariesScope(project);
  Collection<String> keys=StubIndex.getInstance().getAllKeys(key,project);
  final List<String> allNames=new ArrayList<String>();
  for (  String s : keys) {
    if (resultSet.getPrefixMatcher().prefixMatches(s)) {
      allNames.add(s);
    }
  }
  Collections.sort(allNames);
  final LinkedHashSet<String> matchingNames=new LinkedHashSet<String>();
  for (  String name : allNames) {
    if (resultSet.getPrefixMatcher().isStartMatch(name)) {
      matchingNames.add(name);
    }
  }
  matchingNames.addAll(allNames);
  for (  final String elementName : matchingNames) {
    for (    T element : StubIndex.getInstance().get(key,elementName,project,scope)) {
      if (condition.value(element)) {
        resultSet.addElement(LookupElementBuilder.create(element).withIcon(element.getIcon(Iconable.ICON_FLAG_CLOSED)).withTailText(" " + ((NavigationItem)element).getPresentation().getLocationString(),true).withInsertHandler(insertHandler));
      }
    }
  }
}
