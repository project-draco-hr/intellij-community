{
  if (qualifiedName == null || sourceFile == null) {
    return Collections.emptyList();
  }
  final String marker=qualifiedName + "#" + Integer.toString(relativeLevel);
  final Set<String> beingImported=ourBeingImported.get();
  if (beingImported.contains(marker)) {
    return Collections.emptyList();
  }
  try {
    beingImported.add(marker);
    final QualifiedNameResolver visitor=new QualifiedNameResolverImpl(qualifiedName).fromElement(sourceFile);
    if (relativeLevel > 0) {
      visitor.withRelative(relativeLevel).withoutRoots();
    }
 else {
      if (!importIsAbsolute) {
        visitor.withRelative(0);
      }
    }
    List<PsiElement> results=visitor.resultsAsList();
    if (results.isEmpty() && relativeLevel == 0 && !importIsAbsolute) {
      results=resolveRelativeImportAsAbsolute(sourceFile,qualifiedName);
    }
    return results;
  }
  finally {
    beingImported.remove(marker);
  }
}
