{
  PsiElement imported_from_module;
  if (qualifiedName == null)   return null;
  String marker=StringUtil.join(qualifiedName,".") + "#" + Integer.toString(relative_level);
  Set<String> being_imported=ourBeingImported.get();
  if (being_imported.contains(marker))   return null;
  try {
    being_imported.add(marker);
    if (relative_level > 0) {
      imported_from_module=resolveModuleAt(stepBackFrom(source_file,relative_level),source_file,qualifiedName);
    }
 else {
      if (import_is_absolute)       imported_from_module=resolveModuleInRoots(qualifiedName,source_file);
 else {
        imported_from_module=resolveModuleAt(source_file.getContainingDirectory(),source_file,qualifiedName);
        if (imported_from_module == null)         imported_from_module=resolveModuleInRoots(qualifiedName,source_file);
      }
    }
    return imported_from_module;
  }
  finally {
    being_imported.remove(marker);
  }
}
