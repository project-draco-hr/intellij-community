{
  if (referencedName == null)   return null;
  final PsiDirectory subdir=dir.findSubdirectory(referencedName);
  if (subdir != null && (!checkForPackage || subdir.findFile(PyNames.INIT_DOT_PY) != null)) {
    return subdir;
  }
  final PsiElement module=findPyFileInDir(dir,referencedName);
  if (module != null)   return module;
  if (sdk != null) {
    PsiDirectory skeletonDir=findSkeletonDir(dir,root,sdk);
    if (skeletonDir != null) {
      final PsiFile skeletonFile=findPyFileInDir(skeletonDir,referencedName);
      if (skeletonFile != null) {
        return skeletonFile;
      }
    }
  }
  if (!isFileOnly) {
    final PsiFile initPy=dir.findFile(PyNames.INIT_DOT_PY);
    if (initPy == containingFile)     return null;
    if (initPy instanceof PyFileImpl) {
      return ((PyFileImpl)initPy).getElementNamed(referencedName,false);
    }
  }
  return null;
}
