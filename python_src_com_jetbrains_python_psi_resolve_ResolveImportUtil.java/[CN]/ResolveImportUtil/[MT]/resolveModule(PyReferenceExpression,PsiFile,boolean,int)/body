{
  PsiElement imported_from_module;
  String qualified_name=PyResolveUtil.toPath(module_reference,".") + "#" + Integer.toString(relative_level);
  Set<String> being_imported=ourBeingImported.get();
  if (being_imported.contains(qualified_name))   return null;
  try {
    being_imported.add(qualified_name);
    if (relative_level > 0) {
      imported_from_module=resolveModuleAt(stepBackFrom(source_file,relative_level),module_reference);
    }
 else {
      List<String> qualifiedName=getQualifiedName(module_reference);
      if (import_is_absolute)       imported_from_module=resolveModuleInRoots(qualifiedName,source_file);
 else {
        imported_from_module=resolveModuleAt(source_file.getContainingDirectory(),module_reference);
        if (imported_from_module == null)         imported_from_module=resolveModuleInRoots(qualifiedName,source_file);
      }
    }
    return imported_from_module;
  }
  finally {
    being_imported.remove(qualified_name);
  }
}
