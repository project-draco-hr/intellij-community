{
  PsiFile pfile=elt.getContainingFile();
  VirtualFile vfile=pfile.getVirtualFile();
  if (vfile == null) {
    pfile=pfile.getOriginalFile();
  }
  if (pfile != null) {
    PsiDirectory pdir=pfile.getContainingDirectory();
    if (pdir != null) {
      PsiElement child_elt=resolveChild(pdir,refName,pfile,true);
      if (child_elt != null)       return child_elt;
    }
  }
  final Module module=ModuleUtil.findModuleForPsiElement(elt);
  if (module != null) {
    ModuleRootManager rootManager=ModuleRootManager.getInstance(module);
    boolean source_entries_missing=true;
    for (    ContentEntry entry : rootManager.getContentEntries()) {
      VirtualFile root_file=entry.getFile();
      PsiElement ret=matchToFile(refName,elt.getManager(),root_file);
      if (ret != null)       return ret;
      for (      VirtualFile folder : entry.getSourceFolderFiles()) {
        source_entries_missing=false;
        ret=matchToFile(refName,elt.getManager(),folder);
        if (ret != null)         return ret;
      }
    }
    if (source_entries_missing) {
      VirtualFile project_root=module.getProject().getBaseDir();
      PsiElement ret=matchToFile(refName,elt.getManager(),project_root);
      if (ret != null)       return ret;
    }
    LookupRootVisitor visitor=new LookupRootVisitor(refName,elt.getManager());
    rootManager.processOrder(new SdkRootVisitingPolicy(visitor),null);
    return visitor.getResult();
  }
 else {
    final PsiFile elt_psifile=elt.getContainingFile();
    if (elt_psifile != null) {
      final VirtualFile elt_vfile=elt_psifile.getVirtualFile();
      if (elt_vfile != null) {
        for (        OrderEntry entry : ProjectRootManager.getInstance(elt.getProject()).getFileIndex().getOrderEntriesForFile(elt_vfile)) {
          PsiElement root_elt=resolveWithinRoots(entry.getFiles(OrderRootType.SOURCES),refName,elt.getProject());
          if (root_elt != null)           return root_elt;
        }
      }
    }
  }
  return null;
}
