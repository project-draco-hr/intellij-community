{
  PsiDirectory dir=null;
  PsiElement ret=null;
  PsiElement possible_ret=null;
  if (parent instanceof PyFile) {
    if (PyNames.INIT_DOT_PY.equals(((PyFile)parent).getName())) {
      dir=((PyFile)parent).getContainingDirectory();
      possible_ret=resolveInDirectory(referencedName,containingFile,dir,root,fileOnly);
    }
    ret=((PyFile)parent).getElementNamed(referencedName);
    if (PyUtil.instanceOf(ret,PyFunction.class,PyClass.class))     return ret;
    if (possible_ret != null)     return possible_ret;
  }
 else   if (parent instanceof PsiDirectory) {
    dir=(PsiDirectory)parent;
  }
 else   if (parent instanceof PsiDirectoryContainer) {
    final PsiDirectoryContainer container=(PsiDirectoryContainer)parent;
    for (    PsiDirectory childDir : container.getDirectories()) {
      final PsiElement result=resolveInDirectory(referencedName,containingFile,childDir,root,fileOnly);
      if (result != null)       return result;
    }
  }
  if (dir != null) {
    final PsiElement result=resolveInDirectory(referencedName,containingFile,dir,root,fileOnly);
    return result;
  }
  return ret;
}
