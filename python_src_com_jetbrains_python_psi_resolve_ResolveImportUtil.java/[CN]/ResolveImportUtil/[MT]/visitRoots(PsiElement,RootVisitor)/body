{
  final Module module=ModuleUtil.findModuleForPsiElement(elt);
  if (module != null) {
    ModuleRootManager rootManager=ModuleRootManager.getInstance(module);
    boolean sourceEntriesMissing=true;
    for (    ContentEntry entry : rootManager.getContentEntries()) {
      VirtualFile rootFile=entry.getFile();
      if (rootFile != null && !visitor.visitRoot(rootFile))       return;
      for (      VirtualFile folder : entry.getSourceFolderFiles()) {
        sourceEntriesMissing=false;
        if (!visitor.visitRoot(folder))         return;
      }
    }
    if (sourceEntriesMissing) {
      VirtualFile projectRoot=module.getProject().getBaseDir();
      if (projectRoot != null && !visitor.visitRoot(projectRoot))       return;
    }
    rootManager.processOrder(new SdkRootVisitingPolicy(visitor),null);
  }
 else {
    final PsiFile elt_psifile=elt.getContainingFile();
    if (elt_psifile != null) {
      final VirtualFile elt_vfile=elt_psifile.getVirtualFile();
      if (elt_vfile != null) {
        for (        OrderEntry entry : ProjectRootManager.getInstance(elt.getProject()).getFileIndex().getOrderEntriesForFile(elt_vfile)) {
          if (!visitGivenRoots(entry.getFiles(OrderRootType.SOURCES),visitor))           break;
          if (!visitGivenRoots(entry.getFiles(OrderRootType.CLASSES),visitor))           break;
        }
      }
    }
  }
}
