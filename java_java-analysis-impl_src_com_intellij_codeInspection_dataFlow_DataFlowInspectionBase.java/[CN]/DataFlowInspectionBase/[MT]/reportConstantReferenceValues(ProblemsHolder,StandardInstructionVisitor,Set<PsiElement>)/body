{
  for (  Pair<PsiReferenceExpression,DfaConstValue> pair : visitor.getConstantReferenceValues()) {
    PsiReferenceExpression ref=pair.first;
    if (ref.getParent() instanceof PsiReferenceExpression || !reportedAnchors.add(ref)) {
      continue;
    }
    final Object value=pair.second.getValue();
    PsiVariable constant=pair.second.getConstant();
    final String presentableName=constant != null ? constant.getName() : String.valueOf(value);
    final String exprText=String.valueOf(value);
    if (presentableName == null || exprText == null) {
      continue;
    }
    holder.registerProblem(ref,"Value <code>#ref</code> #loc is always '" + presentableName + "'",new LocalQuickFix(){
      @NotNull @Override public String getName(){
        return "Replace with '" + presentableName + "'";
      }
      @NotNull @Override public String getFamilyName(){
        return "Replace with constant value";
      }
      @Override public void applyFix(      @NotNull Project project,      @NotNull ProblemDescriptor descriptor){
        if (!FileModificationService.getInstance().preparePsiElementsForWrite(descriptor.getPsiElement())) {
          return;
        }
        PsiElement problemElement=descriptor.getPsiElement();
        if (problemElement == null)         return;
        JavaPsiFacade facade=JavaPsiFacade.getInstance(project);
        problemElement.replace(facade.getElementFactory().createExpressionFromText(exprText,null));
      }
    }
);
  }
}
