{
  Module module=createEmptyModule();
  if (addSource) {
    PsiTestUtil.addSourceRoot(module,module1Content,true);
  }
 else {
    PsiTestUtil.addContentRoot(module,module1Content);
  }
  VirtualFile mockJUnit=findFile(MOCK_JUNIT);
  ModuleRootModificationUtil.addModuleLibrary(module,mockJUnit.getUrl());
  ModuleRootModificationUtil.setModuleSdk(module,ModuleRootManager.getInstance(myModule).getSdk());
  GlobalSearchScope scope=GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(module);
  VirtualFile testCase=mockJUnit.findFileByRelativePath("junit/framework/TestCase.java");
  assertNotNull(testCase);
  assertTrue(scope.contains(testCase));
  Module missingModule=createTempModule();
  addDependency(module,missingModule);
  ModuleManager.getInstance(myProject).disposeModule(missingModule);
}
