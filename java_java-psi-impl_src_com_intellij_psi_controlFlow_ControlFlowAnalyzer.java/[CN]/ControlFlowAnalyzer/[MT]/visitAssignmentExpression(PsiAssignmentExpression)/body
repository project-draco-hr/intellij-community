{
  startElement(expression);
  PsiExpression rExpr=expression.getRExpression();
  myStartStatementStack.pushStatement(rExpr == null ? expression : rExpr,false);
  myEndStatementStack.pushStatement(rExpr == null ? expression : rExpr,false);
  PsiExpression lExpr=PsiUtil.skipParenthesizedExprDown(expression.getLExpression());
  if (lExpr instanceof PsiReferenceExpression) {
    PsiVariable variable=getUsedVariable((PsiReferenceExpression)lExpr);
    if (variable != null) {
      if (myAssignmentTargetsAreElements) {
        startElement(lExpr);
      }
      PsiExpression qualifier=((PsiReferenceExpression)lExpr).getQualifierExpression();
      if (qualifier != null) {
        qualifier.accept(this);
      }
      if (expression.getOperationTokenType() != JavaTokenType.EQ) {
        generateReadInstruction(variable);
      }
      if (rExpr != null) {
        rExpr.accept(this);
      }
      generateWriteInstruction(variable);
      if (myAssignmentTargetsAreElements)       finishElement(lExpr);
    }
 else {
      if (rExpr != null) {
        rExpr.accept(this);
      }
      lExpr.accept(this);
    }
  }
 else   if (lExpr instanceof PsiArrayAccessExpression && ((PsiArrayAccessExpression)lExpr).getArrayExpression() instanceof PsiReferenceExpression) {
    PsiVariable variable=getUsedVariable((PsiReferenceExpression)((PsiArrayAccessExpression)lExpr).getArrayExpression());
    if (variable != null) {
      generateReadInstruction(variable);
      final PsiExpression indexExpression=((PsiArrayAccessExpression)lExpr).getIndexExpression();
      if (indexExpression != null) {
        indexExpression.accept(this);
      }
    }
 else {
      lExpr.accept(this);
    }
    if (rExpr != null) {
      rExpr.accept(this);
    }
  }
 else   if (lExpr != null) {
    lExpr.accept(this);
    if (rExpr != null) {
      rExpr.accept(this);
    }
  }
  myStartStatementStack.popStatement();
  myEndStatementStack.popStatement();
  finishElement(expression);
}
