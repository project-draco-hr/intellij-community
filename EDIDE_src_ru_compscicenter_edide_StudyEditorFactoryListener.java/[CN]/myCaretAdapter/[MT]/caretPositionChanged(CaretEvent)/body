{
  Project project=e.getEditor().getProject();
  Editor selectedEditor=StudyEditor.getSelectedEditor(project);
  if (selectedEditor != null) {
    FileDocumentManager fileDocumentManager=FileDocumentManager.getInstance();
    VirtualFile openedFile=fileDocumentManager.getFile(selectedEditor.getDocument());
    if (openedFile != null) {
      StudyTaskManager taskManager=StudyTaskManager.getInstance(project);
      TaskFile selectedTaskFile=taskManager.getTaskFile(openedFile);
      LogicalPosition currentPos=e.getNewPosition();
      if (selectedTaskFile != null) {
        Window selectedTaskWindow=selectedTaskFile.getSelectedWindow();
        if (selectedTaskWindow == null) {
          Window currentWindow=selectedTaskFile.getTaskWindow(selectedEditor,currentPos);
          if (currentWindow == null) {
            HintManager.getInstance().showInformationHint(selectedEditor,"You should select some task window");
          }
 else {
            return;
          }
        }
 else {
          RangeHighlighter selectedRangeHighlighter=selectedTaskWindow.getRangeHighlighter();
          if (selectedRangeHighlighter != null) {
            int startOffset=selectedRangeHighlighter.getStartOffset();
            int endOffset=selectedRangeHighlighter.getEndOffset();
            int offset=selectedEditor.getDocument().getLineStartOffset(currentPos.line) + currentPos.column;
            if (startOffset <= offset && offset <= endOffset) {
              return;
            }
 else {
              DefaultActionGroup defaultActionGroup=new DefaultActionGroup();
              AnAction action=ActionManager.getInstance().getAction("ru.compscicenter.edide.actions.CheckAction");
              AnAction resolveAction=ActionManager.getInstance().getAction("ru.compscicenter.edide.actions.ResolveAction");
              AnAction nextAction=ActionManager.getInstance().getAction("NextWindow");
              AnAction prevAction=ActionManager.getInstance().getAction("PrevWindowAction");
              defaultActionGroup.add(action);
              defaultActionGroup.add(resolveAction);
              defaultActionGroup.add(nextAction);
              defaultActionGroup.add(prevAction);
              ListPopup popUp=JBPopupFactory.getInstance().createActionGroupPopup("What should we do with selected task window?",defaultActionGroup,DataManager.getInstance().getDataContext(e.getEditor().getComponent()),JBPopupFactory.ActionSelectionAid.MNEMONICS,true);
              popUp.showInBestPositionFor(DataManager.getInstance().getDataContext(e.getEditor().getComponent()));
            }
          }
        }
      }
    }
  }
}
