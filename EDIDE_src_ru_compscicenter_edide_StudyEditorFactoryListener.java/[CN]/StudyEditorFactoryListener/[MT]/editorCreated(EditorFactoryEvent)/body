{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      VirtualFile openedFile=FileDocumentManager.getInstance().getFile(event.getEditor().getDocument());
      if (openedFile != null) {
        PsiFile parentScope=PsiManager.getInstance(event.getEditor().getProject()).findFile(openedFile);
        final TemplateBuilder builder=TemplateBuilderFactory.getInstance().createTemplateBuilder(parentScope);
        final PsiElement[] childrenNodes=parentScope.getChildren();
        PsiElement replacedEl=childrenNodes[0].getChildren()[0];
        int offset=replacedEl.getTextOffset();
        builder.replaceElement(replacedEl,replacedEl.getText());
        Template template=((TemplateBuilderImpl)builder).buildInlineTemplate();
        TemplateManager.getInstance(event.getEditor().getProject()).startTemplate(event.getEditor(),template);
        System.out.println(replacedEl.getTextOffset());
        event.getEditor().getCaretModel().moveToOffset(offset);
      }
    }
  }
);
}
