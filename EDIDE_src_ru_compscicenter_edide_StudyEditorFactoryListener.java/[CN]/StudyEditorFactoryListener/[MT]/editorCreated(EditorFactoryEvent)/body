{
  Project project=event.getEditor().getProject();
  if (project == null) {
    return;
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            final Editor editor=event.getEditor();
            VirtualFile openedFile=FileDocumentManager.getInstance().getFile(editor.getDocument());
            if (openedFile != null) {
              HintManager.getInstance().showInformationHint(editor,"Select any window");
              StudyTaskManager taskManager=StudyTaskManager.getInstance(editor.getProject());
              ru.compscicenter.edide.course.TaskFile taskFile=taskManager.getTaskFile(openedFile);
              if (taskFile == null) {
                return;
              }
              taskFile.setLineNum(editor.getDocument().getLineCount());
              editor.addEditorMouseListener(new MyMouseListener(taskFile));
              editor.getCaretModel().addCaretListener(new myCaretAdapter());
              editor.getMarkupModel().removeAllHighlighters();
              taskFile.drawAllWindows(editor);
            }
          }
 catch (          Exception e) {
            e.printStackTrace();
            LOG.error(e.getMessage());
          }
        }
      }
);
    }
  }
);
}
