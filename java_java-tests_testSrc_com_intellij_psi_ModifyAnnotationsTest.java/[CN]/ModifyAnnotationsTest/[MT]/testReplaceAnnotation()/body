{
  PsiManagerEx.getInstanceEx(getProject()).setAssertOnFileLoadingFilter(VirtualFileFilter.ALL,myTestRootDisposable);
  PsiClass aClass=myJavaFacade.findClass("Test",GlobalSearchScope.allScope(myProject));
  assertNotNull(aClass);
  final PsiAnnotation[] annotations=aClass.getModifierList().getAnnotations();
  assertEquals(1,annotations.length);
  assertEquals("A",annotations[0].getNameReferenceElement().getReferenceName());
  final PsiAnnotation newAnnotation=myJavaFacade.getElementFactory().createAnnotationFromText("@B",null);
  PsiManagerEx.getInstanceEx(getProject()).setAssertOnFileLoadingFilter(VirtualFileFilter.NONE,myTestRootDisposable);
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    @Override public void run(){
      WriteCommandAction.runWriteCommandAction(null,new Runnable(){
        @Override public void run(){
          try {
            annotations[0].replace(newAnnotation);
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
,null,null);
  assertEquals("@B",aClass.getModifierList().getText());
}
