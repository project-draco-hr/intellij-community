{
  DocumentBuilderFactory dbFactory=DocumentBuilderFactory.newInstance();
  try {
    DocumentBuilder dBuilder=dbFactory.newDocumentBuilder();
    doc=dBuilder.parse(inputStream);
    NodeList protectedContent=(NodeList)xpath.evaluate("//*[@Protected='True']",doc,XPathConstants.NODESET);
    for (int i=0; i < protectedContent.getLength(); i++) {
      Element element=((Element)protectedContent.item(i));
      String base64=getElementContent(".",element);
      byte[] encrypted=DatatypeConverter.parseBase64Binary(base64);
      String decrypted=new String(encryption.decrypt(encrypted),"UTF-8");
      setElementContent(".",element,decrypted);
      element.removeAttribute("Protected");
    }
    return this;
  }
 catch (  ParserConfigurationException e) {
    throw new IllegalStateException("Instantiating Document Builder",e);
  }
catch (  SAXException e) {
    throw new IllegalStateException("Parsing exception",e);
  }
catch (  XPathExpressionException e) {
    throw new IllegalStateException("XPath Exception",e);
  }
}
