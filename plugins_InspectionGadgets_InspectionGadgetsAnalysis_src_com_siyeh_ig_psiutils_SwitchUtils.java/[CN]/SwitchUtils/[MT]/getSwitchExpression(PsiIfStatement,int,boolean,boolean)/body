{
  final PsiExpression condition=statement.getCondition();
  final LanguageLevel languageLevel=PsiUtil.getLanguageLevel(statement);
  final PsiExpression possibleSwitchExpression=determinePossibleSwitchExpressions(condition,languageLevel,nullSafe,stringEquality);
  if (!canBeSwitchExpression(possibleSwitchExpression,languageLevel)) {
    return null;
  }
  int branchCount=0;
  while (true) {
    branchCount++;
    if (!canBeMadeIntoCase(statement.getCondition(),possibleSwitchExpression,languageLevel,false,stringEquality)) {
      break;
    }
    final PsiStatement elseBranch=statement.getElseBranch();
    if (!(elseBranch instanceof PsiIfStatement)) {
      if (elseBranch != null) {
        branchCount++;
      }
      if (branchCount < minimumBranches) {
        return null;
      }
      return possibleSwitchExpression;
    }
    statement=(PsiIfStatement)elseBranch;
  }
  return null;
}
