{
  final List<String> modules=ContainerUtil.map(context.getCompileScope().getAffectedModules(),new Function<Module,String>(){
    @Override public String fun(    Module module){
      return ExternalSystemApiUtil.getExternalProjectPath(module);
    }
  }
);
  final Collection<Phase> phases=ContainerUtil.newArrayList();
  if (myBefore) {
    if (context.isRebuild()) {
      phases.add(Phase.BEFORE_REBUILD);
    }
    phases.add(Phase.BEFORE_COMPILE);
  }
 else {
    phases.add(Phase.AFTER_COMPILE);
    if (context.isRebuild()) {
      phases.add(Phase.AFTER_REBUILD);
    }
  }
  return runTasks(modules,ArrayUtil.toObjectArray(phases,Phase.class));
}
