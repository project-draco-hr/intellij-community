{
  this.graph=graph;
  this.fragmentManager=new FragmentManagerImpl(graph,new FragmentManagerImpl.CallBackFunction(){
    @Override public Replace runIntermediateUpdate(    @NotNull Node upNode,    @NotNull Node downNode){
      return GraphModelImpl.this.updateIntermediate(upNode,downNode);
    }
    @Override public void fullUpdate(){
      GraphModelImpl.this.fullUpdate();
    }
  }
);
  this.visibleNodes=new BranchVisibleNodes(graph);
  visibleNodes.setVisibleBranchesNodes(isStartedBranchVisibilityNode);
  graph.setGraphDecorator(new GraphDecorator(){
    private final GraphDecorator decorator=fragmentManager.getGraphDecorator();
    @Override public boolean isVisibleNode(    @NotNull Node node){
      return visibleNodes.isVisibleNode(node) && decorator.isVisibleNode(node);
    }
    @Override public Edge getHideFragmentDownEdge(    @NotNull Node node){
      return decorator.getHideFragmentDownEdge(node);
    }
    @Override public Edge getHideFragmentUpEdge(    @NotNull Node node){
      return decorator.getHideFragmentUpEdge(node);
    }
  }
);
  graph.updateVisibleRows();
}
