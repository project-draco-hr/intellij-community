{
  while (expression.getParent() instanceof PsiExpression) {
    final PsiExpression parent=(PsiExpression)expression.getParent();
    if (parent instanceof PsiConditionalExpression && ((PsiConditionalExpression)parent).getCondition() == expression)     break;
    expression=parent;
    if (expression instanceof PsiAssignmentExpression)     break;
    if (expression instanceof PsiBinaryExpression) {
      CachedValue<PsiExpression> value=expression.getUserData(TOP_LEVEL_EXPRESSION);
      if (value != null) {
        return value.getValue();
      }
    }
  }
  return expression;
}
