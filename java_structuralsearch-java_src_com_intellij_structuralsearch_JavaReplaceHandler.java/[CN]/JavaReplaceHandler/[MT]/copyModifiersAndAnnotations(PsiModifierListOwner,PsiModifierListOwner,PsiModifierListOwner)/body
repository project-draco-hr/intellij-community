{
  final PsiModifierList originalModifierList=original.getModifierList();
  final PsiModifierList queryModifierList=query.getModifierList();
  final PsiModifierList replacementModifierList=replacement.getModifierList();
  if (originalModifierList == null || queryModifierList == null || replacementModifierList == null) {
    return;
  }
  if (originalModifierList.getTextLength() != 0 && queryModifierList.getTextLength() == 0) {
    final PsiModifierList copy=(PsiModifierList)originalModifierList.copy();
    for (    String modifier : PsiModifier.MODIFIERS) {
      if (replacementModifierList.hasExplicitModifier(modifier)) {
        copy.setModifierProperty(modifier,true);
      }
    }
    final PsiElement anchor=copy.getFirstChild();
    for (    PsiAnnotation annotation : replacementModifierList.getAnnotations()) {
      copy.addBefore(annotation,anchor);
    }
    replacementModifierList.replace(copy);
  }
}
