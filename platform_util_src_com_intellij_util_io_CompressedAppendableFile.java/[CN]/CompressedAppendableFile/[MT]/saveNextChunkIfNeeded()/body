{
  if (myBufferPosition == myNextChunkBuffer.length) {
    BufferExposingByteArrayOutputStream compressedOut=new BufferExposingByteArrayOutputStream();
    DataOutputStream compressedDataOut=new DataOutputStream(compressedOut);
    compress(compressedDataOut,myNextChunkBuffer);
    compressedDataOut.close();
    saveChunk(compressedOut,myFileLength);
    myBufferPosition=0;
    initChunkLengthTable();
    myFileLength+=compressedOut.size();
    long[] newSegmentTable=new long[myChunkLengthTable.length + 1];
    System.arraycopy(myChunkLengthTable,0,newSegmentTable,0,myChunkLengthTable.length);
    newSegmentTable[myChunkLengthTable.length]=myFileLength;
    myChunkLengthTable=newSegmentTable;
    byte[] bytes=new byte[myAppendBufferLength];
    System.arraycopy(myNextChunkBuffer,0,bytes,0,myAppendBufferLength);
    ourDecompressedCache.put(this,myChunkLengthTable.length - 1,bytes);
  }
}
