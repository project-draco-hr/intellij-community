{
  DeepComparator comparator=myComparators.get(ui);
  if (comparator == null) {
    comparator=new DeepComparator(myProject,myRepositoryManager,ui,this);
    myComparators.put(ui,comparator);
    if (ui instanceof Disposable) {
      Disposer.register((Disposable)ui,new Disposable(){
        @Override public void dispose(){
          DeepComparator removed=myComparators.remove(ui);
          if (removed != null)           Disposer.dispose(removed);
        }
      }
);
    }
  }
  return comparator;
}
