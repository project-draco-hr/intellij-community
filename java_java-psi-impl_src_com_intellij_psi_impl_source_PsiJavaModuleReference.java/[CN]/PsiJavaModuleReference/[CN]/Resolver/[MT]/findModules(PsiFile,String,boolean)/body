{
  Project project=file.getProject();
  GlobalSearchScope scope=null;
  if (incompleteCode || file.getOriginalFile() instanceof PsiCompiledFile) {
    scope=GlobalSearchScope.allScope(project);
  }
 else {
    VirtualFile vFile=file.getVirtualFile();
    if (vFile != null) {
      Module module=FileIndexFacade.getInstance(project).getModuleForFile(vFile);
      if (module != null) {
        scope=module.getModuleWithDependenciesAndLibrariesScope(false);
      }
    }
  }
  return scope != null ? JavaFileManager.SERVICE.getInstance(project).findModules(moduleName,scope) : Collections.<PsiJavaModule>emptyList();
}
