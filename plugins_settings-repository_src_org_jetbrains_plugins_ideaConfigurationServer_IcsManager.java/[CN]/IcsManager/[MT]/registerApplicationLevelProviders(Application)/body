{
  try {
    settings.load();
  }
 catch (  Exception e) {
    LOG.error(e);
  }
  connectAndUpdateRepository(application);
  IcsStreamProvider streamProvider=new IcsStreamProvider(null){
    @NotNull @Override public Collection<String> listSubFiles(    @NotNull String fileSpec,    @NotNull RoamingType roamingType){
      return repositoryManager.listSubFileNames(IcsUrlBuilder.buildPath(fileSpec,roamingType,null));
    }
    @Override public void deleteFile(    @NotNull String fileSpec,    @NotNull RoamingType roamingType){
      if (writeAndDeleteProhibited) {
        throw new IllegalStateException("Delete is prohibited now");
      }
      repositoryManager.delete(IcsUrlBuilder.buildPath(fileSpec,roamingType,null));
      scheduleCommit();
    }
  }
;
  StateStorageManager storageManager=((ApplicationImpl)application).getStateStore().getStateStorageManager();
  storageManager.setStreamProvider(streamProvider);
  Collection<String> storageFileNames=storageManager.getStorageFileNames();
  if (!storageFileNames.isEmpty()) {
    updateStoragesFromStreamProvider(storageManager,storageFileNames);
    SchemesManagerFactory.getInstance().updateConfigFilesFromStreamProviders();
  }
}
