{
  StateStorageManager manager=((ProjectEx)project).getStateStore().getStateStorageManager();
  String projectId=getProjectId(project);
  manager.registerStreamProvider(new ICSStreamProvider(projectId),RoamingType.PER_PLATFORM);
  manager.registerStreamProvider(new ICSStreamProvider(projectId){
    private static final String WORKSPACE_VERSION_FILE=StoragePathMacros.WORKSPACE_FILE + XmlElementStorage.VERSION_FILE_SUFFIX;
    @Override public void saveContent(    @NotNull String fileSpec,    @NotNull InputStream content,    long size,    @NotNull RoamingType roamingType,    boolean async) throws IOException {
      if (isShareable(fileSpec)) {
        super.saveContent(fileSpec,content,size,roamingType,async);
      }
    }
    private boolean isShareable(    String fileSpec){
      return settings.shareProjectWorkspace || (!fileSpec.equals(StoragePathMacros.WORKSPACE_FILE) && !fileSpec.equals(WORKSPACE_VERSION_FILE));
    }
    @Nullable @Override public InputStream loadContent(    @NotNull String fileSpec,    @NotNull RoamingType roamingType) throws IOException {
      return isShareable(fileSpec) ? super.loadContent(fileSpec,roamingType) : null;
    }
  }
,RoamingType.PER_USER);
}
