{
  final ChangeListManager changeListManager=ChangeListManager.getInstance(project);
  LocalChangeList defaultChangeList=changeListManager.getDefaultChangeList();
  final FilePath[] roots=getRoots(context);
  LocalChangeList changeList=null;
  for (  final FilePath root : roots) {
    final VirtualFile file=root.getVirtualFile();
    if (file == null)     continue;
    Collection<LocalChangeList> lists=getChangeListsForRoot(changeListManager,root);
    if (lists.contains(defaultChangeList)) {
      return defaultChangeList;
    }
    Iterator<LocalChangeList> it=lists.iterator();
    changeList=it.hasNext() ? it.next() : null;
  }
  return changeList == null ? defaultChangeList : changeList;
}
