{
  final PsiFile psiFile=file.getContainingFile();
  if (psiFile != null) {
    final PsiDocumentManager manager=PsiDocumentManager.getInstance(project);
    manager.commitDocument(manager.getDocument(psiFile));
  }
  if (file instanceof PsiFile)   matchContext.getSink().processFile((PsiFile)file);
  if (progress != null) {
    progress.setFraction((double)scannedFilesCount / totalFilesToScan);
  }
  ++scannedFilesCount;
  if (file instanceof PsiIdentifier) {
    file=file.getParent();
  }
  match(file);
  file=null;
}
