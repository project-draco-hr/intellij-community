{
  CollectingMatchResultSink sink=new CollectingMatchResultSink();
  try {
    PsiElement[] elements=MatcherImplUtil.createSourceTreeFromText(source,filePattern ? PatternTreeContext.File : PatternTreeContext.Block,sourceFileType,sourceExtension,project,physicalSourceFile);
    options.setSearchPattern(pattern);
    options.setScope(new LocalSearchScope(elements));
    testFindMatches(sink,options);
  }
 catch (  IncorrectOperationException e) {
    MalformedPatternException exception=new MalformedPatternException();
    exception.initCause(e);
    throw exception;
  }
  return sink.getMatches();
}
