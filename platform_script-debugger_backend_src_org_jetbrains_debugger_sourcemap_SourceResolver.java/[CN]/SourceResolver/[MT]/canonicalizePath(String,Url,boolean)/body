{
  String path=url;
  if (url.charAt(0) != '/') {
    String basePath=baseUrl.getPath();
    if (baseUrlIsFile) {
      int lastSlashIndex=basePath.lastIndexOf('/');
      StringBuilder pathBuilder=new StringBuilder();
      if (lastSlashIndex == -1) {
        pathBuilder.append('/');
      }
 else {
        pathBuilder.append(basePath,0,lastSlashIndex + 1);
      }
      path=pathBuilder.append(url).toString();
    }
 else {
      path=basePath + '/' + url;
    }
  }
  path=FileUtil.toCanonicalPath(path,'/');
  return path;
}
