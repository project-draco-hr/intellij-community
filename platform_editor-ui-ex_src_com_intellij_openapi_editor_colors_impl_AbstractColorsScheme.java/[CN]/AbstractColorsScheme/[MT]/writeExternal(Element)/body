{
  parentNode.setAttribute(NAME_ATTR,getName());
  parentNode.setAttribute(VERSION_ATTR,Integer.toString(myVersion));
  if (myParentScheme != null && myParentScheme != EmptyColorScheme.INSTANCE) {
    parentNode.setAttribute(PARENT_SCHEME_ATTR,myParentScheme.getName());
  }
  if (!myMetaInfo.isEmpty()) {
    parentNode.addContent(metaInfoToElement());
  }
  if (getLineSpacing() != 1) {
    addOptionTag(parentNode,LINE_SPACING,String.valueOf(getLineSpacing()));
  }
  boolean useOldFontFormat=myFontPreferences.getEffectiveFontFamilies().size() <= 1;
  if (useOldFontFormat) {
    addOptionTag(parentNode,EDITOR_FONT_SIZE,String.valueOf(getEditorFontSize()));
  }
 else {
    writeFontPreferences(EDITOR_FONT,parentNode,myFontPreferences);
  }
  writeLigaturesPreferences(parentNode,myFontPreferences,EDITOR_LIGATURES);
  if (!myFontPreferences.equals(myConsoleFontPreferences)) {
    if (myConsoleFontPreferences.getEffectiveFontFamilies().size() <= 1) {
      addOptionTag(parentNode,CONSOLE_FONT_NAME,getConsoleFontName());
      if (getConsoleFontSize() != getEditorFontSize()) {
        addOptionTag(parentNode,CONSOLE_FONT_SIZE,Integer.toString(getConsoleFontSize()));
      }
    }
 else {
      writeFontPreferences(CONSOLE_FONT,parentNode,myConsoleFontPreferences);
    }
    writeLigaturesPreferences(parentNode,myConsoleFontPreferences,CONSOLE_LIGATURES);
  }
  if (getConsoleLineSpacing() != getLineSpacing()) {
    addOptionTag(parentNode,CONSOLE_LINE_SPACING,Float.toString(getConsoleLineSpacing()));
  }
  if (DEFAULT_FONT_SIZE != getQuickDocFontSize()) {
    addOptionTag(parentNode,EDITOR_QUICK_JAVADOC_FONT_SIZE,getQuickDocFontSize().toString());
  }
  if (useOldFontFormat) {
    addOptionTag(parentNode,EDITOR_FONT_NAME,getEditorFontName());
  }
  Element colorElements=new Element(COLORS_ELEMENT);
  Element attrElements=new Element(ATTRIBUTES_ELEMENT);
  writeColors(colorElements);
  writeAttributes(attrElements);
  if (!colorElements.getChildren().isEmpty()) {
    parentNode.addContent(colorElements);
  }
  if (!attrElements.getChildren().isEmpty()) {
    parentNode.addContent(attrElements);
  }
  myIsSaveNeeded=false;
}
