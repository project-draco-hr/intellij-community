{
  myHistory=history;
  myNavigator=navigator;
  setLayout(new BorderLayout());
  myModel=new DefaultListModel();
  myList=new JBList(myModel);
  myList.setBackground(UIUtil.SIDE_PANEL_BACKGROUND);
  myList.setBorder(new EmptyBorder(5,0,0,0));
  final ListItemDescriptor descriptor=new ListItemDescriptor(){
    @Override public String getTextFor(    final Object value){
      return myPlace2Presentation.get(value).getText();
    }
    @Override public String getTooltipFor(    final Object value){
      return getTextFor(value);
    }
    @Override public Icon getIconFor(    final Object value){
      return EmptyIcon.create(16,20);
    }
    @Override public boolean hasSeparatorAboveOf(    final Object value){
      return getSeparatorAbove((Place)value) != null;
    }
    @Override public String getCaptionAboveOf(    final Object value){
      return getSeparatorAbove((Place)value);
    }
  }
;
  myList.setCellRenderer(new GroupedItemsListRenderer(descriptor){
    JPanel myExtraPanel;
    SidePanelCountLabel myCountLabel;
    CellRendererPane myValidationParent=new CellRendererPane();
{
      mySeparatorComponent.setCaptionCentered(false);
      myList.add(myValidationParent);
    }
    @Override protected Color getForeground(){
      return new JBColor(Gray._60,Gray._140);
    }
    @Override protected SeparatorWithText createSeparator(){
      return new SidePanelSeparator();
    }
    @Override protected void layout(){
      myRendererComponent.add(mySeparatorComponent,BorderLayout.NORTH);
      myExtraPanel.add(myComponent,BorderLayout.CENTER);
      myExtraPanel.add(myCountLabel,BorderLayout.EAST);
      myRendererComponent.add(myExtraPanel,BorderLayout.CENTER);
    }
    @Override public Component getListCellRendererComponent(    JList list,    Object value,    int index,    boolean isSelected,    boolean cellHasFocus){
      layout();
      myCountLabel.setText("");
      final Component component=super.getListCellRendererComponent(list,value,index,isSelected,cellHasFocus);
      if ("Problems".equals(descriptor.getTextFor(value))) {
        final ErrorPaneConfigurable errorPane=(ErrorPaneConfigurable)((Place)value).getPath("category");
        int errorsCount;
        if (errorPane != null && (errorsCount=errorPane.getErrorsCount()) > 0) {
          myCountLabel.setSelected(isSelected);
          myCountLabel.setText(errorsCount > 100 ? "100+" : String.valueOf(errorsCount));
        }
      }
      if (UIUtil.isClientPropertyTrue(list,ExpandableItemsHandler.EXPANDED_RENDERER)) {
        Rectangle bounds=list.getCellBounds(index,index);
        bounds.setSize((int)component.getPreferredSize().getWidth(),(int)bounds.getHeight());
        AbstractExpandableItemsHandler.setRelativeBounds(component,bounds,myExtraPanel,myValidationParent);
        myExtraPanel.setSize((int)myExtraPanel.getPreferredSize().getWidth(),myExtraPanel.getHeight());
        UIUtil.putClientProperty(myExtraPanel,ExpandableItemsHandler.USE_RENDERER_BOUNDS,true);
        return myExtraPanel;
      }
      return component;
    }
    @Override protected JComponent createItemComponent(){
      myExtraPanel=new NonOpaquePanel(new BorderLayout());
      myCountLabel=new SidePanelCountLabel();
      final JComponent component=super.createItemComponent();
      myTextLabel.setForeground(Gray._240);
      myTextLabel.setOpaque(true);
      return component;
    }
    @Override protected Color getBackground(){
      return UIUtil.SIDE_PANEL_BACKGROUND;
    }
  }
);
  add(ScrollPaneFactory.createScrollPane(myList,true),BorderLayout.CENTER);
  myList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  myList.addListSelectionListener(new ListSelectionListener(){
    @Override public void valueChanged(    final ListSelectionEvent e){
      if (e.getValueIsAdjusting())       return;
      final Object value=myList.getSelectedValue();
      if (value != null) {
        myNavigator.navigateTo(((Place)value),false);
      }
    }
  }
);
}
