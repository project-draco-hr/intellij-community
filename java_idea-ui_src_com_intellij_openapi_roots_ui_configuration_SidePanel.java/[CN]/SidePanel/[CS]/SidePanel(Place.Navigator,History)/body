{
  myHistory=history;
  myNavigator=navigator;
  setLayout(new BorderLayout());
  myModel=new DefaultListModel();
  myList=new JBList(myModel);
  if (Registry.is("ide.new.project.settings")) {
    myList.setBackground(UIUtil.getSidePanelColor());
    myList.setBorder(new EmptyBorder(5,0,0,0));
  }
  final ListItemDescriptor descriptor=new ListItemDescriptor(){
    @Override public String getTextFor(    final Object value){
      return myPlace2Presentation.get(value).getText();
    }
    @Override public String getTooltipFor(    final Object value){
      return getTextFor(value);
    }
    @Override public Icon getIconFor(    final Object value){
      return Registry.is("ide.new.project.settings") ? EmptyIcon.create(16,20) : null;
    }
    @Override public boolean hasSeparatorAboveOf(    final Object value){
      final int index=myPlaces.indexOf(value);
      return myIndex2Separator.get(index) != null;
    }
    @Override public String getCaptionAboveOf(    final Object value){
      return myIndex2Separator.get(myPlaces.indexOf(value));
    }
  }
;
  myList.setCellRenderer(new GroupedItemsListRenderer(descriptor){
    JPanel myExtraPanel;
    CountLabel myCountLabel;
{
      mySeparatorComponent.setCaptionCentered(false);
    }
    @Override protected Color getForeground(){
      return Registry.is("ide.new.project.settings") ? new JBColor(Gray._60,Gray._140) : super.getForeground();
    }
    @Override protected SeparatorWithText createSeparator(){
      return new SeparatorWithText(){
        @Override protected void paintComponent(        Graphics g){
          if (Registry.is("ide.new.project.settings")) {
            final JBColor separatorColor=new JBColor(POPUP_SEPARATOR_FOREGROUND,Gray._80);
            g.setColor(separatorColor);
            if ("--".equals(getCaption())) {
              final GraphicsConfig config=GraphicsUtil.setupAAPainting(g);
              final int h=getHeight() / 2;
              g.drawLine(30,h,getWidth() - 30,h);
              ((Graphics2D)g).setPaint(new GradientPaint(5,h,ColorUtil.toAlpha(separatorColor,0),30,h,separatorColor));
              g.drawLine(5,h,30,h);
              ((Graphics2D)g).setPaint(new GradientPaint(getWidth() - 5,h,ColorUtil.toAlpha(separatorColor,0),getWidth() - 30,h,separatorColor));
              g.drawLine(getWidth() - 5,h,getWidth() - 30,h);
              config.restore();
              return;
            }
            Rectangle viewR=new Rectangle(0,getVgap(),getWidth() - 1,getHeight() - getVgap() - 1);
            Rectangle iconR=new Rectangle();
            Rectangle textR=new Rectangle();
            String s=SwingUtilities.layoutCompoundLabel(g.getFontMetrics(),getCaption(),null,CENTER,LEFT,CENTER,LEFT,viewR,iconR,textR,0);
            GraphicsUtil.setupAAPainting(g);
            g.setColor(new JBColor(Gray._255.withAlpha(80),Gray._0.withAlpha(80)));
            g.drawString(s,textR.x + 10,textR.y + 1 + g.getFontMetrics().getAscent());
            g.setColor(new JBColor(new Color(0x5F6D7B),Gray._120));
            g.drawString(s,textR.x + 10,textR.y + g.getFontMetrics().getAscent());
          }
 else {
            super.paintComponent(g);
          }
        }
      }
;
    }
    @Override protected void layout(){
      if (Registry.is("ide.new.project.settings")) {
        myRendererComponent.add(mySeparatorComponent,BorderLayout.NORTH);
        myExtraPanel.add(myComponent,BorderLayout.CENTER);
        myExtraPanel.add(myCountLabel,BorderLayout.EAST);
        myRendererComponent.add(myExtraPanel,BorderLayout.CENTER);
      }
 else {
        super.layout();
      }
    }
    @Override public Component getListCellRendererComponent(    JList list,    Object value,    int index,    boolean isSelected,    boolean cellHasFocus){
      myCountLabel.setText("");
      final Component component=super.getListCellRendererComponent(list,value,index,isSelected,cellHasFocus);
      if ("Problems".equals(descriptor.getTextFor(value))) {
        final ErrorPaneConfigurable errorPane=(ErrorPaneConfigurable)((Place)value).getPath("category");
        if (errorPane != null && errorPane.getErrorsCount() > 0) {
          myCountLabel.setSelected(isSelected);
          myCountLabel.setText(String.valueOf(errorPane.getErrorsCount()));
        }
      }
      return component;
    }
    @Override protected JComponent createItemComponent(){
      myExtraPanel=new NonOpaquePanel(new BorderLayout());
      myCountLabel=new CountLabel();
      final JComponent component=super.createItemComponent();
      if (Registry.is("ide.new.project.settings")) {
        myTextLabel.setForeground(Gray._240);
        myTextLabel.setOpaque(true);
      }
      return component;
    }
    @Override protected Color getBackground(){
      return Registry.is("ide.new.project.settings") ? UIUtil.getSidePanelColor() : super.getBackground();
    }
  }
);
  add(ScrollPaneFactory.createScrollPane(myList,Registry.is("ide.new.project.settings")),BorderLayout.CENTER);
  myList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  myList.addListSelectionListener(new ListSelectionListener(){
    @Override public void valueChanged(    final ListSelectionEvent e){
      if (e.getValueIsAdjusting())       return;
      final Object value=myList.getSelectedValue();
      if (value != null) {
        myNavigator.navigateTo(((Place)value),false);
      }
    }
  }
);
}
