{
  final Map<String,PsiNamedElement> namedElements=new HashMap<String,PsiNamedElement>();
  final List<NameDefiner> nameDefiners=new ArrayList<NameDefiner>();
  final List<Scope> nestedScopes=new ArrayList<Scope>();
  final Set<String> globals=new HashSet<String>();
  final Set<String> nonlocals=new HashSet<String>();
  myFlowOwner.acceptChildren(new PyRecursiveElementVisitor(){
    @Override public void visitPyTargetExpression(    PyTargetExpression node){
      final PsiElement parent=node.getParent();
      if (node.getQualifier() == null && !(parent instanceof PyImportElement)) {
        super.visitPyTargetExpression(node);
      }
    }
    @Override public void visitPyGlobalStatement(    PyGlobalStatement node){
      for (      PyTargetExpression expression : node.getGlobals()) {
        final String name=expression.getReferencedName();
        globals.add(name);
        namedElements.put(name,expression);
      }
      super.visitPyGlobalStatement(node);
    }
    @Override public void visitPyNonlocalStatement(    PyNonlocalStatement node){
      for (      PyTargetExpression expression : node.getVariables()) {
        nonlocals.add(expression.getReferencedName());
      }
      super.visitPyNonlocalStatement(node);
    }
    @Override public void visitPyElement(    PyElement node){
      if (node instanceof PsiNamedElement) {
        namedElements.put(node.getName(),(PsiNamedElement)node);
      }
      if (node instanceof NameDefiner && !(node instanceof PsiNamedElement || node instanceof PyParameterList)) {
        nameDefiners.add((NameDefiner)node);
      }
      if (node instanceof ScopeOwner) {
        final Scope scope=ControlFlowCache.getScope((ScopeOwner)node);
        nestedScopes.add(scope);
      }
 else {
        super.visitPyElement(node);
      }
    }
  }
);
  myNamedElements=namedElements;
  myNameDefiners=nameDefiners;
  myNestedScopes=nestedScopes;
  myGlobals=globals;
  myNonlocals=nonlocals;
}
