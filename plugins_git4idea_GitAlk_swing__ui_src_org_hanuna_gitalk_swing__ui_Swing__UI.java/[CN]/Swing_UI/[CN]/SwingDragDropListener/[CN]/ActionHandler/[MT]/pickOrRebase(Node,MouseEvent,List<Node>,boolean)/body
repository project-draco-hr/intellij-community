{
  Mode mode=getMode(e);
  if (mode == Mode.CHERRY_PICK) {
    if (myConditions.sameBranch(commit,commitsBeingDragged)) {
      return FORBIDDEN;
    }
    return CHERRY_PICK;
  }
  Node topCommit=commitsBeingDragged.get(0);
  boolean hasLabelOnTop=!getLocalRefs(topCommit.getCommitHash()).isEmpty();
  boolean interactive=getMode(e) == Mode.INTERACTIVE;
  if (commitsBeingDragged.size() == 1 && hasLabelOnTop) {
    if (interactive) {
      return REBASE_WHOLE_BRANCH_ONTO_COMMIT_UNDER_CURSOR_INTERACTIVE;
    }
    return REBASE_WHOLE_BRANCH_ONTO_COMMIT_UNDER_CURSOR;
  }
 else {
    if (interactive && hasLabelOnTop) {
      return REBASE_WHOLE_BRANCH_ONTO_COMMIT_UNDER_CURSOR_INTERACTIVE;
    }
    if (!getLocalRefsAbove(commit).isEmpty()) {
      return CHERRY_PICK;
    }
 else {
      return FORBIDDEN_NO_LOCAL_BRANCH;
    }
  }
}
