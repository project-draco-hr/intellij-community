{
  try {
    try {
      File patchFile=Utils.createTempFile();
      ZipFile jarFile=new ZipFile(resolveJarFile());
      logger.info("Extracting patch file...");
      ui.startProcess("Extracting patch file...");
      ui.setProgressIndeterminate();
      try {
        InputStream in=Utils.getEntryInputStream(jarFile,PATCH_FILE_NAME);
        OutputStream out=new BufferedOutputStream(new FileOutputStream(patchFile));
        try {
          Utils.copyStream(in,out);
        }
 catch (        Exception ex) {
          printStackTrace(ex);
        }
 finally {
          in.close();
          out.close();
        }
      }
 catch (      Exception ex) {
        printStackTrace(ex);
      }
 finally {
        jarFile.close();
      }
      ui.checkCancelled();
      File destDir=new File(destFolder);
      PatchFileCreator.PreparationResult result=PatchFileCreator.prepareAndValidate(patchFile,destDir,ui);
      Map<String,ValidationResult.Option> options=ui.askUser(result.validationResults);
      return PatchFileCreator.apply(result,options,ui);
    }
 catch (    IOException e) {
      ui.showError(e);
      printStackTrace(e);
    }
  }
 catch (  Exception ex) {
    printStackTrace(ex);
  }
 finally {
    try {
      cleanup(ui);
    }
 catch (    IOException e) {
      ui.showError(e);
      printStackTrace(e);
    }
  }
  return false;
}
