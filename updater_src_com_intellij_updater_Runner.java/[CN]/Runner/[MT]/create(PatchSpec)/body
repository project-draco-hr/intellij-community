{
  UpdaterUI ui=new ConsoleUpdaterUI();
  try {
    File tempPatchFile=Utils.createTempFile();
    PatchFileCreator.create(spec,tempPatchFile,ui);
    logger.info("Packing JAR file: " + spec.getPatchFile());
    ui.startProcess("Packing JAR file '" + spec.getPatchFile() + "'...");
    FileOutputStream fileOut=new FileOutputStream(spec.getPatchFile());
    try {
      ZipOutputWrapper out=new ZipOutputWrapper(fileOut);
      ZipInputStream in=new ZipInputStream(new FileInputStream(new File(spec.getJarFile())));
      try {
        ZipEntry e;
        while ((e=in.getNextEntry()) != null) {
          out.zipEntry(e,in);
        }
      }
  finally {
        in.close();
      }
      out.zipFile(PATCH_FILE_NAME,tempPatchFile);
      out.finish();
    }
  finally {
      fileOut.close();
    }
  }
  finally {
    cleanup(ui);
  }
}
