{
  UpdaterUI ui=new ConsoleUpdaterUI();
  try {
    File tempPatchFile=Utils.createTempFile();
    PatchFileCreator.create(spec,tempPatchFile,ui);
    logger().info("Packing JAR file: " + spec.getPatchFile());
    ui.startProcess("Packing JAR file '" + spec.getPatchFile() + "'...");
    try (ZipOutputWrapper out=new ZipOutputWrapper(new FileOutputStream(spec.getPatchFile()));ZipInputStream in=new ZipInputStream(new FileInputStream(new File(spec.getJarFile())))){
      ZipEntry e;
      while ((e=in.getNextEntry()) != null) {
        out.zipEntry(e,in);
      }
      out.zipFile(PATCH_FILE_NAME,tempPatchFile);
      out.finish();
    }
   }
  finally {
    cleanup(ui);
  }
}
