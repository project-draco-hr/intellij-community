{
  myProject=project;
  myMessageBus=messageBus;
  mySerialization=new ProjectLevelVcsManagerSerialization();
  myOptionsAndConfirmations=new OptionsAndConfirmations();
  myDefaultVcsRootPolicy=DefaultVcsRootPolicy.getInstance(project);
  myInitialization=new VcsInitialization(myProject);
  Disposer.register(project,myInitialization);
  myMappings=new NewMappings(myProject,myMessageBus,this,manager);
  myMappingsToRoots=new MappingsToRoots(myMappings,myProject);
  myVcsHistoryCache=new VcsHistoryCache();
  myContentRevisionCache=new ContentRevisionCache();
  myConnect=myMessageBus.connect();
  myVcsFileListenerContextHelper=VcsFileListenerContextHelper.getInstance(myProject);
  VcsListener vcsListener=new VcsListener(){
    @Override public void directoryMappingChanged(){
      myVcsHistoryCache.clear();
      myVcsFileListenerContextHelper.possiblySwitchActivation(hasActiveVcss());
    }
  }
;
  myExcludedIndex=excludedFileIndex;
  myConnect.subscribe(ProjectLevelVcsManager.VCS_CONFIGURATION_CHANGED,vcsListener);
  myConnect.subscribe(ProjectLevelVcsManager.VCS_CONFIGURATION_CHANGED_IN_PLUGIN,vcsListener);
  myConnect.subscribe(UpdatedFilesListener.UPDATED_FILES,new UpdatedFilesListener(){
    @Override public void consume(    Set<String> strings){
      myContentRevisionCache.clearCurrent(strings);
    }
  }
);
  myAnnotationLocalChangesListener=new VcsAnnotationLocalChangesListenerImpl(myProject,this);
}
