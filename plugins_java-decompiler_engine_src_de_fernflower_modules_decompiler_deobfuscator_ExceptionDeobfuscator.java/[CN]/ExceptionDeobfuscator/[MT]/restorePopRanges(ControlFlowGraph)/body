{
  List<Object[]> lstRanges=new ArrayList<Object[]>();
  for (  ExceptionRangeCFG range : graph.getExceptions()) {
    boolean found=false;
    for (    Object[] arr : lstRanges) {
      if (arr[0] == range.getHandler() && InterpreterUtil.equalObjects(range.getUniqueExceptionsString(),arr[1])) {
        ((HashSet<BasicBlock>)arr[2]).addAll(range.getProtectedRange());
        found=true;
        break;
      }
    }
    if (!found) {
      lstRanges.add(new Object[]{range.getHandler(),range.getUniqueExceptionsString(),new HashSet<BasicBlock>(range.getProtectedRange()),range});
    }
  }
  for (  Object[] range : lstRanges) {
    if (range[1] != null) {
      BasicBlock handler=(BasicBlock)range[0];
      InstructionSequence seq=handler.getSeq();
      Instruction firstinstr=null;
      if (seq.length() > 0) {
        firstinstr=seq.getInstr(0);
        if (firstinstr.opcode == CodeConstants.opc_pop || firstinstr.opcode == CodeConstants.opc_astore) {
          HashSet<BasicBlock> setrange=new HashSet<BasicBlock>((HashSet<BasicBlock>)range[2]);
          for (          Object[] range_super : lstRanges) {
            if (range != range_super) {
              HashSet<BasicBlock> setrange_super=new HashSet<BasicBlock>((HashSet<BasicBlock>)range_super[2]);
              if (!setrange.contains(range_super[0]) && !setrange_super.contains(handler) && (range_super[1] == null || setrange_super.containsAll(setrange))) {
                if (range_super[1] == null) {
                  setrange_super.retainAll(setrange);
                }
 else {
                  setrange_super.removeAll(setrange);
                }
                if (!setrange_super.isEmpty()) {
                  BasicBlock newblock=handler;
                  if (seq.length() > 1) {
                    newblock=new BasicBlock(++graph.last_id);
                    InstructionSequence newseq=new SimpleInstructionSequence();
                    newseq.addInstruction(firstinstr.clone(),-1);
                    newblock.setSeq(newseq);
                    graph.getBlocks().addWithKey(newblock,newblock.id);
                    List<BasicBlock> lstTemp=new ArrayList<BasicBlock>();
                    lstTemp.addAll(handler.getPreds());
                    lstTemp.addAll(handler.getPredExceptions());
                    for (                    BasicBlock pred : lstTemp) {
                      pred.replaceSuccessor(handler,newblock);
                    }
                    for (                    ExceptionRangeCFG range_ext : graph.getExceptions()) {
                      if (range_ext.getHandler() == handler) {
                        range_ext.setHandler(newblock);
                      }
 else                       if (range_ext.getProtectedRange().contains(handler)) {
                        newblock.addSuccessorException(range_ext.getHandler());
                        range_ext.getProtectedRange().add(newblock);
                      }
                    }
                    newblock.addSuccessor(handler);
                    if (graph.getFirst() == handler) {
                      graph.setFirst(newblock);
                    }
                    seq.removeInstruction(0);
                  }
                  newblock.addSuccessorException((BasicBlock)range_super[0]);
                  ((ExceptionRangeCFG)range_super[3]).getProtectedRange().add(newblock);
                  handler=((ExceptionRangeCFG)range[3]).getHandler();
                  seq=handler.getSeq();
                }
              }
            }
          }
        }
      }
    }
  }
}
