{
  final RunnerAndConfigurationSettings settings=cloneTemplateConfiguration(context);
  final Ref<PsiElement> locationRef=new Ref<PsiElement>(context.getPsiLocation());
  T configuration=null;
  try {
    configuration=(T)settings.getConfiguration();
  }
 catch (  ClassCastException e) {
    LOG.error(myConfigurationFactory + " produced wrong type",e);
    return null;
  }
  if (!setupConfigurationFromContext(configuration,context,locationRef)) {
    return null;
  }
  return new ConfigurationFromContextImpl(this,settings,locationRef.get());
}
