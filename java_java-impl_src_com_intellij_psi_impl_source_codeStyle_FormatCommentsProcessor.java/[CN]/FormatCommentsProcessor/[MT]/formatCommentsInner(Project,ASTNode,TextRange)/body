{
  TextRange resultTextRange=markedRange;
  boolean shouldFormat=markedRange.contains(element.getTextRange());
  if (shouldFormat) {
    TextRange before=element.getTextRange();
    new CommentFormatter(project).processComment(element);
    int deltaRange=element.getTextRange().getLength() - before.getLength();
    resultTextRange=new TextRange(markedRange.getStartOffset(),markedRange.getEndOffset() + deltaRange);
  }
  final PsiElement elementPsi=element.getPsi();
  if ((shouldFormat && (elementPsi instanceof PsiMethod || elementPsi instanceof PsiField || elementPsi instanceof PsiDocComment)) || markedRange.getEndOffset() < element.getStartOffset()) {
    return resultTextRange;
  }
  ASTNode current=element.getFirstChildNode();
  while (current != null) {
    if (!(shouldFormat && current.getPsi() instanceof PsiDocComment && elementPsi instanceof PsiClass)) {
      resultTextRange=formatCommentsInner(project,current,resultTextRange);
    }
    current=current.getTreeNext();
  }
  return resultTextRange;
}
