{
  HgRepository repository=getRepositoryManager(project).getRepositoryForFile(file);
  if (repository == null) {
    LOG.error("Couldn't find repository for " + file.getName());
    return;
  }
  final FilePath filePath=VcsUtil.getFilePath(file);
  final VirtualFile repositoryRoot=repository.getRoot();
  final HgFile hgFile=new HgFile(repositoryRoot,filePath);
  final HgRevisionNumber compareWithRevisionNumber=HgRevisionNumber.getInstance(branchToCompare,getBranchMainHash(repository,branchToCompare).toString());
  List<Change> changes=HgUtil.getDiff(project,repositoryRoot,filePath,compareWithRevisionNumber,null);
  VcsDiffUtil.showDiffFor(project,changes.isEmpty() && !filePath.isDirectory() ? createChangesWithCurrentContentForFile(filePath,HgContentRevision.create(project,hgFile,compareWithRevisionNumber)) : changes,VcsDiffUtil.getRevisionTitle(branchToCompare,false),VcsDiffUtil.getRevisionTitle(head,true),filePath);
}
