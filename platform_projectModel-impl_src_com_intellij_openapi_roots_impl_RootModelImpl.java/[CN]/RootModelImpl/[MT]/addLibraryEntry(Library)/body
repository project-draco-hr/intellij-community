{
  assertWritable();
  final LibraryOrderEntry libraryOrderEntry=new LibraryOrderEntryImpl(library,this,myProjectRootManager);
  if (libraryOrderEntry.isValid()) {
    LibraryEx libraryEx=ObjectUtils.tryCast(library,LibraryEx.class);
    boolean libraryDisposed=libraryEx != null ? libraryEx.isDisposed() : Disposer.isDisposed(library);
    throw new AssertionError("Invalid libraryOrderEntry, library: " + library + " of type "+ library.getClass()+ ", disposed: "+ libraryDisposed+ ", kind: "+ (libraryEx != null ? libraryEx.getKind() : "<undefined>"));
  }
  myOrderEntries.add(libraryOrderEntry);
  return libraryOrderEntry;
}
