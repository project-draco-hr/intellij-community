{
  final ProgressManager progman=ProgressManager.getInstance();
  final Sdk basicSdk=getSdk();
  final Task.Modal createTask=new Task.Modal(myProject,"Creating virtual environment",false){
    String myPath;
    public void run(    @NotNull final ProgressIndicator indicator){
      try {
        indicator.setText("Creating virtual environment");
        myPath=createEnvironment(basicSdk);
      }
 catch (      final ExecutionException e) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            final PackageManagementService.ErrorDescription description=PyPackageManagementService.toErrorDescription(Collections.singletonList(e),basicSdk);
            if (description != null) {
              PackagesNotificationPanel.showError("Failed to Create Virtual Environment",description);
            }
          }
        }
,ModalityState.any());
        throw new RuntimeException(e);
      }
    }
    @Override public void onSuccess(){
      if (myPath != null) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            DumbService.allowStartingDumbModeInside(DumbModePermission.MAY_START_BACKGROUND,new Runnable(){
              @Override public void run(){
                setupVirtualEnvSdk(myPath,associateWithProject(),callback);
              }
            }
);
          }
        }
);
      }
    }
  }
;
  progman.run(createTask);
}
