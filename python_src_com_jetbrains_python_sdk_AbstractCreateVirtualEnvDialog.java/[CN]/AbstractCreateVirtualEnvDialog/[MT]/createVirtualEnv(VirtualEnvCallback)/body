{
  final ProgressManager progman=ProgressManager.getInstance();
  final Sdk basicSdk=getSdk();
  final Task.Modal createTask=new Task.Modal(myProject,PyBundle.message("sdk.create.venv.dialog.creating.venv"),false){
    String myPath;
    public void run(    @NotNull final ProgressIndicator indicator){
      try {
        indicator.setText(PyBundle.message("sdk.create.venv.dialog.creating.venv"));
        myPath=createEnvironment(basicSdk);
      }
 catch (      final ExecutionException e) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            final PackageManagementService.ErrorDescription description=PyPackageManagementService.toErrorDescription(Collections.singletonList(e),basicSdk);
            if (description != null) {
              PackagesNotificationPanel.showError(PyBundle.message("sdk.create.venv.dialog.error.failed.to.create.venv"),description);
            }
          }
        }
,ModalityState.any());
      }
    }
    @Override public void onSuccess(){
      if (myPath != null) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            DumbService.allowStartingDumbModeInside(DumbModePermission.MAY_START_BACKGROUND,new Runnable(){
              @Override public void run(){
                setupVirtualEnvSdk(myPath,associateWithProject(),callback);
              }
            }
);
          }
        }
);
      }
    }
  }
;
  progman.run(createTask);
}
