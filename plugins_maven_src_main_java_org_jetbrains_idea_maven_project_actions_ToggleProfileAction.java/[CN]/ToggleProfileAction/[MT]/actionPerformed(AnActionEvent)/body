{
  MavenProjectsManager manager=MavenActionUtil.getProjectsManager(e.getDataContext());
  if (manager == null)   return;
  Map<String,MavenProfileKind> selectedProfiles=e.getData(MavenDataKeys.MAVEN_PROFILES);
  Set<String> selectedProfileIds=selectedProfiles.keySet();
  MavenProfileKind targetState=getTargetState(manager,selectedProfiles);
  MavenExplicitProfiles newExplicitProfiles=manager.getExplicitProfiles().clone();
switch (targetState) {
case NONE:
    newExplicitProfiles.getEnabledProfiles().removeAll(selectedProfileIds);
  newExplicitProfiles.getDisabledProfiles().addAll(selectedProfileIds);
break;
case EXPLICIT:
newExplicitProfiles.getDisabledProfiles().removeAll(selectedProfileIds);
newExplicitProfiles.getEnabledProfiles().addAll(selectedProfileIds);
break;
case IMPLICIT:
default :
newExplicitProfiles.getEnabledProfiles().removeAll(selectedProfileIds);
newExplicitProfiles.getDisabledProfiles().removeAll(selectedProfileIds);
break;
}
manager.setExplicitProfiles(newExplicitProfiles);
}
