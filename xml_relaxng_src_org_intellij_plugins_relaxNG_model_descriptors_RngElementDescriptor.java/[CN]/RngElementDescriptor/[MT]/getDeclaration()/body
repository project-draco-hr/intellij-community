{
  final SmartPsiElementPointer<? extends PsiElement> declaration=myDeclaration;
  if (declaration != null) {
    final PsiElement element=declaration.getElement();
    if (element != null && element.isValid()) {
      return element;
    }
  }
  final PsiElement decl=myNsDescriptor.getDeclaration();
  if (decl == null) {
    myDeclaration=null;
    return null;
  }
  final PsiElement element=getDeclarationImpl(decl,myElementPattern.getLocation());
  if (element != null && element != decl) {
    myDeclaration=SmartPointerManager.getInstance(decl.getProject()).createSmartPsiElementPointer(element);
  }
  return element;
}
