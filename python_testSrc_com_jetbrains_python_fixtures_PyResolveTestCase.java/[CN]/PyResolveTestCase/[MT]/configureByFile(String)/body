{
  VirtualFile testDataRoot=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(new File(getTestDataPath()));
  final VirtualFile file=testDataRoot.findFileByRelativePath(filePath);
  assertNotNull(file);
  String fileText;
  try {
    fileText=StringUtil.convertLineSeparators(VfsUtil.loadText(file));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  int offset=fileText.indexOf(MARKER);
  assertTrue(offset >= 0);
  fileText=fileText.substring(0,offset) + fileText.substring(offset + MARKER.length());
  final String finalFileText=fileText;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        myFixture.configureByText(new File(filePath).getName(),finalFileText);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  final PsiReference reference=myFixture.getFile().findReferenceAt(offset);
  return reference;
}
