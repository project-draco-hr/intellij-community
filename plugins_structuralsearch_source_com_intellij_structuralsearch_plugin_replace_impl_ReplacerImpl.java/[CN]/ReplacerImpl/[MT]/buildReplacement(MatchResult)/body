{
  List<SmartPsiElementPointer> l=new LinkedList<SmartPsiElementPointer>();
  SmartPointerManager manager=SmartPointerManager.getInstance(project);
  if (MatchResult.MULTI_LINE_MATCH.equals(result.getName())) {
    for (Iterator i=result.getSons(); i.hasNext(); ) {
      final MatchResult r=(MatchResult)i.next();
      if (MatchResult.LINE_MATCH.equals(r.getName())) {
        l.add(manager.createSmartPsiElementPointer(r.getMatchRef().getElement()));
      }
    }
  }
 else {
    l.add(manager.createSmartPsiElementPointer(result.getMatchRef().getElement()));
  }
  ReplacementInfoImpl replacementInfo=new ReplacementInfoImpl();
  replacementInfo.matchesPtrList=l;
  if (replacementBuilder == null) {
    replacementBuilder=new ReplacementBuilder(project,options.getReplacement(),options.getMatchOptions().getFileType());
  }
  replacementInfo.result=replacementBuilder.process(result,replacementInfo);
  replacementInfo.matchResult=result;
  return replacementInfo;
}
