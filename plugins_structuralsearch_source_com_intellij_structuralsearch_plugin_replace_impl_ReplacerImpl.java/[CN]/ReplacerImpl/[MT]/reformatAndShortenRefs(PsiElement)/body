{
  if (elementParent == null)   return;
  final Runnable action=new Runnable(){
    public void run(){
      CodeStyleManager codeStyleManager=PsiManager.getInstance(project).getCodeStyleManager();
      final PsiFile containingFile=elementParent.getContainingFile();
      if (containingFile != null) {
        if (options.isToShortenFQN()) {
          if (containingFile.getVirtualFile() != null) {
            PsiDocumentManager.getInstance(project).commitDocument(FileDocumentManager.getInstance().getDocument(containingFile.getVirtualFile()));
          }
          JavaCodeStyleManager.getInstance(project).shortenClassReferences(elementParent,0,elementParent.getTextLength());
        }
        if (options.isToReformatAccordingToStyle()) {
          if (containingFile.getVirtualFile() != null) {
            PsiDocumentManager.getInstance(project).commitDocument(FileDocumentManager.getInstance().getDocument(containingFile.getVirtualFile()));
          }
          final int paretOffset=elementParent.getTextRange().getStartOffset();
          codeStyleManager.reformatRange(containingFile,paretOffset,paretOffset + elementParent.getTextLength(),true);
        }
      }
    }
  }
;
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(action);
    }
  }
,"reformat and shorten refs after ssr","test");
}
