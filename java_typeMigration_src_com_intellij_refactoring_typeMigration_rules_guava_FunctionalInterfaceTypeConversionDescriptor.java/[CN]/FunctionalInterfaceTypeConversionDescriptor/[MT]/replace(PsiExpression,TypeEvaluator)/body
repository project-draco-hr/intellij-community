{
  if (expression.getParent() instanceof PsiMethodReferenceExpression) {
    expression=(PsiExpression)expression.getParent();
  }
  if (expression instanceof PsiMethodReferenceExpression) {
    setAsMethodReference((PsiMethodReferenceExpression)expression);
  }
 else   if (expression instanceof PsiReferenceExpression) {
    setAsReference();
  }
 else {
    setAsMethodCall();
  }
  return super.replace(expression,evaluator);
}
