{
  final PsiElement paramParent=param.getParent();
  if (paramParent instanceof PsiParameterList) {
    final int parameterIndex=((PsiParameterList)paramParent).getParameterIndex(param);
    if (parameterIndex > -1) {
      final PsiLambdaExpression lambdaExpression=PsiTreeUtil.getParentOfType(param,PsiLambdaExpression.class);
      if (lambdaExpression != null) {
        final PsiType functionalInterfaceType=LambdaUtil.ourParameterGuard.doPreventingRecursion(param,false,new Computable<PsiType>(){
          @Override public PsiType compute(){
            return LambdaUtil.getFunctionalInterfaceType(lambdaExpression,true);
          }
        }
);
        PsiType type=FunctionalInterfaceParameterizationUtil.getGroundTargetType(functionalInterfaceType,lambdaExpression);
        if (type instanceof PsiIntersectionType) {
          final PsiType[] conjuncts=((PsiIntersectionType)type).getConjuncts();
          for (          PsiType conjunct : conjuncts) {
            final PsiType lambdaParameterFromType=LambdaUtil.getLambdaParameterFromType(conjunct,parameterIndex);
            if (lambdaParameterFromType != null) {
              return lambdaParameterFromType;
            }
          }
        }
 else {
          final PsiType lambdaParameterFromType=LambdaUtil.getLambdaParameterFromType(type,parameterIndex);
          if (lambdaParameterFromType != null) {
            return lambdaParameterFromType;
          }
        }
      }
    }
  }
  return new PsiLambdaParameterType(param);
}
