{
  Editor editor=e.getEditor();
  if (!BreakoutMode.getInstance().isEnabled(editor)) {
    return;
  }
  EditorImpl editorImpl=(EditorImpl)editor;
  editor.getCaretModel().removeSecondaryCarets();
  editor.getSelectionModel().removeSelection();
  Point currentPoint=e.getMouseEvent().getPoint();
  if (currentChar == null) {
    if (lastLocation == null) {
      return;
    }
    Sprite sprite=createSpriteFor(editorImpl,lastLocation);
    if (sprite == null) {
      return;
    }
    editorImpl.setCaretEnabled(false);
    RangeHighlighter highlighter=editor.getUserData(HIGHLIGHTER_KEY);
    if (highlighter == null) {
      highlighter=createRenderingHighlighter(editorImpl);
      editor.putUserData(HIGHLIGHTER_KEY,highlighter);
    }
    currentChar=sprite;
  }
 else {
    if (lastLocation != null) {
      int newDx=currentPoint.x - lastLocation.x;
      int newDy=currentPoint.y - lastLocation.y;
      currentChar.position.translate(newDx,newDy);
      currentChar.requestRepaintInEditor(editorImpl);
      if (newDx * newDx + newDy * newDy < 10) {
        dx+=newDx;
        dy+=newDy;
      }
 else {
        dx=newDx;
        dy=newDy;
      }
    }
  }
  lastLocation=currentPoint;
}
