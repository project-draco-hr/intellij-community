{
  setStacktraceIfNotSet(stackTrace);
  final TestComparisionFailedState comparisionFailedState=new TestComparisionFailedState(localizedMessage,stackTrace,actualText,expectedText,expectedFilePath,actualFilePath);
  if (myState instanceof CompoundTestFailedState) {
    ((CompoundTestFailedState)myState).addFailure(comparisionFailedState);
  }
 else   if (myState instanceof TestFailedState) {
    final CompoundTestFailedState states=new CompoundTestFailedState(localizedMessage,stackTrace);
    states.addFailure((TestFailedState)myState);
    states.addFailure(comparisionFailedState);
    myState=states;
  }
 else {
    myState=comparisionFailedState;
  }
  fireOnNewPrintable(comparisionFailedState);
}
