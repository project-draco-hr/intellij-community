{
  super.update(e);
  Presentation presentation=e.getPresentation();
  if (!presentation.isEnabled()) {
    return;
  }
  presentation.setText(ActionsBundle.actionText(IdeActions.ACTION_COMPILE));
  presentation.setVisible(true);
  Project project=e.getProject();
  if (project == null) {
    presentation.setEnabled(false);
    return;
  }
  CompilerConfiguration compilerConfiguration=CompilerConfiguration.getInstance(project);
  final Module module=e.getData(LangDataKeys.MODULE_CONTEXT);
  final VirtualFile[] files=getCompilableFiles(project,e.getData(CommonDataKeys.VIRTUAL_FILE_ARRAY));
  if (module == null && files.length == 0) {
    presentation.setEnabled(false);
    presentation.setVisible(!ActionPlaces.isPopupPlace(e.getPlace()));
    return;
  }
  String elementDescription=null;
  if (module != null) {
    elementDescription=CompilerBundle.message("action.compile.description.module",module.getName());
  }
 else {
    PsiPackage aPackage=null;
    if (files.length == 1) {
      final PsiDirectory directory=PsiManager.getInstance(project).findDirectory(files[0]);
      if (directory != null) {
        aPackage=JavaDirectoryService.getInstance().getPackage(directory);
      }
    }
 else {
      PsiElement element=e.getData(CommonDataKeys.PSI_ELEMENT);
      if (element instanceof PsiPackage) {
        aPackage=(PsiPackage)element;
      }
    }
    if (aPackage != null) {
      String name=aPackage.getQualifiedName();
      if (name.length() == 0) {
        name="<default>";
      }
      elementDescription="'" + name + "'";
    }
 else     if (files.length == 1) {
      final VirtualFile file=files[0];
      FileType fileType=file.getFileType();
      if (CompilerManager.getInstance(project).isCompilableFileType(fileType) || compilerConfiguration.isCompilableResourceFile(project,file)) {
        elementDescription="'" + file.getName() + "'";
      }
 else {
        if (!ActionPlaces.isMainMenuOrActionSearch(e.getPlace())) {
          presentation.setEnabled(false);
          presentation.setVisible(false);
          return;
        }
      }
    }
 else {
      elementDescription=CompilerBundle.message("action.compile.description.selected.files");
    }
  }
  if (elementDescription == null) {
    presentation.setEnabled(false);
    return;
  }
  presentation.setText(createPresentationText(elementDescription),true);
  presentation.setEnabled(true);
}
