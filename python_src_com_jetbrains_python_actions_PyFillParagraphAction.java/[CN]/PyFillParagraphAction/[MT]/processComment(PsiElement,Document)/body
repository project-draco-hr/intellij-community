{
  final TextRange textRange=getTextRange(element);
  final String text=textRange.substring(element.getContainingFile().getText());
  final List<String> strings=StringUtil.split(text,"\n",true);
  StringBuilder stringBuilder=new StringBuilder();
  for (  String string : strings) {
    stringBuilder.append(StringUtil.trimStart(string.trim(),getCommentPrefix())).append(" ");
  }
  final String newText=stringBuilder.toString();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      document.replaceString(textRange.getStartOffset(),textRange.getEndOffset(),getCommentPrefix() + newText);
      CodeStyleManager.getInstance(element.getProject()).reformatText(element.getContainingFile(),textRange.getStartOffset(),textRange.getStartOffset() + newText.length() + 1);
    }
  }
);
}
