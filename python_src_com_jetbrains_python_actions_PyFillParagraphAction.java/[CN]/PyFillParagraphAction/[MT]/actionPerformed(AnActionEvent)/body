{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project == null)   return;
  PsiElement element=e.getData(LangDataKeys.PSI_ELEMENT);
  if (element == null) {
    final PsiElement file=e.getData(LangDataKeys.PSI_FILE);
    Editor editor=e.getData(PlatformDataKeys.EDITOR);
    if (file != null && editor != null) {
      final int offset=editor.getCaretModel().getOffset();
      element=file.findElementAt(offset);
    }
  }
  if (!(element instanceof PsiComment))   element=PsiTreeUtil.getParentOfType(element,PyStringLiteralExpression.class);
  if (element != null) {
    final TextRange textRange=getTextRange(element);
    final PsiElement finalElement=element;
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        CodeStyleManager.getInstance(project).reformatRange(finalElement.getContainingFile(),textRange.getStartOffset(),textRange.getEndOffset());
      }
    }
);
  }
}
