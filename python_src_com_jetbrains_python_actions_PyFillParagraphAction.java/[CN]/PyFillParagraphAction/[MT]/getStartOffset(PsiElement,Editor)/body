{
  int offset=editor.getCaretModel().getOffset();
  final int elementTextOffset=element.getTextOffset();
  final Document document=editor.getDocument();
  int lineNumber=document.getLineNumber(offset);
  while (lineNumber != document.getLineNumber(elementTextOffset)) {
    final String text=document.getText(TextRange.create(document.getLineStartOffset(lineNumber),document.getLineEndOffset(lineNumber)));
    if (StringUtil.isEmptyOrSpaces(text)) {
      final int lineStartOffset=document.getLineStartOffset(lineNumber + 1);
      final String lineText=document.getText(TextRange.create(lineStartOffset,document.getLineEndOffset(lineNumber + 1)));
      int shift=StringUtil.findFirst(lineText,CharFilter.NOT_WHITESPACE_FILTER);
      return lineStartOffset + shift;
    }
    lineNumber-=1;
  }
  return elementTextOffset;
}
