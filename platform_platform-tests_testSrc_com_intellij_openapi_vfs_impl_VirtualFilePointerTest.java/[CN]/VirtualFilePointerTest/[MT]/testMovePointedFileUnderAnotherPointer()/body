{
  File tempDirectory=createTempDirectory();
  final File moveTarget=new File(tempDirectory,"moveTarget");
  moveTarget.mkdir();
  final File fileToMove=new File(tempDirectory,"toMove.txt");
  fileToMove.createNewFile();
  final LoggingListener listener=new LoggingListener();
  final LoggingListener targetListener=new LoggingListener();
  final VirtualFilePointer fileToMovePointer=createPointerByFile(fileToMove,listener);
  final VirtualFilePointer fileToMoveTargetPointer=createPointerByFile(new File(moveTarget,fileToMove.getName()),targetListener);
  assertFalse(fileToMoveTargetPointer.isValid());
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final VirtualFile virtualFile=getVirtualFile(fileToMove);
      assertTrue(virtualFile.isValid());
      final VirtualFile target=getVirtualFile(moveTarget);
      assertTrue(target.isValid());
      try {
        virtualFile.move(null,target);
      }
 catch (      IOException e) {
        fail();
      }
    }
  }
);
  assertTrue(fileToMovePointer.isValid());
  assertTrue(fileToMoveTargetPointer.isValid());
  assertEquals("[]",listener.getLog().toString());
  assertEquals("[before:false, after:true]",targetListener.getLog().toString());
}
