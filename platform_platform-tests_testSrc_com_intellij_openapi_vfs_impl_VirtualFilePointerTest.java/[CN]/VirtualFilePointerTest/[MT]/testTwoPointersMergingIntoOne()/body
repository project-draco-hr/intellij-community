{
  File tempDirectory=createTempDirectory();
  final VirtualFile root=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDirectory);
  VirtualFile dir1=createChildDirectory(root,"dir1");
  VirtualFile dir2=createChildDirectory(root,"dir2");
  VirtualFilePointer p1=myVirtualFilePointerManager.create(dir1,disposable,null);
  VirtualFilePointer p2=myVirtualFilePointerManager.create(dir2,disposable,null);
  assertTrue(p1.isValid());
  assertEquals(dir1,p1.getFile());
  assertTrue(p2.isValid());
  assertEquals(dir2,p2.getFile());
  delete(dir1);
  assertEquals(null,p1.getFile());
  assertEquals(dir2,p2.getFile());
  rename(dir2,"dir1");
  assertEquals(dir2,p1.getFile());
  assertEquals(dir2,p2.getFile());
  rename(dir2,"dir2");
  assertEquals(dir2,p1.getFile());
  assertEquals(dir2,p2.getFile());
  createChildDirectory(root,"dir1");
  assertEquals(dir2,p1.getFile());
  assertEquals(dir2,p2.getFile());
}
