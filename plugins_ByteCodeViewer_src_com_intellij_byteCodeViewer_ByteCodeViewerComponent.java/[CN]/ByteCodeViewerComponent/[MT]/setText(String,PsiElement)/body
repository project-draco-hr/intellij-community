{
  int offset=0;
  PsiFile psiFile=element.getContainingFile();
  final Document document=PsiDocumentManager.getInstance(element.getProject()).getDocument(psiFile);
  if (document != null) {
    int lineNumber=document.getLineNumber(element.getTextOffset());
    VirtualFile file=psiFile.getVirtualFile();
    if (file != null) {
      LineNumbersMapping mapping=file.getUserData(LineNumbersMapping.LINE_NUMBERS_MAPPING_KEY);
      if (mapping != null) {
        int mappedLine=mapping.sourceToBytecode(lineNumber);
        while (mappedLine == -1 && lineNumber < document.getLineCount()) {
          mappedLine=mapping.sourceToBytecode(++lineNumber);
        }
        if (mappedLine > 0) {
          lineNumber=mappedLine;
        }
      }
    }
    offset=bytecode.indexOf("LINENUMBER " + lineNumber);
    while (offset == -1 && lineNumber < document.getLineCount()) {
      offset=bytecode.indexOf("LINENUMBER " + (lineNumber++));
    }
  }
  setText(bytecode,Math.max(0,offset));
}
