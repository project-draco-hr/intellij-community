{
  final VirtualFile taskDir=file.getParent();
  VirtualFile fileWindows=null;
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  if (document == null) {
    LOG.debug("Couldn't flush windows");
    return null;
  }
  if (taskDir != null) {
    final String name=file.getNameWithoutExtension() + "_windows";
    PrintWriter printWriter=null;
    try {
      fileWindows=taskDir.createChildData(taskFile,name);
      printWriter=new PrintWriter(new FileOutputStream(fileWindows.getPath()));
      for (      AnswerPlaceholder answerPlaceholder : taskFile.getAnswerPlaceholders()) {
        if (!answerPlaceholder.isValid(document)) {
          printWriter.println("#educational_plugin_window = ");
          continue;
        }
        int start=answerPlaceholder.getRealStartOffset(document);
        int length=useLength ? answerPlaceholder.getLength() : answerPlaceholder.getPossibleAnswerLength();
        final String windowDescription=document.getText(new TextRange(start,start + length));
        printWriter.println("#educational_plugin_window = " + windowDescription);
      }
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          FileDocumentManager.getInstance().saveDocument(document);
        }
      }
);
    }
 catch (    IOException e) {
      LOG.error(e);
    }
 finally {
      if (printWriter != null) {
        printWriter.close();
      }
      synchronize();
    }
  }
  return fileWindows;
}
