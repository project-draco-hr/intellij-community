{
  final List<VirtualFile> result=new ArrayList<VirtualFile>(5);
  Processor<VirtualFile> processor=Processors.cancelableCollectProcessor(result);
  collectVirtualFilesWithWord(word,occurrenceMask,scope,caseSensitively,processor);
  if (result.isEmpty())   return true;
  final Processor<VirtualFile> virtualFileProcessor=new ReadActionProcessor<VirtualFile>(){
    @Override public boolean processInReadAction(    VirtualFile virtualFile){
      if (virtualFile.isValid()) {
        final PsiFile psiFile=myPsiManager.findFile(virtualFile);
        return psiFile == null || psiFileProcessor.process(psiFile);
      }
      return true;
    }
  }
;
  for (  VirtualFile vFile : result) {
    ProgressIndicatorProvider.checkCanceled();
    if (!virtualFileProcessor.process(vFile)) {
      return false;
    }
  }
  return true;
}
