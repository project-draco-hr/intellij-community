{
  FileManager fileManager=myPsiManager.getFileManager();
  VirtualFile file=myPrjDir1.createChildDirectory(null,"dir1");
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  assertNull(((FileManagerImpl)fileManager).getCachedDirectory(file));
  EventsTestListener listener=new EventsTestListener();
  myPsiManager.addPsiTreeChangeListener(listener,getTestRootDisposable());
  file.rename(null,"dir2");
  String string=listener.getEventsString();
  String expected="beforePropertyChange propUnloadedPsi\n" + "propertyChanged propUnloadedPsi\n";
  assertEquals(fileManager.findDirectory(file).getName(),expected,string);
}
