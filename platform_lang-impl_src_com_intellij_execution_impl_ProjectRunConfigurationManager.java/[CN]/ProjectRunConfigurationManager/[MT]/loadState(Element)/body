{
  Set<String> existing=new THashSet<String>();
  try {
    myUnloadedElements=null;
    for (    Element child : state.getChildren()) {
      RunnerAndConfigurationSettings configuration=myManager.loadConfiguration(child,true);
      if (configuration == null && Comparing.strEqual(state.getName(),RunManagerImpl.CONFIGURATION)) {
        if (myUnloadedElements == null) {
          myUnloadedElements=new SmartList<Element>();
        }
        myUnloadedElements.add(state);
      }
      if (configuration != null) {
        existing.add(configuration.getUniqueID());
      }
    }
  }
 catch (  InvalidDataException e) {
    LOG.error(e);
  }
  myManager.removeNotExistingSharedConfigurations(existing);
  if (myManager.getSelectedConfiguration() == null) {
    final List<RunConfiguration> allConfigurations=myManager.getAllConfigurationsList();
    for (    final RunConfiguration configuration : allConfigurations) {
      final RunnerAndConfigurationSettings settings=myManager.getSettings(allConfigurations.get(0));
      if (!(configuration instanceof UnknownRunConfiguration)) {
        myManager.setSelectedConfiguration(settings);
        break;
      }
    }
  }
  myManager.setOrdered(false);
  myManager.getSortedConfigurations();
}
