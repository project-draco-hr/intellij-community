{
  VirtualFile f=getVirtualFile();
  byte[] oldContent=LocalHistory.getByteContent(myProject,f,new FileRevisionTimestampComparator(){
    public boolean isSuitable(    long revisionTimestamp){
      return revisionTimestamp < date;
    }
  }
);
  if (oldContent == null)   return null;
  String[] coveredLines=getCoveredLines(oldContent,f);
  String[] currentLines=getUpToDateLines();
  String[] oldLines=oldToNew ? coveredLines : currentLines;
  String[] newLines=oldToNew ? currentLines : coveredLines;
  Diff.Change change=Diff.buildChanges(oldLines,newLines);
  return new SoftReference<TIntIntHashMap>(getCoverageVersionToCurrentLineMapping(change,oldLines.length));
}
