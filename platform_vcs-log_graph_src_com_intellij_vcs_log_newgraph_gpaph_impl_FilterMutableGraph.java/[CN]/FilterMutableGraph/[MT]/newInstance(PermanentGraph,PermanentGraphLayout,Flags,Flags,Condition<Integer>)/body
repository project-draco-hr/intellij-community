{
  for (int i=0; i < permanentGraph.nodesCount(); i++) {
    visibleNodes.set(i,isVisibleNode.value(i) && visibleNodesInBranches.get(i));
  }
  TreeIntToIntMap visibleToReal=TreeIntToIntMap.newInstance(new BooleanFunction<Integer>(){
    @Override public boolean fun(    Integer integer){
      return visibleNodes.get(integer);
    }
  }
,permanentGraph.nodesCount());
  return new FilterMutableGraph(permanentGraph,layout,isVisibleNode,visibleToReal,visibleNodes);
}
