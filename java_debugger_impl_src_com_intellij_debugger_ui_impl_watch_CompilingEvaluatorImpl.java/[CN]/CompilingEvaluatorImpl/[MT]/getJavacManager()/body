{
  DebuggerManagerThreadImpl.assertIsManagerThread();
  final DebugProcessImpl debugProcess=myEvaluationContext.getDebugProcess();
  ExternalJavacManager manager=JAVAC_MANAGER_KEY.get(debugProcess);
  if (manager == null && debugProcess.isAttached()) {
    final File compilerWorkingDir=getCompilerWorkingDir();
    if (compilerWorkingDir == null) {
      return null;
    }
    final int listenPort=NetUtils.findAvailableSocketPort();
    manager=new ExternalJavacManager(compilerWorkingDir);
    manager.start(listenPort);
    final ExternalJavacManager _manager=manager;
    debugProcess.addDebugProcessListener(new DebugProcessAdapter(){
      public void processDetached(      DebugProcess process,      boolean closedByUser){
        if (process == debugProcess) {
          _manager.stop();
        }
      }
    }
);
    JAVAC_MANAGER_KEY.set(debugProcess,manager);
  }
  return manager;
}
