{
  final List<PsiElement> list=Collections.synchronizedList(new ArrayList<PsiElement>());
  if (scope instanceof GroovyScriptClass) {
    scope=scope.getContainingFile();
  }
  ReferencesSearch.search(variable,new LocalSearchScope(scope)).forEach(new Processor<PsiReference>(){
    @Override public boolean process(    PsiReference psiReference){
      final PsiElement element=psiReference.getElement();
      if (element != null) {
        list.add(element);
      }
      return true;
    }
  }
);
  return list.toArray(new PsiElement[list.size()]);
}
