{
  if (ApplicationManager.getApplication().isUnitTestMode() && LanguageLevel.FORCE_LANGUAGE_LEVEL != null) {
    return LanguageLevel.FORCE_LANGUAGE_LEVEL;
  }
  if (file == null)   return null;
  final Module module=ModuleUtilCore.findModuleForFile(file,project);
  if (module != null) {
    final Sdk sdk=ModuleRootManager.getInstance(module).getSdk();
    return PythonSdkType.getLanguageLevelForSdk(sdk);
  }
  final Sdk sdk=findSdk(project,file);
  if (sdk != null) {
    return PythonSdkType.getLanguageLevelForSdk(sdk);
  }
  return null;
}
