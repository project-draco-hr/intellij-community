{
  boolean update=false;
  Set<String> directories=findDirectories(recursiveRoots,flatRoots);
  for (  String root : recursiveRoots) {
    WatchRequestImpl request=watch(root,directories.contains(root),true);
    if (request == null)     continue;
    final boolean alreadyWatched=isAlreadyWatched(request);
    request.myDominated=alreadyWatched;
    myRootsToWatch.add(request);
    results.add(request);
    update|=!alreadyWatched;
  }
  for (  String root : flatRoots) {
    WatchRequestImpl request=watch(root,directories.contains(root),false);
    if (request == null)     continue;
    final boolean alreadyWatched=isAlreadyWatched(request);
    if (!alreadyWatched) {
      final VirtualFile existingFile=findFileByPathIfCached(root);
      if (existingFile != null && existingFile.isDirectory() && existingFile instanceof NewVirtualFile) {
        filesToSync.addAll(((NewVirtualFile)existingFile).getCachedChildren());
      }
    }
    request.myDominated=alreadyWatched;
    myRootsToWatch.add(request);
    results.add(request);
    update|=!alreadyWatched;
  }
  return update;
}
