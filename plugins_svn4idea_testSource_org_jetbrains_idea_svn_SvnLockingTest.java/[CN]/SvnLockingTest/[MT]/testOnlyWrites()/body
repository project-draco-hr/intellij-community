{
  final OnlyWrite operation1=new OnlyWrite("one");
  final OnlyWrite operation2=new OnlyWrite("two");
  final Thread thread1=new Thread(operation1,"one");
  final Thread thread2=new Thread(operation2,"two");
  try {
    thread1.start();
    TimeoutUtil.sleep(500);
    Assert.assertTrue(operation1.isInsideWrite());
    thread2.start();
    TimeoutUtil.sleep(500);
    Assert.assertFalse(operation2.isInsideWrite());
    operation1.go();
    TimeoutUtil.sleep(500);
    Assert.assertTrue(operation2.isInsideWrite());
    operation2.go();
    TimeoutUtil.sleep(500);
  }
  finally {
    myLocks.dispose();
    operation1.stop();
    operation2.stop();
    Thread.sleep(100);
    thread1.interrupt();
    thread2.interrupt();
    thread1.join();
    thread2.join();
  }
}
