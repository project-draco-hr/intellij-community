{
  final Map<FinishElementInstruction,BitSet> liveVars=findLiveVars();
  runDfa(true,new PairFunction<Instruction,BitSet,BitSet>(){
    @Override @NotNull public BitSet fun(    Instruction instruction,    @NotNull BitSet prevLiveVars){
      if (instruction instanceof FinishElementInstruction) {
        BitSet currentlyLive=liveVars.get(instruction);
        if (currentlyLive == null) {
          return new BitSet();
        }
        int index=0;
        while (true) {
          int setBit=prevLiveVars.nextSetBit(index);
          if (setBit < 0)           break;
          if (!currentlyLive.get(setBit)) {
            ((FinishElementInstruction)instruction).getVarsToFlush().add((DfaVariableValue)myFactory.getValue(setBit));
          }
          index=setBit + 1;
        }
        return currentlyLive;
      }
      return prevLiveVars;
    }
  }
);
}
