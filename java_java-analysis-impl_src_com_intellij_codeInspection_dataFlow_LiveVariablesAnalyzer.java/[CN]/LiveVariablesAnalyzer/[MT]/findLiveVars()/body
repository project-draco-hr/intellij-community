{
  final Map<FinishElementInstruction,BitSet> result=ContainerUtil.newHashMap();
  boolean ok=runDfa(false,new PairFunction<Instruction,BitSet,BitSet>(){
    @Override public BitSet fun(    Instruction instruction,    BitSet liveVars){
      if (instruction instanceof FinishElementInstruction) {
        BitSet set=result.get(instruction);
        if (set != null) {
          set.or(liveVars);
          return set;
        }
 else {
          result.put((FinishElementInstruction)instruction,liveVars);
        }
      }
      DfaVariableValue written=getWrittenVariable(instruction);
      if (written != null) {
        liveVars=(BitSet)liveVars.clone();
        liveVars.clear(written.getID());
        for (        DfaVariableValue var : myFactory.getVarFactory().getAllQualifiedBy(written)) {
          liveVars.clear(var.getID());
        }
      }
 else {
        boolean cloned=false;
        for (        DfaVariableValue value : getReadVariables(instruction)) {
          if (!liveVars.get(value.getID())) {
            if (!cloned) {
              liveVars=(BitSet)liveVars.clone();
              cloned=true;
            }
            liveVars.set(value.getID());
          }
        }
      }
      return liveVars;
    }
  }
);
  return ok ? result : null;
}
