{
  myBuilder=createBuilder(" foo bar");
  parseWhenEmptyElementAfterWhitespaceIsLastChild();
  final ASTNode tree=myBuilder.getTreeBuilt();
  new DummyHolder(getPsiManager(),(TreeElement)tree,null);
  myBuilder=createBuilder("  bar",tree);
  parseWhenEmptyElementAfterWhitespaceIsLastChild();
  DebugUtil.startPsiModification(null);
  try {
    myBuilder.getTreeBuilt();
    fail();
  }
 catch (  BlockSupport.ReparsedSuccessfullyException e) {
    e.getDiffLog().performActualPsiChange(tree.getPsi().getContainingFile());
  }
 finally {
    DebugUtil.finishPsiModification();
  }
  assertEquals("  bar",tree.getText());
}
