{
  File javaHome=SystemInfo.isMac ? new File(jvm,homeSubPath) : jvm;
  if (bundled)   javaHome=new File(PathManager.getHomePath(),javaHome.getPath());
  boolean isValidBundle=true;
  String jreCheck=System.getProperty("idea.jre.check");
  if (jreCheck != null && "true".equals(jreCheck)) {
    isValidBundle=new File(javaHome,"lib" + File.separator + "tools.jar").exists();
  }
  if (!SystemInfo.isMac && !isValidBundle)   return null;
  File absJvmLocation=bundled ? new File(PathManager.getHomePath(),jvm.getPath()) : jvm;
  Pair<String,Pair<Version,Integer>> nameVersionAndUpdate=getJDKNameVersionAndUpdate(absJvmLocation,homeSubPath);
  if (SystemInfo.isMac && nameVersionAndUpdate.second != null && nameVersionAndUpdate.second.first.isOrGreaterThan(1,7) && !isValidBundle) {
    return null;
  }
  return new JdkBundle(jvm,nameVersionAndUpdate.first,nameVersionAndUpdate.second,boot,bundled);
}
