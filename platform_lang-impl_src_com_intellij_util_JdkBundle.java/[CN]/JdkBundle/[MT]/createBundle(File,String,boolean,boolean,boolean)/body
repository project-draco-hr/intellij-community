{
  File javaHome=SystemInfo.isMac ? new File(jvm,homeSubPath) : jvm;
  if (bundled)   javaHome=new File(PathManager.getHomePath(),javaHome.getPath());
  boolean isValidBundle=true;
  String jreCheck=System.getProperty("idea.jre.check");
  if (jreCheck != null && "true".equals(jreCheck)) {
    isValidBundle=new File(javaHome,"lib" + File.separator + "tools.jar").exists();
  }
  if (!SystemInfo.isMac && !isValidBundle)   return null;
  File absJvmLocation=bundled ? new File(PathManager.getHomePath(),jvm.getPath()) : jvm;
  Pair<Pair<String,Boolean>,Pair<Version,Integer>> nameArchVersionAndUpdate=getJDKNameArchVersionAndUpdate(absJvmLocation,homeSubPath);
  if (nameArchVersionAndUpdate.first.second == null) {
    return null;
  }
  if (matchArch && nameArchVersionAndUpdate.first.second != is64BitRuntime()) {
    return null;
  }
  if (SystemInfo.isMac && nameArchVersionAndUpdate.second != null && nameArchVersionAndUpdate.second.first.isOrGreaterThan(1,7) && !isValidBundle) {
    return null;
  }
  JdkBundle bundle=new JdkBundle(jvm,nameArchVersionAndUpdate.first.first,nameArchVersionAndUpdate.second,boot,bundled);
  bundle.bitness=nameArchVersionAndUpdate.first.second ? Bitness.x64 : Bitness.x32;
  return bundle;
}
