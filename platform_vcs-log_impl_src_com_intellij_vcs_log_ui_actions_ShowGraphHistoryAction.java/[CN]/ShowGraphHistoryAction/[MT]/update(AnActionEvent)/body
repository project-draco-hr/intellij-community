{
  Presentation presentation=e.getPresentation();
  if (!Registry.is("vcs.log.graph.history")) {
    presentation.setEnabledAndVisible(false);
  }
 else {
    VirtualFile file=e.getData(CommonDataKeys.VIRTUAL_FILE);
    Project project=e.getProject();
    if (file == null || project == null) {
      presentation.setEnabledAndVisible(false);
    }
 else {
      VirtualFile root=ProjectLevelVcsManager.getInstance(project).getVcsRootFor(file);
      VcsLogData dataManager=VcsProjectLog.getInstance(project).getDataManager();
      if (root == null || dataManager == null) {
        presentation.setEnabledAndVisible(false);
      }
 else {
        presentation.setVisible(dataManager.getRoots().contains(root));
        presentation.setEnabled(dataManager.getIndex().isIndexed(root));
      }
    }
  }
}
