{
  if (place == null) {
    return new PsiVariable[0];
  }
  final Set<String> usedNames=ContainerUtil.newHashSet();
  final List<PsiVariable> list=new ArrayList<>();
  VariablesProcessor varproc=new VariablesProcessor(prefix,true,list){
    @Override public boolean execute(    @NotNull PsiElement pe,    @NotNull ResolveState state){
      if (pe instanceof PsiVariable) {
        if (!usedNames.add(((PsiVariable)pe).getName())) {
          return false;
        }
        final PsiExpression initializer=((PsiVariable)pe).getInitializer();
        if (initializer != null && PsiTreeUtil.isAncestor(initializer,place,false))         return true;
      }
      return pe instanceof PsiField && !PsiUtil.isAccessible((PsiField)pe,place,null) || super.execute(pe,state);
    }
  }
;
  PsiScopesUtil.treeWalkUp(varproc,place,null);
  return varproc.getResultsAsArray();
}
