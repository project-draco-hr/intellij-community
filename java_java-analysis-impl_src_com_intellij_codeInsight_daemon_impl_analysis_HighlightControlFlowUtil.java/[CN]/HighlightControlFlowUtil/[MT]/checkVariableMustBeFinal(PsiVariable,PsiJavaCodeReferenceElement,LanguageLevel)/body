{
  if (variable.hasModifierProperty(PsiModifier.FINAL))   return null;
  final PsiElement innerClass=getInnerClassVariableReferencedFrom(variable,context);
  if (innerClass instanceof PsiClass) {
    if (variable instanceof PsiParameter) {
      final PsiElement parent=variable.getParent();
      if (parent instanceof PsiParameterList && parent.getParent() instanceof PsiLambdaExpression && notAccessedForWriting(variable,new LocalSearchScope(((PsiParameter)variable).getDeclarationScope()))) {
        return null;
      }
    }
    final boolean isToBeEffectivelyFinal=languageLevel.isAtLeast(LanguageLevel.JDK_1_8);
    if (isToBeEffectivelyFinal && isEffectivelyFinal(variable,innerClass,context)) {
      return null;
    }
    final String description=JavaErrorMessages.message(isToBeEffectivelyFinal ? "variable.must.be.final.or.effectively.final" : "variable.must.be.final",context.getText());
    final HighlightInfo highlightInfo=HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(context).descriptionAndTooltip(description).create();
    QuickFixAction.registerQuickFixAction(highlightInfo,QUICK_FIX_FACTORY.createVariableAccessFromInnerClassFix(variable,innerClass));
    return highlightInfo;
  }
  return checkWriteToFinalInsideLambda(variable,context);
}
