{
  final PsiLambdaExpression lambdaExpression=PsiTreeUtil.getParentOfType(context,PsiLambdaExpression.class);
  if (lambdaExpression != null && !PsiTreeUtil.isAncestor(lambdaExpression,variable,true)) {
    final PsiElement parent=variable.getParent();
    if (parent instanceof PsiParameterList && parent.getParent() == lambdaExpression) {
      return null;
    }
    if (!isEffectivelyFinal(variable,lambdaExpression,context)) {
      String text=JavaErrorMessages.message("lambda.variable.must.be.final");
      HighlightInfo highlightInfo=HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(context).descriptionAndTooltip(text).create();
      QuickFixAction.registerQuickFixAction(highlightInfo,QUICK_FIX_FACTORY.createVariableAccessFromInnerClassFix(variable,lambdaExpression));
      return highlightInfo;
    }
  }
  return null;
}
