{
  final PsiElement parent=expression.getParent();
  final PsiMethod method=expression.resolveMethod();
  if (method != null) {
    final PsiClass returnClass=PsiTypesUtil.getPsiClass(method.getReturnType());
    if (returnClass == null || !GuavaFluentIterableConversionRule.FLUENT_ITERABLE.equals(returnClass.getQualifiedName())) {
      return false;
    }
  }
  if (parent instanceof PsiLocalVariable) {
    return isIterable(((PsiLocalVariable)parent).getType());
  }
 else   if (parent instanceof PsiReturnStatement) {
    final PsiElement methodOrLambda=PsiTreeUtil.getParentOfType(parent,PsiMethod.class,PsiLambdaExpression.class);
    PsiType methodReturnType=null;
    if (methodOrLambda instanceof PsiMethod) {
      methodReturnType=((PsiMethod)methodOrLambda).getReturnType();
    }
 else     if (methodOrLambda instanceof PsiLambdaExpression) {
      methodReturnType=LambdaUtil.getFunctionalInterfaceReturnType((PsiFunctionalExpression)methodOrLambda);
    }
    return isIterable(methodReturnType);
  }
  return false;
}
