{
  if (newState == null || JDOMUtil.isEmpty(newState)) {
    return myComponentStates.remove(componentName);
  }
  prepareElement(newState);
  newLiveStates.put(componentName,newState);
  Object oldState=myComponentStates.get(componentName);
  byte[] newBytes=null;
  if (oldState instanceof Element) {
    if (JDOMUtil.areElementsEqual((Element)oldState,newState)) {
      return null;
    }
  }
 else   if (oldState != null) {
    newBytes=getNewByteIfDiffers(componentName,newState,(byte[])oldState);
    if (newBytes == null) {
      return null;
    }
  }
  myComponentStates.put(componentName,newBytes == null ? newState : newBytes);
  return newState;
}
