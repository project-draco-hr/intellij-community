{
  PsiElement[] elements=LangDataKeys.PSI_ELEMENT_ARRAY.getData(dataContext);
  if (elements != null) {
    collectTestMembers(elements,checkAbstract,checkIsTest,processor);
    for (    PsiElement psiClass : processor.getCollection()) {
      classes.add(getQName(psiClass));
    }
    return true;
  }
 else {
    final PsiElement element=CommonDataKeys.PSI_ELEMENT.getData(dataContext);
    final VirtualFile[] files=CommonDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
    if (files != null) {
      Project project=CommonDataKeys.PROJECT.getData(dataContext);
      if (project != null) {
        final PsiManager psiManager=PsiManager.getInstance(project);
        for (        VirtualFile file : files) {
          final PsiFile psiFile=psiManager.findFile(file);
          if (psiFile instanceof PsiClassOwner) {
            PsiClass[] psiClasses=((PsiClassOwner)psiFile).getClasses();
            if (element != null && psiClasses.length > 0) {
              for (              PsiClass aClass : psiClasses) {
                if (PsiTreeUtil.isAncestor(aClass,element,false)) {
                  psiClasses=new PsiClass[]{aClass};
                  break;
                }
              }
            }
            collectTestMembers(psiClasses,checkAbstract,checkIsTest,processor);
            for (            PsiElement psiMember : processor.getCollection()) {
              classes.add(((PsiClass)psiMember).getQualifiedName());
            }
          }
        }
        return true;
      }
    }
  }
  return false;
}
