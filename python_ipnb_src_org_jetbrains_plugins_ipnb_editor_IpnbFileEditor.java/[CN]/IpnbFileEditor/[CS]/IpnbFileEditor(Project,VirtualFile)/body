{
  myProject=project;
  myProject.getMessageBus().connect(this).subscribe(AppTopics.FILE_DOCUMENT_SYNC,new FileDocumentManagerAdapter(){
    @Override public void beforeAllDocumentsSaving(){
      final IpnbFilePanel filePanel=myIpnbFilePanel;
      if (filePanel != null) {
        IpnbParser.saveIpnbFile(filePanel);
        vFile.refresh(false,false);
      }
    }
  }
);
  myProject.getMessageBus().connect(this).subscribe(FileEditorManagerListener.Before.FILE_EDITOR_MANAGER,new FileEditorManagerListener.Before.Adapter(){
    @Override public void beforeFileClosed(    @NotNull FileEditorManager source,    @NotNull VirtualFile file){
      IpnbParser.saveIpnbFile(myIpnbFilePanel);
      file.refresh(false,false);
    }
  }
);
  myFile=vFile;
  myName=vFile.getName();
  myEditor=createEditor(project,vFile);
  myEditorPanel=new JPanel(new BorderLayout());
  myEditorPanel.setBackground(IpnbEditorUtil.getBackground());
  myIpnbFilePanel=createIpnbEditorPanel(myProject,vFile);
  final JPanel controlPanel=createControlPanel();
  myEditorPanel.add(controlPanel,BorderLayout.NORTH);
  myScrollPane=ScrollPaneFactory.createScrollPane(myIpnbFilePanel);
  myScrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
  myEditorPanel.add(myScrollPane,BorderLayout.CENTER);
}
