{
  if (ApplicationManager.getApplication() == null) {
    return connection.getInputStream();
  }
  InputStreamGetter getter=new InputStreamGetter(connection);
  final Future<?> getterFuture=ApplicationManager.getApplication().executeOnPooledThread(getter);
  while (true) {
    if (progressIndicator != null) {
      progressIndicator.checkCanceled();
    }
    try {
      try {
        getterFuture.get(50,TimeUnit.MILLISECONDS);
      }
 catch (      TimeoutException ignored) {
      }
      if (progressIndicator != null) {
        progressIndicator.setIndeterminate(true);
        progressIndicator.setText(progressIndicator.getText());
      }
      if (getterFuture.isDone()) {
        break;
      }
    }
 catch (    Exception e) {
      throw new ProcessCanceledException(e);
    }
  }
  if (getter.getException() != null) {
    throw getter.getException();
  }
  return getter.getInputStream();
}
