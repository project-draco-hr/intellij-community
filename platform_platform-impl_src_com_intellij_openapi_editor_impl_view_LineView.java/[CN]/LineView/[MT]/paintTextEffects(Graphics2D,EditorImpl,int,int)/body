{
  IterationState it=new IterationState(editor,startOffset,endOffset,editor.isPaintSelection());
  while (!it.atEnd()) {
    TextAttributes attributes=it.getMergedAttributes();
    final Color color=attributes.getEffectColor();
    final EffectType type=attributes.getEffectType();
    if (hasTextEffect(color,type)) {
      paintInRange(g,editor,it.getStartOffset() - startOffset,it.getEndOffset() - startOffset,new Consumer<Graphics2D>(){
        @Override public void consume(        Graphics2D window){
          window.setColor(color);
          Rectangle clipBounds=window.getClipBounds();
          paintTextEffect(window,editor,(int)clipBounds.getMinX(),(int)clipBounds.getMaxX(),editor.getAscent(),type);
        }
      }
);
    }
    it.advance();
  }
}
