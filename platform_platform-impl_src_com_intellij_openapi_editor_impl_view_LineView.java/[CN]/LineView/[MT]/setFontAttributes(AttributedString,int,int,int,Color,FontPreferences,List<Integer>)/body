{
  AttributedCharacterIterator it=string.getIterator(new AttributedCharacterIterator.Attribute[0],start,end);
  Font currentFont=null;
  int currentIndex=start;
  for (char c=it.first(); c != CharacterIterator.DONE; c=it.next()) {
    int i=it.getIndex();
    Font font=ComplementaryFontsRegistry.getFontAbleToDisplay(c,fontStyle,fontPreferences).getFont();
    if (!font.equals(currentFont)) {
      if (i > currentIndex) {
        string.addAttribute(TextAttribute.FONT,currentFont,currentIndex,i);
      }
      currentFont=font;
      currentIndex=i;
    }
    if (tabRendererPositions != null && c == '\t') {
      tabRendererPositions.add(i);
    }
  }
  if (currentIndex < end) {
    string.addAttribute(TextAttribute.FONT,currentFont,currentIndex,end);
  }
  string.addAttribute(TextAttribute.FOREGROUND,fontColor,start,end);
}
