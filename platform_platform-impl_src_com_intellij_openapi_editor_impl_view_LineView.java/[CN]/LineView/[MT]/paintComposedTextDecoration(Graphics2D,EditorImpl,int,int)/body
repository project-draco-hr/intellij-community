{
  TextRange composedTextRange=editor.getComposedTextRange();
  if (composedTextRange != null) {
    int start=trim(composedTextRange.getStartOffset(),startOffset,endOffset) - startOffset;
    int end=trim(composedTextRange.getEndOffset(),startOffset,endOffset) - startOffset;
    if (start < end) {
      paintInRange(g,editor,start,end,new Consumer<Graphics2D>(){
        @Override public void consume(        Graphics2D window){
          window.setColor(editor.getColorsScheme().getColor(EditorColors.CARET_COLOR));
          window.setStroke(IME_COMPOSED_TEXT_UNDERLINE_STROKE);
          Rectangle clipBounds=window.getClipBounds();
          UIUtil.drawLine(window,(int)clipBounds.getMinX(),1,(int)clipBounds.getMaxX(),1);
        }
      }
);
    }
  }
}
