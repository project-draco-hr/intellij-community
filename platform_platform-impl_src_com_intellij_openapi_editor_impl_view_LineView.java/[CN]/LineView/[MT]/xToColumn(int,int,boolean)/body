{
  if (myLayout == null) {
    return spacePixelsToColumns(x,plainSpaceWidth);
  }
  if (x <= 0) {
    return 0;
  }
  int width=getWidthInPixels();
  if (x >= width) {
    return offsetToColumn(myLayout.getCharacterCount(),plainSpaceWidth) + spacePixelsToColumns(x - width,plainSpaceWidth);
  }
  TextHitInfo hit=myLayout.hitTestChar(x,0);
  if (myTabs != null && canBeInsideTab) {
    int charIndex=hit.getCharIndex();
    for (    TabSpacer tab : myTabs) {
      int tabOffset=tab.getOffset();
      if (tabOffset == charIndex) {
        int tabColumn=offsetToColumn(charIndex,plainSpaceWidth);
        return tabColumn + spacePixelsToColumns(x - columnToX(tabColumn,plainSpaceWidth),plainSpaceWidth);
      }
 else       if (tabOffset > charIndex) {
        break;
      }
    }
  }
  return offsetToColumn(hit.getInsertionIndex(),plainSpaceWidth);
}
