{
  Editor selectedEditor=StudyEditor.getSelectedEditor(project);
  FileDocumentManager fileDocumentManager=FileDocumentManager.getInstance();
  VirtualFile openedFile=fileDocumentManager.getFile(selectedEditor.getDocument());
  StudyTaskManager taskManager=StudyTaskManager.getInstance(selectedEditor.getProject());
  TaskFile selectedTaskFile=taskManager.getTaskFile(openedFile);
  Task currentTask=selectedTaskFile.getTask();
  Task nextTask=currentTask.next();
  if (nextTask == null) {
    BalloonBuilder balloonBuilder=JBPopupFactory.getInstance().createHtmlTextBalloonBuilder("It's the last task",MessageType.INFO,null);
    Balloon balloon=balloonBuilder.createBalloon();
    StudyEditor selectedStudyEditor=StudyEditor.getSelectedStudyEditor(project);
    balloon.showInCenterOf(selectedStudyEditor.getNextTaskButton());
    return;
  }
  for (  VirtualFile file : FileEditorManager.getInstance(project).getOpenFiles()) {
    FileEditorManager.getInstance(project).closeFile(file);
  }
  int nextTaskIndex=nextTask.getIndex();
  int lessonIndex=nextTask.getLesson().getIndex();
  TaskFile nextFile=nextTask.getTaskFiles().iterator().next();
  if (nextFile != null) {
    try {
      VirtualFile taskDir=project.getBaseDir().findChild("lesson" + String.valueOf(lessonIndex + 1)).findChild("task" + String.valueOf(nextTaskIndex + 1));
      FileEditorManager.getInstance(project).openFile(taskDir.findChild(nextTask.getTaskFiles().iterator().next().getName()),true);
    }
 catch (    NullPointerException e) {
      LOG.error("Something wrong with your project structure");
    }
  }
}
