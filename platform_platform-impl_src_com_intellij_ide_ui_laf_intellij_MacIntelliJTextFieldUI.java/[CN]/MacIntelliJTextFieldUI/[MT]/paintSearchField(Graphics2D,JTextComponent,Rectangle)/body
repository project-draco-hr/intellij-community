{
  final boolean noBorder=c.getClientProperty("JTextField.Search.noBorderRing") == Boolean.TRUE;
  boolean hasFocus=c.hasFocus() && !noBorder;
  Icon left=MacIntelliJIconCache.getIcon("searchFieldLeft",false,hasFocus);
  Icon middle=MacIntelliJIconCache.getIcon("searchFieldMiddle",false,hasFocus);
  Icon right=MacIntelliJIconCache.getIcon("searchFieldRight",false,hasFocus);
  Graphics gg=g.create(0,0,c.getWidth(),c.getHeight());
  gg.setClip(r.x,r.y,r.width - right.getIconWidth(),r.height);
  int x=r.x;
  int stop=r.x + (r.width - right.getIconWidth());
  left.paintIcon(c,g,r.x,r.y);
  x+=left.getIconWidth();
  while (x < stop) {
    middle.paintIcon(c,gg,x,r.y);
    x+=middle.getIconWidth();
  }
  gg.dispose();
  right.paintIcon(c,g,stop,r.y);
  boolean withHistoryPopup=isSearchFieldWithHistoryPopup(c);
  Icon label=getSearchIcon(c);
  boolean isEmpty=!hasText();
  Point point=getSearchIconCoord();
  if (isEmpty && !c.hasFocus() && !withHistoryPopup) {
    label.paintIcon(c,g,point.x,point.y);
  }
 else {
    gg=g.create(0,0,c.getWidth(),c.getHeight());
    gg.setClip(point.x,point.y,isEmpty ? label.getIconWidth() : 16,label.getIconHeight());
    label.paintIcon(c,gg,point.x,point.y);
  }
  Icon clearIcon=MacIntelliJIconCache.getIcon("searchFieldClear");
  if (!isEmpty) {
    clearIcon.paintIcon(c,g,getClearIconCoord().x,r.y);
  }
  AbstractAction newLineAction=getNewLineAction(c);
  if (newLineAction != null) {
    Icon newLineIcon=(Icon)newLineAction.getValue(Action.SMALL_ICON);
    if (newLineIcon != null) {
      newLineIcon.paintIcon(c,g,getAddNewLineIconCoord().x,r.y);
    }
  }
}
