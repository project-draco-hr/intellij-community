{
  final boolean noBorder=c.getClientProperty("JTextField.Search.noBorderRing") == Boolean.TRUE;
  boolean hasFocus=c.hasFocus() && !noBorder;
  Icon left=MacIntelliJIconCache.getIcon("searchFieldLeft",false,hasFocus);
  Icon middle=MacIntelliJIconCache.getIcon("searchFieldMiddle",false,hasFocus);
  Icon right=MacIntelliJIconCache.getIcon("searchFieldRight",false,hasFocus);
  Graphics gg=g.create(0,0,c.getWidth(),c.getHeight());
  gg.setClip(r.x,r.y,r.width - right.getIconWidth(),r.height);
  int x=r.x;
  int stop=r.x + (r.width - right.getIconWidth());
  left.paintIcon(c,g,r.x,r.y);
  x+=left.getIconWidth();
  while (x < stop) {
    middle.paintIcon(c,gg,x,r.y);
    x+=middle.getIconWidth();
  }
  gg.dispose();
  right.paintIcon(c,g,stop,r.y);
  boolean withHistoryPopup=isSearchFieldWithHistoryPopup(c);
  Icon label=MacIntelliJIconCache.getIcon(withHistoryPopup ? "searchFieldWithHistory" : "searchFieldLabel");
  if (StringUtil.isEmpty(c.getText()) && !c.hasFocus() && !withHistoryPopup) {
    label.paintIcon(c,g,r.x + (r.width - label.getIconWidth()) / 2,r.y);
  }
 else {
    gg=g.create(0,0,c.getWidth(),c.getHeight());
    int offset=withHistoryPopup ? 5 : 8;
    gg.setClip(r.x + offset,r.y,StringUtil.isEmpty(c.getText()) ? label.getIconWidth() : 16,label.getIconHeight());
    label.paintIcon(c,gg,r.x + offset,r.y);
  }
  if (!StringUtil.isEmpty(c.getText())) {
    Icon clear=MacIntelliJIconCache.getIcon("searchFieldClear");
    clear.paintIcon(c,g,r.x + r.width - clear.getIconWidth() - 6,r.y);
  }
}
