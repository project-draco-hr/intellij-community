{
  Graphics2D g=(Graphics2D)graphics;
  final JTextComponent c=getComponent();
  final Container parent=c.getParent();
  final Rectangle r=getDrawingRect();
  if (c.isOpaque() && parent != null) {
    g.setColor(parent.getBackground());
    g.fillRect(0,0,c.getWidth(),c.getHeight());
  }
  final GraphicsConfig config=new GraphicsConfig(g);
  g.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
  g.setRenderingHint(RenderingHints.KEY_STROKE_CONTROL,RenderingHints.VALUE_STROKE_NORMALIZE);
  if (isSearchField(c)) {
    paintSearchField(g,c,r);
  }
 else {
    if (c.getBorder() instanceof MacIntelliJTextBorder) {
      g.setColor(c.getBackground());
      g.fillRect(3,3,c.getWidth() - 6,c.getHeight() - 6);
    }
 else {
      super.paintBackground(g);
    }
  }
  config.restore();
}
