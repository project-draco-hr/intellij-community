{
  if (RunConfigurationProducer.getInstance(TestNGPatternConfigurationProducer.class).isMultipleElementsSelected(context)) {
    return false;
  }
  final RunConfiguration predefinedConfiguration=context.getOriginalConfiguration(TestNGConfigurationType.getInstance());
  final Location contextLocation=context.getLocation();
  Location location=JavaExecutionUtil.stepIntoSingleClass(contextLocation);
  if (location == null) {
    return false;
  }
  final PsiElement element=location.getPsiElement();
  RunnerAndConfigurationSettings template=RunManager.getInstance(location.getProject()).getConfigurationTemplate(getConfigurationFactory());
  final Module predefinedModule=((TestNGConfiguration)template.getConfiguration()).getConfigurationModule().getModule();
  final String vmParameters=predefinedConfiguration instanceof TestNGConfiguration ? ((TestNGConfiguration)predefinedConfiguration).getVMParameters() : null;
  if (vmParameters != null && !Comparing.strEqual(vmParameters,testNGConfiguration.getVMParameters()))   return false;
  String paramSetName=contextLocation instanceof PsiMemberParameterizedLocation ? getInvocationNumber(((PsiMemberParameterizedLocation)contextLocation).getParamSetName()) : null;
  if (paramSetName != null && !Comparing.strEqual(paramSetName,testNGConfiguration.getProgramParameters()))   return false;
  TestNGTestObject testobject=TestNGTestObject.fromConfig(testNGConfiguration);
  if (testobject != null) {
    if (testobject.isConfiguredByElement(element)) {
      final Module configurationModule=testNGConfiguration.getConfigurationModule().getModule();
      if (Comparing.equal(location.getModule(),configurationModule))       return true;
      if (Comparing.equal(predefinedModule,configurationModule))       return true;
    }
  }
  return false;
}
