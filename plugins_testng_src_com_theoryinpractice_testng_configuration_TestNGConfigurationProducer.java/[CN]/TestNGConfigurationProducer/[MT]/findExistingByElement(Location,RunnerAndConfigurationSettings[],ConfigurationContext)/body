{
  final TestNGConfiguration testNGConfiguration=(TestNGConfiguration)context.getOriginalConfiguration(TestNGConfigurationType.getInstance());
  final String vmParameters=testNGConfiguration != null ? testNGConfiguration.getVMParameters() : null;
  final Module predefinedModule=((TestNGConfiguration)((RunManagerImpl)RunManagerEx.getInstanceEx(location.getProject())).getConfigurationTemplate(getConfigurationFactory()).getConfiguration()).getConfigurationModule().getModule();
  for (  RunnerAndConfigurationSettings existingConfiguration : existingConfigurations) {
    TestNGConfiguration config=(TestNGConfiguration)existingConfiguration.getConfiguration();
    if (vmParameters != null && !Comparing.strEqual(config.getVMParameters(),vmParameters))     continue;
    TestData testobject=config.getPersistantData();
    if (testobject != null) {
      final PsiElement element=location.getPsiElement();
      if (testobject.isConfiguredByElement(element)) {
        final Module configurationModule=config.getConfigurationModule().getModule();
        if (Comparing.equal(location.getModule(),configurationModule))         return existingConfiguration;
        if (Comparing.equal(predefinedModule,configurationModule))         return existingConfiguration;
      }
    }
  }
  return null;
}
