{
  if (annotations.isEmpty())   return TypeAnnotationProvider.EMPTY;
  final ArrayList<PsiAnnotation> copy=ContainerUtil.newArrayList(annotations);
  annotations.clear();
  return new TypeAnnotationProvider(){
    private volatile PsiAnnotation[] myCached;
    @NotNull @Override public PsiAnnotation[] getAnnotations(){
      PsiAnnotation[] result=myCached;
      if (result == null) {
        List<PsiAnnotation> filtered=ContainerUtil.filter(copy,new Condition<PsiAnnotation>(){
          @Override public boolean value(          PsiAnnotation annotation){
            return PsiImplUtil.isTypeAnnotation(annotation);
          }
        }
);
        myCached=result=filtered.isEmpty() ? PsiAnnotation.EMPTY_ARRAY : filtered.toArray(new PsiAnnotation[filtered.size()]);
      }
      return result;
    }
  }
;
}
