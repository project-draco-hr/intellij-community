{
  int i=0;
  int lineStartOffset=editor.getDocument().getLineStartOffset(i);
  while (i < editor.getDocument().getLineCount() && lineStartOffset < offset) {
    i++;
    if (i < editor.getDocument().getLineCount()) {
      lineStartOffset=editor.getDocument().getLineStartOffset(i);
    }
  }
  return i - 1;
}
