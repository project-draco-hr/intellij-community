{
  VirtualFile[] selectedFiles=context.getSelectedFiles();
  if (selectedFiles.length != 1) {
    return false;
  }
  VirtualFile file=selectedFiles[0];
  if (file.isDirectory())   return false;
  Project project=context.getProject();
  if (project == null || project.isDisposed())   return false;
  if (getBackgroundableLock(project,file).isLocked())   return false;
  final AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(file);
  if (vcs == null)   return false;
  final AnnotationProvider annotationProvider=vcs.getAnnotationProvider();
  if (annotationProvider == null)   return false;
  final FileStatus fileStatus=FileStatusManager.getInstance(project).getStatus(file);
  if (fileStatus == FileStatus.UNKNOWN || fileStatus == FileStatus.ADDED || fileStatus == FileStatus.IGNORED) {
    return false;
  }
  return hasTextEditor(file);
}
