{
  String shortName=new VisibilityInspection().getShortName();
  InspectionProfileImpl profile=new InspectionProfileImpl("Foo");
  profile.disableAllTools(getProject());
  profile.enableTool(shortName,getProject());
  GlobalInspectionContextImpl context=((InspectionManagerEx)InspectionManager.getInstance(getProject())).createNewGlobalContext(false);
  context.setExternalProfile(profile);
  configureByFile("Foo.java");
  AnalysisScope scope=new AnalysisScope(getFile());
  context.doInspections(scope);
  UIUtil.dispatchAllInvocationEvents();
  Tools tools=context.getTools().get(shortName);
  GlobalInspectionToolWrapper toolWrapper=(GlobalInspectionToolWrapper)tools.getTool();
  InspectionToolPresentation presentation=context.getPresentation(toolWrapper);
  assertEquals(1,presentation.getProblemDescriptors().size());
  context.doInspections(scope);
  UIUtil.dispatchAllInvocationEvents();
  tools=context.getTools().get(shortName);
  toolWrapper=(GlobalInspectionToolWrapper)tools.getTool();
  presentation=context.getPresentation(toolWrapper);
  assertEquals(1,presentation.getProblemDescriptors().size());
}
