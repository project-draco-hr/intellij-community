{
  File source=getSource(backupDir);
  File updated;
  if (!myIsMove) {
    updated=Utils.createTempFile();
    InputStream in=Utils.findEntryInputStream(patchFile,myPath);
    int filePermissions=in.read();
    if (filePermissions > 1) {
      Utils.createLink(readLinkInfo(in,filePermissions),toFile);
      in.close();
      return;
    }
 else {
      OutputStream out=new BufferedOutputStream(new FileOutputStream(updated));
      try {
        InputStream oldFileIn=Utils.newFileInputStream(source,myPatch.isNormalized());
        try {
          applyDiff(in,oldFileIn,out);
        }
  finally {
          oldFileIn.close();
        }
      }
  finally {
        out.close();
      }
    }
    Utils.setExecutable(updated,filePermissions == 1);
  }
 else {
    updated=source;
  }
  replaceUpdated(updated,toFile);
}
