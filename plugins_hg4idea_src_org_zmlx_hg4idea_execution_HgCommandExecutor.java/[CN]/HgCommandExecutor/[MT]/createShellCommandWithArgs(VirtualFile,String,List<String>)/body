{
  logCommand(operation,arguments);
  final List<String> cmdLine=new LinkedList<String>();
  cmdLine.add(myVcs.getGlobalSettings().getHgExecutable());
  if (repo != null) {
    cmdLine.add("--repository");
    cmdLine.add(repo.getPath());
  }
  cmdLine.add("--config");
  cmdLine.add("extensions.mq=");
  cmdLine.addAll(DEFAULT_OPTIONS);
  cmdLine.add(operation);
  if (arguments != null && arguments.size() != 0) {
    cmdLine.addAll(arguments);
  }
  if (HgVcs.HGENCODING == null) {
    cmdLine.add("--encoding");
    cmdLine.add(HgEncodingUtil.getNameFor(myCharset));
  }
  String workingDir=repo != null ? repo.getPath() : null;
  return new ShellCommand(cmdLine,workingDir,myCharset);
}
