{
  final Project project=myModule.getProject();
  final String dirPath=PropertiesComponent.getInstance(project).getValue("findjar.last.used.dir");
  VirtualFile toSelect=dirPath == null ? null : LocalFileSystem.getInstance().findFileByIoFile(new File(dirPath));
  final VirtualFile file=FileChooser.chooseFile(FileChooserDescriptorFactory.createSingleFolderDescriptor(),project,toSelect);
  if (file != null) {
    PropertiesComponent.getInstance(project).setValue("findjar.last.used.dir",file.getPath());
    final DownloadableFileService downloader=DownloadableFileService.getInstance();
    final DownloadableFileDescription description=downloader.createFileDescription(jarUrl,jarName);
    final List<VirtualFile> jars=downloader.createDownloader(Arrays.asList(description),jarName).downloadFilesWithProgress(file.getPath(),project,myEditorComponent);
    if (jars != null && jars.size() == 1) {
      AccessToken token=WriteAction.start();
      try {
        OrderEntryFix.addJarToRoots(jars.get(0).getPresentableUrl(),myModule,myRef);
      }
  finally {
        token.finish();
      }
    }
  }
}
