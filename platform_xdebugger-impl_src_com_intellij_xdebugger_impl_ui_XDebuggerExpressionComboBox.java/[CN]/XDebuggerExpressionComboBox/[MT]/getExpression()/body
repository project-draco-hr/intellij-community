{
  if (myComboBox.isPopupVisible()) {
    return (XExpression)myComboBox.getPopup().getList().getSelectedValue();
  }
 else {
    XExpression expression=getEditorsProvider().createExpression(getProject(),(Document)myEditor.getItem(),myExpression.getLanguage());
    if (expression == null) {
      expression=new XExpressionImpl(((Document)myEditor.getItem()).getText(),myExpression.getLanguage(),null);
    }
    return expression;
  }
}
