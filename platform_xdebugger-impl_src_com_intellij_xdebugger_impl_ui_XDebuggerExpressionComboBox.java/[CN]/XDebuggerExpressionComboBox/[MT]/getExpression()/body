{
  ComboPopup popup=myComboBox.getPopup();
  if (popup != null && popup.isVisible()) {
    Object value=popup.getList().getSelectedValue();
    if (value != null) {
      return (XExpression)value;
    }
  }
  Object document=myEditor.getItem();
  if (document instanceof Document) {
    return getEditorsProvider().createExpression(getProject(),(Document)document,myExpression.getLanguage(),EvaluationMode.EXPRESSION);
  }
  return myExpression;
}
