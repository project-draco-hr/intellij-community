{
  if (!isCompletionEnabled(parameters)) {
    return;
  }
  PostfixLiveTemplate postfixLiveTemplate=getPostfixLiveTemplate(parameters.getOriginalFile(),parameters.getOffset());
  if (postfixLiveTemplate != null) {
    PsiFile file=parameters.getPosition().getContainingFile();
    final CustomTemplateCallback callback=new CustomTemplateCallback(parameters.getEditor(),file,false);
    String computedKey=postfixLiveTemplate.computeTemplateKey(callback);
    if (computedKey != null) {
      PostfixTemplate template=postfixLiveTemplate.getTemplateByKey(computedKey);
      if (template != null) {
        result=result.withPrefixMatcher(computedKey);
        result.addElement(new PostfixTemplateLookupElement(template,postfixLiveTemplate.getShortcut()));
      }
    }
    String possibleKey=postfixLiveTemplate.computeTemplateKeyWithoutContextChecking(parameters.getEditor());
    if (StringUtil.isNotEmpty(possibleKey)) {
      result=result.withPrefixMatcher(possibleKey);
      result.restartCompletionOnPrefixChange(StandardPatterns.string().startsWith(possibleKey));
    }
  }
}
