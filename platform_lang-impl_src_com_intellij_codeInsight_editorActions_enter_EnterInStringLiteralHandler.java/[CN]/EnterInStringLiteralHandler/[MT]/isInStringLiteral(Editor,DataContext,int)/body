{
  Language language=EnterHandler.getLanguage(dataContext);
  if (offset > 0 && language != null) {
    QuoteHandler quoteHandler=TypedHandler.getLanguageQuoteHandler(language);
    if (quoteHandler == null) {
      FileType fileType=language.getAssociatedFileType();
      quoteHandler=fileType != null ? TypedHandler.getQuoteHandlerForType(fileType) : null;
    }
    if (quoteHandler != null) {
      EditorHighlighter highlighter=((EditorEx)editor).getHighlighter();
      HighlighterIterator iterator=highlighter.createIterator(offset - 1);
      return StringEscapesTokenTypes.STRING_LITERAL_ESCAPES.contains(iterator.getTokenType()) || quoteHandler.isInsideLiteral(iterator);
    }
  }
  return false;
}
