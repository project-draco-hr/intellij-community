{
  Project project=getProject();
  if (project == null)   return;
  VirtualFile file=getSelectedFile();
  ScratchFileService fileService=ScratchFileService.getInstance();
  if (file != null && fileService.getRootType(file) instanceof ScratchRootType) {
    Language lang=fileService.getScratchesMapping().getMapping(file);
    if (lang == null) {
      lang=LanguageSubstitutors.INSTANCE.substituteLanguage(((LanguageFileType)file.getFileType()).getLanguage(),file,project);
    }
    myPanel.setText(lang.getDisplayName());
    myPanel.setBorder(WidgetBorder.INSTANCE);
    myPanel.setIcon(getDefaultIcon(lang));
    myPanel.setVisible(true);
  }
 else {
    myPanel.setBorder(null);
    myPanel.setVisible(false);
  }
  if (myStatusBar != null) {
    myStatusBar.updateWidget(WIDGET_ID);
  }
}
