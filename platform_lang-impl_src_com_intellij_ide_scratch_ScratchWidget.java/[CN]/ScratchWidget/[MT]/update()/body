{
  Project project=getProject();
  if (project == null)   return;
  final VirtualFile file=getSelectedFile();
  ScratchFileService fileService=ScratchFileService.getInstance();
  if (file != null && fileService.getRootType(file) instanceof ScratchRootType) {
    Language lang=fileService.getScratchesMapping().getMapping(file);
    if (lang == null) {
      lang=LanguageSubstitutors.INSTANCE.substituteLanguage(((LanguageFileType)file.getFileType()).getLanguage(),file,project);
    }
    myPanel.setText(lang.getDisplayName());
    myPanel.setBorder(WidgetBorder.WIDE);
    myPanel.setIcon(getDefaultIcon(lang));
    myPanel.setVisible(true);
    if (Boolean.TRUE.equals(file.getUserData(NewScratchFileAction.IS_NEW_SCRATCH))) {
      file.putUserData(NewScratchFileAction.IS_NEW_SCRATCH,null);
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          if (myPanel.isVisible()) {
            showPopup(getProject(),file);
          }
        }
      }
);
    }
  }
 else {
    myPanel.setBorder(null);
    myPanel.setVisible(false);
  }
  if (myStatusBar != null) {
    myStatusBar.updateWidget(WIDGET_ID);
  }
}
