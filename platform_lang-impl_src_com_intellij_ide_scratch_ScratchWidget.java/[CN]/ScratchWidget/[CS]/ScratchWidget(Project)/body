{
  super(project);
  new ClickListener(){
    @Override public boolean onClick(    @NotNull MouseEvent e,    int clickCount){
      Project project=getProject();
      Editor editor=getEditor();
      final VirtualFile file=getSelectedFile();
      if (project == null || editor == null || file == null)       return false;
      final PerFileMappings<Language> fileService=ScratchFileService.getInstance().getScratchesMapping();
      ListPopup popup=NewScratchFileAction.buildLanguageSelectionPopup(project,"Change Language",fileService.getMapping(file),new Consumer<Language>(){
        @Override public void consume(        Language language){
          fileService.setMapping(file,language);
          update();
        }
      }
);
      Dimension dimension=popup.getContent().getPreferredSize();
      Point at=new Point(0,-dimension.height);
      popup.show(new RelativePoint(myPanel,at));
      return true;
    }
  }
.installOn(myPanel);
  myConnection.subscribe(VirtualFileManager.VFS_CHANGES,new BulkFileListener.Adapter(){
    @Override public void after(    @NotNull List<? extends VFileEvent> events){
      for (      VFileEvent event : events) {
        if (event.getRequestor() == FileContentUtilCore.FORCE_RELOAD_REQUESTOR) {
          update();
          break;
        }
      }
    }
  }
);
}
