{
  VirtualFile[] files=getFiles(e.getDataContext());
  e.getPresentation().setEnabledAndVisible(files.length > 0);
  if (files.length > 0) {
    int ro=0, rw=0, f=0, d=0;
    for (    VirtualFile file : files) {
      if (file.isWritable())       ++rw;
 else       ++ro;
      if (file.isDirectory())       ++d;
 else       ++f;
    }
    if (ro > 0 && rw > 0) {
      e.getPresentation().setText(ActionsBundle.message("action.ToggleReadOnlyAttribute.text"));
    }
 else     if (f > 0 && d == 0) {
      e.getPresentation().setText(ActionsBundle.message("action.ToggleReadOnlyAttribute.files",ro,rw,f,d));
    }
 else     if (f == 0 && d > 0) {
      e.getPresentation().setText(ActionsBundle.message("action.ToggleReadOnlyAttribute.dirs",ro,rw,f,d));
    }
 else {
      e.getPresentation().setText(ActionsBundle.message("action.ToggleReadOnlyAttribute.mixed",ro,rw,f,d));
    }
  }
}
