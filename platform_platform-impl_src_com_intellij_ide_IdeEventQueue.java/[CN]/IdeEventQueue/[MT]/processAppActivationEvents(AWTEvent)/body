{
  Application app=ApplicationManager.getApplication();
  if (!(app instanceof ApplicationImpl))   return false;
  final ApplicationImpl appImpl=(ApplicationImpl)app;
  if (e instanceof WindowEvent) {
    final WindowEvent we=(WindowEvent)e;
    if (we.getID() == WindowEvent.WINDOW_ACTIVATED || we.getID() == WindowEvent.WINDOW_GAINED_FOCUS) {
      appImpl.myCancelDeactivation=true;
      if (!appImpl.isActive()) {
        appImpl.tryToApplyActivationState(true,we.getWindow());
      }
    }
 else     if (we.getID() == WindowEvent.WINDOW_DEACTIVATED) {
      requestToDeactivateTime.getAndSet(System.currentTimeMillis());
      appImpl.myCancelDeactivation=false;
      Timer timer=new Timer(Registry.intValue("app.deactivation.timeout"),new ActionListener(){
        public void actionPerformed(        ActionEvent evt){
          if (appImpl.isActive() && !appImpl.isDeactivationCanceled()) {
            appImpl.tryToApplyActivationState(false,we.getWindow());
          }
        }
      }
);
      timer.setRepeats(false);
      timer.start();
    }
  }
  return false;
}
