{
  final File tempDirectory=createTempDirectory();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      File moduleFile=PathManagerEx.findFileUnderProjectHome("java/java-tests/testData/moduleRootManager/rootsChanged/emptyModule/a.iml",RootsChangedTest.this.getClass());
      Module a=loadModule(moduleFile,true);
      assertEventsCount(1);
      final Sdk jdk=IdeaTestUtil.getMockJdk17();
      ProjectJdkTable.getInstance().addJdk(jdk);
      assertEventsCount(0);
      ModuleRootModificationUtil.setModuleSdk(a,jdk);
      assertEventsCount(1);
      final SdkModificator sdkModificator=jdk.getSdkModificator();
      sdkModificator.addRoot(getVirtualFile(tempDirectory),OrderRootType.CLASSES);
      sdkModificator.commitChanges();
    }
  }
);
  assertEventsCount(1);
}
