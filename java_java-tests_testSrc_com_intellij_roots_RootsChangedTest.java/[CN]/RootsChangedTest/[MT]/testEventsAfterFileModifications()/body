{
  File root=new File(FileUtil.getTempDirectory());
  File dir1=new File(root,"dir1");
  assertTrue(dir1.mkdirs());
  VirtualFile vDir1=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(dir1);
  assertNotNull(vDir1);
  Module moduleA=createModule("a.iml");
  myModuleRootListener.reset();
  ModuleRootModificationUtil.addContentRoot(moduleA,vDir1.getPath());
  UIUtil.dispatchAllInvocationEvents();
  assertEventsCount(1);
  assertSameElements(ModuleRootManager.getInstance(moduleA).getContentRoots(),vDir1);
  VfsTestUtil.deleteFile(vDir1);
  assertEventsCount(1);
  assertEmpty(ModuleRootManager.getInstance(moduleA).getContentRoots());
  File dir2=new File(root,"dir2");
  assertTrue(dir2.mkdirs());
  VirtualFile vDir2=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(dir2);
  assertNotNull(vDir2);
  rename(vDir2,"dir1");
  assertEventsCount(1);
  assertSameElements(ModuleRootManager.getInstance(moduleA).getContentRoots(),vDir2);
  rename(vDir2,"dir2");
  assertEventsCount(0);
  assertSameElements(ModuleRootManager.getInstance(moduleA).getContentRoots(),vDir2);
  File subdir=new File(root,"subdir");
  assertTrue(subdir.mkdirs());
  VirtualFile vSubdir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(subdir);
  assertNotNull(vSubdir);
  move(vDir2,vSubdir);
  assertEventsCount(0);
  assertSameElements(ModuleRootManager.getInstance(moduleA).getContentRoots(),vDir2);
}
