{
  Stream<VirtualFile> unversionedFilesStream=e.getData(ChangesListView.UNVERSIONED_FILES_DATA_KEY);
  List<VirtualFile> unversionedFiles=unversionedFilesStream != null ? unversionedFilesStream.collect(Collectors.toList()) : null;
  if (unversionedFiles != null && !unversionedFiles.isEmpty()) {
    return unversionedFiles;
  }
  final VirtualFile[] files=getFromSelection(e);
  final Project project=e.getData(CommonDataKeys.PROJECT);
  if (files == null || project == null) {
    return Collections.emptyList();
  }
  ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(project);
  FileStatusManager fileStatusManager=FileStatusManager.getInstance(project);
  unversionedFiles=new ArrayList<VirtualFile>();
  for (  VirtualFile file : files) {
    if (isFileUnversioned(file,vcsManager,fileStatusManager)) {
      unversionedFiles.add(file);
    }
  }
  return unversionedFiles;
}
