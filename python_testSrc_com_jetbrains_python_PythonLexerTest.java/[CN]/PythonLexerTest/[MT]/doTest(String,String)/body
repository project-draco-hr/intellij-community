{
  Lexer lexer=new PythonIndentingLexer();
  lexer.start(text);
  int idx=0;
  int tokenPos=0;
  while (lexer.getTokenType() != null) {
    if (idx >= expectedTokens.length) {
      StringBuilder remainingTokens=new StringBuilder(lexer.getTokenType().toString());
      lexer.advance();
      while (lexer.getTokenType() != null) {
        remainingTokens.append(" ").append(lexer.getTokenType().toString());
        lexer.advance();
      }
      fail("Too many tokens. Following tokens: " + remainingTokens.toString());
    }
    assertEquals("Token offset mismatch at position " + idx,tokenPos,lexer.getTokenStart());
    String tokenName=lexer.getTokenType().toString();
    assertEquals("Token mismatch at position " + idx,expectedTokens[idx],tokenName);
    idx++;
    tokenPos=lexer.getTokenEnd();
    lexer.advance();
  }
  if (idx < expectedTokens.length)   fail("Not enough tokens");
}
