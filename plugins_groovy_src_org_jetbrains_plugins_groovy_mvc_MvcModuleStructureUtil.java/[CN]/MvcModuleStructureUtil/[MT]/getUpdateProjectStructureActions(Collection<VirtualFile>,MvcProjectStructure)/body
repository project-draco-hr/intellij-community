{
  for (  final VirtualFile appRoot : ModuleRootManager.getInstance(structure.myModule).getContentRoots()) {
    appRoot.refresh(false,false);
  }
  Collection<Consumer<ModifiableRootModel>> actions=ContainerUtil.newArrayList();
  removeInvalidSourceRoots(actions,structure);
  cleanupDefaultLibrary(structure.myModule,actions,appRoots,structure.getUserLibraryName());
  moveupLibrariesFromMavenPlugin(structure.myModule,actions);
  List<VirtualFile> rootsToFacetSetup=new ArrayList<VirtualFile>(appRoots.size());
  for (  VirtualFile appRoot : appRoots) {
    if (checkValidity(appRoot)) {
      ContainerUtil.addIfNotNull(addSourceRootsAndLibDirectory(appRoot,structure),actions);
      rootsToFacetSetup.add(appRoot);
    }
  }
  Collection<Consumer<ModifiableFacetModel>> facetActions=ContainerUtil.newArrayList();
  structure.setupFacets(facetActions,rootsToFacetSetup);
  return Pair.create(actions,facetActions);
}
