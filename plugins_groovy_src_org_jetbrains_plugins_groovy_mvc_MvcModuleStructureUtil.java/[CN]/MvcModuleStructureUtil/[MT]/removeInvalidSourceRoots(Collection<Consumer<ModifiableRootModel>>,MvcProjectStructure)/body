{
  final Set<SourceFolder> toRemove=ContainerUtil.newTroveSet();
  final Set<String> toRemoveContent=ContainerUtil.newTroveSet();
  for (  ContentEntry entry : ModuleRootManager.getInstance(structure.myModule).getContentEntries()) {
    final VirtualFile file=entry.getFile();
    if (file == null || !structure.isValidContentRoot(file)) {
      toRemoveContent.add(entry.getUrl());
    }
 else {
      for (      SourceFolder folder : entry.getSourceFolders()) {
        if (folder.getFile() == null) {
          toRemove.add(folder);
        }
      }
    }
  }
  if (!toRemove.isEmpty() || !toRemoveContent.isEmpty()) {
    actions.add(new Consumer<ModifiableRootModel>(){
      @Override public void consume(      ModifiableRootModel model){
        for (        ContentEntry entry : model.getContentEntries()) {
          if (toRemoveContent.remove(entry.getUrl())) {
            model.removeContentEntry(entry);
          }
 else {
            for (            SourceFolder folder : entry.getSourceFolders()) {
              if (toRemove.remove(folder)) {
                entry.removeSourceFolder(folder);
              }
            }
          }
        }
      }
    }
);
  }
}
