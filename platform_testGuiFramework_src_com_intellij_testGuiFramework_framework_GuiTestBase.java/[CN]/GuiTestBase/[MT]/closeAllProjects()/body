{
  pause(new Condition("Close all projects"){
    @Override public boolean test(){
      final Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
      execute(new GuiTask(){
        @Override protected void executeInEDT() throws Throwable {
          for (          Project project : openProjects) {
            assertTrue("Failed to close project " + quote(project.getName()),closeAndDispose(project));
          }
        }
      }
);
      return ProjectManager.getInstance().getOpenProjects().length == 0;
    }
  }
,SHORT_TIMEOUT);
  boolean welcomeFrameShown=execute(new GuiQuery<Boolean>(){
    @Override protected Boolean executeInEDT() throws Throwable {
      Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
      if (openProjects.length == 0) {
        WelcomeFrame.showNow();
        WindowManagerImpl windowManager=(WindowManagerImpl)WindowManager.getInstance();
        windowManager.disposeRootFrame();
        return true;
      }
      return false;
    }
  }
);
  if (welcomeFrameShown) {
    pause(new Condition("'Welcome' frame to show up"){
      @Override public boolean test(){
        for (        Frame frame : Frame.getFrames()) {
          if (frame == WelcomeFrame.getInstance() && frame.isShowing()) {
            return true;
          }
        }
        return false;
      }
    }
,SHORT_TIMEOUT);
  }
}
