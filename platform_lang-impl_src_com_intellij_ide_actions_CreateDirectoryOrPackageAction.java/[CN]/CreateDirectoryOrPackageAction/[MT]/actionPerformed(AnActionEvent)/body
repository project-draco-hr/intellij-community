{
  IdeView view=e.getData(LangDataKeys.IDE_VIEW);
  final Project project=e.getData(CommonDataKeys.PROJECT);
  if (view == null || project == null) {
    return;
  }
  PsiDirectory directory=DirectoryChooserUtil.getOrChooseDirectory(view);
  if (directory == null)   return;
  final boolean isDirectory=!PsiDirectoryFactory.getInstance(project).isPackage(directory);
  final CreateDirectoryOrPackageHandler validator=new CreateDirectoryOrPackageHandler(project,directory,isDirectory,isDirectory ? "\\/" : ".");
  DumbService.allowStartingDumbModeInside(DumbModePermission.MAY_START_BACKGROUND,new Runnable(){
    public void run(){
      Messages.showInputDialog(project,isDirectory ? IdeBundle.message("prompt.enter.new.directory.name") : IdeBundle.message("prompt.enter.new.package.name"),isDirectory ? IdeBundle.message("title.new.directory") : IdeBundle.message("title.new.package"),Messages.getQuestionIcon(),"",validator);
    }
  }
);
  final PsiElement result=validator.getCreatedElement();
  if (result != null) {
    view.selectElement(result);
  }
}
