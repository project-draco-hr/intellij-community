{
  if (lineNumber < 0)   return true;
  if (lineNumber >= document.getLineCount()) {
    final int elementOffset=elementToMove.getTextRange().getStartOffset();
    final int lineStartOffset=document.getLineStartOffset(document.getLineNumber(elementOffset));
    final int insertIndex=lineNumber < 0 ? 0 : document.getTextLength();
    if (elementOffset != lineStartOffset) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          document.insertString(insertIndex,"\n");
          PsiDocumentManager.getInstance(elementToMove.getProject()).commitAllDocuments();
        }
      }
);
    }
 else     return true;
  }
  return false;
}
