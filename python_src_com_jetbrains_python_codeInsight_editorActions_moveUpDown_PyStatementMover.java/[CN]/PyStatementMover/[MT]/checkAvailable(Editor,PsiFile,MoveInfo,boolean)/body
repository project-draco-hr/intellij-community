{
  if (!(file instanceof PyFile))   return false;
  final int offset=editor.getCaretModel().getOffset();
  final SelectionModel selectionModel=editor.getSelectionModel();
  final Document document=editor.getDocument();
  final int lineNumber=document.getLineNumber(offset);
  int start=getLineStartSafeOffset(document,lineNumber);
  int end=document.getLineEndOffset(lineNumber) - 1;
  if (selectionModel.hasSelection()) {
    start=selectionModel.getSelectionStart();
    end=selectionModel.getSelectionEnd() - 1;
  }
  PsiElement elementToMove1=PyUtil.findNonWhitespaceAtOffset(file,start);
  PsiElement elementToMove2=PyUtil.findNonWhitespaceAtOffset(file,end);
  if (elementToMove1 == null || elementToMove2 == null)   return false;
  if (ifInsideString(document,lineNumber,elementToMove1,down))   return false;
  elementToMove1=getCommentOrStatement(document,elementToMove1);
  elementToMove2=getCommentOrStatement(document,elementToMove2);
  if (PsiTreeUtil.isAncestor(elementToMove1,elementToMove2,false)) {
    elementToMove2=elementToMove1;
  }
 else   if (PsiTreeUtil.isAncestor(elementToMove2,elementToMove1,false)) {
    elementToMove1=elementToMove2;
  }
  info.toMove=new MyLineRange(elementToMove1,elementToMove2);
  info.toMove2=getDestinationScope(file,editor,down ? elementToMove2 : elementToMove1,down);
  info.indentTarget=false;
  info.indentSource=false;
  return true;
}
