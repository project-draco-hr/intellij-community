{
  return RecursionManager.doPreventingRecursion(var,false,new NullableComputable<PsiType>(){
    @Override public PsiType compute(){
      final Collection<PsiReference> all=ReferencesSearch.search(var,var.getUseScope()).findAll();
      final GrExpression initializer=var.getInitializerGroovy();
      if (initializer == null && all.isEmpty()) {
        return var.getDeclaredType();
      }
      PsiType result=initializer != null ? initializer.getType() : null;
      final PsiManager manager=var.getManager();
      for (      PsiReference reference : all) {
        final PsiElement ref=reference.getElement();
        if (ref instanceof GrReferenceExpression && PsiUtil.isLValue(((GrReferenceExpression)ref))) {
          result=TypesUtil.getLeastUpperBoundNullable(result,TypeInferenceHelper.getInitializerTypeFor(ref),manager);
        }
      }
      return result;
    }
  }
);
}
