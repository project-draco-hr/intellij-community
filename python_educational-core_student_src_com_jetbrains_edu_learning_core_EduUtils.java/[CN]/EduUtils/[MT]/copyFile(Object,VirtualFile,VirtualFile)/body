{
  Document document=FileDocumentManager.getInstance().getDocument(file);
  if (document != null) {
    FileDocumentManager.getInstance().saveDocument(document);
  }
  String name=file.getName();
  try {
    VirtualFile userFile=toDir.findChild(name);
    if (userFile != null) {
      userFile.delete(requestor);
    }
    return VfsUtilCore.copyFile(requestor,file,toDir);
  }
 catch (  IOException e) {
    LOG.info("Failed to create file " + name + "  in folder "+ toDir.getPath(),e);
  }
  return null;
}
