{
  if (t instanceof ControlFlowException) {
    myLogger.error(message,new Throwable("Control-flow exceptions (like " + t.getClass().getSimpleName() + ") should never be logged",t));
    if (t instanceof RuntimeException) {
      throw (RuntimeException)t;
    }
 else {
      throw new RuntimeException(t);
    }
  }
  String detailString=StringUtil.join(details,"\n");
  if (ourErrorsOccurred == null) {
    String s=message != null && !message.isEmpty() ? "Error message is '" + message + "'" : "";
    String mess="Logger errors occurred. See IDEA logs for details. " + s;
    ourErrorsOccurred=new Exception(mess + (!detailString.isEmpty() ? "\nDetails: " + detailString : ""),t);
  }
  myLogger.error(message + (!detailString.isEmpty() ? "\nDetails: " + detailString : ""),t);
  logErrorHeader();
}
