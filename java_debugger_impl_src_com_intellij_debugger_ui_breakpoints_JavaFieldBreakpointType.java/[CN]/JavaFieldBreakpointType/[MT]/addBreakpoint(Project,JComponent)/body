{
  final Ref<XLineBreakpoint<JavaFieldBreakpointProperties>> result=Ref.create(null);
  AddFieldBreakpointDialog dialog=new AddFieldBreakpointDialog(project){
    protected boolean validateData(){
      final String className=getClassName();
      if (className.length() == 0) {
        Messages.showMessageDialog(project,DebuggerBundle.message("error.field.breakpoint.class.name.not.specified"),DebuggerBundle.message("add.field.breakpoint.dialog.title"),Messages.getErrorIcon());
        return false;
      }
      final String fieldName=getFieldName();
      if (fieldName.length() == 0) {
        Messages.showMessageDialog(project,DebuggerBundle.message("error.field.breakpoint.field.name.not.specified"),DebuggerBundle.message("add.field.breakpoint.dialog.title"),Messages.getErrorIcon());
        return false;
      }
      PsiClass psiClass=JavaPsiFacade.getInstance(project).findClass(className,GlobalSearchScope.allScope(project));
      if (psiClass != null) {
        final PsiFile psiFile=psiClass.getContainingFile();
        Document document=PsiDocumentManager.getInstance(project).getDocument(psiFile);
        if (document != null) {
          PsiField field=psiClass.findFieldByName(fieldName,true);
          if (field != null) {
            final int line=document.getLineNumber(field.getTextOffset());
            ApplicationManager.getApplication().runWriteAction(new Runnable(){
              @Override public void run(){
                XLineBreakpoint<JavaFieldBreakpointProperties> fieldBreakpoint=XDebuggerManager.getInstance(project).getBreakpointManager().addLineBreakpoint(JavaFieldBreakpointType.this,psiFile.getVirtualFile().getUrl(),line,new JavaFieldBreakpointProperties(fieldName,className));
                result.set(fieldBreakpoint);
              }
            }
);
            return true;
          }
 else {
            Messages.showMessageDialog(project,DebuggerBundle.message("error.field.breakpoint.field.not.found",className,fieldName,fieldName),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
          }
        }
      }
 else {
        Messages.showMessageDialog(project,DebuggerBundle.message("error.field.breakpoint.class.sources.not.found",className,fieldName,className),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
      }
      return false;
    }
  }
;
  dialog.show();
  return result.get();
}
