{
  if (file.isDirectory() || FileTypeRegistry.getInstance().isFileIgnored(file) || file.getFileType().isBinary()|| file.equals(project.getProjectFile())|| file.equals(project.getWorkspaceFile())) {
    return false;
  }
  Module module=FileIndexFacade.getInstance(project).getModuleForFile(file);
  if (module != null && file.equals(module.getModuleFile())) {
    return false;
  }
  return !FileModificationService.getInstance().prepareVirtualFilesForWrite(project,Collections.singletonList(file));
}
