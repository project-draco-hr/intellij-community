{
  XmlTag dummyRootTag=null;
  String templateString=template.getString();
  final PsiFileFactory psiFileFactory=PsiFileFactory.getInstance(callback.getProject());
  if (!containsAttrsVar(template)) {
    XmlFile dummyFile=(XmlFile)psiFileFactory.createFileFromText("dummy.html",HTMLLanguage.INSTANCE,templateString,false,true);
    dummyRootTag=dummyFile.getRootTag();
    if (dummyRootTag != null) {
      addMissingAttributes(dummyRootTag,attributes);
    }
  }
  templateString=dummyRootTag != null ? dummyRootTag.getContainingFile().getText() : templateString;
  XmlFile xmlFile=(XmlFile)psiFileFactory.createFileFromText("dummy.xml",StdFileTypes.XML,templateString,LocalTimeCounter.currentTime(),true);
  VirtualFile vFile=xmlFile.getVirtualFile();
  if (vFile != null) {
    vFile.putUserData(UndoConstants.DONT_RECORD_UNDO,Boolean.TRUE);
  }
  return xmlFile;
}
