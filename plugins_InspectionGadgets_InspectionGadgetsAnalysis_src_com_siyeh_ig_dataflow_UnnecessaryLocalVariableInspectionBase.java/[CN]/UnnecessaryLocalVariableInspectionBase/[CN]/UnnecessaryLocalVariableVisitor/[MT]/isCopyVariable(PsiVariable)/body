{
  final PsiExpression initializer=ParenthesesUtils.stripParentheses(variable.getInitializer());
  if (!(initializer instanceof PsiReferenceExpression)) {
    return false;
  }
  final PsiReferenceExpression reference=(PsiReferenceExpression)initializer;
  final PsiElement referent=reference.resolve();
  if (referent == null) {
    return false;
  }
  if (!(referent instanceof PsiLocalVariable || referent instanceof PsiParameter)) {
    return false;
  }
  if (!(referent instanceof PsiResourceVariable) && variable instanceof PsiResourceVariable) {
    return false;
  }
  final PsiCodeBlock containingScope=PsiTreeUtil.getParentOfType(variable,PsiCodeBlock.class);
  if (containingScope == null) {
    return false;
  }
  if (!variable.hasModifierProperty(PsiModifier.FINAL) && VariableAccessUtils.variableIsAssigned(variable,containingScope,false)) {
    return false;
  }
  final PsiVariable initialization=(PsiVariable)referent;
  if (!initialization.hasModifierProperty(PsiModifier.FINAL) && VariableAccessUtils.variableIsAssigned(initialization,containingScope,false)) {
    return false;
  }
  final PsiResolveHelper resolveHelper=JavaPsiFacade.getInstance(containingScope.getProject()).getResolveHelper();
  final String initializationName=initialization.getName();
  final boolean finalVariableIntroduction=!initialization.hasModifierProperty(PsiModifier.FINAL) && variable.hasModifierProperty(PsiModifier.FINAL) || PsiUtil.isLanguageLevel8OrHigher(initialization) && !HighlightControlFlowUtil.isEffectivelyFinal(initialization,containingScope,null) && HighlightControlFlowUtil.isEffectivelyFinal(variable,containingScope,null);
  final PsiType variableType=variable.getType();
  final PsiType initializationType=initialization.getType();
  final boolean sameType=Comparing.equal(variableType,initializationType);
  for (  PsiReference ref : ReferencesSearch.search(variable,new LocalSearchScope(containingScope))) {
    final PsiElement refElement=ref.getElement();
    if (finalVariableIntroduction) {
      final PsiElement element=PsiTreeUtil.getParentOfType(refElement,PsiClass.class,PsiLambdaExpression.class);
      if (element != null && PsiTreeUtil.isAncestor(containingScope,element,true)) {
        return false;
      }
    }
    if (resolveHelper.resolveReferencedVariable(initializationName,refElement) != initialization) {
      return false;
    }
    if (!sameType) {
      final PsiElement parent=refElement.getParent();
      if (parent instanceof PsiReferenceExpression) {
        final PsiElement resolve=((PsiReferenceExpression)parent).resolve();
        if (resolve instanceof PsiMember && ((PsiMember)resolve).hasModifierProperty(PsiModifier.PRIVATE)) {
          return false;
        }
      }
    }
  }
  return !TypeConversionUtil.boxingConversionApplicable(variableType,initializationType);
}
