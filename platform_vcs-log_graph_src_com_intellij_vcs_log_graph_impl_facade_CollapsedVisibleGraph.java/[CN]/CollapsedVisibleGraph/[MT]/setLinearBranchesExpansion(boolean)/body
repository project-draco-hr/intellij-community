{
  if (!collapse) {
    myCollapsedGraph.expandAll();
  }
 else {
    LinearFragmentGenerator fragmentGenerator=new LinearFragmentGenerator(myCollapsedGraph,myPermanentGraph.getNotCollapsedNodes());
    for (int i=0; i < myCollapsedGraph.nodesCount(); i++) {
      if (myCollapsedGraph.nodeIsVisible(i)) {
        LinearFragmentGenerator.GraphFragment longDownFragment=fragmentGenerator.getLongDownFragment(i);
        if (longDownFragment != null) {
          myCollapsedGraph.fastCollapse(longDownFragment.upNodeIndex,longDownFragment.downNodeIndex);
        }
      }
    }
    myCollapsedGraph.callListeners();
  }
}
