{
  LinearGraphAsGraphWithHiddenNodes branchesGraph=createBranchesGraph(permanentGraph,heads);
  CollapsedGraphWithHiddenNodes collapsedGraph=new CollapsedGraphWithHiddenNodes(branchesGraph);
  GraphWithHiddenNodesAsGraphWithCommitInfo<CommitId> graphWithCommitInfo=new GraphWithHiddenNodesAsGraphWithCommitInfo<CommitId>(collapsedGraph,permanentGraph.getPermanentGraphLayout(),permanentGraph.getPermanentCommitsInfo());
  FragmentGenerator fragmentGeneratorForPrinterGraph=new FragmentGenerator(graphWithCommitInfo,permanentGraph.getNotCollapsedNodes());
  PrintElementsManagerImpl printElementsManager=new PrintElementsManagerImpl(graphWithCommitInfo,fragmentGeneratorForPrinterGraph);
  return new CollapsedVisibleGraph<CommitId>(graphWithCommitInfo,collapsedGraph,permanentGraph.getCommitsWithNotLoadParent(),printElementsManager,fragmentGeneratorForPrinterGraph);
}
