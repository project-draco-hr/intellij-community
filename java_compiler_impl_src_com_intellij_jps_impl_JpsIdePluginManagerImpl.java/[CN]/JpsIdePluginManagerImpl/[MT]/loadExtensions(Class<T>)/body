{
  String resourceName="META-INF/services/" + extensionClass.getName();
  Set<Class<T>> classes=new LinkedHashSet<Class<T>>();
  for (  PluginDescriptor plugin : myExternalBuildPlugins) {
    ClassLoader loader=plugin.getPluginClassLoader();
    if (loader == null)     continue;
    try {
      Enumeration<URL> resources=loader.getResources(resourceName);
      while (resources.hasMoreElements()) {
        loadImplementations(resources.nextElement(),loader,classes);
      }
    }
 catch (    IOException e) {
      throw new ServiceConfigurationError("Cannot load configuration files for " + extensionClass.getName(),e);
    }
  }
  List<T> extensions=new ArrayList<T>();
  for (  Class<T> aClass : classes) {
    try {
      extensions.add(extensionClass.cast(aClass.newInstance()));
    }
 catch (    Exception e) {
      throw new ServiceConfigurationError("Class " + aClass.getName() + " cannot be instantiated",e);
    }
  }
  return extensions;
}
