{
  CharsetToolkit toolkit=new CharsetToolkit(content,currentCharset);
  toolkit.setEnforce8Bit(true);
  Charset charset=toolkit.guessFromBOM();
  if (charset == null) {
    CharsetToolkit.GuessedEncoding guessed=toolkit.guessFromContent(content.length);
    if (guessed == CharsetToolkit.GuessedEncoding.VALID_UTF8)     charset=CharsetToolkit.UTF8_CHARSET;
  }
  if (charset == null) {
    charset=currentCharset;
  }
  if (ProjectFileType.INSTANCE.equals(fileType) && EncodingManager.getInstance().isNative2AsciiForPropertiesFiles()) {
    charset=Native2AsciiCharset.wrap(charset);
  }
  return charset;
}
