{
  Process p=ProcessUtils.createProcess(new String[]{"wmic.exe","path","win32_process","get","Caption,Processid,Commandline"},null,null);
  List<ProcessInfo> lst=new ArrayList<ProcessInfo>();
  InputStream in=p.getInputStream();
  InputStreamReader reader=new InputStreamReader(in);
  try {
    BufferedReader br=new BufferedReader(reader);
    String line=br.readLine();
    int commandLineI=line.indexOf("CommandLine");
    int processIdI=line.indexOf("ProcessId");
    if (commandLineI == -1) {
      throw new AssertionError("Could not find CommandLine in: " + line);
    }
    if (processIdI == -1) {
      throw new AssertionError("Could not find ProcessId in: " + line);
    }
    while (true) {
      line=br.readLine();
      if (line == null) {
        break;
      }
      if (line.trim().length() == 0) {
        continue;
      }
      String name=line.substring(0,commandLineI).trim();
      String commandLine=line.substring(commandLineI,processIdI).trim();
      String processId=line.substring(processIdI,line.length()).trim();
      lst.add(new ProcessInfo(Integer.parseInt(processId),name + "   " + commandLine));
    }
    if (lst.size() == 0) {
      throw new AssertionError("Error: no processes found");
    }
    return lst.toArray(new ProcessInfo[0]);
  }
 catch (  Exception e) {
    LOG.error(e);
    throw e;
  }
 finally {
    in.close();
  }
}
