{
  Promise<T> oldValue=ref.getAndSet(Promise.resolve(result));
  if (oldValue != null && oldValue instanceof AsyncPromise) {
    rejectAndDispose((AsyncPromise<T>)oldValue);
  }
}
