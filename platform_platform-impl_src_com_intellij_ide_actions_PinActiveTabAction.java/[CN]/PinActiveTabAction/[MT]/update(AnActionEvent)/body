{
  boolean selected=isSelected(e);
  e.getPresentation().putClientProperty(SELECTED_PROPERTY,selected);
  String text;
  boolean enable;
  EditorWindow window=getEditorWindow(e);
  VirtualFile selectedFile=window == null ? null : getFileInWindow(e,window);
  if (selectedFile != null) {
    enable=!window.getOwner().isPreview();
  }
 else {
    Content content=getNonEditorContent(e);
    enable=content != null && content.isPinnable();
  }
  if (ActionPlaces.isMainMenuOrActionSearch(e.getPlace()) || !(selectedFile == null || selectedFile.equals(e.getData(CommonDataKeys.VIRTUAL_FILE)))) {
    text=selected ? IdeBundle.message("action.unpin.active.tab") : IdeBundle.message("action.pin.active.tab");
  }
 else {
    text=selected ? IdeBundle.message("action.unpin.tab") : IdeBundle.message("action.pin.tab");
  }
  e.getPresentation().setIcon(ActionPlaces.isToolbarPlace(e.getPlace()) ? AllIcons.General.Pin_tab : null);
  e.getPresentation().setText(text);
  e.getPresentation().setEnabledAndVisible(enable);
}
