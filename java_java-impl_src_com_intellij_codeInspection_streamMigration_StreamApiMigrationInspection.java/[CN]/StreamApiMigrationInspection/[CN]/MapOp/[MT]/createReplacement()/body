{
  if (isIdentityMapping(myVariable,myExpression)) {
    if (!(myType instanceof PsiPrimitiveType)) {
      return myVariable.getType() instanceof PsiPrimitiveType ? ".boxed()" : "";
    }
    if (myType.equals(myVariable.getType())) {
      return "";
    }
    if (PsiType.LONG.equals(myType) && PsiType.INT.equals(myVariable.getType())) {
      return ".asLongStream()";
    }
    if (PsiType.DOUBLE.equals(myType) && (PsiType.LONG.equals(myVariable.getType()) || PsiType.INT.equals(myVariable.getType()))) {
      return ".asDoubleStream()";
    }
  }
  String operationName="map";
  if (myType instanceof PsiPrimitiveType) {
    if (!myType.equals(myVariable.getType())) {
      if (PsiType.INT.equals(myType)) {
        operationName="mapToInt";
      }
 else       if (PsiType.LONG.equals(myType)) {
        operationName="mapToLong";
      }
 else       if (PsiType.DOUBLE.equals(myType)) {
        operationName="mapToDouble";
      }
    }
  }
 else   if (myVariable.getType() instanceof PsiPrimitiveType) {
    operationName="mapToObj";
  }
  PsiExpression expression=myType == null ? myExpression : RefactoringUtil.convertInitializerToNormalExpression(myExpression,myType);
  if (myType != null && !(myType instanceof PsiPrimitiveType) && !(myType instanceof PsiCapturedWildcardType)) {
    operationName="<" + myType.getCanonicalText() + ">"+ operationName;
  }
  return "." + operationName + "("+ LambdaUtil.createLambda(myVariable,expression)+ ")";
}
