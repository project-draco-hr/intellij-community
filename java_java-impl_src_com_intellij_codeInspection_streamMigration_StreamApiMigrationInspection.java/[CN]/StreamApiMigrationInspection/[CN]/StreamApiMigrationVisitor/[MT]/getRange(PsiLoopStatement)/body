{
  boolean wholeStatement=false;
  if (myIsOnTheFly) {
    if (myKey == null) {
      myKey=HighlightDisplayKey.find(getShortName());
    }
    if (myKey != null) {
      InspectionProfile profile=InspectionProjectProfileManager.getInstance(statement.getProject()).getCurrentProfile();
      HighlightDisplayLevel level=profile.getErrorLevel(myKey,statement);
      wholeStatement=HighlightDisplayLevel.DO_NOT_SHOW.equals(level);
    }
  }
  if (statement instanceof PsiForeachStatement) {
    PsiJavaToken rParenth=((PsiForeachStatement)statement).getRParenth();
    if (wholeStatement && rParenth != null) {
      return new TextRange(statement.getTextOffset(),rParenth.getTextOffset() + 1);
    }
    PsiExpression iteratedValue=((PsiForeachStatement)statement).getIteratedValue();
    LOG.assertTrue(iteratedValue != null);
    return iteratedValue.getTextRange();
  }
 else   if (statement instanceof PsiForStatement) {
    PsiJavaToken rParenth=((PsiForStatement)statement).getRParenth();
    if (wholeStatement && rParenth != null) {
      return new TextRange(statement.getTextOffset(),rParenth.getTextOffset() + 1);
    }
    PsiStatement initialization=((PsiForStatement)statement).getInitialization();
    LOG.assertTrue(initialization != null);
    return initialization.getTextRange();
  }
 else {
    throw new IllegalStateException("Unexpected statement type: " + statement);
  }
}
