{
  final ValueContainerMap<Key,Value> map=new ValueContainerMap<Key,Value>(myStorageFile,myKeyDescriptor,myDataExternalizer);
  myCache=new SLRUCache<Key,ChangeTrackingValueContainer<Value>>(myCacheSize,(int)(Math.ceil(myCacheSize * 0.25))){
    @Override @NotNull public ChangeTrackingValueContainer<Value> createValue(    final Key key){
      return new ChangeTrackingValueContainer<Value>(new ChangeTrackingValueContainer.Initializer<Value>(){
        @NotNull @Override public Object getLock(){
          return map.getDataAccessLock();
        }
        @Nullable @Override public ValueContainer<Value> compute(){
          ValueContainer<Value> value;
          try {
            value=map.get(key);
            if (value == null) {
              value=new ValueContainerImpl<Value>();
            }
          }
 catch (          IOException e) {
            throw new RuntimeException(e);
          }
          return value;
        }
      }
);
    }
    @Override protected void onDropFromCache(    final Key key,    @NotNull final ChangeTrackingValueContainer<Value> valueContainer){
      if (valueContainer.isDirty()) {
        try {
          map.put(key,valueContainer);
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
      }
    }
  }
;
  myMap=map;
  myKeyHashToVirtualFileMapping=myBuildKeyHashToVirtualFileMapping ? new PersistentBTreeEnumerator<int[]>(getProjectFile(),new KeyDescriptor<int[]>(){
    @Override public void save(    DataOutput out,    int[] value) throws IOException {
      DataInputOutputUtil.writeINT(out,value[0]);
      DataInputOutputUtil.writeINT(out,value[1]);
    }
    @Override public int[] read(    DataInput in) throws IOException {
      return new int[]{DataInputOutputUtil.readINT(in),DataInputOutputUtil.readINT(in)};
    }
    @Override public int getHashCode(    int[] value){
      return value[0] * 31 + value[1];
    }
    @Override public boolean isEqual(    int[] val1,    int[] val2){
      return val1[0] == val2[0] && val1[1] == val2[1];
    }
  }
,4096){
    protected boolean serializationEquivalenceIsExhausting(){
      return true;
    }
  }
 : null;
}
