{
  GrExpression qualifier=ref.getQualifier();
  if (qualifier == null) {
    final PsiElement parent=ref.getParent();
    if (parent instanceof GrConstructorInvocation) {
      return ((GrConstructorInvocation)parent).multiResolve(false);
    }
 else {
      PsiClass aClass=PsiUtil.getContextClass(ref);
      if (aClass != null) {
        return new GroovyResolveResultImpl[]{new GroovyResolveResultImpl(aClass,null,null,PsiSubstitutor.EMPTY,true,true)};
      }
    }
  }
 else   if (qualifier instanceof GrReferenceExpression) {
    GroovyResolveResult result=((GrReferenceExpression)qualifier).advancedResolve();
    PsiElement resolved=result.getElement();
    if (resolved instanceof PsiClass && PsiUtil.hasEnclosingInstanceInScope((PsiClass)resolved,ref,false)) {
      return new GroovyResolveResult[]{result};
    }
  }
  return null;
}
