{
  myHgDir=hgDir;
  RepositoryUtil.assertFileExists(myHgDir,".hg directory not found in " + myHgDir);
  myVcs=vcs;
  HgVersion version=myVcs.getVersion();
  myStatusInBranchFile=version.hasBranch2();
  myCacheDir=new File(myHgDir,"cache");
  myBranchHeadsFile=identifyBranchHeadFile(version,myCacheDir);
  myCurrentBranch=new File(myHgDir,"branch");
  myBookmarksFile=new File(myHgDir,"bookmarks");
  myCurrentBookmark=new File(myHgDir,"bookmarks.current");
  myLocalTagsFile=new File(myHgDir,"localtags");
  myTagsFile=new File(myHgDir.getParentFile(),".hgtags");
  myDirStateFile=new File(myHgDir,"dirstate");
  myVcsObjectsFactory=ServiceManager.getService(vcs.getProject(),VcsLogObjectsFactory.class);
}
