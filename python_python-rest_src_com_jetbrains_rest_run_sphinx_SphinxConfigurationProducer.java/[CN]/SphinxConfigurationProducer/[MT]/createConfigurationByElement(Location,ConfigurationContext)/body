{
  PsiElement element=location.getPsiElement();
  if (!(element instanceof PsiDirectory))   return null;
  mySourceFile=(PsiDirectory)element;
  boolean hasRstFile=false;
  boolean hasConf=false;
  for (  PsiFile file : mySourceFile.getFiles()) {
    if ("conf.py".equals(file.getName()))     hasConf=true;
    if (file instanceof RestFile) {
      hasRstFile=true;
    }
  }
  if (!hasRstFile || !hasConf)   return null;
  final Project project=mySourceFile.getProject();
  RunnerAndConfigurationSettings settings=cloneTemplateConfiguration(project,context);
  SphinxRunConfiguration configuration=(SphinxRunConfiguration)settings.getConfiguration();
  final VirtualFile vFile=mySourceFile.getVirtualFile();
  configuration.setInputFile(vFile.getPath());
  configuration.setName(((PsiDirectory)element).getName());
  if (configuration.getTask().isEmpty())   configuration.setTask("html");
  final VirtualFile parent=vFile.getParent();
  if (parent != null) {
    configuration.setWorkingDirectory(parent.getPath());
  }
  configuration.setName(configuration.suggestedName());
  Module module=ModuleUtil.findModuleForPsiElement(element);
  if (module != null) {
    configuration.setUseModuleSdk(true);
    configuration.setModule(module);
  }
  return settings;
}
