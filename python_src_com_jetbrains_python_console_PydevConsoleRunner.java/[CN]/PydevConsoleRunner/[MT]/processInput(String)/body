{
  final LanguageConsoleImpl console=myConsoleView.getConsole();
  final Editor currentEditor=console.getCurrentEditor();
  if (myInputBuffer == null) {
    myInputBuffer=new StringBuilder();
  }
  myInputBuffer.append(input).append("\n");
  if (myCurrentIndentSize != -1) {
    final int indent=myHelper.getIndent(input,false);
    if (indent >= myCurrentIndentSize) {
      indentEditor(currentEditor,indent);
      scrollDown(currentEditor);
      return;
    }
  }
  if (myPydevConsoleCommunication != null) {
    final boolean waitedForInputBefore=myPydevConsoleCommunication.waitingForInput;
    myPydevConsoleCommunication.execInterpreter(myInputBuffer.toString(),new ICallback<Object,InterpreterResponse>(){
      public Object call(      final InterpreterResponse interpreterResponse){
        myInputBuffer=null;
        if (interpreterResponse.need_input) {
          if (!PyConsoleHighlightingUtil.INPUT_PROMPT.equals(console.getPrompt())) {
            console.setPrompt(PyConsoleHighlightingUtil.INPUT_PROMPT);
            scrollDown(currentEditor);
          }
          myCurrentIndentSize=-1;
        }
 else         if (interpreterResponse.more) {
          if (!PyConsoleHighlightingUtil.INDENT_PROMPT.equals(console.getPrompt())) {
            console.setPrompt(PyConsoleHighlightingUtil.INDENT_PROMPT);
            scrollDown(currentEditor);
            myCurrentIndentSize=myHelper.getIndent(input,false) + currentPythonIndentSize;
            indentEditor(currentEditor,myCurrentIndentSize);
          }
        }
 else {
          if (!PyConsoleHighlightingUtil.ORDINARY_PROMPT.equals(console.getPrompt())) {
            console.setPrompt(PyConsoleHighlightingUtil.ORDINARY_PROMPT);
            scrollDown(currentEditor);
          }
          myCurrentIndentSize=-1;
        }
        if (!StringUtil.isEmpty(interpreterResponse.err)) {
          PyConsoleHighlightingUtil.processOutput(console,interpreterResponse.err,ProcessOutputTypes.STDERR);
        }
 else {
          PyConsoleHighlightingUtil.processOutput(console,interpreterResponse.out,ProcessOutputTypes.STDOUT);
        }
        return null;
      }
    }
);
    if (waitedForInputBefore && !myPydevConsoleCommunication.waitingForInput) {
      console.setPrompt(PyConsoleHighlightingUtil.ORDINARY_PROMPT);
      scrollDown(currentEditor);
    }
  }
}
