{
  if (myPydevConsoleCommunication != null) {
    final boolean waitedForInputBefore=myPydevConsoleCommunication.waitingForInput;
    myPydevConsoleCommunication.execInterpreter(input,new ICallback<Object,InterpreterResponse>(){
      public Object call(      final InterpreterResponse interpreterResponse){
        final LanguageConsoleImpl console=myConsoleView.getConsole();
        final Editor currentEditor=console.getCurrentEditor();
        if (interpreterResponse.need_input) {
          if (!PyConsoleHighlightingUtil.INPUT_PROMPT.equals(console.getPrompt())) {
            console.setPrompt(PyConsoleHighlightingUtil.INPUT_PROMPT);
            currentEditor.getCaretModel().moveToOffset(currentEditor.getDocument().getTextLength());
          }
        }
 else         if (interpreterResponse.more) {
          if (!PyConsoleHighlightingUtil.INDENT_PROMPT.equals(console.getPrompt())) {
            console.setPrompt(PyConsoleHighlightingUtil.INDENT_PROMPT);
            currentEditor.getCaretModel().moveToOffset(currentEditor.getDocument().getTextLength());
            myCurrentIndentSize=myHelper.getIndent(input,false) + currentPythonIndentSize;
          }
          new WriteCommandAction(myProject){
            @Override protected void run(            Result result) throws Throwable {
              EditorModificationUtil.insertStringAtCaret(console.getConsoleEditor(),myHelper.fillIndent(myCurrentIndentSize));
            }
          }
.execute();
        }
 else {
          if (!PyConsoleHighlightingUtil.ORDINARY_PROMPT.equals(console.getPrompt())) {
            console.setPrompt(PyConsoleHighlightingUtil.ORDINARY_PROMPT);
            currentEditor.getCaretModel().moveToOffset(currentEditor.getDocument().getTextLength());
          }
        }
        if (!StringUtil.isEmpty(interpreterResponse.err)) {
          PyConsoleHighlightingUtil.processOutput(console,interpreterResponse.err,ProcessOutputTypes.STDERR);
        }
 else {
          PyConsoleHighlightingUtil.processOutput(console,interpreterResponse.out,ProcessOutputTypes.STDOUT);
        }
        return null;
      }
    }
);
    if (waitedForInputBefore && !myPydevConsoleCommunication.waitingForInput) {
      final LanguageConsoleImpl console=myConsoleView.getConsole();
      console.setPrompt(PyConsoleHighlightingUtil.ORDINARY_PROMPT);
    }
  }
}
