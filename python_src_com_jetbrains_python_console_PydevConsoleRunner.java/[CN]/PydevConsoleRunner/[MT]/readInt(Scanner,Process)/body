{
  long started=System.currentTimeMillis();
  while (System.currentTimeMillis() - started < PORTS_WAITING_TIMEOUT) {
    if (s.hasNextLine()) {
      String line=s.nextLine();
      try {
        return Integer.parseInt(line);
      }
 catch (      NumberFormatException ignored) {
        continue;
      }
    }
    try {
      Thread.sleep(200);
    }
 catch (    InterruptedException ignored) {
    }
    if (process.exitValue() != 0) {
      String error;
      try {
        error="Console process terminated with error:\n" + StreamUtil.readText(process.getErrorStream());
      }
 catch (      Exception ignored) {
        error="Console process terminated with exit code " + process.exitValue();
      }
      throw new ExecutionException(error);
    }
 else {
      break;
    }
  }
  throw new ExecutionException("Couldn't read integer value from stream");
}
