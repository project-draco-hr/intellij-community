{
  super.initAndRun();
  if (handshake()) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      @Override public void run(){
        final PythonConsoleView consoleView=getConsoleView();
        consoleView.setConsoleCommunication(myPydevConsoleCommunication);
        consoleView.setSdk(mySdk);
        consoleView.setExecutionHandler(myConsoleExecuteActionHandler);
        myProcessHandler.addProcessListener(new ProcessAdapter(){
          @Override public void onTextAvailable(          ProcessEvent event,          Key outputType){
            consoleView.print(event.getText(),outputType);
          }
        }
);
        enableConsoleExecuteAction();
        consoleView.executeStatement(PYTHON_ENV_COMMAND,ProcessOutputTypes.SYSTEM);
        for (        String statement : statements2execute) {
          consoleView.executeStatement(statement + "\n",ProcessOutputTypes.SYSTEM);
        }
        fireConsoleInitializedEvent(consoleView);
      }
    }
);
  }
 else {
    getConsoleView().print("Couldn't connect to console process.",ProcessOutputTypes.STDERR);
    myProcessHandler.destroyProcess();
    finishConsole();
  }
}
