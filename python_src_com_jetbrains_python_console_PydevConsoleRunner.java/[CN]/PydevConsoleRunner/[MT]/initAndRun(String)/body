{
  super.initAndRun();
  if (handshake()) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      @Override public void run(){
        ((PydevLanguageConsoleView)getConsoleView()).setConsoleCommunication(myPydevConsoleCommunication);
        final LanguageConsoleImpl console=getConsoleView().getConsole();
        enableConsoleExecuteAction();
        PyConsoleHighlightingUtil.processOutput(console,PYTHON_ENV_COMMAND,ProcessOutputTypes.SYSTEM);
        getConsoleExecuteActionHandler().processLine(PYTHON_ENV_COMMAND);
        for (        String statement : statements2execute) {
          PyConsoleHighlightingUtil.processOutput(console,statement + "\n",ProcessOutputTypes.SYSTEM);
          getConsoleExecuteActionHandler().processLine(statement + "\n");
        }
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            console.flushAllUiUpdates();
          }
        }
);
      }
    }
);
  }
 else {
    final LanguageConsoleImpl console=getConsoleView().getConsole();
    PyConsoleHighlightingUtil.processOutput(console,"Couldn't connect to console process.",ProcessOutputTypes.STDERR);
    myProcessHandler.destroyProcess();
    finishConsole();
  }
}
