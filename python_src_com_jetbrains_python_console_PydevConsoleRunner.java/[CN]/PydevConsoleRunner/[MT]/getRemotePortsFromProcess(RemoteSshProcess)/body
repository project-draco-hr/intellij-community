{
  Scanner s=new Scanner(process.getInputStream());
  long started=System.currentTimeMillis();
  while (System.currentTimeMillis() - started < PORTS_WAITING_TIMEOUT) {
    try {
      int port=s.nextInt();
      int port2=s.nextInt();
      return Pair.create(port,port2);
    }
 catch (    Exception e) {
      try {
        Thread.sleep(200);
      }
 catch (      InterruptedException e1) {
      }
    }
    try {
      if (process.exitValue() != 0) {
        String error;
        try {
          error="Console process terminated with error:\n" + StreamUtil.readText(process.getErrorStream());
        }
 catch (        Exception e) {
          error="Console process terminated with exit code " + process.exitValue();
        }
        throw new ExecutionException(error);
      }
 else {
        break;
      }
    }
 catch (    IllegalThreadStateException e) {
    }
  }
  throw new ExecutionException("Couldn't get remote ports for console connection.");
}
