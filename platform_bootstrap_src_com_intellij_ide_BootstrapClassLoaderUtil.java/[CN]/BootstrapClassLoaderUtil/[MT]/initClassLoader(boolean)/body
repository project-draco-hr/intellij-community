{
  PathManager.loadProperties();
  Collection<URL> classpath=new LinkedHashSet<URL>();
  addParentClasspath(classpath);
  addIDEALibraries(classpath);
  addAdditionalClassPath(classpath);
  UrlClassLoader.Builder builder=UrlClassLoader.build().urls(filterClassPath(new ArrayList<URL>(classpath))).allowLock(false).usePersistentClasspathIndexForLocalClassDirectories().useCache();
  if (Boolean.valueOf(System.getProperty(PROPERTY_ALLOW_BOOTSTRAP_RESOURCES,"true"))) {
    builder.allowBootstrapResources();
  }
  UrlClassLoader newClassLoader=builder.get();
  if (updatePlugins && !isLoadingOfExternalPluginsDisabled()) {
    try {
      StartupActionScriptManager.executeActionScript();
    }
 catch (    IOException e) {
      Main.showMessage("Plugin Installation Error",e);
    }
  }
  Thread.currentThread().setContextClassLoader(newClassLoader);
  return newClassLoader;
}
