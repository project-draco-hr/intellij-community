{
  PathManager.loadProperties();
  List<URL> classpathElements=new ArrayList<URL>();
  addParentClasspath(classpathElements);
  addIDEALibraries(classpathElements);
  addAdditionalClassPath(classpathElements);
  UrlClassLoader newClassLoader=new UrlClassLoader(filterClassPath(classpathElements),null,true,true);
  if (updatePlugins && !isLoadingOfExternalPluginsDisabled()) {
    try {
      StartupActionScriptManager.executeActionScript();
    }
 catch (    IOException e) {
      Main.showMessage("Plugin Installation Error",e);
    }
  }
  Thread.currentThread().setContextClassLoader(newClassLoader);
  return newClassLoader;
}
