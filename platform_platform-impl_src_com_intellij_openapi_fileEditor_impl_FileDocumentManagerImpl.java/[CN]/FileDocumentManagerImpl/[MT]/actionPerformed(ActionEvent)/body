{
  final ProjectEx project=(ProjectEx)ProjectLocator.getInstance().guessProjectForFile(file);
  FileType fileType=file.getFileType();
  String fsContent=LoadTextUtil.loadText(file).toString();
  DocumentContent content1=DiffContentFactory.getInstance().create(fsContent,fileType);
  DocumentContent content2=DiffContentFactory.getInstance().create(project,document,file);
  String title=UIBundle.message("file.cache.conflict.for.file.dialog.title",file.getPresentableUrl());
  String title1=UIBundle.message("file.cache.conflict.diff.content.file.system.content");
  String title2=UIBundle.message("file.cache.conflict.diff.content.memory.content");
  DiffRequest request=new SimpleDiffRequest(title,content1,content2,title1,title2);
  request.putUserData(DiffUserDataKeys.GO_TO_SOURCE_DISABLE,true);
  DialogBuilder diffBuilder=new DialogBuilder(project);
  DiffRequestPanel diffPanel=DiffManager.getInstance().createRequestPanel(project,diffBuilder,diffBuilder.getWindow());
  diffPanel.setRequest(request);
  diffBuilder.setCenterPanel(diffPanel.getComponent());
  diffBuilder.setDimensionServiceKey("FileDocumentManager.FileCacheConflict");
  diffBuilder.addOkAction().setText(UIBundle.message("file.cache.conflict.save.changes.button"));
  diffBuilder.addCancelAction();
  diffBuilder.setTitle(title);
  if (diffBuilder.show() == DialogWrapper.OK_EXIT_CODE) {
    builder.getDialogWrapper().close(DialogWrapper.CANCEL_EXIT_CODE);
  }
}
