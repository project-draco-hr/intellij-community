{
  ApplicationManager.getApplication().assertIsDispatchThread();
  ((TransactionGuardImpl)TransactionGuard.getInstance()).assertWriteActionAllowed();
  myMultiCaster.beforeAllDocumentsSaving();
  if (myUnsavedDocuments.isEmpty())   return;
  final Map<Document,IOException> failedToSave=new HashMap<>();
  final Set<Document> vetoed=new HashSet<>();
  while (true) {
    int count=0;
    for (    Document document : myUnsavedDocuments) {
      if (failedToSave.containsKey(document))       continue;
      if (vetoed.contains(document))       continue;
      try {
        doSaveDocument(document,isExplicit);
      }
 catch (      IOException e) {
        failedToSave.put(document,e);
      }
catch (      SaveVetoException e) {
        vetoed.add(document);
      }
      count++;
    }
    if (count == 0)     break;
  }
  if (!failedToSave.isEmpty()) {
    handleErrorsOnSave(failedToSave);
  }
}
