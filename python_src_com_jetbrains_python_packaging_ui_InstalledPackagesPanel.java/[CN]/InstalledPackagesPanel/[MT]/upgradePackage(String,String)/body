{
  final Sdk selectedSdk=mySelectedSdk;
  final PackageManagementService selPackageManagementService=myPackageManagementService;
  myPackageManagementService.fetchPackageVersions(packageName,new CatchingConsumer<List<String>,Exception>(){
    @Override public void consume(    List<String> releases){
      if (!releases.isEmpty() && PyRequirement.VERSION_COMPARATOR.compare(currentVersion,releases.get(0)) >= 0)       return;
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          final PackageManagementService.Listener listener=new PackageManagementService.Listener(){
            @Override public void installationStarted(            String packageName){
              myPackagesTable.setPaintBusy(true);
              currentlyInstalling.add(packageName);
            }
            @Override public void installationFinished(            String packageName,            @Nullable String errorDescription){
              myPackagesTable.clearSelection();
              updatePackages(selectedSdk,selPackageManagementService);
              myPackagesTable.setPaintBusy(false);
              currentlyInstalling.remove(packageName);
              if (errorDescription == null) {
                myNotificationArea.showSuccess("Package " + packageName + " successfully upgraded");
              }
 else {
                myNotificationArea.showError("Upgrade packages failed. <a href=\"xxx\">Details...</a>","Upgrade Packages Failed","Upgrade packages failed.\n" + errorDescription);
              }
            }
          }
;
          myPackageManagementService.installPackage(new RepoPackage(packageName,null),null,true,null,listener,false);
          myUpgradeButton.setEnabled(false);
        }
      }
,ModalityState.any());
    }
    @Override public void consume(    Exception e){
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          Messages.showErrorDialog("Error occurred. Please, check your internet connection.","Upgrade Package Failed.");
        }
      }
,ModalityState.any());
    }
  }
);
}
