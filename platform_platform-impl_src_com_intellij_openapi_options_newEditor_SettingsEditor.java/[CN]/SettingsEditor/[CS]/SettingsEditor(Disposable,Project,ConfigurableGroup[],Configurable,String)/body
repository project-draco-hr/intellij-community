{
  super(parent);
  myProperties=PropertiesComponent.getInstance(project);
  mySettings=new Settings(groups){
    @Override protected ActionCallback selectImpl(    Configurable configurable){
      myFilter.update(null,false,true);
      return myTreeView.select(configurable);
    }
  }
;
  mySearch=new SettingsSearch(){
    @Override void onTextKeyEvent(    KeyEvent event){
      myTreeView.myTree.processKeyEvent(event);
    }
  }
;
  mySearchPanel=new JPanel(new VerticalLayout(0));
  mySearchPanel.add(VerticalLayout.CENTER,mySearch);
  myFilter=new SettingsFilter(project,groups,mySearch){
    @Override Configurable getConfigurable(    SimpleNode node){
      return SettingsTreeView.getConfigurable(node);
    }
    @Override SimpleNode findNode(    Configurable configurable){
      return myTreeView.findNode(configurable);
    }
    @Override void updateSpotlight(    boolean now){
      if (!myDisposed && mySpotlightPainter != null) {
        if (!now) {
          mySpotlightPainter.updateLater();
        }
 else {
          mySpotlightPainter.updateNow();
        }
      }
    }
  }
;
  myFilter.myContext.addColleague(new OptionsEditorColleague(){
    @Override public ActionCallback onSelected(    @Nullable Configurable configurable,    Configurable oldConfigurable){
      if (configurable != null) {
        myProperties.setValue(SELECTED_CONFIGURABLE,ConfigurableVisitor.ByID.getID(configurable));
        myLoadingDecorator.startLoading(false);
      }
      checkModified(oldConfigurable);
      ActionCallback result=myEditor.select(configurable);
      result.doWhenDone(new Runnable(){
        @Override public void run(){
          myLoadingDecorator.stopLoading();
        }
      }
);
      return result;
    }
    @Override public ActionCallback onModifiedAdded(    Configurable configurable){
      return updateIfCurrent(configurable);
    }
    @Override public ActionCallback onModifiedRemoved(    Configurable configurable){
      return updateIfCurrent(configurable);
    }
    @Override public ActionCallback onErrorsChanged(){
      return updateIfCurrent(myFilter.myContext.getCurrentConfigurable());
    }
    private ActionCallback updateIfCurrent(    Configurable configurable){
      if (configurable != null && configurable == myFilter.myContext.getCurrentConfigurable()) {
        updateStatus(configurable);
        return ActionCallback.DONE;
      }
 else {
        return ActionCallback.REJECTED;
      }
    }
  }
);
  myTreeView=new SettingsTreeView(myFilter,groups);
  myTreeView.myTree.addKeyListener(mySearch);
  myEditor=new ConfigurableEditor(this,null){
    @Override boolean apply(){
      checkModified(myFilter.myContext.getCurrentConfigurable());
      if (myFilter.myContext.getModified().isEmpty()) {
        return true;
      }
      Map<Configurable,ConfigurationException> map=new LinkedHashMap<Configurable,ConfigurationException>();
      for (      Configurable configurable : myFilter.myContext.getModified()) {
        ConfigurationException exception=ConfigurableEditor.apply(configurable);
        if (exception != null) {
          map.put(configurable,exception);
        }
 else         if (!configurable.isModified()) {
          myFilter.myContext.fireModifiedRemoved(configurable,null);
        }
      }
      myFilter.myContext.fireErrorsChanged(map,null);
      if (!map.isEmpty()) {
        myTreeView.select(map.keySet().iterator().next());
        return false;
      }
      updateStatus(myFilter.myContext.getCurrentConfigurable());
      return true;
    }
    @Override void updateCurrent(    Configurable configurable,    boolean reset){
      if (reset && configurable != null) {
        myFilter.myContext.fireReset(configurable);
      }
      checkModified(configurable);
    }
    @Override void openLink(    Configurable configurable){
      mySettings.select(configurable);
    }
  }
;
  myLoadingDecorator=new LoadingDecorator(myEditor,this,10,true);
  myBanner=new Banner(myEditor.getResetAction());
  mySearchPanel.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  JComponent left=myTreeView;
  JComponent right=myLoadingDecorator.getComponent();
  if (Registry.is("ide.settings.old.style")) {
    myBanner.setBorder(BorderFactory.createEmptyBorder(5,10,0,10));
    mySearch.setBackground(UIUtil.SIDE_PANEL_BACKGROUND);
    mySearchPanel.setBackground(UIUtil.SIDE_PANEL_BACKGROUND);
    mySearchPanel.addComponentListener(new ComponentAdapter(){
      @Override public void componentResized(      ComponentEvent event){
        Dimension size=myBanner.getPreferredSize();
        size.height=mySearchPanel.getHeight() - 5;
        myBanner.setPreferredSize(size);
        myBanner.setSize(size);
        myBanner.revalidate();
        myBanner.repaint();
      }
    }
);
    left=new JPanel(new BorderLayout());
    left.add(BorderLayout.NORTH,mySearchPanel);
    left.add(BorderLayout.CENTER,myTreeView);
    right=new JPanel(new BorderLayout());
    right.add(BorderLayout.NORTH,myBanner);
    right.add(BorderLayout.CENTER,myLoadingDecorator.getComponent());
  }
 else {
    myBanner.setBorder(BorderFactory.createEmptyBorder(5,10,5,10));
    myTreeView.addComponentListener(new ComponentAdapter(){
      @Override public void componentResized(      ComponentEvent event){
        Dimension size=mySearchPanel.getPreferredSize();
        size.width=myTreeView.getWidth();
        mySearchPanel.setPreferredSize(size);
        mySearchPanel.setSize(size);
        mySearchPanel.revalidate();
        mySearchPanel.repaint();
      }
    }
);
    JPanel panel=new JPanel(new BorderLayout());
    panel.add(BorderLayout.WEST,mySearchPanel);
    panel.add(BorderLayout.CENTER,myBanner);
    panel.setBorder(JBUI.Borders.customLine(OnePixelDivider.BACKGROUND,0,0,1,0));
    add(BorderLayout.NORTH,panel);
  }
  mySplitter=new OnePixelSplitter(false,myProperties.getFloat(SPLITTER_PROPORTION,.2f));
  mySplitter.setHonorComponentsMinimumSize(true);
  mySplitter.setFirstComponent(left);
  mySplitter.setSecondComponent(right);
  mySpotlightPainter=new SpotlightPainter(myEditor,this){
    void updateNow(){
      Configurable configurable=myFilter.myContext.getCurrentConfigurable();
      if (myTreeView.myTree.hasFocus() || mySearch.getTextEditor().hasFocus()) {
        update(myFilter,configurable,myEditor.getContent(configurable));
      }
    }
  }
;
  add(BorderLayout.CENTER,mySplitter);
  if (configurable == null) {
    String id=myProperties.getValue(SELECTED_CONFIGURABLE);
    configurable=new ConfigurableVisitor.ByID(id != null ? id : "preferences.lookFeel").find(groups);
    if (configurable == null) {
      configurable=ConfigurableVisitor.ALL.find(groups);
    }
  }
  myTreeView.select(configurable).doWhenDone(new Runnable(){
    @Override public void run(){
      myFilter.update(filter,false,true);
    }
  }
);
  Disposer.register(this,myTreeView);
  installSpotlightRemover();
}
