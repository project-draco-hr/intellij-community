{
  if (progress != null) {
    progress.setText("Extracting...");
  }
  SingleTopLevelFolderUnwrapper singleTopLevelFolderUnwrapper=null;
  File unzipToDir=extractToDir;
  if (unwrapSingleTopLevelFolder) {
    unzipToDir=FileUtil.createTempDirectory("unzip-dir-",null);
    singleTopLevelFolderUnwrapper=new SingleTopLevelFolderUnwrapper(unzipToDir);
  }
  ZipEntry entry;
  while ((entry=stream.getNextEntry()) != null) {
    File child=unzipEntryToDir(progress,entry,unzipToDir,stream,pathConvertor,contentProcessor);
    if (singleTopLevelFolderUnwrapper != null && child != null) {
      singleTopLevelFolderUnwrapper.onFileUnzipped(child);
    }
  }
  if (singleTopLevelFolderUnwrapper != null) {
    singleTopLevelFolderUnwrapper.unwrap(extractToDir);
  }
}
