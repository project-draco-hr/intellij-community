{
  Application application=ApplicationManager.getApplication();
  if (!application.isUnitTestMode()) {
    final InlineMethodDialog dialog=new InlineMethodDialog(project,method,invokedOnReference,checkMethodForRecursion(method));
    if (!dialog.showAndGet()) {
      WindowManager.getInstance().getStatusBar(project).setInfo(GroovyRefactoringBundle.message("press.escape.to.remove.the.highlighting"));
      return InlineHandler.Settings.CANNOT_INLINE_SETTINGS;
    }
 else {
      return new InlineHandler.Settings(){
        @Override public boolean isOnlyOneReferenceToInline(){
          return dialog.isInlineThisOnly();
        }
      }
;
    }
  }
  return new InlineHandler.Settings(){
    @Override public boolean isOnlyOneReferenceToInline(){
      return true;
    }
  }
;
}
