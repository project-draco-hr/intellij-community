{
  PsiJavaFile file=(PsiJavaFile)createLightFile("test.java",source);
  FileASTNode fileNode=file.getNode();
  assertNotNull(fileNode);
  assertFalse(fileNode.isParsed());
  StubElement lightTree=NEW_BUILDER.buildStubTree(file);
  assertFalse(fileNode.isParsed());
  file.getNode().getChildren(null);
  StubElement astBasedTree=NEW_BUILDER.buildStubTree(file);
  assertTrue(fileNode.isParsed());
  String lightStr=DebugUtil.stubTreeToString(lightTree);
  String lightStr2=DebugUtil.stubTreeToString(astBasedTree);
  if (expected != null) {
    assertEquals("light tree differs",expected,lightStr);
    assertEquals("AST-based tree differs",expected,lightStr2);
  }
}
