{
synchronized (filesToAdd) {
    filesToAdd.add(path);
  }
  if (async) {
    taskProcessor.add(new ThrowableRunnable<Exception>(){
      @Override public void run() throws Exception {
synchronized (filesToAdd) {
          if (!filesToAdd.contains(path)) {
            return;
          }
        }
        doWrite(path,content,size);
      }
    }
);
  }
 else {
    try {
      doWrite(path,content,size);
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
}
