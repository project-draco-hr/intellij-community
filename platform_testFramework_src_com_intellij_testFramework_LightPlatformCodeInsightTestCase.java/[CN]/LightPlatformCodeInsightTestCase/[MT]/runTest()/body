{
  if (isRunInWriteAction()) {
    WriteCommandAction.runWriteCommandAction(getProject(),new ThrowableComputable<Void,Throwable>(){
      @Override public Void compute() throws Throwable {
        doRunTest();
        return null;
      }
    }
);
  }
 else {
    new WriteCommandAction.Simple(getProject()){
      @Override protected void run() throws Throwable {
        doRunTest();
      }
    }
.performCommand();
  }
}
