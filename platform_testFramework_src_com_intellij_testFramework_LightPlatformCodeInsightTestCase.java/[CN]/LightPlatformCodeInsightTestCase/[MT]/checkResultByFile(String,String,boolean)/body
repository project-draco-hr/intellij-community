{
  bringRealEditorBack();
  getProject().getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  if (ignoreTrailingSpaces) {
    final Editor editor=myEditor;
    TrailingSpacesStripper.strip(editor.getDocument(),false,true);
    EditorUtil.fillVirtualSpaceUntilCaret(editor);
  }
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  String fullPath=getTestDataPath() + expectedFilePath;
  File ioFile=new File(fullPath);
  assertTrue(getMessage("Cannot find file " + fullPath,message),ioFile.exists());
  String fileText;
  try {
    fileText=FileUtil.loadFile(ioFile,CharsetToolkit.UTF8_CHARSET);
  }
 catch (  IOException e) {
    LOG.error(e);
    throw new RuntimeException(e);
  }
  checkResultByText(message,StringUtil.convertLineSeparators(fileText),ignoreTrailingSpaces,getTestDataPath() + "/" + expectedFilePath);
}
