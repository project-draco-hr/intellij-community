{
  if (myEditor != null) {
    final Ref<EditorWindow> editorWindowRef=new Ref<EditorWindow>();
    myEditor.getCaretModel().runForEachCaret(new CaretAction(){
      @Override public void perform(      Caret caret){
        Editor editor=InjectedLanguageUtil.getEditorForInjectedLanguageNoCommit(myEditor,myFile);
        if (caret == myEditor.getCaretModel().getPrimaryCaret() && editor instanceof EditorWindow) {
          editorWindowRef.set((EditorWindow)editor);
        }
      }
    }
);
    if (!editorWindowRef.isNull()) {
      myEditor=editorWindowRef.get();
      myFile=editorWindowRef.get().getInjectedFile();
    }
  }
}
