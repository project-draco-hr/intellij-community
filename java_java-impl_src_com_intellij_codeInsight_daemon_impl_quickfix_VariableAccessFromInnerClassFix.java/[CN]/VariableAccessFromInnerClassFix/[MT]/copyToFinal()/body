{
  PsiManager psiManager=myContext.getManager();
  final Project project=psiManager.getProject();
  PsiElementFactory factory=JavaPsiFacade.getInstance(project).getElementFactory();
  PsiExpression initializer=factory.createExpressionFromText(myVariable.getName(),myContext);
  String newName=suggestNewName(project,myVariable);
  PsiType type=myVariable.getType();
  PsiDeclarationStatement copyDecl=factory.createVariableDeclarationStatement(newName,type,initializer);
  PsiVariable newVariable=(PsiVariable)copyDecl.getDeclaredElements()[0];
  final boolean mustBeFinal=!PsiUtil.isLanguageLevel8OrHigher(myContext) || CodeStyleSettingsManager.getSettings(project).GENERATE_FINAL_LOCALS;
  PsiUtil.setModifierProperty(newVariable,PsiModifier.FINAL,mustBeFinal);
  PsiElement statement=getStatementToInsertBefore();
  if (statement == null)   return;
  PsiExpression newExpression=factory.createExpressionFromText(newName,myVariable);
  replaceReferences(myContext,myVariable,newExpression);
  if (RefactoringUtil.isLoopOrIf(statement.getParent())) {
    RefactoringUtil.putStatementInLoopBody(copyDecl,statement.getParent(),statement);
  }
 else {
    statement.getParent().addBefore(copyDecl,statement);
  }
}
