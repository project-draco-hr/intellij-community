{
  PsiElement outerCodeBlock=PsiUtil.getVariableCodeBlock(variable,null);
  if (outerCodeBlock == null)   return -1;
  List<PsiReferenceExpression> outerReferences=new ArrayList<PsiReferenceExpression>();
  collectReferences(outerCodeBlock,variable,outerReferences);
  int type=MAKE_FINAL;
  for (  PsiReferenceExpression expression : outerReferences) {
    PsiElement innerScope=HighlightControlFlowUtil.getInnerClassVariableReferencedFrom(variable,expression);
    if (innerScope != null) {
      int thisType=MAKE_FINAL;
      if (writtenInside(variable,innerScope)) {
        if (variable instanceof PsiParameter)         return -1;
        thisType=MAKE_ARRAY;
      }
      if (thisType == MAKE_FINAL && !canBeFinal(variable,outerReferences)) {
        thisType=COPY_TO_FINAL;
      }
      type=Math.max(type,thisType);
    }
  }
  return type;
}
