{
  final PackageManagementServiceEx serviceEx=getServiceEx();
  if (serviceEx == null) {
    return;
  }
  final AtomicInteger restPackageCount=new AtomicInteger(0);
  for (int i=0; i < myPackagesTableModel.getRowCount(); ++i) {
    final int finalIndex=i;
    final InstalledPackage pkg=getInstalledPackageAt(finalIndex);
    restPackageCount.incrementAndGet();
    serviceEx.fetchLatestVersion(pkg.getName(),new CatchingConsumer<String,Exception>(){
      private void decrement(){
        if (restPackageCount.decrementAndGet() == 0) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            @Override public void run(){
              myPackagesTable.setPaintBusy(false);
            }
          }
,ModalityState.any());
        }
      }
      @Override public void consume(      Exception e){
        decrement();
      }
      @Override public void consume(      @Nullable final String latestVersion){
        if (latestVersion == null) {
          decrement();
          return;
        }
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            if (finalIndex < myPackagesTableModel.getRowCount()) {
              InstalledPackage p=getInstalledPackageAt(finalIndex);
              if (pkg == p) {
                myPackagesTableModel.setValueAt(latestVersion,finalIndex,2);
              }
            }
            decrement();
          }
        }
,ModalityState.any());
      }
    }
);
  }
}
