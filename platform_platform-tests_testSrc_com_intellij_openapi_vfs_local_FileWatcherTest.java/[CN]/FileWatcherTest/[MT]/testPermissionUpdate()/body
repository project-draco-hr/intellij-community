{
  File file=createTestFile(myTempDirectory,"test.txt","some content");
  VirtualFile vFile=refresh(file);
  assertTrue(vFile.isWritable());
  boolean win=SystemInfo.isWindows;
  LocalFileSystem.WatchRequest request=watch(file);
  try {
    myAccept=true;
    PlatformTestUtil.assertSuccessful(new GeneralCommandLine(win ? "attrib" : "chmod",win ? "+R" : "500",file.getPath()));
    assertEvent(VFilePropertyChangeEvent.class,file.getPath());
    assertFalse(vFile.isWritable());
    myAccept=true;
    PlatformTestUtil.assertSuccessful(new GeneralCommandLine(win ? "attrib" : "chmod",win ? "-R" : "700",file.getPath()));
    assertEvent(VFilePropertyChangeEvent.class,file.getPath());
    assertTrue(vFile.isWritable());
  }
  finally {
    unwatch(request);
    delete(file);
  }
}
