{
  createReadChangesCache();
  final Collection<Change> result=new ArrayList<Change>();
  myChangesBeforeUpdate=new OpenTHashSet<Change>(myChanges);
  final ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(project);
  for (  Change oldBoy : myChangesBeforeUpdate) {
    final ContentRevision before=oldBoy.getBeforeRevision();
    final ContentRevision after=oldBoy.getAfterRevision();
    if (scope == null || before != null && scope.belongsTo(before.getFile()) || after != null && scope.belongsTo(after.getFile()) || isIgnoredChange(oldBoy,vcsManager)) {
      result.add(oldBoy);
      myChanges.remove(oldBoy);
      myReadChangesCache=null;
    }
  }
  return result;
}
