{
  T service=(T)myServices.get(serviceClass);
  if (service == null) {
    final Iterator<T> iterator=ServiceLoader.load(serviceClass,serviceClass.getClassLoader()).iterator();
    if (!iterator.hasNext()) {
      throw new ServiceConfigurationError("Implementation for " + serviceClass + " not found");
    }
    final T loadedService=iterator.next();
    if (iterator.hasNext()) {
      throw new ServiceConfigurationError("More than one implementation for " + serviceClass + " found: "+ loadedService.getClass()+ " and "+ iterator.next().getClass());
    }
    service=(T)myServices.putIfAbsent(serviceClass,loadedService);
    if (service == null) {
      service=loadedService;
    }
  }
  return service;
}
