{
  final ModuleFileIndex idx=ModuleRootManager.getInstance(module).getFileIndex();
  final VirtualFile[] roots=ModuleRootManager.getInstance(module).getContentRoots();
  for (  final VirtualFile root : roots) {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        idx.iterateContentUnderDirectory(root,new ContentIterator(){
          @Override public boolean processFile(          final VirtualFile dir){
            if (dir.isDirectory()) {
              final PsiDirectory psiDir=PsiManager.getInstance(module.getProject()).findDirectory(dir);
              if (psiDir != null) {
                findFiles(files,psiDir,false);
              }
            }
            return true;
          }
        }
);
      }
    }
);
  }
}
