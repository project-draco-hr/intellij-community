{
  String mode=null;
  String out=null;
  if (args.length >= 3) {
    if (ARG.equals(args[0]))     mode=ARG;
    if (ENV.equals(args[0]))     mode=ENV;
    if (OUT.equals(args[1]))     out=args[2];
  }
  if (mode == null || out == null) {
    System.out.println("usage: " + CommandTestHelper.class.getSimpleName() + " -arg|-env -out file [args...]");
    System.exit(1);
  }
  OutputStreamWriter writer=new OutputStreamWriter(new FileOutputStream(out),ENC);
  try {
    if (mode == ENV) {
      for (      Map.Entry<String,String> entry : System.getenv().entrySet()) {
        writer.write(format(entry));
        writer.write('\n');
      }
    }
 else {
      for (int i=3; i < args.length; i++) {
        writer.write(args[i]);
        writer.write('\n');
      }
    }
  }
  finally {
    writer.close();
  }
}
