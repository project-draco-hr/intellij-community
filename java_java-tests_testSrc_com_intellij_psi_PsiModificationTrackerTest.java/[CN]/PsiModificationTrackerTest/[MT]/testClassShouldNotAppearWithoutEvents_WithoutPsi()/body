{
  final GlobalSearchScope allScope=GlobalSearchScope.allScope(getProject());
  final JavaPsiFacade facade=JavaPsiFacade.getInstance(getProject());
  final PsiManager psiManager=PsiManager.getInstance(getProject());
  final PsiModificationTracker tracker=psiManager.getModificationTracker();
  final VirtualFile file=myFixture.getTempDirFixture().createFile("Foo.java","");
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  assertNotNull(document);
  assertNull(facade.findClass("Foo",allScope));
  long count1=tracker.getJavaStructureModificationCount();
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  assertNull(PsiDocumentManager.getInstance(getProject()).getCachedPsiFile(document));
  document.insertString(0,"class Foo {}");
  assertFalse(count1 == tracker.getJavaStructureModificationCount());
  assertTrue(PsiDocumentManager.getInstance(getProject()).isCommitted(document));
  assertNotNull(facade.findClass("Foo",allScope));
  PsiJavaFile psiFile=(PsiJavaFile)psiManager.findFile(file);
  assertSize(1,psiFile.getClasses());
  assertEquals("class Foo {}",psiFile.getText());
  assertEquals("class Foo {}",psiFile.getNode().getText());
}
