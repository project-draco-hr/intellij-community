{
  PsiModificationTracker tracker=PsiManager.getInstance(getProject()).getModificationTracker();
  long count0=tracker.getJavaStructureModificationCount();
  final VirtualFile file=myFixture.addFileToProject("Foo.java","class Foo {}").getVirtualFile();
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  assertNotNull(document);
  assertNotNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
  long count1=tracker.getJavaStructureModificationCount();
  assertFalse(count1 == count0);
  document.deleteString(0,document.getTextLength());
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  final PsiManagerEx psiManager=(PsiManagerEx)PsiManager.getInstance(getProject());
  assertNull(psiManager.getFileManager().getCachedPsiFile(file));
  assertEquals(count1,tracker.getJavaStructureModificationCount());
  assertNotNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
  assertSize(1,((PsiJavaFile)psiManager.findFile(file)).getClasses());
  assertEquals("class Foo {}",psiManager.findFile(file).getText());
  PlatformTestUtil.tryGcSoftlyReachableObjects();
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  assertFalse(count1 == tracker.getJavaStructureModificationCount());
  assertNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
}
