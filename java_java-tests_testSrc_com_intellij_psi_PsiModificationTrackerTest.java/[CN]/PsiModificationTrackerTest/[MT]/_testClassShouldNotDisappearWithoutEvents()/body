{
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      PsiModificationTracker tracker=PsiManager.getInstance(getProject()).getModificationTracker();
      long count0=tracker.getJavaStructureModificationCount();
      VirtualFile file=myFixture.addFileToProject("Foo.java","class Foo {}").getVirtualFile();
      final Document document=FileDocumentManager.getInstance().getDocument(file);
      assertNotNull(document);
      assertNotNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
      long count1=tracker.getJavaStructureModificationCount();
      assertFalse(count1 == count0);
      document.deleteString(0,document.getTextLength());
      PlatformTestUtil.tryGcSoftlyReachableObjects();
      assertNull(((PsiManagerEx)PsiManager.getInstance(getProject())).getFileManager().getCachedPsiFile(file));
      assertEquals(count1,tracker.getJavaStructureModificationCount());
      assertNotNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
      PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
      assertFalse(count1 == tracker.getJavaStructureModificationCount());
      assertNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
    }
  }
.execute();
}
