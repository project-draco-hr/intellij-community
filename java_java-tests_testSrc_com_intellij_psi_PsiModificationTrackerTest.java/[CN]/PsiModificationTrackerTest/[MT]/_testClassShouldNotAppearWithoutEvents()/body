{
  VirtualFile file=myFixture.getTempDirFixture().createFile("Foo.java","");
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  assertNotNull(document);
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      assertNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
      PsiModificationTracker tracker=PsiManager.getInstance(getProject()).getModificationTracker();
      long count1=tracker.getJavaStructureModificationCount();
      document.insertString(0,"class Foo {}");
      assertEquals(count1,tracker.getJavaStructureModificationCount());
      assertNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
      PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
      assertFalse(count1 == tracker.getJavaStructureModificationCount());
      assertNotNull(JavaPsiFacade.getInstance(getProject()).findClass("Foo",GlobalSearchScope.allScope(getProject())));
    }
  }
.execute();
}
