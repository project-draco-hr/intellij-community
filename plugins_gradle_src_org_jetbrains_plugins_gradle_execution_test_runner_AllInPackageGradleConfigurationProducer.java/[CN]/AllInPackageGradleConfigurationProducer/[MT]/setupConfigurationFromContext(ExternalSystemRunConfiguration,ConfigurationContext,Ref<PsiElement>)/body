{
  final PsiPackage psiPackage=JavaRuntimeConfigurationProducerBase.checkPackage(context.getPsiLocation());
  if (psiPackage == null)   return false;
  sourceElement.set(psiPackage);
  final Module module=context.getModule();
  if (module == null)   return false;
  if (!StringUtil.equals(module.getOptionValue(ExternalSystemConstants.EXTERNAL_SYSTEM_ID),GradleConstants.SYSTEM_ID.toString())) {
    return false;
  }
  final String linkedGradleProject=module.getOptionValue(ExternalSystemConstants.LINKED_PROJECT_PATH);
  if (linkedGradleProject == null)   return false;
  configuration.getSettings().setExternalProjectPath(linkedGradleProject);
  configuration.getSettings().setTaskNames(TASKS_TO_RUN);
  if (psiPackage.getQualifiedName().isEmpty()) {
    configuration.getSettings().setScriptParameters("--tests *");
  }
 else {
    configuration.getSettings().setScriptParameters(String.format("--tests %s.*",psiPackage.getQualifiedName()));
  }
  configuration.setName(suggestName(psiPackage,module));
  return true;
}
