{
  final StringBuilder originalString=new StringBuilder();
  int lastBarOffset=-1;
  final List<Integer> barOffsets=new ArrayList<>();
  while (true) {
    final int nextOffset=fstringLiteral.indexOf("|",lastBarOffset + 1);
    if (nextOffset < 0) {
      originalString.append(fstringLiteral.substring(lastBarOffset + 1));
      break;
    }
    originalString.append(fstringLiteral.substring(lastBarOffset + 1,nextOffset));
    lastBarOffset=nextOffset;
    barOffsets.add(lastBarOffset - barOffsets.size());
  }
  assertTrue("Odd number of markers",barOffsets.size() % 2 == 0);
  final List<TextRange> actualRanges=PyFStringsInjector.getInjectionRanges(originalString.toString());
  final List<TextRange> expectedRanges=new ArrayList<>();
  for (int i=0; i < barOffsets.size(); i+=2) {
    expectedRanges.add(TextRange.create(barOffsets.get(i),barOffsets.get(i + 1)));
  }
  assertSameElements(actualRanges,expectedRanges);
}
