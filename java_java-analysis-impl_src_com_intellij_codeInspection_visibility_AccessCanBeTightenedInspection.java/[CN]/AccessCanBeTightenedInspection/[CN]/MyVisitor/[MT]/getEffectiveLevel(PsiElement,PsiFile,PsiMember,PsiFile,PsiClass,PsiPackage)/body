{
  PsiClass innerClass=PsiTreeUtil.getParentOfType(element,PsiClass.class);
  boolean isAbstractMember=member.hasModifierProperty(PsiModifier.ABSTRACT);
  if (memberClass != null && PsiTreeUtil.isAncestor(innerClass,memberClass,false) || innerClass != null && PsiTreeUtil.isAncestor(memberClass,innerClass,false) && !innerClass.hasModifierProperty(PsiModifier.STATIC)) {
    if (isInReferenceList(innerClass.getModifierList(),member) || isInReferenceList(innerClass.getImplementsList(),member) || isInReferenceList(innerClass.getExtendsList(),member)) {
      return suggestPackageLocal(member);
    }
    return !isAbstractMember && (myVisibilityInspection.SUGGEST_PRIVATE_FOR_INNERS || !isInnerClass(memberClass)) ? PsiUtil.ACCESS_LEVEL_PRIVATE : suggestPackageLocal(member);
  }
  PsiDirectory directory=file.getContainingDirectory();
  PsiPackage aPackage=directory == null ? null : JavaDirectoryService.getInstance().getPackage(directory);
  if (aPackage == memberPackage || aPackage != null && memberPackage != null && Comparing.strEqual(aPackage.getQualifiedName(),memberPackage.getQualifiedName())) {
    return suggestPackageLocal(element);
  }
  if (innerClass != null && memberClass != null && innerClass.isInheritor(memberClass,true)) {
    PsiElement resolved=element instanceof PsiReference ? ((PsiReference)element).resolve() : null;
    boolean isConstructor=resolved instanceof PsiClass && element.getParent() instanceof PsiNewExpression || resolved instanceof PsiMethod && ((PsiMethod)resolved).isConstructor();
    if (!isConstructor) {
      return PsiUtil.ACCESS_LEVEL_PROTECTED;
    }
  }
  return PsiUtil.ACCESS_LEVEL_PUBLIC;
}
