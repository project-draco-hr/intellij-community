{
  final ModifiableRootModel model=ApplicationManager.getApplication().runReadAction(new Computable<ModifiableRootModel>(){
    @Override public ModifiableRootModel compute(){
      return ModuleRootManager.getInstance(module).getModifiableModel();
    }
  }
);
  try {
    task.consume(model);
    doWriteAction(new Runnable(){
      @Override public void run(){
        model.commit();
      }
    }
);
  }
 catch (  RuntimeException e) {
    model.dispose();
    throw e;
  }
catch (  Error e) {
    model.dispose();
    throw e;
  }
}
