{
  List pParents=new ArrayList(3);
  pParents.addAll(currentParents);
  if (parent != null) {
    final String parentClassName=JUnit4ReflectionUtil.getClassName(parent);
    if (!myRootName.equals(parentClassName)) {
      pParents.add(0,parent);
    }
  }
  String className=JUnit4ReflectionUtil.getClassName(description);
  if (description.getChildren().isEmpty()) {
    final String methodName=getFullMethodName((Description)description,parent);
    if (methodName != null && parent != null) {
      List parents=(List)myParents.get(description);
      if (parents == null) {
        parents=new ArrayList(1);
        myParents.put(description,parents);
      }
      parents.add(pParents);
      if (isWarning(methodName,className)) {
        className=JUnit4ReflectionUtil.getClassName(parent);
      }
      myPrintStream.println("##teamcity[suiteTreeNode name=\'" + escapeName(methodName) + "\' "+ getTestMethodLocation(methodName,className)+ "]");
    }
    return;
  }
  List tests=description.getChildren();
  boolean pass=false;
  for (Iterator iterator=tests.iterator(); iterator.hasNext(); ) {
    final Object next=iterator.next();
    final Description nextDescription=(Description)next;
    if ((myRootName == null || !myRootName.equals(className)) && !pass) {
      pass=true;
      String locationHint=className;
      if (isParameter((Description)description)) {
        final String displayName=nextDescription.getDisplayName();
        final int paramIdx=displayName.indexOf(locationHint);
        if (paramIdx > -1) {
          locationHint=displayName.substring(paramIdx + locationHint.length());
          if (locationHint.startsWith("(") && locationHint.endsWith(")")) {
            locationHint=locationHint.substring(1,locationHint.length() - 1) + "." + className;
          }
        }
      }
      myPrintStream.println("##teamcity[suiteTreeStarted name=\'" + escapeName(getShortName(className)) + "\' locationHint=\'java:suite://"+ escapeName(locationHint)+ "\']");
    }
    sendTree(nextDescription,description,pParents);
  }
  if (pass) {
    myPrintStream.println("##teamcity[suiteTreeEnded name=\'" + escapeName(getShortName(JUnit4ReflectionUtil.getClassName((Description)description))) + "\']");
  }
}
