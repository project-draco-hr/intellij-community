{
  final Map attrs=new HashMap();
  attrs.put("name",methodName);
  final long duration=currentTime() - myCurrentTestStart;
  if (duration > 0) {
    attrs.put("duration",Long.toString(duration));
  }
  try {
    final String trace=getTrace(failure);
    final Throwable ex=failure.getException();
    final ComparisonFailureData notification=createExceptionNotification(ex);
    ComparisonFailureData.registerSMAttributes(notification,trace,failure.getMessage(),attrs,ex);
  }
 catch (  Throwable e) {
    final StringWriter stringWriter=new StringWriter();
    final PrintWriter writer=new PrintWriter(stringWriter);
    e.printStackTrace(writer);
    ComparisonFailureData.registerSMAttributes(null,stringWriter.toString(),e.getMessage(),attrs,e);
  }
 finally {
    myPrintStream.println("\n" + MapSerializerUtil.asString(messageName,attrs));
  }
}
