{
  try {
    Disposer.dispose(myTestRootDisposable);
    cleanupSwingDataStructures();
    cleanupDeleteOnExitHookList();
  }
  finally {
    if (shouldContainTempFiles()) {
      FileUtil.resetCanonicalTempPathCache(ORIGINAL_TEMP_DIR);
      if (hasTmpFilesToKeep()) {
        File[] files=new File(myTempDir).listFiles();
        if (files != null && files.length > 0) {
          for (          File file : files) {
            if (!shouldKeepTmpFile(file)) {
              FileUtil.delete(file);
            }
          }
        }
 else {
          FileUtil.delete(new File(myTempDir));
        }
      }
 else {
        FileUtil.delete(new File(myTempDir));
      }
    }
  }
  UIUtil.removeLeakingAppleListeners();
  super.tearDown();
}
