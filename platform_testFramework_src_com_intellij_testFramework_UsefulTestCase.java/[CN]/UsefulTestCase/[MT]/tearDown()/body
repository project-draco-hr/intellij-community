{
  try {
    Disposer.dispose(myTestRootDisposable);
    cleanupSwingDataStructures();
    ProjectManagerEx instance=ProjectManagerEx.getInstanceEx();
    if (instance != null) {
      Project[] projects=instance.getOpenProjects();
      if (projects.length > 0) {
        for (        Project project : projects) {
          instance.closeAndDispose(project);
        }
        fail("project leak? " + Arrays.asList(projects));
      }
    }
  }
  finally {
    if (shouldContainTempFiles()) {
      FileUtil.resetCanonicalTempPathCache(ORIGINAL_TEMP_DIR);
      FileUtil.delete(new File(myTempDir));
    }
  }
  UIUtil.removeLeakingAppleListeners();
  super.tearDown();
}
