{
  final Sdk configuredJdk=ProjectJdkTable.getInstance().findJdk(jreHome);
  if (configuredJdk != null) {
    return configuredJdk;
  }
  if (!JdkUtil.checkForJre(jreHome) && !JdkUtil.checkForJdk(jreHome)) {
    throw new CantRunException(ExecutionBundle.message("jre.path.is.not.valid.jre.home.error.message",jreHome));
  }
  final JavaSdk javaSdk=JavaSdk.getInstance();
  final String versionString=javaSdk.getVersionString(jreHome);
  final Sdk jdk=javaSdk.createJdk(versionString != null ? versionString : "",jreHome);
  if (jdk == null)   throw CantRunException.noJdkConfigured();
  return jdk;
}
