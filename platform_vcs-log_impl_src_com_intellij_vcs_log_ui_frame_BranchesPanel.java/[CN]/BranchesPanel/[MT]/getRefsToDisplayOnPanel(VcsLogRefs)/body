{
  Collection<VcsRef> allRefs=refsModel.getBranches();
  LinkedHashMap<VirtualFile,List<RefGroup>> groups=ContainerUtil.newLinkedHashMap();
  for (  Map.Entry<VirtualFile,Collection<VcsRef>> entry : VcsLogUtil.groupRefsByRoot(allRefs).entrySet()) {
    VirtualFile root=entry.getKey();
    List<RefGroup> list=ContainerUtil.newArrayList();
    list.addAll(expandExpandableGroups(myDataHolder.getLogProvider(root).getReferenceManager().group(entry.getValue())));
    groups.put(root,list);
  }
  return groups;
}
