{
  final SelectionModel model=myEditor.getSelectionModel();
  if (model.hasSelection()) {
    try {
      apply(getSettings());
    }
 catch (    ConfigurationException e) {
      LOG.debug("Cannot apply code style settings",e);
    }
    CodeStyleSettings clone=getSettings().clone();
    Project project=myEditor.getProject();
    if (project == null)     return;
    try {
      CodeStyleSettingsManager.getInstance(project).setTemporarySettings(clone);
      reformatSelectedFragment(model,myFile);
    }
  finally {
      CodeStyleSettingsManager.getInstance(project).dropTemporarySettings();
    }
  }
}
