{
  if (!shouldRunTest()) {
    return;
  }
  TestRunnerUtil.replaceIdeEventQueueSafely();
  EdtTestUtil.runInEdtAndWait(new ThrowableRunnable<Throwable>(){
    @Override public void run() throws Throwable {
      try {
        ourTestThread=Thread.currentThread();
        startRunAndTear();
      }
  finally {
        ourTestThread=null;
        try {
          Application application=ApplicationManager.getApplication();
          if (application instanceof ApplicationEx) {
            PlatformTestCase.cleanupApplicationCaches(ourProject);
          }
          resetAllFields();
        }
 catch (        Throwable e) {
          e.printStackTrace();
        }
      }
    }
  }
);
  SwingUtilities.invokeAndWait(EmptyRunnable.getInstance());
  if (IdeaLogger.ourErrorsOccurred != null) {
    throw IdeaLogger.ourErrorsOccurred;
  }
}
