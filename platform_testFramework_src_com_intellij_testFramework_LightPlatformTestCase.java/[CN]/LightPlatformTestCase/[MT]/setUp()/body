{
  EdtTestUtil.runInEdtAndWait(new ThrowableRunnable<Throwable>(){
    @Override public void run() throws Exception {
      LightPlatformTestCase.super.setUp();
      initApplication();
      ApplicationInfoImpl.setInPerformanceTest(isPerformanceTest());
      ourApplication.setDataProvider(LightPlatformTestCase.this);
      LightProjectDescriptor descriptor=new SimpleLightProjectDescriptor(getModuleType(),getProjectJDK());
      doSetup(descriptor,configureLocalInspectionTools(),getTestRootDisposable());
      InjectedLanguageManagerImpl.pushInjectors(getProject());
      storeSettings();
      myThreadTracker=new ThreadTracker();
      ModuleRootManager.getInstance(ourModule).orderEntries().getAllLibrariesAndSdkClassesRoots();
      VirtualFilePointerManagerImpl filePointerManager=(VirtualFilePointerManagerImpl)VirtualFilePointerManager.getInstance();
      filePointerManager.storePointers();
    }
  }
);
}
