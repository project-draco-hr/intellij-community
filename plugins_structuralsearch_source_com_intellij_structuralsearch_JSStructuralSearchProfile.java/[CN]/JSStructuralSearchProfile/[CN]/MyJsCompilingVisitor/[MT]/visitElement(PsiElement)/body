{
  doVisitElement(element);
  if (myGlobalVisitor.getContext().getSearchHelper().doOptimizing()) {
    if (element instanceof LeafElement && ((LeafElement)element).getElementType() == JSTokenTypes.IDENTIFIER) {
      OptimizingSearchHelper helper=myGlobalVisitor.getContext().getSearchHelper();
      boolean added=helper.addWordToSearchInText(element.getText());
      added=helper.addWordToSearchInCode(element.getText()) || added;
      if (added) {
        helper.endTransaction();
      }
    }
  }
  if (element instanceof JSExpressionStatement) {
    if (visitJsReferenceExpression((JSExpressionStatement)element)) {
      return;
    }
  }
 else   if (element instanceof JSAttributeList) {
    if (visitJsAttributeList((JSAttributeList)element)) {
      return;
    }
  }
  if (element instanceof JSLiteralExpression) {
    visitJsLiteralExpression((JSLiteralExpression)element);
  }
 else   if (element instanceof JSStatement) {
    CompiledPattern pattern=myGlobalVisitor.getContext().getPattern();
    MatchingHandler handler=pattern.getHandler(element);
    if (handler.getFilter() == null) {
      handler.setFilter(new NodeFilter(){
        public boolean accepts(        PsiElement e){
          if (e instanceof JSBlockStatement) {
            e=extractOnlyStatement((JSBlockStatement)e);
          }
          return DefaultFilter.accepts(element instanceof JSBlockStatement ? extractOnlyStatement((JSBlockStatement)element) : element,e);
        }
      }
);
    }
  }
}
