{
  if (!ENABLED) {
    return null;
  }
  if (!context.maySwitchToAST(expr)) {
    return null;
  }
  final Set<String> seenAttrs;
  seenAttrs=collectUsedAttributes(expr);
  final Set<PyClass> candidates=Sets.newHashSet();
  for (  String attribute : seenAttrs) {
    candidates.addAll(PyClassAttributesIndex.find(attribute,expr.getProject()));
  }
  final Set<PyClass> suitableClasses=Sets.newHashSet();
  for (  PyClass candidate : candidates) {
    if (PyUserSkeletonsUtil.isUnderUserSkeletonsDirectory(candidate.getContainingFile())) {
      continue;
    }
    final Set<String> availableAttrs=Sets.newHashSet(getAllDeclaredAttributeNames(candidate));
    for (    PyClass parent : candidate.getAncestorClasses(context)) {
      availableAttrs.addAll(getAllDeclaredAttributeNames(parent));
    }
    if (availableAttrs.containsAll(seenAttrs)) {
      suitableClasses.add(candidate);
    }
  }
  for (  PyClass candidate : Lists.newArrayList(suitableClasses)) {
    for (    PyClass ancestor : candidate.getAncestorClasses()) {
      if (suitableClasses.contains(ancestor)) {
        suitableClasses.remove(candidate);
      }
    }
  }
  final List<PyClass> orderedWinners=ContainerUtil.sorted(suitableClasses,new Comparator<PyClass>(){
    @Override public int compare(    PyClass o1,    PyClass o2){
      return StringUtil.compare(o1.getName(),o2.getName(),true);
    }
  }
);
  return PyUnionType.createWeakType(PyUnionType.union(ContainerUtil.map(orderedWinners,new Function<PyClass,PyType>(){
    @Override public PyType fun(    PyClass cls){
      return new PyClassTypeImpl(cls,false);
    }
  }
)));
}
