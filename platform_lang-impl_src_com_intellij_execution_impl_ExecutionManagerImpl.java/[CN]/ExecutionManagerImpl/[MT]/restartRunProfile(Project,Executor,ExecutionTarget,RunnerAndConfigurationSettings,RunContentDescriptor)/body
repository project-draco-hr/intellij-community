{
  if (configuration != null && ProgramRunnerUtil.getRunner(executor.getId(),configuration) == null) {
    LOG.error("Cannot find runner for " + configuration.getName());
    return;
  }
  if (configuration == null && (currentDescriptor == null || currentDescriptor.getRestarter() == null)) {
    LOG.error("Nothing to restart for descriptor [" + currentDescriptor + "]");
    return;
  }
  final List<RunContentDescriptor> descriptorsToStop=new ArrayList<RunContentDescriptor>();
  if (configuration != null && configuration.isSingleton()) {
    descriptorsToStop.addAll(getRunningDescriptors(configuration));
  }
 else   if (currentDescriptor != null) {
    descriptorsToStop.add(currentDescriptor);
  }
  if (!descriptorsToStop.isEmpty()) {
    if (configuration != null && (descriptorsToStop.size() > 1 || currentDescriptor == null || descriptorsToStop.get(0) != currentDescriptor) && !userApprovesStop(project,configuration.getName(),descriptorsToStop.size())) {
      return;
    }
    for (    RunContentDescriptor descriptor : descriptorsToStop) {
      stop(descriptor);
    }
  }
  Runnable runnable=new Runnable(){
    @Override public void run(){
      ProgramRunner runner=ProgramRunnerUtil.getRunner(executor.getId(),configuration);
      if (runner != null && ExecutorRegistry.getInstance().isStarting(project,executor.getId(),runner.getRunnerId())) {
        awaitingTerminationAlarm.addRequest(this,100);
        return;
      }
      for (      RunContentDescriptor descriptor : descriptorsToStop) {
        ProcessHandler processHandler=descriptor.getProcessHandler();
        if (processHandler != null && !processHandler.isProcessTerminated()) {
          awaitingTerminationAlarm.addRequest(this,100);
          return;
        }
      }
      start(project,configuration,executor,target,currentDescriptor);
    }
  }
;
  awaitingTerminationAlarm.addRequest(runnable,50);
}
