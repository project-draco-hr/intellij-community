{
  super(session);
  myJavaSession=javaSession;
  myEditorsProvider=new JavaDebuggerEditorsProvider();
  final DebugProcessImpl process=javaSession.getProcess();
  List<XBreakpointHandler> handlers=new ArrayList<XBreakpointHandler>();
  handlers.add(new JavaBreakpointHandler.JavaLineBreakpointHandler(process));
  handlers.add(new JavaBreakpointHandler.JavaExceptionBreakpointHandler(process));
  handlers.add(new JavaBreakpointHandler.JavaFieldBreakpointHandler(process));
  handlers.add(new JavaBreakpointHandler.JavaMethodBreakpointHandler(process));
  handlers.add(new JavaBreakpointHandler.JavaWildcardBreakpointHandler(process));
  for (  JavaBreakpointHandlerFactory factory : Extensions.getExtensions(JavaBreakpointHandlerFactory.EP_NAME)) {
    handlers.add(factory.createHandler(process));
  }
  myBreakpointHandlers=handlers.toArray(new XBreakpointHandler[handlers.size()]);
  myJavaSession.getContextManager().addListener(new DebuggerContextListener(){
    @Override public void changeEvent(    final DebuggerContextImpl newContext,    int event){
      if (event == DebuggerSession.EVENT_PAUSE || event == DebuggerSession.EVENT_CONTEXT || event == DebuggerSession.EVENT_REFRESH && myJavaSession.isPaused()) {
        if (getSession().getSuspendContext() != newContext.getSuspendContext()) {
          process.getManagerThread().schedule(new DebuggerContextCommandImpl(newContext){
            @Override public void threadAction(){
              SuspendContextImpl context=newContext.getSuspendContext();
              if (context != null) {
                context.initExecutionStacks(newContext.getThreadProxy());
                List<Pair<Breakpoint,Event>> descriptors=DebuggerUtilsEx.getEventDescriptors(context);
                if (!descriptors.isEmpty()) {
                  Breakpoint breakpoint=descriptors.get(0).getFirst();
                  XBreakpoint xBreakpoint=breakpoint.getXBreakpoint();
                  if (xBreakpoint != null) {
                    ((XDebugSessionImpl)getSession()).breakpointReachedNoProcessing(xBreakpoint,context);
                    return;
                  }
                }
                getSession().positionReached(context);
              }
            }
          }
);
        }
      }
    }
  }
);
  myNodeManager=new NodeManagerImpl(session.getProject(),null){
    @Override public DebuggerTreeNodeImpl createNode(    final NodeDescriptor descriptor,    EvaluationContext evaluationContext){
      final DebuggerTreeNodeImpl node=new DebuggerTreeNodeImpl(null,descriptor);
      return node;
    }
    @Override public DebuggerTreeNodeImpl createMessageNode(    MessageDescriptor descriptor){
      return new DebuggerTreeNodeImpl(null,descriptor);
    }
    @Override public DebuggerTreeNodeImpl createMessageNode(    String message){
      return new DebuggerTreeNodeImpl(null,new MessageDescriptor(message));
    }
  }
;
  session.addSessionListener(new XDebugSessionAdapter(){
    @Override public void sessionPaused(){
      saveNodeHistory();
    }
    @Override public void stackFrameChanged(){
      XStackFrame frame=session.getCurrentStackFrame();
      if (frame instanceof JavaStackFrame) {
        StackFrameProxyImpl frameProxy=((JavaStackFrame)frame).getStackFrameProxy();
        DebuggerContextUtil.setStackFrame(javaSession.getContextManager(),frameProxy);
        saveNodeHistory(frameProxy);
      }
    }
  }
);
}
