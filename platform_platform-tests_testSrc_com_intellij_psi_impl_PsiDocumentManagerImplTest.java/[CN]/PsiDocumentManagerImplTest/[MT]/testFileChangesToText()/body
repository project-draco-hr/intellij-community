{
  VirtualFile vFile=getVirtualFile(createTempFile("a.txt","abc"));
  PsiFile psiFile=getPsiManager().findFile(vFile);
  Document document=getPsiDocumentManager().getDocument(psiFile);
  rename(vFile,"a.xml");
  assertFalse(psiFile.isValid());
  assertNotSame(psiFile,getPsiManager().findFile(vFile));
  psiFile=getPsiManager().findFile(vFile);
  assertSame(document,FileDocumentManager.getInstance().getDocument(vFile));
  assertSame(document,getPsiDocumentManager().getDocument(psiFile));
}
