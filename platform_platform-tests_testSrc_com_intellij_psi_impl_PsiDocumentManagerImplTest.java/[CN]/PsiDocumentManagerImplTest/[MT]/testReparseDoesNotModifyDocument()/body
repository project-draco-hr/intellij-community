{
  VirtualFile file=createTempFile("txt",null,"foo",Charset.forName("UTF-8"));
  file.putUserData(TrailingSpacesStripper.OVERRIDE_STRIP_TRAILING_SPACES_KEY,EditorSettingsExternalizable.STRIP_TRAILING_SPACES_WHOLE);
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  assertNotNull(document);
  WriteCommandAction.runWriteCommandAction(myProject,new Runnable(){
    @Override public void run(){
      document.insertString(3," ");
    }
  }
);
  PsiDocumentManager.getInstance(myProject).reparseFiles(Collections.singleton(file),false);
  assertEquals("foo ",VfsUtilCore.loadText(file));
}
