{
  final DocumentCommitThread commitThread=DocumentCommitThread.getInstance();
  assertTrue(commitThread.isEnabled());
  WriteCommandAction.runWriteCommandAction(null,new Runnable(){
    @Override public void run(){
      if (commitThread.isEnabled()) {
        System.err.println("commitThread: " + commitThread + ";\n"+ commitThread.log+ ";\n"+ ThreadDumper.dumpThreadsToString());
      }
      assertFalse(commitThread.isEnabled());
      WriteCommandAction.runWriteCommandAction(null,new Runnable(){
        @Override public void run(){
          assertFalse(commitThread.isEnabled());
        }
      }
);
      assertFalse(commitThread.isEnabled());
    }
  }
);
  assertTrue(commitThread.isEnabled());
}
