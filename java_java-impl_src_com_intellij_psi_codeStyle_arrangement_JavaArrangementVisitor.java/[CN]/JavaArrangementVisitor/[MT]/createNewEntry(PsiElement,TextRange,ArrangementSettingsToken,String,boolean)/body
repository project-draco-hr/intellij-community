{
  if (!isWithinBounds(range)) {
    return null;
  }
  DefaultArrangementEntry current=getCurrent();
  JavaElementArrangementEntry entry;
  if (canArrange) {
    TextRange expandedRange=myDocument == null ? null : ArrangementUtil.expandToLineIfPossible(range,myDocument);
    TextRange rangeToUse=expandedRange == null ? range : expandedRange;
    entry=new JavaElementArrangementEntry(current,rangeToUse,type,name,true);
  }
 else {
    entry=new JavaElementArrangementEntry(current,range,type,name,false);
  }
  registerEntry(element,entry);
  return entry;
}
