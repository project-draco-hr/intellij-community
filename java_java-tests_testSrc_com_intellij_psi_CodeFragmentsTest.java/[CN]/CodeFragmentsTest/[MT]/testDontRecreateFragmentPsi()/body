{
  PsiExpressionCodeFragment fragment=JavaCodeFragmentFactory.getInstance(myProject).createExpressionCodeFragment("a",null,null,true);
  VirtualFile file=fragment.getViewProvider().getVirtualFile();
  assertInstanceOf(file,LightVirtualFile.class);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ProjectRootManagerEx.getInstanceEx(getProject()).makeRootsChange(EmptyRunnable.getInstance(),false,true);
    }
  }
);
  assertSame(fragment,PsiManager.getInstance(myProject).findFile(file));
  assertTrue(fragment.isValid());
}
