{
  Project project=e.getProject();
  Editor selectedEditor=StudyEditor.getSelectedEditor(project);
  if (selectedEditor == null) {
    return;
  }
  FileDocumentManager fileDocumentManager=FileDocumentManager.getInstance();
  VirtualFile openedFile=fileDocumentManager.getFile(selectedEditor.getDocument());
  if (openedFile != null) {
    StudyTaskManager taskManager=StudyTaskManager.getInstance(project);
    TaskFile selectedTaskFile=taskManager.getTaskFile(openedFile);
    if (selectedTaskFile != null) {
      selectedTaskFile.updateOffsets(selectedEditor);
      Window selectedWindow=selectedTaskFile.getSelectedWindow();
      selectedWindow.setResolveStatus(true);
      selectedEditor.getMarkupModel().removeAllHighlighters();
      selectedWindow.draw(selectedEditor,false,true);
      fileDocumentManager.saveAllDocuments();
      fileDocumentManager.reloadFiles(openedFile);
      Window nextWindow=selectedWindow.getNext();
      if (nextWindow == null) {
        if (selectedTaskFile.getTask().isResolved()) {
          DefaultActionGroup defaultActionGroup=new DefaultActionGroup();
          AnAction checkAction=ActionManager.getInstance().getAction("ru.compscicenter.edide.actions.CheckAction");
          defaultActionGroup.add(checkAction);
          ListPopup popUp=JBPopupFactory.getInstance().createActionGroupPopup("What should we do with selected task window?",defaultActionGroup,DataManager.getInstance().getDataContext(selectedEditor.getComponent()),JBPopupFactory.ActionSelectionAid.MNEMONICS,true);
          popUp.showInBestPositionFor(DataManager.getInstance().getDataContext(selectedEditor.getComponent()));
        }
      }
    }
  }
}
