{
  final VirtualFile baseDir=project.getBaseDir();
  assertNotNull(baseDir);
  final File moduleFile=new File(FileUtil.toSystemDependentName(baseDir.getPath()),moduleName + ModuleFileType.DOT_DEFAULT_EXTENSION);
  FileUtil.createIfDoesntExist(moduleFile);
  myFilesToDelete.add(moduleFile);
  return new WriteAction<Module>(){
    @Override protected void run(    @NotNull Result<Module> result) throws Throwable {
      VirtualFile virtualFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(moduleFile);
      assertNotNull(virtualFile);
      Module module=ModuleManager.getInstance(project).newModule(virtualFile.getPath(),moduleType.getId());
      module.getModuleFile();
      result.setResult(module);
    }
  }
.execute().getResultObject();
}
