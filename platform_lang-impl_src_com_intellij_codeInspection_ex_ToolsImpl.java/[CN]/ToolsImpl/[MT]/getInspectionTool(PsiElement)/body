{
  if (myTools != null) {
    final Project project=element != null ? element.getProject() : null;
    for (    ScopeToolState state : myTools) {
      if (element == null) {
        return (InspectionToolWrapper)state.getTool();
      }
 else {
        final NamedScope scope=state.getScope(project);
        if (scope != null) {
          final PackageSet packageSet=scope.getValue();
          if (packageSet != null) {
            final PsiFile containingFile=element.getContainingFile();
            if (containingFile != null && packageSet.contains(containingFile,DependencyValidationManager.getInstance(project))) {
              return (InspectionToolWrapper)state.getTool();
            }
          }
        }
      }
    }
    for (    ScopeToolState state : getTools()) {
      if (state.getScope(project) == null) {
        return (InspectionToolWrapper)state.getTool();
      }
    }
  }
  return (InspectionToolWrapper)myDefaultState.getTool();
}
