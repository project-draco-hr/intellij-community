{
  if (numberOfResults == 0)   return;
  final MatchResultImpl substitution=context.getResult().findSon(name);
  if (substitution != null) {
    final List<PsiElement> matchedNodes=context.getMatchedNodes();
    if (substitution.hasSons()) {
      final List<MatchResult> sons=substitution.getMatches();
      while (numberOfResults > 0) {
        --numberOfResults;
        final MatchResult matchResult=sons.remove(sons.size() - 1);
        if (matchedNodes != null)         matchedNodes.remove(matchResult.getMatch());
      }
      if (sons.isEmpty()) {
        context.getResult().removeSon(name);
      }
    }
 else {
      final MatchResultImpl matchResult=context.getResult().removeSon(name);
      if (matchedNodes != null)       matchedNodes.remove(matchResult.getMatch());
    }
  }
}
