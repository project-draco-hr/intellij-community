{
  final String configurationName=dependency.getDeclaredConfiguration().getName();
  final GradleDependencyScope scope=deduceScope(configurationName,userScopes);
  if (scope == null)   return;
  final Project project=dependency.getProject();
  final String version=project.hasProperty(VERSION_PROPERTY) ? str(project.property(VERSION_PROPERTY)) : "";
  final String group=project.hasProperty(GROUP_PROPERTY) ? str(project.property(GROUP_PROPERTY)) : "";
  InternalDependencyVersionId versionId=new InternalDependencyVersionId(dependency,project.getPath(),project.getName(),null,group,version,null);
  Scopes scopes=map.get(versionId);
  if (scopes == null) {
    map.put(versionId,new Scopes(scope));
  }
 else {
    scopes.add(scope);
  }
}
