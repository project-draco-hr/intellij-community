{
  if (expression.getLanguage() == null) {
    Language language=null;
    if (stackFrame != null) {
      XSourcePosition position=stackFrame.getSourcePosition();
      if (position != null) {
        language=XDebuggerEditorBase.getFileTypeLanguage(position.getFile().getFileType());
      }
    }
    if (language == null && file != null) {
      language=XDebuggerEditorBase.getFileTypeLanguage(file.getFileType());
    }
    expression=new XExpressionImpl(expression.getExpression(),language,expression.getCustomInfo(),expression.getMode());
  }
  new XDebuggerEvaluationDialog(session,editorsProvider,evaluator,expression,stackFrame == null ? null : stackFrame.getSourcePosition()).show();
}
