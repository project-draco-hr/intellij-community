{
  final ExcludesConfiguration configuration=ValidationConfiguration.getExcludedEntriesConfiguration(project);
  final ProjectFileIndex index=ProjectRootManager.getInstance(project).getFileIndex();
  final FileChooserDescriptor descriptor=new FileChooserDescriptor(true,true,false,false,false,true){
    public boolean isFileVisible(    VirtualFile file,    boolean showHiddenFiles){
      return super.isFileVisible(file,showHiddenFiles) && (project.isDefault() || !index.isExcluded(file));
    }
  }
;
  List<VirtualFile> allContentRoots=new ArrayList<>();
  for (  final Module module : ModuleManager.getInstance(project).getModules()) {
    final VirtualFile[] moduleContentRoots=ModuleRootManager.getInstance(module).getContentRoots();
    Collections.addAll(allContentRoots,moduleContentRoots);
  }
  descriptor.setRoots(allContentRoots);
  return new ExcludedEntriesConfigurable(project,descriptor,configuration);
}
