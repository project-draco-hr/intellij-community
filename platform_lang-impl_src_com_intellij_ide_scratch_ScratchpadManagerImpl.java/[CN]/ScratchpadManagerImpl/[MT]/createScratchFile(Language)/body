{
  updateHistory(myProject,language);
  return ApplicationManager.getApplication().runWriteAction(new Computable<VirtualFile>(){
    @Override public VirtualFile compute(){
      String name=generateFileName();
      return ScratchpadFileSystem.getScratchFileSystem().addFile(name,language,calculatePrefix(ScratchpadManagerImpl.this.myProject));
    }
  }
);
}
