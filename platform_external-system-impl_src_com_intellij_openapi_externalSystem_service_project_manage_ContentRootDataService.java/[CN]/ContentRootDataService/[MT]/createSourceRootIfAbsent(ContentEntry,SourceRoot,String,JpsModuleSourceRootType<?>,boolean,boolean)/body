{
  SourceFolder[] folders=entry.getSourceFolders();
  for (  SourceFolder folder : folders) {
    VirtualFile file=folder.getFile();
    if (file == null) {
      continue;
    }
    if (ExternalSystemApiUtil.getLocalFileSystemPath(file).equals(root.getPath())) {
      final JpsModuleSourceRootType<?> folderRootType=folder.getRootType();
      if (JavaSourceRootType.SOURCE.equals(folderRootType) || sourceRootType.equals(folderRootType)) {
        return;
      }
      if (JavaSourceRootType.TEST_SOURCE.equals(folderRootType) && JavaResourceRootType.TEST_RESOURCE.equals(sourceRootType)) {
        return;
      }
      entry.removeSourceFolder(folder);
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug(String.format("Importing %s for content root '%s' of module '%s'",root,entry.getUrl(),moduleName));
  }
  SourceFolder sourceFolder=entry.addSourceFolder(toVfsUrl(root.getPath()),sourceRootType);
  if (!StringUtil.isEmpty(root.getPackagePrefix())) {
    sourceFolder.setPackagePrefix(root.getPackagePrefix());
  }
  if (generated) {
    JavaSourceRootProperties properties=sourceFolder.getJpsElement().getProperties(JavaModuleSourceRootTypes.SOURCES);
    if (properties != null) {
      properties.setForGeneratedSources(true);
    }
  }
  if (createEmptyContentRootDirectories) {
    ExternalSystemApiUtil.doWriteAction(new Runnable(){
      @Override public void run(){
        try {
          VfsUtil.createDirectoryIfMissing(root.getPath());
        }
 catch (        IOException e) {
          LOG.warn(String.format("Unable to create directory for the path: %s",root.getPath()),e);
        }
      }
    }
);
  }
}
