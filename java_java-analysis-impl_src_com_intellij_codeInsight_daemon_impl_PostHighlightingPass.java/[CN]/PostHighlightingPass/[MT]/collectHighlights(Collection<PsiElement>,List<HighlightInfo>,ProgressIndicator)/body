{
  ApplicationManager.getApplication().assertReadAccessAllowed();
  InspectionProfile profile=InspectionProjectProfileManager.getInstance(myProject).getInspectionProfile();
  myUnusedSymbolKey=HighlightDisplayKey.find(UnusedSymbolLocalInspectionBase.SHORT_NAME);
  boolean unusedSymbolEnabled=profile.isToolEnabled(myUnusedSymbolKey,myFile);
  myUnusedSymbolInspection=(UnusedSymbolLocalInspectionBase)profile.getUnwrappedTool(UnusedSymbolLocalInspectionBase.SHORT_NAME,myFile);
  LOG.assertTrue(ApplicationManager.getApplication().isUnitTestMode() || myUnusedSymbolInspection != null);
  myDeadCodeKey=HighlightDisplayKey.find(UnusedDeclarationInspection.SHORT_NAME);
  HighlightDisplayKey unusedImportKey=HighlightDisplayKey.find(UnusedImportLocalInspection.SHORT_NAME);
  myDeadCodeInfoType=myDeadCodeKey == null ? HighlightInfoType.UNUSED_SYMBOL : new HighlightInfoType.HighlightInfoTypeImpl(profile.getErrorLevel(myDeadCodeKey,myFile).getSeverity(),HighlightInfoType.UNUSED_SYMBOL.getAttributesKey());
  GlobalUsageHelper helper=new GlobalUsageHelper(){
    @Override public boolean shouldCheckUsages(    @NotNull PsiMember member){
      return !myInLibrary && !myIsEntryPointPredicate.apply(member);
    }
    @Override public boolean isCurrentFileAlreadyChecked(){
      return true;
    }
    @Override public boolean isLocallyUsed(    @NotNull PsiNamedElement member){
      return myRefCountHolder.isReferenced(member);
    }
  }
;
  boolean errorFound=false;
  if (unusedSymbolEnabled) {
    for (    PsiElement element : elements) {
      progress.checkCanceled();
      if (element instanceof PsiIdentifier) {
        PsiIdentifier identifier=(PsiIdentifier)element;
        HighlightInfo info=processIdentifier(identifier,progress,helper);
        if (info != null) {
          errorFound|=info.getSeverity() == HighlightSeverity.ERROR;
          result.add(info);
        }
      }
    }
  }
  if (myUnusedImportEnabled && myFile instanceof PsiJavaFile && HighlightingLevelManager.getInstance(myProject).shouldHighlight(myFile)) {
    PsiImportList importList=((PsiJavaFile)myFile).getImportList();
    if (importList != null) {
      final PsiImportStatementBase[] imports=importList.getAllImportStatements();
      for (      PsiImportStatementBase statement : imports) {
        progress.checkCanceled();
        final HighlightInfo info=processImport(statement,unusedImportKey);
        if (info != null) {
          errorFound|=info.getSeverity() == HighlightSeverity.ERROR;
          result.add(info);
        }
      }
    }
  }
  return errorFound;
}
