{
  PsiReferenceExpressionImpl expression=(PsiReferenceExpressionImpl)ref;
  CompositeElement treeParent=expression.getTreeParent();
  IElementType parentType=treeParent == null ? null : treeParent.getElementType();
  List<ResolveResult[]> qualifiers=resolveAllQualifiers(expression,containingFile);
  JavaResolveResult[] result=expression.resolve(parentType,containingFile);
  if (result.length == 0 && incompleteCode && parentType != JavaElementType.REFERENCE_EXPRESSION) {
    result=expression.resolve(JavaElementType.REFERENCE_EXPRESSION,containingFile);
  }
  JavaResolveUtil.substituteResults(expression,result);
  qualifiers.clear();
  return result;
}
