{
  com.intellij.openapi.editor.VisualPosition pos=editor.xyToVisualPosition(p);
  if (editor.visualPositionToXY(pos).x > p.x) {
    return new com.intellij.openapi.editor.VisualPosition(pos.line,pos.column - 1);
  }
 else {
    return pos;
  }
}
