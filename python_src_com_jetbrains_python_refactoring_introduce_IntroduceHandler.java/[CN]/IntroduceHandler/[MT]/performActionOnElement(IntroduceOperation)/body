{
  if (!checkEnabled(operation)) {
    return;
  }
  final PsiElement element=operation.getElement();
  final PsiElement parent=element.getParent();
  final PyExpression initializer=parent instanceof PyAssignmentStatement ? ((PyAssignmentStatement)parent).getAssignedValue() : (PyExpression)element;
  operation.setInitializer(initializer);
  if (initializer.getUserData(PyPsiUtils.SELECTION_BREAKS_AST_NODE) == null) {
    operation.setOccurrences(getOccurrences(element,initializer));
  }
  operation.setSuggestedNames(getSuggestedNames(initializer));
  if (operation.getOccurrences().size() == 0) {
    operation.setReplaceAll(false);
  }
  performActionOnElementOccurrences(operation);
}
