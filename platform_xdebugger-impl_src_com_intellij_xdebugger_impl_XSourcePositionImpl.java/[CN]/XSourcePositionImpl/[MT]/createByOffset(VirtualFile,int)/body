{
  if (file == null)   return null;
  AccessToken lock=ApplicationManager.getApplication().acquireReadActionLock();
  try {
    Document document=FileDocumentManager.getInstance().getDocument(file);
    if (document == null) {
      return null;
    }
    int line=DocumentUtil.isValidOffset(offset,document) ? document.getLineNumber(offset) : -1;
    return new XSourcePositionImpl(file,line,offset);
  }
  finally {
    lock.finish();
  }
}
