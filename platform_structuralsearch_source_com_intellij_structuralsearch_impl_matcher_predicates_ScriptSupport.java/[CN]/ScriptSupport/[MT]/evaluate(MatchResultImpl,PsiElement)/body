{
  try {
    Binding binding=new Binding();
    if (result != null) {
      for (      MatchResult r : result.getMatches()) {
        binding.setVariable(r.getName(),r.getMatchRef().getElement());
      }
    }
    if (context == null) {
      context=result.getMatchRef().getElement();
    }
    if (StructuralSearchUtil.isIdentifier(context))     context=context.getParent();
    binding.setVariable("__context__",context);
    script.setBinding(binding);
    Object o=script.run();
    return String.valueOf(o);
  }
 catch (  GroovyRuntimeException ex) {
    throw new StructuralSearchException(SSRBundle.message("groovy.script.error",ex.getMessage()));
  }
 finally {
    script.setBinding(null);
  }
}
