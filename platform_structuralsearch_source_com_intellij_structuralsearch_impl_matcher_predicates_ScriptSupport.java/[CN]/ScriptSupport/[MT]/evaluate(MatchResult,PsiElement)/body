{
  try {
    final HashMap<String,Object> variableMap=new HashMap<String,Object>();
    if (result != null) {
      buildVariableMap(result,variableMap);
      if (context == null) {
        context=result.getMatch();
      }
    }
    final Binding binding=new Binding(variableMap);
    context=StructuralSearchUtil.getPresentableElement(context);
    binding.setVariable("__context__",context);
    script.setBinding(binding);
    final Object o=script.run();
    return String.valueOf(o);
  }
 catch (  GroovyRuntimeException ex) {
    throw new StructuralSearchException(SSRBundle.message("groovy.script.error",ex.getMessage()));
  }
 finally {
    script.setBinding(null);
  }
}
