{
  if (myState == 1) {
    myDelegate.advance();
    if (myDelegate.getTokenType() == null) {
      myState=0;
      myTokenEnd=myDelegate.getBufferEnd();
      advance();
    }
  }
 else {
    if (myTokenEnd == myEndOffset) {
      myState=2;
      return;
    }
    myTokenStart=myTokenEnd;
    if (StringUtil.isWhiteSpace(myBuffer.charAt(myTokenStart))) {
      myTokenType=getIndentTokenType();
      myTokenEnd=findNonWhitespace(myTokenStart);
      return;
    }
    int curIndent=calcIndent(myTokenStart);
    if (curIndent > myIndent) {
      myTokenType=getEmbeddedContentTokenType();
      myTokenEnd=findEndByIndent(myTokenStart + 1);
      return;
    }
    int embeddedCodeStartMarkerLength=getEmbeddedCodeStartMarkerLength();
    if (embeddedCodeStartMarkerLength > 0) {
      myTokenType=MINUS_TYPE;
      myTokenEnd=myTokenStart + embeddedCodeStartMarkerLength;
    }
 else {
      myTokenEnd=findEol(myTokenStart);
      myDelegate.start(myBuffer,myTokenStart,myTokenEnd,getDelegateState(myDelegate.getState()));
      myState=1;
    }
  }
}
