{
  src=src.getCanonicalFile();
  dest=dest.getCanonicalFile();
  if (!src.isDirectory()) {
    throw new IOException(ApplicationBundle.message("config.import.invalid.directory.error",src.getAbsolutePath()));
  }
  if (!dest.isDirectory()) {
    throw new IOException(ApplicationBundle.message("config.import.invalid.directory.error",dest.getAbsolutePath()));
  }
  if (FileUtil.filesEqual(src,dest)) {
    return;
  }
  FileUtil.copyDir(src,dest);
  File plugins=new File(dest,PLUGINS_PATH);
  if (plugins.exists()) {
    final ArrayList<IdeaPluginDescriptorImpl> descriptors=new ArrayList<IdeaPluginDescriptorImpl>();
    PluginManagerCore.loadDescriptors(plugins.getPath(),descriptors,null,0);
    final ArrayList<String> oldPlugins=new ArrayList<String>();
    for (    IdeaPluginDescriptorImpl descriptor : descriptors) {
      oldPlugins.add(descriptor.getPluginId().getIdString());
    }
    if (!oldPlugins.isEmpty()) {
      PluginManagerCore.savePluginsList(oldPlugins,false,new File(dest,PluginManager.INSTALLED_TXT));
    }
    FileUtil.delete(plugins);
  }
}
