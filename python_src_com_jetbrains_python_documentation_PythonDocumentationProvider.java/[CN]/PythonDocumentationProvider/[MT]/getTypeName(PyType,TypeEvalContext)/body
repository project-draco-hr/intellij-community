{
  Set<PyType> visited=new HashSet<PyType>();
  if (type == null) {
    return UNKNOWN;
  }
  if (type instanceof PyTypeReference) {
    final PyType resolved=((PyTypeReference)type).resolve(null,context);
    if (resolved != null) {
      return getTypeName(resolved,context);
    }
    return UNKNOWN;
  }
  final String name=type.getName();
  if (type instanceof PyCollectionType) {
    final PyType elementType=((PyCollectionType)type).getElementType(context);
    if (elementType != null) {
      return String.format("%s of %s",name,getTypeName(elementType,context));
    }
  }
  if (type instanceof PyUnionType) {
    return String.format("one of (%s)",StringUtil.join(((PyUnionType)type).getResolvedMembers(context),new Function<PyType,String>(){
      @Override public String fun(      PyType t){
        return getTypeName(t,context);
      }
    }
,", "));
  }
  return name;
}
