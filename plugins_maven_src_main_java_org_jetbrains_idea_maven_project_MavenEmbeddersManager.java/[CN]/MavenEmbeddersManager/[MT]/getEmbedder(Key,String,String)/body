{
  Trinity<Key,String,String> key=Trinity.create(kind,workingDirectory,multiModuleProjectDirectory);
  MavenEmbedderWrapper result=myPool.get(key);
  boolean alwaysOnline=kind == FOR_DOWNLOAD;
  if (result == null) {
    result=MavenServerManager.getInstance().createEmbedder(myProject,alwaysOnline,workingDirectory,multiModuleProjectDirectory);
    myPool.put(key,result);
  }
  if (myEmbeddersInUse.contains(result)) {
    MavenLog.LOG.warn("embedder " + key + " is already used");
    return MavenServerManager.getInstance().createEmbedder(myProject,alwaysOnline,workingDirectory,multiModuleProjectDirectory);
  }
  myEmbeddersInUse.add(result);
  return result;
}
