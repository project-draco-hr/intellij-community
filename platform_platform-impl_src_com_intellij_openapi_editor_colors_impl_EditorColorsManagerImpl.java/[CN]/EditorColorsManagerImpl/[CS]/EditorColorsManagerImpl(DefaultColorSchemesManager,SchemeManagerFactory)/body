{
  myDefaultColorSchemeManager=defaultColorSchemeManager;
  mySchemeManager=schemeManagerFactory.create(FILE_SPEC,new BaseSchemeProcessor<EditorColorsScheme,EditorColorsSchemeImpl>(){
    @NotNull @Override public EditorColorsSchemeImpl readScheme(    @NotNull Element element,    boolean duringLoad){
      EditorColorsSchemeImpl scheme=new EditorColorsSchemeImpl(null);
      scheme.readExternal(element);
      return scheme;
    }
    @NotNull @Override public Element writeScheme(    @NotNull final EditorColorsSchemeImpl scheme){
      Element root=new Element(SCHEME_NODE_NAME);
      scheme.writeExternal(root);
      return root;
    }
    @NotNull @Override public SchemeState getState(    @NotNull EditorColorsScheme scheme){
      return scheme instanceof EditorColorsSchemeImpl && !(scheme instanceof ReadOnlyColorsScheme) && ((EditorColorsSchemeImpl)scheme).isSaveNeeded() ? SchemeState.POSSIBLY_CHANGED : SchemeState.NON_PERSISTENT;
    }
    @Override public void onCurrentSchemeChanged(    @Nullable Scheme oldScheme){
      LafManager.getInstance().updateUI();
      schemeChangedOrSwitched();
      fireChanges(mySchemeManager.getCurrentScheme());
    }
    @NotNull @NonNls @Override public String getSchemeExtension(){
      return ".icls";
    }
    @Override public boolean isUpgradeNeeded(){
      return true;
    }
  }
);
  initDefaultSchemes();
  loadBundledSchemes();
  mySchemeManager.loadSchemes();
  String wizardEditorScheme=WelcomeWizardUtil.getWizardEditorScheme();
  EditorColorsScheme scheme=null;
  if (wizardEditorScheme != null) {
    scheme=getScheme(wizardEditorScheme);
    LOG.assertTrue(scheme != null,"Wizard scheme " + wizardEditorScheme + " not found");
  }
  setGlobalSchemeInner(scheme == null ? getDefaultScheme() : scheme);
}
