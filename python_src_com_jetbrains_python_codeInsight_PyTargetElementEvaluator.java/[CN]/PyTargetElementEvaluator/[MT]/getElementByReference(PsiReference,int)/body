{
  if ((flags & TargetElementUtilBase.ELEMENT_NAME_ACCEPTED) == 0) {
    return null;
  }
  final PsiElement element=ref.getElement();
  PsiElement result=ref.resolve();
  if (result instanceof PyReferenceExpression && PsiTreeUtil.getParentOfType(element,ScopeOwner.class) == PsiTreeUtil.getParentOfType(result,ScopeOwner.class)) {
    QualifiedResolveResult resolveResult=((PyReferenceExpression)result).followAssignmentsChain(PyResolveContext.noImplicits());
    PsiElement finalResult=resolveResult.getElement();
    if (PsiTreeUtil.getParentOfType(element,ScopeOwner.class) == PsiTreeUtil.getParentOfType(finalResult,ScopeOwner.class)) {
      return finalResult;
    }
  }
  return result;
}
