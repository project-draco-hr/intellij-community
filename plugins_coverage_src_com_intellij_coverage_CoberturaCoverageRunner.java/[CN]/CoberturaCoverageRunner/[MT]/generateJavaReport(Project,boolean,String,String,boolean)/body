{
  try {
    final JavaParameters javaParameters=new JavaParameters();
    javaParameters.setMainClass("net.sourceforge.cobertura.reporting.Main");
    javaParameters.getProgramParametersList().add("--destination",outputDirectory);
    javaParameters.getProgramParametersList().add("--datafile",binaryFilePath);
    javaParameters.getClassPath().add(PathManager.getLibPath() + File.separator + "cobertura.jar");
    javaParameters.getClassPath().add(PathManager.getLibPath() + File.separator + "log4j.jar");
    final ProjectRootManager projectRootManager=ProjectRootManager.getInstance(project);
    final VirtualFile[] sourceRoots=projectRootManager.getContentSourceRoots();
    for (    VirtualFile sourceRoot : sourceRoots) {
      javaParameters.getProgramParametersList().add(FileUtil.toSystemDependentName(sourceRoot.getPath()));
    }
    javaParameters.setJdk(projectRootManager.getProjectSdk());
    final DefaultJavaProcessHandler processHandler=new DefaultJavaProcessHandler(javaParameters);
    processHandler.startNotify();
    processHandler.addProcessListener(new ProcessAdapter(){
      public void processTerminated(      final ProcessEvent event){
        processHandler.removeProcessListener(this);
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            if (openInBrowser) {
              BrowserUtil.browse(new File(outputDirectory,"/index.html"));
            }
          }
        }
);
      }
    }
);
  }
 catch (  ExecutionException e1) {
  }
}
