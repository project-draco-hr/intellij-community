{
  final VirtualFile[] filesOrDirs=dataContext == null ? null : CommonDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  if (filesOrDirs != null) {
    final List<VirtualFile> selectedFiles=ContainerUtil.filter(filesOrDirs,new Condition<VirtualFile>(){
      @Override public boolean value(      VirtualFile file){
        return !file.isDirectory();
      }
    }
);
    if (!selectedFiles.isEmpty()) {
      return new DelegatingGlobalSearchScope(GlobalSearchScope.filesScope(project,selectedFiles)){
        @NotNull @Override public String getDisplayName(){
          return "Selected Files";
        }
      }
;
    }
  }
  return null;
}
