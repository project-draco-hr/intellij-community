{
  if (rootFilter == null && structureFilter == null)   return new HashSet<VirtualFile>(roots);
  Set<VirtualFile> result=new HashSet<VirtualFile>();
  if (rootFilter != null) {
    result.addAll(rootFilter.getRoots());
  }
  if (structureFilter != null) {
    Pair<Set<VirtualFile>,MultiMap<VirtualFile,VirtualFile>> rootsAndFiles=collectRoots(structureFilter.getFiles(),new HashSet<VirtualFile>(roots));
    result.addAll(ContainerUtil.union(rootsAndFiles.first,rootsAndFiles.second.keySet()));
  }
  return result;
}
