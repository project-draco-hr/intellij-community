{
  if (charBuffer == null) {
    charBuffer=CharBuffer.allocate(byteCount);
  }
  CharsetDecoder decoder=CharsetUtil.getDecoder(CharsetUtil.UTF_8);
  if (src.nioBufferCount() == 1) {
    decodeString(decoder,src.internalNioBuffer(src.readerIndex(),byteCount),charBuffer);
  }
 else {
    ByteBuf buffer=src.alloc().heapBuffer(byteCount);
    try {
      buffer.writeBytes(src,src.readerIndex(),byteCount);
      decodeString(decoder,buffer.internalNioBuffer(src.readerIndex(),byteCount),charBuffer);
    }
  finally {
      buffer.release();
    }
  }
  return charBuffer;
}
