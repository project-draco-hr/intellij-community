{
  ByteBuffer in=buffer.nioBuffer(buffer.readerIndex(),byteCount);
  if (charBuffer == null) {
    charBuffer=CharBuffer.allocate((int)((float)in.remaining() * decoder.maxCharsPerByte()));
  }
  CoderResult cr=decoder.decode(in,charBuffer,true);
  if (!cr.isUnderflow()) {
    cr.throwException();
  }
  cr=decoder.flush(charBuffer);
  if (!cr.isUnderflow()) {
    cr.throwException();
  }
  buffer.skipBytes(byteCount);
  return charBuffer;
}
