{
  CharSequence text=editor.getDocument().getCharsSequence();
  int offset=CharArrayUtil.shiftForward(text,caretOffset," \t");
  final int fileLength=text.length();
  if (offset < fileLength && ")];,%<?".indexOf(text.charAt(offset)) < 0) {
    offset=calculateOffsetToInsertClosingBrace(file,text,offset).second;
  }
  return Math.min(offset,fileLength);
}
