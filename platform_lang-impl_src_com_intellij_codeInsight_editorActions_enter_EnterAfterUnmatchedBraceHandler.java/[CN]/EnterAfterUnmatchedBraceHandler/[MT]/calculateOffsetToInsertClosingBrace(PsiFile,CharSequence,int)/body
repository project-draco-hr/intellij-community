{
  PsiElement element=PsiUtilCore.getElementAtOffset(file,offset);
  ASTNode node=element.getNode();
  if (node != null && node.getElementType() == TokenType.WHITE_SPACE) {
    return Pair.create(null,CharArrayUtil.shiftForwardUntil(text,offset,"\n"));
  }
  for (PsiElement parent=element.getParent(); parent != null; parent=parent.getParent()) {
    ASTNode parentNode=parent.getNode();
    if (parentNode == null || parentNode.getStartOffset() != offset) {
      break;
    }
    element=parent;
  }
  if (element.getTextOffset() != offset) {
    return Pair.create(null,CharArrayUtil.shiftForwardUntil(text,offset,"\n"));
  }
  return Pair.create(element,element.getTextRange().getEndOffset());
}
