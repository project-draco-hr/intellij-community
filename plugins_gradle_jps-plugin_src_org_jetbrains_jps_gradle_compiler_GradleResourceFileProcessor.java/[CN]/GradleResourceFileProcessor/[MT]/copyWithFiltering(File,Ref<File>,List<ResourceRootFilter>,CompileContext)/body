{
  final FileInputStream originalInputStream=new FileInputStream(file);
  try {
    final InputStream inputStream=transform(filters,originalInputStream,outputFileRef,context);
    FileUtil.createIfDoesntExist(outputFileRef.get());
    FileOutputStream outputStream=new FileOutputStream(outputFileRef.get());
    try {
      FileUtil.copy(inputStream,outputStream);
    }
  finally {
      StreamUtil.closeStream(inputStream);
      StreamUtil.closeStream(outputStream);
    }
  }
  finally {
    StreamUtil.closeStream(originalInputStream);
  }
}
