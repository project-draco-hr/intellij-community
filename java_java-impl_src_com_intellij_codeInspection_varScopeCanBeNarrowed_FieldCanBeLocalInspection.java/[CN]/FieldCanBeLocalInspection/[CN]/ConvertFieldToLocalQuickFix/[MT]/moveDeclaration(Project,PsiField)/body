{
  final Map<PsiCodeBlock,Collection<PsiReference>> refs=new HashMap<PsiCodeBlock,Collection<PsiReference>>();
  groupByCodeBlocks(ReferencesSearch.search(variable).findAll(),refs);
  PsiElement element=null;
  for (  Collection<PsiReference> psiReferences : refs.values()) {
    element=super.moveDeclaration(project,variable,psiReferences,false);
  }
  if (element != null) {
    final PsiElement finalElement=element;
    Runnable runnable=new Runnable(){
      public void run(){
        beforeDelete(project,variable,finalElement);
        variable.normalizeDeclaration();
        variable.delete();
      }
    }
;
    ApplicationManager.getApplication().runWriteAction(runnable);
  }
  return element;
}
