{
  Project project=e.getProject();
  if (!isConvertableProject(project) || Messages.showOkCancelDialog(project,"Project will be saved and reopened in new Directory-Based format.\nAre you sure you want to continue?","Save Project to Directory-Based Format",Messages.getWarningIcon()) != Messages.OK) {
    return;
  }
  IProjectStore store=ProjectKt.getStateStore(project);
  String baseDir=PathUtilRt.getParentPath(store.getProjectFilePath());
  File ideaDir=new File(baseDir,Project.DIRECTORY_STORE_FOLDER);
  if ((ideaDir.exists() && ideaDir.isDirectory()) || createDir(ideaDir)) {
    LocalFileSystem.getInstance().refreshAndFindFileByIoFile(ideaDir);
    store.clearStorages();
    store.setPath(baseDir);
    project.save();
    ProjectUtil.closeAndDispose(project);
    ProjectUtil.openProject(baseDir,null,false);
  }
 else {
    Messages.showErrorDialog(project,String.format("Unable to create '.idea' directory (%s)",ideaDir),"Error Saving Project!");
  }
}
