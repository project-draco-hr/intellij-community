{
  SimpleTimer timer=SimpleTimer.newInstance("test timer");
  int N=10000;
  StringBuffer LOG=new StringBuffer(N * 5);
  StringBuffer expected=new StringBuffer(N * 5);
  CountDownLatch executed=new CountDownLatch(N);
  List<SimpleTimerTask> tasks=new ArrayList<>(N);
  for (int i=0; i < N; i++) {
    final int finalI=i;
    expected.append(finalI + ", ");
    SimpleTimerTask task=timer.setUp(new Runnable(){
      @Override public void run(){
        LOG.append(finalI + ", ");
        executed.countDown();
      }
      @Override public String toString(){
        return String.valueOf(finalI);
      }
    }
,500);
    tasks.add(task);
  }
  boolean completed=executed.await(5000,TimeUnit.MILLISECONDS);
  assertEquals(tasks.toString(),expected.toString(),LOG.toString());
  assertTrue(completed);
}
