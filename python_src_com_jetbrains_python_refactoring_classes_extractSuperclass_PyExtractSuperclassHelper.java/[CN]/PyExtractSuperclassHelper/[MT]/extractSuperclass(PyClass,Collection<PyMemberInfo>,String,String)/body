{
  final Set<String> superClasses=new HashSet<String>();
  final Set<PyClass> extractedClasses=new HashSet<PyClass>();
  final List<PyFunction> methods=new ArrayList<PyFunction>();
  for (  PyMemberInfo member : selectedMemberInfos) {
    final PyElement element=member.getMember();
    if (element instanceof PyFunction)     methods.add((PyFunction)element);
 else     if (element instanceof PyClass) {
      extractedClasses.add((PyClass)element);
      superClasses.add(element.getName());
    }
 else     LOG.error("unmatched member class " + element.getClass());
  }
  for (  PyExpression expr : clazz.getSuperClassExpressions()) {
    if (PyNames.OBJECT.equals(expr.getText()) && !superClasses.contains(PyNames.OBJECT)) {
      superClasses.add(PyNames.OBJECT);
    }
  }
  final Project project=clazz.getProject();
  final Ref<PyClass> newClassRef=new Ref<PyClass>();
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          final PyElement[] elements=methods.toArray(new PyElement[methods.size()]);
          final String text=PyClassRefactoringUtil.prepareClassText(clazz,elements,true,true,superBaseName) + "\n";
          final PyClass newClass=PyElementGenerator.getInstance(project).createFromText(LanguageLevel.getDefault(),PyClass.class,text);
          newClassRef.set(newClass);
          PyClassRefactoringUtil.moveSuperclasses(clazz,superClasses,newClass);
          PyClassRefactoringUtil.addSuperclasses(project,clazz,null,Collections.singleton(superBaseName));
          if (elements.length > 0) {
            PyPsiUtils.removeElements(elements);
          }
          PyClassRefactoringUtil.insertPassIfNeeded(clazz);
          placeNewClass(project,newClass,clazz,targetFile,extractedClasses);
        }
      }
);
    }
  }
,RefactoringBundle.message("extract.superclass.command.name",superBaseName,clazz.getName()),null);
  return newClassRef.get();
}
