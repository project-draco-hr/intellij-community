{
  final StatisticsService statisticsService=StatisticsUploadAssistant.getStatisticsService();
  if (StatisticsUploadAssistant.showNotification()) {
    Application app=ApplicationManager.getApplication();
    app.getMessageBus().connect(app).subscribe(AppLifecycleListener.TOPIC,new AppLifecycleListener.Adapter(){
      @Override public void appFrameCreated(      String[] commandLineArgs,      @NotNull Ref<Boolean> willOpenProject){
        myAlarm.addRequest(new Runnable(){
          @Override public void run(){
            StatisticsNotificationManager.showNotification(statisticsService);
          }
        }
,30 * 1000);
      }
    }
);
  }
 else   if (StatisticsUploadAssistant.isSendAllowed() && StatisticsUploadAssistant.isTimeToSend()) {
    StatisticsService serviceToUse=null;
    StatisticsServiceEP[] extensions=StatisticsService.EP_NAME.getExtensions();
    if (extensions.length > 1) {
      LOG.warn(String.format("More than one stats service detected (%s). Falling back to the built-in one",Arrays.toString(extensions)));
    }
 else     if (extensions.length == 1) {
      serviceToUse=extensions[0].getInstance();
    }
    if (serviceToUse == null) {
      serviceToUse=statisticsService;
    }
    runWithDelay(serviceToUse);
  }
}
