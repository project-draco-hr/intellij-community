{
  VcsLogFilterCollection filters=logUi.getFilterUi().getFilters();
  Set<VirtualFile> roots=logUi.getDataPack().getLogProviders().keySet();
  final Set<VirtualFile> visibleRoots=getAllVisibleRoots(roots,filters.getRootFilter(),filters.getStructureFilter());
  return ContainerUtil.filter(log.getAllReferences(),new Condition<VcsRef>(){
    @Override public boolean value(    VcsRef ref){
      return visibleRoots.contains(ref.getRoot());
    }
  }
);
}
