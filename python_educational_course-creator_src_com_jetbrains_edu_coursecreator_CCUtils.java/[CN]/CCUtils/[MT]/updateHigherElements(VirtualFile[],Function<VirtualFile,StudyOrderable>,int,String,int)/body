{
  ArrayList<VirtualFile> dirsToRename=new ArrayList<VirtualFile>(Collections2.filter(Arrays.asList(dirs),new Predicate<VirtualFile>(){
    @Override public boolean apply(    VirtualFile dir){
      final StudyOrderable orderable=getStudyOrderable.fun(dir);
      if (orderable == null) {
        return false;
      }
      int index=orderable.getIndex();
      return index > threshold;
    }
  }
));
  Collections.sort(dirsToRename,new Comparator<VirtualFile>(){
    @Override public int compare(    VirtualFile o1,    VirtualFile o2){
      StudyOrderable orderable1=getStudyOrderable.fun(o1);
      StudyOrderable orderable2=getStudyOrderable.fun(o2);
      return (-delta) * EduUtils.INDEX_COMPARATOR.compare(orderable1,orderable2);
    }
  }
);
  for (  final VirtualFile dir : dirsToRename) {
    final StudyOrderable orderable=getStudyOrderable.fun(dir);
    final int newIndex=orderable.getIndex() + delta;
    orderable.setIndex(newIndex);
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        try {
          dir.rename(this,prefix + newIndex);
        }
 catch (        IOException e) {
          LOG.error(e);
        }
      }
    }
);
  }
}
