{
  ArrayList<VirtualFile> dirsToRename=new ArrayList<VirtualFile>(Collections2.filter(Arrays.asList(dirs),new Predicate<VirtualFile>(){
    @Override public boolean apply(    VirtualFile dir){
      final StudyItem item=getStudyItem.fun(dir);
      if (item == null) {
        return false;
      }
      int index=item.getIndex();
      return index > threshold;
    }
  }
));
  Collections.sort(dirsToRename,new Comparator<VirtualFile>(){
    @Override public int compare(    VirtualFile o1,    VirtualFile o2){
      StudyItem item1=getStudyItem.fun(o1);
      StudyItem item2=getStudyItem.fun(o2);
      return (-delta) * EduUtils.INDEX_COMPARATOR.compare(item1,item2);
    }
  }
);
  for (  final VirtualFile dir : dirsToRename) {
    final StudyItem item=getStudyItem.fun(dir);
    final int newIndex=item.getIndex() + delta;
    item.setIndex(newIndex);
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        try {
          dir.rename(this,prefix + newIndex);
        }
 catch (        IOException e) {
          LOG.error(e);
        }
      }
    }
);
  }
}
