{
  final RunResult<T> result=new RunResult<T>(this);
  final Application application=ApplicationManager.getApplication();
  if (application.isWriteAccessAllowed()) {
    result.run();
    return result;
  }
  boolean dispatchThread=application.isDispatchThread();
  if (!dispatchThread && application.isReadAccessAllowed()) {
    LOG.error("Must not start write action from within read action in the other thread - deadlock is coming");
  }
  application.invokeAndWait(new Runnable(){
    @Override public void run(){
      application.runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            result.run();
          }
 catch (          RuntimeException e) {
            result.setThrowable(e);
          }
        }
      }
);
    }
  }
,ModalityState.defaultModalityState());
  final Throwable throwable=result.getThrowable();
  if (throwable != null && !isSilentExecution()) {
    throw (RuntimeException)throwable;
  }
  return result;
}
