{
  myLogDataManager=logDataManager;
  myUi=ui;
  myLog=log;
  myFilterUi=new VcsLogClassicFilterUi(myUi,logDataManager,uiProperties,initialDataPack);
  myGraphTable=new VcsLogGraphTable(ui,logDataManager,initialDataPack);
  myBranchesPanel=new BranchesPanel(logDataManager,ui,initialDataPack.getRefs());
  setBranchesPanelVisible(uiProperties.isShowBranchesPanel());
  myDetailsPanel=new DetailsPanel(logDataManager,myGraphTable,ui.getColorManager(),initialDataPack);
  myChangesBrowser=new RepositoryChangesBrowser(project,null,Collections.<Change>emptyList(),null);
  myChangesBrowser.getViewer().setScrollPaneBorder(IdeBorderFactory.createBorder(SideBorder.TOP));
  myChangesBrowser.getDiffAction().registerCustomShortcutSet(myChangesBrowser.getDiffAction().getShortcutSet(),getGraphTable());
  myChangesBrowser.getEditSourceAction().registerCustomShortcutSet(CommonShortcuts.getEditSource(),getGraphTable());
  myChangesBrowser.getViewer().setEmptyText("");
  myChangesLoadingPane=new JBLoadingPanel(new BorderLayout(),project,ProgressWindow.DEFAULT_PROGRESS_DIALOG_POSTPONE_TIME_MILLIS);
  myChangesLoadingPane.add(myChangesBrowser);
  myGraphTable.getSelectionModel().addListSelectionListener(new CommitSelectionListener());
  myGraphTable.getSelectionModel().addListSelectionListener(myDetailsPanel);
  updateWhenDetailsAreLoaded();
  myTextFilter=myFilterUi.createTextFilter();
  myToolbar=createActionsToolbar();
  myDetailsSplitter=new OnePixelSplitter(true,0.7f);
  myDetailsSplitter.setFirstComponent(setupScrolledGraph());
  setupDetailsSplitter(uiProperties.isShowDetails());
  JComponent toolbars=new JPanel(new BorderLayout());
  toolbars.add(myToolbar,BorderLayout.NORTH);
  toolbars.add(myBranchesPanel.getMainComponent(),BorderLayout.CENTER);
  JComponent toolbarsAndTable=new JPanel(new BorderLayout());
  toolbarsAndTable.add(toolbars,BorderLayout.NORTH);
  toolbarsAndTable.add(myDetailsSplitter,BorderLayout.CENTER);
  myChangesBrowserSplitter=new OnePixelSplitter(false,0.7f);
  myChangesBrowserSplitter.setFirstComponent(toolbarsAndTable);
  myChangesBrowserSplitter.setSecondComponent(myChangesLoadingPane);
  setLayout(new BorderLayout());
  add(myChangesBrowserSplitter);
  Disposer.register(logDataManager,this);
  myGraphTable.resetDefaultFocusTraversalKeys();
  setFocusTraversalPolicyProvider(true);
  setFocusTraversalPolicy(new MyFocusPolicy());
}
