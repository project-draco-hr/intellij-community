{
  super(project);
  myBus=bus;
  if (project.isDefault()) {
    myFileProcessor=new CompoundShelfFileProcessor(null,PathManager.getConfigPath() + File.separator + SHELF_DIR_NAME);
  }
 else {
    if (project instanceof ProjectEx && ((ProjectEx)project).getStateStore().getStorageScheme() == StorageScheme.DIRECTORY_BASED) {
      VirtualFile dir=project.getBaseDir();
      String shelfBaseDirPath=dir == null ? "" : dir.getPath() + File.separator + Project.DIRECTORY_STORE_FOLDER;
      myFileProcessor=new CompoundShelfFileProcessor(shelfBaseDirPath);
    }
 else {
      myFileProcessor=new CompoundShelfFileProcessor();
    }
  }
}
