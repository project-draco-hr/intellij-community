{
  List<String> failedChangeLists=ContainerUtil.newArrayList();
  List<LocalChangeList> changeListsCopy=ChangeListManager.getInstance(myProject).getChangeListsCopy();
  for (  LocalChangeList list : changeListsCopy) {
    Collection<Change> changesForChangelist=ContainerUtil.intersection(list.getChanges(),changes);
    if (changesForChangelist.isEmpty())     continue;
    try {
      shelveChanges(changesForChangelist,list.getName(),true);
    }
 catch (    Exception e) {
      LOG.warn(e);
      failedChangeLists.add(list.getName());
    }
  }
  if (!failedChangeLists.isEmpty()) {
    VcsNotifier.getInstance(myProject).notifyError("Shelf Failed",String.format("Shelving changes for %s [%s] failed",StringUtil.pluralize("changelist",failedChangeLists.size()),StringUtil.join(failedChangeLists,",")));
  }
}
