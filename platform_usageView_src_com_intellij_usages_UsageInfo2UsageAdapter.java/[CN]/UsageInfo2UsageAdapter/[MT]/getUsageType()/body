{
  UsageType usageType=myUsageType;
  if (usageType == null) {
    usageType=UsageType.UNCLASSIFIED;
    PsiFile file=getPsiFile();
    if (file != null) {
      ChunkExtractor extractor=ChunkExtractor.getExtractor(file);
      Segment segment=getFirstSegment();
      if (segment != null) {
        Document document=PsiDocumentManager.getInstance(getProject()).getDocument(file);
        if (document != null) {
          SmartList<TextChunk> chunks=new SmartList<TextChunk>();
          extractor.createTextChunks(this,document.getCharsSequence(),segment.getStartOffset(),segment.getEndOffset(),false,chunks);
          for (          TextChunk chunk : chunks) {
            UsageType chunkUsageType=chunk.getType();
            if (chunkUsageType != null) {
              usageType=chunkUsageType;
              break;
            }
          }
        }
      }
    }
    myUsageType=usageType;
  }
  return usageType;
}
