{
  if (file.getLanguage() != HTMLLanguage.INSTANCE)   return text;
  CopyPasteManager manager=CopyPasteManager.getInstance();
  if (manager.areDataFlavorsAvailable(ourHtmlDataFlavor,ourRtfDataFlavor)) {
    Transferable content=manager.getContents();
    if (content != null && !content.isDataFlavorSupported(CaretStateTransferableData.FLAVOR)) {
      try {
        final String data=content.isDataFlavorSupported(ourHtmlDataFlavor) ? (String)content.getTransferData(ourHtmlDataFlavor) : convertFromRtfStream((InputStream)content.getTransferData(ourRtfDataFlavor));
        if (!StringUtil.isEmpty(data))         return data;
      }
 catch (      UnsupportedFlavorException e) {
        LOG.error(e);
      }
catch (      IOException e) {
        LOG.error(e);
      }
    }
  }
  return text;
}
