{
  SuspendManager suspendManager=getProcess().getSuspendManager();
  SuspendContextImpl context=suspendManager.getPausedContext();
  if (suspendContext != null && suspendContext.getSuspendPolicy() == EventRequest.SUSPEND_EVENT_THREAD && isSteppingThrough(suspendContext.getThread())) {
    ThreadReferenceProxyImpl thread=suspendContext.getThread();
    if (context == null || !Comparing.equal(context.getThread(),thread)) {
      context=((SuspendManagerImpl)suspendManager).createDummyContext(suspendContext.getSuspendPolicy());
      context.setThread(thread.getThreadReference());
    }
  }
  final SuspendContextImpl currentContext=context;
  DebuggerInvocationUtil.invokeLater(getProject(),new Runnable(){
    @Override public void run(){
      if (currentContext != null) {
        getContextManager().setState(DebuggerContextUtil.createDebuggerContext(DebuggerSession.this,currentContext),State.PAUSED,Event.CONTEXT,null);
      }
 else {
        getContextManager().setState(SESSION_EMPTY_CONTEXT,State.RUNNING,Event.CONTEXT,null);
      }
    }
  }
);
}
