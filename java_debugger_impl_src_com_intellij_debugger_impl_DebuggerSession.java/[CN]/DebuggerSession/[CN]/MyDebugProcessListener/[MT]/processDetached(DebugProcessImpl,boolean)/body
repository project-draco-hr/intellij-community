{
  if (!closedByUser) {
    ProcessHandler processHandler=debugProcess.getProcessHandler();
    if (processHandler != null) {
      final RemoteConnection connection=getProcess().getConnection();
      final String addressDisplayName=DebuggerBundle.getAddressDisplayName(connection);
      final String transportName=DebuggerBundle.getTransportName(connection);
      processHandler.notifyTextAvailable(DebuggerBundle.message("status.disconnected",addressDisplayName,transportName) + "\n",ProcessOutputTypes.SYSTEM);
    }
  }
  DebuggerInvocationUtil.invokeLater(getProject(),new Runnable(){
    @Override public void run(){
      final RemoteConnection connection=getProcess().getConnection();
      final String addressDisplayName=DebuggerBundle.getAddressDisplayName(connection);
      final String transportName=DebuggerBundle.getTransportName(connection);
      getContextManager().setState(SESSION_EMPTY_CONTEXT,STATE_STOPPED,EVENT_DETACHED,DebuggerBundle.message("status.disconnected",addressDisplayName,transportName));
    }
  }
);
  mySteppingThroughThreads.clear();
}
