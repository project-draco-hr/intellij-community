{
  if (fromType == toType)   return true;
  final boolean fromIsPrimitive=isPrimitiveAndNotNull(fromType);
  final boolean toIsPrimitive=isPrimitiveAndNotNull(toType);
  if (fromIsPrimitive || toIsPrimitive) {
    if (isVoidType(fromType) || isVoidType(toType))     return false;
    final int fromTypeRank=getTypeRank(fromType);
    final int toTypeRank=getTypeRank(toType);
    if (!toIsPrimitive) {
      if (fromTypeRank == toTypeRank)       return true;
      if (toType instanceof PsiIntersectionType) {
        for (        PsiType type : ((PsiIntersectionType)toType).getConjuncts()) {
          if (!areTypesConvertible(fromType,type))           return false;
        }
        return true;
      }
      if (!(toType instanceof PsiClassType))       return false;
      PsiClass toClass=((PsiClassType)toType).resolve();
      if (toClass == null || toClass instanceof PsiTypeParameter)       return false;
      PsiClassType boxedType=((PsiPrimitiveType)fromType).getBoxedType(toClass.getManager(),toType.getResolveScope());
      return boxedType != null && areTypesConvertible(boxedType,toType);
    }
    if (!fromIsPrimitive) {
      if ((fromTypeRank == SHORT_RANK || fromTypeRank == BYTE_RANK) && toTypeRank == CHAR_RANK)       return false;
      if (fromType instanceof PsiClassType) {
        if (languageLevel == null) {
          languageLevel=((PsiClassType)fromType).getLanguageLevel();
        }
        if (languageLevel.isAtLeast(LanguageLevel.JDK_1_7)) {
          final PsiClassType classType=(PsiClassType)fromType;
          final PsiClass psiClass=classType.resolve();
          if (psiClass == null)           return false;
          final PsiClassType boxedType=((PsiPrimitiveType)toType).getBoxedType(psiClass.getManager(),psiClass.getResolveScope());
          if (boxedType != null && isNarrowingReferenceConversionAllowed(fromType,boxedType)) {
            return true;
          }
        }
      }
      return fromTypeRank == toTypeRank || fromTypeRank <= MAX_NUMERIC_RANK && toTypeRank <= MAX_NUMERIC_RANK && fromTypeRank < toTypeRank;
    }
    return fromTypeRank == toTypeRank || fromTypeRank <= MAX_NUMERIC_RANK && toTypeRank <= MAX_NUMERIC_RANK;
  }
  if (isAssignable(toType,fromType))   return true;
  if (isNullType(fromType) || isNullType(toType))   return true;
  return isNarrowingReferenceConversionAllowed(fromType,toType);
}
