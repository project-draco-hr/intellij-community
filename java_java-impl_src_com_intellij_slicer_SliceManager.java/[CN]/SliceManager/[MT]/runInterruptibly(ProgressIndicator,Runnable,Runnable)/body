{
  Disposable disposable=addPsiListener(progress);
  try {
    progress.checkCanceled();
    ProgressManager.getInstance().executeProcessUnderProgress(runnable,progress);
  }
 catch (  ProcessCanceledException e) {
    progress.cancel();
    onCancel.run();
    throw e;
  }
 finally {
    Disposer.dispose(disposable);
  }
}
