{
  final Project project=context.getProject();
  final VirtualFile file=context.getVirtualFile();
  final Module module;
  final Facet facet;
  if (file instanceof WrappingVirtualFile) {
    final Object o=((WrappingVirtualFile)file).getWrappedObject(project);
    facet=o instanceof Facet ? (Facet)o : null;
    module=facet == null ? null : facet.getModule();
  }
 else {
    Module moduleByIml=file.getFileType().equals(StdFileTypes.IDEA_MODULE) ? findModuleByModuleFile(project,file) : null;
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    module=moduleByIml != null ? moduleByIml : fileIndex.getModuleForFile(file);
    facet=fileIndex.isInSourceContent(file) ? null : findFacet(project,file);
  }
  if (module != null || facet != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      @Override public void run(){
        if (facet != null) {
          ModulesConfigurator.showFacetSettingsDialog(facet,null);
        }
 else {
          ProjectSettingsService.getInstance(project).openModuleSettings(module);
        }
      }
    }
);
    return;
  }
  final OrderEntry orderEntry=LibraryUtil.findLibraryEntry(file,project);
  if (orderEntry != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      @Override public void run(){
        ProjectSettingsService.getInstance(project).openLibraryOrSdkSettings(orderEntry);
      }
    }
);
  }
}
