{
  if (virtualFile instanceof VirtualFileWindow) {
    virtualFile=((VirtualFileWindow)virtualFile).getDelegate();
  }
  final String relativePath=getRelativePath(virtualFile,fileIndex,true,projectBaseDir);
  if (relativePath == null) {
    LOG.error("vFile: " + virtualFile + "; projectBaseDir: "+ projectBaseDir+ "; content File: "+ fileIndex.getContentRootForFile(virtualFile));
  }
  if (StringUtil.isEmptyOrSpaces(relativePath) && !virtualFile.equals(projectBaseDir)) {
    return false;
  }
  return myFilePattern.matcher(relativePath).matches();
}
