{
  if (!runInEdt) {
    if (returnOnTimeout) {
      final Semaphore semaphore=new Semaphore();
      semaphore.down();
      new Thread(new Runnable(){
        @Override public void run(){
          runnable.run();
          semaphore.up();
        }
      }
,"shutdown tracker invoker").start();
      semaphore.waitFor(1000);
    }
 else {
      runnable.run();
    }
    return;
  }
  if (returnOnTimeout) {
    final Semaphore semaphore=new Semaphore();
    semaphore.down();
    SwingUtilities.invokeLater(new Runnable(){
      @Override public void run(){
        runnable.run();
        semaphore.up();
      }
    }
);
    semaphore.waitFor(1000);
    return;
  }
  try {
    UIUtil.invokeAndWaitIfNeeded(runnable);
  }
 catch (  Exception e) {
    Logger.getInstance(ShutDownTracker.class).error(e);
  }
}
