{
  startOperation(file);
  File srcFile=getIOFile(file);
  File dstFile=new File(getIOFile(toDir),file.getName());
  final SvnVcs vcs=getVCS(toDir);
  final SvnVcs sourceVcs=getVCS(file);
  if (vcs == null) {
    return false;
  }
  FileDocumentManager.getInstance().saveAllDocuments();
  if (sourceVcs == null) {
    return createItem(toDir,file.getName(),file.isDirectory(),true);
  }
  if (isPendingAdd(vcs.getProject(),toDir)) {
    myMovedFiles.add(new MovedFileInfo(sourceVcs.getProject(),srcFile,dstFile));
    return true;
  }
 else {
    myFilesToRefresh.add(file.getParent());
    myFilesToRefresh.add(toDir);
    return doMove(sourceVcs,srcFile,dstFile);
  }
}
