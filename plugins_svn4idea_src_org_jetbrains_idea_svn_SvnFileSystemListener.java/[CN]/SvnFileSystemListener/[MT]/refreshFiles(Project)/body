{
  final List<VirtualFile> toRefreshFiles=new ArrayList<>();
  final List<VirtualFile> toRefreshDirs=new ArrayList<>();
  for (  VirtualFile file : myFilesToRefresh) {
    if (file == null)     continue;
    if (file.isDirectory()) {
      toRefreshDirs.add(file);
    }
 else {
      toRefreshFiles.add(file);
    }
  }
  filterOutInvalid(myFilesToRefresh);
  RefreshQueue.getInstance().refresh(true,true,new Runnable(){
    public void run(){
      if (project.isDisposed())       return;
      filterOutInvalid(toRefreshFiles);
      filterOutInvalid(toRefreshDirs);
      final VcsDirtyScopeManager vcsDirtyScopeManager=VcsDirtyScopeManager.getInstance(project);
      vcsDirtyScopeManager.filesDirty(toRefreshFiles,toRefreshDirs);
    }
  }
,myFilesToRefresh);
  myFilesToRefresh.clear();
}
