{
  long srcTime=src.lastModified();
  try {
    final boolean isUndo=isUndo(vcs);
    final String list=isUndo ? null : SvnChangelistListener.getCurrentMapping(vcs,src);
    WorkingCopyFormat format=vcs.getWorkingCopyFormat(src);
    final boolean is17OrLater=WorkingCopyFormat.ONE_DOT_EIGHT.equals(format) || WorkingCopyFormat.ONE_DOT_SEVEN.equals(format);
    if (is17OrLater) {
      SVNStatus srcStatus=getFileStatus(vcs,src);
      final File toDir=dst.getParentFile();
      SVNStatus dstStatus=getFileStatus(vcs,toDir);
      final boolean srcUnversioned=srcStatus == null || SvnVcs.svnStatusIsUnversioned(srcStatus);
      if (srcUnversioned && (dstStatus == null || SvnVcs.svnStatusIsUnversioned(dstStatus))) {
        return false;
      }
      if (srcUnversioned) {
        SVNStatus dstWasStatus=getFileStatus(vcs,dst);
        if (dstWasStatus == null || SvnVcs.svnStatusIsUnversioned(dstWasStatus)) {
          return false;
        }
      }
      if (for17move(vcs,src,dst,isUndo,srcStatus))       return false;
    }
 else {
      if (for16move(vcs,src,dst,isUndo))       return false;
    }
    if (!isUndo && list != null) {
      SvnChangelistListener.putUnderList(vcs.getProject(),list,dst);
    }
    dst.setLastModified(srcTime);
  }
 catch (  SVNException e) {
    addToMoveExceptions(vcs.getProject(),e);
    return false;
  }
  return true;
}
