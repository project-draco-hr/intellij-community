{
  return new Runnable(){
    @Override public void run(){
      for (      VirtualFile file : filesToProcess) {
        final File ioFile=new File(file.getPath());
        try {
          final File copyFrom=copyFromMap.get(file);
          if (copyFrom != null) {
            try {
              new ActionWithTempFile(ioFile){
                protected void executeInternal() throws VcsException {
                  try {
                    new RepeatSvnActionThroughBusy(){
                      @Override protected void executeImpl() throws SVNException {
                        try {
                          vcs.getFactory(copyFrom).createCopyMoveClient().copy(copyFrom,ioFile,true,false);
                        }
 catch (                        VcsException e) {
                          wrapAndThrow(e);
                        }
                      }
                    }
.execute();
                  }
 catch (                  SVNException e) {
                    throw new VcsException(e);
                  }
                }
              }
.execute();
            }
 catch (            VcsException e) {
              exceptions.add(e);
            }
          }
 else {
            new RepeatSvnActionThroughBusy(){
              @Override protected void executeImpl() throws SVNException {
                try {
                  vcs.getFactory(ioFile).createAddClient().add(ioFile,null,false,false,true,null);
                }
 catch (                VcsException e) {
                  wrapAndThrow(e);
                }
              }
            }
.execute();
          }
          VcsDirtyScopeManager.getInstance(project).fileDirty(file);
        }
 catch (        SVNException e) {
          exceptions.add(new VcsException(e));
        }
      }
    }
  }
;
}
