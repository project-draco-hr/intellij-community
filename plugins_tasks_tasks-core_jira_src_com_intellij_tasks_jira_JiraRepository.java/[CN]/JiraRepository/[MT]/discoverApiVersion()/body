{
  if (LEGACY_API_ONLY) {
    LOG.info("Intentionally using only legacy JIRA API");
    return createLegacyApi();
  }
  String responseBody;
  GetMethod method=new GetMethod(getRestUrl("serverInfo"));
  try {
    responseBody=executeMethod(method);
  }
 catch (  Exception e) {
    StatusLine status=method.getStatusLine();
    if (status != null && status.getStatusCode() == HttpStatus.SC_NOT_FOUND) {
      return createLegacyApi();
    }
 else {
      throw e;
    }
  }
  JsonObject serverInfo=GSON.fromJson(responseBody,JsonObject.class);
  myJiraVersion=serverInfo.get("version").getAsString();
  LOG.info("JIRA version (from serverInfo): " + myJiraVersion);
  if (isOnDemand()) {
    LOG.info("Connecting to JIRA on-Demand. Cookie authentication is enabled unless 'tasks.jira.basic.auth.only' VM flag is used.");
  }
  JiraRestApi restApi=JiraRestApi.fromJiraVersion(myJiraVersion,this);
  if (restApi == null) {
    throw new Exception(TaskBundle.message("jira.failure.no.REST"));
  }
  return restApi;
}
