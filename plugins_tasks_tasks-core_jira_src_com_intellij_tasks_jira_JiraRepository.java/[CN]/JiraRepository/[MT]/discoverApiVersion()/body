{
  if (LEGACY_API_ONLY) {
    LOG.info("Intentionally using only legacy JIRA API");
    return new JiraSoapApi(this);
  }
  String responseBody;
  GetMethod method=new GetMethod(getRestUrl("serverInfo"));
  try {
    responseBody=executeMethod(method);
  }
 catch (  Exception e) {
    StatusLine status=method.getStatusLine();
    if (status != null && status.getStatusCode() == HttpStatus.SC_NOT_FOUND) {
      return new JiraSoapApi(this);
    }
 else {
      throw e;
    }
  }
  JsonObject object=GSON.fromJson(responseBody,JsonObject.class);
  JiraRestApi restApi=JiraRestApi.fromJiraVersion(object.get("version").getAsString(),this);
  if (restApi == null) {
    throw new Exception(TaskBundle.message("jira.failure.no.REST"));
  }
  return restApi;
}
