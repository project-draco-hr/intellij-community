{
  ensureApiVersionDiscovered();
  String resultQuery=StringUtil.notNullize(query);
  if (isJqlSupported()) {
    if (StringUtil.isNotEmpty(mySearchQuery) && StringUtil.isNotEmpty(query)) {
      resultQuery=String.format("summary ~ '%s' and ",query) + mySearchQuery;
    }
 else     if (StringUtil.isNotEmpty(query)) {
      resultQuery=String.format("summary ~ '%s'",query);
    }
 else {
      resultQuery=mySearchQuery;
    }
  }
  List<Task> tasksFound=myApiVersion.findTasks(resultQuery,max);
  if (query != null && JIRA_ID_PATTERN.matcher(query.trim()).matches()) {
    Task task=findTask(query);
    if (task != null) {
      tasksFound=ContainerUtil.concat(true,tasksFound,task);
    }
  }
  return ArrayUtil.toObjectArray(tasksFound,Task.class);
}
