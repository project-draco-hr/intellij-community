{
  if (aClass == null)   return null;
  final Project project=aClass.getProject();
  RunnerAndConfigurationSettings settings=RunManagerEx.getInstanceEx(project).createConfiguration("",getConfigurationFactory());
  final GroovyScriptRunConfiguration configuration=(GroovyScriptRunConfiguration)settings.getConfiguration();
  final PsiFile file=aClass.getContainingFile().getOriginalFile();
  final PsiDirectory dir=file.getContainingDirectory();
  if (dir != null) {
    configuration.setWorkDir(dir.getVirtualFile().getPath());
  }
  final VirtualFile vFile=file.getVirtualFile();
  if (vFile == null)   return null;
  String path=ScriptFileUtil.getScriptFilePath(vFile);
  configuration.setScriptPath(path);
  RunConfigurationModule module=configuration.getConfigurationModule();
  String name=GroovyRunnerUtil.getConfigurationName(aClass,module);
  configuration.setName(StringUtil.isEmpty(name) ? vFile.getName() : name);
  configuration.setModule(JavaExecutionUtil.findModule(aClass));
  return settings;
}
