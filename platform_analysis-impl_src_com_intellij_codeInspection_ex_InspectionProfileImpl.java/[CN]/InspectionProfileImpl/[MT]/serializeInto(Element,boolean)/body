{
  element.setAttribute(VERSION_TAG,VALID_VERSION);
  super.serializeInto(element,preserveCompatibility);
synchronized (myLock) {
    if (!myInitialized) {
      for (      Element el : myInspectionsSettings.values()) {
        element.addContent(el.clone());
      }
      return;
    }
  }
  Map<String,Boolean> diffMap=getDisplayLevelMap();
  if (diffMap != null) {
    diffMap=new TreeMap<>(diffMap);
    for (    String toolName : myInspectionsSettings.keySet()) {
      diffMap.put(toolName,false);
    }
    for (    String toolName : diffMap.keySet()) {
      if (!myLockedProfile && diffMap.get(toolName).booleanValue()) {
        markSettingsMerged(toolName,element);
        continue;
      }
      Element toolElement=myInspectionsSettings.get(toolName);
      if (toolElement == null) {
        ToolsImpl toolList=myTools.get(toolName);
        LOG.assertTrue(toolList != null);
        Element inspectionElement=new Element(INSPECTION_TOOL_TAG);
        inspectionElement.setAttribute(CLASS_TAG,toolName);
        try {
          toolList.writeExternal(inspectionElement);
        }
 catch (        WriteExternalException e) {
          LOG.error(e);
          continue;
        }
        if (!areSettingsMerged(toolName,inspectionElement)) {
          element.addContent(inspectionElement);
        }
      }
 else {
        element.addContent(toolElement.clone());
      }
    }
  }
}
