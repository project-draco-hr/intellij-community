{
  myWasShown=true;
  if (ApplicationManager.getApplication().isHeadlessEnvironment())   return;
  if (myParentWindow == null)   return;
  if (myPopup != null) {
    myPopup.close(DialogWrapper.CANCEL_EXIT_CODE);
  }
  myPopup=myParentWindow.isShowing() ? new MyDialogWrapper(myParentWindow,myProgressWindow.myShouldShowCancel) : new MyDialogWrapper(myProgressWindow.myProject,myProgressWindow.myShouldShowCancel);
  myPopup.setUndecorated(true);
  if (SystemInfo.isAppleJvm) {
    myPopup.setTitle(myProgressWindow.getTitle());
  }
  if (myPopup.getPeer() instanceof DialogWrapperPeerImpl) {
    ((DialogWrapperPeerImpl)myPopup.getPeer()).setAutoRequestFocus(false);
  }
  myPopup.pack();
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      if (myPopup != null) {
        if (myPopup.getPeer() instanceof FocusTrackbackProvider) {
          final FocusTrackback focusTrackback=((FocusTrackbackProvider)myPopup.getPeer()).getFocusTrackback();
          if (focusTrackback != null) {
            focusTrackback.consume();
          }
        }
        myProgressWindow.getFocusManager().requestFocus(myCancelButton).doWhenDone(myRepaintRunnable);
      }
    }
  }
);
  myPopup.show();
}
