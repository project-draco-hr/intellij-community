{
  if (filter == null && forceMarkDirty) {
    addCompletelyMarkedDirtyTarget(context,target);
  }
  for (  BuildRootDescriptor rd : context.getProjectDescriptor().getBuildRootIndex().getTargetRoots(target,context)) {
    if (!rd.getRootFile().exists() || (rd instanceof JavaSourceRootDescriptor && ((JavaSourceRootDescriptor)rd).isTemp)) {
      continue;
    }
    if (filter == null) {
      context.getProjectDescriptor().fsState.clearRecompile(rd);
    }
    final FSCache fsCache=rd.canUseFileCache() ? context.getProjectDescriptor().getFSCache() : FSCache.NO_CACHE;
    traverseRecursively(context,rd,round,rd.getRootFile(),timestamps,forceMarkDirty,currentFiles,filter,fsCache);
  }
}
