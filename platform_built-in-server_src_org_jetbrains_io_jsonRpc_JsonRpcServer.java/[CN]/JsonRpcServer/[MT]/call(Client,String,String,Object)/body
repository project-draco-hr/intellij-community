{
  int messageId=messageIdCounter.getAndIncrement();
  ByteBuf message=encodeMessage(messageId,domain,command,params);
  if (message == null) {
    return new AsyncResult.Rejected<T>();
  }
  AsyncResult<T> result=webSocketServer.send(client,messageId,message);
  return result == null ? new AsyncResult.Rejected<T>() : result;
}
