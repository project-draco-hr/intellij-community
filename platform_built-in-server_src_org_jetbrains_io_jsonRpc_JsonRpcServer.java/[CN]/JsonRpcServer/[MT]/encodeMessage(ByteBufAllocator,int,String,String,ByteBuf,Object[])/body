{
  ByteBuf buffer=byteBufAllocator.ioBuffer();
  boolean success=false;
  try {
    Object[] notNullParams=params == null ? ArrayUtil.EMPTY_OBJECT_ARRAY : params;
    buffer=doEncodeMessage(byteBufAllocator,buffer,messageId,domain,command,notNullParams,rawData);
    if (LOG.isDebugEnabled()) {
      LOG.debug("OUT " + domain + '.'+ command+ (notNullParams.length == 0 ? "" : " " + Arrays.toString(params))+ (rawData == null ? "" : " " + rawData.toString(CharsetToolkit.UTF8_CHARSET)));
    }
    success=true;
    return buffer;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
 finally {
    if (!success) {
      buffer.release();
    }
  }
}
