{
  StringBuilder sb=new StringBuilder();
  try {
    doEncodeMessage(sb,messageId,domain,command,params == null ? ArrayUtil.EMPTY_OBJECT_ARRAY : params,rawData);
    if (LOG.isDebugEnabled()) {
      LOG.debug("OUT " + sb.toString());
    }
    return ByteBufUtil.encodeString(byteBufAllocator,CharBuffer.wrap(sb),CharsetUtil.UTF_8);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
