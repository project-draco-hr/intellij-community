{
  VirtualFile file=position.getFile().getVirtualFile();
  if (file != null) {
    LineNumbersMapping mapping=file.getUserData(LineNumbersMapping.LINE_NUMBERS_MAPPING_KEY);
    if (mapping != null) {
      int line=mapping.sourceToBytecode(position.getLine() + 1);
      if (line > -1) {
        position=SourcePosition.createFromLine(position.getFile(),line - 1);
      }
    }
  }
  final SourcePosition finalPosition=position;
  return iterate(new Processor<List<Location>>(){
    @Override public List<Location> process(    PositionManager positionManager) throws NoDataException {
      return positionManager.locationsOfLine(type,finalPosition);
    }
  }
,Collections.<Location>emptyList());
}
