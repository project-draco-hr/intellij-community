{
  if (USE_HTTP_PROXY && PROXY_AUTHENTICATION) {
    String login=getSecure("proxy.login");
    if (login == null) {
      login="";
    }
    String ntlmUserPassword=login.replace('\\','/') + ":" + getPlainProxyPassword();
    provider.setCredentials(new AuthScope(PROXY_HOST,PROXY_PORT,AuthScope.ANY_REALM,AuthSchemes.NTLM),new NTCredentials(ntlmUserPassword));
    provider.setCredentials(new AuthScope(PROXY_HOST,PROXY_PORT),new UsernamePasswordCredentials(login,getPlainProxyPassword()));
  }
  return provider;
}
