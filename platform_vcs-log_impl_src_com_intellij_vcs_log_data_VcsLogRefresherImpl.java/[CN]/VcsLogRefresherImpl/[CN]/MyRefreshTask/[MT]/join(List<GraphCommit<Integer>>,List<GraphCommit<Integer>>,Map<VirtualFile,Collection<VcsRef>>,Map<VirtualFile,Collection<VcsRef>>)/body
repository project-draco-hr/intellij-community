{
  StopWatch sw=StopWatch.start("joining new commits");
  Function<VcsRef,Integer> ref2Int=new Function<VcsRef,Integer>(){
    @NotNull @Override public Integer fun(    @NotNull VcsRef ref){
      return myHashMap.getCommitIndex(ref.getCommitHash());
    }
  }
;
  Collection<Integer> prevRefIndices=ContainerUtil.map(ContainerUtil.concat(previousRefs.values()),ref2Int);
  Collection<Integer> newRefIndices=ContainerUtil.map(ContainerUtil.concat(newRefs.values()),ref2Int);
  try {
    List<GraphCommit<Integer>> commits=new VcsLogJoiner<Integer,GraphCommit<Integer>>().addCommits(fullLog,prevRefIndices,recentCommits,newRefIndices).first;
    sw.report();
    return commits;
  }
 catch (  IllegalStateException e) {
    LOG.error(e);
    return null;
  }
}
