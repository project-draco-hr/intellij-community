{
  Map<VirtualFile,VcsLogProvider> providers=getProviders(roots);
  Map<VirtualFile,Collection<VcsRef>> refs=loadRefsFromVcs(providers);
  Map<VirtualFile,VcsLogProvider.Requirements> requirements=prepareRequirements(roots,commitCount,prevRefs,refs);
  Map<VirtualFile,List<? extends TimedVcsCommit>> commits=loadRecentCommitsFromVcs(providers,requirements,myUserRegistry,myTopCommitsDetailsCache);
  for (  VirtualFile root : roots) {
    myLoadedInfos.put(root,new LogAndRefs(refs.get(root),commits.get(root)));
  }
}
