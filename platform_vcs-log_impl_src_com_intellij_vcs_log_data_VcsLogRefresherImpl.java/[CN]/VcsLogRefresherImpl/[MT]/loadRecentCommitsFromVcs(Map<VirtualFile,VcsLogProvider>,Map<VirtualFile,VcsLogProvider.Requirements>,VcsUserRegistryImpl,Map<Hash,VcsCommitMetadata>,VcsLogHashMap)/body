{
  final StopWatch sw=StopWatch.start("loading commits");
  final Map<VirtualFile,List<? extends GraphCommit<Integer>>> commits=ContainerUtil.newHashMap();
  new ProviderIterator(){
    @Override public void each(    @NotNull VirtualFile root,    @NotNull VcsLogProvider provider) throws VcsException {
      List<? extends VcsCommitMetadata> metadatas=provider.readFirstBlock(root,requirements.get(root));
      storeUsersAndDetails(metadatas,userRegistry,topCommitsDetailsCache);
      commits.put(root,compactCommits(metadatas,hashMap));
      sw.rootCompleted(root);
    }
  }
.iterate(providers);
  userRegistry.flush();
  sw.report();
  return commits;
}
