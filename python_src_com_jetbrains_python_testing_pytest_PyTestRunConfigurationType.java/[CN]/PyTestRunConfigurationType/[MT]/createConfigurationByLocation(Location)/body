{
  PsiFileSystemItem file=location.getPsiElement().getContainingFile();
  if (file == null)   return null;
  String path=file.getVirtualFile().getPath();
  final RunnerAndConfigurationSettings result=RunManager.getInstance(location.getProject()).createRunConfiguration(file.getName(),myPyTestConfigurationFactory);
  PyTestRunConfiguration configuration=(PyTestRunConfiguration)result.getConfiguration();
  configuration.setUseModuleSdk(true);
  configuration.setModule(ModuleUtil.findModuleForPsiElement(location.getPsiElement()));
  configuration.setTestToRun(path);
  PyFunction pyFunction=findTestFunction(location);
  if (pyFunction != null) {
    String name=pyFunction.getName();
    configuration.setKeywords(name);
    configuration.setName(name + " in " + configuration.getName());
  }
  return result;
}
