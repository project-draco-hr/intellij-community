{
  List<GraphElement> visibleElementsInNextRow=getSortedVisibleElementsInRow(visibleRowIndex + 1);
  final Map<GraphElement,Integer> toPosition=new HashMap<GraphElement,Integer>();
  for (int position=0; position < visibleElementsInNextRow.size(); position++)   toPosition.put(visibleElementsInNextRow.get(position),position);
  return new NullableFunction<GraphEdge,Integer>(){
    @Override @Nullable public Integer fun(    GraphEdge edge){
      Integer position=toPosition.get(edge);
      if (position == null) {
        Integer downNodeIndex=edge.getDownNodeIndex();
        if (downNodeIndex != null)         position=toPosition.get(myLinearGraph.getGraphNode(downNodeIndex));
      }
      return position;
    }
  }
;
}
