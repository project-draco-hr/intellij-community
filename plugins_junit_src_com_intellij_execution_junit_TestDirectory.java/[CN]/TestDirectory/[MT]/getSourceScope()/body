{
  final String dirName=getConfiguration().getPersistentData().getDirName();
  final VirtualFile file=LocalFileSystem.getInstance().findFileByPath(FileUtil.toSystemIndependentName(dirName));
  final GlobalSearchScope globalSearchScope=file == null ? GlobalSearchScope.EMPTY_SCOPE : GlobalSearchScopesCore.directoryScope(getConfiguration().getProject(),file,true);
  return new SourceScope(){
    @Override public GlobalSearchScope getGlobalSearchScope(){
      return globalSearchScope;
    }
    @Override public Project getProject(){
      return getConfiguration().getProject();
    }
    @Override public GlobalSearchScope getLibrariesScope(){
      final Module module=getConfiguration().getConfigurationModule().getModule();
      return module != null ? GlobalSearchScope.moduleWithLibrariesScope(module) : GlobalSearchScope.allScope(getConfiguration().getProject());
    }
    @Override public Module[] getModulesToCompile(){
      final Collection<Module> validModules=getConfiguration().getValidModules();
      return validModules.toArray(new Module[validModules.size()]);
    }
  }
;
}
