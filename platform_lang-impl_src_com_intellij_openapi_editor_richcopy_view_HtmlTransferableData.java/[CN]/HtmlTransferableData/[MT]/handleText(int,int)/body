{
  boolean formattedText=myForeground > 0 || myBackground > 0 || myFontFamily > 0 || myBold || myItalic;
  if (!formattedText) {
    escapeAndAdd(startOffset,endOffset);
    return;
  }
  StringBuilder styleBuffer=StringBuilderSpinAllocator.alloc();
  StringBuilder closeTagBuffer=StringBuilderSpinAllocator.alloc();
  try {
    if (myForeground > 0) {
      defineForeground(myForeground,styleBuffer,closeTagBuffer);
    }
    if (myBackground > 0) {
      defineBackground(myBackground,styleBuffer,closeTagBuffer);
    }
    if (myBold) {
      defineBold(styleBuffer,closeTagBuffer);
    }
    if (myItalic) {
      defineItalic(styleBuffer,closeTagBuffer);
    }
    if (myFontFamily > 0) {
      appendFontFamilyRule(styleBuffer,myFontFamily);
    }
    myResultBuffer.append("<span style=\"");
    myResultBuffer.append(styleBuffer);
    myResultBuffer.append("\">");
    escapeAndAdd(startOffset,endOffset);
    myResultBuffer.append("</span>");
    myResultBuffer.append(closeTagBuffer);
  }
  finally {
    StringBuilderSpinAllocator.dispose(styleBuffer);
    StringBuilderSpinAllocator.dispose(closeTagBuffer);
  }
}
