{
  if (info.name.equals(match.getName())) {
    String replacementString=match.getMatchImage();
    if (match.getAllSons().size() > 0 && !match.isScopeMatch()) {
      StringBuffer buf=new StringBuffer();
      MatchResult previous;
      MatchResult r=null;
      if (info.methodParameterContext) {
        handleMethodParameter(buf,info);
      }
 else {
        for (Iterator<MatchResult> i=match.getAllSons().iterator(); i.hasNext(); ) {
          previous=r;
          r=i.next();
          if (buf.length() > 0) {
            if (info.statementContext) {
              if (!(previous.getMatchRef().getElement() instanceof PsiComment) && buf.charAt(buf.length() - 1) != '}') {
                buf.append(';');
              }
              final PsiElement prevSibling=r.getMatch().getPrevSibling();
              if (prevSibling instanceof PsiWhiteSpace && prevSibling.getPrevSibling() == previous.getMatch()) {
                buf.append(prevSibling.getText());
              }
 else {
                buf.append('\n');
              }
            }
 else             if (info.parameterContext) {
              buf.append(',');
            }
 else             if (info.classContext) {
              buf.append('\n');
            }
 else {
              buf.append(' ');
            }
          }
          buf.append(r.getMatchImage());
          removeExtraSemicolon(info,r,buf);
        }
      }
      replacementString=buf.toString();
    }
 else {
      StringBuffer buf=new StringBuffer(replacementString);
      removeExtraSemicolon(info,match,buf);
      replacementString=buf.toString();
    }
    offset=insertSubstitution(result,offset,info,replacementString);
    offset=removeExtraSemicolon2(info,offset,result,match);
  }
  return offset;
}
