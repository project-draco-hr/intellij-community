{
  String pid=null;
  ArrayList<ClassDecl> classList=new ArrayList<ClassDecl>();
  Set<String> usedNames=new HashSet<String>();
  for (  StubElement<?> el : grFileStub.getChildrenStubs()) {
    if (el instanceof GrPackageDefinitionStub) {
      GrPackageDefinitionStub packageStub=(GrPackageDefinitionStub)el;
      String pkgName=packageStub.getPackageName();
      if (pkgName != null) {
        pid=id(pkgName,false,null);
      }
    }
    if (el instanceof GrTypeDefinitionStub) {
      ClassDecl classDecl=processClassDecl((GrTypeDefinitionStub)el,usedNames);
      if (classDecl != null) {
        classList.add(classDecl);
      }
    }
  }
  ArrayList<Import> importList=new ArrayList<Import>();
  for (  StubElement<?> el : grFileStub.getChildrenStubs()) {
    if (el instanceof GrImportStatementStub) {
      processImport((GrImportStatementStub)el,importList,usedNames);
    }
  }
  ClassDecl[] classes=classList.isEmpty() ? ClassDecl.EMPTY_ARRAY : classList.toArray(new ClassDecl[classList.size()]);
  Import[] imports=importList.isEmpty() ? Import.EMPTY_ARRAY : importList.toArray(new Import[importList.size()]);
  return new Unit(fileId,pid,IndexTree.GROOVY,imports,classes);
}
