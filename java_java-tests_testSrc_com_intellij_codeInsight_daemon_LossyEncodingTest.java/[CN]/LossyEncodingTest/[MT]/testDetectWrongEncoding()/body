{
  String threeNotoriousRussianLetters="\u0416\u041e\u041f";
  VirtualFile virtualFile=getVirtualFile(BASE_PATH + "/" + "Win1251"+ ".txt");
  virtualFile.setCharset(CharsetToolkit.UTF8_CHARSET);
  configureByExistingFile(virtualFile);
  final Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
  assertFalse(FileDocumentManager.getInstance().isDocumentUnsaved(document));
  assertEquals(CharsetToolkit.UTF8_CHARSET,virtualFile.getCharset());
  doHighlighting();
  List<HighlightInfo> infos=DaemonCodeAnalyzerEx.getInstanceEx(getProject()).getFileLevelHighlights(getProject(),getFile());
  HighlightInfo info=assertOneElement(infos);
  assertEquals("File was loaded in the wrong encoding: 'UTF-8'",info.getDescription());
}
