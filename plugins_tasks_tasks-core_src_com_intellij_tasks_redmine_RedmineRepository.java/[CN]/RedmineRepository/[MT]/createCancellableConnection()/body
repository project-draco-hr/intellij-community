{
  return new NewBaseRepositoryImpl.HttpTestConnection(new HttpGet()){
    @Override protected void test() throws Exception {
      URIBuilder uriBuilder=new URIBuilder(getRestApiUrl("users","current.json"));
      if (isUseApiKeyAuthentication()) {
        uriBuilder.addParameter("key",getAPIKey());
      }
      myCurrentRequest.setURI(uriBuilder.build());
      HttpClient client=getHttpClient();
      HttpResponse httpResponse=client.execute(myCurrentRequest);
      StatusLine statusLine=httpResponse.getStatusLine();
      if (statusLine != null && statusLine.getStatusCode() == HttpStatus.SC_NOT_FOUND) {
        myCurrentRequest=new HttpGet(getProjectsUrl(0,1));
        statusLine=client.execute(myCurrentRequest).getStatusLine();
        if (statusLine != null && statusLine.getStatusCode() == HttpStatus.SC_OK) {
          myCurrentRequest=new HttpGet(getIssuesUrl(0,1,true));
          statusLine=client.execute(myCurrentRequest).getStatusLine();
        }
      }
      if (statusLine != null && statusLine.getStatusCode() != HttpStatus.SC_OK) {
        throw RequestFailedException.forStatusCode(statusLine.getStatusCode(),statusLine.getReasonPhrase());
      }
    }
  }
;
}
