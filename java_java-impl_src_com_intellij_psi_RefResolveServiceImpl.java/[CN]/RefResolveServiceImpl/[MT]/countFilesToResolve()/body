{
  Set<VirtualFile> set;
  int queuedSize;
synchronized (filesToResolve) {
    queuedSize=filesToResolve.size();
    set=new THashSet<VirtualFile>(queuedSize);
    for (    VirtualFile file : filesToResolve) {
      if (fileIsInQueue.clear(getAbsId(file))) {
        set.add(file);
      }
    }
    filesToResolve.clear();
  }
  Set<VirtualFile> files=countAndMarkUnresolved(set,false);
  if (files.isEmpty())   return null;
  log("Started to resolve " + files.size() + " files (was queued "+ queuedSize+ ")");
  return files;
}
