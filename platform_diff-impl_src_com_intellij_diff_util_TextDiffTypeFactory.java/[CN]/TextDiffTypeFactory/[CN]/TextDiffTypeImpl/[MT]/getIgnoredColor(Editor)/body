{
  TextAttributes attributes=getAttributes(editor);
  Color color=attributes.getForegroundColor();
  if (color != null)   return color;
  if (editor instanceof EditorEx) {
    Color fg=attributes.getBackgroundColor();
    Color bg=((EditorEx)editor).getBackgroundColor();
    return ColorUtil.mix(fg,bg,MIDDLE_COLOR_FACTOR);
  }
 else {
    Color fg=attributes.getBackgroundColor();
    Color bg=EditorColorsManager.getInstance().getGlobalScheme().getDefaultBackground();
    return ColorUtil.mix(fg,bg,MIDDLE_COLOR_FACTOR);
  }
}
