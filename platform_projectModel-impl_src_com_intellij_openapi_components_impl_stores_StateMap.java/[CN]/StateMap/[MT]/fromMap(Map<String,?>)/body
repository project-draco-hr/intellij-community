{
  String[] names=ArrayUtil.toStringArray(map.keySet());
  Arrays.sort(names);
  AtomicReferenceArray<Object> states=new AtomicReferenceArray<Object>(names.length);
  for (int i=0, n=names.length; i < n; i++) {
    states.set(i,map.get(names[i]));
  }
  return new StateMap(names,states);
}
