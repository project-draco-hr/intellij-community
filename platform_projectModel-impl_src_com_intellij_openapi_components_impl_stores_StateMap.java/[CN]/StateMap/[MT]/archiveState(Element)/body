{
  BufferExposingByteArrayOutputStream byteOut=new BufferExposingByteArrayOutputStream();
  OutputStream out=null;
  try {
    try {
      out=new SnappyOutputStream(byteOut);
      JDOMUtil.writeParent(state,out,"\n");
    }
  finally {
      if (out != null) {
        out.close();
      }
    }
  }
 catch (  IOException e) {
    throw new StateStorageException(e);
  }
  return ArrayUtil.realloc(byteOut.getInternalBuffer(),byteOut.size());
}
