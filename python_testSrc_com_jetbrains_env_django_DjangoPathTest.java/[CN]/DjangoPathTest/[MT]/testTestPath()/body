{
  runPythonTest(new DjangoPathTestTask(){
    @Override public ConfigurationFactory getFactory(){
      return DjangoTestsConfigurationType.getInstance().getConfigurationFactories()[0];
    }
    @Override protected void configure(    AbstractPythonRunConfiguration config){
      String target="mysite.SimpleTest";
      try {
        final PyPackage django=((PyPackageManagerImpl)PyPackageManager.getInstance(config.getSdk())).findPackage("django");
        if (django != null) {
          final List<String> version=StringUtil.split(django.getVersion(),".");
          if (Integer.parseInt(version.get(1)) >= 6)           target="mysite.tests.SimpleTest";
        }
      }
 catch (      PyExternalProcessException ignored) {
      }
      ((DjangoTestsRunConfiguration)config).setTarget(target);
    }
    public void testing() throws Exception {
      waitForOutput(THE_END_OF_SYS_PATH);
      doTest(output(),getTestDataPath());
    }
  }
);
}
