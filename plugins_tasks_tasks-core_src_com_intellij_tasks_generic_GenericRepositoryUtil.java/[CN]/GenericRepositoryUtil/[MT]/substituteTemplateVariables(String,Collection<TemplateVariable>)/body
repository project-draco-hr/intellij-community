{
  Map<String,String> lookup=new HashMap<String,String>();
  for (  TemplateVariable v : variables) {
    lookup.put(v.getName(),v.getValue());
  }
  StringBuffer sb=new StringBuffer();
  Matcher m=PLACEHOLDER_PATTERN.matcher(s);
  while (m.find()) {
    String replacement=lookup.containsKey(m.group(1)) ? lookup.get(m.group(1)) : m.group(0);
    m.appendReplacement(sb,replacement);
  }
  return m.appendTail(sb).toString();
}
