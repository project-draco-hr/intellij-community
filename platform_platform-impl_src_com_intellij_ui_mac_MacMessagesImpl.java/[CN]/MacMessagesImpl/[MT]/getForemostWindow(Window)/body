{
  Window _window=null;
  Component focusOwner=IdeFocusManager.findInstance().getFocusOwner();
  if (focusOwner != null) {
    _window=SwingUtilities.getWindowAncestor(focusOwner);
  }
  if (_window == null && window != null) {
    focusOwner=window.getMostRecentFocusOwner();
    if (focusOwner != null) {
      _window=SwingUtilities.getWindowAncestor(focusOwner);
    }
  }
  if (_window == null) {
    focusOwner=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusedWindow();
    if (focusOwner != null) {
      _window=SwingUtilities.getWindowAncestor(focusOwner);
    }
  }
  if (_window == null) {
    _window=WindowManager.getInstance().findVisibleFrame();
  }
  if (_window != null) {
synchronized (_window.getTreeLock()) {
      try {
        isModalBlockedMethod.setAccessible(true);
        if ((Boolean)isModalBlockedMethod.invoke(_window,null)) {
          getModalBlockerMethod.setAccessible(true);
          _window=(Dialog)getModalBlockerMethod.invoke(_window,null);
        }
      }
 catch (      InvocationTargetException e) {
        LOG.error(e);
      }
catch (      IllegalAccessException e) {
        LOG.error(e);
      }
    }
  }
  return _window;
}
