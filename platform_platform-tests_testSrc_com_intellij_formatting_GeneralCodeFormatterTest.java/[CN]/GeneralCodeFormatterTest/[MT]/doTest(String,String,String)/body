{
  final TestFormattingModel model=new TestFormattingModel(initial);
  model.setRootBlock(new FormattingModelXmlReader(model).readTestBlock(formattingModelName));
  final CommonCodeStyleSettings.IndentOptions indentOptions=new CommonCodeStyleSettings.IndentOptions();
  indentOptions.CONTINUATION_INDENT_SIZE=8;
  indentOptions.INDENT_SIZE=4;
  indentOptions.LABEL_INDENT_SIZE=1;
  final CodeStyleSettings settings=new CodeStyleSettings(false);
  settings.RIGHT_MARGIN=myRightMargin;
  try {
    FormatterEx.getInstanceEx().format(model,settings,indentOptions,indentOptions,null);
  }
 catch (  IncorrectOperationException e) {
    fail();
  }
  assertEquals(expected,FormatterImpl.getText(model));
}
