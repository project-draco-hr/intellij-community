{
  MessageBusConnection connection=myProject.getMessageBus().connect();
  connection.subscribe(FileEditorManagerListener.Before.FILE_EDITOR_MANAGER,new MyEditorManagerBeforeListener());
  connection.subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new MyEditorManagerListener());
  StartupManager.getInstance(myProject).runWhenProjectIsInitialized(new DumbAwareRunnable(){
    @Override public void run(){
      if (myElement != null) {
        final List children=myElement.getChildren(HistoryEntry.TAG);
        myElement=null;
        for (        final Element e : (Iterable<Element>)children) {
          try {
            addEntry(new HistoryEntry(EditorHistoryManager.this.myProject,e));
          }
 catch (          InvalidDataException e1) {
          }
catch (          ProcessCanceledException e1) {
          }
catch (          Exception anyException) {
            LOG.error(anyException);
          }
        }
        trimToSize();
      }
    }
  }
);
}
