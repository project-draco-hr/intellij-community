{
  if (haveResultsPreview()) {
    final ModalityState state=ModalityState.current();
    if (state == ModalityState.NON_MODAL)     return;
    finishPreviousPreviewSearch();
    mySearchRescheduleOnCancellationsAlarm.cancelAllRequests();
    final DefaultTableModel model=new DefaultTableModel(){
      @Override public boolean isCellEditable(      int row,      int column){
        return false;
      }
    }
;
    model.addColumn("Usages");
    final FindModel modelClone=myModel.clone();
    applyTo(modelClone,false);
    ValidationInfo result=getValidationInfo(modelClone);
    final PsiDirectory psiDirectory=FindInProjectUtil.getPsiDirectory(modelClone,myProject);
    final ProgressIndicatorBase progressIndicatorWhenSearchStarted=new ProgressIndicatorBase();
    myResultsPreviewSearchProgress=progressIndicatorWhenSearchStarted;
    myResultsPreviewTable.setModel(model);
    if (result != null) {
      myResultsPreviewTable.getEmptyText().setText(UIBundle.message("message.nothingToShow"));
      return;
    }
    myResultsPreviewTable.getColumnModel().getColumn(0).setCellRenderer(new UsageTableCellRenderer());
    myResultsPreviewTable.getEmptyText().setText("Searching...");
    final AtomicInteger resultsCount=new AtomicInteger();
    ProgressIndicatorUtils.scheduleWithWriteActionPriority(myResultsPreviewSearchProgress,new ReadTask(){
      @Override public void computeInReadAction(      @NotNull ProgressIndicator indicator){
        final UsageViewPresentation presentation=FindInProjectUtil.setupViewPresentation(FindSettings.getInstance().isShowResultsInSeparateView(),modelClone);
        final boolean showPanelIfOnlyOneUsage=!FindSettings.getInstance().isSkipResultsWithOneUsage();
        final FindUsagesProcessPresentation processPresentation=FindInProjectUtil.setupProcessPresentation(myProject,showPanelIfOnlyOneUsage,presentation);
        FindInProjectUtil.findUsages(modelClone,psiDirectory,myProject,new Processor<UsageInfo>(){
          @Override public boolean process(          final UsageInfo info){
            final Usage usage=UsageInfo2UsageAdapter.CONVERTER.fun(info);
            usage.getPresentation().getIcon();
            ApplicationManager.getApplication().invokeLater(new Runnable(){
              @Override public void run(){
                model.addRow(new Object[]{usage});
                if (model.getRowCount() == 1)                 myResultsPreviewTable.setRowSelectionInterval(0,0);
              }
            }
,state);
            return resultsCount.incrementAndGet() < ShowUsagesAction.USAGES_PAGE_SIZE;
          }
        }
,processPresentation);
        if (resultsCount.get() == 0 && !progressIndicatorWhenSearchStarted.isCanceled()) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            @Override public void run(){
              if (progressIndicatorWhenSearchStarted == myResultsPreviewSearchProgress) {
                myResultsPreviewTable.getEmptyText().setText(UIBundle.message("message.nothingToShow"));
              }
            }
          }
,state);
        }
      }
      @Override public void onCanceled(      @NotNull ProgressIndicator indicator){
        if (isShowing() && progressIndicatorWhenSearchStarted == myResultsPreviewSearchProgress) {
          mySearchRescheduleOnCancellationsAlarm.cancelAllRequests();
          mySearchRescheduleOnCancellationsAlarm.addRequest(new Runnable(){
            @Override public void run(){
              findSettingsChanged();
            }
          }
,100);
        }
      }
    }
);
  }
}
