{
  myProject=project;
  EditorFactory.getInstance().getEventMulticaster().addDocumentListener(new DocumentAdapter(){
    @Override public void beforeDocumentChange(    DocumentEvent e){
      transformRangeMarkers(e);
    }
    @Override public void documentChanged(    DocumentEvent e){
      transformRangeMarkers(e);
    }
    private void transformRangeMarkers(    DocumentEvent e){
      VirtualFile file=fileDocumentManager.getFile(e.getDocument());
      if (file == null) {
        return;
      }
      WeakList<LazyMarker> lazyMarkers=myMarkers.get(file);
      if (lazyMarkers == null) {
        return;
      }
      List<LazyMarker> markers=lazyMarkers.toStrongList();
      List<LazyMarker> markersToRemove=null;
      for (      LazyMarker marker : markers) {
        if (file.equals(marker.getFile()) && marker.documentChanged(e.getDocument()) != null) {
          if (markersToRemove == null) {
            markersToRemove=new SmartList<LazyMarker>();
          }
          markersToRemove.add(marker);
        }
      }
      if (markersToRemove != null) {
        lazyMarkers.removeAll(markersToRemove);
      }
    }
  }
,project);
}
