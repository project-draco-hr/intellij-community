{
  final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
  try {
    task.consume(model);
    doWriteAction(new Runnable(){
      @Override public void run(){
        model.commit();
      }
    }
);
  }
 catch (  RuntimeException e) {
    model.dispose();
    throw e;
  }
catch (  Error e) {
    model.dispose();
    throw e;
  }
}
