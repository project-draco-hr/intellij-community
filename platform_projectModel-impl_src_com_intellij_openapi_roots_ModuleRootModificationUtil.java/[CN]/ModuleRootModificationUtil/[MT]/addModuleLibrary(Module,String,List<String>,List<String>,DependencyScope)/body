{
  final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
  final Library library=model.getModuleLibraryTable().createLibrary(libName);
  final Library.ModifiableModel libraryModel=library.getModifiableModel();
  for (  String root : classesRoots) {
    libraryModel.addRoot(root,OrderRootType.CLASSES);
  }
  for (  String root : sourceRoots) {
    libraryModel.addRoot(root,OrderRootType.SOURCES);
  }
  model.findLibraryOrderEntry(library).setScope(scope);
  doWriteAction(new Runnable(){
    @Override public void run(){
      libraryModel.commit();
      model.commit();
    }
  }
);
}
