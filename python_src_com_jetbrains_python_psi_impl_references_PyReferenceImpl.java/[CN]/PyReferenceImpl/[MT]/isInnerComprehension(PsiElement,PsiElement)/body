{
  final PyComprehensionElement definitionComprehension=PsiTreeUtil.getParentOfType(definition,PyComprehensionElement.class);
  if (definitionComprehension != null) {
    final boolean isAtLeast30=LanguageLevel.forElement(definitionComprehension).isAtLeast(LanguageLevel.PYTHON30);
    final boolean isListComprehension=definitionComprehension instanceof PyListCompExpression;
    if (!isListComprehension || isAtLeast30) {
      final PyComprehensionElement elementComprehension=PsiTreeUtil.getParentOfType(referenceElement,PyComprehensionElement.class);
      if (elementComprehension == null || !PsiTreeUtil.isAncestor(definitionComprehension,elementComprehension,false)) {
        return true;
      }
    }
  }
  return false;
}
