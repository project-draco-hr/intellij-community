{
  if (element instanceof PsiFileSystemItem) {
    PsiElement resolveResult=resolve();
    if (resolveResult instanceof PyImportedModule) {
      resolveResult=resolveResult.getNavigationElement();
    }
    if (element instanceof PsiDirectory && resolveResult instanceof PyFile && PyNames.INIT_DOT_PY.equals(((PyFile)resolveResult).getName())&& ((PyFile)resolveResult).getContainingDirectory() == element) {
      return true;
    }
    return resolveResult == element;
  }
  if (element instanceof PsiNamedElement) {
    final String elementName=((PsiNamedElement)element).getName();
    if ((Comparing.equal(myElement.getReferencedName(),elementName) || PyNames.INIT.equals(elementName)) && !haveQualifiers(element)) {
      if (isGlobal(element,elementName)) {
        element=transitiveResolve(element);
      }
      final ScopeOwner ourScopeOwner=ScopeUtil.getScopeOwner(getElement());
      final ScopeOwner theirScopeOwner=ScopeUtil.getScopeOwner(element);
      if (element instanceof PyParameter || element instanceof PyTargetExpression || element instanceof CythonVariable) {
        PsiElement ourContainer=PsiTreeUtil.getParentOfType(getElement(),ScopeOwner.class,PyComprehensionElement.class);
        PsiElement theirContainer=PsiTreeUtil.getParentOfType(element,ScopeOwner.class,PyComprehensionElement.class);
        if (ourContainer != null) {
          if (ourContainer == theirContainer) {
            return true;
          }
          if (PsiTreeUtil.isAncestor(theirContainer,ourContainer,true)) {
            if (ourScopeOwner != theirScopeOwner) {
              boolean shadowsName=false;
              ScopeOwner owner=ourScopeOwner;
              while (owner != theirScopeOwner && owner != null) {
                if (ControlFlowCache.getScope(owner).containsDeclaration(elementName)) {
                  shadowsName=true;
                  break;
                }
                owner=ScopeUtil.getScopeOwner(owner);
              }
              if (!shadowsName) {
                return true;
              }
            }
          }
        }
      }
      final PsiElement resolveResult=(isGlobal(getElement(),elementName)) ? transitiveResolve(getElement()) : resolve();
      if (resolveResult == element) {
        return true;
      }
      if (!haveQualifiers(element) && ourScopeOwner != null && theirScopeOwner != null) {
        final boolean ourIsGlobal=ControlFlowCache.getScope(ourScopeOwner).isGlobal(elementName);
        final boolean theirIsGlobal=ControlFlowCache.getScope(theirScopeOwner).isGlobal(elementName);
        final PsiFile ourFile=getElement().getContainingFile();
        final PsiFile theirFile=element.getContainingFile();
        if (ourIsGlobal && theirIsGlobal && ourFile == theirFile) {
          return true;
        }
        if (theirIsGlobal && ScopeUtil.getScopeOwner(resolveResult) == ourFile) {
          return true;
        }
      }
      return false;
    }
  }
  return false;
}
