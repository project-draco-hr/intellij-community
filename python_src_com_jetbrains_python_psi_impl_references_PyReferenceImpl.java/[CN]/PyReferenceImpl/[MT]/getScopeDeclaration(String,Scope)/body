{
  PsiElement element=scope.getNamedElement(name);
  if (element != null) {
    return new ScopeDeclaration(null,element);
  }
  element=scope.getImplicitElement(name);
  if (element != null) {
    return new ScopeDeclaration(null,element);
  }
  for (  NameDefiner definer : scope.getNameDefiners()) {
    element=definer.getElementNamed(name);
    if (element != null) {
      return new ScopeDeclaration(definer,element);
    }
 else     if (definer instanceof PyImportElement) {
      final PyImportElement importElement=(PyImportElement)definer;
      final PyQualifiedName importedQName=importElement.getImportedQName();
      if (importedQName != null && importedQName.getComponentCount() > 1 && name.equals(importedQName.getLastComponent()) && PyNames.INIT_DOT_PY.equals(importElement.getContainingFile().getName())) {
        final PsiElement packageElement=ResolveImportUtil.resolveImportElement(importElement,importedQName.removeLastComponent());
        if (PyUtil.turnDirIntoInit(packageElement) == importElement.getContainingFile()) {
          element=PyUtil.turnDirIntoInit(ResolveImportUtil.resolveImportElement(importElement));
          return new ScopeDeclaration(definer,element);
        }
      }
      final PyFromImportStatement fromImportStatement=PsiTreeUtil.getParentOfType(importElement,PyFromImportStatement.class);
      if (fromImportStatement != null && PyNames.INIT_DOT_PY.equals(importElement.getContainingFile().getName())) {
        final PyQualifiedName importSourceQName=fromImportStatement.getImportSourceQName();
        if (importSourceQName != null && importSourceQName.endsWith(name)) {
          final PsiElement source=PyUtil.turnInitIntoDir(fromImportStatement.resolveImportSource());
          if (source != null && source.getParent() == importElement.getContainingFile().getContainingDirectory()) {
            return new ScopeDeclaration(definer,source);
          }
        }
      }
      String definedName=importElement.getAsName();
      if (definedName == null) {
        if (importedQName != null && importedQName.getComponentCount() == 1) {
          definedName=importedQName.getComponents().get(0);
        }
      }
      if (name.equals(definedName)) {
        return new ScopeDeclaration(definer,null);
      }
    }
  }
  return null;
}
