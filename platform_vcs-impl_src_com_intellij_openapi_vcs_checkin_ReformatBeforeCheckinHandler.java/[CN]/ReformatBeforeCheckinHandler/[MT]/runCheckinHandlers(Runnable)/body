{
  final VcsConfiguration configuration=VcsConfiguration.getInstance(myProject);
  final Collection<VirtualFile> files=myPanel.getVirtualFiles();
  final Runnable performCheckoutAction=new Runnable(){
    @Override public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
      finishAction.run();
    }
  }
;
  if (reformat(configuration,true) && !DumbService.isDumb(myProject)) {
    new ReformatCodeProcessor(myProject,CheckinHandlerUtil.getPsiFiles(myProject,files),FormatterUtil.REFORMAT_BEFORE_COMMIT_COMMAND_NAME,performCheckoutAction,true).run();
  }
 else {
    performCheckoutAction.run();
  }
}
