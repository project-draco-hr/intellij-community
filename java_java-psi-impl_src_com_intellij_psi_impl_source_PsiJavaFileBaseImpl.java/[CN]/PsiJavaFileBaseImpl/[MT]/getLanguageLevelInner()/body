{
  if (myOriginalFile instanceof PsiJavaFile) {
    return ((PsiJavaFile)myOriginalFile).getLanguageLevel();
  }
  LanguageLevel forcedLanguageLevel=getUserData(PsiUtil.FILE_LANGUAGE_LEVEL_KEY);
  if (forcedLanguageLevel != null)   return forcedLanguageLevel;
  VirtualFile virtualFile=getVirtualFile();
  if (virtualFile == null)   virtualFile=getUserData(IndexingDataKeys.VIRTUAL_FILE);
  final Project project=getProject();
  if (virtualFile == null) {
    final PsiFile originalFile=getOriginalFile();
    if (originalFile instanceof PsiJavaFile && originalFile != this) {
      return ((PsiJavaFile)originalFile).getLanguageLevel();
    }
    return LanguageLevelProjectExtension.getInstance(project).getLanguageLevel();
  }
  return JavaPsiImplementationHelper.getInstance(project).getEffectiveLanguageLevel(virtualFile);
}
