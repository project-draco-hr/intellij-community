{
  Presentation presentation=e.getPresentation();
  if (ActionPlaces.PROJECT_VIEW_POPUP.equals(e.getPlace()) || ActionPlaces.COMMANDER_POPUP.equals(e.getPlace())) {
    presentation.setText(IdeBundle.message("action.delete.ellipsis"));
  }
 else {
    presentation.setText(IdeBundle.message("action.delete"));
  }
  if (e.getProject() == null) {
    presentation.setEnabled(false);
    return;
  }
  DataContext dataContext=e.getDataContext();
  DeleteProvider provider=getDeleteProvider(dataContext);
  if (e.getInputEvent() instanceof KeyEvent) {
    KeyEvent keyEvent=(KeyEvent)e.getInputEvent();
    Object component=PlatformDataKeys.CONTEXT_COMPONENT.getData(dataContext);
    if (component instanceof JTextComponent)     provider=null;
    if (keyEvent.getKeyCode() == KeyEvent.VK_BACK_SPACE) {
      if (component instanceof JComponent) {
        SpeedSearchSupply searchSupply=SpeedSearchSupply.getSupply((JComponent)component);
        if (searchSupply != null)         provider=null;
      }
      String activeSpeedSearchFilter=SpeedSearchSupply.SPEED_SEARCH_CURRENT_QUERY.getData(dataContext);
      if (!StringUtil.isEmpty(activeSpeedSearchFilter)) {
        provider=null;
      }
    }
  }
  if (provider instanceof TitledHandler) {
    presentation.setText(((TitledHandler)provider).getActionTitle());
  }
  boolean canDelete=provider != null && provider.canDeleteElement(dataContext);
  if (ActionPlaces.isPopupPlace(e.getPlace())) {
    presentation.setVisible(canDelete);
  }
 else {
    presentation.setEnabled(canDelete);
  }
}
