{
  final Set<String> languageIds=new HashSet<String>();
  for (  Language language : languages) {
    languageIds.add(language.getID());
  }
  final List<Token> result=new ArrayList<Token>();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      FileBasedIndex fileBasedIndex=FileBasedIndex.getInstance();
      Collection<TokenIndexKey> keys=fileBasedIndex.getAllKeys(TokenIndex.INDEX_ID,project);
      for (      TokenIndexKey key : keys) {
        if (intersect(key.getLanguages(),languageIds)) {
          List<List<Token>> list=fileBasedIndex.getValues(TokenIndex.INDEX_ID,key,(GlobalSearchScope)scope);
          for (          List<Token> tokens : list) {
            result.addAll(tokens);
          }
        }
      }
    }
  }
);
  return result;
}
