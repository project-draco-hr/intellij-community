{
  assertWritable();
  filePath=resolveShortWindowsName(filePath);
  ModuleEx module=getModuleByFilePath(filePath);
  if (module == null) {
    module=createModule(filePath);
    final ModuleEx newModule=module;
    initModule(module,filePath,new Runnable(){
      @Override public void run(){
        newModule.setOption(Module.ELEMENT_TYPE_KEY,moduleTypeId);
        if (options != null) {
          for (          Map.Entry<String,String> option : options.entrySet()) {
            newModule.setOption(createOptionKey(option.getKey()),option.getValue());
          }
        }
      }
    }
);
  }
  return module;
}
