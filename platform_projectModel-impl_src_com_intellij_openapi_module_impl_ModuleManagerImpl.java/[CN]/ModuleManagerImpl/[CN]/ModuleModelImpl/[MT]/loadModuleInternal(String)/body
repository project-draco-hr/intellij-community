{
  filePath=resolveShortWindowsName(filePath);
  final VirtualFile moduleFile=StandardFileSystems.local().findFileByPath(filePath);
  if (moduleFile == null || !moduleFile.exists()) {
    throw new FileNotFoundException(ProjectBundle.message("module.file.does.not.exist.error",filePath));
  }
  final String name=moduleFile.getName();
  if (name.endsWith(IML_EXTENSION)) {
    final String moduleName=name.substring(0,name.length() - 4);
    if (myModules.containsKey(moduleName)) {
      throw new ModuleWithNameAlreadyExists(ProjectBundle.message("module.already.exists.error",moduleName),moduleName);
    }
  }
  String path=moduleFile.getPath();
  ModuleEx module=getModuleByFilePath(path);
  if (module == null) {
    ApplicationManager.getApplication().invokeAndWait(new Runnable(){
      @Override public void run(){
        moduleFile.refresh(false,false);
      }
    }
,ModalityState.any());
    module=createAndLoadModule(path);
    initModule(module,path,null);
  }
  return module;
}
