{
  Project project=e.getProject();
  if (project == null)   return;
  Module[] modules=LangDataKeys.MODULE_CONTEXT_ARRAY.getData(e.getDataContext());
  if (modules == null) {
    PsiElement element=CommonDataKeys.PSI_FILE.getData(e.getDataContext());
    Module module=element != null ? ModuleUtilCore.findModuleForPsiElement(element) : null;
    if (module != null && ModuleManager.getInstance(project).getModules().length > 1) {
      MyModuleOrProjectScope dlg=new MyModuleOrProjectScope(module.getName());
      if (!dlg.showAndGet()) {
        return;
      }
      if (!dlg.useProjectScope()) {
        modules=new Module[]{module};
      }
    }
  }
  ModulesDependenciesPanel panel=new ModulesDependenciesPanel(project,modules);
  AnalysisScope scope=modules != null ? new AnalysisScope(modules) : new AnalysisScope(project);
  Content content=ContentFactory.SERVICE.getInstance().createContent(panel,scope.getDisplayName(),false);
  content.setDisposer(panel);
  panel.setContent(content);
  DependenciesAnalyzeManager.getInstance(project).addContent(content);
}
