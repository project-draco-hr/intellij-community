{
  Collection<URL> urls=ContainerUtil.newHashSet();
  String platformPrefix=System.getProperty(PlatformUtils.PLATFORM_PREFIX_KEY);
  if (platformPrefix != null) {
    URL resource=loader.getResource(META_INF + '/' + platformPrefix+ "Plugin.xml");
    if (resource != null) {
      urls.add(resource);
    }
  }
  try {
    Enumeration<URL> enumeration=loader.getResources(META_INF + '/' + PLUGIN_XML);
    while (enumeration.hasMoreElements()) {
      urls.add(enumeration.nextElement());
    }
  }
 catch (  IOException e) {
    getLogger().info(e);
    return;
  }
  int i=0;
  for (  URL url : urls) {
    IdeaPluginDescriptorImpl descriptor=loadDescriptorFromResource(url);
    if (descriptor != null && !result.contains(descriptor)) {
      descriptor.setUseCoreClassLoader(true);
      result.add(descriptor);
      if (progress != null && !SPECIAL_IDEA_PLUGIN.equals(descriptor.getName())) {
        progress.showProgress("Plugin loaded: " + descriptor.getName(),PLUGINS_PROGRESS_MAX_VALUE * (float)(++i) / urls.size());
      }
    }
  }
}
