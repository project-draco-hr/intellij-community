{
  VirtualFile virtualFile=myVirtualFile;
  if (virtualFile != null && !virtualFile.isValid()) {
    myVirtualFile=virtualFile=null;
  }
  if (virtualFile == null) {
    refresh();
    virtualFile=myVirtualFile;
  }
  detectFileType(virtualFile);
  return virtualFile;
}
