{
  final Set<IdeaPluginDescriptor> pluginsToEnable=new HashSet<IdeaPluginDescriptor>();
  final List<PluginNode> nodes=new ArrayList<PluginNode>();
  for (  PluginDownloader downloader : myUploadedPlugins) {
    if (!mySkippedPlugins.contains(downloader.getPluginId())) {
      final IdeaPluginDescriptor descriptor=PluginManager.getPlugin(PluginId.getId(downloader.getPluginId()));
      if (descriptor != null) {
        pluginsToEnable.add(descriptor);
      }
 else {
        final PluginNode pluginNode=PluginDownloader.createPluginNode(null,downloader);
        if (pluginNode != null) {
          nodes.add(pluginNode);
        }
      }
    }
  }
  final Runnable notifyRunnable=new Runnable(){
    @Override public void run(){
      PluginManagerMain.notifyPluginsWereInstalled(null,myProject);
    }
  }
;
  for (  IdeaPluginDescriptor pluginDescriptor : pluginsToEnable) {
    PluginManagerCore.enablePlugin(pluginDescriptor.getPluginId().getIdString());
  }
  if (!nodes.isEmpty()) {
    try {
      PluginManagerMain.downloadPlugins(nodes,myAllPlugins,notifyRunnable,null);
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
 else {
    if (!pluginsToEnable.isEmpty()) {
      notifyRunnable.run();
    }
  }
  super.doOKAction();
}
