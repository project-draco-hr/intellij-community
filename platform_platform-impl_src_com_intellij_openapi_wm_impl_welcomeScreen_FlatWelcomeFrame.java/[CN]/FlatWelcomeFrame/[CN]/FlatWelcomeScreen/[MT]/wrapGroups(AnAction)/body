{
  if (action instanceof ActionGroup && ((ActionGroup)action).isPopup()) {
    final Pair<JPanel,JBList> panel=createActionGroupPanel((ActionGroup)action,mySlidingPanel,new Runnable(){
      @Override public void run(){
        goBack();
      }
    }
);
    final Runnable onDone=new Runnable(){
      @Override public void run(){
        final JBList list=panel.second;
        ListScrollingUtil.ensureSelectionExists(list);
        final ListSelectionListener[] listeners=((DefaultListSelectionModel)list.getSelectionModel()).getListeners(ListSelectionListener.class);
        for (        ListSelectionListener listener : listeners) {
          listener.valueChanged(new ListSelectionEvent(list,list.getSelectedIndex(),list.getSelectedIndex(),true));
        }
        list.requestFocus();
      }
    }
;
    final String name=action.getClass().getName();
    mySlidingPanel.add(name,panel.first);
    final Presentation p=action.getTemplatePresentation();
    return new DumbAwareAction(p.getText(),p.getDescription(),p.getIcon()){
      @Override public void actionPerformed(      @NotNull AnActionEvent e){
        mySlidingPanel.getLayout().swipe(mySlidingPanel,name,JBCardLayout.SwipeDirection.FORWARD,onDone);
      }
    }
;
  }
  return action;
}
