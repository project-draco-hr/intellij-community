{
  final PsiElement element=reference.resolve();
  if (!(element instanceof PsiClass)) {
    return;
  }
  final PsiClass referencedClass=(PsiClass)element;
  for (  PsiElement importTarget : myImportTargets) {
    if (importTarget instanceof PsiPackage) {
      if (referencedClass.getContainingClass() != null) {
        return;
      }
      final PsiFile file=referencedClass.getContainingFile();
      if (!(file instanceof PsiJavaFile)) {
        return;
      }
      final PsiJavaFile javaFile=(PsiJavaFile)file;
      final PsiPackage aPackage=(PsiPackage)importTarget;
      final String packageName=aPackage.getQualifiedName();
      final String filePackage=javaFile.getPackageName();
      if (filePackage.equals(packageName)) {
        addReference(referencedClass,reference);
      }
    }
 else     if (importTarget instanceof PsiClass) {
      final PsiClass aClass=(PsiClass)importTarget;
      final String name=aClass.getQualifiedName();
      if (name == null) {
        return;
      }
      if (!myOnDemand) {
        if (name.equals(referencedClass.getQualifiedName())) {
          addReference(referencedClass,reference);
        }
      }
 else {
        final PsiClass containingClass=referencedClass.getContainingClass();
        if (containingClass == null) {
          return;
        }
        if (name.equals(containingClass.getQualifiedName())) {
          addReference(referencedClass,reference);
        }
      }
    }
  }
}
