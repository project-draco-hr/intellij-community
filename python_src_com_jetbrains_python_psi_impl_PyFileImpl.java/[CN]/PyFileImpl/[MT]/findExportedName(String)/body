{
  if (!Registry.is("python.exported.names.local.cache")) {
    final SoftReference<PsiElement> ref=myExportedNames.get(name);
    if (ref != null) {
      final PsiElement result=ref.get();
      if (result != null) {
        return result;
      }
    }
  }
  final List<String> stack=myFindExportedNameStack.get();
  if (stack.contains(name)) {
    return null;
  }
  stack.add(name);
  try {
    if (Registry.is("python.exported.names.local.cache")) {
      if (myExportedNameCache == null) {
        myExportedNameCache=new ExportedNameCache();
      }
      PsiElement result=myExportedNameCache.resolve(name);
      if (result != null) {
        return result;
      }
    }
 else {
      final PsiElement result=findExportedNameOldStyle(name);
      if (result != null) {
        return result;
      }
    }
    List<String> allNames=getDunderAll();
    if (allNames != null && allNames.contains(name)) {
      return findExportedName(PyNames.ALL);
    }
    return null;
  }
  finally {
    stack.remove(name);
  }
}
