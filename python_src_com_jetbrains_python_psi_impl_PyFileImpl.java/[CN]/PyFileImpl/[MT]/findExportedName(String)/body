{
  final List<String> stack=myFindExportedNameStack.get();
  if (stack.contains(name)) {
    return null;
  }
  stack.add(name);
  try {
    final StubElement stub=getStub();
    if (stub != null) {
      final List children=stub.getChildrenStubs();
      final List<PyExceptPartStub> exceptParts=new ArrayList<PyExceptPartStub>();
      for (int i=children.size() - 1; i >= 0; i--) {
        Object child=children.get(i);
        if (child instanceof NamedStub && name.equals(((NamedStub)child).getName())) {
          return ((NamedStub)child).getPsi();
        }
 else         if (child instanceof PyFromImportStatementStub) {
          return findNameInFromImportStatementStub(name,(PyFromImportStatementStub)child);
        }
 else         if (child instanceof PyImportStatementStub) {
          final PsiElement result=findNameInImportStatementStub(name,(PyImportStatementStub)child);
          if (result != null) {
            return result;
          }
        }
 else         if (child instanceof PyExceptPartStub) {
          exceptParts.add((PyExceptPartStub)child);
        }
      }
      for (int i=exceptParts.size() - 1; i >= 0; i--) {
        PyExceptPartStub part=exceptParts.get(i);
        final List<StubElement> exceptChildren=part.getChildrenStubs();
        for (int j=exceptChildren.size() - 1; j >= 0; j--) {
          Object child=exceptChildren.get(j);
          if (child instanceof NamedStub && name.equals(((NamedStub)child).getName())) {
            return ((NamedStub)child).getPsi();
          }
        }
      }
    }
 else {
      ResolveProcessor proc=new ResolveProcessor(name);
      PyResolveUtil.treeCrawlUp(proc,true,getLastChild());
      if (proc.getResult() != null) {
        return proc.getResult();
      }
    }
    List<String> allNames=getDunderAll();
    if (allNames != null && allNames.contains(name)) {
      return findExportedName(PyNames.ALL);
    }
    return null;
  }
  finally {
    stack.remove(name);
  }
}
