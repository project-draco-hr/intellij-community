{
  final Project project=repository.getProject();
  final HgMergeCommand hgMergeCommand=new HgMergeCommand(project,repository.getRoot());
  hgMergeCommand.setRevision(branchName);
  new Task.Backgroundable(project,"Merging changes..."){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      try {
        hgMergeCommand.merge();
        new HgConflictResolver(project,updatedFiles).resolve(repository.getRoot());
      }
 catch (      VcsException exception) {
        if (exception.isWarning()) {
          VcsNotifier.getInstance(project).notifyWarning("Warning during merge",exception.getMessage());
        }
 else {
          VcsNotifier.getInstance(project).notifyError("Exception during merge",exception.getMessage());
        }
      }
    }
  }
.queue();
}
