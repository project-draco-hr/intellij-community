{
  setOptions(options);
  String before=null;
  if (options.isProcessOnlyChangedText()) {
    myFixture.configureByFile(getTestDataPath() + getTestName(true) + "_revision.java");
    PsiFile file=myFixture.getFile();
    Document document=myFixture.getDocument(file);
    before=document.getText();
  }
  myFixture.configureByFile(getTestDataPath() + getTestName(true) + "_before.java");
  if (before != null) {
    myFixture.getFile().putUserData(FormatChangedTextUtil.TEST_REVISION_CONTENT,before);
  }
  final String actionId=IdeActions.ACTION_EDITOR_REFORMAT;
  AnAction action=ActionManager.getInstance().getAction(actionId);
  AnActionEvent event=createEventFor(action,getProject(),myFixture.getEditor());
  action.actionPerformed(event);
  myFixture.checkResultByFile(getTestName(true) + "_after.java");
}
