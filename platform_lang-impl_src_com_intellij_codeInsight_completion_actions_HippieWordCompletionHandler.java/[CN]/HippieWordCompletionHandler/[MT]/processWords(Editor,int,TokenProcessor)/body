{
  CharSequence chars=editor.getDocument().getCharsSequence();
  HighlighterIterator iterator=((EditorEx)editor).getHighlighter().createIterator(startOffset);
  while (!iterator.atEnd()) {
    int start=iterator.getStart();
    int end=iterator.getEnd();
    if (StringUtil.indexOfAny(chars,WHITESPACE_CHARS,start,end) < 0) {
      if (isWordLike(chars,start,end) && !processor.processToken(start,end)) {
        return;
      }
      iterator.advance();
      continue;
    }
    while (start < end) {
      int wordStart=start;
      while (wordStart < end && !Character.isJavaIdentifierPart(chars.charAt(wordStart)))       wordStart++;
      int wordEnd=wordStart;
      while (wordEnd < end && Character.isJavaIdentifierPart(chars.charAt(wordEnd)))       wordEnd++;
      if (!processor.processToken(wordStart,wordEnd)) {
        return;
      }
      start=wordEnd + 1;
    }
    iterator.advance();
  }
}
