{
  CharSequence chars=editor.getDocument().getCharsSequence();
  HighlighterIterator iterator=((EditorEx)editor).getHighlighter().createIterator(startOffset);
  while (!iterator.atEnd()) {
    int start=iterator.getStart();
    int end=iterator.getEnd();
    while (start < end) {
      int nextWs=StringUtil.indexOfAny(chars,WHITESPACE_CHARS,start,end);
      if (nextWs < 0) {
        if (isWordLike(chars,start,end) && !processor.processToken(start,end)) {
          return;
        }
        break;
      }
      if (isWordLike(chars,start,end) && !processor.processToken(start,nextWs)) {
        return;
      }
      start=CharArrayUtil.shiftForward(chars,nextWs,WHITESPACE_CHARS);
    }
    iterator.advance();
  }
}
