{
  final HgUpdateCommand hgUpdateCommand=new HgUpdateCommand(project,repository);
  hgUpdateCommand.setRevision(targetRevision);
  hgUpdateCommand.setClean(clean);
  HgCommandResult result=hgUpdateCommand.execute();
  new HgConflictResolver(project).resolve(repository);
  boolean success=!HgErrorUtil.isCommandExecutionFailed(result);
  boolean hasUnresolvedConflicts=!HgConflictResolver.findConflicts(project,repository).isEmpty();
  if (!success) {
    new HgCommandResultNotifier(project).notifyError(result,"","Update failed");
  }
 else   if (hasUnresolvedConflicts) {
    new VcsNotifier(project).notifyImportantWarning("Unresolved conflicts.",HgVcsMessages.message("hg4idea.update.warning.merge.conflicts",repository.getPath()));
  }
  getRepositoryManager(project).updateRepository(repository);
  HgErrorUtil.markDirtyAndHandleErrors(project,repository);
  project.getMessageBus().syncPublisher(HgVcs.BRANCH_TOPIC).update(project,repository);
  return success;
}
