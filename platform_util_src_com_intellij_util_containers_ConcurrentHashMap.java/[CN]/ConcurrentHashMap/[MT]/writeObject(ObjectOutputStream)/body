{
  s.defaultWriteObject();
  for (  Segment seg : segments) {
    seg.lock();
    try {
      HashEntry[] tab=seg.table;
      for (      HashEntry tabEntry : tab) {
        HashEntry<K,V> entry=(HashEntry<K,V>)tabEntry;
        for (HashEntry<K,V> e=entry; e != null; e=e.next) {
          s.writeObject(e.key);
          s.writeObject(e.value);
        }
      }
    }
  finally {
      seg.unlock();
    }
  }
  s.writeObject(null);
  s.writeObject(null);
}
