{
  VirtualFile virtualFile=injectedFile == null ? null : injectedFile.getVirtualFile();
  if (virtualFile instanceof VirtualFileWindow) {
    DocumentWindow documentWindow=((VirtualFileWindow)virtualFile).getDocumentWindow();
    if (psi) {
      documentWindow=(DocumentWindow)((PsiDocumentManagerBase)PsiDocumentManager.getInstance(getProject())).getLastCommittedDocument(documentWindow);
    }
    int start=documentWindow.hostToInjected(hostRange.getStartOffset());
    int end=documentWindow.hostToInjected(hostRange.getEndOffset());
    return ProperTextRange.create(start,end);
  }
  return null;
}
