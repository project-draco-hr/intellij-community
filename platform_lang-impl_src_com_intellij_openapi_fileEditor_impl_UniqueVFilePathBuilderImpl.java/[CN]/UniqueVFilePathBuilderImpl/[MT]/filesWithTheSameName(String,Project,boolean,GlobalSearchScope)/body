{
  Collection<VirtualFile> filesWithSameName=skipNonOpenedFiles ? Collections.<VirtualFile>emptySet() : FilenameIndex.getVirtualFilesByName(project,fileName,scope);
  THashSet<VirtualFile> setOfFilesWithTheSameName=new THashSet<VirtualFile>(filesWithSameName);
  for (  VirtualFile openFile : FileEditorManager.getInstance(project).getOpenFiles()) {
    if (openFile.getName().equals(fileName)) {
      setOfFilesWithTheSameName.add(openFile);
    }
  }
  for (  VirtualFile recentlyEditedFile : EditorHistoryManager.getInstance(project).getFiles()) {
    if (recentlyEditedFile.getName().equals(fileName)) {
      setOfFilesWithTheSameName.add(recentlyEditedFile);
    }
  }
  filesWithSameName=setOfFilesWithTheSameName;
  if (filesWithSameName.size() > 1) {
    String path=project.getBasePath();
    path=path == null ? "" : FileUtil.toSystemIndependentName(path);
    UniqueNameBuilder<VirtualFile> builder=new UniqueNameBuilder<VirtualFile>(path,File.separator,25);
    for (    VirtualFile virtualFile : filesWithSameName) {
      builder.addPath(virtualFile,virtualFile.getPath());
    }
    return builder;
  }
  return null;
}
