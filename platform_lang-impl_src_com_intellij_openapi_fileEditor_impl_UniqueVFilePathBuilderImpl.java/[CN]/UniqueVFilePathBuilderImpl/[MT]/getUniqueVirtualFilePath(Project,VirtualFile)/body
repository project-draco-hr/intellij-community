{
  final Collection<VirtualFile> filesWithSameName=FilenameIndex.getVirtualFilesByName(project,file.getName(),ProjectScope.getProjectScope(project));
  if (filesWithSameName.size() > 1 && filesWithSameName.contains(file)) {
    String path=project.getBasePath();
    path=path == null ? "" : FileUtil.toSystemIndependentName(path);
    UniqueNameBuilder<VirtualFile> builder=new UniqueNameBuilder<VirtualFile>(path,File.separator,25);
    for (    VirtualFile virtualFile : filesWithSameName) {
      builder.addPath(virtualFile,virtualFile.getPath());
    }
    String result=builder.getShortPath(file);
    if (UISettings.getInstance().HIDE_KNOWN_EXTENSION_IN_TABS) {
      return FileUtil.getNameWithoutExtension(result);
    }
    return result;
  }
  return file.getPresentableName();
}
