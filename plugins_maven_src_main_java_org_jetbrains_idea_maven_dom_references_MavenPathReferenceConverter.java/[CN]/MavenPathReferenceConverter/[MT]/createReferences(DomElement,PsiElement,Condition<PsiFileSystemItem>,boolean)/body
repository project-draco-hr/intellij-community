{
  ElementManipulator<PsiElement> manipulator=ElementManipulators.getManipulator(element);
  TextRange range=manipulator.getRangeInElement(element);
  String text=range.substring(element.getText());
  FileReferenceSet set=new FileReferenceSet(text,element,range.getStartOffset(),null,SystemInfo.isFileSystemCaseSensitive,false){
    private MavenDomProjectModel model;
    @Override protected Condition<PsiFileSystemItem> getReferenceCompletionFilter(){
      return fileFilter;
    }
    @Override protected boolean isSoft(){
      return true;
    }
    @Override public FileReference createFileReference(    TextRange range,    int index,    String text){
      return new FileReference(this,range,index,text){
        @Override protected void innerResolveInContext(        @NotNull String text,        @NotNull PsiFileSystemItem context,        Collection<ResolveResult> result,        boolean caseSensitive){
          if (model == null) {
            DomElement rootElement=DomUtil.getFileElement(genericDomValue).getRootElement();
            if (rootElement instanceof MavenDomProjectModel) {
              model=(MavenDomProjectModel)rootElement;
            }
          }
          String resolvedText=model == null ? text : MavenPropertyResolver.resolve(text,model);
          if (resolvedText.equals(text)) {
            if (getIndex() == 0 && resolvedText.length() == 2 && resolvedText.charAt(1) == ':') {
              VirtualFile file=LocalFileSystem.getInstance().findFileByPath(resolvedText + '/');
              if (file != null) {
                PsiDirectory psiDirectory=context.getManager().findDirectory(file);
                if (psiDirectory != null) {
                  result.add(new PsiElementResolveResult(psiDirectory));
                }
              }
            }
 else {
              super.innerResolveInContext(resolvedText,context,result,caseSensitive);
            }
          }
 else {
            VirtualFile contextFile=context.getVirtualFile();
            if (contextFile == null)             return;
            VirtualFile file=null;
            if (getIndex() == 0) {
              file=LocalFileSystem.getInstance().findFileByPath(resolvedText);
            }
            if (file == null) {
              file=LocalFileSystem.getInstance().findFileByPath(contextFile.getPath() + '/' + resolvedText);
            }
            if (file != null) {
              PsiFileSystemItem res=file.isDirectory() ? context.getManager().findDirectory(file) : context.getManager().findFile(file);
              if (res != null) {
                result.add(new PsiElementResolveResult(res));
              }
            }
          }
        }
      }
;
    }
  }
;
  if (isAbsolutePath) {
    set.addCustomization(FileReferenceSet.DEFAULT_PATH_EVALUATOR_OPTION,new Function<PsiFile,Collection<PsiFileSystemItem>>(){
      @Override public Collection<PsiFileSystemItem> fun(      PsiFile file){
        VirtualFile virtualFile=file.getVirtualFile();
        if (virtualFile == null) {
          return FileReferenceSet.ABSOLUTE_TOP_LEVEL.fun(file);
        }
        virtualFile=VfsUtil.getRootFile(virtualFile);
        PsiDirectory root=file.getManager().findDirectory(virtualFile);
        if (root == null) {
          return FileReferenceSet.ABSOLUTE_TOP_LEVEL.fun(file);
        }
        return Collections.<PsiFileSystemItem>singletonList(root);
      }
    }
);
  }
  return set.getAllReferences();
}
