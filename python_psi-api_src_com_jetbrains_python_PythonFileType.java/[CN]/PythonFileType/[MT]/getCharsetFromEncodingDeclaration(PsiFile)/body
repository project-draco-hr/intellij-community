{
  final Document document=PsiDocumentManager.getInstance(file.getProject()).getDocument(file);
  final String content;
  if (document != null && document.getLineCount() > MAX_CHARSET_ENCODING_LINE) {
    final int offset=document.getLineEndOffset(MAX_CHARSET_ENCODING_LINE);
    content=document.getText(TextRange.create(0,offset));
  }
 else {
    content=file.getText();
  }
  return getCharsetFromEncodingDeclaration(content);
}
