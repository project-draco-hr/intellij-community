{
  String name=propertiesFile.getName();
  if (!StringUtil.containsChar(name,'_')) {
    return DEFAULT_LOCALE;
  }
  final String containingResourceBundleBaseName=propertiesFile.getResourceBundle().getBaseName();
  LOG.assertTrue(name.startsWith(containingResourceBundleBaseName));
  name=name.substring(containingResourceBundleBaseName.length());
  final Matcher matcher=LOCALE_PATTERN.matcher(name);
  if (matcher.find()) {
    final String rawLocale=matcher.group(1);
    final String[] splittedRawLocale=rawLocale.split("_");
    if (splittedRawLocale.length > 1 && splittedRawLocale[1].length() >= 2) {
      final String language=splittedRawLocale[1];
      final String country=splittedRawLocale.length > 2 ? splittedRawLocale[2] : "";
      final String variant=splittedRawLocale.length > 3 ? splittedRawLocale[3] : "";
      return new Locale(language,country,variant);
    }
  }
  return DEFAULT_LOCALE;
}
