{
  final JComponent component=getComponent();
  if (component == null)   return;
  if (ApplicationManager.getApplication().isHeadlessEnvironment())   return;
  final BalloonBuilder balloonBuilder=JBPopupFactory.getInstance().createDialogBalloonBuilder(component,null).setSmallVariant(true);
  myBalloon=balloonBuilder.createBalloon();
  Disposer.register(myProject,myBalloon);
  Disposer.register(myBalloon,new Disposable(){
    @Override public void dispose(){
      releaseIfNotRestart();
      myEditor.putUserData(PopupFactoryImpl.ANCHOR_POPUP_POSITION,null);
    }
  }
);
  myEditor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  final JBPopupFactory popupFactory=JBPopupFactory.getInstance();
  myBalloon.show(new PositionTracker<Balloon>(myEditor.getContentComponent()){
    @Override public RelativePoint recalculateLocation(    Balloon object){
      if (myTarget != null && !popupFactory.isBestPopupLocationVisible(myEditor)) {
        return myTarget;
      }
      if (myCaretRangeMarker != null && myCaretRangeMarker.isValid()) {
        myEditor.putUserData(PopupFactoryImpl.ANCHOR_POPUP_POSITION,myEditor.offsetToVisualPosition(myCaretRangeMarker.getStartOffset()));
      }
      final RelativePoint target=popupFactory.guessBestPopupLocation(myEditor);
      final Point screenPoint=target.getScreenPoint();
      int y=screenPoint.y;
      if (target.getPoint().getY() > myEditor.getLineHeight() + myBalloon.getPreferredSize().getHeight()) {
        y-=myEditor.getLineHeight();
      }
      myTarget=new RelativePoint(new Point(screenPoint.x,y));
      return myTarget;
    }
  }
,Balloon.Position.above);
}
