{
  final TreeMap<String,Element> map=ContainerUtil.newTreeMap();
  final List<Element> elements=configuration.getCopyableUserData(RUN_EXTENSIONS);
  if (elements != null) {
    for (    Element el : elements) {
      map.put(el.getAttributeValue(getIdAttrName()),el.clone());
    }
  }
  for (  T extension : getApplicableExtensions(configuration)) {
    Element el=new Element(getExtensionRootAttr());
    el.setAttribute(getIdAttrName(),extension.getSerializationId());
    try {
      extension.writeExternal(configuration,el);
    }
 catch (    WriteExternalException e) {
      map.remove(extension.getSerializationId());
      continue;
    }
    map.put(extension.getSerializationId(),el);
  }
  for (  Element val : map.values()) {
    parentNode.addContent(val);
  }
}
