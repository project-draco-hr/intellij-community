{
  final TreeMap<String,Element> map=ContainerUtil.newTreeMap();
  final List<Element> elements=configuration.getCopyableUserData(RUN_EXTENSIONS);
  if (elements != null) {
    for (    Element element : elements) {
      map.put(element.getAttributeValue(getIdAttrName()),element.clone());
    }
  }
  for (  T extension : getApplicableExtensions(configuration)) {
    Element element=new Element(getExtensionRootAttr());
    element.setAttribute(getIdAttrName(),extension.getSerializationId());
    try {
      extension.writeExternal(configuration,element);
    }
 catch (    WriteExternalException ignored) {
      continue;
    }
    if (!element.getContent().isEmpty() || element.getAttributes().size() > 1) {
      map.put(extension.getSerializationId(),element);
    }
  }
  for (  Element values : map.values()) {
    parentNode.addContent(values);
  }
}
