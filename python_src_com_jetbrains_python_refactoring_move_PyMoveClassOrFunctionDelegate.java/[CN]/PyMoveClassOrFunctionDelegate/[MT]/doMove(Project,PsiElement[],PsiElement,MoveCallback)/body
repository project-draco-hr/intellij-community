{
  PsiNamedElement[] elementsToMove=new PsiNamedElement[elements.length];
  for (int i=0; i < elements.length; i++) {
    PsiNamedElement e=getElementToMove(elements[i]);
    if (e == null) {
      return;
    }
    elementsToMove[i]=e;
  }
  boolean previewUsages=false;
  final String destination;
  if (targetContainer instanceof PyFile) {
    destination=targetContainer.getText();
  }
 else {
    final PyMoveClassOrFunctionDialog dialog=new PyMoveClassOrFunctionDialog(project,elementsToMove);
    dialog.show();
    if (!dialog.isOK()) {
      return;
    }
    destination=dialog.getTargetPath();
  }
  try {
    final BaseRefactoringProcessor processor=new PyMoveClassOrFunctionProcessor(project,elementsToMove,destination,previewUsages);
    processor.run();
  }
 catch (  IncorrectOperationException e) {
    CommonRefactoringUtil.showErrorMessage(RefactoringBundle.message("error.title"),e.getMessage(),null,project);
  }
}
