{
  myRepositoryManager.waitUntilInitialized();
  HgRepository repository=myRepositoryManager.getRepositoryForRoot(root);
  if (repository == null) {
    LOG.error("Repository not found for root " + root);
    return Collections.emptyList();
  }
  repository.update();
  Map<String,Set<Hash>> branches=repository.getBranches();
  Collection<HgNameWithHashInfo> bookmarks=repository.getBookmarks();
  Collection<HgNameWithHashInfo> tags=repository.getTags();
  Collection<HgNameWithHashInfo> localTags=repository.getLocalTags();
  Collection<VcsRef> refs=new ArrayList<VcsRef>(branches.size() + bookmarks.size());
  for (  Map.Entry<String,Set<Hash>> entry : branches.entrySet()) {
    String branchName=entry.getKey();
    for (    Hash hash : entry.getValue()) {
      refs.add(myVcsObjectsFactory.createRef(hash,branchName,HgRefManager.BRANCH,root));
    }
  }
  for (  HgNameWithHashInfo bookmarkInfo : bookmarks) {
    refs.add(myVcsObjectsFactory.createRef(bookmarkInfo.getHash(),bookmarkInfo.getName(),HgRefManager.BOOKMARK,root));
  }
  String currentRevision=repository.getCurrentRevision();
  if (currentRevision != null) {
    refs.add(myVcsObjectsFactory.createRef(myVcsObjectsFactory.createHash(currentRevision),"tip",HgRefManager.HEAD,root));
  }
  for (  HgNameWithHashInfo tagInfo : tags) {
    refs.add(myVcsObjectsFactory.createRef(tagInfo.getHash(),tagInfo.getName(),HgRefManager.TAG,root));
  }
  for (  HgNameWithHashInfo localTagInfo : localTags) {
    refs.add(myVcsObjectsFactory.createRef(localTagInfo.getHash(),localTagInfo.getName(),HgRefManager.LOCAL_TAG,root));
  }
  return refs;
}
