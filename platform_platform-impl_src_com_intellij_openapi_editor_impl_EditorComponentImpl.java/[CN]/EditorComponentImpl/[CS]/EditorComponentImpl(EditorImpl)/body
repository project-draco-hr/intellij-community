{
  myEditor=editor;
  enableEvents(AWTEvent.KEY_EVENT_MASK | AWTEvent.INPUT_METHOD_EVENT_MASK);
  enableInputMethods(true);
  setFocusCycleRoot(true);
  setOpaque(true);
  putClientProperty(Magnificator.CLIENT_PROPERTY_KEY,new Magnificator(){
    @Override public Point magnify(    double scale,    Point at){
      VisualPosition magnificationPosition=myEditor.xyToVisualPosition(at);
      double currentSize=myEditor.getColorsScheme().getEditorFontSize();
      int defaultFontSize=EditorColorsManager.getInstance().getGlobalScheme().getEditorFontSize();
      myEditor.setFontSize(Math.max((int)(currentSize * scale),defaultFontSize));
      return myEditor.visualPositionToXY(magnificationPosition);
    }
  }
);
  putClientProperty("sun.lwawt.macosx.CInputMethod.selectPreviousGlyph.callback",new Runnable(){
    @Override public void run(){
      int caretOffset=myEditor.getCaretModel().getOffset();
      if (caretOffset > 0) {
        myEditor.getSelectionModel().setSelection(caretOffset - 1,caretOffset);
      }
    }
  }
);
  myApplication=(ApplicationImpl)ApplicationManager.getApplication();
}
