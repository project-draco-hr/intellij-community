{
  final Project project=e.getProject();
  if (project == null)   return null;
  final VirtualFile file=CommonDataKeys.VIRTUAL_FILE.getData(e.getDataContext());
  if (file != null) {
    final Module moduleForFile=ModuleUtilCore.findModuleForFile(file,project);
    if (moduleForFile != null)     return moduleForFile;
  }
  final List<Module> modules=ModuleChooserUtil.filterGroovyCompatibleModules(Arrays.asList(ModuleManager.getInstance(project).getModules()),APPLICABLE_MODULE);
  return modules.isEmpty() ? null : modules.get(0);
}
