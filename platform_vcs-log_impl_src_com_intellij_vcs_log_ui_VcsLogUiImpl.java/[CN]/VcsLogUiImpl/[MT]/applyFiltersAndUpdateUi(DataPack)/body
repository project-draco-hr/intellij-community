{
  runUnderModalProgress("Applying filters...",new Runnable(){
    public void run(){
      final TIntHashSet previouslySelected=getSelectedCommits();
      final AbstractVcsLogTableModel newModel=myFilterer.applyFiltersAndUpdateUi(dataPack,getFilters());
      UIUtil.invokeAndWaitIfNeeded(new Runnable(){
        @Override public void run(){
          myDataPack=dataPack;
          setModel(newModel,myDataPack,previouslySelected);
          myMainFrame.updateDataPack(myDataPack);
          setLongEdgeVisibility(myUiProperties.areLongEdgesVisible());
          myDataPack.getGraphFacade().performAction(new BekGraphAction(myUiProperties.isBek() ? PermanentGraph.SortType.Bek : PermanentGraph.SortType.Normal));
          fireFilterChangeEvent();
          repaintUI();
          if (newModel.getRowCount() == 0) {
            newModel.requestToLoadMore(EmptyRunnable.INSTANCE);
          }
        }
      }
);
    }
  }
);
}
