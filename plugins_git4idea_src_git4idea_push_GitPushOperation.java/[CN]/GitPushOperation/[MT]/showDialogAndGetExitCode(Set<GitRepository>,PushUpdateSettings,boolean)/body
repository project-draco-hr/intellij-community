{
  final Ref<PushUpdateSettings> updateSettings=Ref.create();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      GitRejectedPushUpdateDialog dialog=new GitRejectedPushUpdateDialog(myProject,repositories,initialSettings,rebaseOverMergeProblemDetected);
      DialogManager.show(dialog);
      int exitCode=dialog.getExitCode();
      if (exitCode != DialogWrapper.CANCEL_EXIT_CODE) {
        mySettings.setAutoUpdateIfPushRejected(dialog.shouldAutoUpdateInFuture());
        updateSettings.set(new PushUpdateSettings(dialog.shouldUpdateAll(),convertUpdateMethodFromDialogExitCode(exitCode)));
      }
    }
  }
);
  return updateSettings.get();
}
