{
  FileDocumentManager.getInstance().saveAllDocuments();
  final InspectionManagerEx inspectionManagerEx=(InspectionManagerEx)InspectionManager.getInstance(project);
  final AnalysisScope scope=new AnalysisScope(psiFile);
  final GlobalInspectionContextImpl inspectionContext=inspectionManagerEx.createNewGlobalContext(false);
  inspectionContext.setCurrentScope(scope);
  inspectionContext.setExternalProfile((InspectionProfileImpl)InspectionProjectProfileManager.getInstance(project).getCurrentProfile());
  inspectionContext.doInspections(scope);
}
