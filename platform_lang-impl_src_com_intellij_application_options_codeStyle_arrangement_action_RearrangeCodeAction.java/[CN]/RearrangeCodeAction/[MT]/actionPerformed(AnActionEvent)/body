{
  final Project project=e.getProject();
  if (project == null) {
    return;
  }
  final Editor editor=e.getData(CommonDataKeys.EDITOR);
  if (editor == null) {
    return;
  }
  PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
  Document document=editor.getDocument();
  documentManager.commitDocument(document);
  final PsiFile file=documentManager.getPsiFile(document);
  if (file == null) {
    return;
  }
  new RearrangeCodeProcessor(project,file,editor.getSelectionModel()).run();
}
