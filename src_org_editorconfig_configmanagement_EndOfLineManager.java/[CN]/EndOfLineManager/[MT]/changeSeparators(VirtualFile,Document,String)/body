{
  String text=document.getText();
  if (!lineSeparator.equals("\n")) {
    text=StringUtil.convertLineSeparators(text,lineSeparator);
  }
  final AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
  try {
    LoadTextUtil.write(project,file,this,text,document.getModificationStamp());
  }
 catch (  IOException error) {
    LOG.error("IOException while changing line separator");
  }
 finally {
    token.finish();
  }
}
