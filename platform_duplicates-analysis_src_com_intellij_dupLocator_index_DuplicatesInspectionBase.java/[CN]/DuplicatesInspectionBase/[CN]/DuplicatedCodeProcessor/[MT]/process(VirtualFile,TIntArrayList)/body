{
  for (int i=0, len=list.size(); i < len; ++i) {
    ProgressManager.checkCanceled();
    int value=list.getQuick(i);
    if (myProjectFileIndex.isInSource(virtualFile) && !myProjectFileIndex.isInSource(file))     return true;
    if (!myProjectFileIndex.isInSource(virtualFile) && myProjectFileIndex.isInSource(file))     return true;
    final int startOffset=getStartOffset(myNode);
    final int endOffset=getEndOffset(myNode);
    if (file.equals(virtualFile) && value >= startOffset && value < endOffset)     continue;
    PsiElement target=getPsi(myNode);
    TextRange rangeInElement=getRangeInElement(myNode);
    Integer fragmentStartOffsetInteger=startOffset;
    SortedMap<Integer,TextRange> map=reportedRanges.subMap(fragmentStartOffsetInteger,endOffset);
    int newFragmentSize=!map.isEmpty() ? 0 : 1;
    Iterator<Integer> iterator=map.keySet().iterator();
    while (iterator.hasNext()) {
      Integer next=iterator.next();
      iterator.remove();
      reportedFiles.remove(next);
      reportedOffsetInOtherFiles.remove(next);
      reportedPsi.remove(next);
      newFragmentSize+=fragmentSize.remove(next);
    }
    reportedRanges.put(fragmentStartOffsetInteger,rangeInElement);
    reportedFiles.put(fragmentStartOffsetInteger,file);
    reportedOffsetInOtherFiles.put(fragmentStartOffsetInteger,value);
    reportedPsi.put(fragmentStartOffsetInteger,target);
    fragmentSize.put(fragmentStartOffsetInteger,newFragmentSize);
    if (newFragmentSize >= MIN_FRAGMENT_SIZE)     fragmentHash.put(fragmentStartOffsetInteger,myHash);
    return false;
  }
  return true;
}
