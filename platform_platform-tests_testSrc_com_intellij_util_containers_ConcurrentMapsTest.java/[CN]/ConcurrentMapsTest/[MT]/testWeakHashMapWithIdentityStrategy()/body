{
  WeakHashMap<Object,Object> map=new WeakHashMap<>(10,0.5f,ContainerUtil.identityStrategy());
  Ref<Object> key=Ref.create(new Object());
  Ref<Object> value=Ref.create(new Object());
  map.put(key.get(),value.get());
  assertSame(value.get(),map.get(key.get()));
  value.set(null);
  key.set(null);
  do {
    tryGcSoftlyReachableObjects();
    System.gc();
  }
 while (!map.processQueue());
  assertEquals(0,map.underlyingMapSize());
  UsefulTestCase.assertEmpty(map.keySet());
  assertTrue(map.isEmpty());
}
