{
  final JTextArea textArea=new JTextArea(getRawCellText());
  addHierarchyBoundsListener(new IpnbUtils.IpnbHierarchyBoundsAdapter(this));
  textArea.addHierarchyBoundsListener(new IpnbUtils.IpnbHierarchyBoundsAdapter(textArea));
  addComponentListener(new ComponentAdapter(){
    @Override public void componentResized(    ComponentEvent e){
      final int height=Math.max(textArea.getFontMetrics(getFont()).getHeight() * getLineCount(textArea),myViewPanel.getPreferredSize().height);
      setPreferredSize(new Dimension(textArea.getWidth(),height));
      final Container parent=getParent();
      if (parent instanceof IpnbFilePanel) {
        IpnbFilePanel filePanel=(IpnbFilePanel)parent;
        filePanel.revalidate();
        filePanel.repaint();
      }
    }
  }
);
  textArea.setLineWrap(true);
  textArea.setEditable(true);
  textArea.setBorder(BorderFactory.createLineBorder(JBColor.lightGray));
  textArea.setBackground(Gray._247);
  textArea.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      if (e.getClickCount() == 1) {
        setEditing(true);
        final Container parent=getParent();
        parent.repaint();
        if (parent instanceof IpnbFilePanel) {
          ((IpnbFilePanel)parent).setSelectedCell(IpnbEditablePanel.this);
          textArea.requestFocus();
        }
      }
    }
  }
);
  textArea.addKeyListener(new KeyAdapter(){
    @Override public void keyReleased(    KeyEvent e){
      final int height=textArea.getFontMetrics(getFont()).getHeight() * getLineCount(textArea);
      final Dimension preferredSize=myViewPanel.getPreferredSize();
      setPreferredSize(new Dimension(preferredSize.width,Math.max(height,preferredSize.height)));
      textArea.setPreferredSize(new Dimension(textArea.getWidth(),height));
      textArea.revalidate();
      textArea.repaint();
      revalidate();
      repaint();
      if (e.getKeyCode() == KeyEvent.VK_ESCAPE) {
        setEditing(false);
        final Container parent=getParent();
        if (parent instanceof IpnbFilePanel) {
          parent.repaint();
          UIUtil.requestFocus((IpnbFilePanel)parent);
        }
      }
    }
  }
);
  return textArea;
}
