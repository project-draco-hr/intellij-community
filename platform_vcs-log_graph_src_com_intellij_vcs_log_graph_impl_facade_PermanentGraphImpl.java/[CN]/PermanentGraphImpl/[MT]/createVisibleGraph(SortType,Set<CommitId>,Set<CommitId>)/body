{
  LinearGraphController controller;
  if (sortType == SortType.LinearBek) {
    controller=new LinearBekController(new BekBaseLinearGraphController(this,myBekIntMap),this,myPermanentCommitsInfo.getTimestampGetter());
    return new VisibleGraphImpl<CommitId>(controller,this);
  }
  CascadeLinearGraphController baseController;
  if (sortType == SortType.Normal) {
    baseController=new BaseLinearGraphController(this);
  }
 else {
    baseController=new BekBaseLinearGraphController(this,myBekIntMap);
  }
  if (matchedCommits != null) {
    controller=new FilterLinearGraphController(baseController,this,myPermanentCommitsInfo.convertToNodeIds(matchedCommits));
  }
 else {
    controller=new CollapsedLinearGraphController(baseController,this);
  }
  return new VisibleGraphImpl<CommitId>(controller,this);
}
