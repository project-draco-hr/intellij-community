{
  CascadeLinearGraphController baseController;
  if (sortType == SortType.Normal) {
    baseController=new BaseLinearGraphController(this);
  }
 else   if (sortType == SortType.LinearBek) {
    baseController=new LinearBekController(new BekBaseLinearGraphController(this,myBekIntMap),this);
  }
 else {
    baseController=new BekBaseLinearGraphController(this,myBekIntMap);
  }
  LinearGraphController controller;
  if (matchingCommits != null) {
    controller=new FilterLinearGraphController(baseController,this,myPermanentCommitsInfo.convertToNodeIds(matchingCommits));
  }
 else   if (sortType == SortType.LinearBek) {
    if (visibleHeads != null) {
      controller=new BranchFilterGraphController(baseController,this,myPermanentCommitsInfo.convertToNodeIds(visibleHeads));
    }
 else {
      controller=baseController;
    }
  }
 else {
    Set<Integer> idOfVisibleBranches=null;
    if (visibleHeads != null) {
      idOfVisibleBranches=myPermanentCommitsInfo.convertToNodeIds(visibleHeads);
    }
    controller=new CollapsedLinearGraphController(baseController,this,idOfVisibleBranches);
  }
  return new VisibleGraphImpl<CommitId>(controller,this);
}
