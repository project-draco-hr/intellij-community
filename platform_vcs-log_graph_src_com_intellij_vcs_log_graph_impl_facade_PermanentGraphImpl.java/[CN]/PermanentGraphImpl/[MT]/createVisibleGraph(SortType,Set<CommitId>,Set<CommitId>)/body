{
  CascadeController baseController;
  if (sortType == SortType.Normal) {
    baseController=new BaseController(this);
  }
 else   if (sortType == SortType.LinearBek) {
    baseController=new LinearBekController(new BekBaseController(this,myBekIntMap),this);
  }
 else {
    baseController=new BekBaseController(this,myBekIntMap);
  }
  LinearGraphController controller;
  if (matchingCommits != null) {
    controller=new FilteredController(baseController,this,myPermanentCommitsInfo.convertToNodeIds(matchingCommits));
  }
 else   if (sortType == SortType.LinearBek) {
    if (visibleHeads != null) {
      controller=new BranchFilterController(baseController,this,myPermanentCommitsInfo.convertToNodeIds(visibleHeads));
    }
 else {
      controller=baseController;
    }
  }
 else {
    Set<Integer> idOfVisibleBranches=null;
    if (visibleHeads != null) {
      idOfVisibleBranches=myPermanentCommitsInfo.convertToNodeIds(visibleHeads);
    }
    controller=new CollapsedController(baseController,this,idOfVisibleBranches);
  }
  return new VisibleGraphImpl<CommitId>(controller,this);
}
