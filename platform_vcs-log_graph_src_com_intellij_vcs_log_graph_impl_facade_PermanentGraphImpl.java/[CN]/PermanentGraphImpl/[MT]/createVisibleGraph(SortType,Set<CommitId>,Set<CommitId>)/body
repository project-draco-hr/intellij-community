{
  LinearGraphController controller;
  if (sortType == SortType.LinearBek) {
    controller=new LinearBekController(new BekBaseLinearGraphController(this,myBekIntMap),this,myPermanentCommitsInfo.getTimestampGetter());
    return new VisibleGraphImpl<CommitId>(controller,this);
  }
  CascadeLinearGraphController baseController;
  if (sortType == SortType.Normal) {
    baseController=new BaseLinearGraphController(this);
  }
 else {
    baseController=new BekBaseLinearGraphController(this,myBekIntMap);
  }
  if (matchedCommits != null) {
    controller=new FilterLinearGraphController(baseController,this,myPermanentCommitsInfo.convertToNodeIds(matchedCommits));
  }
 else {
    Set<Integer> idOfVisibleBranches=null;
    if (headsOfVisibleBranches != null) {
      idOfVisibleBranches=myPermanentCommitsInfo.convertToNodeIds(headsOfVisibleBranches);
    }
    controller=new CollapsedLinearGraphController(baseController,this,idOfVisibleBranches);
  }
  return new VisibleGraphImpl<CommitId>(controller,this);
}
