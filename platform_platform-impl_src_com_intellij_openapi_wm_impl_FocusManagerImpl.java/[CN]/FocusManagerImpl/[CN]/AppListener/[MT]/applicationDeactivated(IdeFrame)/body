{
  if (Registry.is("trace.focus.on.app.activation")) {
    LOG.info("Application is deactivating");
  }
  final Component owner=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();
  Component parent=UIUtil.findUltimateParent(owner);
  if (parent == ideFrame) {
    myLastFocusedAtDeactivation.put(ideFrame,owner);
    if (Registry.is("trace.focus.on.app.activation")) {
      final Project project=ideFrame.getProject();
      String projectName=null;
      if (project != null) {
        projectName=project.getName();
      }
      LOG.info("The next component is set as ths last focused for [" + projectName + "]");
    }
  }
 else {
    if (Registry.is("trace.focus.on.app.activation")) {
      if (owner != null) {
        final Project project=ideFrame.getProject();
        String projectName=null;
        if (project != null) {
          projectName=project.getName();
        }
        LOG.error("The last focused component " + (owner != null ? owner.getClass().getName() : null) + " is not in the deactivating frame ["+ projectName+ "]. Skip it.");
      }
 else {
        LOG.info("The last focused component is null");
      }
    }
  }
}
