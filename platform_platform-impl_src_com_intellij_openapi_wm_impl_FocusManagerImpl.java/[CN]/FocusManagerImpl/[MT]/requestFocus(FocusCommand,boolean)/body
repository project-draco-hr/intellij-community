{
  assertDispatchThread();
  if (isInternalMode) {
    recordCommand(command,new Throwable());
  }
  final ActionCallback result=new ActionCallback();
  myActivityMonitor.addActivity(FOCUS,ModalityState.any());
  if (!forced) {
    UIUtil.invokeAndWaitIfNeeded(new Runnable(){
      @Override public void run(){
        if (!myFocusRequests.contains(command)) {
          myFocusRequests.add(command);
        }
      }
    }
);
    SwingUtilities.invokeLater(new Runnable(){
      @Override public void run(){
        resetUnforcedCommand(command);
        _requestFocus(command,result);
      }
    }
);
  }
 else {
    _requestFocus(command,result);
  }
  result.doWhenProcessed(new Runnable(){
    @Override public void run(){
      restartIdleAlarm();
    }
  }
);
  return result;
}
