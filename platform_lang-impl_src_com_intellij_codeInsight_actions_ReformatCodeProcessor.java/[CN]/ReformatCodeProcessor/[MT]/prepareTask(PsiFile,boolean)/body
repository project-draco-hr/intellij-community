{
  return new FutureTask<Boolean>(new Callable<Boolean>(){
    @Override public Boolean call() throws Exception {
      FormattingProgressTask.FORMATTING_CANCELLED_FLAG.set(false);
      try {
        Collection<TextRange> ranges=getRangesToFormat(processChangedTextOnly,file);
        CodeStyleManager.getInstance(myProject).reformatText(file,ranges);
        return !FormattingProgressTask.FORMATTING_CANCELLED_FLAG.get();
      }
 catch (      FilesTooBigForDiffException e) {
        handleFileTooBigException(LOG,e,file);
        return false;
      }
catch (      IncorrectOperationException e) {
        LOG.error(e);
        return false;
      }
 finally {
        myRanges.clear();
      }
    }
  }
);
}
