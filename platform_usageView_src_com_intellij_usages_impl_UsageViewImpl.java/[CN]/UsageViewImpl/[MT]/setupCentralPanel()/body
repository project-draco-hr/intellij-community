{
  myCentralPanel.removeAll();
  disposeUsageContextPanels();
  JScrollPane treePane=ScrollPaneFactory.createScrollPane(myTree);
  treePane.getViewport().addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    ChangeEvent e){
      TreeUI ui=myTree.getUI();
      if (ui instanceof BasicTreeUI) {
        AbstractLayoutCache treeState=ReflectionUtil.getField(BasicTreeUI.class,ui,AbstractLayoutCache.class,"treeState");
        Rectangle visibleRect=myTree.getVisibleRect();
        int rowForLocation=myTree.getClosestRowForLocation(0,visibleRect.y);
        int visibleRowCount=myTree.getVisibleRowCount();
        for (int i=rowForLocation + visibleRowCount + 1; i >= rowForLocation; i--) {
          final TreePath eachPath=myTree.getPathForRow(i);
          if (eachPath == null)           continue;
          treeState.invalidatePathBounds(eachPath);
        }
        myTree.repaint(visibleRect);
      }
 else {
        myTree.setCellRenderer(myUsageViewTreeCellRenderer);
      }
    }
  }
);
  myPreviewSplitter=new Splitter(false,0.5f,0.1f,0.9f);
  myPreviewSplitter.setFirstComponent(treePane);
  myCentralPanel.add(myPreviewSplitter,BorderLayout.CENTER);
  if (UsageViewSettings.getInstance().IS_PREVIEW_USAGES) {
    myPreviewSplitter.setProportion(UsageViewSettings.getInstance().PREVIEW_USAGES_SPLITTER_PROPORTIONS);
    treePane.putClientProperty(UIUtil.KEEP_BORDER_SIDES,SideBorder.RIGHT);
    final JBTabbedPane tabbedPane=new JBTabbedPane(SwingConstants.BOTTOM){
      @NotNull @Override protected Insets getInsetsForTabComponent(){
        return new Insets(0,0,0,0);
      }
    }
;
    UsageContextPanel.Provider[] extensions=Extensions.getExtensions(UsageContextPanel.Provider.EP_NAME,myProject);
    myUsageContextPanelProviders=ContainerUtil.filter(extensions,new Condition<UsageContextPanel.Provider>(){
      @Override public boolean value(      UsageContextPanel.Provider provider){
        return provider.isAvailableFor(UsageViewImpl.this);
      }
    }
);
    for (    UsageContextPanel.Provider provider : myUsageContextPanelProviders) {
      JComponent component;
      if (myCurrentUsageContextProvider == null || myCurrentUsageContextProvider == provider) {
        myCurrentUsageContextProvider=provider;
        myCurrentUsageContextPanel=provider.create(this);
        component=myCurrentUsageContextPanel.createComponent();
      }
 else {
        component=new JLabel();
      }
      tabbedPane.addTab(provider.getTabTitle(),component);
    }
    int index=myUsageContextPanelProviders.indexOf(myCurrentUsageContextProvider);
    tabbedPane.setSelectedIndex(index);
    tabbedPane.addChangeListener(new ChangeListener(){
      @Override public void stateChanged(      ChangeEvent e){
        int currentIndex=tabbedPane.getSelectedIndex();
        UsageContextPanel.Provider selectedProvider=myUsageContextPanelProviders.get(currentIndex);
        if (selectedProvider != myCurrentUsageContextProvider) {
          tabSelected(selectedProvider);
        }
      }
    }
);
    tabbedPane.setBorder(IdeBorderFactory.createBorder(SideBorder.LEFT));
    myPreviewSplitter.setSecondComponent(tabbedPane);
  }
 else {
    myPreviewSplitter.setProportion(1);
  }
  myCentralPanel.add(myButtonPanel,BorderLayout.SOUTH);
  myRootPanel.revalidate();
  myRootPanel.repaint();
}
