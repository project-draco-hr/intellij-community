{
  String text=editor.getSelectionModel().getSelectedText();
  if (psiFile == null || StringUtil.isEmpty(text)) {
    return super.getEditorExpression(editor,psiFile);
  }
  PsiElement[] range=CodeInsightUtil.findStatementsInRange(psiFile,editor.getSelectionModel().getSelectionStart(),editor.getSelectionModel().getSelectionEnd());
  return new XExpressionImpl(formatTextForEvaluation(text),XDebuggerEditorBase.getFileTypeLanguage(psiFile.getFileType()),null,range.length > 1 ? EvaluationMode.CODE_FRAGMENT : EvaluationMode.EXPRESSION);
}
