{
  final Ref<TextRange> currentRange=Ref.create(null);
  PsiDocumentManager.getInstance(project).commitAndRunReadAction(new Runnable(){
    @Override public void run(){
      PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(document);
      if (psiFile == null) {
        return;
      }
      PsiElement elementAtCursor=psiFile.findElementAt(offset);
      if (elementAtCursor == null) {
        return;
      }
      Pair<PsiElement,TextRange> pair=findExpression(elementAtCursor,sideEffectsAllowed);
      if (pair != null) {
        currentRange.set(pair.getSecond());
      }
    }
  }
);
  return currentRange.get();
}
