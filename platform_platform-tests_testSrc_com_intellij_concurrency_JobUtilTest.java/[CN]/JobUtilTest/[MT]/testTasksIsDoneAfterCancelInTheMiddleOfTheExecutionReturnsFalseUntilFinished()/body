{
  Random random=new Random();
  for (int i=0; i < 100; i++) {
    final AtomicBoolean finished=new AtomicBoolean();
    final AtomicBoolean started=new AtomicBoolean();
    Job<Void> job=JobLauncher.getInstance().submitToJobThread(new Runnable(){
      @Override public void run(){
        started.set(true);
        TimeoutUtil.sleep(100);
        finished.set(true);
      }
    }
,null);
    assertFalse(job.isDone());
    TimeoutUtil.sleep(random.nextInt(100));
    job.cancel();
    long start=System.currentTimeMillis();
    while (!finished.get() && (started.get() || System.currentTimeMillis() < start + 2000)) {
      boolean wasDone=job.isDone();
      boolean wasStarted=started.get();
      boolean wasFinished=finished.get();
      if (!wasFinished) {
        assertTrue(wasStarted + ", " + wasDone,wasDone == !wasStarted);
      }
    }
  }
}
