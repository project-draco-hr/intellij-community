{
  return new FutureTask<Boolean>(new Callable<Boolean>(){
    @Override public Boolean call() throws Exception {
      try {
        if (!shouldRearrangeFile(file))         return true;
        Collection<TextRange> ranges=getRangesToFormat(file);
        RearrangeCommand rearranger=new RearrangeCommand(myProject,file,COMMAND_NAME,ranges);
        if (rearranger.couldRearrange()) {
          rearranger.run();
        }
        return true;
      }
  finally {
        myRangesForFile.clear();
      }
    }
  }
);
}
