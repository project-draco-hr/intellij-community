{
  if (event instanceof RetargetRangeMarkers) {
    int start=((RetargetRangeMarkers)event).getStartOffset();
    if (myRange.getStartOffset() >= start && myRange.getEndOffset() <= ((RetargetRangeMarkers)event).getEndOffset()) {
      ProperTextRange range=myRange.shiftRight(((RetargetRangeMarkers)event).getMoveDestinationOffset() - start);
      return new ManualRangeMarker(range,myGreedyLeft,myGreedyRight,myLinesCols == null ? null : PersistentRangeMarker.storeLinesAndCols(range,event.getDocument()));
    }
  }
  if (myLinesCols != null) {
    Pair<ProperTextRange,PersistentRangeMarker.LinesCols> pair=PersistentRangeMarker.applyChange(event,myRange,myRange.getStartOffset(),myRange.getEndOffset(),myGreedyLeft,myGreedyRight,myLinesCols);
    return pair == null ? null : new ManualRangeMarker(pair.first,myGreedyLeft,myGreedyRight,pair.second);
  }
  ProperTextRange range=RangeMarkerImpl.applyChange(event,myRange.getStartOffset(),myRange.getEndOffset(),myGreedyLeft,myGreedyRight);
  return range == null ? null : new ManualRangeMarker(range,myGreedyLeft,myGreedyRight,null);
}
