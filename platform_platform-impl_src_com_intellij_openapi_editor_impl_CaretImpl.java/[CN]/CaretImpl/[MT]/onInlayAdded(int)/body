{
  updateCachedStateIfNeeded();
  int currentOffset=getOffset();
  if (offset == currentOffset && myLogicalCaret.leansForward) {
    VisualPosition pos=myEditor.offsetToVisualPosition(currentOffset,true,false);
    moveToVisualPosition(pos);
  }
 else {
    updateVisualPosition();
  }
}
