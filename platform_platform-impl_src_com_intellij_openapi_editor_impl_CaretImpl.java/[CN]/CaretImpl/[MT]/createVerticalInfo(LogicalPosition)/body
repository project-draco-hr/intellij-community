{
  Document document=myEditor.getDocument();
  int logicalLine=position.line;
  if (logicalLine >= document.getLineCount()) {
    logicalLine=Math.max(0,document.getLineCount() - 1);
  }
  int startOffset=document.getLineStartOffset(logicalLine);
  int endOffset=document.getLineEndOffset(logicalLine);
  int y;
  if (myEditor.myUseNewRendering) {
    int visualLine=myEditor.offsetToVisualLine(document.getLineStartOffset(logicalLine));
    y=myEditor.visibleLineToY(visualLine);
  }
 else {
    VisualPosition visualPosition=myEditor.offsetToVisualPosition(document.getLineStartOffset(logicalLine));
    y=myEditor.visualPositionToXY(visualPosition).y;
  }
  int lineHeight=myEditor.getLineHeight();
  int height=lineHeight;
  List<? extends SoftWrap> softWraps=myEditor.getSoftWrapModel().getSoftWrapsForRange(startOffset,endOffset);
  for (  SoftWrap softWrap : softWraps) {
    height+=StringUtil.countNewLines(softWrap.getText()) * lineHeight;
  }
  return new VerticalInfo(y,height);
}
