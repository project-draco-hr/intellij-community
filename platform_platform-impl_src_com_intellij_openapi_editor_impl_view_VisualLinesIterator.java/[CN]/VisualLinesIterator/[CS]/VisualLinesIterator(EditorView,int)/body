{
  EditorImpl editor=view.getEditor();
  SoftWrapModelImpl softWrapModel=editor.getSoftWrapModel();
  myDocument=editor.getDocument();
  FoldRegion[] regions=editor.getFoldingModel().fetchTopLevel();
  myFoldRegions=regions == null ? FoldRegion.EMPTY_ARRAY : regions;
  mySoftWraps=softWrapModel.getRegisteredSoftWraps();
  if (startVisualLine < 0 || startVisualLine >= editor.getVisibleLineCount()) {
    myOffset=-1;
  }
 else   if (startVisualLine > 0) {
    myVisualLine=startVisualLine;
    myOffset=startVisualLine >= 0 && startVisualLine < editor.getVisibleLineCount() ? view.visualLineToOffset(startVisualLine) : -1;
    myLogicalLine=myDocument.getLineNumber(myOffset) + 1;
    mySoftWrap=softWrapModel.getSoftWrapIndex(myOffset) + 1;
    if (mySoftWrap <= 0) {
      mySoftWrap=-mySoftWrap;
    }
    myFoldRegion=editor.getFoldingModel().getLastCollapsedRegionBefore(myOffset) + 1;
  }
}
