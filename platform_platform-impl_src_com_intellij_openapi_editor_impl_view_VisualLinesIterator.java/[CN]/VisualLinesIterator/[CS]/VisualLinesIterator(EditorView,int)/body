{
  myView=view;
  myEditor=view.getEditor();
  SoftWrapModelImpl softWrapModel=myEditor.getSoftWrapModel();
  myDocument=myEditor.getDocument();
  FoldRegion[] regions=myEditor.getFoldingModel().fetchTopLevel();
  myFoldRegions=regions == null ? FoldRegion.EMPTY_ARRAY : regions;
  mySoftWraps=softWrapModel.getRegisteredSoftWraps();
  if (!mySoftWraps.isEmpty() && mySoftWraps.get(mySoftWraps.size() - 1).getStart() >= myDocument.getTextLength()) {
    LOG.error("Unexpected soft wrap location",new Attachment("editorState.txt",myEditor.dumpState()));
  }
  myLocation=new Location(startVisualLine);
}
