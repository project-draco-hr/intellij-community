{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Save " + file.getPresentableUrl());
  }
  AccessToken token=WriteAction.start();
  try {
    OutputStream out=file.getOutputStream(requestor);
    try {
      if (lineSeparatorIfPrependXmlProlog != null) {
        out.write(XML_PROLOG);
        out.write(lineSeparatorIfPrependXmlProlog.getSeparatorBytes());
      }
      content.writeTo(out);
    }
  finally {
      out.close();
    }
  }
 catch (  FileNotFoundException e) {
    throw new ReadOnlyModificationException(file,e,new StateStorage.SaveSession(){
      @Override public void save() throws IOException {
        doWrite(requestor,file,content,lineSeparatorIfPrependXmlProlog);
      }
    }
);
  }
 finally {
    token.finish();
  }
}
