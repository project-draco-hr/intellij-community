{
  boolean inMemory=myStorage instanceof MemoryIndexStorage && ((MemoryIndexStorage)myStorage).isBufferingEnabled();
  if (DebugAssertions.DEBUG) {
    DebugAssertions.assertTrue(inMemory == myIsBufferingMode.get());
  }
  if (inMemory) {
synchronized (myInMemoryKeys) {
      Collection<Key> keys=myInMemoryKeys.get(inputId);
      if (keys != null) {
        if (myInputsIndex != null && DebugAssertions.DEBUG) {
          DebugAssertions.assertTrue(equals(keys,myInputsIndex.get(inputId)));
        }
        return keys;
      }
    }
  }
  if (myHasSnapshotMapping) {
    if (myInputsIndex != null && DebugAssertions.DEBUG) {
      DebugAssertions.assertTrue(equals(null,myInputsIndex.get(inputId)));
    }
    return null;
  }
  return myInputsIndex.get(inputId);
}
