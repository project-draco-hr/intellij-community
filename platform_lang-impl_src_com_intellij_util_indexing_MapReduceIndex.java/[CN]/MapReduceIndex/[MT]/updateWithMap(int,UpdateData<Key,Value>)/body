{
  getWriteLock().lock();
  try {
    try {
      ValueContainerImpl.ourDebugIndexInfo.set(myIndexId);
      updateData.iterateRemovedOrUpdatedKeys(inputId,myRemoveStaleKeyOperation);
    }
 catch (    Exception e) {
      throw new StorageException(e);
    }
 finally {
      ValueContainerImpl.ourDebugIndexInfo.set(null);
    }
    updateData.iterateAddedKeys(inputId,myAddedKeyProcessor);
    try {
      updateData.save(inputId);
    }
 catch (    IOException e) {
      throw new StorageException(e);
    }
  }
  finally {
    getWriteLock().unlock();
  }
}
