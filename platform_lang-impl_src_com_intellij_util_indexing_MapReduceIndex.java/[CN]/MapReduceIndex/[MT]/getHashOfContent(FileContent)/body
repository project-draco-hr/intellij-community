{
  Integer previouslyCalculatedContentHashId=content.getUserData(ourSavedContentHashIdKey);
  if (previouslyCalculatedContentHashId == null) {
    byte[] hash=content instanceof FileContentImpl ? ((FileContentImpl)content).getHash() : null;
    if (hash == null) {
      Charset charset=content instanceof FileContentImpl ? ((FileContentImpl)content).getCharset() : null;
      previouslyCalculatedContentHashId=ContentHashesSupport.calcContentHashIdWithFileType(content.getContent(),charset,content.getFileType());
    }
 else {
      previouslyCalculatedContentHashId=ContentHashesSupport.enumerateHash(hash);
    }
    content.putUserData(ourSavedContentHashIdKey,previouslyCalculatedContentHashId);
  }
  return previouslyCalculatedContentHashId;
}
