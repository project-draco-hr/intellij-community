{
  final VirtualFile fileOrDir=file.getVirtualFile();
  if (fileOrDir == null)   return;
  if (!fileOrDir.isInLocalFileSystem())   return;
  final Module module=ModuleUtilCore.findModuleForFile(fileOrDir,myPsiManager.getProject());
  if (module != null) {
    myModules.add(module);
  }
  if (file instanceof PsiJavaFile) {
    final PsiJavaFile javaFile=(PsiJavaFile)file;
    final String packageName=javaFile.getPackageName();
    if (containsPackagePrefix(module,packageName) || (packageName.length() == 0 && !(javaFile instanceof ServerPageFile)) || !myUsePackageNotation) {
      mySourceFiles.add(FileUtil.toSystemIndependentName(fileOrDir.getPath()));
    }
 else {
      myPackages.add(packageName);
    }
  }
}
