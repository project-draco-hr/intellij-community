{
  LOG.debug("URI: " + method.getURI());
  int statusCode;
  String entityContent;
  try {
    statusCode=getHttpClient().executeMethod(method);
    LOG.debug("Status code: " + statusCode);
    final InputStream stream=method.getResponseBodyAsStream();
    entityContent=stream == null ? "" : StreamUtil.readText(stream,CharsetToolkit.UTF8);
    LOG.debug(entityContent);
  }
  finally {
    method.releaseConnection();
  }
  if (statusCode >= 200 && statusCode < 300) {
    return entityContent;
  }
 else   if (method.getResponseHeader("Content-Type") != null) {
    Header header=method.getResponseHeader("Content-Type");
    if (header.getValue().startsWith("application/json")) {
      JsonObject object=GSON.fromJson(entityContent,JsonObject.class);
      if (object.has("errorMessages")) {
        String reason=StringUtil.join(object.getAsJsonArray("errorMessages")," ");
        LOG.warn(reason);
        throw new Exception("Request failed. Reason: " + reason);
      }
    }
  }
  if (method.getResponseHeader("X-Authentication-Denied-Reason") != null) {
    Header header=method.getResponseHeader("X-Authentication-Denied-Reason");
    if (header.getValue().startsWith("CAPTCHA_CHALLENGE")) {
      throw new Exception("Login failed. Enter captcha in web-interface.");
    }
  }
  if (statusCode == HttpStatus.SC_UNAUTHORIZED) {
    throw new Exception(LOGIN_FAILED_CHECK_YOUR_PERMISSIONS);
  }
  String statusText=HttpStatus.getStatusText(method.getStatusCode());
  throw new Exception(String.format("Request failed with HTTP error: %d %s",statusCode,statusText));
}
