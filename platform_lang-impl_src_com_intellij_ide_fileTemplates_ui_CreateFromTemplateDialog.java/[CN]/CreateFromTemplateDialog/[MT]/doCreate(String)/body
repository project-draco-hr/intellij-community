{
  try {
    String newName=fileName;
    PsiDirectory directory=myDirectory;
    if (fileName != null) {
      final String finalFileName=fileName;
      CreateFileAction.MkDirs mkDirs=ApplicationManager.getApplication().runWriteAction(new Computable<CreateFileAction.MkDirs>(){
        @Override public CreateFileAction.MkDirs compute(){
          return new CreateFileAction.MkDirs(finalFileName,myDirectory);
        }
      }
);
      newName=mkDirs.newName;
      directory=mkDirs.directory;
    }
    myCreatedElement=FileTemplateUtil.createFromTemplate(myTemplate,newName,myAttrPanel.getProperties(myDefaultProperties),directory);
  }
 catch (  Exception e) {
    showErrorDialog(e);
  }
}
