{
  int index;
  int next;
  do {
    index=tail.get();
    next=index + 1;
    if (next >= capacity) {
      next-=capacity;
    }
  }
 while (!tail.compareAndSet(index,next));
  return index;
}
